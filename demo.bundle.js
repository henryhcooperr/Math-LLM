/*! For license information please see demo.bundle.js.LICENSE.txt */
(()=>{"use strict";var __webpack_modules__={9:(t,e,i)=>{i.d(e,{A:()=>o});var r=i(84),n=i(156),s=i(174);r.A.extend(r.A,{isBoard:function(t){return null!==t&&"object"==typeof t&&this.isNumber(t.BOARD_MODE_NONE)&&this.isObject(t.objects)&&this.isObject(t.jc)&&this.isFunction(t.update)&&!!t.containerObj&&this.isString(t.id)},isId:function(t,e){return"string"==typeof e&&!!t.objects[e]},isName:function(t,e){return"string"==typeof e&&!!t.elementsByName[e]},isGroup:function(t,e){return"string"==typeof e&&!!t.groups[e]},isString:function(t){return"string"==typeof t},isNumber:function(t,e,i){var r="number"==typeof t||"[Object Number]"===Object.prototype.toString.call(t);return i=void 0===i||i,(e=e||!1)&&(r=r||""+parseFloat(t)===t),i||(r=r&&!isNaN(t)),r},isFunction:function(t){return"function"==typeof t},isArray:function(t){return Array.isArray?Array.isArray(t):null!==t&&"object"==typeof t&&"function"==typeof t.splice&&"function"==typeof t.join},isObject:function(t){return"object"==typeof t&&!this.isArray(t)},isDocumentOrFragment:function(t){return this.isObject(t)&&(9===t.nodeType||11===t.nodeType)},isPoint:function(t){return!(null===t||"object"!=typeof t||!this.exists(t.elementClass))&&t.elementClass===n.A.OBJECT_CLASS_POINT},isPoint3D:function(t){return!(null===t||"object"!=typeof t||!this.exists(t.type))&&t.type===n.A.OBJECT_TYPE_POINT3D},isPointType:function(t,e){var i,r;return!!this.isArray(e)||!!(this.isFunction(e)&&(i=e(),this.isArray(i)&&i.length>1))||(r=t.select(e),this.isPoint(r))},isPointType3D:function(t,e){var i,r;return!!(this.isArray(e)&&e.length>=3)||!!(this.isFunction(e)&&(i=e(),this.isArray(i)&&i.length>=3))||(r=t.select(e),this.isPoint3D(r))},isTransformationOrArray:function(t){if(null!==t){if(this.isArray(t)&&t.length>0)return this.isTransformationOrArray(t[0]);if("object"==typeof t)return t.type===n.A.OBJECT_TYPE_TRANSFORMATION}return!1},isEmpty:function(t){return 0===Object.keys(t).length},exists:function(t,e){var i=!(null==t||null===t);return(e=e||!1)?i&&""!==t:i},def:function(t,e){return this.exists(t)?t:e},str2Bool:function(t){return!this.exists(t)||("boolean"==typeof t?t:!!this.isString(t)&&"true"===t.toLowerCase())},cssParse:function(t){var e=t;return this.isString(e)?(e='{"'+(e=(e=(e=(e=e.replace(/\s*;\s*$/g,"")).replace(/\s*;\s*/g,'","')).replace(/\s*:\s*/g,'":"')).trim())+'"}',JSON.parse(e)):{}},cssStringify:function(t){var e,i,r="";if(!this.isObject(t))return"";for(e in t)t.hasOwnProperty(e)&&(i=t[e],(this.isString(i)||this.isNumber(i))&&(r+=e+":"+i+"; "));return r.trim()},createEvalFunction:function(t,e,i){var r,n,s,o=[],a={};for(n=0;n<i;n++)for(s in o[n]=this.createFunction(e[n],t),o[n].deps)a[s]=o[n].deps;return(r=function(t){return o[t]()}).deps=a,r},createFunction:function(t,e,i,r){var n=null;return this.isString(t)?n=e.jc.snippet(t,!0,i,!1):this.isFunction(t)?(n=t).deps=this.isObject(t.deps)?t.deps:{}:(this.isNumber(t)||this.isArray(t))&&((n=function(){return t}).deps={}),null!==n&&(n.origin=t),n},providePoints:function(t,e,i,r,n){var s,o,a,l,c,h=0,u=[];for(this.isArray(e)||(e=[e]),a=e.length,this.exists(n)&&(h=n.length),0===h&&(l=this.copyAttributes(i,t.options,r)),s=0;s<a;++s)if(h>0&&(o=Math.min(s,h-1),l=this.copyAttributes(i,t.options,r,n[o].toLowerCase())),this.isArray(e[s])&&e[s].length>1?(u.push(t.create("point",e[s],l)),u[u.length-1]._is_new=!0):this.isFunction(e[s])?(c=e[s](),this.isArray(c)&&c.length>1&&(u.push(t.create("point",[e[s]],l)),u[u.length-1]._is_new=!0)):u.push(t.select(e[s])),!this.isPoint(u[s]))return!1;return u},providePoints3D:function(t,e,i,r,n){var s,o,a,l,c,h=0,u=[];for(this.isArray(e)||(e=[e]),a=e.length,this.exists(n)&&(h=n.length),0===h&&(l=this.copyAttributes(i,t.board.options,r)),s=0;s<a;++s){if(h>0&&(o=Math.min(s,h-1),l=this.copyAttributes(i,t.board.options,r,n[o])),this.isArray(e[s])&&e[s].length>0&&e[s].every((t=>this.isArray(t)&&this.isNumber(t[0]))))for(o=0;o<e[s].length;o++)u.push(t.create("point3d",e[s][o],l)),u[u.length-1]._is_new=!0;else this.isArray(e[s])&&e[s].every((t=>this.isNumber(t)||this.isFunction(t)))?(u.push(t.create("point3d",e[s],l)),u[u.length-1]._is_new=!0):this.isPoint3D(e[s])?u.push(e[s]):this.isFunction(e[s])?(c=e[s](),this.isArray(c)&&c.length>1&&(u.push(t.create("point3d",[e[s]],l)),u[u.length-1]._is_new=!0)):u.push(t.select(e[s]));if(!this.isPoint3D(u[s]))return!1}return u},bind:function(t,e){return function(){return t.apply(e,arguments)}},evaluate:function(t){return this.isFunction(t)?t():t},indexOf:function(t,e,i){var r,n=this.exists(i);if(Array.indexOf&&!n)return t.indexOf(e);for(r=0;r<t.length;r++)if(n&&t[r][i]===e||!n&&t[r]===e)return r;return-1},eliminateDuplicates:function(t){var e,i=t.length,r=[],n={};for(e=0;e<i;e++)n[t[e]]=0;for(e in n)n.hasOwnProperty(e)&&r.push(e);return r},swap:function(t,e,i){var r;return r=t[e],t[e]=t[i],t[i]=r,t},uniqueArray:function(t){var e,i,n,s=[];if(0===t.length)return[];for(e=0;e<t.length;e++)if(n=this.isArray(t[e]),this.exists(t[e]))for(i=e+1;i<t.length;i++)n&&r.A.cmpArrays(t[e],t[i])?t[e]=[]:n||t[e]!==t[i]||(t[e]="");else t[e]="";for(i=0,e=0;e<t.length;e++)(n=this.isArray(t[e]))||""===t[e]?n&&0!==t[e].length&&(s[i]=t[e].slice(0),i++):(s[i]=t[e],i++);return t=s,s},isInArray:function(t,e){return r.A.indexOf(t,e)>-1},coordsArrayToMatrix:function(t,e){var i,r=[],n=[];for(i=0;i<t.length;i++)e?(r.push(t[i].usrCoords[1]),n.push(t[i].usrCoords[2])):n.push([t[i].usrCoords[1],t[i].usrCoords[2]]);return e&&(n=[r,n]),n},cmpArrays:function(t,e){var i;if(t===e)return!0;if(t.length!==e.length)return!1;for(i=0;i<t.length;i++)if(this.isArray(t[i])&&this.isArray(e[i])){if(!this.cmpArrays(t[i],e[i]))return!1}else if(t[i]!==e[i])return!1;return!0},removeElementFromArray:function(t,e){var i;for(i=0;i<t.length;i++)if(t[i]===e)return t.splice(i,1),t;return t},trunc:function(t,e){return e=r.A.def(e,0),this.toFixed(t,e)},_decimalAdjust:function(t,e,i){return void 0===i||0===+i?Math[t](e):(e=+e,i=+i,isNaN(e)||"number"!=typeof i||i%1!=0?NaN:(e=e.toString().split("e"),+((e=(e=Math[t](+(e[0]+"e"+(e[1]?+e[1]-i:-i)))).toString().split("e"))[0]+"e"+(e[1]?+e[1]+i:i))))},_round10:function(t,e){return this._decimalAdjust("round",t,e)},_floor10:function(t,e){return this._decimalAdjust("floor",t,e)},_ceil10:function(t,e){return this._decimalAdjust("ceil",t,e)},toFixed:function(t,e){return this._round10(t,-e).toFixed(e)},autoDigits:function(t){var e=Math.abs(t);return e>=.1?this.toFixed(t,2):e>=.01?this.toFixed(t,4):e>=1e-4?this.toFixed(t,6):t},parseNumber:function(t,e,i){var r;return this.isString(t)&&t.indexOf("%")>-1?(r=t.replace(/\s+%\s+/,""),parseFloat(r)*e*.01):this.isString(t)&&t.indexOf("fr")>-1?(r=t.replace(/\s+fr\s+/,""),parseFloat(r)*e):this.isString(t)&&t.indexOf("px")>-1?(r=t.replace(/\s+px\s+/,""),r=parseFloat(r),this.isFunction(i)?i(r):this.isNumber(i)?r*i:r):parseFloat(t)},parsePosition:function(t){var e,i,r="",n="";if(""!==(t=t.trim()))for(e=t.split(/[ ,]+/),i=0;i<e.length;i++)"left"===e[i]||"right"===e[i]?r=e[i]:n=e[i];return{side:r,pos:n}},keys:function(t,e){var i,r=[];for(i in t)e?t.hasOwnProperty(i)&&r.push(i):r.push(i);return r},clone:function(t){var e={};return e.prototype=t,e},cloneAndCopy:function(t,e){var i,r=function(){};for(i in r.prototype=t,e)r[i]=e[i];return r},merge:function(t,e){var i,r,n,s;for(i in e)if(e.hasOwnProperty(i))if(n=e[i],this.isArray(n))for(t[i]||(t[i]=[]),r=0;r<n.length;r++)s=e[i][r],"object"==typeof e[i][r]?t[i][r]=this.merge(t[i][r],s):t[i][r]=e[i][r];else"object"==typeof n?(t[i]||(t[i]={}),t[i]=this.merge(t[i],n)):("boolean"==typeof t&&(t={}),t[i]=n);return t},deepCopy:function(t,e,i){var r,n,s,o;if(i=i||!1,"object"!=typeof t||null===t)return t;if(this.isArray(t))for(r=[],n=0;n<t.length;n++)null!==(s=t[n])&&"object"==typeof s?this.exists(s.board)?r[n]=s.id:r[n]=this.deepCopy(s,{},i):r[n]=s;else{for(n in r={},t)t.hasOwnProperty(n)&&(o=i?n.toLowerCase():n,null!==(s=t[n])&&"object"==typeof s?this.exists(s.board)?r[o]=s.id:r[o]=this.deepCopy(s,{},i):r[o]=s);for(n in e)e.hasOwnProperty(n)&&(o=i?n.toLowerCase():n,null!==(s=e[n])&&"object"==typeof s?this.isArray(s)||!this.exists(r[o])?r[o]=this.deepCopy(s,{},i):r[o]=this.deepCopy(r[o],s,i):r[o]=s)}return r},mergeAttr:function(t,e,i,r){var n,s,o;for(n in i=i||!0,r=r||!1,e)e.hasOwnProperty(n)&&((s=i?n.toLowerCase():n)!==n&&t.hasOwnProperty(n)&&(t.hasOwnProperty(s)?this.mergeAttr(t[s],t[n],i):t[s]=t[n],delete t[n]),o=e[n],!this.isObject(o)||null===o||this.isDocumentOrFragment(o)||this.exists(o.board)||"string"==typeof o.valueOf()?r&&!this.exists(o)||(t[s]=o):(void 0!==t[s]&&null!==t[s]&&this.isObject(t[s])||(t[s]={}),this.mergeAttr(t[s],o,i)))},keysToLowerCase:function(t){var e,i,r=Object.keys(t),n=r.length,s={};if("object"!=typeof t)return t;for(;n--;)e=r[n],t.hasOwnProperty(e)&&("object"!=typeof(i=t[e])||null===i||this.isArray(i)||this.exists(i.nodeType)||this.exists(i.board)?s[e.toLowerCase()]=i:s[e.toLowerCase()]=this.keysToLowerCase(i));return s},copyAttributes:function(t,e,i){var n,s,o,a,l,c;for(n=(a=arguments.length)<3||{circle:1,curve:1,foreignobject:1,image:1,line:1,point:1,polygon:1,text:1,ticks:1,integral:1}[i]?r.A.deepCopy(e.elements,null,!0):{},a<4&&this.exists(i)&&this.exists(e.layer[i])&&(n.layer=e.layer[i]),l=e,c=!0,o=2;o<a;o++){if(s=arguments[o],!this.exists(l[s])){c=!1;break}l=l[s]}for(c&&(n=r.A.deepCopy(n,l,!0)),l="object"==typeof t?this.keysToLowerCase(t):{},c=!0,o=3;o<a;o++){if(s=arguments[o].toLowerCase(),!this.exists(l[s])){c=!1;break}l=l[s]}if(c&&this.mergeAttr(n,l,!0),"board"===arguments[2])return n;for(l=e,c=!0,o=2;o<a;o++){if(s=arguments[o],!this.exists(l[s])){c=!1;break}l=l[s]}return c&&this.exists(l.label)&&(n.label=r.A.deepCopy(l.label,n.label,!0)),n.label=r.A.deepCopy(e.label,n.label,!0),n},copyPrototypeMethods:function(t,e,i){var r;for(r in t.prototype[i]=e.prototype.constructor,e.prototype)e.prototype.hasOwnProperty(r)&&(t.prototype[r]=e.prototype[r])},getCloneObject:function(t){var e,i,r={};for(i in r.id=t.id+"T"+t.numTraces,t.numTraces+=1,r.coords=t.coords,e=this.deepCopy(t.visProp,t.visProp.traceattributes,!0),r.visProp={},e)e.hasOwnProperty(i)&&0!==i.indexOf("aria")&&0!==i.indexOf("highlight")&&0!==i.indexOf("attractor")&&"label"!==i&&"needsregularupdate"!==i&&"infoboxdigits"!==i&&(r.visProp[i]=t.eval(e[i]));return r.evalVisProp=function(t){return r.visProp[t]},r.eval=function(t){return t},r.visProp.layer=t.board.options.layer.trace,r.visProp.tabindex=null,r.visProp.highlight=!1,r.board=t.board,r.elementClass=t.elementClass,this.clearVisPropOld(r),r.visPropCalc={visible:t.evalVisProp("visible")},r},toJSON:function(t,e){var i,n,s,o;if(e=r.A.def(e,!1),void 0!==JSON&&JSON.stringify&&!e)try{return JSON.stringify(t)}catch(t){}switch(typeof t){case"object":if(t){if(i=[],this.isArray(t)){for(s=0;s<t.length;s++)i.push(r.A.toJSON(t[s],e));return"["+i.join(",")+"]"}for(n in t)if(t.hasOwnProperty(n)){try{o=r.A.toJSON(t[n],e)}catch(t){o=""}e?i.push(n+":"+o):i.push('"'+n+'":'+o)}return"{"+i.join(",")+"} "}return"null";case"string":return"'"+t.replace(/(["'])/g,"\\$1")+"'";case"number":case"boolean":return t.toString()}return"0"},clearVisPropOld:function(t){return t.visPropOld={cssclass:"",cssdefaultstyle:"",cssstyle:"",fillcolor:"",fillopacity:"",firstarrow:!1,fontsize:-1,lastarrow:!1,left:-1e5,linecap:"",shadow:!1,strokecolor:"",strokeopacity:"",strokewidth:"",tabindex:-1e5,transitionduration:0,top:-1e5,visible:null},t},isInObject:function(t,e){var i;for(i in t)if(t.hasOwnProperty(i)&&t[i]===e)return!0;return!1},escapeHTML:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeHTML:function(t){return t.replace(/<\/?[^>]+>/gi,"").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")},capitalize:function(t){return t.charAt(0).toUpperCase()+t.substring(1).toLowerCase()},trimNumber:function(t){return"."!==(t=(t=t.replace(/^0+/,"")).replace(/0+$/,""))[t.length-1]&&","!==t[t.length-1]||(t=t.slice(0,-1)),"."!==t[0]&&","!==t[0]||(t="0"+t),t},filterElements:function(t,e){var i,r,n,s,o,a,l,c=t.length,h=[];if("function"!=typeof e&&"object"!=typeof e)return h;for(i=0;i<c;i++){if(l=!0,n=t[i],"object"==typeof e){for(r in e)if(e.hasOwnProperty(r)&&(s=r.toLowerCase(),o="function"==typeof n[r]?n[r]():n[r],a=n.visProp&&"function"==typeof n.visProp[s]?n.visProp[s]():n.visProp&&n.visProp[s],!(l="function"==typeof e[r]?e[r](o)||e[r](a):o===e[r]||a===e[r])))break}else"function"==typeof e&&(l=e(n));l&&h.push(n)}return h},trim:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},toFraction:function(t,e,i){var r=s.A.decToFraction(t,i),n="";return 0===r[1]&&0===r[2]?n+="0":(r[0]<0&&(n+="-"),0===r[2]?n+=r[1]:1===r[2]&&1===r[3]||(0!==r[1]&&(n+=r[1]+" "),n+=!0===e?"\\frac{"+r[2]+"}{"+r[3]+"}":r[2]+"/"+r[3])),n},concat:function(t,e){var i,r=e.length;for(i=0;i<r;i++)t.push(e[i]);return t},sanitizeHTML:function(t,e){return"function"==typeof html_sanitize&&e?html_sanitize(t,(function(){}),(function(t){return t})):(t&&"string"==typeof t&&(t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;")),t)},evalSlider:function(t){return t&&t.type===n.A.OBJECT_TYPE_GLIDER&&"function"==typeof t.Value?t.Value():t},stack2jsxgraph:function(t){var e;return"["===(e=t.replace(/%pi/g,"PI").replace(/%e/g,"EULER").replace(/%phi/g,"1.618033988749895").replace(/%gamma/g,"0.5772156649015329").trim())[0]&&"]"===e[e.length-1]&&(e=e.slice(1,-1).split(/\s*,\s*/)),e}});const o=r.A},30:(t,e,i)=>{i.d(e,{A:()=>d});var r=i(84),n=i(156),s=i(345),o=i(703),a=i(234),l=i(9),c=i(174),h=i(999),u=function(){this._val=parseFloat(this.rendNodeRange.value),this.rendNodeOut.value=this.rendNodeRange.value,this.board.update()};r.A.Text=function(t,e,i,r){var s;this.constructor(t,i,n.A.OBJECT_TYPE_TEXT,n.A.OBJECT_CLASS_TEXT),this.element=this.board.select(i.anchor),this.coordsConstructor(e,this.evalVisProp("islabel")),this.content="",this.plaintext="",this.plaintextOld=null,this.orgText="",this.needsSizeUpdate=!1,this.hiddenByParent=!1,this.size=[1,1],this.id=this.board.setId(this,"T"),this.board.renderer.drawText(this),this.board.finalizeAdding(this),s=this.visProp.visible,this.visProp.visible=!0,this.setText(r),this.visProp.visible=s,l.A.isString(this.content)&&this.notifyParents(this.content),this.elType="text",this.methodMap=l.A.deepCopy(this.methodMap,{setText:"setTextJessieCode",move:"setCoords",Size:"getSize",setAutoPosition:"setAutoPosition"})},r.A.Text.prototype=new s.A,l.A.copyPrototypeMethods(r.A.Text,h.A,"coordsConstructor"),r.A.extend(r.A.Text.prototype,{hasPoint:function(t,e){var i,r,n,s,o,a,h,u;return l.A.isObject(this.evalVisProp("precision"))?(h=this.board._inputDevice,u=this.evalVisProp("precision."+h)):u=this.board.options.precision.hasPoint,this.transformations.length>0&&(t=(i=c.A.matVecMult(c.A.inverse(this.board.renderer.joinTransforms(this,this.transformations)),[1,t,e]))[1],e=i[2]),r=(i="right"===(o=this.getAnchorX())?this.coords.scrCoords[1]-this.size[0]:"middle"===o?this.coords.scrCoords[1]-.5*this.size[0]:this.coords.scrCoords[1])+this.size[0],n=(s="top"===(a=this.getAnchorY())?this.coords.scrCoords[2]+this.size[1]:"middle"===a?this.coords.scrCoords[2]+.5*this.size[1]:this.coords.scrCoords[2])-this.size[1],"all"===this.evalVisProp("dragarea")?t>=i-u&&t<r+u&&e>=n-u&&e<=s+u:e>=n-u&&e<=s+u&&(t>=i-u&&t<=i+2*u||t>=r-2*u&&t<=r+u)},_createFctUpdateText:function(t){var e,i,r,n,s,o,a=this.evalVisProp("parse"),c=this.evalVisProp("usemathjax"),h=this.evalVisProp("usekatex"),u=!1;if(this.orgText=t,l.A.isFunction(t))this.updateText=function(){n=t().toString(),this.plaintext=!a||c||h?n:this.replaceSub(this.replaceSup(this.convertGeonextAndSketchometry2CSS(n,!1)))};else if(l.A.isNumber(t)&&this.evalVisProp("formatnumber")?this.evalVisProp("tofraction")?this.content=c?"\\("+l.A.toFraction(t,!0)+"\\)":l.A.toFraction(t,h):(r=this.evalVisProp("digits"),this.useLocale()?this.content=this.formatNumberLocale(t,r):this.content=l.A.toFixed(t,r)):l.A.isString(t)&&a?(this.evalVisProp("useasciimathml")?this.content="'`"+t+"`'":c||h?(this.content=this.valueTagToJessieCode(t),l.A.isArray(this.content)||(this.content=this.content.replace(/\\/g,"\\\\"))):this.content=this.poorMansTeX(this.valueTagToJessieCode(t)),u=!0):this.content=t,u){if(l.A.isArray(this.content)){for(o=this,s=0;s<this.content.length;s++)if('"'!==this.content[s][0])for(i in this.content[s]=this.board.jc.snippet(this.content[s],!0,"",!1),this.content[s].deps)this.addParents(this.content[s].deps[i]),this.content[s].deps[i].addChild(this);e=function(){var t,e,i=o.evalVisProp("digits"),r="";for(t=0;t<o.content.length;t++)l.A.isFunction(o.content[t])?(e=o.content[t](),e=o.useLocale()?o.formatNumberLocale(e,i):l.A.toFixed(e,i)):'"'===(e=o.content[t])[0]&&'"'===e[e.length-1]&&(e=e.slice(1,-1)),r+=e;return r}}else for(i in(e=this.board.jc.snippet(this.content,!0,"",!1)).deps)this.addParents(e.deps[i]),e.deps[i].addChild(this);this.updateText=function(){this.plaintext=this.unescapeTicks(e())}}else this.updateText=function(){this.plaintext=this.content}},_setText:function(t){return this._createFctUpdateText(t),this.updateText(),this.fullUpdate(),this.board.infobox&&this.id===this.board.infobox.id||this.updateSize(),this},setTextJessieCode:function(t){var e;return this.visProp.castext=t,e=l.A.isFunction(t)?function(){return l.A.sanitizeHTML(t())}:l.A.isNumber(t)?t:l.A.sanitizeHTML(t),this._setText(e)},setText:function(t){return this._setText(t)},updateSize:function(){var t,e,i,r=this.evalVisProp("display");return a.A.isBrowser&&"no"!==this.board.renderer.type?(i=this.rendNode,"html"===r||"vml"===this.board.renderer.type?l.A.exists(i.offsetWidth)?(e=this,window.setTimeout((function(){e.size=[i.offsetWidth,i.offsetHeight],e.needsUpdate=!0,e.updateRenderer()}),0)):this.size=this.crudeSizeEstimate():"internal"===r&&("svg"===this.board.renderer.type?(e=this,window.setTimeout((function(){try{t=i.getBBox(),e.size=[t.width,t.height],e.needsUpdate=!0,e.updateRenderer()}catch(t){}}),0)):"canvas"===this.board.renderer.type&&(this.size=this.crudeSizeEstimate())),this):this},crudeSizeEstimate:function(){var t=parseFloat(this.evalVisProp("fontsize"));return[t*this.plaintext.length*.45,.9*t]},utf8_decode:function(t){return t.replace(/&#x(\w+);/g,(function(t,e){return String.fromCharCode(parseInt(e,16))}))},replaceSub:function(t){if(!t.indexOf)return t;for(var e,i=t.indexOf("_{");i>=0;)(e=(t=t.slice(0,i)+t.slice(i).replace(/_\{/,"<sub>")).indexOf("}",i+4))>=0&&(t=t.slice(0,e)+t.slice(e).replace(/\}/,"</sub>")),i=t.indexOf("_{");for(i=t.indexOf("_");i>=0;)i=(t=t.slice(0,i)+t.slice(i).replace(/_(.?)/,"<sub>$1</sub>")).indexOf("_");return t},replaceSup:function(t){if(!t.indexOf)return t;for(var e,i=t.indexOf("^{");i>=0;)(e=(t=t.slice(0,i)+t.slice(i).replace(/\^\{/,"<sup>")).indexOf("}",i+4))>=0&&(t=t.slice(0,e)+t.slice(e).replace(/\}/,"</sup>")),i=t.indexOf("^{");for(i=t.indexOf("^");i>=0;)i=(t=t.slice(0,i)+t.slice(i).replace(/\^(.?)/,"<sup>$1</sup>")).indexOf("^");return t},getSize:function(){return this.size},setCoords:function(t,e){var i,r,s;return l.A.isArray(t)&&t.length>1&&(e=t[1],t=t[0]),this.evalVisProp("islabel")&&l.A.exists(this.element)?(r=(t-(i=this.element.getLabelAnchor()).usrCoords[1])*this.board.unitX,s=-(e-i.usrCoords[2])*this.board.unitY,this.relativeCoords.setCoordinates(n.A.COORDS_BY_SCREEN,[r,s])):this.coords.setCoordinates(n.A.COORDS_BY_USER,[t,e]),this.fullUpdate(),this},update:function(t){return this.needsUpdate?(this.updateCoords(t),this.updateText(),"internal"===this.evalVisProp("display")&&l.A.isString(this.plaintext)&&(this.plaintext=this.utf8_decode(this.plaintext)),this.checkForSizeUpdate(),this.needsSizeUpdate&&this.updateSize(),this):this},checkForSizeUpdate:function(){this.board.infobox&&this.id===this.board.infobox.id?this.needsSizeUpdate=!1:(this.needsSizeUpdate=this.plaintextOld!==this.plaintext,this.needsSizeUpdate&&(this.plaintextOld=this.plaintext))},updateRenderer:function(){return this.evalVisProp("autoposition")&&this.setAutoPosition().updateConstraint(),this.updateRendererGeneric("updateText")},expandShortMath:function(t){return t.replace(/([)0-9.])\s*([(a-zA-Z_])/g,"$1*$2")},generateTerm:function(t,e,i){var r,n,s,a,c='""';if(s=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t||"").replace(/\r/g,"")).replace(/\n/g,"")).replace(/"/g,"'")).replace(/'/g,"\\'")).replace(/&amp;arc;/g,"&ang;")).replace(/<arc\s*\/>/g,"&ang;")).replace(/&lt;arc\s*\/&gt;/g,"&ang;")).replace(/&lt;sqrt\s*\/&gt;/g,"&radic;")).replace(/&lt;value&gt;/g,"<value>")).replace(/&lt;\/value&gt;/g,"</value>")).indexOf("<value>"),a=t.indexOf("</value>"),s>=0)for(;s>=0;)c+=' + "'+this.replaceSub(this.replaceSup(t.slice(0,s)))+'"',n=(n=t.slice(s+7,a)).replace(/\s+/g,""),!0===e&&(n=this.expandShortMath(n)),(r=(r=(r=i?n:o.A.geonext2JS(n,this.board)).replace(/\\"/g,"'")).replace(/\\'/g,"'")).indexOf("toFixed")<0&&l.A.isNumber(l.A.bind(this.board.jc.snippet(r,!0,"",!1),this)())?c+="+("+r+").toFixed("+this.evalVisProp("digits")+")":c+="+("+r+")",s=(t=t.slice(a+8)).indexOf("<value>"),a=t.indexOf("</value>");return c+=' + "'+this.replaceSub(this.replaceSup(t))+'"',(c=(c=this.convertGeonextAndSketchometry2CSS(c)).replace(/&amp;/g,"&")).replace(/"/g,"'")},valueTagToJessieCode:function(t){var e,i,r,n,s=[],o='"';if(r=(t=(t=(t=(t=(t=t||"").replace(/\r/g,"")).replace(/\n/g,"")).replace(/&lt;value&gt;/g,"<value>")).replace(/&lt;\/value&gt;/g,"</value>")).indexOf("<value>"),n=t.indexOf("</value>"),r>=0)for(;r>=0;)s.push(o+this.escapeTicks(t.slice(0,r))+o),i=(i=t.slice(r+7,n)).replace(/\s+/g,""),e=(e=i=this.expandShortMath(i)).replace(/\\"/g,"'").replace(/\\'/g,"'"),s.push("("+e+")"),r=(t=t.slice(n+8)).indexOf("<value>"),n=t.indexOf("</value>");for(s.push(o+this.escapeTicks(t)+o),r=0;r<s.length;r++)s[r]=s[r].replace(/&amp;/g,"&");return s},poorMansTeX:function(t){var e,i;if(l.A.isArray(t)){for(i=[],e=0;e<t.length;e++)i.push(this.poorMansTeX(t[e]));return i}return t=t.replace(/<arc\s*\/*>/g,"&ang;").replace(/&lt;arc\s*\/*&gt;/g,"&ang;").replace(/<sqrt\s*\/*>/g,"&radic;").replace(/&lt;sqrt\s*\/*&gt;/g,"&radic;"),this.convertGeonextAndSketchometry2CSS(this.replaceSub(this.replaceSup(t)),!0)},escapeTicks:function(t){return t.replace(/"/g,"%22").replace(/'/g,"%27")},unescapeTicks:function(t){return t.replace(/%22/g,'"').replace(/%27/g,"'")},convertGeonext2CSS:function(t){return l.A.isString(t)&&(t=(t=(t=(t=t.replace(/(<|&lt;)overline(>|&gt;)/g,"<span style=text-decoration:overline;>")).replace(/(<|&lt;)\/overline(>|&gt;)/g,"</span>")).replace(/(<|&lt;)arrow(>|&gt;)/g,"<span style=text-decoration:overline;>")).replace(/(<|&lt;)\/arrow(>|&gt;)/g,"</span>")),t},convertSketchometry2CSS:function(t,e){var i='<span class="sketcho sketcho-inherit sketcho-',r='"></span>';return l.A.isString(t)&&(e&&(i=this.escapeTicks(i),r=this.escapeTicks(r)),t=(t=t.replace(/(<|&lt;)sketchofont(>|&gt;)/g,i)).replace(/(<|&lt;)\/sketchofont(>|&gt;)/g,r)),t},convertGeonextAndSketchometry2CSS:function(t,e){return t=this.convertGeonext2CSS(t),this.convertSketchometry2CSS(t,e)},notifyParents:function(t){var e,i=null;t=(t=t.replace(/&lt;value&gt;/g,"<value>")).replace(/&lt;\/value&gt;/g,"</value>");do{null!==(i=(e=/<value>([\w\s*/^\-+()[\],<>=!]+)<\/value>/).exec(t))&&(o.A.findDependencies(this,i[1],this.board),t=(t=t.slice(i.index)).replace(e,""))}while(null!==i);return this},getParents:function(){var t;return t=void 0!==this.relativeCoords?[this.relativeCoords.usrCoords[1],this.relativeCoords.usrCoords[2],this.orgText]:[this.Z(),this.X(),this.Y(),this.orgText],0!==this.parents.length&&(t=this.parents),t},bounds:function(){var t=this.coords.usrCoords;return this.evalVisProp("islabel")||0===this.board.unitY||0===this.board.unitX?[0,0,0,0]:[t[1],t[2]+this.size[1]/this.board.unitY,t[1]+this.size[0]/this.board.unitX,t[2]]},getAnchorX:function(){var t=this.evalVisProp("anchorx");if("auto"===t)switch(this.visProp.position){case"top":case"bot":return"middle";case"rt":case"lrt":case"urt":return"left";default:return"right"}return t},getAnchorY:function(){var t=this.evalVisProp("anchory");if("auto"===t)switch(this.visProp.position){case"top":case"ulft":case"urt":return"bottom";case"bot":case"lrt":case"llft":return"top";default:return"middle"}return t},getNumberOfConflicts:function(t,e,i,r,n){n=n||[];var s,o,a,l,c,h=0;for(l=this.board.options.precision.hasPoint,this.board.options.precision.hasPoint=.25*(i+r),s=0,a=this.board.objectsList.length;s<a;s++)c=(o=this.board.objectsList[s]).visProp.hasinnerpoints,o.visProp.hasinnerpoints=!1,o.visPropCalc.visible&&"axis"!==o.elType&&"ticks"!==o.elType&&o!==this.board.infobox&&o!==this&&o.hasPoint(t,e)&&-1===n.indexOf(o.id)&&h++,o.visProp.hasinnerpoints=c;return this.board.options.precision.hasPoint=l,h},setAutoPosition:function(){var t,e,i,r,n,s,o,a,l,c,h,u,d,p,f,m,g,_=this.size[0],v=this.size[1],y={conflicts:1/0,angle:0,r:0},b=2*Math.PI/12;if(this===this.board.infobox||!this.visPropCalc.visible||!this.evalVisProp("islabel")||!this.element)return this;if(h=this.evalVisProp("offset"),i=(n=this.element.getLabelAnchor()).scrCoords[1],r=n.scrCoords[2],p=h[0],f=h[1],0===(c=this.getNumberOfConflicts(i+p,r-f,_,v,this.evalVisProp("autopositionwhitelist"))))return this;for(u=this.evalVisProp("autopositionmindistance"),a=this.evalVisProp("autopositionmaxdistance"),l=.2*u,s=Math.atan2(f,p),y.conflicts=c,y.angle=s,y.r=u;y.conflicts>0&&u<=a;){for(d=1,o=s+b;d<12&&y.conflicts>0&&(t=i+u*(m=Math.cos(o)),e=r-u*(g=Math.sin(o)),(c=this.getNumberOfConflicts(t,e,_,v,this.evalVisProp("autopositionwhitelist")))<y.conflicts&&(y.conflicts=c,y.angle=o,y.r=u),0!==y.conflicts);d++)o+=b;u+=l}return u=y.r,m=Math.cos(y.angle),g=Math.sin(y.angle),this.visProp.offset=[u*m,u*g],this.visProp.anchorx=m<-.2?"right":m>.2?"left":"middle",this}}),r.A.createText=function(t,e,i){var n,s=l.A.copyAttributes(i,t.options,"text"),o=e.slice(0,-1),a=e[e.length-1];if(s.anchor=s.parent||s.anchor,!(n=h.A.create(r.A.Text,t,o,s,a)))throw new Error("JSXGraph: Can't create text with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [x,y], [z,x,y], [element,transformation]");return 0!==s.rotate&&n.addRotation(s.rotate),n},r.A.registerElement("text",r.A.createText),r.A.createHTMLSlider=function(t,e,i){var n,s,o=l.A.copyAttributes(i,t.options,"htmlslider");if(2!==e.length||2!==e[0].length||3!==e[1].length)throw new Error("JSXGraph: Can't create htmlslider with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parents are: [[x,y], [min, start, max]]");o.anchor=o.parent||o.anchor,o.fixed=o.fixed||!0,s=[e[0][0],e[0][1],'<form style="display:inline"><input type="range" /><span></span><input type="text" /></form>'],(n=r.A.createText(t,s,o)).type=l.A.OBJECT_TYPE_HTMLSLIDER,n.rendNodeForm=n.rendNode.childNodes[0],n.rendNodeRange=n.rendNodeForm.childNodes[0],n.rendNodeRange.min=e[1][0],n.rendNodeRange.max=e[1][2],n.rendNodeRange.step=o.step,n.rendNodeRange.value=e[1][1],n.rendNodeLabel=n.rendNodeForm.childNodes[1],n.rendNodeLabel.id=n.rendNode.id+"_label",o.withlabel&&(n.rendNodeLabel.innerHTML=n.name+"="),n.rendNodeOut=n.rendNodeForm.childNodes[2],n.rendNodeOut.value=e[1][1];try{n.rendNodeForm.id=n.rendNode.id+"_form",n.rendNodeRange.id=n.rendNode.id+"_range",n.rendNodeOut.id=n.rendNode.id+"_out"}catch(t){r.A.debug(t)}return n.rendNodeRange.style.width=o.widthrange+"px",n.rendNodeRange.style.verticalAlign="middle",n.rendNodeOut.style.width=o.widthout+"px",n._val=e[1][1],r.A.supportsVML()?a.A.addEvent(n.rendNodeForm,"change",u,n):a.A.addEvent(n.rendNodeForm,"input",u,n),n.Value=function(){return this._val},n},r.A.registerElement("htmlslider",r.A.createHTMLSlider);const d=r.A.Text},40:(t,e,i)=>{i.d(e,{A:()=>u});var r=i(84),n=i(156),s=i(159),o=i(174),a=i(959),l=i(956),c=i(9),h=i(320);o.A.Geometry={},r.A.extend(o.A.Geometry,{angle:function(t,e,i){var n,s,o,a,l=[],c=[],h=[];return r.A.deprecated("Geometry.angle()","Geometry.rad()"),t.coords?(l[0]=t.coords.usrCoords[1],l[1]=t.coords.usrCoords[2]):(l[0]=t[0],l[1]=t[1]),e.coords?(c[0]=e.coords.usrCoords[1],c[1]=e.coords.usrCoords[2]):(c[0]=e[0],c[1]=e[1]),i.coords?(h[0]=i.coords.usrCoords[1],h[1]=i.coords.usrCoords[2]):(h[0]=i[0],h[1]=i[1]),n=l[0]-c[0],s=l[1]-c[1],o=h[0]-c[0],a=h[1]-c[1],Math.atan2(n*a-s*o,n*o+s*a)},trueAngle:function(t,e,i){return 57.29577951308232*this.rad(t,e,i)},rad:function(t,e,i){var r,n,s,o,a,l,c;return t.coords?(r=t.coords.usrCoords[1],n=t.coords.usrCoords[2]):(r=t[0],n=t[1]),e.coords?(s=e.coords.usrCoords[1],o=e.coords.usrCoords[2]):(s=e[0],o=e[1]),i.coords?(a=i.coords.usrCoords[1],l=i.coords.usrCoords[2]):(a=i[0],l=i[1]),(c=Math.atan2(l-o,a-s)-Math.atan2(n-o,r-s))<0&&(c+=6.283185307179586),c},angleBisector:function(t,e,i,r){var o,a,l,h,u,d=t.coords.usrCoords,p=e.coords.usrCoords,f=i.coords.usrCoords;return c.A.exists(r)||(r=t.board),0===p[0]?new s.A(n.A.COORDS_BY_USER,[1,.5*(d[1]+f[1]),.5*(d[2]+f[2])],r):(h=d[1]-p[1],u=d[2]-p[2],o=Math.atan2(u,h),h=f[1]-p[1],u=f[2]-p[2],l=.5*(o+(a=Math.atan2(u,h))),o>a&&(l+=Math.PI),h=Math.cos(l)+p[1],u=Math.sin(l)+p[2],new s.A(n.A.COORDS_BY_USER,[1,h,u],r))},reflection:function(t,e,i){var r,o,a,l,h,u,d=e.coords.usrCoords,p=t.point1.coords.usrCoords,f=t.point2.coords.usrCoords;return c.A.exists(i)||(i=e.board),l=f[1]-p[1],h=f[2]-p[2],r=d[1]-p[1],u=(l*(d[2]-p[2])-h*r)/(l*l+h*h),o=d[1]+2*u*h,a=d[2]-2*u*l,new s.A(n.A.COORDS_BY_USER,[o,a],i)},rotation:function(t,e,i,r){var o,a,l,h,u,d,p=e.coords.usrCoords,f=t.coords.usrCoords;return c.A.exists(r)||(r=e.board),o=p[1]-f[1],a=p[2]-f[2],u=o*(l=Math.cos(i))-a*(h=Math.sin(i))+f[1],d=o*h+a*l+f[2],new s.A(n.A.COORDS_BY_USER,[u,d],r)},perpendicular:function(t,e,i){var r,a,l,h,u,d=t.point1.coords.usrCoords,p=t.point2.coords.usrCoords,f=e.coords.usrCoords;return c.A.exists(i)||(i=e.board),e===t.point1?(r=d[1]+p[2]-d[2],a=d[2]-p[1]+d[1],u=d[0]*p[0],Math.abs(u)<o.A.eps&&(r=p[2],a=-p[1]),h=[u,r,a],l=!0):e===t.point2?(r=p[1]+d[2]-p[2],a=p[2]-d[1]+p[1],u=d[0]*p[0],Math.abs(u)<o.A.eps&&(r=d[2],a=-d[1]),h=[u,r,a],l=!1):Math.abs(o.A.innerProduct(f,t.stdform,3))<o.A.eps?(r=f[1]+p[2]-f[2],a=f[2]-p[1]+f[1],u=p[0],Math.abs(u)<o.A.eps&&(r=p[2],a=-p[1]),l=!0,Math.abs(u)>o.A.eps&&Math.abs(r-f[1])<o.A.eps&&Math.abs(a-f[2])<o.A.eps&&(r=f[1]+d[2]-f[2],a=f[2]-d[1]+f[1],l=!1),h=[u,r,a]):(h=[0,t.stdform[1],t.stdform[2]],h=o.A.crossProduct(h,f),h=o.A.crossProduct(h,t.stdform),l=!0),[new s.A(n.A.COORDS_BY_USER,h,i),l]},circumcenterMidpoint:function(){r.A.deprecated("Geometry.circumcenterMidpoint()","Geometry.circumcenter()"),this.circumcenter.apply(this,arguments)},circumcenter:function(t,e,i,r){var a,l,h,u,d=t.coords.usrCoords,p=e.coords.usrCoords,f=i.coords.usrCoords;return c.A.exists(r)||(r=t.board),a=[p[0]-d[0],-p[2]+d[2],p[1]-d[1]],l=[.5*(d[0]+p[0]),.5*(d[1]+p[1]),.5*(d[2]+p[2])],h=o.A.crossProduct(a,l),a=[f[0]-p[0],-f[2]+p[2],f[1]-p[1]],l=[.5*(p[0]+f[0]),.5*(p[1]+f[1]),.5*(p[2]+f[2])],u=o.A.crossProduct(a,l),new s.A(n.A.COORDS_BY_USER,o.A.crossProduct(h,u),r)},distance:function(t,e,i){var r,n=0;for(i||(i=Math.min(t.length,e.length)),r=0;r<i;r++)n+=(t[r]-e[r])*(t[r]-e[r]);return Math.sqrt(n)},affineDistance:function(t,e,i){var r;return(r=this.distance(t,e,i))>o.A.eps&&(Math.abs(t[0])<o.A.eps||Math.abs(e[0])<o.A.eps)?1/0:r},affineRatio:function(t,e,i){var r;return c.A.exists(t.usrCoords)&&(t=t.usrCoords),c.A.exists(e.usrCoords)&&(e=e.usrCoords),c.A.exists(i.usrCoords)&&(i=i.usrCoords),r=e[1]-t[1],Math.abs(r)>o.A.eps?(i[1]-t[1])/r:(i[2]-t[2])/(e[2]-t[2])},sortVertices:function(t){for(var e,i=h.A.each(t,h.A.coordsArray),r=i.length,n=null;i[0][0]===i[r-1][0]&&i[0][1]===i[r-1][1]&&i[0][2]===i[r-1][2];)n=i.pop(),r--;return e=i[0],i.sort((function(t,i){return(t[2]===e[2]&&t[1]===e[1]?-1/0:Math.atan2(t[2]-e[2],t[1]-e[1]))-(i[2]===e[2]&&i[1]===e[1]?-1/0:Math.atan2(i[2]-e[2],i[1]-e[1]))})),null!==n&&i.push(n),i},signedTriangle:function(t,e,i){var r=h.A.coordsArray(t),n=h.A.coordsArray(e),s=h.A.coordsArray(i);return.5*((n[1]-r[1])*(s[2]-r[2])-(n[2]-r[2])*(s[1]-r[1]))},signedPolygon:function(t,e){var i,r,n=0,s=h.A.each(t,h.A.coordsArray);for(void 0===e&&(e=!0),e?s.unshift(s[s.length-1]):s=this.sortVertices(s),r=s.length,i=1;i<r;i++)n+=s[i-1][1]*s[i][2]-s[i][1]*s[i-1][2];return.5*n},GrahamScan:function(t){var e,i,r,n,s,a,l,u,d,p,f,m,g,_,v,y,b,A,x,C,E,M,S,w=o.A.eps*o.A.eps,P=this,T=[],O=[],R=h.A.each(t,h.A.coordsArray);if(0===(S=R.length))return[];if(S>1024)for(l=s=R[0][1],u=a=R[0][2],m=p=R[0][1]-R[0][2],f=d=R[0][1]+R[0][2],g=0,_=0,v=0,y=0,A=0,C=0,b=0,x=0,e=1;e<S;e++)(E=R[e][1])<s?(s=E,g=e):E>l&&(l=E,_=e),(E=R[e][2])<a?(a=E,v=e):E>u&&(u=E,y=e),(E=R[e][1]-R[e][2])<p?(p=E,A=e):E>m&&(m=E,C=e),(E=R[e][1]+R[e][2])<d?(d=E,b=e):E>f&&(f=E,x=e);for(e=0;e<S;e++)M=R[e],(S<=1024||e in[g,_,v,y,b,A,x,C]||g!==A&&this.signedTriangle(R[g],R[A],M)>=-w||A!==y&&this.signedTriangle(R[A],R[y],M)>=-w||y!==x&&this.signedTriangle(R[y],R[x],M)>=-w||x!==_&&this.signedTriangle(R[x],R[_],M)>=-w||_!==C&&this.signedTriangle(R[_],R[C],M)>=-w||C!==v&&this.signedTriangle(R[C],R[v],M)>=-w||v!==b&&this.signedTriangle(R[v],R[b],M)>=-w||b!==g&&this.signedTriangle(R[b],R[g],M)>=-w)&&T.push({i:e,c:M});for(S=T.length,n=0,s=T[0].c[1],a=T[0].c[2],e=1;e<S;e++)(T[e].c[2]<a||T[e].c[2]===a&&T[e].c[1]<s)&&(s=T[e].c[1],a=T[e].c[2],n=e);for(T=c.A.swap(T,n,0),r=T[0].c,T.sort((function(t,e){var i=t.c,n=e.c,s=P.signedTriangle(r,i,n);return 0===s?o.A.hypot(i[1]-r[1],i[2]-r[2])-o.A.hypot(n[1]-r[1],n[2]-r[2]):-s})),i=0,e=0;e<S;e++){for(;i>1&&this.signedTriangle(O[i-2].c,O[i-1].c,T[e].c)<=0;)O.pop(),i--;O.push(T[e]),i++}return O},convexHull:function(t,e){var i,r,n=[];for(r=this.GrahamScan(t),i=0;i<r.length;i++)e?n.push(r[i].c):n.push(t[r[i].i]);return n},isConvex:function(t){var e,i,r,s,a,l,u,d,p,f,m,g=o.A.eps*o.A.eps,_=0;if(c.A.isArray(t)?e=h.A.each(t,h.A.coordsArray):c.A.exists(t.type)&&t.type===n.A.OBJECT_TYPE_POLYGON&&(e=h.A.each(t.vertices,h.A.coordsArray)),0===(i=e.length))return!0;if(i<3)return!0;for(m=null,s=e[i-2][1],a=e[i-2][2],u=e[i-1][1],d=e[i-1][2],p=Math.atan2(d-a,u-s),r=0;r<i;r++)if(s=u,a=d,l=p,u=e[r][1],d=e[r][2],s!==u||a!==d){if((f=(p=Math.atan2(d-a,u-s))-l)<=-Math.PI?f+=2*Math.PI:f>Math.PI&&(f-=2*Math.PI),null===m){if(0===f)continue;m=f>0?1:-1}else if(m*f<-g)return!1;_+=f}return Math.abs(_/(2*Math.PI))-1<g},calcStraight:function(t,e,i,r){var s,a,l,h,u,d,p,f,m,g;if(c.A.exists(r)||(r=10),d=t.evalVisProp("straightfirst"),p=t.evalVisProp("straightlast"),Math.abs(e.scrCoords[0])<o.A.eps&&(d=!0),Math.abs(i.scrCoords[0])<o.A.eps&&(p=!0),(d||p)&&((f=[])[0]=t.stdform[0]-t.stdform[1]*t.board.origin.scrCoords[1]/t.board.unitX+t.stdform[2]*t.board.origin.scrCoords[2]/t.board.unitY,f[1]=t.stdform[1]/t.board.unitX,f[2]=-t.stdform[2]/t.board.unitY,!isNaN(f[0]+f[1]+f[2]))){if(s=!d&&Math.abs(e.usrCoords[0])>=o.A.eps&&e.scrCoords[1]>=0&&e.scrCoords[1]<=t.board.canvasWidth&&e.scrCoords[2]>=0&&e.scrCoords[2]<=t.board.canvasHeight,a=!p&&Math.abs(i.usrCoords[0])>=o.A.eps&&i.scrCoords[1]>=0&&i.scrCoords[1]<=t.board.canvasWidth&&i.scrCoords[2]>=0&&i.scrCoords[2]<=t.board.canvasHeight,h=(l=this.meetLineBoard(f,t.board,r))[0],u=l[1],!s&&!a){if(!d&&p&&!this.isSameDirection(e,i,h)&&!this.isSameDirection(e,i,u))return;if(d&&!p&&!this.isSameDirection(i,e,h)&&!this.isSameDirection(i,e,u))return}s?a||(g=this.isSameDir(e,i,h,u)?u:h):a?m=this.isSameDir(e,i,h,u)?h:u:this.isSameDir(e,i,h,u)?(m=h,g=u):(g=h,m=u),m&&e.setCoordinates(n.A.COORDS_BY_USER,m.usrCoords),g&&i.setCoordinates(n.A.COORDS_BY_USER,g.usrCoords)}},calcLineDelimitingPoints:function(t,e,i){var r,s,a,l,c,h,u,d,p,f,m;if(c=t.evalVisProp("straightfirst"),h=t.evalVisProp("straightlast"),Math.abs(e.scrCoords[0])<o.A.eps&&(c=!0),Math.abs(i.scrCoords[0])<o.A.eps&&(h=!0),(u=[])[0]=t.stdform[0]-t.stdform[1]*t.board.origin.scrCoords[1]/t.board.unitX+t.stdform[2]*t.board.origin.scrCoords[2]/t.board.unitY,u[1]=t.stdform[1]/t.board.unitX,u[2]=-t.stdform[2]/t.board.unitY,!isNaN(u[0]+u[1]+u[2])){if(f=!c,m=!h,s=t.board.getBoundingBox(),t.getSlope()>=0?(a=this.projectPointToLine({coords:{usrCoords:[1,s[2],s[1]]}},t,t.board),l=this.projectPointToLine({coords:{usrCoords:[1,s[0],s[3]]}},t,t.board)):(a=this.projectPointToLine({coords:{usrCoords:[1,s[0],s[1]]}},t,t.board),l=this.projectPointToLine({coords:{usrCoords:[1,s[2],s[3]]}},t,t.board)),!f&&!m){if(!c&&!h){if(r=e.distance(n.A.COORDS_BY_USER,i),Math.abs(e.distance(n.A.COORDS_BY_USER,a)+a.distance(n.A.COORDS_BY_USER,i)-r)>o.A.eps)return;if(Math.abs(e.distance(n.A.COORDS_BY_USER,l)+l.distance(n.A.COORDS_BY_USER,i)-r)>o.A.eps)return}if(!c&&h&&!this.isSameDirection(e,i,a)&&!this.isSameDirection(e,i,l))return;if(c&&!h&&!this.isSameDirection(i,e,a)&&!this.isSameDirection(i,e,l))return}f?m||(p=this.isSameDir(e,i,a,l)?l:a):m?d=this.isSameDir(e,i,a,l)?a:l:this.isSameDir(e,i,a,l)?(d=a,p=l):(p=a,d=l),d&&e.setCoordinates(n.A.COORDS_BY_USER,d.usrCoords),p&&i.setCoordinates(n.A.COORDS_BY_USER,p.usrCoords)}},calcLabelQuadrant:function(t){return t<0&&(t+=2*Math.PI),["rt","urt","top","ulft","lft","llft","lrt"][Math.floor((t+Math.PI/8)/(Math.PI/4))%8]},isSameDir:function(t,e,i,r){var n=e.usrCoords[1]-t.usrCoords[1],s=e.usrCoords[2]-t.usrCoords[2],a=r.usrCoords[1]-i.usrCoords[1],l=r.usrCoords[2]-i.usrCoords[2];return Math.abs(e.usrCoords[0])<o.A.eps&&(n=e.usrCoords[1],s=e.usrCoords[2]),Math.abs(t.usrCoords[0])<o.A.eps&&(n=-t.usrCoords[1],s=-t.usrCoords[2]),n*a+s*l>=0},isSameDirection:function(t,e,i){var r,n,s,a,l=!1;return r=e.usrCoords[1]-t.usrCoords[1],n=e.usrCoords[2]-t.usrCoords[2],s=i.usrCoords[1]-t.usrCoords[1],a=i.usrCoords[2]-t.usrCoords[2],Math.abs(r)<o.A.eps&&(r=0),Math.abs(n)<o.A.eps&&(n=0),Math.abs(s)<o.A.eps&&(s=0),Math.abs(a)<o.A.eps&&(a=0),(r>=0&&s>=0||r<=0&&s<=0)&&(l=n>=0&&a>=0||n<=0&&a<=0),l},det3p:function(t,e,i){var r,n,s;return r=c.A.isPoint(t)?t.Coords(!0):t,n=c.A.isPoint(e)?e.Coords(!0):e,s=c.A.isPoint(i)?i.Coords(!0):i,(r[1]-s[1])*(n[2]-s[2])-(n[1]-s[1])*(r[2]-s[2])},windingNumber:function(t,e,i){var r,n,s,a,l,h,u=0,d=e.length,p=t[1],f=t[2],m=0;if(0===d)return 0;if((i=i||!1)&&(m=1),isNaN(p)||isNaN(f))return 1;if(c.A.exists(e[0].coords)?(r=e[0].coords,n=e[d-1].coords):(r=e[0],n=e[d-1]),r.usrCoords[1]===p&&r.usrCoords[2]===f)return 1;for(h=0;h<d-m;h++)if(c.A.exists(e[h].coords)?(n=e[h].coords.usrCoords,s=e[(h+1)%d].coords.usrCoords):(n=e[h].usrCoords,s=e[(h+1)%d].usrCoords),!(0===n[0]||0===s[0]||isNaN(n[1])||isNaN(s[1])||isNaN(n[2])||isNaN(s[2]))){if(s[2]===f){if(s[1]===p)return 1;if(n[2]===f&&s[1]>p==n[1]<p)return 0}if(n[2]<f!=s[2]<f)if(l=2*(s[2]>n[2]?1:0)-1,n[1]>=p)if(s[1]>p)u+=l;else{if(0===(a=this.det3p(n,s,t)))return 0;a>0+o.A.eps==s[2]>n[2]&&(u+=l)}else s[1]>p&&(a=this.det3p(n,s,t))>0+o.A.eps==s[2]>n[2]&&(u+=l)}return u},pnpoly:function(t,e,i,r,o){var a,l,h,u,d,p,f,m,g=i,_=!1;for(r===n.A.COORDS_BY_USER?(p=(m=new s.A(n.A.COORDS_BY_USER,[t,e],o)).scrCoords[1],f=m.scrCoords[2]):(p=t,f=e),a=0,l=(d=i.length)-2;a<d-1;l=a++)h=c.A.exists(g[a].coords)?g[a].coords:g[a],u=c.A.exists(g[l].coords)?g[l].coords:g[l],h.scrCoords[2]>f!=u.scrCoords[2]>f&&p<(u.scrCoords[1]-h.scrCoords[1])*(f-h.scrCoords[2])/(u.scrCoords[2]-h.scrCoords[2])+h.scrCoords[1]&&(_=!_);return _},intersectionFunction:function(t,e,i,a,l,h){var u,d,p=this;return u=e.elementClass===n.A.OBJECT_CLASS_CURVE&&(e.type===n.A.OBJECT_TYPE_ARC||e.type===n.A.OBJECT_TYPE_SECTOR),d=i.elementClass===n.A.OBJECT_CLASS_CURVE&&(i.type===n.A.OBJECT_TYPE_ARC||i.type===n.A.OBJECT_TYPE_SECTOR),e.elementClass!==n.A.OBJECT_CLASS_CURVE&&i.elementClass!==n.A.OBJECT_CLASS_CURVE||e.elementClass!==n.A.OBJECT_CLASS_CURVE&&e.elementClass!==n.A.OBJECT_CLASS_CIRCLE||i.elementClass!==n.A.OBJECT_CLASS_CURVE&&i.elementClass!==n.A.OBJECT_CLASS_CIRCLE?e.elementClass===n.A.OBJECT_CLASS_CURVE&&!u&&i.elementClass===n.A.OBJECT_CLASS_LINE||i.elementClass===n.A.OBJECT_CLASS_CURVE&&!d&&e.elementClass===n.A.OBJECT_CLASS_LINE?function(){return p.meetCurveLine(e,i,a,e.board,c.A.evaluate(h))}:e.type===n.A.OBJECT_TYPE_POLYGON||i.type===n.A.OBJECT_TYPE_POLYGON?e.elementClass===n.A.OBJECT_CLASS_LINE?function(){var t,r=e.evalVisProp("straightfirst"),n=e.evalVisProp("straightlast"),s=i.evalVisProp("straightfirst"),o=i.evalVisProp("straightlast");return t=!(c.A.evaluate(h)||r&&n&&s&&o),p.meetPolygonLine(i,e,a,e.board,t)}:i.elementClass===n.A.OBJECT_CLASS_LINE?function(){var t,r=e.evalVisProp("straightfirst"),n=e.evalVisProp("straightlast"),s=i.evalVisProp("straightfirst"),o=i.evalVisProp("straightlast");return t=!(c.A.evaluate(h)||r&&n&&s&&o),p.meetPolygonLine(e,i,a,e.board,t)}:function(){return p.meetPathPath(e,i,a,e.board)}:e.elementClass===n.A.OBJECT_CLASS_LINE&&i.elementClass===n.A.OBJECT_CLASS_LINE?function(){var t,r,o=e.evalVisProp("straightfirst"),l=e.evalVisProp("straightlast"),u=i.evalVisProp("straightfirst"),d=i.evalVisProp("straightlast");return c.A.evaluate(h)||o&&l&&u&&d?p.meet(e.stdform,i.stdform,a,e.board):(t=p.meetSegmentSegment(e.point1.coords.usrCoords,e.point2.coords.usrCoords,i.point1.coords.usrCoords,i.point2.coords.usrCoords),r=!o&&t[1]<0||!l&&t[1]>1||!u&&t[2]<0||!d&&t[2]>1?[0,NaN,NaN]:t[0],new s.A(n.A.COORDS_BY_USER,r,e.board))}:function(){var t,l,f,m=p.meet(e.stdform,i.stdform,a,e.board),g=!0;return c.A.evaluate(h)?m:e.elementClass===n.A.OBJECT_CLASS_LINE&&(t=e.evalVisProp("straightfirst"),l=e.evalVisProp("straightlast"),(!t||!l)&&(f=p.affineRatio(e.point1.coords,e.point2.coords,m),!l&&f>1+o.A.eps||!t&&f<0-o.A.eps))||i.elementClass===n.A.OBJECT_CLASS_LINE&&(t=i.evalVisProp("straightfirst"),l=i.evalVisProp("straightlast"),(!t||!l)&&(f=p.affineRatio(i.point1.coords,i.point2.coords,m),!l&&f>1+o.A.eps||!t&&f<0-o.A.eps))||u&&((g=p.coordsOnArc(e,m))&&d&&(g=p.coordsOnArc(i,m)),!g)?new s.A(r.A.COORDS_BY_USER,[0,NaN,NaN],e.board):m}:function(){return p.meetCurveCurve(e,i,a,l,e.board)}},otherIntersectionFunction:function(t,e,i,s){var o,a,l,h=this;return a=t[0],l=t[1],o=a.board,function(){var t,u,d,p,f=e.length,m=c.A.evaluate(s);for(t=f;t>=0;t--){for(a.elementClass===n.A.OBJECT_CLASS_CIRCLE&&[n.A.OBJECT_CLASS_CIRCLE,n.A.OBJECT_CLASS_LINE].indexOf(l.elementClass)>=0?d=h.meet(a.stdform,l.stdform,t,o):a.elementClass===n.A.OBJECT_CLASS_CURVE&&[n.A.OBJECT_CLASS_CURVE,n.A.OBJECT_CLASS_CIRCLE].indexOf(l.elementClass)>=0?d=h.meetCurveCurve(a,l,t,0,o,"segment"):a.elementClass===n.A.OBJECT_CLASS_CURVE&&l.elementClass===n.A.OBJECT_CLASS_LINE&&(d=c.A.exists(a.dataX)?r.A.Math.Geometry.meetCurveLine(a,l,t,a.board,c.A.evaluate(i)):r.A.Math.Geometry.meetCurveLineContinuous(a,l,t,a.board)),p=!1,u=0;!p&&u<f;u++)d.distance(r.A.COORDS_BY_USER,e[u].coords)<m&&(p=!0);if(!p)return d}return d}},coordsOnArc:function(t,e){var i=this.rad(t.radiuspoint,t.center,e.usrCoords.slice(1)),r=0,n=this.rad(t.radiuspoint,t.center,t.anglepoint),s=t.evalVisProp("selection");return("minor"===s&&n>Math.PI||"major"===s&&n<Math.PI)&&(r=n,n=2*Math.PI),!(i<r||i>n)},meet:function(t,e,i,r){var n=o.A.eps;return Math.abs(t[3])<n&&Math.abs(e[3])<n?this.meetLineLine(t,e,i,r):Math.abs(t[3])>=n&&Math.abs(e[3])<n?this.meetLineCircle(e,t,i,r):Math.abs(t[3])<n&&Math.abs(e[3])>=n?this.meetLineCircle(t,e,i,r):this.meetCircleCircle(t,e,i,r)},meetLineBoard:function(t,e,i){var r,a,l,h,u=[];for(c.A.exists(i)||(i=0),u[0]=o.A.crossProduct(t,[i,0,1]),u[1]=o.A.crossProduct(t,[i,1,0]),u[2]=o.A.crossProduct(t,[-i-e.canvasHeight,0,1]),u[3]=o.A.crossProduct(t,[-i-e.canvasWidth,1,0]),l=0;l<4;l++)if(Math.abs(u[l][0])>o.A.eps){for(h=2;h>0;h--)u[l][h]/=u[l][0];u[l][0]=1}return Math.abs(u[1][0])<o.A.eps?(r=u[0],a=u[2]):Math.abs(u[0][0])<o.A.eps?(r=u[1],a=u[3]):u[1][2]<0?(r=u[0],a=u[3][2]>e.canvasHeight?u[2]:u[3]):u[1][2]>e.canvasHeight?(r=u[2],a=u[3][2]<0?u[0]:u[3]):(r=u[1],a=u[3][2]<0?u[0]:u[3][2]>e.canvasHeight?u[2]:u[3]),[new s.A(n.A.COORDS_BY_SCREEN,r.slice(1),e),new s.A(n.A.COORDS_BY_SCREEN,a.slice(1),e)]},meetLineLine:function(t,e,i,r){var a=isNaN(t[5]+e[5])?[0,0,0]:o.A.crossProduct(t,e);return Math.abs(a[0])<1e-14&&(a[0]=0),new s.A(n.A.COORDS_BY_USER,a,r)},meetLineCircle:function(t,e,i,r){var a,l,h,u,d,p,f,m,g;return e[4]<o.A.eps?Math.abs(o.A.innerProduct([1,e[6],e[7]],t,3))<o.A.eps?new s.A(n.A.COORDS_BY_USER,e.slice(6,8),r):new s.A(n.A.COORDS_BY_USER,[NaN,NaN],r):(h=e[0],l=e.slice(1,3),a=e[3],u=t[0],d=t.slice(1,3),p=a,(m=(f=l[0]*d[1]-l[1]*d[0])*f-4*p*(a*u*u-(l[0]*d[0]+l[1]*d[1])*u+h))>-o.A.eps*o.A.eps?(g=[(-f+(m=Math.sqrt(Math.abs(m))))/(2*p),(-f-m)/(2*p)],0===c.A.evaluate(i)?new s.A(n.A.COORDS_BY_USER,[-g[0]*-d[1]-u*d[0],-g[0]*d[0]-u*d[1]],r):new s.A(n.A.COORDS_BY_USER,[-g[1]*-d[1]-u*d[0],-g[1]*d[0]-u*d[1]],r)):new s.A(n.A.COORDS_BY_USER,[0,0,0],r))},meetCircleCircle:function(t,e,i,r){var a;return t[4]<o.A.eps?Math.abs(this.distance(t.slice(6,2),e.slice(6,8))-e[4])<o.A.eps?new s.A(n.A.COORDS_BY_USER,t.slice(6,8),r):new s.A(n.A.COORDS_BY_USER,[0,0,0],r):e[4]<o.A.eps?Math.abs(this.distance(e.slice(6,2),t.slice(6,8))-t[4])<o.A.eps?new s.A(n.A.COORDS_BY_USER,e.slice(6,8),r):new s.A(n.A.COORDS_BY_USER,[0,0,0],r):(a=[e[3]*t[0]-t[3]*e[0],e[3]*t[1]-t[3]*e[1],e[3]*t[2]-t[3]*e[2],0,1,1/0,1/0,1/0],a=o.A.normalize(a),this.meetLineCircle(a,t,i,r))},meetCurveCurve:function(t,e,i,r,o,a){var h;return h=c.A.exists(a)&&"newton"===a?l.A.generalizedNewton(t,e,c.A.evaluate(i),r):3===t.bezierDegree||3===e.bezierDegree?this.meetBezierCurveRedBlueSegments(t,e,i):this.meetCurveRedBlueSegments(t,e,i),new s.A(n.A.COORDS_BY_USER,h,o)},meetCurveLine:function(t,e,i,r,s){var o,a;return c.A.exists(r)||(r=t.board),t.elementClass===n.A.OBJECT_CLASS_CURVE?(o=t,a=e):(o=e,a=t),this.meetCurveLineDiscrete(o,a,i,r,!s)},meetCurveLineContinuous:function(t,e,i,r,a){var c,h,u,d,p,f,m,g,_,v,y,b,A,x=o.A.eps,C=o.A.eps;for(d=this.meetCurveLineDiscrete(t,e,i,r,a),p=d.usrCoords[1],f=d.usrCoords[2],c=function(e){var i,r;return e>t.maxX()||e<t.minX()?1/0:(i=t.X(e)-p)*i+(r=t.Y(e)-f)*r},h=function(i){var r=e.stdform[0]+e.stdform[1]*t.X(i)+e.stdform[2]*t.Y(i);return r*r},g=(t.maxX()-t.minX())/50,_=t.minX(),y=1e-4,v=NaN,b=0;b<50&&(u=l.A.root(c,[Math.max(_,t.minX()),Math.min(_+g,t.maxX())]),!((A=Math.abs(c(u)))<=y&&(v=u,(y=A)<x)));b++)_+=g;return u=v,A=h(u=l.A.root(h,[Math.max(u-g,t.minX()),Math.min(u+g,t.maxX())])),m=isNaN(A)||Math.abs(A)>C?0:1,new s.A(n.A.COORDS_BY_USER,[m,t.X(u),t.Y(u)],r)},meetCurveLineDiscrete:function(t,e,i,r,a){var l,h,u,d,p,f,m,g=c.A.evaluate(i),_=e.point1.coords.usrCoords,v=e.point2.coords.usrCoords,y=0,b=t.numberPoints,A=e.evalVisProp("straightfirst"),x=e.evalVisProp("straightlast");for(f=new s.A(n.A.COORDS_BY_USER,[0,NaN,NaN],r),0===_[0]?_=[1,v[1]+e.stdform[2],v[2]-e.stdform[1]]:0===v[0]&&(v=[1,_[1]+e.stdform[2],_[2]-e.stdform[1]]),d=t.points[0].usrCoords,l=1;l<b;l+=t.bezierDegree)if(u=d.slice(0),d=t.points[l].usrCoords,this.distance(u,d)>o.A.eps)for(m=3===t.bezierDegree?this.meetBeziersegmentBeziersegment([t.points[l-1].usrCoords.slice(1),t.points[l].usrCoords.slice(1),t.points[l+1].usrCoords.slice(1),t.points[l+2].usrCoords.slice(1)],[_.slice(1),v.slice(1)],a):[this.meetSegmentSegment(u,d,_,v)],h=0;h<m.length;h++)if(0<=(p=m[h])[1]&&p[1]<=1){if(y===g)return a&&(!A&&p[2]<0||!x&&p[2]>1)?f:f=new s.A(n.A.COORDS_BY_USER,p[0],r);y+=1}return f},meetCurveRedBlueSegments:function(t,e,i){var r,n,s,o,a,l,h,u,d,p=c.A.evaluate(i),f=0,m=e.numberPoints,g=t.numberPoints;if(m<=1||g<=1)return[0,NaN,NaN];for(r=1;r<g;r++)for(s=t.points[r-1].usrCoords,o=t.points[r].usrCoords,u=Math.min(s[1],o[1]),d=Math.max(s[1],o[1]),l=e.points[0].usrCoords,n=1;n<m;n++)if(a=l,l=e.points[n].usrCoords,Math.min(a[1],l[1])<d&&Math.max(a[1],l[1])>u&&(h=this.meetSegmentSegment(s,o,a,l))[1]>=0&&h[2]>=0&&(h[1]<1&&h[2]<1||r===g-1&&1===h[1]||n===m-1&&1===h[2])){if(f===p)return h[0];f++}return[0,NaN,NaN]},meetSegmentSegment:function(t,e,i,r){var n,s,a,l=o.A.crossProduct(t,e),c=o.A.crossProduct(i,r),h=o.A.crossProduct(l,c);return Math.abs(h[0])<o.A.eps?[h,1/0,1/0]:(h[1]/=h[0],h[2]/=h[0],h[0]/=h[0],a=t[s=Math.abs(e[1]-e[0]*t[1])<o.A.eps?2:1]/t[0],n=(h[s]-a)/(0!==e[0]?e[s]/e[0]-a:e[s]),a=i[s=Math.abs(r[1]-r[0]*i[1])<o.A.eps?2:1]/i[0],[h,n,(h[s]-a)/(0!==r[0]?r[s]/r[0]-a:r[s])])},meetPathPath:function(t,e,i,a){var l,h,u,d,p=c.A.evaluate(i);return(u=(l=r.A.Math.Clip._getPath(t,a)).length)>0&&this.distance(l[0].coords.usrCoords,l[u-1].coords.usrCoords,3)<o.A.eps&&l.pop(),(u=(h=r.A.Math.Clip._getPath(e,a)).length)>0&&this.distance(h[0].coords.usrCoords,h[u-1].coords.usrCoords,3)<o.A.eps*o.A.eps&&h.pop(),i<0||r.A.Math.Clip.isEmptyCase(l,h,"intersection")?new s.A(n.A.COORDS_BY_USER,[0,0,0],a):(r.A.Math.Clip.makeDoublyLinkedList(l),r.A.Math.Clip.makeDoublyLinkedList(h),p<(d=r.A.Math.Clip.findIntersections(l,h,a)[0]).length?d[p].coords:new s.A(n.A.COORDS_BY_USER,[0,0,0],a))},meetPolygonLine:function(t,e,i,r,o){var a,l,h,u=c.A.evaluate(i),d=[0,0,0],p=t.borders.length,f=[];for(a=0;a<p;a++)h=t.borders[a],l=this.meetSegmentSegment(h.point1.coords.usrCoords,h.point2.coords.usrCoords,e.point1.coords.usrCoords,e.point2.coords.usrCoords),(!o||l[2]>=0&&l[2]<1)&&l[1]>=0&&l[1]<1&&f.push(l[0]);return u>=0&&u<f.length&&(d=f[u]),new s.A(n.A.COORDS_BY_USER,d,r)},_bezierSplit:function(t){var e,i,r,n,s,o;return e=[.5*(t[0][0]+t[1][0]),.5*(t[0][1]+t[1][1])],i=[.5*(t[1][0]+t[2][0]),.5*(t[1][1]+t[2][1])],r=[.5*(t[2][0]+t[3][0]),.5*(t[2][1]+t[3][1])],o=[.5*((n=[.5*(e[0]+i[0]),.5*(e[1]+i[1])])[0]+(s=[.5*(i[0]+r[0]),.5*(i[1]+r[1])])[0]),.5*(n[1]+s[1])],[[t[0],e,n,o],[o,s,r,t[3]]]},_bezierBbox:function(t){var e=[];return 4===t.length?(e[0]=Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),e[1]=Math.max(t[0][1],t[1][1],t[2][1],t[3][1]),e[2]=Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),e[3]=Math.min(t[0][1],t[1][1],t[2][1],t[3][1])):(e[0]=Math.min(t[0][0],t[1][0]),e[1]=Math.max(t[0][1],t[1][1]),e[2]=Math.max(t[0][0],t[1][0]),e[3]=Math.min(t[0][1],t[1][1])),e},_bezierOverlap:function(t,e){return t[2]>=e[0]&&t[0]<=e[2]&&t[1]>=e[3]&&t[3]<=e[1]},_bezierListConcat:function(t,e,i,r){var n,s=c.A.exists(r),o=0,a=e.length,l=t.length;for(l>0&&a>0&&(1===t[l-1][1]&&0===e[0][1]||s&&1===t[l-1][2]&&0===e[0][2])&&(o=1),n=o;n<a;n++)s&&(e[n][2]*=.5,e[n][2]+=r),e[n][1]*=.5,e[n][1]+=i,t.push(e[n])},_bezierMeetSubdivision:function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p,f,m=[];return n=this._bezierBbox(e),r=this._bezierBbox(t),this._bezierOverlap(n,r)?i<5?(l=(s=this._bezierSplit(t))[0],c=s[1],o=(s=this._bezierSplit(e))[0],a=s[1],this._bezierListConcat(m,this._bezierMeetSubdivision(l,o,i+1),0,0),this._bezierListConcat(m,this._bezierMeetSubdivision(l,a,i+1),0,.5),this._bezierListConcat(m,this._bezierMeetSubdivision(c,o,i+1),.5,0),this._bezierListConcat(m,this._bezierMeetSubdivision(c,a,i+1),.5,.5),m):(p=[1].concat(t[0]),f=[1].concat(t[3]),u=[1].concat(e[0]),d=[1].concat(e[3]),(h=this.meetSegmentSegment(p,f,u,d))[1]>=0&&h[2]>=0&&h[1]<=1&&h[2]<=1?[h]:[]):[]},_bezierLineMeetSubdivision:function(t,e,i,r){var n,s,o,a,l,c,h,u,d,p,f=[];return n=this._bezierBbox(e),s=this._bezierBbox(t),r&&!this._bezierOverlap(s,n)?[]:i<5?(a=(o=this._bezierSplit(t))[0],l=o[1],this._bezierListConcat(f,this._bezierLineMeetSubdivision(a,e,i+1),0),this._bezierListConcat(f,this._bezierLineMeetSubdivision(l,e,i+1),.5),f):(d=[1].concat(t[0]),p=[1].concat(t[3]),h=[1].concat(e[0]),u=[1].concat(e[1]),(c=this.meetSegmentSegment(d,p,h,u))[1]>=0&&c[1]<=1&&(!r||c[2]>=0&&c[2]<=1)?[c]:[])},meetBeziersegmentBeziersegment:function(t,e,i){var r,n,s;for((r=4===t.length&&4===e.length?this._bezierMeetSubdivision(t,e,0):this._bezierLineMeetSubdivision(t,e,0,i)).sort((function(t,e){return 1e7*(t[1]-e[1])+(t[2]-e[2])})),n=[],s=0;s<r.length;s++)0!==s&&r[s][1]===r[s-1][1]&&r[s][2]===r[s-1][2]||n.push(r[s]);return n},meetBezierCurveRedBlueSegments:function(t,e,i){var r,s,a,l,h,u,d,p,f,m,g,_,v,y=c.A.evaluate(i),b=0,A=0,x=[];if(e.numberPoints<e.bezierDegree+1||t.numberPoints<t.bezierDegree+1)return[0,NaN,NaN];for(1===t.bezierDegree&&3===e.bezierDegree&&(u=t,t=e,e=u),_=e.numberPoints-e.bezierDegree,v=t.numberPoints-t.bezierDegree,t.type===n.A.OBJECT_TYPE_SECTOR&&(b=3,v-=3),e.type===n.A.OBJECT_TYPE_SECTOR&&(A=3,_-=3),s=b;s<v;s+=t.bezierDegree)for(d=[(r=t.points)[s].usrCoords.slice(1),r[s+1].usrCoords.slice(1)],3===t.bezierDegree&&(d[2]=r[s+2].usrCoords.slice(1),d[3]=r[s+3].usrCoords.slice(1)),f=this._bezierBbox(d),a=A;a<_;a+=e.bezierDegree)if(p=[(r=e.points)[a].usrCoords.slice(1),r[a+1].usrCoords.slice(1)],3===e.bezierDegree&&(p[2]=r[a+2].usrCoords.slice(1),p[3]=r[a+3].usrCoords.slice(1)),m=this._bezierBbox(p),this._bezierOverlap(f,m)){if(0===(g=this.meetBeziersegmentBeziersegment(d,p)).length)continue;for(l=0;l<g.length;l++)(h=g[l])[1]<-o.A.eps||h[1]>1+o.A.eps||h[2]<-o.A.eps||h[2]>1+o.A.eps||x.push(h);if(x.length>y)return x[y][0]}return x.length>y?x[y][0]:[0,NaN,NaN]},bezierSegmentEval:function(t,e){var i,r,n,s=1-t;return r=0,n=0,r+=(i=s*s*s)*e[0][0],n+=i*e[0][1],r+=(i=3*t*s*s)*e[1][0],n+=i*e[1][1],r+=(i=3*t*t*s)*e[2][0],n+=i*e[2][1],[1,r+=(i=t*t*t)*e[3][0],n+=i*e[3][1]]},bezierArc:function(t,e,i,r,n){var s,a,l,h,u,d,p,f,m,g,_,v,y,b,A,x,C,E,M=e[1],S=e[2],w=e[0],P=[],T=[];for(u=this.distance(e,t),M/=w,S/=w,d=this.rad(t.slice(1),e.slice(1),i.slice(1)),-1===n&&(d=2*Math.PI-d),f=d/4,(s=t)[1]/=s[0],s[2]/=s[0],s[0]/=s[0],h=s.slice(0),r?(P=[M,M+.333*(s[1]-M),M+.666*(s[1]-M),s[1]],T=[S,S+.333*(s[2]-S),S+.666*(s[2]-S),s[2]]):(P=[s[1]],T=[s[2]]);d>o.A.eps;)d>f?(p=f,d-=f):(p=d,d=0),E=[[1,0,0],[M*(1-(m=Math.cos(n*p)))+S*(g=Math.sin(n*p)),m,-g],[S*(1-m)-M*g,g,m]],h=[(x=o.A.matVecMult(E,s))[0]/x[0],x[1]/x[0],x[2]/x[0]],_=s[1]-M,v=s[2]-S,y=h[1]-M,b=h[2]-S,C=o.A.hypot(_+y,v+b),A=Math.abs(b-v)>o.A.eps?(_+y)*(u/C-.5)/(b-v)*8/3:(v+b)*(u/C-.5)/(_-y)*8/3,a=[1,s[1]-A*v,s[2]+A*_],l=[1,h[1]+A*b,h[2]-A*y],c.A.concat(P,[a[1],l[1],h[1]]),c.A.concat(T,[a[2],l[2],h[2]]),s=h.slice(0);return r&&(c.A.concat(P,[h[1]+.333*(M-h[1]),h[1]+.666*(M-h[1]),M]),c.A.concat(T,[h[2]+.333*(S-h[2]),h[2]+.666*(S-h[2]),S])),[P,T]},projectPointToCircle:function(t,e,i){var r,a,l,h,u,d=e.center.coords.usrCoords;return c.A.exists(i)||(i=t.board),c.A.isPoint(t)?(r=t.coords.distance(n.A.COORDS_BY_USER,e.center.coords),a=t.coords.usrCoords):(r=t.distance(n.A.COORDS_BY_USER,e.center.coords),a=t.usrCoords),Math.abs(r)<o.A.eps&&(r=o.A.eps),u=e.Radius()/r,l=d[1]+u*(a[1]-d[1]),h=d[2]+u*(a[2]-d[2]),new s.A(n.A.COORDS_BY_USER,[l,h],i)},projectPointToLine:function(t,e,i){var r,a=[0,e.stdform[1],e.stdform[2]];return c.A.exists(i)||(i=c.A.exists(t.coords)?t.board:e.board),r=c.A.exists(t.coords)?t.coords.usrCoords:t.usrCoords,a=o.A.crossProduct(a,r),new s.A(n.A.COORDS_BY_USER,o.A.crossProduct(a,e.stdform),i)},projectCoordsToSegment:function(t,e,i){var r,n=[i[1]-e[1],i[2]-e[2]],s=[t[1]-e[1],t[2]-e[2]];return Math.abs(n[0])<o.A.eps&&Math.abs(n[1])<o.A.eps?[e,0]:(r=o.A.innerProduct(s,n),[[1,(r/=o.A.innerProduct(n,n))*n[0]+e[1],r*n[1]+e[2]],r])},projectCoordsToBeziersegment:function(t,e,i){var n;return n=r.A.Math.Numerics.fminbr((function(r){var n=[1,e.X(i+r),e.Y(i+r)];return n[1]-=t[1],n[2]-=t[2],n[1]*n[1]+n[2]*n[2]}),[0,1]),[[1,e.X(n+i),e.Y(n+i)],n]},projectPointToCurve:function(t,e,i){c.A.exists(i)||(i=t.board);var r=t.X(),n=t.Y(),s=t.position;return c.A.exists(s)||(s="functiongraph"===e.evalVisProp("curvetype")?r:0),this.projectCoordsToCurve(r,n,s,e,i)},projectCoordsToCurve:function(t,e,i,r,o){var a,h,u,d,p,f,m,g,_,v,y,b,A,x,C,E,M,S,w,P,T,O,R,N,L,D=Number.POSITIVE_INFINITY;if(c.A.exists(o)||(o=r.board),"plot"===r.evalVisProp("curvetype")){if(i=0,p=D,a=0===r.numberPoints?[0,1,1]:[r.Z(0),r.X(0),r.Y(0)],r.numberPoints>1)for(g=[1,t,e],3===r.bezierDegree?d=0:y=[r.Z(0),r.X(0),r.Y(0)],u=0;u<r.numberPoints-1;u++)3===r.bezierDegree?A=this.projectCoordsToBeziersegment(g,r,d):(b=[r.Z(u+1),r.X(u+1),r.Y(u+1)],A=this.projectCoordsToSegment(g,y,b)),m=A[1],_=A[0],0<=m&&m<=1?(f=this.distance(_,g),v=u+m):m<0?(_=y,f=this.distance(y,g),v=u):m>1&&u===r.numberPoints-2&&(_=b,f=this.distance(_,g),v=r.numberPoints-1),f<p&&(p=f,i=v,a=_),3===r.bezierDegree?(d++,u+=2):y=b;h=new s.A(n.A.COORDS_BY_USER,a,o)}else{for(N=r.minX(),L=r.maxX(),O=N,R=L,"functiongraph"===r.evalVisProp("curvetype")&&(S=Math.abs(e-r.Y(t)),isNaN(S)||(O=t-S,R=t+S)),x=function(i){var n,s;return i<N||i>r.maxX_glob?1/0:(n=t-r.X(i))*n+(s=e-r.Y(i))*s},M=x(i),w=(R-O)/50,C=O,u=0;u<50;u++)((E=x(C))<M||M===1/0||isNaN(M))&&(i=C,M=E),C+=w;for(P=w,u=0;u<20&&isNaN(x(i-P));u++,P*=.5);for(isNaN(x(i-P))&&(P=0),T=w,u=0;u<20&&isNaN(x(i+T));u++,T*=.5);isNaN(x(i+T))&&(T=0),i=(i=(i=l.A.fminbr(x,[Math.max(i-P,O),Math.min(i+T,R)]))<N?N:i)>L?L:i,h=new s.A(n.A.COORDS_BY_USER,[r.X(i),r.Y(i)],o)}return[r.updateTransform(h),i]},projectCoordsToPolygon:function(t,e){var i,n,s,o,a,l=e.vertices.length,c=1/0;for(i=0;i<l-1;i++)0<=(s=r.A.Math.Geometry.projectCoordsToSegment(t,e.vertices[i].coords.usrCoords,e.vertices[i+1].coords.usrCoords))[1]&&s[1]<=1?(n=r.A.Math.Geometry.distance(s[0],t,3),o=s[0]):s[1]<0?(n=r.A.Math.Geometry.distance(e.vertices[i].coords.usrCoords,t,3),o=e.vertices[i].coords.usrCoords):(n=r.A.Math.Geometry.distance(e.vertices[i+1].coords.usrCoords,t,3),o=e.vertices[i+1].coords.usrCoords),n<c&&(a=o.slice(0),c=n);return a},projectPointToTurtle:function(t,e,i){var r,o,a,l,h,u,d,p,f,m,g=0,_=0,v=Number.POSITIVE_INFINITY,y=e.objects.length;for(c.A.exists(i)||(i=t.board),h=0;h<y;h++)(d=e.objects[h]).elementClass===n.A.OBJECT_CLASS_CURVE&&(r=(f=this.projectPointToCurve(t,d))[0],m=f[1],(u=this.distance(r.usrCoords,t.coords.usrCoords))<v&&(a=r.usrCoords[1],l=r.usrCoords[2],o=m,v=u,p=d,_=g),g+=d.numberPoints);return r=new s.A(n.A.COORDS_BY_USER,[a,l],i),[p.updateTransform(r),o+_]},projectPointToPoint:function(t,e){return e.coords},projectPointToBoard:function(t,e){var i,r,n,s=e||t.board,a=[[1,1,0,0,3,0,1],[-1,2,1,0,1,2,1],[-1,1,2,2,1,2,3],[1,2,3,0,3,2,3]],l=t.coords||t,c=s.getBoundingBox();for(i=0;i<4;i++)(n=a[i])[0]*l.usrCoords[n[1]]<n[0]*c[n[2]]&&((r=o.A.crossProduct([1,c[n[3]],c[n[4]]],[1,c[n[5]],c[n[6]]]))[3]=0,r=o.A.normalize(r),l=this.projectPointToLine({coords:l},{stdform:r},s));return l},distPointLine:function(t,e){var i,r=e[1],n=e[2],s=e[0];return Math.abs(r)+Math.abs(n)<o.A.eps?Number.POSITIVE_INFINITY:(i=r*t[1]+n*t[2]+s,r*=r,n*=n,Math.abs(i)/Math.sqrt(r+n))},distPointSegment:function(t,e,i){var r,n,s,a,l,c,h=o.A.eps*o.A.eps,u=1e6;return r=(r=t[1]-e[1])===1/0?u:r===-1/0?-u:r,n=(n=t[2]-e[2])===1/0?u:n===-1/0?-u:n,(l=(s=(s=i[1]-e[1])===1/0?u:s===-1/0?-u:s)*s+(a=(a=i[2]-e[2])===1/0?u:a===-1/0?-u:a)*a)>h&&((c=(r*s+n*a)/l)<0?c=0:c>1&&(c=1),r-=c*s,n-=c*a),o.A.hypot(r,n)},intersectionFunction3D:function(t,e,i){var r,s=this;return e.type===n.A.OBJECT_TYPE_PLANE3D?i.type===n.A.OBJECT_TYPE_PLANE3D?r=t.intersectionPlanePlane(e,i):i.type===n.A.OBJECT_TYPE_SPHERE3D&&(r=s.meetPlaneSphere(e,i)):e.type===n.A.OBJECT_TYPE_SPHERE3D&&(i.type===n.A.OBJECT_TYPE_PLANE3D?r=s.meetPlaneSphere(i,e):i.type===n.A.OBJECT_TYPE_SPHERE3D&&(r=s.meetSphereSphere(e,i))),r},meet3Planes:function(t,e,i,r,n,s){var a,l,c,h,u,d=[1,0,0,0];for(a=o.A.crossProduct(n.slice(1),t.slice(1)),l=o.A.crossProduct(t.slice(1),i.slice(1)),c=o.A.crossProduct(i.slice(1),n.slice(1)),h=o.A.innerProduct(t.slice(1),c,3),u=0;u<3;u++)d[u+1]=(e*c[u]+r*a[u]+s*l[u])/h;return d},meetPlanePlane:function(t,e,i,r){var n,s,a,l;return a=t.slice(1),l=e.slice(1),n=o.A.crossProduct(a,l),a=i.slice(1),l=r.slice(1),s=o.A.crossProduct(a,l),(l=o.A.crossProduct(n,s)).unshift(0),l},meetPlaneSphere:function(t,e){var i=function(){return o.A.innerProduct(t.normal,e.center.coords,4)-t.d};return[function(){return o.A.axpy(-i(),t.normal,e.center.coords)},t.normal,function(){var t=e.Radius(),r=i();return Math.sqrt(t*t-r*r)}]},meetSphereSphere:function(t,e){var i=function(){var i=t.center.distance(e.center),r=t.Radius(),n=e.Radius();return(r-n)*(r+n)/(i*i)};return[function(){var r=i();return[1,.5*((1-r)*t.center.coords[1]+(1+r)*e.center.coords[1]),.5*((1-r)*t.center.coords[2]+(1+r)*e.center.coords[2]),.5*((1-r)*t.center.coords[3]+(1+r)*e.center.coords[3])]},function(){return a.A.subtract(e.center.coords,t.center.coords)},function(){var r=t.center.distance(e.center),n=t.Radius(),s=e.Radius(),o=i(),a=.5*(n*n+s*s-.5*r*r*(1+o*o));return Math.sqrt(a)}]},_paramsOutOfRange:function(t,e,i){return t[0]<e[0]||t[0]>e[1]||t.length>1&&(t[1]<i[0]||t[1]>i[1])},projectCoordsToParametric:function(t,e,i,r){var n,s,a,l,h,u=.01*Math.random()+.5,d=2*i;return 1===i?n=.1*((l=[c.A.evaluate(e.range[0]),c.A.evaluate(e.range[1])])[1]-l[0]):2===i&&(l=[c.A.evaluate(e.range_u[0]),c.A.evaluate(e.range_u[1])],h=[c.A.evaluate(e.range_v[0]),c.A.evaluate(e.range_v[1])],n=.1*Math.min(l[1]-l[0],h[1]-h[0])),s=n/5e6,a=function(i,r,n,s){var o=[e.X.apply(e,n),e.Y.apply(e,n),e.Z.apply(e,n)],a=t[0]-o[0],c=t[1]-o[1],u=t[2]-o[2];return r>=2&&(s[0]=n[0]-l[0],s[1]=-n[0]+l[1]),r>=4&&(s[2]=n[1]-h[0],s[3]=-n[1]+h[1]),a*a+c*c+u*u},0===r.length&&(r[0]=u*(l[0]+l[1]),2===i&&(r[1]=u*(h[0]+h[1]))),o.A.Nlp.FindMinimum(a,i,0,r,n,s,0,200),t=[e.X.apply(e,r),e.Y.apply(e,r),e.Z.apply(e,r)],this._paramsOutOfRange(r,l,h)&&(r[0]=u*(l[0]+l[1]),2===i&&(r[1]=u*(h[0]+h[1])),o.A.Nlp.FindMinimum(a,i,d,r,n,s,0,200)),[1,e.X.apply(e,r),e.Y.apply(e,r),e.Z.apply(e,r)]},project3DTo3DPlane:function(t,e,i){var r,n;return i=i||[0,0,0],r=o.A.norm(e),n=(o.A.innerProduct(t,e,3)-o.A.innerProduct(i,e,3))/r,o.A.axpy(-n,e,t)},getPlaneBounds:function(t,e,i,r,n){var s,o,a,c,h;return t[2]+e[0]!==0?(a=[[t[0],e[0]],[t[1],e[1]]],c=[r-i[0],r-i[1]],s=(h=l.A.Gauss(a,c))[0],o=h[1],c=[n-i[0],n-i[1]],[s,(h=l.A.Gauss(a,c))[0],o,h[1]]):null},reuleauxPolygon:function(t,e){var i,r=2*Math.PI,n=r/e,s=(e-1)/2,a=0,l=function(l,c){return function(h,u){var d=(h%r+r)%r,p=Math.floor(d/n)%e;return u||(a=t[0].Dist(t[s]),i=o.A.Geometry.rad([t[0].X()+1,t[0].Y()],t[0],t[s%e])),isNaN(p)?p:(d=.5*d+p*n*.5+i,t[p][l]()+a*Math[c](d))}};return[l("X","cos"),l("Y","sin"),0,r]}});const u=o.A.Geometry},56:(t,e,i)=>{t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},72:t=>{var e=[];function i(t){for(var i=-1,r=0;r<e.length;r++)if(e[r].identifier===t){i=r;break}return i}function r(t,r){for(var s={},o=[],a=0;a<t.length;a++){var l=t[a],c=r.base?l[0]+r.base:l[0],h=s[c]||0,u="".concat(c," ").concat(h);s[c]=h+1;var d=i(u),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)e[d].references++,e[d].updater(p);else{var f=n(p,r);r.byIndex=a,e.splice(a,0,{identifier:u,updater:f,references:1})}o.push(u)}return o}function n(t,e){var i=e.domAPI(e);return i.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,n){var s=r(t=t||[],n=n||{});return function(t){t=t||[];for(var o=0;o<s.length;o++){var a=i(s[o]);e[a].references--}for(var l=r(t,n),c=0;c<s.length;c++){var h=i(s[c]);0===e[h].references&&(e[h].updater(),e.splice(h,1))}s=l}}},84:(t,e,i)=>{i.d(e,{A:()=>n});var r={};try{"object"!=typeof JXG||JXG.extend||(r=JXG)}catch(t){}r.extend=function(t,e,i,r){var n;for(n in i=i||!1,r=r||!1,e)(!i||i&&e.hasOwnProperty(n))&&(t[r?n.toLowerCase():n]=e[n])},r.defineConstant=function(t,e,i,n){(n=n||!1)&&r.exists(t[e])||Object.defineProperty(t,e,{value:i,writable:!1,enumerable:!0,configurable:!1})},r.extendConstants=function(t,e,i,r){var n,s;for(n in i=i||!1,r=r||!1,e)(!i||i&&e.hasOwnProperty(n))&&(s=r?n.toUpperCase():n,this.defineConstant(t,s,e[n]))},r.extend(r,{boards:{},readers:{},elements:{},registerElement:function(t,e){t=t.toLowerCase(),this.elements[t]=e},registerReader:function(t,e){var i,r;for(i=0;i<e.length;i++)r=e[i].toLowerCase(),"function"!=typeof this.readers[r]&&(this.readers[r]=t)},shortcut:function(t,e){return function(){return t[e].apply(this,arguments)}},getRef:function(t,e){return r.deprecated("JXG.getRef()","Board.select()"),t.select(e)},getReference:function(t,e){return r.deprecated("JXG.getReference()","Board.select()"),t.select(e)},getBoardByContainerId:function(t){var e;for(e in JXG.boards)if(JXG.boards.hasOwnProperty(e)&&JXG.boards[e].container===t)return JXG.boards[e];return null},deprecated:function(t,e){var i=t+" is deprecated.";e&&(i+=" Please use "+e+" instead."),r.warn(i)},warn:function(t){"object"==typeof window&&window.console&&console.warn?console.warn("WARNING:",t):"object"==typeof document&&document.getElementById("warning")&&(document.getElementById("debug").innerHTML+="WARNING: "+t+"<br />")},debugInt:function(t){var e,i;for(e=0;e<arguments.length;e++)i=arguments[e],"object"==typeof window&&window.console&&console.log?console.log(i):"object"==typeof document&&document.getElementById("debug")&&(document.getElementById("debug").innerHTML+=i+"<br/>")},debugWST:function(t){var e=new Error;r.debugInt.apply(this,arguments),e&&e.stack&&(r.debugInt("stacktrace"),r.debugInt(e.stack.split("\n").slice(1).join("\n")))},debugLine:function(t){var e=new Error;r.debugInt.apply(this,arguments),e&&e.stack&&r.debugInt("Called from",e.stack.split("\n").slice(2,3).join("\n"))},debug:function(t){r.debugInt.apply(this,arguments)},themes:{}});const n=r},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},156:(t,e,i)=>{i.d(e,{A:()=>o});var r,n=i(84),s="1.11.1";r={version:s,licenseText:"JSXGraph v"+s+" Copyright (C) see https://jsxgraph.org",COORDS_BY_USER:1,COORDS_BY_SCREEN:2,OBJECT_TYPE_ARC:1,OBJECT_TYPE_ARROW:2,OBJECT_TYPE_AXIS:3,OBJECT_TYPE_AXISPOINT:4,OBJECT_TYPE_TICKS:5,OBJECT_TYPE_CIRCLE:6,OBJECT_TYPE_CONIC:7,OBJECT_TYPE_CURVE:8,OBJECT_TYPE_GLIDER:9,OBJECT_TYPE_IMAGE:10,OBJECT_TYPE_LINE:11,OBJECT_TYPE_POINT:12,OBJECT_TYPE_SLIDER:13,OBJECT_TYPE_CAS:14,OBJECT_TYPE_GXTCAS:15,OBJECT_TYPE_POLYGON:16,OBJECT_TYPE_SECTOR:17,OBJECT_TYPE_TEXT:18,OBJECT_TYPE_ANGLE:19,OBJECT_TYPE_INTERSECTION:20,OBJECT_TYPE_TURTLE:21,OBJECT_TYPE_VECTOR:22,OBJECT_TYPE_OPROJECT:23,OBJECT_TYPE_GRID:24,OBJECT_TYPE_TANGENT:25,OBJECT_TYPE_HTMLSLIDER:26,OBJECT_TYPE_CHECKBOX:27,OBJECT_TYPE_INPUT:28,OBJECT_TYPE_BUTTON:29,OBJECT_TYPE_TRANSFORMATION:30,OBJECT_TYPE_FOREIGNOBJECT:31,OBJECT_TYPE_VIEW3D:32,OBJECT_TYPE_POINT3D:33,OBJECT_TYPE_LINE3D:34,OBJECT_TYPE_PLANE3D:35,OBJECT_TYPE_CURVE3D:36,OBJECT_TYPE_SURFACE3D:37,OBJECT_TYPE_MEASUREMENT:38,OBJECT_TYPE_INTERSECTION_LINE3D:39,OBJECT_TYPE_SPHERE3D:40,OBJECT_TYPE_CIRCLE3D:41,OBJECT_TYPE_INTERSECTION_CIRCLE3D:42,OBJECT_TYPE_TEXT3D:43,OBJECT_TYPE_FACE3D:44,OBJECT_TYPE_POLYHEDRON3D:45,OBJECT_TYPE_POLYGON3D:46,OBJECT_CLASS_POINT:1,OBJECT_CLASS_LINE:2,OBJECT_CLASS_CIRCLE:3,OBJECT_CLASS_CURVE:4,OBJECT_CLASS_AREA:5,OBJECT_CLASS_OTHER:6,OBJECT_CLASS_TEXT:7,OBJECT_CLASS_3D:8},n.A.extendConstants(n.A,r);const o=r},159:(t,e,i)=>{i.d(e,{A:()=>l});var r=i(84),n=i(156),s=i(805),o=i(9),a=i(174);r.A.Coords=function(t,e,i,r){this.board=i,this.usrCoords=[],this.scrCoords=[],this.emitter=!o.A.exists(r)||r,this.emitter&&s.A.eventify(this),this.setCoordinates(t,e,!1,!0)},r.A.extend(r.A.Coords.prototype,{normalizeUsrCoords:function(){Math.abs(this.usrCoords[0])>a.A.eps&&(this.usrCoords[1]/=this.usrCoords[0],this.usrCoords[2]/=this.usrCoords[0],this.usrCoords[0]=1)},usr2screen:function(t){var e=Math.round,i=this.board,r=this.usrCoords,n=i.origin.scrCoords;!0===t?(this.scrCoords[0]=e(r[0]),this.scrCoords[1]=e(r[0]*n[1]+r[1]*i.unitX),this.scrCoords[2]=e(r[0]*n[2]-r[2]*i.unitY)):(this.scrCoords[0]=r[0],this.scrCoords[1]=r[0]*n[1]+r[1]*i.unitX,this.scrCoords[2]=r[0]*n[2]-r[2]*i.unitY)},screen2usr:function(){var t=this.board.origin.scrCoords,e=this.scrCoords,i=this.board;this.usrCoords[0]=1,this.usrCoords[1]=(e[1]-t[1])/i.unitX,this.usrCoords[2]=(t[2]-e[2])/i.unitY},distance:function(t,e){var i,r,s=this.usrCoords,o=this.scrCoords;return t===n.A.COORDS_BY_USER?(i=e.usrCoords,(r=s[0]-i[0])*r>a.A.eps*a.A.eps?Number.POSITIVE_INFINITY:a.A.hypot(s[1]-i[1],s[2]-i[2])):(i=e.scrCoords,a.A.hypot(o[1]-i[1],o[2]-i[2]))},setCoordinates:function(t,e,i,r){var s=this.usrCoords,o=this.scrCoords,a=[s[0],s[1],s[2]],l=[o[0],o[1],o[2]];return t===n.A.COORDS_BY_USER?(2===e.length?(s[0]=1,s[1]=e[0],s[2]=e[1]):(s[0]=e[0],s[1]=e[1],s[2]=e[2],this.normalizeUsrCoords()),this.usr2screen(i)):(2===e.length?(o[1]=e[0],o[2]=e[1]):(o[1]=e[1],o[2]=e[2]),this.screen2usr()),!this.emitter||r||l[1]===o[1]&&l[2]===o[2]||this.triggerEventHandlers(["update"],[a,l]),this},copy:function(t,e){return void 0===e&&(e=0),this[t].slice(e)},isReal:function(){return!isNaN(this.usrCoords[1]+this.usrCoords[2])&&Math.abs(this.usrCoords[0])>a.A.eps},__evt__update:function(t,e){},__evt:function(){}});const l=r.A.Coords},174:(t,e,i)=>{i.d(e,{A:()=>a});var r,n=i(84),s=i(9),o=function(t){var e,i;return t.memo||(e={},i=Array.prototype.join,t.memo=function(){var n=i.call(arguments);return e[n]!==r?e[n]:e[n]=t.apply(this,arguments)}),t.memo};n.A.Math={eps:1e-6,relDif:function(t,e){var i=Math.abs(t),r=Math.abs(e);return 0===(r=Math.max(i,r))?0:Math.abs(t-e)/r},mod:function(t,e){return t-Math.floor(t/e)*e},wrap:function(t,e,i){return e+this.mod(t-e,i-e)},clamp:function(t,e,i){return Math.min(Math.max(t,e),i)},wrapAndClamp:function(t,e,i,r){var n=.5*(e+i),s=.5*r;return this.clamp(this.wrap(t,n-s,n+s),e,i)},vector:function(t,e){var i,r;for(e=e||0,i=[],r=0;r<t;r++)i[r]=e;return i},matrix:function(t,e,i){var r,n,s;for(i=i||0,e=e||t,r=[],n=0;n<t;n++)for(r[n]=[],s=0;s<e;s++)r[n][s]=i;return r},identity:function(t,e){var i,n;for(e===r&&"number"!=typeof e&&(e=t),i=this.matrix(t,e),n=0;n<Math.min(t,e);n++)i[n][n]=1;return i},frustum:function(t,e,i,r,n,s){var o=this.matrix(4,4);return o[0][0]=2*n/(e-t),o[0][1]=0,o[0][2]=(e+t)/(e-t),o[0][3]=0,o[1][0]=0,o[1][1]=2*n/(r-i),o[1][2]=(r+i)/(r-i),o[1][3]=0,o[2][0]=0,o[2][1]=0,o[2][2]=-(s+n)/(s-n),o[2][3]=-s*n*2/(s-n),o[3][0]=0,o[3][1]=0,o[3][2]=-1,o[3][3]=0,o},projection:function(t,e,i,r){var n=i*Math.tan(t/2),s=n*e;return this.frustum(-s,s,-n,n,i,r)},matVecMult:function(t,e){var i,r,n,s=t.length,o=e.length,a=[];if(3===o)for(i=0;i<s;i++)a[i]=t[i][0]*e[0]+t[i][1]*e[1]+t[i][2]*e[2];else for(i=0;i<s;i++){for(n=0,r=0;r<o;r++)n+=t[i][r]*e[r];a[i]=n}return a},vecMatMult:function(t,e){var i,r,n,s=e.length,o=t.length,a=[];if(3===o)for(i=0;i<s;i++)a[i]=t[0]*e[0][i]+t[1]*e[1][i]+t[2]*e[2][i];else for(i=0;i<o;i++){for(n=0,r=0;r<s;r++)n+=t[r]*e[r][i];a[i]=n}return a},matMatMult:function(t,e){var i,r,n,s,o=t.length,a=o>0?e[0].length:0,l=e.length,c=this.matrix(o,a);for(i=0;i<o;i++)for(r=0;r<a;r++){for(n=0,s=0;s<l;s++)n+=t[i][s]*e[s][r];c[i][r]=n}return c},matNumberMult:function(t,e){var i,r,n=t.length,s=n>0?t[0].length:0,o=this.matrix(n,s);for(i=0;i<n;i++)for(r=0;r<s;r++)o[i][r]=t[i][r]*e;return o},matMatAdd:function(t,e){var i,r,n=t.length,s=n>0?t[0].length:0,o=this.matrix(n,s);for(i=0;i<n;i++)for(r=0;r<s;r++)o[i][r]=t[i][r]+e[i][r];return o},transpose:function(t){var e,i,r,n,s;for(n=t.length,s=t.length>0?t[0].length:0,e=this.matrix(s,n),i=0;i<s;i++)for(r=0;r<n;r++)e[i][r]=t[r][i];return e},inverse:function(t){var e,i,r,s,o,a,l,c=this.eps*this.eps,h=t.length,u=[],d=[],p=[];for(e=0;e<h;e++){for(u[e]=[],i=0;i<h;i++)u[e][i]=t[e][i];d[e]=e}for(i=0;i<h;i++){for(a=Math.abs(u[i][i]),s=i,e=i+1;e<h;e++)Math.abs(u[e][i])>a&&(a=Math.abs(u[e][i]),s=e);if(a<=c)return n.A.warn("JXG.Math.inverse: singular matrix"),[];if(s>i){for(r=0;r<h;r++)l=u[i][r],u[i][r]=u[s][r],u[s][r]=l;l=d[i],d[i]=d[s],d[s]=l}for(o=1/u[i][i],e=0;e<h;e++)u[e][i]*=o;for(u[i][i]=o,r=0;r<h;r++)if(r!==i){for(e=0;e<h;e++)e!==i&&(u[e][r]-=u[e][i]*u[i][r]);u[i][r]=-o*u[i][r]}}for(e=0;e<h;e++){for(r=0;r<h;r++)p[d[r]]=u[e][r];for(r=0;r<h;r++)u[e][r]=p[r]}return u},trace:function(t){var e,i,r=0;if(t.length!==(i=t.length>0?t[0].length:0))return NaN;for(e=0;e<i;e++)r+=t[e][e];return r},innerProduct:function(t,e,i){var n,o=0;for(i!==r&&s.A.isNumber(i)||(i=t.length),n=0;n<i;n++)o+=t[n]*e[n];return o},crossProduct:function(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]},norm:function(t,e){var i,n=0;for(e!==r&&s.A.isNumber(e)||(e=t.length),i=0;i<e;i++)n+=t[i]*t[i];return Math.sqrt(n)},axpy:function(t,e,i){var r,n=e.length,s=[];for(r=0;r<n;r++)s[r]=t*e[r]+i[r];return s},factorial:o((function(t){return t<0?NaN:0===(t=Math.floor(t))||1===t?1:t*this.factorial(t-1)})),binomial:o((function(t,e){var i,r;if(e>t||e<0)return NaN;if(e=Math.round(e),t=Math.round(t),0===e||e===t)return 1;for(i=1,r=0;r<e;r++)i*=t-r,i/=r+1;return i})),cosh:Math.cosh||function(t){return.5*(Math.exp(t)+Math.exp(-t))},sinh:Math.sinh||function(t){return.5*(Math.exp(t)-Math.exp(-t))},acosh:Math.acosh||function(t){return Math.log(t+Math.sqrt(t*t-1))},asinh:Math.asinh||function(t){return t===-1/0?t:Math.log(t+Math.sqrt(t*t+1))},cot:function(t){return 1/Math.tan(t)},acot:function(t){return(t>=0?.5:-.5)*Math.PI-Math.atan(t)},nthroot:function(t,e){var i=1/e;return e<=0||Math.floor(e)!==e?NaN:0===t?0:t>0?Math.exp(i*Math.log(t)):e%2==1?-Math.exp(i*Math.log(-t)):NaN},cbrt:Math.cbrt||function(t){return this.nthroot(t,3)},pow:function(t,e){return 0===t?0===e?1:0:Math.floor(e)===e?Math.pow(t,e):t>0?Math.exp(e*Math.log(t)):NaN},ratpow:function(t,e,i){var r;return 0===e?1:0===i?NaN:(r=this.gcd(e,i),this.nthroot(this.pow(t,e/r),i/r))},log10:function(t){return Math.log(t)/Math.log(10)},log2:function(t){return Math.log(t)/Math.log(2)},log:function(t,e){return void 0!==e&&s.A.isNumber(e)?Math.log(t)/Math.log(e):Math.log(t)},sign:Math.sign||function(t){return 0===(t=+t)||isNaN(t)?t:t>0?1:-1},squampow:function(t,e){var i;if(Math.floor(e)===e){for(i=1,e<0&&(t=1/t,e*=-1);0!==e;)1&e&&(i*=t),e>>=1,t*=t;return i}return this.pow(t,e)},gcd:function(t,e){var i;if(t=Math.abs(t),e=Math.abs(e),!s.A.isNumber(t)||!s.A.isNumber(e))return NaN;for(e>t&&(i=t,t=e,e=i);;){if(0===(t%=e))return e;if(0===(e%=t))return t}},lcm:function(t,e){var i;return s.A.isNumber(t)&&s.A.isNumber(e)?0!==(i=t*e)?i/this.gcd(t,e):0:NaN},roundToStep:function(t,e,i,r){var o,a,l=t;if(!s.A.exists(e)&&!s.A.exists(i)&&!s.A.exists(r))return l;if(n.A.exists(r)&&(l=Math.min(l,r)),n.A.exists(i)&&(l=Math.max(l,i)),a=i||0,n.A.exists(e)){if(o=(l-a)/e,Number.isInteger(o))return l;l=a+(o=Math.round(o))*e}return n.A.exists(r)&&(l=Math.min(l,r)),n.A.exists(i)&&(l=Math.max(l,i)),l},erf:function(t){return this.ProbFuncs.erf(t)},erfc:function(t){return this.ProbFuncs.erfc(t)},erfi:function(t){return this.ProbFuncs.erfi(t)},ndtr:function(t){return this.ProbFuncs.ndtr(t)},ndtri:function(t){return this.ProbFuncs.ndtri(t)},hypot:function(){var t,e,i,r;for(e=arguments.length,t=0,r=0;t<e;t++)r+=(i=arguments[t])*i;return Math.sqrt(r)},hstep:function(t){return t>0?1:t<0?0:.5},gamma:function(t){var e,i,r,n,s,o=[1,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7];if(t<.5)i=Math.PI/(Math.sin(Math.PI*t)*this.gamma(1-t));else{for(t-=1,e=o[0],s=o.length,n=1;n<s;n++)e+=o[n]/(t+n);r=t+7+.5,i=Math.sqrt(2*Math.PI)*Math.pow(r,t+.5)*Math.exp(-r)*e}return i},lt:function(t,e){return t<e},leq:function(t,e){return t<=e},gt:function(t,e){return t>e},geq:function(t,e){return t>=e},eq:function(t,e){return t===e},neq:function(t,e){return t!==e},and:function(t,e){return t&&e},not:function(t){return!t},or:function(t,e){return t||e},xor:function(t,e){return(t||e)&&!(t&&e)},decToFraction:function(t,e){var i,r,n,o,a,l,c,h,u,d=0;for(e=s.A.def(e,.001),r=(t=1e-12*Math.round(1e12*t))<0?-1:1,t=Math.abs(t),i=Math.floor(t),t-=Math.floor(t),l=1,o=a=n=0,u=0,c=h=1;t-Math.floor(t)>e&&d<20;)t=1/(t-n),o=l+(n=Math.floor(t))*a,c=u+n*h,l=a,u=h,a=o,h=c,d++;return[r,i,o,c]},normalize:function(t){var e,i,r=2*t[3],n=t[4]/r;return t[5]=n,t[6]=-t[1]/r,t[7]=-t[2]/r,isFinite(n)?Math.abs(n)>=1?(t[0]=(t[6]*t[6]+t[7]*t[7]-n*n)/(2*n),t[1]=-t[6]/n,t[2]=-t[7]/n,t[3]=1/(2*n),t[4]=1):(i=n<=0?-1:1,t[0]=i*(t[6]*t[6]+t[7]*t[7]-n*n)*.5,t[1]=-i*t[6],t[2]=-i*t[7],t[3]=i/2,t[4]=i*n):(e=this.hypot(t[1],t[2]),t[0]/=e,t[1]/=e,t[2]/=e,t[3]=0,t[4]=1),t},toGL:function(t){var e,i,r;if(e="function"==typeof Float32Array?new Float32Array(16):new Array(16),4!==t.length&&4!==t[0].length)return e;for(i=0;i<4;i++)for(r=0;r<4;r++)e[i+4*r]=t[i][r];return e},Vieta:function(t){var e,i,r,n=t.length,s=[];for(s=t.slice(),e=1;e<n;++e){for(r=s[e],s[e]*=s[e-1],i=e-1;i>=1;--i)s[i]+=s[i-1]*r;s[0]+=r}return s}};const a=n.A.Math},194:(t,e,i)=>{i.d(e,{A:()=>l});var r=i(84),n=i(9),s=i(174),o={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",venetianred:"ae181e",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},a=[{re:/^\s*rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d.]{1,3})\s*\)\s*$/,example:["rgba(123, 234, 45, 0.5)","rgba(255,234,245,1.0)"],process:function(t){return[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3],10)]}},{re:/^\s*rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)\s*$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(t){return[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3],10)]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}}];r.A.rgbParser=function(t,e,i){var r,s,l,c,h,u,d,p,f,m,g=t;if(!n.A.exists(t))return[];if(n.A.exists(e)&&n.A.exists(i)&&(g=[t,e,i]),r=g,m=!1,n.A.isArray(r)){for(u=0;u<3;u++)m=m||/\./.test(g[u].toString());for(u=0;u<3;u++)m=m&&g[u]>=0&&g[u]<=1;return m?[Math.ceil(255*g[0]),Math.ceil(255*g[1]),Math.ceil(255*g[2])]:g}for("string"==typeof g&&(r=g),"#"===r.charAt(0)&&(r=r.slice(1,7)),r=r.replace(/ /g,"").toLowerCase(),r=o[r]||r,u=0;u<a.length;u++)l=a[u].re,c=a[u].process,(h=l.exec(r))&&(d=(s=c(h))[0],p=s[1],f=s[2]);return isNaN(d)||isNaN(p)||isNaN(f)?[]:[d=d<0||isNaN(d)?0:d>255?255:d,p=p<0||isNaN(p)?0:p>255?255:p,f=f<0||isNaN(f)?0:f>255?255:f]},r.A.isColor=function(t){var e=(new Option).style;return e.color=t,""!==e.color},r.A.rgb2css=function(t,e,i){var n;return"rgb("+(n=r.A.rgbParser(t,e,i))[0]+", "+n[1]+", "+n[2]+")"},r.A.rgb2hex=function(t,e,i){var n,s,o;return s=(n=r.A.rgbParser(t,e,i))[1],o=n[2],n=(n=n[0]).toString(16),s=s.toString(16),o=o.toString(16),1===n.length&&(n="0"+n),1===s.length&&(s="0"+s),1===o.length&&(o="0"+o),"#"+n+s+o},r.A.hex2rgb=function(t){return r.A.deprecated("JXG.hex2rgb()","JXG.rgb2css()"),r.A.rgb2css(t)},r.A.hsv2rgb=function(t,e,i){var r,n,o,a,l,c,h,u,d;if(t=(t%360+360)%360,0===e){if(!(isNaN(t)||t<s.A.eps))return"#ffffff";r=i,n=i,o=i}else switch(c=t>=360?0:t,h=i*(1-e),u=i*(1-e*(a=(c/=60)-(l=Math.floor(c)))),d=i*(1-e*(1-a)),l){case 0:r=i,n=d,o=h;break;case 1:r=u,n=i,o=h;break;case 2:r=h,n=i,o=d;break;case 3:r=h,n=u,o=i;break;case 4:r=d,n=h,o=i;break;case 5:r=i,n=h,o=u}return["#",r=2===(r=Math.round(255*r).toString(16)).length?r:1===r.length?"0"+r:"00",n=2===(n=Math.round(255*n).toString(16)).length?n:1===n.length?"0"+n:"00",o=2===(o=Math.round(255*o).toString(16)).length?o:1===o.length?"0"+o:"00"].join("")},r.A.rgb2hsv=function(t,e,i){var n,s,o,a,l,c,h,u,d,p,f,m,g;return s=(n=r.A.rgbParser(t,e,i))[1],o=n[2],a=(n=n[0])/255,l=s/255,c=o/255,m=Math.max(n,s,o),u=(g=Math.min(n,s,o))/255,p=0,(f=h=m/255)>0&&(p=(f-u)/f),d=1/(h-u),p>0&&(m===n?d*=l-c:d=m===s?2+(c-a)*d:4+(a-l)*d),(d*=60)<0&&(d+=360),m===g&&(d=0),[d,p,f]},r.A.rgb2LMS=function(t,e,i){var n,s,o,a,l,c,h,u=[[.05059983,.08585369,.0095242],[.01893033,.08925308,.01370054],[.00292202,.00975732,.07145979]];return s=(n=r.A.rgbParser(t,e,i))[1],o=n[2],n=n[0],n=Math.pow(n,.476190476),s=Math.pow(s,.476190476),o=Math.pow(o,.476190476),(h=[a=n*u[0][0]+s*u[0][1]+o*u[0][2],l=n*u[1][0]+s*u[1][1]+o*u[1][2],c=n*u[2][0]+s*u[2][1]+o*u[2][2]]).l=a,h.m=l,h.s=c,h},r.A.LMS2rgb=function(t,e,i){var r,n,s,o,a=[[30.830854,-29.832659,1.610474],[-6.481468,17.715578,-2.532642],[-.37569,-1.199062,14.273846]],l=function(t){for(var e=127,i=64;i>0;){if(Math.pow(e,.476190476)>t)e-=i;else{if(Math.pow(e+1,.476190476)>t)return e;e+=i}i/=2}return 254===e&&13.994955247<t?255:e};return r=t*a[0][0]+e*a[0][1]+i*a[0][2],n=t*a[1][0]+e*a[1][1]+i*a[1][2],s=t*a[2][0]+e*a[2][1]+i*a[2][2],(o=[r=l(r),n=l(n),s=l(s)]).r=r,o.g=n,o.b=s,o},r.A.rgba2rgbo=function(t){var e;return 9===t.length&&"#"===t.charAt(0)?(e=parseInt(t.slice(7,9).toUpperCase(),16)/255,t=t.slice(0,7)):e=1,[t,e]},r.A.rgbo2rgba=function(t,e){var i;return"none"===t||"transparent"===t?t:(1===(i=Math.round(255*e).toString(16)).length&&(i="0"+i),r.A.rgb2hex(t)+i)},r.A.rgb2bw=function(t){var e,i,n,s="0123456789ABCDEF";return"none"===t?t:(n=r.A.rgbParser(t),e=Math.floor(.3*n[0]+.59*n[1]+.11*n[2]),t="#"+(i=s.charAt(e>>4&15)+s.charAt(15&e))+i+i)},r.A.rgb2cb=function(t,e){var i,n,s,o,a,l,c,h,u,d,p,f="0123456789ABCDEF";if("none"===t)return t;switch(n=(a=r.A.rgb2LMS(t))[0],s=a[1],o=a[2],e=e.toLowerCase()){case"protanopia":l=-.06150039994295001,c=.08277001656812001,h=-.013200141220000003,u=.05858939668799999,d=-.07934519995360001,p=.013289415272000003,n=o/s<.6903216543277437?-(c*s+h*o)/l:-(d*s+p*o)/u;break;case"tritanopia":l=-.00058973116217,c=.007690316482,h=-.01011703519052,u=.025495080838999994,d=-.0422740347,p=.017005316784,o=s/n<.8349489908460004?-(l*n+c*s)/h:-(u*n+d*s)/p;break;default:l=-.06150039994295001,c=.08277001656812001,h=-.013200141220000003,u=.05858939668799999,d=-.07934519995360001,p=.013289415272000003,s=o/n<.5763833686400911?-(l*n+h*o)/c:-(u*n+p*o)/d}return i=r.A.LMS2rgb(n,s,o),t="#"+(f.charAt(i[0]>>4&15)+f.charAt(15&i[0])),(t+=f.charAt(i[1]>>4&15)+f.charAt(15&i[1]))+(f.charAt(i[2]>>4&15)+f.charAt(15&i[2]))},r.A.shadeColor=function(t,e){var i=r.A.rgbParser(t),n=i[0],s=i[1],o=i[2];return n=(n=(n=parseInt(n+255*e))>0?n:0)<255?n:255,s=(s=(s=parseInt(s+255*e))>0?s:0)<255?s:255,o=(o=(o=parseInt(o+255*e))>0?o:0)<255?o:255,n=Math.round(n),s=Math.round(s),o=Math.round(o),r.A.rgb2hex([n,s,o])},r.A.lightenColor=function(t,e){return r.A.shadeColor(t,e)},r.A.darkenColor=function(t,e){return r.A.shadeColor(t,-1*e)},r.A.autoHighlight=function(t){var e=r.A.rgba2rgbo(t),i=e[0],n=e[1];return"#"===t.charAt(0)?(n*=n<.3?1.8:.4,r.A.rgbo2rgba(i,n)):t},r.A.contrast=function(t,e,i,n){var s,o,a,l,c;return e=e||"#000000",i=i||"#ffffff",n=n||7,s=r.A.rgbParser(t),o=r.A.rgbParser("#000000"),c=(a=.2126*Math.pow(s[0]/255,2.2)+.7152*Math.pow(s[1]/255,2.2)+.0722*Math.pow(s[2]/255,2.2))>(l=.2126*Math.pow(o[0]/255,2.2)+.7152*Math.pow(o[1]/255,2.2)+.0722*Math.pow(o[2]/255,2.2))?Math.floor((a+.05)/(l+.05)):Math.floor((l+.05)/(a+.05)),(c-=1)>n?e:i},r.A.setClassicColors=function(){r.A.Options.elements.strokeColor="blue",r.A.Options.elements.fillColor="red",r.A.Options.hatch.strokeColor="blue",r.A.Options.angle.fillColor="#ff7f00",r.A.Options.angle.highlightFillColor="#ff7f00",r.A.Options.angle.strokeColor="#ff7f00",r.A.Options.angle.label.strokeColor="blue",r.A.Options.arc.strokeColor="blue",r.A.Options.circle.center.fillColor="red",r.A.Options.circle.center.strokeColor="blue",r.A.Options.circumcircle.strokeColor="blue",r.A.Options.circumcircle.center.fillColor="red",r.A.Options.circumcircle.center.strokeColor="blue",r.A.Options.circumcirclearc.strokeColor="blue",r.A.Options.circumcirclesector.strokeColor="blue",r.A.Options.circumcirclesector.fillColor="green",r.A.Options.circumcirclesector.highlightFillColor="green",r.A.Options.conic.strokeColor="blue",r.A.Options.curve.strokeColor="blue",r.A.Options.incircle.strokeColor="blue",r.A.Options.incircle.center.fillColor="red",r.A.Options.incircle.center.strokeColor="blue",r.A.Options.inequality.fillColor="red",r.A.Options.integral.fillColor="red",r.A.Options.integral.curveLeft.color="red",r.A.Options.integral.curveRight.color="red",r.A.Options.line.strokeColor="blue",r.A.Options.point.fillColor="red",r.A.Options.point.strokeColor="red",r.A.Options.polygon.fillColor="green",r.A.Options.polygon.highlightFillColor="green",r.A.Options.polygon.vertices.strokeColor="red",r.A.Options.polygon.vertices.fillColor="red",r.A.Options.regularpolygon.fillColor="green",r.A.Options.regularpolygon.highlightFillColor="green",r.A.Options.regularpolygon.vertices.strokeColor="red",r.A.Options.regularpolygon.vertices.fillColor="red",r.A.Options.riemannsum.fillColor="yellow",r.A.Options.sector.fillColor="green",r.A.Options.sector.highlightFillColor="green",r.A.Options.semicircle.center.fillColor="red",r.A.Options.semicircle.center.strokeColor="blue",r.A.Options.slopetriangle.fillColor="red",r.A.Options.slopetriangle.highlightFillColor="red",r.A.Options.turtle.arrow.strokeColor="blue"},r.A.extend(r.A,{paletteWong:{black:"#000000",orange:"#E69F00",skyblue:"#56B4E9",bluishgreen:"#009E73",yellow:"#F0E442",darkblue:"#0072B2",vermillion:"#D55E00",reddishpurple:"#CC79A7",blue:"#0072B2",red:"#D55E00",green:"#009E73",purple:"#CC79A7",white:"#ffffff"}}),r.A.palette=r.A.paletteWong;const l=r.A},219:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _jxg_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(84),_base_constants_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(156),_base_text_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(30),_math_math_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(174),_math_ia_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(718),_math_geometry_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(40),_math_statistics_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(959),_utils_type_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(9),_utils_env_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(234);Object.create||(Object.create=function(t,e){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object prototype may only be an Object: "+t);if(null===t)throw new Error("This browser's implementation of Object.create is a shim and doesn't support 'null' as the first argument.");if(void 0!==e)throw new Error("This browser's implementation of Object.create is a shim and doesn't support a second argument.");function i(){}return i.prototype=t,new i});var priv={modules:{math:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A,"math/geometry":_math_geometry_js__WEBPACK_IMPORTED_MODULE_5__.A,"math/statistics":_math_statistics_js__WEBPACK_IMPORTED_MODULE_6__.A,"math/numerics":_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.Numerics}},r,_ccache;_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.JessieCode=function(t,e){this.scope={id:0,hasChild:!0,args:[],locals:{},context:null,previous:null},this.scopes=[],this.scopes.push(this.scope),this.dpstack=[[]],this.pscope=0,this.propstack=[{}],this.propscope=0,this.lhs=[],this.isLHS=!1,this.warnLog="jcwarn",this.$log=[],this.builtIn=this.defineBuiltIn(),this.operands=this.getPossibleOperands(),this.board=null,this.forceValueCall=!1,this.lineToElement={},this.parCurLine=1,this.parCurColumn=0,this.line=1,this.col=1,_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.CA&&(this.CA=new _jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.CA(this.node,this.createNode,this)),this.code="","string"==typeof t&&this.parse(t,e)},_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.extend(_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.JessieCode.prototype,{node:function(t,e,i){return{type:t,value:e,children:i}},createNode:function(t,e,i){var r,n=this.node(t,e,[]);for(r=2;r<arguments.length;r++)n.children.push(arguments[r]);return"node_const"===n.type&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isNumber(n.value)&&(n.isMath=!0),n.line=this.parCurLine,n.col=this.parCurColumn,n},pushScope:function(t){var e={args:t,locals:{},context:null,previous:this.scope};return this.scope.hasChild=!0,this.scope=e,e.id=this.scopes.push(e)-1,e},popScope:function(){var t=this.scope.previous;return this.scope=null!==t?t:this.scope,this.scope},getElementById:function(t){return this.board.objects[t]},log:function(){this.$log.push(arguments),"object"==typeof console&&console.log&&console.log.apply(console,arguments)},creator:(_ccache={},r=function(t){var e,i;return"function"==typeof _ccache[this.board.id+t]?e=_ccache[this.board.id+t]:(i=this,e=function(e,r){var n;return void 0===(n=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(r)?r:{}).name&&void 0===n.id&&(n.name=0!==i.lhs[i.scope.id]?i.lhs[i.scope.id]:""),i.board.create(t,e,n)},e.creator=!0,_ccache[this.board.id+t]=e),e},r.clearCache=function(){_ccache={}},r),letvar:function(t,e){this.builtIn[t]&&this._warn('"'+t+'" is a predefined value.'),this.scope.locals[t]=e},isLocalVariable:function(t){for(var e=this.scope;null!==e;){if(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(e.locals[t]))return e;e=e.previous}return null},isParameter:function(t){for(var e=this.scope;null!==e;){if(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.indexOf(e.args,t)>-1)return e;e=e.previous}return null},isCreator:function(t){return!!_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.elements[t]},isMathMethod:function(t){return"E"!==t&&!!Math[t]},isBuiltIn:function(t){return!!this.builtIn[t]},getvar:function(t,e,i){var r;if(e=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.def(e,!1),null!==(r=this.isLocalVariable(t)))return r.locals[t];if("$board"===t||"EULER"===t||"PI"===t)return this.builtIn[t];if(i){if(this.isBuiltIn(t))return this.builtIn[t];if(this.isMathMethod(t))return Math[t];if(this.isCreator(t))return this.creator(t)}return e||(r=this.board.select(t))===t?void 0:r},resolve:function(t){for(var e=this.scope;null!==e;){if(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(e.locals[t]))return e.locals[t];e=e.previous}},getvarJS:function(t,e,i){var r,n="";return e=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.def(e,!1),i=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.def(i,!1),null!==this.isParameter(t)?t:null===this.isLocalVariable(t)||i?this.isCreator(t)?"(function () { var a = Array.prototype.slice.call(arguments, 0), props = "+(i?"a.pop()":"{}")+"; return $jc$.board.create.apply($jc$.board, ['"+t+"'].concat([a, props])); })":(i&&this._error("Syntax error (attribute values are allowed with element creators only)"),this.isBuiltIn(t)?(n=this.builtIn[t].src||this.builtIn[t],_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isNumber(n)||n.match(/board\.select/)?n:(t=n.split(".").pop(),_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(this.board.mathLib)&&null!==(r=new RegExp("^Math."+t)).exec(n)?n.replace(r,"$jc$.board.mathLib."+t):_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(this.board.mathLibJXG)&&null!==(r=new RegExp("^JXG.Math.")).exec(n)?n.replace(r,"$jc$.board.mathLibJXG."):n)):this.isMathMethod(t)?"$jc$.board.mathLib."+t:e?"":(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isId(this.board,t)?(n="$jc$.board.objects['"+t+"']","slider"===this.board.objects[t].elType&&(n+=".Value()")):_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isName(this.board,t)?(n="$jc$.board.elementsByName['"+t+"']","slider"===this.board.elementsByName[t].elType&&(n+=".Value()")):_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isGroup(this.board,t)&&(n="$jc$.board.groups['"+t+"']"),n)):"$jc$.resolve('"+t+"')"},makeMap:function(t){return t.isMap=!0,t},functionCodeJS:function(t){var e=t.children[0].join(", "),i="",r="";return"op_map"===t.value&&(i="{ return  ",r=" }"),"function ("+e+") {\nvar $oldscope$ = $jc$.scope;\n$jc$.scope = $jc$.scopes["+this.scope.id+"];\nvar r = (function () "+i+this.compile(t.children[1],!0)+r+")();\n$jc$.scope = $oldscope$;\nreturn r;\n}"},defineFunction:function(node){var fun,i,that=this,list=node.children[0],scope=this.pushScope(list),_that;if(this.board.options.jc.compile){for(this.isLHS=!1,i=0;i<list.length;i++)scope.locals[list[i]]=list[i];this.replaceNames(node.children[1]),fun=function(jc){var fun,str="var f = function($jc$) { return "+jc.functionCodeJS(node)+"}; f;";try{for(fun=eval(str)(jc),scope.argtypes=[],i=0;i<list.length;i++)scope.argtypes.push(that.resolveType(list[i],node));return fun}catch(t){return jc._warn("error compiling function\n\n"+str+"\n\n"+t.toString()),function(){}}}(this),this.popScope()}else fun=function(t,e,i){return function(){var r,n;for(n=e.scope,e.scope=e.scopes[i],r=0;r<t.length;r++)e.scope.locals[t[r]]=arguments[r];return r=e.execute(node.children[1]),e.scope=n,r}}(list,this,scope.id);return fun.node=node,fun.scope=scope,fun.toJS=fun.toString,fun.toString=(_that=this,function(){return _that.compile(_that.replaceIDs(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.deepCopy(node)))}),fun.deps={},this.collectDependencies(node.children[1],node.children[0],fun.deps),fun},mergeAttributes:function(t){var e,i={};for(e=0;e<arguments.length;e++)i=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.deepCopy(i,arguments[e],!0);return i},setProp:function(t,e,i){var r,n,s={};t.elementClass!==_base_constants_js__WEBPACK_IMPORTED_MODULE_1__.A.OBJECT_CLASS_POINT||"X"!==e&&"Y"!==e?t.elementClass!==_base_constants_js__WEBPACK_IMPORTED_MODULE_1__.A.OBJECT_CLASS_TEXT||"X"!==e&&"Y"!==e?t.type&&t.elementClass&&t.visProp?_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t[t.methodMap[e]])&&"function"!=typeof t[t.methodMap[e]]?t[t.methodMap[e]]=i:(s[e]=i,t.setAttribute(s)):t[e]=i:("number"==typeof i?t[e]=function(){return i}:"function"==typeof i?(t.isDraggable=!1,t[e]=i):"string"==typeof i&&(t.isDraggable=!1,t[e]=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.createFunction(i,this.board),t[e+"jc"]=i),t[e].origin=i,this.board.update()):(e=e.toLowerCase(),t.isDraggable&&"number"==typeof i?(r="x"===e?i:t.X(),n="y"===e?i:t.Y(),t.setPosition(_base_constants_js__WEBPACK_IMPORTED_MODULE_1__.A.COORDS_BY_USER,[r,n])):!t.isDraggable||"function"!=typeof i&&"string"!=typeof i?t.isDraggable||(r="x"===e?i:t.XEval.origin,n="y"===e?i:t.YEval.origin,t.addConstraint([r,n])):(r="x"===e?i:t.coords.usrCoords[1],n="y"===e?i:t.coords.usrCoords[2],t.addConstraint([r,n])),this.board.update())},_genericParse:function(t,e,i,r){var n,s,o,a,l=t.replace(/\r\n/g,"\n").split("\n"),c=[];r||(this.code+=t+"\n"),_base_text_js__WEBPACK_IMPORTED_MODULE_2__.A&&(s=_base_text_js__WEBPACK_IMPORTED_MODULE_2__.A.prototype.setText,_base_text_js__WEBPACK_IMPORTED_MODULE_2__.A.prototype.setText=_base_text_js__WEBPACK_IMPORTED_MODULE_2__.A.prototype.setTextJessieCode);try{for(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(i)||(i=!1),n=0;n<l.length;n++)i&&(l[n]=_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.GeonextParser.geonext2JS(l[n],this.board)),c.push(l[n]);switch(t=c.join("\n"),o=parser.parse(t),this.CA&&(o=this.CA.expandDerivatives(o,null,o),o=this.CA.removeTrivialNodes(o)),e){case"parse":a=this.execute(o);break;case"manipulate":a=this.compile(o);break;case"getAst":a=o;break;default:a=!1}}catch(t){throw t}finally{_base_text_js__WEBPACK_IMPORTED_MODULE_2__.A&&(_base_text_js__WEBPACK_IMPORTED_MODULE_2__.A.prototype.setText=s)}return a},parse:function(t,e,i){return this._genericParse(t,"parse",e,i)},manipulate:function(t,e,i){return this._genericParse(t,"manipulate",e,i)},getAST:function(t,e,i){return this._genericParse(t,"getAst",e,i)},snippet:function(t,e,i,r,n){var s;return e=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.def(e,!0),i=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.def(i,""),r=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.def(r,!1),this.forceValueCall=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.def(n,!0),s=(e?" function ("+i+") { return ":"")+t+(e?"; }":"")+";",this.parse(s,r,!0)},replaceIDs:function(t){var e,i;if(t.replaced&&(i=this.board.objects[t.children[1][0].value],_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(i)&&""!==i.name&&(t.type="node_var",t.value=i.name,t.children.length=0,delete t.replaced)),_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isArray(t))for(e=0;e<t.length;e++)t[e]=this.replaceIDs(t[e]);if(t.children)for(e=t.children.length;e>0;e--)_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t.children[e-1])&&(t.children[e-1]=this.replaceIDs(t.children[e-1]));return t},replaceNames:function(t,e){var i,r,n=!1;if(void 0!==e&&(n=e),r=t.value,"node_op"===t.type&&"op_lhs"===r&&1===t.children.length?this.isLHS=!0:"node_var"===t.type&&(this.isLHS?this.letvar(r,!0):!_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(this.getvar(r,!0))&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(this.board.elementsByName[r])&&(n&&"slider"!==this.board.elementsByName[r].elType&&(n=!1),t=this.createReplacementNode(t,n))),_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isArray(t))for(i=0;i<t.length;i++)t[i]=this.replaceNames(t[i],n);if(t.children)for(this.forceValueCall&&("op_execfun"===t.value&&"V"!==t.children[0].value&&"$"!==t.children[0].value&&(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(Math[t.children[0].value])||_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A[t.children[0].value]))&&"node_var"===t.children[1][0].type||"op_return"===t.value&&1===t.children.length&&"node_var"===t.children[0].type)&&(n=!0),i=t.children.length;i>0;i--)_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t.children[i-1])&&(t.children[i-1]=this.replaceNames(t.children[i-1],n));return"node_op"===t.type&&"op_lhs"===t.value&&1===t.children.length&&(this.isLHS=!1),t},createReplacementNode:function(t,e){var i=t.value,r=this.board.elementsByName[i];return(t=this.createNode("node_op","op_execfun",this.createNode("node_var",!0===e?"$value":"$"),[this.createNode("node_str",r.id)])).replaced=!0,t},collectDependencies:function(t,e,i){var r,n,s,o;if(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isArray(t))for(o=t.length,r=0;r<o;r++)this.collectDependencies(t[r],e,i);else if(n=t.value,"node_var"===t.type&&e.indexOf(n)<0&&(s=this.getvar(n))&&s.visProp&&s.elType&&s.elementClass&&s.id&&(i[s.id]=s),"node_op"===t.type&&"op_execfun"===t.value&&t.children.length>1&&("$"===t.children[0].value||"$value"===t.children[0].value)&&t.children[1].length>0&&(i[s=t.children[1][0].value]=this.board.objects[s]),t.children)for(r=t.children.length;r>0;r--)_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t.children[r-1])&&this.collectDependencies(t.children[r-1],e,i)},resolveProperty:function(t,e,i){return i=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.def(i,!1),t&&t.methodMap&&(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t.subs)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t.subs[e])?t=t.subs:_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t.methodMap[e])?e=t.methodMap[e]:(t=t.visProp,e=e.toLowerCase())),_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isFunction(t)&&this._error("Accessing function properties is not allowed."),_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t)||this._error(t+" is not an object"),_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t[e])||this._error("unknown property "+e),i&&"function"==typeof t[e]?function(){return t[e].apply(t,arguments)}:t[e]},resolveType:function(t,e){var i,r;if(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isArray(e))for(i=0;i<e.length;i++)if("any"!==(r=this.resolveType(t,e[i])))return r;if("node_op"===e.type&&"op_execfun"===e.value&&"node_var"===e.children[0].type&&e.children[0].value===t)return"function";if("node_op"===e.type){for(i=0;i<e.children.length;i++)if("node_var"===e.children[0].type&&e.children[0].value===t&&("op_add"===e.value||"op_sub"===e.value||"op_mul"===e.value||"op_div"===e.value||"op_mod"===e.value||"op_exp"===e.value||"op_neg"===e.value))return"any";for(i=0;i<e.children.length;i++)if("any"!==(r=this.resolveType(t,e.children[i])))return r}return"any"},getLHS:function(t){var e;if("node_var"===t.type)e={o:this.scope.locals,what:t.value};else if("node_op"===t.type&&"op_property"===t.value)e={o:this.execute(t.children[0]),what:t.children[1]};else{if("node_op"!==t.type||"op_extvalue"!==t.value)throw new Error("Syntax error: Invalid left-hand side of assignment.");e={o:this.execute(t.children[0]),what:this.execute(t.children[1])}}return e},getLHSCompiler:function(t,e){var i;if("node_var"===t.type)i=t.value;else if("node_op"===t.type&&"op_property"===t.value)i=[this.compile(t.children[0],e),"'"+t.children[1]+"'"];else{if("node_op"!==t.type||"op_extvalue"!==t.value)throw new Error("Syntax error: Invalid left-hand side of assignment.");i=[this.compile(t.children[0],e),"node_const"===t.children[1].type?t.children[1].value:this.compile(t.children[1],e)]}return i},execute:function(t){var e,i,r,n,s,o,a,l,c,h,u=[];if(e=0,!t)return e;switch(this.line=t.line,this.col=t.col,t.type){case"node_op":switch(t.value){case"op_none":t.children[0]&&this.execute(t.children[0]),t.children[1]&&(e=this.execute(t.children[1]));break;case"op_assign":i=this.getLHS(t.children[0]),this.lhs[this.scope.id]=i.what,i.o.type&&i.o.elementClass&&i.o.methodMap&&"label"===i.what&&this._error("Left-hand side of assignment is read-only."),e=this.execute(t.children[1]),i.o!==this.scope.locals||_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isArray(i.o)&&"number"==typeof i.what?this.setProp(i.o,i.what,e):this.letvar(i.what,e),this.lhs[this.scope.id]=0;break;case"op_if":this.execute(t.children[0])&&(e=this.execute(t.children[1]));break;case"op_conditional":case"op_if_else":e=this.execute(t.children[0])?this.execute(t.children[1]):this.execute(t.children[2]);break;case"op_while":for(;this.execute(t.children[0]);)this.execute(t.children[1]);break;case"op_do":do{this.execute(t.children[0])}while(this.execute(t.children[1]));break;case"op_for":for(this.execute(t.children[0]);this.execute(t.children[1]);this.execute(t.children[2]))this.execute(t.children[3]);break;case"op_proplst":t.children[0]&&this.execute(t.children[0]),t.children[1]&&this.execute(t.children[1]);break;case"op_emptyobject":e={};break;case"op_proplst_val":this.propstack.push({}),this.propscope++,this.execute(t.children[0]),e=this.propstack[this.propscope],this.propstack.pop(),this.propscope--;break;case"op_prop":this.propstack[this.propscope][t.children[0]]=this.execute(t.children[1]);break;case"op_array":for(e=[],s=t.children[0].length,r=0;r<s;r++)e.push(this.execute(t.children[0][r]));break;case"op_extvalue":e=this.execute(t.children[0]),e="number"==typeof(r=this.execute(t.children[1]))&&Math.abs(Math.round(r)-r)<_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.eps?e[r]:void 0;break;case"op_return":if(0!==this.scope)return this.execute(t.children[0]);this._error("Unexpected return.");break;case"op_map":t.children[1].isMath||"node_var"===t.children[1].type||this._error("execute: In a map only function calls and mathematical expressions are allowed."),(l=this.defineFunction(t)).isMap=!0,e=l;break;case"op_function":(l=this.defineFunction(t)).isMap=!1,e=l;break;case"op_execfun":if(this.dpstack.push([]),this.pscope++,o=t.children[1],_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t.children[2]))if(t.children[3])for(a=t.children[2],c={},r=0;r<a.length;r++)c=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.deepCopy(c,this.execute(a[r]),!0);else c=this.execute(t.children[2]);for(t.children[0]._isFunctionName=!0,l=this.execute(t.children[0]),delete t.children[0]._isFunctionName,h=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(l)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(l.sc)?l.sc:this,!l.creator&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t.children[2])&&this._error("Unexpected value. Only element creators are allowed to have a value after the function call."),r=0;r<o.length;r++)_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(l.scope)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(l.scope.argtypes)&&"function"===l.scope.argtypes[r]?(o[r]._isFunctionName=!0,u[r]=this.execute(o[r]),delete o[r]._isFunctionName):u[r]=this.execute(o[r]),this.dpstack[this.pscope].push({line:t.children[1][r].line,col:t.children[1][r].ecol});if("function"!=typeof l||l.creator)if("function"==typeof l&&l.creator){n=this.line;try{for((e=l(u,c)).jcLineStart=n,e.jcLineEnd=t.eline,r=n;r<=t.line;r++)this.lineToElement[r]=e;e.debugParents=this.dpstack[this.pscope]}catch(t){this._error(t.toString())}}else this._error("Function '"+l+"' is undefined.");else e=l.apply(h,u);this.dpstack.pop(),this.pscope--;break;case"op_property":n=this.execute(t.children[0]),i=t.children[1],e=this.resolveProperty(n,i,!1),_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(e)&&["number","string","boolean"].indexOf(typeof e)<0&&(e.sc=n);break;case"op_use":this._warn("Use of the 'use' operator is deprecated."),this.use(t.children[0].toString());break;case"op_delete":this._warn("Use of the 'delete' operator is deprecated. Please use the remove() function."),i=this.getvar(t.children[0]),e=this.del(i);break;case"op_eq":e=this.execute(t.children[0])==this.execute(t.children[1]);break;case"op_neq":e=this.execute(t.children[0])!=this.execute(t.children[1]);break;case"op_approx":e=Math.abs(this.execute(t.children[0])-this.execute(t.children[1]))<_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.eps;break;case"op_gt":e=this.execute(t.children[0])>this.execute(t.children[1]);break;case"op_lt":e=this.execute(t.children[0])<this.execute(t.children[1]);break;case"op_geq":e=this.execute(t.children[0])>=this.execute(t.children[1]);break;case"op_leq":e=this.execute(t.children[0])<=this.execute(t.children[1]);break;case"op_or":e=this.execute(t.children[0])||this.execute(t.children[1]);break;case"op_and":e=this.execute(t.children[0])&&this.execute(t.children[1]);break;case"op_not":e=!this.execute(t.children[0]);break;case"op_add":e=this.add(this.execute(t.children[0]),this.execute(t.children[1]));break;case"op_sub":e=this.sub(this.execute(t.children[0]),this.execute(t.children[1]));break;case"op_div":e=this.div(this.execute(t.children[0]),this.execute(t.children[1]));break;case"op_mod":e=this.mod(this.execute(t.children[0]),this.execute(t.children[1]),!0);break;case"op_mul":e=this.mul(this.execute(t.children[0]),this.execute(t.children[1]));break;case"op_exp":e=this.pow(this.execute(t.children[0]),this.execute(t.children[1]));break;case"op_neg":e=this.neg(this.execute(t.children[0]))}break;case"node_var":e=this.getvar(t.value,!1,t._isFunctionName);break;case"node_const":e=null===t.value?null:Number(t.value);break;case"node_const_bool":e=t.value;break;case"node_str":e=t.value.replace(/\\(.)/g,"$1")}return e},compile:function(t,e){var i,r,n,s="";if(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(e)||(e=!1),!t)return s;switch(t.type){case"node_op":switch(t.value){case"op_none":t.children[0]&&(s=this.compile(t.children[0],e)),t.children[1]&&(s+=this.compile(t.children[1],e));break;case"op_assign":e?(i=this.getLHSCompiler(t.children[0],e),_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isArray(i)?s="$jc$.setProp("+i[0]+", "+i[1]+", "+this.compile(t.children[1],e)+");\n":(this.isLocalVariable(i)!==this.scope&&(this.scope.locals[i]=!0),s="$jc$.scopes["+this.scope.id+"].locals['"+i+"'] = "+this.compile(t.children[1],e)+";\n")):s=(i=this.compile(t.children[0]))+" = "+this.compile(t.children[1],e)+";\n";break;case"op_if":s=" if ("+this.compile(t.children[0],e)+") "+this.compile(t.children[1],e);break;case"op_if_else":s=" if ("+this.compile(t.children[0],e)+")"+this.compile(t.children[1],e),s+=" else "+this.compile(t.children[2],e);break;case"op_conditional":s="(("+this.compile(t.children[0],e)+")?("+this.compile(t.children[1],e),s+="):("+this.compile(t.children[2],e)+"))";break;case"op_while":s=" while ("+this.compile(t.children[0],e)+") {\n"+this.compile(t.children[1],e)+"}\n";break;case"op_do":s=" do {\n"+this.compile(t.children[0],e)+"} while ("+this.compile(t.children[1],e)+");\n";break;case"op_for":s=" for ("+this.compile(t.children[0],e)+this.compile(t.children[1],e)+"; "+this.compile(t.children[2],e).slice(0,-2)+") {\n"+this.compile(t.children[3],e)+"\n}\n";break;case"op_proplst":t.children[0]&&(s=this.compile(t.children[0],e)+", "),s+=this.compile(t.children[1],e);break;case"op_prop":s=t.children[0]+": "+this.compile(t.children[1],e);break;case"op_emptyobject":s=e?"{}":"<< >>";break;case"op_proplst_val":s=this.compile(t.children[0],e);break;case"op_array":for(n=[],r=0;r<t.children[0].length;r++)n.push(this.compile(t.children[0][r],e));s="["+n.join(", ")+"]";break;case"op_extvalue":s=this.compile(t.children[0],e)+"["+this.compile(t.children[1],e)+"]";break;case"op_return":s=" return "+this.compile(t.children[0],e)+";\n";break;case"op_map":t.children[1].isMath||"node_var"===t.children[1].type||this._error("compile: In a map only function calls and mathematical expressions are allowed."),n=t.children[0],s=e?" $jc$.makeMap(function ("+n.join(", ")+") { return "+this.compile(t.children[1],e)+"; })":"map ("+n.join(", ")+") -> "+this.compile(t.children[1],e);break;case"op_function":n=t.children[0],this.pushScope(n),s=e?this.functionCodeJS(t):" function ("+n.join(", ")+") "+this.compile(t.children[1],e),this.popScope();break;case"op_execfunmath":console.log("op_execfunmath: TODO"),s="-1";break;case"op_execfun":if(t.children[2]){for(n=[],r=0;r<t.children[2].length;r++)n.push(this.compile(t.children[2][r],e));i=e?"$jc$.mergeAttributes("+n.join(", ")+")":n.join(", ")}for(t.children[0].withProps=!!t.children[2],n=[],r=0;r<t.children[1].length;r++)n.push(this.compile(t.children[1][r],e));s=this.compile(t.children[0],e)+"("+n.join(", ")+(t.children[2]&&e?", "+i:"")+")"+(t.children[2]&&!e?" "+i:""),e&&(s+="\n"),e&&"$"===t.children[0].value&&(s="$jc$.board.objects["+this.compile(t.children[1][0],e)+"]");break;case"op_property":s=e&&"X"!==t.children[1]&&"Y"!==t.children[1]?"$jc$.resolveProperty("+this.compile(t.children[0],e)+", '"+t.children[1]+"', true)":this.compile(t.children[0],e)+"."+t.children[1];break;case"op_use":this._warn("Use of the 'use' operator is deprecated."),s=e?"$jc$.use('":"use('",s+=t.children[0].toString()+"');";break;case"op_delete":this._warn("Use of the 'delete' operator is deprecated. Please use the remove() function."),s=e?"$jc$.del(":"remove(",s+=this.compile(t.children[0],e)+")";break;case"op_eq":s="("+this.compile(t.children[0],e)+" === "+this.compile(t.children[1],e)+")";break;case"op_neq":s="("+this.compile(t.children[0],e)+" !== "+this.compile(t.children[1],e)+")";break;case"op_approx":s="("+this.compile(t.children[0],e)+" ~= "+this.compile(t.children[1],e)+")";break;case"op_gt":s=e?"$jc$.gt("+this.compile(t.children[0],e)+", "+this.compile(t.children[1],e)+")":"("+this.compile(t.children[0],e)+" > "+this.compile(t.children[1],e)+")";break;case"op_lt":s=e?"$jc$.lt("+this.compile(t.children[0],e)+", "+this.compile(t.children[1],e)+")":"("+this.compile(t.children[0],e)+" < "+this.compile(t.children[1],e)+")";break;case"op_geq":s=e?"$jc$.geq("+this.compile(t.children[0],e)+", "+this.compile(t.children[1],e)+")":"("+this.compile(t.children[0],e)+" >= "+this.compile(t.children[1],e)+")";break;case"op_leq":s=e?"$jc$.leq("+this.compile(t.children[0],e)+", "+this.compile(t.children[1],e)+")":"("+this.compile(t.children[0],e)+" <= "+this.compile(t.children[1],e)+")";break;case"op_or":s="("+this.compile(t.children[0],e)+" || "+this.compile(t.children[1],e)+")";break;case"op_and":s="("+this.compile(t.children[0],e)+" && "+this.compile(t.children[1],e)+")";break;case"op_not":s="!("+this.compile(t.children[0],e)+")";break;case"op_add":s=e?"$jc$.add("+this.compile(t.children[0],e)+", "+this.compile(t.children[1],e)+")":"("+this.compile(t.children[0],e)+" + "+this.compile(t.children[1],e)+")";break;case"op_sub":s=e?"$jc$.sub("+this.compile(t.children[0],e)+", "+this.compile(t.children[1],e)+")":"("+this.compile(t.children[0],e)+" - "+this.compile(t.children[1],e)+")";break;case"op_div":s=e?"$jc$.div("+this.compile(t.children[0],e)+", "+this.compile(t.children[1],e)+")":"("+this.compile(t.children[0],e)+" / "+this.compile(t.children[1],e)+")";break;case"op_mod":s=e?"$jc$.mod("+this.compile(t.children[0],e)+", "+this.compile(t.children[1],e)+", true)":"("+this.compile(t.children[0],e)+" % "+this.compile(t.children[1],e)+")";break;case"op_mul":s=e?"$jc$.mul("+this.compile(t.children[0],e)+", "+this.compile(t.children[1],e)+")":"("+this.compile(t.children[0],e)+" * "+this.compile(t.children[1],e)+")";break;case"op_exp":s=e?"$jc$.pow("+this.compile(t.children[0],e)+", "+this.compile(t.children[1],e)+")":"("+this.compile(t.children[0],e)+"^"+this.compile(t.children[1],e)+")";break;case"op_neg":s=e?"$jc$.neg("+this.compile(t.children[0],e)+")":"(-"+this.compile(t.children[0],e)+")"}break;case"node_var":s=e?this.getvarJS(t.value,!1,t.withProps):t.value;break;case"node_const":case"node_const_bool":s=t.value;break;case"node_str":s="'"+t.value+"'"}return t.needsBrackets&&(s="{\n"+s+" }\n"),t.needsAngleBrackets&&(s=e?"{\n"+s+" }\n":"<< "+s+" >>\n"),s},getName:function(t,e){var i="";return _utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t.getName)?(i=t.getName(),_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(i)&&""!==i||!e||(i=t.id)):e&&(i=t.id),i},X:function(t){return t.X()},Y:function(t){return t.Y()},V:function(t){return t.Value()},L:function(t){return t.L()},area:function(t){return _utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t.Area)||this._error("Error: Can't calculate area."),t.Area()},perimeter:function(t){return _utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t.Perimeter)||this._error("Error: Can't calculate perimeter."),t.Perimeter()},dist:function(t,e){return _utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t.Dist)||this._error("Error: Can't calculate distance."),t.Dist(e)},radius:function(t){return _utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t.Radius)||this._error("Error: Can't calculate radius."),t.Radius()},slope:function(t){return _utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(t.Slope)||this._error("Error: Can't calculate slope."),t.Slope()},add:function(t,e){var i,r,n;if(t=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.evalSlider(t),e=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.evalSlider(e),_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(t)||_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(e))n=_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.add(t,e);else if(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isArray(t)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isArray(e))for(r=Math.min(t.length,e.length),n=[],i=0;i<r;i++)n[i]=t[i]+e[i];else _utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isNumber(t)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isNumber(e)?n=t+e:_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isString(t)||_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isString(e)?n=t.toString()+e.toString():this._error("Operation + not defined on operands "+typeof t+" and "+typeof e);return n},sub:function(t,e){var i,r,n;if(t=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.evalSlider(t),e=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.evalSlider(e),_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(t)||_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(e))n=_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.sub(t,e);else if(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isArray(t)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isArray(e))for(r=Math.min(t.length,e.length),n=[],i=0;i<r;i++)n[i]=t[i]-e[i];else _utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isNumber(t)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isNumber(e)?n=t-e:this._error("Operation - not defined on operands "+typeof t+" and "+typeof e);return n},neg:function(t){var e,i,r;if(t=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.evalSlider(t),_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(t))r=_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.negative(t);else if(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isArray(t))for(i=t.length,r=[],e=0;e<i;e++)r[e]=-t[e];else _utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isNumber(t)?r=-t:this._error("Unary operation - not defined on operand "+typeof t);return r},mul:function(t,e){var i,r,n;if(t=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.evalSlider(t),e=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.evalSlider(e),_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isArray(t)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isNumber(e)&&(i=t,e=t=e),_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(t)||_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(e))n=_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.mul(t,e);else if(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isArray(t)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isArray(e))r=Math.min(t.length,e.length),n=_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.innerProduct(t,e,r);else if(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isNumber(t)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isArray(e))for(r=e.length,n=[],i=0;i<r;i++)n[i]=t*e[i];else _utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isNumber(t)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isNumber(e)?n=t*e:this._error("Operation * not defined on operands "+typeof t+" and "+typeof e);return n},div:function(t,e){var i,r,n;if(t=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.evalSlider(t),e=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.evalSlider(e),_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(t)||_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(e))n=_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.div(t,e);else if(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isArray(t)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isNumber(e))for(r=t.length,n=[],i=0;i<r;i++)n[i]=t[i]/e;else _utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isNumber(t)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isNumber(e)?n=t/e:this._error("Operation * not defined on operands "+typeof t+" and "+typeof e);return n},mod:function(t,e){var i,r,n;if(t=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.evalSlider(t),e=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.evalSlider(e),_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(t)||_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(e))return _math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.fmod(t,e);if(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isArray(t)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isNumber(e))for(r=t.length,n=[],i=0;i<r;i++)n[i]=_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.mod(t[i],e,!0);else _utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isNumber(t)&&_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.isNumber(e)?n=_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.mod(t,e,!0):this._error("Operation * not defined on operands "+typeof t+" and "+typeof e);return n},pow:function(t,e){return t=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.evalSlider(t),e=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.evalSlider(e),_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(t)||_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(e)?_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.pow(t,e):_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.pow(t,e)},lt:function(t,e){return _math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(t)||_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(e)?_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.lt(t,e):t<e},leq:function(t,e){return _math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(t)||_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(e)?_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.leq(t,e):t<=e},gt:function(t,e){return _math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(t)||_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(e)?_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.gt(t,e):t>e},geq:function(t,e){return _math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(t)||_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.isInterval(e)?_math_ia_js__WEBPACK_IMPORTED_MODULE_4__.A.geq(t,e):t>=e},randint:function(t,e,i){return _utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(i)||(i=1),Math.round(Math.random()*(e-t)/i)*i+t},DDD:function(t){console.log("Dummy derivative function. This should never appear!")},ifthen:function(t,e,i){return t?e:i},del:function(t){"object"==typeof t&&_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.exists(t.type)&&_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.exists(t.elementClass)&&this.board.removeObject(t)},eval:function(t){return _jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.evaluate(t)},use:function(t){var e,i,r=!1;if("string"==typeof t){for(e in _jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.boards)if(_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.boards.hasOwnProperty(e)&&_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.boards[e].container===t){i=_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.boards[e],r=!0;break}}else i=t,r=!0;r?(this.board=i,this.builtIn.$board=i,this.builtIn.$board.src="$jc$.board"):this._error("Board '"+t+"' not found!")},findSymbol:function(t,e){var i,r;for(r=-1===(e=_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.def(e,-1))?this.scope:this.scopes[e];null!==r;){for(i in r.locals)if(r.locals.hasOwnProperty(i)&&r.locals[i]===t)return[i,r];r=r.previous}return[]},importModule:function(t){return priv.modules[t.toLowerCase()]},defineBuiltIn:function(){var t=this,e={PI:Math.PI,EULER:Math.E,D:t.DDD,X:t.X,Y:t.Y,V:t.V,Value:t.V,L:t.L,Length:t.L,acosh:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.acosh,acot:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.acot,asinh:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.asinh,binomial:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.binomial,cbrt:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.cbrt,cosh:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.cosh,cot:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.cot,deg:_math_geometry_js__WEBPACK_IMPORTED_MODULE_5__.A.trueAngle,A:t.area,area:t.area,Area:t.area,perimeter:t.perimeter,Perimeter:t.perimeter,dist:t.dist,Dist:t.dist,R:t.radius,radius:t.radius,Radius:t.radius,erf:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.erf,erfc:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.erfc,erfi:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.erfi,factorial:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.factorial,gcd:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.gcd,lb:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.log2,lcm:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.lcm,ld:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.log2,lg:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.log10,ln:Math.log,log:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.log,log10:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.log10,log2:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.log2,ndtr:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.ndtr,ndtri:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.ndtri,nthroot:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.nthroot,pow:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.pow,rad:_math_geometry_js__WEBPACK_IMPORTED_MODULE_5__.A.rad,ratpow:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.ratpow,trunc:_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.trunc,sinh:_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A.sinh,slope:t.slope,Slope:t.slope,randint:t.randint,IfThen:t.ifthen,import:t.importModule,eval:t.eval,use:t.use,remove:t.del,$:t.getElementById,$value:function(e){return t.getElementById(e).Value()},getName:t.getName,name:t.getName,$board:t.board,$log:t.log};return e.rad.sc=_math_geometry_js__WEBPACK_IMPORTED_MODULE_5__.A,e.deg.sc=_math_geometry_js__WEBPACK_IMPORTED_MODULE_5__.A,e.factorial.sc=_math_math_js__WEBPACK_IMPORTED_MODULE_3__.A,e.X.src="$jc$.X",e.Y.src="$jc$.Y",e.V.src="$jc$.V",e.Value.src="$jc$.V",e.L.src="$jc$.L",e.Length.src="$jc$.L",e.acosh.src="JXG.Math.acosh",e.acot.src="JXG.Math.acot",e.asinh.src="JXG.Math.asinh",e.binomial.src="JXG.Math.binomial",e.cbrt.src="JXG.Math.cbrt",e.cot.src="JXG.Math.cot",e.cosh.src="JXG.Math.cosh",e.deg.src="JXG.Math.Geometry.trueAngle",e.erf.src="JXG.Math.erf",e.erfc.src="JXG.Math.erfc",e.erfi.src="JXG.Math.erfi",e.A.src="$jc$.area",e.area.src="$jc$.area",e.Area.src="$jc$.area",e.perimeter.src="$jc$.perimeter",e.Perimeter.src="$jc$.perimeter",e.dist.src="$jc$.dist",e.Dist.src="$jc$.dist",e.R.src="$jc$.radius",e.radius.src="$jc$.radius",e.Radius.src="$jc$.radius",e.factorial.src="JXG.Math.factorial",e.gcd.src="JXG.Math.gcd",e.lb.src="JXG.Math.log2",e.lcm.src="JXG.Math.lcm",e.ld.src="JXG.Math.log2",e.lg.src="JXG.Math.log10",e.ln.src="Math.log",e.log.src="JXG.Math.log",e.log10.src="JXG.Math.log10",e.log2.src="JXG.Math.log2",e.ndtr.src="JXG.Math.ndtr",e.ndtri.src="JXG.Math.ndtri",e.nthroot.src="JXG.Math.nthroot",e.pow.src="JXG.Math.pow",e.rad.src="JXG.Math.Geometry.rad",e.ratpow.src="JXG.Math.ratpow",e.trunc.src="JXG.trunc",e.sinh.src="JXG.Math.sinh",e.slope.src="$jc$.slope",e.Slope.src="$jc$.slope",e.randint.src="$jc$.randint",e.import.src="$jc$.importModule",e.eval.src="$jc$.eval",e.use.src="$jc$.use",e.remove.src="$jc$.del",e.IfThen.src="$jc$.ifthen",e.$.src="(function (n) { return $jc$.board.select(n); })",e.$value.src="(function (n) { return $jc$.board.select(n).Value(); })",e.getName.src="$jc$.getName",e.name.src="$jc$.getName",e.$board&&(e.$board.src="$jc$.board"),e.$log.src="$jc$.log",_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.merge(e,t._addedBuiltIn)},_addedBuiltIn:{},addBuiltIn:function(t,e){if(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(this.builtIn)){if(_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(this.builtIn[t]))return;this.builtIn[t]=e,this.builtIn[t].src="$jc$."+t}_utils_type_js__WEBPACK_IMPORTED_MODULE_7__.A.exists(this._addedBuiltIn[t])||(this._addedBuiltIn[t]=e,this._addedBuiltIn[t].src="$jc$."+t,_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.JessieCode.prototype[t]=e)},getPossibleOperands:function(){var t,e,i,r,n,s,o,a,l,c,h,u,d,p,f=["E"],m=this.builtIn||this.defineBuiltIn(),g=Math;for(d=function(t,e){return t.toLowerCase().localeCompare(e.toLowerCase())},p=function(t,e){var i=null;if("jc"===e)i=m[t];else{if("Math"!==e)return;i=g[t]}if(!(f.indexOf(t)>=0))return _jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.isFunction(i)?{name:t,type:"function",numParams:i.length,origin:e}:_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.isNumber(i)?{name:t,type:"constant",value:i,origin:e}:void(t.startsWith("$")||void 0!==i&&console.error("undefined type",i))},t=Object.getOwnPropertyNames(m).sort(d),e=Object.getOwnPropertyNames(g).sort(d),i=[],r=0,n=0;r<t.length||n<e.length;)t[r]===e[n]?(s=p(e[n],"Math"),_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.exists(s)&&i.push(s),r++,n++):!_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.exists(e[n])||t[r].toLowerCase().localeCompare(e[n].toLowerCase())<0?(s=p(t[r],"jc"),_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.exists(s)&&i.push(s),r++):(s=p(e[n],"Math"),_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.exists(s)&&i.push(s),n++);for(l=[],c=[],h=[],u={},o=i.length,r=0;r<o;r++){switch((a=i[r]).type){case"function":l.push(a.name),"jc"===a.origin&&c.push(a.name);break;case"constant":h.push(a.name)}u[a.name]=a}return{all:u,list:i,functions:l,functions_jessiecode:c,constants:h}},_debug:function(t){"object"==typeof console?console.log(t):_utils_env_js__WEBPACK_IMPORTED_MODULE_8__.A.isBrowser&&document&&null!==document.getElementById("debug")&&(document.getElementById("debug").innerHTML+=t+"<br />")},_error:function(t){var e=new Error("Error("+this.line+"): "+t);throw e.line=this.line,e},_warn:function(t){"object"==typeof console?console.log("Warning("+this.line+"): "+t):_utils_env_js__WEBPACK_IMPORTED_MODULE_8__.A.isBrowser&&document&&null!==document.getElementById(this.warnLog)&&(document.getElementById(this.warnLog).innerHTML+="Warning("+this.line+"): "+t+"<br />")},_log:function(t){"object"!=typeof window&&"object"==typeof self&&self.postMessage?self.postMessage({type:"log",msg:"Log: "+t.toString()}):console.log("Log: ",arguments)}});var parser=function(){var t=function(t,e,i,r){for(i=i||{},r=t.length;r--;i[t[r]]=e);return i},e=[2,14],i=[1,13],r=[1,37],n=[1,14],s=[1,15],o=[1,21],a=[1,16],l=[1,17],c=[1,33],h=[1,18],u=[1,19],d=[1,12],p=[1,59],f=[1,60],m=[1,58],g=[1,46],_=[1,48],v=[1,49],y=[1,50],b=[1,51],A=[1,52],x=[1,53],C=[1,54],E=[1,45],M=[1,38],S=[1,39],w=[5,7,8,14,15,16,17,19,20,21,23,26,27,50,51,58,65,74,75,76,77,78,79,80,82,91,93],P=[5,7,8,12,14,15,16,17,19,20,21,23,26,27,50,51,58,65,74,75,76,77,78,79,80,82,91,93],T=[8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,83,86],O=[2,48],R=[1,72],N=[10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,66,83,86],L=[1,78],D=[8,10,16,32,34,35,37,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,83,86],k=[1,82],I=[8,10,16,32,34,35,37,39,45,46,47,48,50,51,53,54,55,57,64,65,66,83,86],B=[1,83],U=[1,84],F=[1,85],j=[8,10,16,32,34,35,37,39,41,42,43,50,51,53,54,55,57,64,65,66,83,86],V=[1,89],z=[1,90],G=[1,91],H=[1,92],Y=[1,97],X=[8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,53,54,55,57,64,65,66,83,86],W=[1,103],J=[1,104],$=[8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,57,64,65,66,83,86],q=[1,105],K=[1,106],Z=[1,107],Q=[1,126],tt=[1,139],et=[83,86],it=[1,150],rt=[10,66,86],nt=[8,10,16,20,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,82,83,86],st=[1,167],ot=[10,86],at={trace:function(){},yy:{},symbols_:{error:2,Program:3,StatementList:4,EOF:5,IfStatement:6,IF:7,"(":8,Expression:9,")":10,Statement:11,ELSE:12,LoopStatement:13,WHILE:14,FOR:15,";":16,DO:17,UnaryStatement:18,USE:19,IDENTIFIER:20,DELETE:21,ReturnStatement:22,RETURN:23,EmptyStatement:24,StatementBlock:25,"{":26,"}":27,ExpressionStatement:28,AssignmentExpression:29,ConditionalExpression:30,LeftHandSideExpression:31,"=":32,LogicalORExpression:33,"?":34,":":35,LogicalANDExpression:36,"||":37,EqualityExpression:38,"&&":39,RelationalExpression:40,"==":41,"!=":42,"~=":43,AdditiveExpression:44,"<":45,">":46,"<=":47,">=":48,MultiplicativeExpression:49,"+":50,"-":51,UnaryExpression:52,"*":53,"/":54,"%":55,ExponentExpression:56,"^":57,"!":58,MemberExpression:59,CallExpression:60,PrimaryExpression:61,FunctionExpression:62,MapExpression:63,".":64,"[":65,"]":66,BasicLiteral:67,ObjectLiteral:68,ArrayLiteral:69,NullLiteral:70,BooleanLiteral:71,StringLiteral:72,NumberLiteral:73,NULL:74,TRUE:75,FALSE:76,STRING:77,NUMBER:78,NAN:79,INFINITY:80,ElementList:81,"<<":82,">>":83,PropertyList:84,Property:85,",":86,PropertyName:87,Arguments:88,AttributeList:89,Attribute:90,FUNCTION:91,ParameterDefinitionList:92,MAP:93,"->":94,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"IF",8:"(",10:")",12:"ELSE",14:"WHILE",15:"FOR",16:";",17:"DO",19:"USE",20:"IDENTIFIER",21:"DELETE",23:"RETURN",26:"{",27:"}",32:"=",34:"?",35:":",37:"||",39:"&&",41:"==",42:"!=",43:"~=",45:"<",46:">",47:"<=",48:">=",50:"+",51:"-",53:"*",54:"/",55:"%",57:"^",58:"!",64:".",65:"[",66:"]",74:"NULL",75:"TRUE",76:"FALSE",77:"STRING",78:"NUMBER",79:"NAN",80:"INFINITY",82:"<<",83:">>",86:",",91:"FUNCTION",93:"MAP",94:"->"},productions_:[0,[3,2],[6,5],[6,7],[13,5],[13,9],[13,7],[18,2],[18,2],[22,2],[22,3],[24,1],[25,3],[4,2],[4,0],[11,1],[11,1],[11,1],[11,1],[11,1],[11,1],[11,1],[28,2],[9,1],[29,1],[29,3],[30,1],[30,5],[33,1],[33,3],[36,1],[36,3],[38,1],[38,3],[38,3],[38,3],[40,1],[40,3],[40,3],[40,3],[40,3],[44,1],[44,3],[44,3],[49,1],[49,3],[49,3],[49,3],[56,1],[56,3],[52,1],[52,2],[52,2],[52,2],[31,1],[31,1],[59,1],[59,1],[59,1],[59,3],[59,4],[61,1],[61,1],[61,1],[61,1],[61,3],[67,1],[67,1],[67,1],[67,1],[70,1],[71,1],[71,1],[72,1],[73,1],[73,1],[73,1],[69,2],[69,3],[68,2],[68,3],[84,1],[84,3],[85,3],[87,1],[87,1],[87,1],[60,2],[60,3],[60,2],[60,4],[60,3],[88,2],[88,3],[89,1],[89,3],[90,1],[90,1],[81,1],[81,3],[62,4],[62,5],[63,5],[63,6],[92,1],[92,3]],performAction:function(t,e,i,r,n,s,o){var a=s.length-1;switch(n){case 1:return s[a-1];case 2:this.$=lt.createNode(ct(o[a-4]),"node_op","op_if",s[a-2],s[a]);break;case 3:this.$=lt.createNode(ct(o[a-6]),"node_op","op_if_else",s[a-4],s[a-2],s[a]);break;case 4:this.$=lt.createNode(ct(o[a-4]),"node_op","op_while",s[a-2],s[a]);break;case 5:this.$=lt.createNode(ct(o[a-8]),"node_op","op_for",s[a-6],s[a-4],s[a-2],s[a]);break;case 6:this.$=lt.createNode(ct(o[a-6]),"node_op","op_do",s[a-5],s[a-2]);break;case 7:this.$=lt.createNode(ct(o[a-1]),"node_op","op_use",s[a]);break;case 8:this.$=lt.createNode(ct(o[a-1]),"node_op","op_delete",s[a]);break;case 9:this.$=lt.createNode(ct(o[a-1]),"node_op","op_return",void 0);break;case 10:this.$=lt.createNode(ct(o[a-2]),"node_op","op_return",s[a-1]);break;case 11:case 14:this.$=lt.createNode(ct(o[a]),"node_op","op_none");break;case 12:this.$=s[a-1],this.$.needsBrackets=!0;break;case 13:this.$=lt.createNode(ct(o[a-1]),"node_op","op_none",s[a-1],s[a]);break;case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 23:case 24:case 26:case 28:case 30:case 32:case 36:case 41:case 44:case 48:case 50:case 52:case 54:case 55:case 56:case 58:case 62:case 81:case 84:case 85:case 86:this.$=s[a];break;case 22:case 65:case 93:this.$=s[a-1];break;case 25:this.$=lt.createNode(ct(o[a-2]),"node_op","op_assign",s[a-2],s[a]),this.$.isMath=!1;break;case 27:this.$=lt.createNode(ct(o[a-4]),"node_op","op_conditional",s[a-4],s[a-2],s[a]),this.$.isMath=!1;break;case 29:this.$=lt.createNode(ct(o[a-2]),"node_op","op_or",s[a-2],s[a]),this.$.isMath=!1;break;case 31:this.$=lt.createNode(ct(o[a-2]),"node_op","op_and",s[a-2],s[a]),this.$.isMath=!1;break;case 33:this.$=lt.createNode(ct(o[a-2]),"node_op","op_eq",s[a-2],s[a]),this.$.isMath=!1;break;case 34:this.$=lt.createNode(ct(o[a-2]),"node_op","op_neq",s[a-2],s[a]),this.$.isMath=!1;break;case 35:this.$=lt.createNode(ct(o[a-2]),"node_op","op_approx",s[a-2],s[a]),this.$.isMath=!1;break;case 37:this.$=lt.createNode(ct(o[a-2]),"node_op","op_lt",s[a-2],s[a]),this.$.isMath=!1;break;case 38:this.$=lt.createNode(ct(o[a-2]),"node_op","op_gt",s[a-2],s[a]),this.$.isMath=!1;break;case 39:this.$=lt.createNode(ct(o[a-2]),"node_op","op_leq",s[a-2],s[a]),this.$.isMath=!1;break;case 40:this.$=lt.createNode(ct(o[a-2]),"node_op","op_geq",s[a-2],s[a]),this.$.isMath=!1;break;case 42:this.$=lt.createNode(ct(o[a-2]),"node_op","op_add",s[a-2],s[a]),this.$.isMath=!0;break;case 43:this.$=lt.createNode(ct(o[a-2]),"node_op","op_sub",s[a-2],s[a]),this.$.isMath=!0;break;case 45:this.$=lt.createNode(ct(o[a-2]),"node_op","op_mul",s[a-2],s[a]),this.$.isMath=!0;break;case 46:this.$=lt.createNode(ct(o[a-2]),"node_op","op_div",s[a-2],s[a]),this.$.isMath=!0;break;case 47:this.$=lt.createNode(ct(o[a-2]),"node_op","op_mod",s[a-2],s[a]),this.$.isMath=!0;break;case 49:this.$=lt.createNode(ct(o[a-2]),"node_op","op_exp",s[a-2],s[a]),this.$.isMath=!0;break;case 51:this.$=lt.createNode(ct(o[a-1]),"node_op","op_not",s[a]),this.$.isMath=!1;break;case 53:this.$=lt.createNode(ct(o[a-1]),"node_op","op_neg",s[a]),this.$.isMath=!0;break;case 57:case 63:case 64:case 66:case 67:case 68:case 97:this.$=s[a],this.$.isMath=!1;break;case 59:case 91:this.$=lt.createNode(ct(o[a-2]),"node_op","op_property",s[a-2],s[a]),this.$.isMath=!0;break;case 60:case 90:this.$=lt.createNode(ct(o[a-3]),"node_op","op_extvalue",s[a-3],s[a-1]),this.$.isMath=!0;break;case 61:this.$=lt.createNode(ct(o[a]),"node_var",s[a]);break;case 69:this.$=s[a],this.$.isMath=!0;break;case 70:this.$=lt.createNode(ct(o[a]),"node_const",null);break;case 71:this.$=lt.createNode(ct(o[a]),"node_const_bool",!0);break;case 72:this.$=lt.createNode(ct(o[a]),"node_const_bool",!1);break;case 73:this.$=lt.createNode(ct(o[a]),"node_str",s[a].substring(1,s[a].length-1));break;case 74:this.$=lt.createNode(ct(o[a]),"node_const",parseFloat(s[a]));break;case 75:this.$=lt.createNode(ct(o[a]),"node_const",NaN);break;case 76:this.$=lt.createNode(ct(o[a]),"node_const",1/0);break;case 77:this.$=lt.createNode(ct(o[a-1]),"node_op","op_array",[]);break;case 78:this.$=lt.createNode(ct(o[a-2]),"node_op","op_array",s[a-1]);break;case 79:this.$=lt.createNode(ct(o[a-1]),"node_op","op_emptyobject",{}),this.$.needsAngleBrackets=!0;break;case 80:this.$=lt.createNode(ct(o[a-2]),"node_op","op_proplst_val",s[a-1]),this.$.needsAngleBrackets=!0;break;case 82:this.$=lt.createNode(ct(o[a-2]),"node_op","op_proplst",s[a-2],s[a]);break;case 83:this.$=lt.createNode(ct(o[a-2]),"node_op","op_prop",s[a-2],s[a]);break;case 87:case 89:this.$=lt.createNode(ct(o[a-1]),"node_op","op_execfun",s[a-1],s[a]),this.$.isMath=!0;break;case 88:this.$=lt.createNode(ct(o[a-2]),"node_op","op_execfun",s[a-2],s[a-1],s[a],!0),this.$.isMath=!1;break;case 92:this.$=[];break;case 94:case 98:case 104:this.$=[s[a]];break;case 95:case 99:case 105:this.$=s[a-2].concat(s[a]);break;case 96:this.$=lt.createNode(ct(o[a]),"node_var",s[a]),this.$.isMath=!0;break;case 100:this.$=lt.createNode(ct(o[a-3]),"node_op","op_function",[],s[a]),this.$.isMath=!1;break;case 101:this.$=lt.createNode(ct(o[a-4]),"node_op","op_function",s[a-2],s[a]),this.$.isMath=!1;break;case 102:this.$=lt.createNode(ct(o[a-4]),"node_op","op_map",[],s[a]);break;case 103:this.$=lt.createNode(ct(o[a-5]),"node_op","op_map",s[a-3],s[a])}},table:[t([5,7,8,14,15,16,17,19,20,21,23,26,50,51,58,65,74,75,76,77,78,79,80,82,91,93],e,{3:1,4:2}),{1:[3]},{5:[1,3],6:6,7:i,8:r,9:20,11:4,13:7,14:n,15:s,16:o,17:a,18:8,19:l,20:c,21:h,22:9,23:u,24:11,25:5,26:d,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{1:[2,1]},t(w,[2,13]),t(P,[2,15]),t(P,[2,16]),t(P,[2,17]),t(P,[2,18]),t(P,[2,19]),t(P,[2,20]),t(P,[2,21]),t([7,8,14,15,16,17,19,20,21,23,26,27,50,51,58,65,74,75,76,77,78,79,80,82,91,93],e,{4:61}),{8:[1,62]},{8:[1,63]},{8:[1,64]},{6:6,7:i,8:r,9:20,11:65,13:7,14:n,15:s,16:o,17:a,18:8,19:l,20:c,21:h,22:9,23:u,24:11,25:5,26:d,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{20:[1,66]},{20:[1,67]},{8:r,9:69,16:[1,68],20:c,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{16:[1,70]},t(P,[2,11]),t(T,[2,23]),t(T,[2,24]),t([8,10,16,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,64,65,66,83,86],O,{32:[1,71],57:R}),t([8,10,16,32,35,39,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,83,86],[2,26],{34:[1,73],37:[1,74]}),t(N,[2,54],{88:77,8:L,64:[1,75],65:[1,76]}),t(N,[2,55],{88:79,8:L,64:[1,81],65:[1,80]}),t(D,[2,28],{39:k}),t(T,[2,56]),t(T,[2,57]),t(T,[2,58]),t(I,[2,30],{41:B,42:U,43:F}),t(T,[2,61]),t(T,[2,62]),t(T,[2,63]),t(T,[2,64]),{8:r,9:86,20:c,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:[1,87]},{8:[1,88]},t(j,[2,32],{45:V,46:z,47:G,48:H}),t(T,[2,66]),t(T,[2,67]),t(T,[2,68]),t(T,[2,69]),{20:Y,72:98,73:99,77:b,78:A,79:x,80:C,83:[1,93],84:94,85:95,87:96},{8:r,20:c,29:102,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,66:[1,100],67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,81:101,82:E,91:M,93:S},t(X,[2,36],{50:W,51:J}),t(T,[2,70]),t(T,[2,71]),t(T,[2,72]),t(T,[2,73]),t(T,[2,74]),t(T,[2,75]),t(T,[2,76]),t($,[2,41],{53:q,54:K,55:Z}),t(T,[2,44]),t(T,[2,50]),{8:r,20:c,31:109,50:p,51:f,52:108,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,20:c,31:109,50:p,51:f,52:110,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,20:c,31:109,50:p,51:f,52:111,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{6:6,7:i,8:r,9:20,11:4,13:7,14:n,15:s,16:o,17:a,18:8,19:l,20:c,21:h,22:9,23:u,24:11,25:5,26:d,27:[1,112],28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,9:113,20:c,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,9:114,20:c,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,9:115,20:c,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{14:[1,116]},t(P,[2,7]),t(P,[2,8]),t(P,[2,9]),{16:[1,117]},t(P,[2,22]),{8:r,20:c,29:118,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,20:c,31:109,50:p,51:f,52:119,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,20:c,29:120,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,20:c,31:109,36:121,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{20:[1,122]},{8:r,9:123,20:c,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},t(T,[2,87],{89:124,90:125,68:127,20:Q,82:E}),{8:r,10:[1,128],20:c,29:102,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,81:129,82:E,91:M,93:S},t(T,[2,89]),{8:r,9:130,20:c,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{20:[1,131]},{8:r,20:c,31:109,38:132,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,20:c,31:109,40:133,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,20:c,31:109,40:134,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,20:c,31:109,40:135,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{10:[1,136]},{10:[1,137],20:tt,92:138},{10:[1,140],20:tt,92:141},{8:r,20:c,31:109,44:142,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,20:c,31:109,44:143,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,20:c,31:109,44:144,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,20:c,31:109,44:145,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},t(T,[2,79]),{83:[1,146],86:[1,147]},t(et,[2,81]),{35:[1,148]},{35:[2,84]},{35:[2,85]},{35:[2,86]},t(T,[2,77]),{66:[1,149],86:it},t(rt,[2,98]),{8:r,20:c,31:109,49:151,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,20:c,31:109,49:152,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,20:c,31:109,50:p,51:f,52:153,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,20:c,31:109,50:p,51:f,52:154,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,20:c,31:109,50:p,51:f,52:155,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},t(T,[2,51]),t([8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,64,65,66,83,86],O,{57:R}),t(T,[2,52]),t(T,[2,53]),t([5,7,8,10,12,14,15,16,17,19,20,21,23,26,27,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,58,64,65,66,74,75,76,77,78,79,80,82,83,86,91,93],[2,12]),{10:[1,156]},{10:[1,157]},{16:[1,158]},{8:[1,159]},t(P,[2,10]),t(T,[2,25]),t(T,[2,49]),{35:[1,160]},t(D,[2,29],{39:k}),t(T,[2,59]),{66:[1,161]},t([8,10,16,32,34,35,37,39,41,42,43,45,46,47,48,50,51,53,54,55,57,64,65,66,83],[2,88],{86:[1,162]}),t(T,[2,94]),t(T,[2,96]),t(T,[2,97]),t(nt,[2,92]),{10:[1,163],86:it},{66:[1,164]},t(T,[2,91]),t(I,[2,31],{41:B,42:U,43:F}),t(j,[2,33],{45:V,46:z,47:G,48:H}),t(j,[2,34],{45:V,46:z,47:G,48:H}),t(j,[2,35],{45:V,46:z,47:G,48:H}),t(T,[2,65]),{25:165,26:d},{10:[1,166],86:st},t(ot,[2,104]),{94:[1,168]},{10:[1,169],86:st},t(X,[2,37],{50:W,51:J}),t(X,[2,38],{50:W,51:J}),t(X,[2,39],{50:W,51:J}),t(X,[2,40],{50:W,51:J}),t(T,[2,80]),{20:Y,72:98,73:99,77:b,78:A,79:x,80:C,85:170,87:96},{8:r,20:c,29:171,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},t(T,[2,78]),{8:r,20:c,29:172,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},t($,[2,42],{53:q,54:K,55:Z}),t($,[2,43],{53:q,54:K,55:Z}),t(T,[2,45]),t(T,[2,46]),t(T,[2,47]),{6:6,7:i,8:r,9:20,11:173,13:7,14:n,15:s,16:o,17:a,18:8,19:l,20:c,21:h,22:9,23:u,24:11,25:5,26:d,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{6:6,7:i,8:r,9:20,11:174,13:7,14:n,15:s,16:o,17:a,18:8,19:l,20:c,21:h,22:9,23:u,24:11,25:5,26:d,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,9:175,20:c,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,9:176,20:c,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,20:c,29:177,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},t(T,[2,60]),{20:Q,68:127,82:E,90:178},t(nt,[2,93]),t(T,[2,90]),t(T,[2,100]),{25:179,26:d},{20:[1,180]},{8:r,9:181,20:c,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{94:[1,182]},t(et,[2,82]),t(et,[2,83]),t(rt,[2,99]),t(w,[2,2],{12:[1,183]}),t(P,[2,4]),{16:[1,184]},{10:[1,185]},t(T,[2,27]),t(T,[2,95]),t(T,[2,101]),t(ot,[2,105]),t(T,[2,102]),{8:r,9:186,20:c,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{6:6,7:i,8:r,9:20,11:187,13:7,14:n,15:s,16:o,17:a,18:8,19:l,20:c,21:h,22:9,23:u,24:11,25:5,26:d,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{8:r,9:188,20:c,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},{16:[1,189]},t(T,[2,103]),t(P,[2,3]),{10:[1,190]},t(P,[2,6]),{6:6,7:i,8:r,9:20,11:191,13:7,14:n,15:s,16:o,17:a,18:8,19:l,20:c,21:h,22:9,23:u,24:11,25:5,26:d,28:10,29:22,30:23,31:24,33:25,36:28,38:32,40:40,44:47,49:55,50:p,51:f,52:56,56:57,58:m,59:26,60:27,61:29,62:30,63:31,65:g,67:34,68:35,69:36,70:41,71:42,72:43,73:44,74:_,75:v,76:y,77:b,78:A,79:x,80:C,82:E,91:M,93:S},t(P,[2,5])],defaultActions:{3:[2,1],97:[2,84],98:[2,85],99:[2,86]},parseError:function(t,e){if(!e.recoverable){var i=new Error(t);throw i.hash=e,i}this.trace(t)},parse:function(t){var e=this,i=[0],r=[null],n=[],s=this.table,o="",a=0,l=0,c=0,h=n.slice.call(arguments,1),u=Object.create(this.lexer),d={yy:{}};for(var p in this.yy)Object.prototype.hasOwnProperty.call(this.yy,p)&&(d.yy[p]=this.yy[p]);u.setInput(t,d.yy),d.yy.lexer=u,d.yy.parser=this,void 0===u.yylloc&&(u.yylloc={});var f=u.yylloc;n.push(f);var m,g=u.options&&u.options.ranges;"function"==typeof d.yy.parseError?this.parseError=d.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var _,v,y,b,A,x,C,E,M,S={};;){if(y=i[i.length-1],this.defaultActions[y]?b=this.defaultActions[y]:(null==_&&(m=void 0,"number"!=typeof(m=u.lex()||1)&&(m=e.symbols_[m]||m),_=m),b=s[y]&&s[y][_]),void 0===b||!b.length||!b[0]){var w;for(x in M=[],s[y])this.terminals_[x]&&x>2&&M.push("'"+this.terminals_[x]+"'");w=u.showPosition?"Parse error on line "+(a+1)+":\n"+u.showPosition()+"\nExpecting "+M.join(", ")+", got '"+(this.terminals_[_]||_)+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==_?"end of input":"'"+(this.terminals_[_]||_)+"'"),this.parseError(w,{text:u.match,token:this.terminals_[_]||_,line:u.yylineno,loc:f,expected:M})}if(b[0]instanceof Array&&b.length>1)throw new Error("Parse Error: multiple actions possible at state: "+y+", token: "+_);switch(b[0]){case 1:i.push(_),r.push(u.yytext),n.push(u.yylloc),i.push(b[1]),_=null,v?(_=v,v=null):(l=u.yyleng,o=u.yytext,a=u.yylineno,f=u.yylloc,c>0&&c--);break;case 2:if(C=this.productions_[b[1]][1],S.$=r[r.length-C],S._$={first_line:n[n.length-(C||1)].first_line,last_line:n[n.length-1].last_line,first_column:n[n.length-(C||1)].first_column,last_column:n[n.length-1].last_column},g&&(S._$.range=[n[n.length-(C||1)].range[0],n[n.length-1].range[1]]),void 0!==(A=this.performAction.apply(S,[o,l,a,d.yy,b[1],r,n].concat(h))))return A;C&&(i=i.slice(0,-1*C*2),r=r.slice(0,-1*C),n=n.slice(0,-1*C)),i.push(this.productions_[b[1]][0]),r.push(S.$),n.push(S._$),E=s[i[i.length-2]][i[i.length-1]],i.push(E);break;case 3:return!0}}return!0}},lt={node:function(t,e,i){return{type:t,value:e,children:i}},createNode:function(t,e,i,r){var n,s=this.node(e,i,[]);for(n=3;n<arguments.length;n++)s.children.push(arguments[n]);return s.line=t[0],s.col=t[1],s.eline=t[2],s.ecol=t[3],s}},ct=function(t){return[t.first_line,t.first_column,t.last_line,t.last_column]},ht=function(){var t={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t,e){return this.yy=e||this.yy||{},this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];return this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t,t.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,i=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e),this.offset-=e;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var n=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===r.length?this.yylloc.first_column:0)+r[r.length-i.length].length-i[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[n[0],n[0]+this.yyleng-e]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},test_match:function(t,e){var i,r,n;if(this.options.backtrack_lexer&&(n={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(n.yylloc.range=this.yylloc.range.slice(0))),(r=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],i=this.performAction.call(this,this.yy,this,e,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),i)return i;if(this._backtrack){for(var s in n)this[s]=n[s];return!1}return!1},next:function(){if(this.done)return this.EOF;var t,e,i,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var n=this._currentRules(),s=0;s<n.length;s++)if((i=this._input.match(this.rules[n[s]]))&&(!e||i[0].length>e[0].length)){if(e=i,r=s,this.options.backtrack_lexer){if(!1!==(t=this.test_match(i,n[s])))return t;if(this._backtrack){e=!1;continue}return!1}if(!this.options.flex)break}return e?!1!==(t=this.test_match(e,n[r]))&&t:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){return this.next()||this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return(t=this.conditionStack.length-1-Math.abs(t||0))>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,e,i,r){switch(i){case 0:case 6:case 7:break;case 1:case 2:case 3:return 78;case 4:case 5:return 77;case 8:return 7;case 9:return 12;case 10:return 14;case 11:return 17;case 12:return 15;case 13:return 91;case 14:return 93;case 15:return 19;case 16:return 23;case 17:return 21;case 18:return 75;case 19:return 76;case 20:return 74;case 21:return 80;case 22:case 23:return 94;case 24:return 82;case 25:return 83;case 26:return 26;case 27:return 27;case 28:return 16;case 29:return"#";case 30:return 34;case 31:return 35;case 32:return 79;case 33:return 64;case 34:return 65;case 35:return 66;case 36:return 8;case 37:return 10;case 38:return 58;case 39:case 40:return 57;case 41:return 53;case 42:return 54;case 43:return 55;case 44:return 50;case 45:return 51;case 46:return 47;case 47:return 45;case 48:return 48;case 49:return 46;case 50:return 41;case 51:return 43;case 52:return 42;case 53:return 39;case 54:return 37;case 55:return 32;case 56:return 86;case 57:return 5;case 58:return 20;case 59:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:[0-9]*\.?[0-9]+([eE][-+]?[0-9]+))/,/^(?:[0-9]+\.[0-9]*|[0-9]*\.[0-9]+\b)/,/^(?:[0-9]+)/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:\/\/.*)/,/^(?:\/\*(.|\n|\r)*?\*\/)/,/^(?:if\b)/,/^(?:else\b)/,/^(?:while\b)/,/^(?:do\b)/,/^(?:for\b)/,/^(?:function\b)/,/^(?:map\b)/,/^(?:use\b)/,/^(?:return\b)/,/^(?:delete\b)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:Infinity\b)/,/^(?:->)/,/^(?:=>)/,/^(?:<<)/,/^(?:>>)/,/^(?:\{)/,/^(?:\})/,/^(?:;)/,/^(?:#)/,/^(?:\?)/,/^(?::)/,/^(?:NaN\b)/,/^(?:\.)/,/^(?:\[)/,/^(?:\])/,/^(?:\()/,/^(?:\))/,/^(?:!)/,/^(?:\^)/,/^(?:\*\*)/,/^(?:\*)/,/^(?:\/)/,/^(?:%)/,/^(?:\+)/,/^(?:-)/,/^(?:<=)/,/^(?:<)/,/^(?:>=)/,/^(?:>)/,/^(?:==)/,/^(?:~=)/,/^(?:!=)/,/^(?:&&)/,/^(?:\|\|)/,/^(?:=)/,/^(?:,)/,/^(?:$)/,/^(?:[A-Za-z_\$][A-Za-z0-9_]*)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],inclusive:!0}}};return t}();function ut(){this.yy={}}return at.lexer=ht,ut.prototype=at,at.Parser=ut,new ut}();parser.yy.parseError=parser.parseError;const __WEBPACK_DEFAULT_EXPORT__=_jxg_js__WEBPACK_IMPORTED_MODULE_0__.A.JessieCode},228:t=>{var e=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(t){r[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,n){for(var s,o,a=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),l=1;l<arguments.length;l++){for(var c in s=Object(arguments[l]))i.call(s,c)&&(a[c]=s[c]);if(e){o=e(s);for(var h=0;h<o.length;h++)r.call(s,o[h])&&(a[o[h]]=s[o[h]])}}return a}},234:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(84),n=i(9);r.A.extendConstants(r.A,{}),r.A.extend(r.A,{isTouchEvent:function(t){return r.A.exists(t.touches)},isPointerEvent:function(t){return r.A.exists(t.pointerId)},isMouseEvent:function(t){return!r.A.isTouchEvent(t)&&!r.A.isPointerEvent(t)},getNumberOfTouchPoints:function(t){var e=-1;return r.A.isTouchEvent(t)&&(e=t.touches.length),e},isFirstTouch:function(t){var e=r.A.getNumberOfTouchPoints(t);return r.A.isPointerEvent(t)?t.isPrimary:1===e},isBrowser:"object"==typeof window&&"object"==typeof document,supportsES6:function(){try{return new Function("(a = 0) => a"),!0}catch(t){return!1}},supportsVML:function(){return this.isBrowser&&!!document.namespaces},supportsSVG:function(){return!!this.isBrowser&&!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect},supportsCanvas:function(){var t=!1;return this.isNode()&&(t=!0),t||this.isBrowser&&!!document.createElement("canvas").getContext},isNode:function(){return!this.isBrowser&&"undefined"!=typeof process&&-1!==process.release.name.search(/node|io.js/)},isWebWorker:function(){return!this.isBrowser&&"object"==typeof self&&"function"==typeof self.postMessage},supportsPointerEvents:function(){return!!(this.isBrowser&&window.navigator&&(window.PointerEvent||window.navigator.pointerEnabled||window.navigator.msPointerEnabled))},isTouchDevice:function(){return this.isBrowser&&void 0!==window.ontouchstart},isAndroid:function(){return n.A.exists(navigator)&&navigator.userAgent.toLowerCase().indexOf("android")>-1},isWebkitAndroid:function(){return this.isAndroid()&&navigator.userAgent.indexOf(" AppleWebKit/")>-1},isApple:function(){return n.A.exists(navigator)&&(navigator.userAgent.indexOf("iPad")>-1||navigator.userAgent.indexOf("iPhone")>-1)},isWebkitApple:function(){return this.isApple()&&navigator.userAgent.search(/Mobile\/[0-9A-Za-z.]*Safari/)>-1},isMetroApp:function(){return"object"==typeof window&&window.clientInformation&&window.clientInformation.appVersion&&window.clientInformation.appVersion.indexOf("MSAppHost")>-1},isMozilla:function(){return n.A.exists(navigator)&&navigator.userAgent.toLowerCase().indexOf("mozilla")>-1&&-1===navigator.userAgent.toLowerCase().indexOf("apple")},isFirefoxOS:function(){return n.A.exists(navigator)&&-1===navigator.userAgent.toLowerCase().indexOf("android")&&-1===navigator.userAgent.toLowerCase().indexOf("apple")&&navigator.userAgent.toLowerCase().indexOf("mobile")>-1&&navigator.userAgent.toLowerCase().indexOf("mozilla")>-1},isDesktop:function(){return!0},isMobile:function(){return!0},ieVersion:function(){var t,e,i=3;if("object"!=typeof document)return 0;e=(t=document.createElement("div")).getElementsByTagName("i");do{t.innerHTML="\x3c!--[if gt IE "+ ++i+"]><i></i><![endif]--\x3e"}while(e[0]);return i>4?i:void 0}(),getDimensions:function(t,e){var i,r,s,o,a,l,c,h,u,d=/\d+(\.\d*)?px/;if(!this.isBrowser||null===t)return{width:500,height:500};if(e=e||document,i=n.A.isString(t)?e.getElementById(t):t,!n.A.exists(i))throw new Error("\nJSXGraph: HTML container element '"+t+"' not found.");return"none"!==(r=i.style.display)&&null!==r?i.clientWidth>0&&i.clientHeight>0?{width:i.clientWidth,height:i.clientHeight}:(u=window.getComputedStyle?window.getComputedStyle(i):i.style,{width:d.test(u.width)?parseFloat(u.width):0,height:d.test(u.height)?parseFloat(u.height):0}):(o=(s=i.style).visibility,a=s.position,l=s.display,s.visibility="hidden",s.position="absolute",s.display="block",c=i.clientWidth,h=i.clientHeight,s.display=l,s.position=a,s.visibility=o,{width:c,height:h})},addEvent:function(t,e,i,r,s){var o=function(){return i.apply(r,arguments)};o.origin=i,"object"==typeof r&&n.A.exists(r.BOARD_MODE_NONE)&&(r["x_internal"+e]=r["x_internal"+e]||[],r["x_internal"+e].push(o)),n.A.exists(t)&&n.A.exists(t.addEventListener)&&(s=s||!1,t.addEventListener(e,o,s)),n.A.exists(t)&&n.A.exists(t.attachEvent)&&t.attachEvent("on"+e,o)},removeEvent:function(t,e,i,s){var o;if(n.A.exists(s))if(n.A.exists(s["x_internal"+e]))if(n.A.isArray(s["x_internal"+e]))if(-1!==(o=n.A.indexOf(s["x_internal"+e],i,"origin"))){try{n.A.exists(t)&&n.A.exists(t.removeEventListener)&&t.removeEventListener(e,s["x_internal"+e][o],!1),n.A.exists(t)&&n.A.exists(t.detachEvent)&&t.detachEvent("on"+e,s["x_internal"+e][o])}catch(t){r.A.debug("removeEvent: event not registered in browser: ("+e+" -- "+i+")")}s["x_internal"+e].splice(o,1)}else r.A.debug("removeEvent: no such event function in internal list: "+i);else r.A.debug("owner[x_internal + "+e+"] is not an array");else r.A.debug("removeEvent: no such type: "+e);else r.A.debug("no such owner")},removeAllEvents:function(t,e,i){var n;if(i["x_internal"+e]){for(n=i["x_internal"+e].length-1;n>=0;n--)r.A.removeEvent(t,e,i["x_internal"+e][n].origin,i);i["x_internal"+e].length>0&&r.A.debug("removeAllEvents: Not all events could be removed.")}},getPosition:function(t,e,i){var r,s,o,a=0,l=0;if(t||(t=window.event),i=i||document,o=t.touches,n.A.exists(o)&&0===o.length&&(o=t.changedTouches),n.A.exists(e)&&n.A.exists(o))if(-1===e){for(s=o.length,r=0;r<s;r++)if(o[r]){t=o[r];break}}else t=o[e];return t.clientX&&(a=t.clientX,l=t.clientY),[a,l]},getOffset:function(t){var e,i=t,r=t,n=i.offsetLeft-i.scrollLeft,s=i.offsetTop-i.scrollTop;for(n=(e=this.getCSSTransform([n,s],i))[0],s=e[1],i=i.offsetParent;i;){for(n+=i.offsetLeft,s+=i.offsetTop,i.offsetParent&&(n+=i.clientLeft-i.scrollLeft,s+=i.clientTop-i.scrollTop),n=(e=this.getCSSTransform([n,s],i))[0],s=e[1],r=r.parentNode;r!==i;)n+=r.clientLeft-r.scrollLeft,s+=r.clientTop-r.scrollTop,n=(e=this.getCSSTransform([n,s],r))[0],s=e[1],r=r.parentNode;i=i.offsetParent}return[n,s]},getStyle:function(t,e){var i,n=t.ownerDocument;return n.defaultView&&n.defaultView.getComputedStyle?i=n.defaultView.getComputedStyle(t,null).getPropertyValue(e):t.currentStyle&&r.A.ieVersion>=9?i=t.currentStyle[e]:t.style&&(e=e.replace(/-([a-z]|[0-9])/gi,(function(t,e){return e.toUpperCase()})),i=t.style[e]),i},getProp:function(t,e){var i=parseInt(this.getStyle(t,e),10);return isNaN(i)?0:i},getCSSTransform:function(t,e){var i,r,s,o,a,l,c,h=["transform","webkitTransform","MozTransform","msTransform","oTransform"];for(a=h.length,i=0,s="";i<a;i++)if(n.A.exists(e.style[h[i]])){s=e.style[h[i]];break}if(""!==s&&(o=s.indexOf("("))>0){for(a=s.length,r=0,l=(c=s.substring(o+1,a-1).split(",")).length;r<l;r++)c[r]=parseFloat(c[r]);0===s.indexOf("matrix")?(t[0]+=c[4],t[1]+=c[5]):0===s.indexOf("translateX")?t[0]+=c[0]:0===s.indexOf("translateY")?t[1]+=c[0]:0===s.indexOf("translate")&&(t[0]+=c[0],t[1]+=c[1])}return n.A.exists(e.style.zoom)&&""!==(s=e.style.zoom)&&(t[0]*=parseFloat(s),t[1]*=parseFloat(s)),t},getCSSTransformMatrix:function(t){var e,i,r,s,o,a,l,c,h=t.ownerDocument,u=["transform","webkitTransform","MozTransform","msTransform","oTransform"],d=[[1,0,0],[0,1,0],[0,0,1]];if(h.defaultView&&h.defaultView.getComputedStyle)r=(c=h.defaultView.getComputedStyle(t,null)).getPropertyValue("-webkit-transform")||c.getPropertyValue("-moz-transform")||c.getPropertyValue("-ms-transform")||c.getPropertyValue("-o-transform")||c.getPropertyValue("transform");else for(a=u.length,e=0,r="";e<a;e++)if(n.A.exists(t.style[u[e]])){r=t.style[u[e]];break}if(""!==r&&(o=r.indexOf("("))>0){for(a=r.length,i=0,l=(s=r.substring(o+1,a-1).split(",")).length;i<l;i++)s[i]=parseFloat(s[i]);0===r.indexOf("matrix")?d=[[1,0,0],[0,s[0],s[1]],[0,s[2],s[3]]]:0===r.indexOf("scaleX")?d[1][1]=s[0]:0===r.indexOf("scaleY")?d[2][2]=s[0]:0===r.indexOf("scale")&&(d[1][1]=s[0],d[2][2]=s[1])}return n.A.exists(t.style.zoom)&&""!==(r=t.style.zoom)&&(d[1][1]*=parseFloat(r),d[2][2]*=parseFloat(r)),d},timedChunk:function(t,e,i,r){var n=t.slice(),s=function(){var o=+new Date;do{e.call(i,n.shift())}while(n.length>0&&+new Date-o<300);n.length>0?window.setTimeout(s,1):r(t)};window.setTimeout(s,1)},scaleJSXGraphDiv:function(t,e,i,n){var s,o,a,l,c,h,u,d,p,f,m,g,_=n;for(o=(a=i.getElementById(t).getBoundingClientRect()).height,s=a.width,h=(d=i.getElementById(e))._cssFullscreenStore.w,m=(u=d._cssFullscreenStore.h)/h,h>s*_&&(u=(h=s*_)*m),u>o*_&&(h=(u=o*_)/m),l=h,p=m<o/s?s*_/h:o*_/u,f=.5*(o-(c=u)),g=0;g<4;g++)try{d.style.width=l+"px !important",d.style.height=c+"px !important",d.style.margin="0 auto",d.style.transform=d._cssFullscreenStore.transform+" matrix("+p+",0,0,"+p+",0,"+f+")";break}catch(t){r.A.debug("JXG.scaleJSXGraphDiv:\n"+t)}4===g&&r.A.debug("JXG.scaleJSXGraphDiv: Could not set any CSS property.")}});const s=r.A},287:(t,e,i)=>{var r=i(228),n=60103,s=60106;e.Fragment=60107,e.StrictMode=60108,e.Profiler=60114;var o=60109,a=60110,l=60112;e.Suspense=60113;var c=60115,h=60116;if("function"==typeof Symbol&&Symbol.for){var u=Symbol.for;n=u("react.element"),s=u("react.portal"),e.Fragment=u("react.fragment"),e.StrictMode=u("react.strict_mode"),e.Profiler=u("react.profiler"),o=u("react.provider"),a=u("react.context"),l=u("react.forward_ref"),e.Suspense=u("react.suspense"),c=u("react.memo"),h=u("react.lazy")}var d="function"==typeof Symbol&&Symbol.iterator;function p(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,i=1;i<arguments.length;i++)e+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m={};function g(t,e,i){this.props=t,this.context=e,this.refs=m,this.updater=i||f}function _(){}function v(t,e,i){this.props=t,this.context=e,this.refs=m,this.updater=i||f}g.prototype.isReactComponent={},g.prototype.setState=function(t,e){if("object"!=typeof t&&"function"!=typeof t&&null!=t)throw Error(p(85));this.updater.enqueueSetState(this,t,e,"setState")},g.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},_.prototype=g.prototype;var y=v.prototype=new _;y.constructor=v,r(y,g.prototype),y.isPureReactComponent=!0;var b={current:null},A=Object.prototype.hasOwnProperty,x={key:!0,ref:!0,__self:!0,__source:!0};function C(t,e,i){var r,s={},o=null,a=null;if(null!=e)for(r in void 0!==e.ref&&(a=e.ref),void 0!==e.key&&(o=""+e.key),e)A.call(e,r)&&!x.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(1===l)s.children=i;else if(1<l){for(var c=Array(l),h=0;h<l;h++)c[h]=arguments[h+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps)void 0===s[r]&&(s[r]=l[r]);return{$$typeof:n,type:t,key:o,ref:a,props:s,_owner:b.current}}function E(t){return"object"==typeof t&&null!==t&&t.$$typeof===n}var M=/\/+/g;function S(t,e){return"object"==typeof t&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,(function(t){return e[t]}))}(""+t.key):e.toString(36)}function w(t,e,i,r,o){var a=typeof t;"undefined"!==a&&"boolean"!==a||(t=null);var l=!1;if(null===t)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case n:case s:l=!0}}if(l)return o=o(l=t),t=""===r?"."+S(l,0):r,Array.isArray(o)?(i="",null!=t&&(i=t.replace(M,"$&/")+"/"),w(o,e,i,"",(function(t){return t}))):null!=o&&(E(o)&&(o=function(t,e){return{$$typeof:n,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}(o,i+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(M,"$&/")+"/")+t)),e.push(o)),1;if(l=0,r=""===r?".":r+":",Array.isArray(t))for(var c=0;c<t.length;c++){var h=r+S(a=t[c],c);l+=w(a,e,i,h,o)}else if(h=function(t){return null===t||"object"!=typeof t?null:"function"==typeof(t=d&&t[d]||t["@@iterator"])?t:null}(t),"function"==typeof h)for(t=h.call(t),c=0;!(a=t.next()).done;)l+=w(a=a.value,e,i,h=r+S(a,c++),o);else if("object"===a)throw e=""+t,Error(p(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e));return l}function P(t,e,i){if(null==t)return t;var r=[],n=0;return w(t,r,"","",(function(t){return e.call(i,t,n++)})),r}function T(t){if(-1===t._status){var e=t._result;e=e(),t._status=0,t._result=e,e.then((function(e){0===t._status&&(e=e.default,t._status=1,t._result=e)}),(function(e){0===t._status&&(t._status=2,t._result=e)}))}if(1===t._status)return t._result;throw t._result}var O={current:null};function R(){var t=O.current;if(null===t)throw Error(p(321));return t}var N={ReactCurrentDispatcher:O,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:b,IsSomeRendererActing:{current:!1},assign:r};e.Children={map:P,forEach:function(t,e,i){P(t,(function(){e.apply(this,arguments)}),i)},count:function(t){var e=0;return P(t,(function(){e++})),e},toArray:function(t){return P(t,(function(t){return t}))||[]},only:function(t){if(!E(t))throw Error(p(143));return t}},e.Component=g,e.PureComponent=v,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=N,e.cloneElement=function(t,e,i){if(null==t)throw Error(p(267,t));var s=r({},t.props),o=t.key,a=t.ref,l=t._owner;if(null!=e){if(void 0!==e.ref&&(a=e.ref,l=b.current),void 0!==e.key&&(o=""+e.key),t.type&&t.type.defaultProps)var c=t.type.defaultProps;for(h in e)A.call(e,h)&&!x.hasOwnProperty(h)&&(s[h]=void 0===e[h]&&void 0!==c?c[h]:e[h])}var h=arguments.length-2;if(1===h)s.children=i;else if(1<h){c=Array(h);for(var u=0;u<h;u++)c[u]=arguments[u+2];s.children=c}return{$$typeof:n,type:t.type,key:o,ref:a,props:s,_owner:l}},e.createContext=function(t,e){return void 0===e&&(e=null),(t={$$typeof:a,_calculateChangedBits:e,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:o,_context:t},t.Consumer=t},e.createElement=C,e.createFactory=function(t){var e=C.bind(null,t);return e.type=t,e},e.createRef=function(){return{current:null}},e.forwardRef=function(t){return{$$typeof:l,render:t}},e.isValidElement=E,e.lazy=function(t){return{$$typeof:h,_payload:{_status:-1,_result:t},_init:T}},e.memo=function(t,e){return{$$typeof:c,type:t,compare:void 0===e?null:e}},e.useCallback=function(t,e){return R().useCallback(t,e)},e.useContext=function(t,e){return R().useContext(t,e)},e.useDebugValue=function(){},e.useEffect=function(t,e){return R().useEffect(t,e)},e.useImperativeHandle=function(t,e,i){return R().useImperativeHandle(t,e,i)},e.useLayoutEffect=function(t,e){return R().useLayoutEffect(t,e)},e.useMemo=function(t,e){return R().useMemo(t,e)},e.useReducer=function(t,e,i){return R().useReducer(t,e,i)},e.useRef=function(t){return R().useRef(t)},e.useState=function(t){return R().useState(t)},e.version="17.0.2"},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",r=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),r&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),r&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,r,n,s){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(o[l]=!0)}for(var c=0;c<t.length;c++){var h=[].concat(t[c]);r&&o[h[0]]||(void 0!==s&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=s),i&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=i):h[2]=i),n&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=n):h[4]="".concat(n)),e.push(h))}},e}},320:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(84),n=i(9),s=i(156),o=i(159);r.A.Expect={each:function(t,e,i){var r,s,o=[];if(n.A.exists(t.length))for(s=t.length,r=0;r<s;r++)o.push(e.call(this,t[r],i));return o},coords:function(t,e){var i=t;return t&&t.elementClass===s.A.OBJECT_CLASS_POINT?i=t.coords:t.usrCoords&&t.scrCoords&&t.usr2screen&&(i=t),e&&(i=new o.A(s.A.COORDS_BY_USER,i.usrCoords,i.board)),i},coordsArray:function(t,e){var i;return(i=n.A.isArray(t)?t:this.coords(t).usrCoords).length<3&&i.unshift(1),e&&(i=[i[0],i[1],i[2]]),i}};const a=r.A.Expect},345:(t,e,i)=>{i.d(e,{A:()=>d});var r=i(84),n=i(156),s=i(159),o=i(174),a=i(959),l=i(761),c=i(805),h=i(194),u=i(9);r.A.GeometryElement=function(t,e,i,r){var s,o,a;if(this.needsUpdate=!0,this.isDraggable=!1,this.isReal=!0,this.childElements={},this.hasLabel=!1,this.highlighted=!1,this.notExistingParents={},this.traces={},this.numTraces=0,this.transformations=[],this.baseElement=null,this.descendants={},this.ancestors={},this.parents=[],this.symbolic={},this.rendNode=null,this.elType="",this.dump=!0,this.subs={},this.inherits=[],this._pos=-1,this.stdform=[1,0,0,0,1,1,0,0],this.methodMap={setLabel:"setLabel",label:"label",setName:"setName",getName:"getName",Name:"getName",addTransform:"addTransform",setProperty:"setAttribute",setAttribute:"setAttribute",addChild:"addChild",animate:"animate",on:"on",off:"off",trigger:"trigger",addTicks:"addTicks",removeTicks:"removeTicks",removeAllTicks:"removeAllTicks",Bounds:"bounds"},this.quadraticform=[[1,0,0],[0,1,0],[0,0,1]],this.visProp={},this.visPropCalc={visible:!1},c.A.eventify(this),this.mouseover=!1,this.lastDragTime=new Date,this.view=null,arguments.length>0){for(o in this.board=t,this.type=i,this._org_type=i,this.elementClass=r||n.A.OBJECT_CLASS_OTHER,this.id=e.id,s=e.name,u.A.exists(s)||(s=this.board.generateName(this)),""!==s&&(this.board.elementsByName[s]=this),this.name=s,this.needsRegularUpdate=e.needsregularupdate,u.A.clearVisPropOld(this),a=this.resolveShortcuts(e))a.hasOwnProperty(o)&&this._set(o,a[o]);this.visProp.draft=a.draft&&a.draft.draft}},r.A.extend(r.A.GeometryElement.prototype,{addChild:function(t){var e,i;for(e in this.childElements[t.id]=t,this.addDescendants(t),t.ancestors[this.id]=this,this.descendants)if(this.descendants.hasOwnProperty(e))for(i in this.descendants[e].ancestors[this.id]=this,this.ancestors)this.ancestors.hasOwnProperty(i)&&(this.descendants[e].ancestors[this.ancestors[i].id]=this.ancestors[i]);for(e in this.ancestors)if(this.ancestors.hasOwnProperty(e))for(i in this.descendants)this.descendants.hasOwnProperty(i)&&(this.ancestors[e].descendants[this.descendants[i].id]=this.descendants[i]);return this},addDescendants:function(t){var e;for(e in this.descendants[t.id]=t,t.childElements)t.childElements.hasOwnProperty(e)&&this.addDescendants(t.childElements[e]);return this},addParents:function(t){var e,i,r;for(i=(r=u.A.isArray(t)?t:arguments).length,e=0;e<i;++e)u.A.exists(r[e])&&(u.A.isId(this.board,r[e])?this.parents.push(r[e]):u.A.exists(r[e].id)&&this.parents.push(r[e].id));this.parents=u.A.uniqueArray(this.parents)},setParents:function(t){this.parents=[],this.addParents(t)},addParentsFromJCFunctions:function(t){var e,i,r;for(e=0;e<t.length;e++)for(i in t[e].deps)r=t[e].deps[i],this.addParents(r),r.addChild(this);return this},removeChild:function(t){return delete this.childElements[t.id],this.removeDescendants(t),delete t.ancestors[this.id],this},removeDescendants:function(t){var e;for(e in delete this.descendants[t.id],t.childElements)t.childElements.hasOwnProperty(e)&&this.removeDescendants(t.childElements[e]);return this},countChildren:function(){var t,e,i=0;for(t in e=this.childElements)e.hasOwnProperty(t)&&t.indexOf("Label")<0&&i++;return i},getName:function(){return this.name},addTransform:function(t){return this},draggable:function(){return this.isDraggable&&!this.evalVisProp("fixed")&&this.type!==n.A.OBJECT_TYPE_GLIDER},setPosition:function(t,e){var i,r,s,o,a=[];if(!u.A.exists(this.parents))return this;for(s=this.parents.length,r=0;r<s;++r)if(i=this.board.select(this.parents[r]),u.A.isPoint(i)){if(!i.draggable())return this;a.push(i)}if(3===e.length&&(e=e.slice(1)),o=this.board.create("transform",e,{type:"translate"}),(s=a.length)>0){if(o.applyOnce(a),u.A.exists(this.view)&&"view3d"===this.view.elType)for(r=0;r<this.parents.length;++r)i=this.view.select(this.parents[r]),u.A.exists(i.setPosition2D)&&i.setPosition2D(o)}else this.transformations.length>0&&this.transformations[this.transformations.length-1].isNumericMatrix?this.transformations[this.transformations.length-1].melt(o):this.addTransform(o);for(r=0;r<s;++r)a[r].type===n.A.OBJECT_TYPE_GLIDER&&a[r].updateGlider();return this},setPositionDirectly:function(t,e,i){var r=new s.A(t,e,this.board,!1),o=new s.A(t,i,this.board,!1),l=a.A.subtract(r.usrCoords,o.usrCoords);return this.setPosition(n.A.COORDS_BY_USER,l),this},generatePolynomial:function(){return[]},animate:function(t,e,i){i=i||{};var r,n,s,o=this.board.attr.animationdelay,a=Math.ceil(e/o),l=this,c=function(t,e,i){var r,n,o,c,u;for(r=h.A.rgb2hsv(t),o=((n=h.A.rgb2hsv(e))[0]-r[0])/a,c=(n[1]-r[1])/a,u=(n[2]-r[2])/a,l.animationData[i]=[],s=0;s<a;s++)l.animationData[i][a-s-1]=h.A.hsv2rgb(r[0]+(s+1)*o,r[1]+(s+1)*c,r[2]+(s+1)*u)},d=function(t,e,i,r){var n,o;if(t=parseFloat(t),e=parseFloat(e),!isNaN(t)&&!isNaN(e))for(o=(e-t)/a,l.animationData[i]=[],s=0;s<a;s++)n=t+(s+1)*o,l.animationData[i][a-s-1]=r?Math.floor(n):n};for(r in this.animationData={},t)if(t.hasOwnProperty(r))switch(n=r.toLowerCase()){case"strokecolor":case"fillcolor":c(this.visProp[n],t[r],n);break;case"size":if(!u.A.isPoint(this))break;d(this.visProp[n],t[r],n,!0);break;case"strokeopacity":case"strokewidth":case"fillopacity":d(this.visProp[n],t[r],n,!1)}return this.animationCallback=i.callback,this.board.addAnimation(this),this},update:function(){return this.evalVisProp("trace")&&this.cloneToBackground(),this},updateRenderer:function(){return this},fullUpdate:function(t){return this.prepareUpdate().update().updateVisibility(t).updateRenderer()},setDisplayRendNode:function(t){var e,i,r,n,s;if(void 0===t&&(t=this.visPropCalc.visible),t===this.visPropOld.visible)return this;for(this.board.renderer.display(this,t),i=this.inherits.length,r=0;r<i;r++)if(s=this.inherits[r],u.A.isArray(s))for(n=s.length,e=0;e<n;e++)u.A.exists(s[e])&&u.A.exists(s[e].rendNode)&&"inherit"===s[e].evalVisProp("visible")&&s[e].setDisplayRendNode(t);else u.A.exists(s)&&u.A.exists(s.rendNode)&&"inherit"===s.evalVisProp("visible")&&s.setDisplayRendNode(t);return this.hasLabel&&u.A.exists(this.label)&&u.A.exists(this.label.rendNode)&&"inherit"===this.label.evalVisProp("visible")&&this.label.setDisplayRendNode(t),this},hide:function(){return this.setAttribute({visible:!1}),this},hideElement:function(){return this.hide(),this},show:function(){return this.setAttribute({visible:!0}),this},showElement:function(){return this.show(),this},updateVisibility:function(t){var e,i,r,n,s,o;if(this.needsUpdate){if(u.A.exists(this.view)&&!1===this.view.evalVisProp("visible"))this.visPropCalc.visible=!1;else for(void 0!==t?this.visPropCalc.visible=t:(o=this.evalVisProp("visible"),u.A.exists(this.hiddenByParent)&&this.hiddenByParent&&(o=!1),"inherit"!==o&&(this.visPropCalc.visible=o)),i=this.inherits.length,r=0;r<i;r++)if(s=this.inherits[r],u.A.isArray(s))for(n=s.length,e=0;e<n;e++)u.A.exists(s[e])&&"inherit"===s[e].evalVisProp("visible")&&s[e].prepareUpdate().updateVisibility(this.visPropCalc.visible);else u.A.exists(s)&&"inherit"===s.evalVisProp("visible")&&s.prepareUpdate().updateVisibility(this.visPropCalc.visible);u.A.exists(this.label)&&u.A.exists(this.label.visProp)&&this.label.evalVisProp("visible")&&this.label.prepareUpdate().updateVisibility(this.visPropCalc.visible)}return this},_set:function(t,e){var i;if(t=t.toLocaleLowerCase(),this.visProp.hasOwnProperty(t)&&t.indexOf("color")>=0&&u.A.isString(e)&&9===e.length&&"#"===e.charAt(0))e=h.A.rgba2rgbo(e),this.visProp[t]=e[0],this.visProp[t.replace("color","opacity")]=e[1];else if(null===e||!u.A.isObject(e)||u.A.exists(e.id)||u.A.exists(e.name))this.visProp[t]=e;else for(i in this.visProp[t]={},e)e.hasOwnProperty(i)&&(this.visProp[t][i.toLocaleLowerCase()]=e[i])},resolveShortcuts:function(t){var e,i,r,n=["traceattributes","traceAttributes"];for(e in l.A.shortcuts)if(l.A.shortcuts.hasOwnProperty(e)){if(u.A.exists(t[e]))for(i=0;i<l.A.shortcuts[e].length;i++)u.A.exists(t[l.A.shortcuts[e][i]])||(t[l.A.shortcuts[e][i]]=t[e]);for(r=0;r<n.length;r++)u.A.isObject(t[n[r]])&&(t[n[r]]=this.resolveShortcuts(t[n[r]]))}return t},setLabel:function(t){this.hasLabel||this.setAttribute({withlabel:!0}),this.setLabelText(t)},setLabelText:function(t){return u.A.exists(this.label)&&(t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;"),this.label.setText(t)),this},setName:function(t){t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;"),"slider"!==this.elType&&this.setLabelText(t),this.setAttribute({name:t})},setProperty:function(){r.A.deprecated("setProperty()","setAttribute()"),this.setAttribute.apply(this,arguments)},setAttribute:function(t){var e,i,s,o,a,c,d,p,f,m={};for(e=0;e<arguments.length;e++)c=arguments[e],u.A.isString(c)?(p=c.split(":"),m[u.A.trim(p[0])]=u.A.trim(p[1])):u.A.isArray(c)?m[c[0]]=c[1]:r.A.extend(m,c);for(e in m=this.resolveShortcuts(m))if(m.hasOwnProperty(e)){if(o=e.replace(/\s+/g,"").toLowerCase(),a=m[e],u.A.isObject(a)&&u.A.exists(this.visProp[o])){if(!u.A.isObject(this.visProp[o])&&null!==a&&u.A.isObject(a)&&(this.visProp[o]={}),u.A.mergeAttr(this.visProp[o],a),this.type===n.A.OBJECT_TYPE_TICKS&&u.A.exists(this.labels))for(s=this.labels.length,i=0;i<s;i++)this.labels[i].setAttribute(a);else if(u.A.exists(this[o]))if(u.A.isArray(this[o]))for(i=0;i<this[o].length;i++)this[o][i].setAttribute(a);else this[o].setAttribute(a);else f=null,this.triggerEventHandlers(["attribute:"+o],[f,a,this]);continue}switch(f=this.visProp[o],o){case"checked":u.A.exists(this.rendNodeTag)&&(this.rendNodeCheckbox.checked=!!a);break;case"disabled":u.A.exists(this.rendNodeTag)&&(this.rendNodeTag.disabled=!!a);break;case"face":u.A.isPoint(this)&&(this.visProp.face=a,this.board.renderer.changePointStyle(this));break;case"generatelabelvalue":this.type===n.A.OBJECT_TYPE_TICKS&&u.A.isFunction(a)&&(this.generateLabelValue=a);break;case"gradient":this.visProp.gradient=a,this.board.renderer.setGradient(this);break;case"gradientsecondcolor":a=h.A.rgba2rgbo(a),this.visProp.gradientsecondcolor=a[0],this.visProp.gradientsecondopacity=a[1],this.board.renderer.updateGradient(this);break;case"gradientsecondopacity":this.visProp.gradientsecondopacity=a,this.board.renderer.updateGradient(this);break;case"infoboxtext":u.A.isString(a)?this.infoboxText=a:this.infoboxText=!1;break;case"labelcolor":d=(a=h.A.rgba2rgbo(a))[1],a=a[0],0===d&&u.A.exists(this.label)&&this.hasLabel&&this.label.hideElement(),u.A.exists(this.label)&&this.hasLabel&&(this.label.visProp.strokecolor=a,this.board.renderer.setObjectStrokeColor(this.label,a,d)),this.elementClass===n.A.OBJECT_CLASS_TEXT&&(this.visProp.strokecolor=a,this.visProp.strokeopacity=d,this.board.renderer.setObjectStrokeColor(this,a,d));break;case"layer":this.board.renderer.setLayer(this,this.eval(a)),this._set(o,a);break;case"maxlength":u.A.exists(this.rendNodeTag)&&(this.rendNodeTag.maxlength=!!a);break;case"name":f=this.name,delete this.board.elementsByName[this.name],this.name=a,this.board.elementsByName[this.name]=this;break;case"needsregularupdate":this.needsRegularUpdate=!("false"===a||!1===a),this.board.renderer.setBuffering(this,this.needsRegularUpdate?"auto":"static");break;case"onpolygon":this.type===n.A.OBJECT_TYPE_GLIDER&&(this.onPolygon=!!a);break;case"radius":this.type!==n.A.OBJECT_TYPE_ANGLE&&this.type!==n.A.OBJECT_TYPE_SECTOR||this.setRadius(a);break;case"rotate":(this.elementClass===n.A.OBJECT_CLASS_TEXT&&"internal"===this.evalVisProp("display")||this.type===n.A.OBJECT_TYPE_IMAGE)&&this.addRotation(a);break;case"tabindex":u.A.exists(this.rendNode)&&(this.rendNode.setAttribute("tabindex",a),this._set(o,a));break;case"trace":"false"===a||!1===a?(this.clearTrace(),this.visProp.trace=!1):this.visProp.trace="pause"!==a;break;case"visible":this.visProp.visible="false"!==a&&("true"===a||a),this.setDisplayRendNode(this.evalVisProp("visible")),this.evalVisProp("visible")&&u.A.exists(this.updateSize)&&this.updateSize();break;case"withlabel":this.visProp.withlabel=a,this.evalVisProp("withlabel")?(this.label||this.createLabel(),this.label.setAttribute({visible:"inherit"})):this.label&&this.hasLabel&&this.label.setAttribute({visible:!1}),this.hasLabel=a;break;case"straightfirst":case"straightlast":for(i in this._set(o,a),this.childElements)this.childElements.hasOwnProperty(i)&&"glider"===this.childElements[i].elType&&this.childElements[i].fullUpdate();break;default:u.A.exists(this.visProp[o])&&(!r.A.Validator[o]||r.A.Validator[o]&&r.A.Validator[o](a)||r.A.Validator[o]&&u.A.isFunction(a)&&r.A.Validator[o](a(this)))?(a=(!a.toLowerCase||"false"!==a.toLowerCase())&&a,this._set(o,a)):o in l.A.shortcuts||r.A.warn("attribute '"+o+"' does not accept type '"+typeof a+"' of value "+a+".")}this.triggerEventHandlers(["attribute:"+o],[f,a,this])}return this.triggerEventHandlers(["attribute"],[m,this]),this.evalVisProp("needsregularupdate")?this.board.update(this):this.board.fullUpdate(),this.elementClass===n.A.OBJECT_CLASS_TEXT&&this.updateSize(),this},getProperty:function(){r.A.deprecated("getProperty()","getAttribute()"),this.getProperty.apply(this,arguments)},getAttribute:function(t){var e;switch(t=t.toLowerCase()){case"needsregularupdate":e=this.needsRegularUpdate;break;case"labelcolor":e=this.label.visProp.strokecolor;break;case"infoboxtext":e=this.infoboxText;break;case"withlabel":e=this.hasLabel;break;default:e=this.visProp[t]}return e},evalVisProp:function(t){var e,i,n,s;if(-1===(t=t.toLowerCase()).indexOf("."))e=this.visProp[t];else for(s=(i=t.split(".")).length,e=this.visProp,n=0;n<s;n++)e=e[i[n]];return r.A.isFunction(e)?!0===this.visProp.islabel&&u.A.exists(this.visProp.anchor)?null!==this.visProp.anchor.visProp.element3d?e(this.visProp.anchor.visProp.element3d):e(this.visProp.anchor):r.A.exists(this.visProp.element3d)?e(this.visProp.element3d):e(this):e},eval:function(t){return r.A.isFunction(t)?!0===this.visProp.islabel&&u.A.exists(this.visProp.anchor)?null!==this.visProp.anchor.visProp.element3d?t(this.visProp.anchor.visProp.element3d):t(this.visProp.anchor):null!==this.visProp.element3d?t(this.visProp.element3d):t(this):t},setDash:function(t){return this.setAttribute({dash:t}),this},prepareUpdate:function(){return this.needsUpdate=!0,this},remove:function(){return this.board.renderer.remove(this.rendNode),this.hasLabel&&this.board.renderer.remove(this.board.renderer.getElementById(this.label.id)),this},getTextAnchor:function(){return new s.A(n.A.COORDS_BY_USER,[0,0],this.board)},getLabelAnchor:function(){return new s.A(n.A.COORDS_BY_USER,[0,0],this.board)},setArrow:function(t,e){return this.visProp.firstarrow=t,this.visProp.lastarrow=e,e&&(this.type=n.A.OBJECT_TYPE_VECTOR,this.elType="arrow"),this.prepareUpdate().update().updateVisibility().updateRenderer(),this},createGradient:function(){var t=this.evalVisProp("gradient");"linear"!==t&&"radial"!==t||this.board.renderer.setGradient(this)},createLabel:function(){var t,e=this;return r.A.elements.text?((t=u.A.deepCopy(this.visProp.label,null)).id=this.id+"Label",t.isLabel=!0,t.anchor=this,t.priv=this.visProp.priv,this.visProp.withlabel&&(this.label=r.A.elements.text(this.board,[0,0,function(){return u.A.isFunction(e.name)?e.name(e):e.name}],t),this.label.needsUpdate=!0,this.label.dump=!1,this.label.fullUpdate(),this.hasLabel=!0)):r.A.debug("JSXGraph: Can't create label: text element is not available. Make sure you include base/text"),this},highlight:function(t){return t=u.A.def(t,!1),!this.evalVisProp("highlight")||this.highlighted&&!t||(this.highlighted=!0,this.board.highlightedObjects[this.id]=this,this.board.renderer.highlight(this)),this},noHighlight:function(){return this.highlighted&&(this.highlighted=!1,delete this.board.highlightedObjects[this.id],this.board.renderer.noHighlight(this)),this},clearTrace:function(){var t;for(t in this.traces)this.traces.hasOwnProperty(t)&&this.board.renderer.remove(this.traces[t]);return this.numTraces=0,this},cloneToBackground:function(){return this},bounds:function(){return[0,0,0,0]},normalize:function(){return this.stdform=o.A.normalize(this.stdform),this},toJSON:function(){var t,e,i=['{"name":',this.name];for(e in i.push(', "id":'+this.id),t=[],this.visProp)this.visProp.hasOwnProperty(e)&&u.A.exists(this.visProp[e])&&t.push('"'+e+'":'+this.visProp[e]);return i.push(', "visProp":{'+t.toString()+"}"),i.push("}"),i.join("")},addRotation:function(t){var e,i,r,s,o,a=this;return this.elementClass!==n.A.OBJECT_CLASS_TEXT&&this.type!==n.A.OBJECT_TYPE_IMAGE||0===t||(e=this.board.create("transform",[function(){return-a.X()},function(){return-a.Y()}],{type:"translate"}),i=this.board.create("transform",[function(){return a.X()},function(){return a.Y()}],{type:"translate"}),r=this.board.create("transform",[function(){return a.board.unitX/a.board.unitY},function(){return 1}],{type:"scale"}),s=this.board.create("transform",[function(){return a.board.unitY/a.board.unitX},function(){return 1}],{type:"scale"}),o=this.board.create("transform",[function(){return a.eval(t)*Math.PI/180}],{type:"rotate"}),e.bindTo(this),r.bindTo(this),o.bindTo(this),s.bindTo(this),i.bindTo(this)),this},highlightStrokeColor:function(t){return r.A.deprecated("highlightStrokeColor()","setAttribute()"),this.setAttribute({highlightStrokeColor:t}),this},strokeColor:function(t){return r.A.deprecated("strokeColor()","setAttribute()"),this.setAttribute({strokeColor:t}),this},strokeWidth:function(t){return r.A.deprecated("strokeWidth()","setAttribute()"),this.setAttribute({strokeWidth:t}),this},fillColor:function(t){return r.A.deprecated("fillColor()","setAttribute()"),this.setAttribute({fillColor:t}),this},highlightFillColor:function(t){return r.A.deprecated("highlightFillColor()","setAttribute()"),this.setAttribute({highlightFillColor:t}),this},labelColor:function(t){return r.A.deprecated("labelColor()","setAttribute()"),this.setAttribute({labelColor:t}),this},dash:function(t){return r.A.deprecated("dash()","setAttribute()"),this.setAttribute({dash:t}),this},visible:function(t){return r.A.deprecated("visible()","setAttribute()"),this.setAttribute({visible:t}),this},shadow:function(t){return r.A.deprecated("shadow()","setAttribute()"),this.setAttribute({shadow:t}),this},getType:function(){return this.elType},getParents:function(){return u.A.isArray(this.parents)?this.parents:[]},snapToGrid:function(){return this},snapToPoints:function(){return this},getAttributes:function(){var t,e=u.A.deepCopy(this.visProp),i=[],r=i.length;for(e.id=this.id,e.name=this.name,t=0;t<r;t++)delete e[i[t]];return e},hasPoint:function(t,e){return!1},addTicks:function(t){return""!==t.id&&u.A.exists(t.id)||(t.id=this.id+"_ticks_"+(this.ticks.length+1)),this.board.renderer.drawTicks(t),this.ticks.push(t),t.id},removeAllTicks:function(){var t;if(u.A.exists(this.ticks)){for(t=this.ticks.length-1;t>=0;t--)this.removeTicks(this.ticks[t]);this.ticks=[],this.board.update()}},removeTicks:function(t){var e,i;if(u.A.exists(this.defaultTicks)&&this.defaultTicks===t&&(this.defaultTicks=null),u.A.exists(this.ticks))for(e=this.ticks.length-1;e>=0;e--)if(this.ticks[e]===t){if(this.board.removeObject(this.ticks[e]),this.ticks[e].ticks)for(i=0;i<this.ticks[e].ticks.length;i++)u.A.exists(this.ticks[e].labels[i])&&this.board.removeObject(this.ticks[e].labels[i]);delete this.ticks[e];break}},getSnapSizes:function(){var t,e,i;return t=this.evalVisProp("snapsizex"),e=this.evalVisProp("snapsizey"),t<=0&&this.board.defaultAxes&&this.board.defaultAxes.x.defaultTicks&&(t=(i=this.board.defaultAxes.x.defaultTicks).ticksDelta*(i.evalVisProp("minorticks")+1)),e<=0&&this.board.defaultAxes&&this.board.defaultAxes.y.defaultTicks&&(e=(i=this.board.defaultAxes.y.defaultTicks).ticksDelta*(i.evalVisProp("minorticks")+1)),[t,e]},handleSnapToGrid:function(t,e){var i,s,o,a,l,c,h,d,p,f,m,g=this.evalVisProp("attracttogrid"),_=this.evalVisProp("attractorunit"),v=this.evalVisProp("attractordistance");return!u.A.exists(this.coords)||this.evalVisProp("fixed")||(this.evalVisProp("snaptogrid")||g||!0===t)&&(i=this.coords.usrCoords[1],s=this.coords.usrCoords[2],f=(p=this.getSnapSizes())[0],m=p[1],f>0&&m>0&&(d=this.board.getBoundingBox(),o=Math.round(i/f)*f,a=Math.round(s/m)*m,l=new r.A.Coords(n.A.COORDS_BY_USER,[o,a],this.board),(!g||l.distance("screen"===_?n.A.COORDS_BY_SCREEN:n.A.COORDS_BY_USER,this.coords)<v)&&(i=o,s=a,e||(c=Math.min(d[0],d[2]),h=Math.max(d[0],d[2]),i<c&&i>c-f?i+=f:i>h&&i<h+f&&(i-=f),c=Math.min(d[1],d[3]),h=Math.max(d[1],d[3]),s<c&&s>c-m?s+=m:s>h&&s<h+m&&(s-=m)),this.coords.setCoordinates(n.A.COORDS_BY_USER,[i,s])))),this},getBoundingBox:function(){var t,e,i,r,s,o,a=[1/0,1/0,-1/0,-1/0];if(this.type===n.A.OBJECT_TYPE_POLYGON){if((e=this.vertices.length-1)<=0)return a;for(t=0;t<e;t++)i=this.vertices[t].X(),a[0]=i<a[0]?i:a[0],a[2]=i>a[2]?i:a[2],i=this.vertices[t].Y(),a[1]=i<a[1]?i:a[1],a[3]=i>a[3]?i:a[3]}else if(this.elementClass===n.A.OBJECT_CLASS_CIRCLE)r=this.center.X(),s=this.center.Y(),a=[r-this.radius,s+this.radius,r+this.radius,s-this.radius];else if(this.elementClass===n.A.OBJECT_CLASS_CURVE){if(0===(e=this.points.length))return a;for(t=0;t<e;t++)i=this.points[t].usrCoords[1],a[0]=i<a[0]?i:a[0],a[2]=i>a[2]?i:a[2],i=this.points[t].usrCoords[1],a[1]=i<a[1]?i:a[1],a[3]=i>a[3]?i:a[3]}else this.elementClass===n.A.OBJECT_CLASS_POINT&&(r=this.X(),s=this.Y(),a=[r-(o=this.evalVisProp("size"))/this.board.unitX,s-o/this.board.unitY,r+o/this.board.unitX,s+o/this.board.unitY]);return a},addEvent:r.A.shortcut(r.A.GeometryElement.prototype,"on"),removeEvent:r.A.shortcut(r.A.GeometryElement.prototype,"off"),formatNumberLocale:function(t,e){var i,r,n,s={},o={maximumfractiondigits:"maximumFractionDigits",minimumfractiondigits:"minimumFractionDigits",compactdisplay:"compactDisplay",currencydisplay:"currencyDisplay",currencysign:"currencySign",localematcher:"localeMatcher",numberingsystem:"numberingSystem",signdisplay:"signDisplay",unitdisplay:"unitDisplay",usegrouping:"useGrouping",roundingmode:"roundingMode",roundingpriority:"roundingPriority",roundingincrement:"roundingIncrement",trailingzerodisplay:"trailingZeroDisplay",minimumintegerdigits:"minimumIntegerDigits",minimumsignificantdigits:"minimumSignificantDigits",maximumsignificantdigits:"maximumSignificantDigits"};if(u.A.exists(Intl)&&this.useLocale()){for(n in i=this.evalVisProp("intl.locale")||this.eval(this.board.attr.intl.locale),r=this.evalVisProp("intl.options")||{})r.hasOwnProperty(n)&&(o.hasOwnProperty(n)?s[o[n]]=this.eval(r[n]):s[n]=this.eval(r[n]));return n="maximumfractiondigits",u.A.exists(r[n])||(s[o[n]]=e),Intl.NumberFormat(i,s).format(t)}return t},useLocale:function(){var t;return!(!u.A.exists(this.visProp.intl)||!u.A.exists(this.visProp.intl.enabled))&&(!0===(t=this.evalVisProp("intl.enabled"))||"inherit"===t&&!0===this.eval(this.board.attr.intl.enabled))},__evt__over:function(t){},__evt__mouseover:function(t){},__evt__out:function(t){},__evt__mouseout:function(t){},__evt__move:function(t){},__evt__mousemove:function(t){},__evt__drag:function(t){},__evt__mousedrag:function(t){},__evt__pendrag:function(t){},__evt__touchdrag:function(t){},__evt__keydrag:function(t){},__evt__down:function(t){},__evt__mousedown:function(t){},__evt__pendown:function(t){},__evt__touchdown:function(t){},__evt__click:function(t){},__evt__dblclick:function(t){},__evt__mouseclick:function(t){},__evt__mousedblclick:function(t){},__evt__pointerclick:function(t){},__evt__pointerdblclick:function(t){},__evt__up:function(t){},__evt__mouseup:function(t){},__evt__penup:function(t){},__evt__touchup:function(t){},__evt__attribute:function(t,e){},__evt__attribute_:function(t,e,i){},__evt:function(){}});const d=r.A.GeometryElement},433:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(601),n=i.n(r),s=i(314),o=i.n(s)()(n());o.push([t.id,"/* Chat Interface Styles */\n.chat-interface {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  max-width: 1200px;\n  margin: 0 auto;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n}\n\n.chat-header {\n  padding: 1rem;\n  background-color: #f8f9fa;\n  border-bottom: 1px solid #dee2e6;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.chat-header h1 {\n  font-size: 1.5rem;\n  margin: 0;\n  color: #3498db;\n}\n\n.api-settings {\n  display: flex;\n  gap: 0.5rem;\n}\n\n.api-provider-selector {\n  padding: 0.5rem;\n  border: 1px solid #dee2e6;\n  border-radius: 4px;\n  background-color: white;\n}\n\n.api-key-input {\n  padding: 0.5rem;\n  border: 1px solid #dee2e6;\n  border-radius: 4px;\n  width: 200px;\n}\n\n.clear-chat-button {\n  padding: 0.5rem;\n  border: 1px solid #dee2e6;\n  border-radius: 4px;\n  background-color: white;\n  cursor: pointer;\n  transition: background-color 0.2s;\n}\n\n.clear-chat-button:hover {\n  background-color: #f8d7da;\n  color: #721c24;\n}\n\n.chat-messages {\n  flex: 1;\n  overflow-y: auto;\n  padding: 1rem;\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  background-color: #f8f9fa;\n}\n\n.chat-message {\n  display: flex;\n  margin-bottom: 1rem;\n  animation: fadeIn 0.3s ease-in-out;\n}\n\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(10px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n.user-message {\n  justify-content: flex-end;\n}\n\n.assistant-message {\n  justify-content: flex-start;\n}\n\n.message-avatar {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  background-color: #e9ecef;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 0.5rem;\n  font-size: 1.2rem;\n}\n\n.user-message .message-avatar {\n  order: 2;\n  margin-right: 0;\n  margin-left: 0.5rem;\n  background-color: #3498db;\n  color: white;\n}\n\n.message-content {\n  max-width: calc(100% - 50px);\n  border-radius: 1rem;\n  padding: 1rem;\n  background-color: white;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n\n.user-message .message-content {\n  background-color: #3498db;\n  color: white;\n}\n\n.assistant-message .message-content {\n  background-color: white;\n}\n\n.message-text {\n  line-height: 1.5;\n  white-space: pre-wrap;\n}\n\n.message-text p {\n  margin: 0 0 1rem;\n}\n\n.message-text p:last-child {\n  margin-bottom: 0;\n}\n\n.visualization-container {\n  margin-top: 1rem;\n  border: 1px solid #dee2e6;\n  border-radius: 0.5rem;\n  overflow: hidden;\n  background-color: white;\n}\n\n.chat-input-container {\n  display: flex;\n  padding: 1rem;\n  background-color: white;\n  border-top: 1px solid #dee2e6;\n}\n\n.chat-input {\n  flex: 1;\n  padding: 0.75rem 1rem;\n  border: 1px solid #dee2e6;\n  border-radius: 1.5rem;\n  font-size: 1rem;\n}\n\n.send-button {\n  width: 3rem;\n  height: 3rem;\n  border-radius: 50%;\n  border: none;\n  background-color: #3498db;\n  color: white;\n  font-size: 1.2rem;\n  margin-left: 0.5rem;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: background-color 0.2s;\n}\n\n.send-button:hover {\n  background-color: #2980b9;\n}\n\n.send-button:disabled {\n  background-color: #95a5a6;\n  cursor: not-allowed;\n}\n\n.loading-indicator {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 1rem;\n  color: #6c757d;\n}\n\n.dot-pulse {\n  position: relative;\n  left: -9999px;\n  width: 6px;\n  height: 6px;\n  border-radius: 5px;\n  background-color: #3498db;\n  color: #3498db;\n  box-shadow: 9999px 0 0 -5px;\n  animation: dot-pulse 1.5s infinite linear;\n  animation-delay: 0.25s;\n}\n\n.dot-pulse::before, .dot-pulse::after {\n  content: \"\";\n  display: inline-block;\n  position: absolute;\n  top: 0;\n  width: 6px;\n  height: 6px;\n  border-radius: 5px;\n  background-color: #3498db;\n  color: #3498db;\n}\n\n.dot-pulse::before {\n  box-shadow: 9984px 0 0 -5px;\n  animation: dot-pulse-before 1.5s infinite linear;\n  animation-delay: 0s;\n}\n\n.dot-pulse::after {\n  box-shadow: 10014px 0 0 -5px;\n  animation: dot-pulse-after 1.5s infinite linear;\n  animation-delay: 0.5s;\n}\n\n@keyframes dot-pulse-before {\n  0% { box-shadow: 9984px 0 0 -5px; }\n  30% { box-shadow: 9984px 0 0 2px; }\n  60%, 100% { box-shadow: 9984px 0 0 -5px; }\n}\n\n@keyframes dot-pulse {\n  0% { box-shadow: 9999px 0 0 -5px; }\n  30% { box-shadow: 9999px 0 0 2px; }\n  60%, 100% { box-shadow: 9999px 0 0 -5px; }\n}\n\n@keyframes dot-pulse-after {\n  0% { box-shadow: 10014px 0 0 -5px; }\n  30% { box-shadow: 10014px 0 0 2px; }\n  60%, 100% { box-shadow: 10014px 0 0 -5px; }\n}\n\n.error-message {\n  padding: 0.75rem 1rem;\n  background-color: #f8d7da;\n  color: #721c24;\n  border-radius: 0.5rem;\n  margin: 0.5rem 0;\n}\n\n.empty-chat {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem;\n  text-align: center;\n  color: #6c757d;\n}\n\n.empty-chat h2 {\n  margin-bottom: 1rem;\n  color: #3498db;\n}\n\n.example-queries {\n  margin-top: 2rem;\n  width: 100%;\n  max-width: 600px;\n  text-align: left;\n}\n\n.example-queries h3 {\n  margin-bottom: 1rem;\n  font-size: 1.1rem;\n  color: #6c757d;\n}\n\n.example-queries ul {\n  list-style: disc;\n  padding-left: 1.5rem;\n}\n\n.example-queries li {\n  margin-bottom: 0.5rem;\n  cursor: pointer;\n  transition: color 0.2s;\n}\n\n.example-queries li:hover {\n  color: #3498db;\n}\n\n.api-key-notice {\n  margin: 1rem 0;\n  padding: 1rem;\n  background-color: #fff3cd;\n  color: #856404;\n  border-radius: 0.5rem;\n  border-left: 4px solid #ffc107;\n  max-width: 600px;\n}",""]);const a=o},463:(t,e)=>{var i,r,n,s;if("object"==typeof performance&&"function"==typeof performance.now){var o=performance;e.unstable_now=function(){return o.now()}}else{var a=Date,l=a.now();e.unstable_now=function(){return a.now()-l}}if("undefined"==typeof window||"function"!=typeof MessageChannel){var c=null,h=null,u=function(){if(null!==c)try{var t=e.unstable_now();c(!0,t),c=null}catch(t){throw setTimeout(u,0),t}};i=function(t){null!==c?setTimeout(i,0,t):(c=t,setTimeout(u,0))},r=function(t,e){h=setTimeout(t,e)},n=function(){clearTimeout(h)},e.unstable_shouldYield=function(){return!1},s=e.unstable_forceFrameRate=function(){}}else{var d=window.setTimeout,p=window.clearTimeout;if("undefined"!=typeof console){var f=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!=typeof f&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var m=!1,g=null,_=-1,v=5,y=0;e.unstable_shouldYield=function(){return e.unstable_now()>=y},s=function(){},e.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):v=0<t?Math.floor(1e3/t):5};var b=new MessageChannel,A=b.port2;b.port1.onmessage=function(){if(null!==g){var t=e.unstable_now();y=t+v;try{g(!0,t)?A.postMessage(null):(m=!1,g=null)}catch(t){throw A.postMessage(null),t}}else m=!1},i=function(t){g=t,m||(m=!0,A.postMessage(null))},r=function(t,i){_=d((function(){t(e.unstable_now())}),i)},n=function(){p(_),_=-1}}function x(t,e){var i=t.length;t.push(e);t:for(;;){var r=i-1>>>1,n=t[r];if(!(void 0!==n&&0<M(n,e)))break t;t[r]=e,t[i]=n,i=r}}function C(t){return void 0===(t=t[0])?null:t}function E(t){var e=t[0];if(void 0!==e){var i=t.pop();if(i!==e){t[0]=i;t:for(var r=0,n=t.length;r<n;){var s=2*(r+1)-1,o=t[s],a=s+1,l=t[a];if(void 0!==o&&0>M(o,i))void 0!==l&&0>M(l,o)?(t[r]=l,t[a]=i,r=a):(t[r]=o,t[s]=i,r=s);else{if(!(void 0!==l&&0>M(l,i)))break t;t[r]=l,t[a]=i,r=a}}}return e}return null}function M(t,e){var i=t.sortIndex-e.sortIndex;return 0!==i?i:t.id-e.id}var S=[],w=[],P=1,T=null,O=3,R=!1,N=!1,L=!1;function D(t){for(var e=C(w);null!==e;){if(null===e.callback)E(w);else{if(!(e.startTime<=t))break;E(w),e.sortIndex=e.expirationTime,x(S,e)}e=C(w)}}function k(t){if(L=!1,D(t),!N)if(null!==C(S))N=!0,i(I);else{var e=C(w);null!==e&&r(k,e.startTime-t)}}function I(t,i){N=!1,L&&(L=!1,n()),R=!0;var s=O;try{for(D(i),T=C(S);null!==T&&(!(T.expirationTime>i)||t&&!e.unstable_shouldYield());){var o=T.callback;if("function"==typeof o){T.callback=null,O=T.priorityLevel;var a=o(T.expirationTime<=i);i=e.unstable_now(),"function"==typeof a?T.callback=a:T===C(S)&&E(S),D(i)}else E(S);T=C(S)}if(null!==T)var l=!0;else{var c=C(w);null!==c&&r(k,c.startTime-i),l=!1}return l}finally{T=null,O=s,R=!1}}var B=s;e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(t){t.callback=null},e.unstable_continueExecution=function(){N||R||(N=!0,i(I))},e.unstable_getCurrentPriorityLevel=function(){return O},e.unstable_getFirstCallbackNode=function(){return C(S)},e.unstable_next=function(t){switch(O){case 1:case 2:case 3:var e=3;break;default:e=O}var i=O;O=e;try{return t()}finally{O=i}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=B,e.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var i=O;O=t;try{return e()}finally{O=i}},e.unstable_scheduleCallback=function(t,s,o){var a=e.unstable_now();switch(o="object"==typeof o&&null!==o&&"number"==typeof(o=o.delay)&&0<o?a+o:a,t){case 1:var l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}return t={id:P++,callback:s,priorityLevel:t,startTime:o,expirationTime:l=o+l,sortIndex:-1},o>a?(t.sortIndex=o,x(w,t),null===C(S)&&t===C(w)&&(L?n():L=!0,r(k,o-a))):(t.sortIndex=l,x(S,t),N||R||(N=!0,i(I))),t},e.unstable_wrapCallback=function(t){var e=O;return function(){var i=O;O=e;try{return t.apply(this,arguments)}finally{O=i}}}},540:(t,e,i)=>{t.exports=i(287)},551:(t,e,i)=>{var r=i(540),n=i(228),s=i(982);function o(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,i=1;i<arguments.length;i++)e+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(o(227));var a=new Set,l={};function c(t,e){h(t,e),h(t+"Capture",e)}function h(t,e){for(l[t]=e,t=0;t<e.length;t++)a.add(e[t])}var u=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p=Object.prototype.hasOwnProperty,f={},m={};function g(t,e,i,r,n,s,o){this.acceptsBooleans=2===e||3===e||4===e,this.attributeName=r,this.attributeNamespace=n,this.mustUseProperty=i,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var _={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(t){_[t]=new g(t,0,!1,t,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(t){var e=t[0];_[e]=new g(e,1,!1,t[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(t){_[t]=new g(t,2,!1,t.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(t){_[t]=new g(t,2,!1,t,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(t){_[t]=new g(t,3,!1,t.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(t){_[t]=new g(t,3,!0,t,null,!1,!1)})),["capture","download"].forEach((function(t){_[t]=new g(t,4,!1,t,null,!1,!1)})),["cols","rows","size","span"].forEach((function(t){_[t]=new g(t,6,!1,t,null,!1,!1)})),["rowSpan","start"].forEach((function(t){_[t]=new g(t,5,!1,t.toLowerCase(),null,!1,!1)}));var v=/[\-:]([a-z])/g;function y(t){return t[1].toUpperCase()}function b(t,e,i,r){var n=_.hasOwnProperty(e)?_[e]:null;(null!==n?0===n.type:!r&&2<e.length&&("o"===e[0]||"O"===e[0])&&("n"===e[1]||"N"===e[1]))||(function(t,e,i,r){if(null==e||function(t,e,i,r){if(null!==i&&0===i.type)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==i?!i.acceptsBooleans:"data-"!==(t=t.toLowerCase().slice(0,5))&&"aria-"!==t);default:return!1}}(t,e,i,r))return!0;if(r)return!1;if(null!==i)switch(i.type){case 3:return!e;case 4:return!1===e;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}(e,i,n,r)&&(i=null),r||null===n?function(t){return!!p.call(m,t)||!p.call(f,t)&&(d.test(t)?m[t]=!0:(f[t]=!0,!1))}(e)&&(null===i?t.removeAttribute(e):t.setAttribute(e,""+i)):n.mustUseProperty?t[n.propertyName]=null===i?3!==n.type&&"":i:(e=n.attributeName,r=n.attributeNamespace,null===i?t.removeAttribute(e):(i=3===(n=n.type)||4===n&&!0===i?"":""+i,r?t.setAttributeNS(r,e,i):t.setAttribute(e,i))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(t){var e=t.replace(v,y);_[e]=new g(e,1,!1,t,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(t){var e=t.replace(v,y);_[e]=new g(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(t){var e=t.replace(v,y);_[e]=new g(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(t){_[t]=new g(t,1,!1,t.toLowerCase(),null,!1,!1)})),_.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(t){_[t]=new g(t,1,!1,t.toLowerCase(),null,!0,!0)}));var A=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=60103,C=60106,E=60107,M=60108,S=60114,w=60109,P=60110,T=60112,O=60113,R=60120,N=60115,L=60116,D=60121,k=60128,I=60129,B=60130,U=60131;if("function"==typeof Symbol&&Symbol.for){var F=Symbol.for;x=F("react.element"),C=F("react.portal"),E=F("react.fragment"),M=F("react.strict_mode"),S=F("react.profiler"),w=F("react.provider"),P=F("react.context"),T=F("react.forward_ref"),O=F("react.suspense"),R=F("react.suspense_list"),N=F("react.memo"),L=F("react.lazy"),D=F("react.block"),F("react.scope"),k=F("react.opaque.id"),I=F("react.debug_trace_mode"),B=F("react.offscreen"),U=F("react.legacy_hidden")}var j,V="function"==typeof Symbol&&Symbol.iterator;function z(t){return null===t||"object"!=typeof t?null:"function"==typeof(t=V&&t[V]||t["@@iterator"])?t:null}function G(t){if(void 0===j)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);j=e&&e[1]||""}return"\n"+j+t}var H=!1;function Y(t,e){if(!t||H)return"";H=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(e,[])}catch(t){var r=t}Reflect.construct(t,[],e)}else{try{e.call()}catch(t){r=t}t.call(e.prototype)}else{try{throw Error()}catch(t){r=t}t()}}catch(t){if(t&&r&&"string"==typeof t.stack){for(var n=t.stack.split("\n"),s=r.stack.split("\n"),o=n.length-1,a=s.length-1;1<=o&&0<=a&&n[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(n[o]!==s[a]){if(1!==o||1!==a)do{if(o--,0>--a||n[o]!==s[a])return"\n"+n[o].replace(" at new "," at ")}while(1<=o&&0<=a);break}}}finally{H=!1,Error.prepareStackTrace=i}return(t=t?t.displayName||t.name:"")?G(t):""}function X(t){switch(t.tag){case 5:return G(t.type);case 16:return G("Lazy");case 13:return G("Suspense");case 19:return G("SuspenseList");case 0:case 2:case 15:return Y(t.type,!1);case 11:return Y(t.type.render,!1);case 22:return Y(t.type._render,!1);case 1:return Y(t.type,!0);default:return""}}function W(t){if(null==t)return null;if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t;switch(t){case E:return"Fragment";case C:return"Portal";case S:return"Profiler";case M:return"StrictMode";case O:return"Suspense";case R:return"SuspenseList"}if("object"==typeof t)switch(t.$$typeof){case P:return(t.displayName||"Context")+".Consumer";case w:return(t._context.displayName||"Context")+".Provider";case T:var e=t.render;return e=e.displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case N:return W(t.type);case D:return W(t._render);case L:e=t._payload,t=t._init;try{return W(t(e))}catch(t){}}return null}function J(t){switch(typeof t){case"boolean":case"number":case"object":case"string":case"undefined":return t;default:return""}}function $(t){var e=t.type;return(t=t.nodeName)&&"input"===t.toLowerCase()&&("checkbox"===e||"radio"===e)}function q(t){t._valueTracker||(t._valueTracker=function(t){var e=$(t)?"checked":"value",i=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&void 0!==i&&"function"==typeof i.get&&"function"==typeof i.set){var n=i.get,s=i.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return n.call(this)},set:function(t){r=""+t,s.call(this,t)}}),Object.defineProperty(t,e,{enumerable:i.enumerable}),{getValue:function(){return r},setValue:function(t){r=""+t},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}(t))}function K(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var i=e.getValue(),r="";return t&&(r=$(t)?t.checked?"true":"false":t.value),(t=r)!==i&&(e.setValue(t),!0)}function Z(t){if(void 0===(t=t||("undefined"!=typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}function Q(t,e){var i=e.checked;return n({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=i?i:t._wrapperState.initialChecked})}function tt(t,e){var i=null==e.defaultValue?"":e.defaultValue,r=null!=e.checked?e.checked:e.defaultChecked;i=J(null!=e.value?e.value:i),t._wrapperState={initialChecked:r,initialValue:i,controlled:"checkbox"===e.type||"radio"===e.type?null!=e.checked:null!=e.value}}function et(t,e){null!=(e=e.checked)&&b(t,"checked",e,!1)}function it(t,e){et(t,e);var i=J(e.value),r=e.type;if(null!=i)"number"===r?(0===i&&""===t.value||t.value!=i)&&(t.value=""+i):t.value!==""+i&&(t.value=""+i);else if("submit"===r||"reset"===r)return void t.removeAttribute("value");e.hasOwnProperty("value")?nt(t,e.type,i):e.hasOwnProperty("defaultValue")&&nt(t,e.type,J(e.defaultValue)),null==e.checked&&null!=e.defaultChecked&&(t.defaultChecked=!!e.defaultChecked)}function rt(t,e,i){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!("submit"!==r&&"reset"!==r||void 0!==e.value&&null!==e.value))return;e=""+t._wrapperState.initialValue,i||e===t.value||(t.value=e),t.defaultValue=e}""!==(i=t.name)&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,""!==i&&(t.name=i)}function nt(t,e,i){"number"===e&&Z(t.ownerDocument)===t||(null==i?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+i&&(t.defaultValue=""+i))}function st(t,e){return t=n({children:void 0},e),(e=function(t){var e="";return r.Children.forEach(t,(function(t){null!=t&&(e+=t)})),e}(e.children))&&(t.children=e),t}function ot(t,e,i,r){if(t=t.options,e){e={};for(var n=0;n<i.length;n++)e["$"+i[n]]=!0;for(i=0;i<t.length;i++)n=e.hasOwnProperty("$"+t[i].value),t[i].selected!==n&&(t[i].selected=n),n&&r&&(t[i].defaultSelected=!0)}else{for(i=""+J(i),e=null,n=0;n<t.length;n++){if(t[n].value===i)return t[n].selected=!0,void(r&&(t[n].defaultSelected=!0));null!==e||t[n].disabled||(e=t[n])}null!==e&&(e.selected=!0)}}function at(t,e){if(null!=e.dangerouslySetInnerHTML)throw Error(o(91));return n({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function lt(t,e){var i=e.value;if(null==i){if(i=e.children,e=e.defaultValue,null!=i){if(null!=e)throw Error(o(92));if(Array.isArray(i)){if(!(1>=i.length))throw Error(o(93));i=i[0]}e=i}null==e&&(e=""),i=e}t._wrapperState={initialValue:J(i)}}function ct(t,e){var i=J(e.value),r=J(e.defaultValue);null!=i&&((i=""+i)!==t.value&&(t.value=i),null==e.defaultValue&&t.defaultValue!==i&&(t.defaultValue=i)),null!=r&&(t.defaultValue=""+r)}function ht(t){var e=t.textContent;e===t._wrapperState.initialValue&&""!==e&&null!==e&&(t.value=e)}var ut="http://www.w3.org/1999/xhtml";function dt(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function pt(t,e){return null==t||"http://www.w3.org/1999/xhtml"===t?dt(e):"http://www.w3.org/2000/svg"===t&&"foreignObject"===e?"http://www.w3.org/1999/xhtml":t}var ft,mt,gt=(mt=function(t,e){if("http://www.w3.org/2000/svg"!==t.namespaceURI||"innerHTML"in t)t.innerHTML=e;else{for((ft=ft||document.createElement("div")).innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ft.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,e,i,r){MSApp.execUnsafeLocalFunction((function(){return mt(t,e)}))}:mt);function _t(t,e){if(e){var i=t.firstChild;if(i&&i===t.lastChild&&3===i.nodeType)return void(i.nodeValue=e)}t.textContent=e}var vt={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},yt=["Webkit","ms","Moz","O"];function bt(t,e,i){return null==e||"boolean"==typeof e||""===e?"":i||"number"!=typeof e||0===e||vt.hasOwnProperty(t)&&vt[t]?(""+e).trim():e+"px"}function At(t,e){for(var i in t=t.style,e)if(e.hasOwnProperty(i)){var r=0===i.indexOf("--"),n=bt(i,e[i],r);"float"===i&&(i="cssFloat"),r?t.setProperty(i,n):t[i]=n}}Object.keys(vt).forEach((function(t){yt.forEach((function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),vt[e]=vt[t]}))}));var xt=n({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ct(t,e){if(e){if(xt[t]&&(null!=e.children||null!=e.dangerouslySetInnerHTML))throw Error(o(137,t));if(null!=e.dangerouslySetInnerHTML){if(null!=e.children)throw Error(o(60));if("object"!=typeof e.dangerouslySetInnerHTML||!("__html"in e.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=e.style&&"object"!=typeof e.style)throw Error(o(62))}}function Et(t,e){if(-1===t.indexOf("-"))return"string"==typeof e.is;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Mt(t){return(t=t.target||t.srcElement||window).correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}var St=null,wt=null,Pt=null;function Tt(t){if(t=en(t)){if("function"!=typeof St)throw Error(o(280));var e=t.stateNode;e&&(e=nn(e),St(t.stateNode,t.type,e))}}function Ot(t){wt?Pt?Pt.push(t):Pt=[t]:wt=t}function Rt(){if(wt){var t=wt,e=Pt;if(Pt=wt=null,Tt(t),e)for(t=0;t<e.length;t++)Tt(e[t])}}function Nt(t,e){return t(e)}function Lt(t,e,i,r,n){return t(e,i,r,n)}function Dt(){}var kt=Nt,It=!1,Bt=!1;function Ut(){null===wt&&null===Pt||(Dt(),Rt())}function Ft(t,e){var i=t.stateNode;if(null===i)return null;var r=nn(i);if(null===r)return null;i=r[e];t:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(t=t.type)||"input"===t||"select"===t||"textarea"===t)),t=!r;break t;default:t=!1}if(t)return null;if(i&&"function"!=typeof i)throw Error(o(231,e,typeof i));return i}var jt=!1;if(u)try{var Vt={};Object.defineProperty(Vt,"passive",{get:function(){jt=!0}}),window.addEventListener("test",Vt,Vt),window.removeEventListener("test",Vt,Vt)}catch(mt){jt=!1}function zt(t,e,i,r,n,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(i,c)}catch(t){this.onError(t)}}var Gt=!1,Ht=null,Yt=!1,Xt=null,Wt={onError:function(t){Gt=!0,Ht=t}};function Jt(t,e,i,r,n,s,o,a,l){Gt=!1,Ht=null,zt.apply(Wt,arguments)}function $t(t){var e=t,i=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do{!!(1026&(e=t).flags)&&(i=e.return),t=e.return}while(t)}return 3===e.tag?i:null}function qt(t){if(13===t.tag){var e=t.memoizedState;if(null===e&&null!==(t=t.alternate)&&(e=t.memoizedState),null!==e)return e.dehydrated}return null}function Kt(t){if($t(t)!==t)throw Error(o(188))}function Zt(t){if(t=function(t){var e=t.alternate;if(!e){if(null===(e=$t(t)))throw Error(o(188));return e!==t?null:t}for(var i=t,r=e;;){var n=i.return;if(null===n)break;var s=n.alternate;if(null===s){if(null!==(r=n.return)){i=r;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===i)return Kt(n),t;if(s===r)return Kt(n),e;s=s.sibling}throw Error(o(188))}if(i.return!==r.return)i=n,r=s;else{for(var a=!1,l=n.child;l;){if(l===i){a=!0,i=n,r=s;break}if(l===r){a=!0,r=n,i=s;break}l=l.sibling}if(!a){for(l=s.child;l;){if(l===i){a=!0,i=s,r=n;break}if(l===r){a=!0,r=s,i=n;break}l=l.sibling}if(!a)throw Error(o(189))}}if(i.alternate!==r)throw Error(o(190))}if(3!==i.tag)throw Error(o(188));return i.stateNode.current===i?t:e}(t),!t)return null;for(var e=t;;){if(5===e.tag||6===e.tag)return e;if(e.child)e.child.return=e,e=e.child;else{if(e===t)break;for(;!e.sibling;){if(!e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}}return null}function Qt(t,e){for(var i=t.alternate;null!==e;){if(e===t||e===i)return!0;e=e.return}return!1}var te,ee,ie,re,ne=!1,se=[],oe=null,ae=null,le=null,ce=new Map,he=new Map,ue=[],de="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function pe(t,e,i,r,n){return{blockedOn:t,domEventName:e,eventSystemFlags:16|i,nativeEvent:n,targetContainers:[r]}}function fe(t,e){switch(t){case"focusin":case"focusout":oe=null;break;case"dragenter":case"dragleave":ae=null;break;case"mouseover":case"mouseout":le=null;break;case"pointerover":case"pointerout":ce.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":he.delete(e.pointerId)}}function me(t,e,i,r,n,s){return null===t||t.nativeEvent!==s?(t=pe(e,i,r,n,s),null!==e&&null!==(e=en(e))&&ee(e),t):(t.eventSystemFlags|=r,e=t.targetContainers,null!==n&&-1===e.indexOf(n)&&e.push(n),t)}function ge(t){var e=tn(t.target);if(null!==e){var i=$t(e);if(null!==i)if(13===(e=i.tag)){if(null!==(e=qt(i)))return t.blockedOn=e,void re(t.lanePriority,(function(){s.unstable_runWithPriority(t.priority,(function(){ie(i)}))}))}else if(3===e&&i.stateNode.hydrate)return void(t.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}t.blockedOn=null}function _e(t){if(null!==t.blockedOn)return!1;for(var e=t.targetContainers;0<e.length;){var i=Ze(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(null!==i)return null!==(e=en(i))&&ee(e),t.blockedOn=i,!1;e.shift()}return!0}function ve(t,e,i){_e(t)&&i.delete(e)}function ye(){for(ne=!1;0<se.length;){var t=se[0];if(null!==t.blockedOn){null!==(t=en(t.blockedOn))&&te(t);break}for(var e=t.targetContainers;0<e.length;){var i=Ze(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(null!==i){t.blockedOn=i;break}e.shift()}null===t.blockedOn&&se.shift()}null!==oe&&_e(oe)&&(oe=null),null!==ae&&_e(ae)&&(ae=null),null!==le&&_e(le)&&(le=null),ce.forEach(ve),he.forEach(ve)}function be(t,e){t.blockedOn===e&&(t.blockedOn=null,ne||(ne=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,ye)))}function Ae(t){function e(e){return be(e,t)}if(0<se.length){be(se[0],t);for(var i=1;i<se.length;i++){var r=se[i];r.blockedOn===t&&(r.blockedOn=null)}}for(null!==oe&&be(oe,t),null!==ae&&be(ae,t),null!==le&&be(le,t),ce.forEach(e),he.forEach(e),i=0;i<ue.length;i++)(r=ue[i]).blockedOn===t&&(r.blockedOn=null);for(;0<ue.length&&null===(i=ue[0]).blockedOn;)ge(i),null===i.blockedOn&&ue.shift()}function xe(t,e){var i={};return i[t.toLowerCase()]=e.toLowerCase(),i["Webkit"+t]="webkit"+e,i["Moz"+t]="moz"+e,i}var Ce={animationend:xe("Animation","AnimationEnd"),animationiteration:xe("Animation","AnimationIteration"),animationstart:xe("Animation","AnimationStart"),transitionend:xe("Transition","TransitionEnd")},Ee={},Me={};function Se(t){if(Ee[t])return Ee[t];if(!Ce[t])return t;var e,i=Ce[t];for(e in i)if(i.hasOwnProperty(e)&&e in Me)return Ee[t]=i[e];return t}u&&(Me=document.createElement("div").style,"AnimationEvent"in window||(delete Ce.animationend.animation,delete Ce.animationiteration.animation,delete Ce.animationstart.animation),"TransitionEvent"in window||delete Ce.transitionend.transition);var we=Se("animationend"),Pe=Se("animationiteration"),Te=Se("animationstart"),Oe=Se("transitionend"),Re=new Map,Ne=new Map,Le=["abort","abort",we,"animationEnd",Pe,"animationIteration",Te,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Oe,"transitionEnd","waiting","waiting"];function De(t,e){for(var i=0;i<t.length;i+=2){var r=t[i],n=t[i+1];n="on"+(n[0].toUpperCase()+n.slice(1)),Ne.set(r,e),Re.set(r,n),c(n,[r])}}(0,s.unstable_now)();var ke=8;function Ie(t){if(1&t)return ke=15,1;if(2&t)return ke=14,2;if(4&t)return ke=13,4;var e=24&t;return 0!==e?(ke=12,e):32&t?(ke=11,32):0!=(e=192&t)?(ke=10,e):256&t?(ke=9,256):0!=(e=3584&t)?(ke=8,e):4096&t?(ke=7,4096):0!=(e=4186112&t)?(ke=6,e):0!=(e=62914560&t)?(ke=5,e):67108864&t?(ke=4,67108864):134217728&t?(ke=3,134217728):0!=(e=805306368&t)?(ke=2,e):1073741824&t?(ke=1,1073741824):(ke=8,t)}function Be(t,e){var i=t.pendingLanes;if(0===i)return ke=0;var r=0,n=0,s=t.expiredLanes,o=t.suspendedLanes,a=t.pingedLanes;if(0!==s)r=s,n=ke=15;else if(0!=(s=134217727&i)){var l=s&~o;0!==l?(r=Ie(l),n=ke):0!==(a&=s)&&(r=Ie(a),n=ke)}else 0!==(s=i&~o)?(r=Ie(s),n=ke):0!==a&&(r=Ie(a),n=ke);if(0===r)return 0;if(r=i&((0>(r=31-Ge(r))?0:1<<r)<<1)-1,0!==e&&e!==r&&0===(e&o)){if(Ie(e),n<=ke)return e;ke=n}if(0!==(e=t.entangledLanes))for(t=t.entanglements,e&=r;0<e;)n=1<<(i=31-Ge(e)),r|=t[i],e&=~n;return r}function Ue(t){return 0!=(t=-1073741825&t.pendingLanes)?t:1073741824&t?1073741824:0}function Fe(t,e){switch(t){case 15:return 1;case 14:return 2;case 12:return 0===(t=je(24&~e))?Fe(10,e):t;case 10:return 0===(t=je(192&~e))?Fe(8,e):t;case 8:return 0===(t=je(3584&~e))&&0===(t=je(4186112&~e))&&(t=512),t;case 2:return 0===(e=je(805306368&~e))&&(e=268435456),e}throw Error(o(358,t))}function je(t){return t&-t}function Ve(t){for(var e=[],i=0;31>i;i++)e.push(t);return e}function ze(t,e,i){t.pendingLanes|=e;var r=e-1;t.suspendedLanes&=r,t.pingedLanes&=r,(t=t.eventTimes)[e=31-Ge(e)]=i}var Ge=Math.clz32?Math.clz32:function(t){return 0===t?32:31-(He(t)/Ye|0)|0},He=Math.log,Ye=Math.LN2,Xe=s.unstable_UserBlockingPriority,We=s.unstable_runWithPriority,Je=!0;function $e(t,e,i,r){It||Dt();var n=Ke,s=It;It=!0;try{Lt(n,t,e,i,r)}finally{(It=s)||Ut()}}function qe(t,e,i,r){We(Xe,Ke.bind(null,t,e,i,r))}function Ke(t,e,i,r){var n;if(Je)if((n=!(4&e))&&0<se.length&&-1<de.indexOf(t))t=pe(null,t,e,i,r),se.push(t);else{var s=Ze(t,e,i,r);if(null===s)n&&fe(t,r);else{if(n){if(-1<de.indexOf(t))return t=pe(s,t,e,i,r),void se.push(t);if(function(t,e,i,r,n){switch(e){case"focusin":return oe=me(oe,t,e,i,r,n),!0;case"dragenter":return ae=me(ae,t,e,i,r,n),!0;case"mouseover":return le=me(le,t,e,i,r,n),!0;case"pointerover":var s=n.pointerId;return ce.set(s,me(ce.get(s)||null,t,e,i,r,n)),!0;case"gotpointercapture":return s=n.pointerId,he.set(s,me(he.get(s)||null,t,e,i,r,n)),!0}return!1}(s,t,e,i,r))return;fe(t,r)}Lr(t,e,r,null,i)}}}function Ze(t,e,i,r){var n=Mt(r);if(null!==(n=tn(n))){var s=$t(n);if(null===s)n=null;else{var o=s.tag;if(13===o){if(null!==(n=qt(s)))return n;n=null}else if(3===o){if(s.stateNode.hydrate)return 3===s.tag?s.stateNode.containerInfo:null;n=null}else s!==n&&(n=null)}}return Lr(t,e,r,n,i),null}var Qe=null,ti=null,ei=null;function ii(){if(ei)return ei;var t,e,i=ti,r=i.length,n="value"in Qe?Qe.value:Qe.textContent,s=n.length;for(t=0;t<r&&i[t]===n[t];t++);var o=r-t;for(e=1;e<=o&&i[r-e]===n[s-e];e++);return ei=n.slice(t,1<e?1-e:void 0)}function ri(t){var e=t.keyCode;return"charCode"in t?0===(t=t.charCode)&&13===e&&(t=13):t=e,10===t&&(t=13),32<=t||13===t?t:0}function ni(){return!0}function si(){return!1}function oi(t){function e(e,i,r,n,s){for(var o in this._reactName=e,this._targetInst=r,this.type=i,this.nativeEvent=n,this.target=s,this.currentTarget=null,t)t.hasOwnProperty(o)&&(e=t[o],this[o]=e?e(n):n[o]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?ni:si,this.isPropagationStopped=si,this}return n(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():"unknown"!=typeof t.returnValue&&(t.returnValue=!1),this.isDefaultPrevented=ni)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():"unknown"!=typeof t.cancelBubble&&(t.cancelBubble=!0),this.isPropagationStopped=ni)},persist:function(){},isPersistent:ni}),e}var ai,li,ci,hi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ui=oi(hi),di=n({},hi,{view:0,detail:0}),pi=oi(di),fi=n({},di,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Si,button:0,buttons:0,relatedTarget:function(t){return void 0===t.relatedTarget?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ci&&(ci&&"mousemove"===t.type?(ai=t.screenX-ci.screenX,li=t.screenY-ci.screenY):li=ai=0,ci=t),ai)},movementY:function(t){return"movementY"in t?t.movementY:li}}),mi=oi(fi),gi=oi(n({},fi,{dataTransfer:0})),_i=oi(n({},di,{relatedTarget:0})),vi=oi(n({},hi,{animationName:0,elapsedTime:0,pseudoElement:0})),yi=n({},hi,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),bi=oi(yi),Ai=oi(n({},hi,{data:0})),xi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ci={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ei={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Mi(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):!!(t=Ei[t])&&!!e[t]}function Si(){return Mi}var wi=n({},di,{key:function(t){if(t.key){var e=xi[t.key]||t.key;if("Unidentified"!==e)return e}return"keypress"===t.type?13===(t=ri(t))?"Enter":String.fromCharCode(t):"keydown"===t.type||"keyup"===t.type?Ci[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Si,charCode:function(t){return"keypress"===t.type?ri(t):0},keyCode:function(t){return"keydown"===t.type||"keyup"===t.type?t.keyCode:0},which:function(t){return"keypress"===t.type?ri(t):"keydown"===t.type||"keyup"===t.type?t.keyCode:0}}),Pi=oi(wi),Ti=oi(n({},fi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Oi=oi(n({},di,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Si})),Ri=oi(n({},hi,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ni=n({},fi,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Li=oi(Ni),Di=[9,13,27,32],ki=u&&"CompositionEvent"in window,Ii=null;u&&"documentMode"in document&&(Ii=document.documentMode);var Bi=u&&"TextEvent"in window&&!Ii,Ui=u&&(!ki||Ii&&8<Ii&&11>=Ii),Fi=String.fromCharCode(32),ji=!1;function Vi(t,e){switch(t){case"keyup":return-1!==Di.indexOf(e.keyCode);case"keydown":return 229!==e.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zi(t){return"object"==typeof(t=t.detail)&&"data"in t?t.data:null}var Gi=!1,Hi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Yi(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return"input"===e?!!Hi[t.type]:"textarea"===e}function Xi(t,e,i,r){Ot(r),0<(e=kr(e,"onChange")).length&&(i=new ui("onChange","change",null,i,r),t.push({event:i,listeners:e}))}var Wi=null,Ji=null;function $i(t){wr(t,0)}function qi(t){if(K(rn(t)))return t}function Ki(t,e){if("change"===t)return e}var Zi=!1;if(u){var Qi;if(u){var tr="oninput"in document;if(!tr){var er=document.createElement("div");er.setAttribute("oninput","return;"),tr="function"==typeof er.oninput}Qi=tr}else Qi=!1;Zi=Qi&&(!document.documentMode||9<document.documentMode)}function ir(){Wi&&(Wi.detachEvent("onpropertychange",rr),Ji=Wi=null)}function rr(t){if("value"===t.propertyName&&qi(Ji)){var e=[];if(Xi(e,Ji,t,Mt(t)),t=$i,It)t(e);else{It=!0;try{Nt(t,e)}finally{It=!1,Ut()}}}}function nr(t,e,i){"focusin"===t?(ir(),Ji=i,(Wi=e).attachEvent("onpropertychange",rr)):"focusout"===t&&ir()}function sr(t){if("selectionchange"===t||"keyup"===t||"keydown"===t)return qi(Ji)}function or(t,e){if("click"===t)return qi(e)}function ar(t,e){if("input"===t||"change"===t)return qi(e)}var lr="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},cr=Object.prototype.hasOwnProperty;function hr(t,e){if(lr(t,e))return!0;if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return!1;var i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(r=0;r<i.length;r++)if(!cr.call(e,i[r])||!lr(t[i[r]],e[i[r]]))return!1;return!0}function ur(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function dr(t,e){var i,r=ur(t);for(t=0;r;){if(3===r.nodeType){if(i=t+r.textContent.length,t<=e&&i>=e)return{node:r,offset:e-t};t=i}t:{for(;r;){if(r.nextSibling){r=r.nextSibling;break t}r=r.parentNode}r=void 0}r=ur(r)}}function pr(t,e){return!(!t||!e)&&(t===e||(!t||3!==t.nodeType)&&(e&&3===e.nodeType?pr(t,e.parentNode):"contains"in t?t.contains(e):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(e))))}function fr(){for(var t=window,e=Z();e instanceof t.HTMLIFrameElement;){try{var i="string"==typeof e.contentWindow.location.href}catch(t){i=!1}if(!i)break;e=Z((t=e.contentWindow).document)}return e}function mr(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&("input"===e&&("text"===t.type||"search"===t.type||"tel"===t.type||"url"===t.type||"password"===t.type)||"textarea"===e||"true"===t.contentEditable)}var gr=u&&"documentMode"in document&&11>=document.documentMode,_r=null,vr=null,yr=null,br=!1;function Ar(t,e,i){var r=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;br||null==_r||_r!==Z(r)||(r="selectionStart"in(r=_r)&&mr(r)?{start:r.selectionStart,end:r.selectionEnd}:{anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&hr(yr,r)||(yr=r,0<(r=kr(vr,"onSelect")).length&&(e=new ui("onSelect","select",null,e,i),t.push({event:e,listeners:r}),e.target=_r)))}De("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),De("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),De(Le,2);for(var xr="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Cr=0;Cr<xr.length;Cr++)Ne.set(xr[Cr],0);h("onMouseEnter",["mouseout","mouseover"]),h("onMouseLeave",["mouseout","mouseover"]),h("onPointerEnter",["pointerout","pointerover"]),h("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Er="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Er));function Sr(t,e,i){var r=t.type||"unknown-event";t.currentTarget=i,function(t,e,i,r,n,s,a,l,c){if(Jt.apply(this,arguments),Gt){if(!Gt)throw Error(o(198));var h=Ht;Gt=!1,Ht=null,Yt||(Yt=!0,Xt=h)}}(r,e,void 0,t),t.currentTarget=null}function wr(t,e){e=!!(4&e);for(var i=0;i<t.length;i++){var r=t[i],n=r.event;r=r.listeners;t:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&n.isPropagationStopped())break t;Sr(n,a,c),s=l}else for(o=0;o<r.length;o++){if(l=(a=r[o]).instance,c=a.currentTarget,a=a.listener,l!==s&&n.isPropagationStopped())break t;Sr(n,a,c),s=l}}}if(Yt)throw t=Xt,Yt=!1,Xt=null,t}function Pr(t,e){var i=sn(e),r=t+"__bubble";i.has(r)||(Nr(e,t,2,!1),i.add(r))}var Tr="_reactListening"+Math.random().toString(36).slice(2);function Or(t){t[Tr]||(t[Tr]=!0,a.forEach((function(e){Mr.has(e)||Rr(e,!1,t,null),Rr(e,!0,t,null)})))}function Rr(t,e,i,r){var n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,s=i;if("selectionchange"===t&&9!==i.nodeType&&(s=i.ownerDocument),null!==r&&!e&&Mr.has(t)){if("scroll"!==t)return;n|=2,s=r}var o=sn(s),a=t+"__"+(e?"capture":"bubble");o.has(a)||(e&&(n|=4),Nr(s,t,n,e),o.add(a))}function Nr(t,e,i,r){var n=Ne.get(e);switch(void 0===n?2:n){case 0:n=$e;break;case 1:n=qe;break;default:n=Ke}i=n.bind(null,e,i,t),n=void 0,!jt||"touchstart"!==e&&"touchmove"!==e&&"wheel"!==e||(n=!0),r?void 0!==n?t.addEventListener(e,i,{capture:!0,passive:n}):t.addEventListener(e,i,!0):void 0!==n?t.addEventListener(e,i,{passive:n}):t.addEventListener(e,i,!1)}function Lr(t,e,i,r,n){var s=r;if(!(1&e||2&e||null===r))t:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var a=r.stateNode.containerInfo;if(a===n||8===a.nodeType&&a.parentNode===n)break;if(4===o)for(o=r.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===n||8===l.nodeType&&l.parentNode===n))return;o=o.return}for(;null!==a;){if(null===(o=tn(a)))return;if(5===(l=o.tag)||6===l){r=s=o;continue t}a=a.parentNode}}r=r.return}!function(t,e,i){if(Bt)return t();Bt=!0;try{return kt(t,e,i)}finally{Bt=!1,Ut()}}((function(){var r=s,n=Mt(i),o=[];t:{var a=Re.get(t);if(void 0!==a){var l=ui,c=t;switch(t){case"keypress":if(0===ri(i))break t;case"keydown":case"keyup":l=Pi;break;case"focusin":c="focus",l=_i;break;case"focusout":c="blur",l=_i;break;case"beforeblur":case"afterblur":l=_i;break;case"click":if(2===i.button)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=mi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=gi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Oi;break;case we:case Pe:case Te:l=vi;break;case Oe:l=Ri;break;case"scroll":l=pi;break;case"wheel":l=Li;break;case"copy":case"cut":case"paste":l=bi;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Ti}var h=!!(4&e),u=!h&&"scroll"===t,d=h?null!==a?a+"Capture":null:a;h=[];for(var p,f=r;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&null!=(m=Ft(f,d))&&h.push(Dr(f,m,p))),u)break;f=f.return}0<h.length&&(a=new l(a,c,null,i,n),o.push({event:a,listeners:h}))}}if(!(7&e)){if(l="mouseout"===t||"pointerout"===t,(!(a="mouseover"===t||"pointerover"===t)||16&e||!(c=i.relatedTarget||i.fromElement)||!tn(c)&&!c[Zr])&&(l||a)&&(a=n.window===n?n:(a=n.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=r,null!==(c=(c=i.relatedTarget||i.toElement)?tn(c):null)&&(c!==(u=$t(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(h=mi,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==t&&"pointerover"!==t||(h=Ti,m="onPointerLeave",d="onPointerEnter",f="pointer"),u=null==l?a:rn(l),p=null==c?a:rn(c),(a=new h(m,f+"leave",l,i,n)).target=u,a.relatedTarget=p,m=null,tn(n)===r&&((h=new h(d,f+"enter",c,i,n)).target=p,h.relatedTarget=u,m=h),u=m,l&&c)t:{for(d=c,f=0,p=h=l;p;p=Ir(p))f++;for(p=0,m=d;m;m=Ir(m))p++;for(;0<f-p;)h=Ir(h),f--;for(;0<p-f;)d=Ir(d),p--;for(;f--;){if(h===d||null!==d&&h===d.alternate)break t;h=Ir(h),d=Ir(d)}h=null}else h=null;null!==l&&Br(o,a,l,h,!1),null!==c&&null!==u&&Br(o,u,c,h,!0)}if("select"===(l=(a=r?rn(r):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var g=Ki;else if(Yi(a))if(Zi)g=ar;else{g=sr;var _=nr}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=or);switch(g&&(g=g(t,r))?Xi(o,g,i,n):(_&&_(t,a,r),"focusout"===t&&(_=a._wrapperState)&&_.controlled&&"number"===a.type&&nt(a,"number",a.value)),_=r?rn(r):window,t){case"focusin":(Yi(_)||"true"===_.contentEditable)&&(_r=_,vr=r,yr=null);break;case"focusout":yr=vr=_r=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,Ar(o,i,n);break;case"selectionchange":if(gr)break;case"keydown":case"keyup":Ar(o,i,n)}var v;if(ki)t:{switch(t){case"compositionstart":var y="onCompositionStart";break t;case"compositionend":y="onCompositionEnd";break t;case"compositionupdate":y="onCompositionUpdate";break t}y=void 0}else Gi?Vi(t,i)&&(y="onCompositionEnd"):"keydown"===t&&229===i.keyCode&&(y="onCompositionStart");y&&(Ui&&"ko"!==i.locale&&(Gi||"onCompositionStart"!==y?"onCompositionEnd"===y&&Gi&&(v=ii()):(ti="value"in(Qe=n)?Qe.value:Qe.textContent,Gi=!0)),0<(_=kr(r,y)).length&&(y=new Ai(y,t,null,i,n),o.push({event:y,listeners:_}),(v||null!==(v=zi(i)))&&(y.data=v))),(v=Bi?function(t,e){switch(t){case"compositionend":return zi(e);case"keypress":return 32!==e.which?null:(ji=!0,Fi);case"textInput":return(t=e.data)===Fi&&ji?null:t;default:return null}}(t,i):function(t,e){if(Gi)return"compositionend"===t||!ki&&Vi(t,e)?(t=ii(),ei=ti=Qe=null,Gi=!1,t):null;switch(t){case"paste":default:return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Ui&&"ko"!==e.locale?null:e.data}}(t,i))&&0<(r=kr(r,"onBeforeInput")).length&&(n=new Ai("onBeforeInput","beforeinput",null,i,n),o.push({event:n,listeners:r}),n.data=v)}wr(o,e)}))}function Dr(t,e,i){return{instance:t,listener:e,currentTarget:i}}function kr(t,e){for(var i=e+"Capture",r=[];null!==t;){var n=t,s=n.stateNode;5===n.tag&&null!==s&&(n=s,null!=(s=Ft(t,i))&&r.unshift(Dr(t,s,n)),null!=(s=Ft(t,e))&&r.push(Dr(t,s,n))),t=t.return}return r}function Ir(t){if(null===t)return null;do{t=t.return}while(t&&5!==t.tag);return t||null}function Br(t,e,i,r,n){for(var s=e._reactName,o=[];null!==i&&i!==r;){var a=i,l=a.alternate,c=a.stateNode;if(null!==l&&l===r)break;5===a.tag&&null!==c&&(a=c,n?null!=(l=Ft(i,s))&&o.unshift(Dr(i,l,a)):n||null!=(l=Ft(i,s))&&o.push(Dr(i,l,a))),i=i.return}0!==o.length&&t.push({event:e,listeners:o})}function Ur(){}var Fr=null,jr=null;function Vr(t,e){switch(t){case"button":case"input":case"select":case"textarea":return!!e.autoFocus}return!1}function zr(t,e){return"textarea"===t||"option"===t||"noscript"===t||"string"==typeof e.children||"number"==typeof e.children||"object"==typeof e.dangerouslySetInnerHTML&&null!==e.dangerouslySetInnerHTML&&null!=e.dangerouslySetInnerHTML.__html}var Gr="function"==typeof setTimeout?setTimeout:void 0,Hr="function"==typeof clearTimeout?clearTimeout:void 0;function Yr(t){(1===t.nodeType||9===t.nodeType&&null!=(t=t.body))&&(t.textContent="")}function Xr(t){for(;null!=t;t=t.nextSibling){var e=t.nodeType;if(1===e||3===e)break}return t}function Wr(t){t=t.previousSibling;for(var e=0;t;){if(8===t.nodeType){var i=t.data;if("$"===i||"$!"===i||"$?"===i){if(0===e)return t;e--}else"/$"===i&&e++}t=t.previousSibling}return null}var Jr=0,$r=Math.random().toString(36).slice(2),qr="__reactFiber$"+$r,Kr="__reactProps$"+$r,Zr="__reactContainer$"+$r,Qr="__reactEvents$"+$r;function tn(t){var e=t[qr];if(e)return e;for(var i=t.parentNode;i;){if(e=i[Zr]||i[qr]){if(i=e.alternate,null!==e.child||null!==i&&null!==i.child)for(t=Wr(t);null!==t;){if(i=t[qr])return i;t=Wr(t)}return e}i=(t=i).parentNode}return null}function en(t){return!(t=t[qr]||t[Zr])||5!==t.tag&&6!==t.tag&&13!==t.tag&&3!==t.tag?null:t}function rn(t){if(5===t.tag||6===t.tag)return t.stateNode;throw Error(o(33))}function nn(t){return t[Kr]||null}function sn(t){var e=t[Qr];return void 0===e&&(e=t[Qr]=new Set),e}var on=[],an=-1;function ln(t){return{current:t}}function cn(t){0>an||(t.current=on[an],on[an]=null,an--)}function hn(t,e){an++,on[an]=t.current,t.current=e}var un={},dn=ln(un),pn=ln(!1),fn=un;function mn(t,e){var i=t.type.contextTypes;if(!i)return un;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var n,s={};for(n in i)s[n]=e[n];return r&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function gn(t){return null!=t.childContextTypes}function _n(){cn(pn),cn(dn)}function vn(t,e,i){if(dn.current!==un)throw Error(o(168));hn(dn,e),hn(pn,i)}function yn(t,e,i){var r=t.stateNode;if(t=e.childContextTypes,"function"!=typeof r.getChildContext)return i;for(var s in r=r.getChildContext())if(!(s in t))throw Error(o(108,W(e)||"Unknown",s));return n({},i,r)}function bn(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||un,fn=dn.current,hn(dn,t),hn(pn,pn.current),!0}function An(t,e,i){var r=t.stateNode;if(!r)throw Error(o(169));i?(t=yn(t,e,fn),r.__reactInternalMemoizedMergedChildContext=t,cn(pn),cn(dn),hn(dn,t)):cn(pn),hn(pn,i)}var xn=null,Cn=null,En=s.unstable_runWithPriority,Mn=s.unstable_scheduleCallback,Sn=s.unstable_cancelCallback,wn=s.unstable_shouldYield,Pn=s.unstable_requestPaint,Tn=s.unstable_now,On=s.unstable_getCurrentPriorityLevel,Rn=s.unstable_ImmediatePriority,Nn=s.unstable_UserBlockingPriority,Ln=s.unstable_NormalPriority,Dn=s.unstable_LowPriority,kn=s.unstable_IdlePriority,In={},Bn=void 0!==Pn?Pn:function(){},Un=null,Fn=null,jn=!1,Vn=Tn(),zn=1e4>Vn?Tn:function(){return Tn()-Vn};function Gn(){switch(On()){case Rn:return 99;case Nn:return 98;case Ln:return 97;case Dn:return 96;case kn:return 95;default:throw Error(o(332))}}function Hn(t){switch(t){case 99:return Rn;case 98:return Nn;case 97:return Ln;case 96:return Dn;case 95:return kn;default:throw Error(o(332))}}function Yn(t,e){return t=Hn(t),En(t,e)}function Xn(t,e,i){return t=Hn(t),Mn(t,e,i)}function Wn(){if(null!==Fn){var t=Fn;Fn=null,Sn(t)}Jn()}function Jn(){if(!jn&&null!==Un){jn=!0;var t=0;try{var e=Un;Yn(99,(function(){for(;t<e.length;t++){var i=e[t];do{i=i(!0)}while(null!==i)}})),Un=null}catch(e){throw null!==Un&&(Un=Un.slice(t+1)),Mn(Rn,Wn),e}finally{jn=!1}}}var $n=A.ReactCurrentBatchConfig;function qn(t,e){if(t&&t.defaultProps){for(var i in e=n({},e),t=t.defaultProps)void 0===e[i]&&(e[i]=t[i]);return e}return e}var Kn=ln(null),Zn=null,Qn=null,ts=null;function es(){ts=Qn=Zn=null}function is(t){var e=Kn.current;cn(Kn),t.type._context._currentValue=e}function rs(t,e){for(;null!==t;){var i=t.alternate;if((t.childLanes&e)===e){if(null===i||(i.childLanes&e)===e)break;i.childLanes|=e}else t.childLanes|=e,null!==i&&(i.childLanes|=e);t=t.return}}function ns(t,e){Zn=t,ts=Qn=null,null!==(t=t.dependencies)&&null!==t.firstContext&&(0!==(t.lanes&e)&&(Io=!0),t.firstContext=null)}function ss(t,e){if(ts!==t&&!1!==e&&0!==e)if("number"==typeof e&&1073741823!==e||(ts=t,e=1073741823),e={context:t,observedBits:e,next:null},null===Qn){if(null===Zn)throw Error(o(308));Qn=e,Zn.dependencies={lanes:0,firstContext:e,responders:null}}else Qn=Qn.next=e;return t._currentValue}var os=!1;function as(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function ls(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function cs(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function hs(t,e){if(null!==(t=t.updateQueue)){var i=(t=t.shared).pending;null===i?e.next=e:(e.next=i.next,i.next=e),t.pending=e}}function us(t,e){var i=t.updateQueue,r=t.alternate;if(null!==r&&i===(r=r.updateQueue)){var n=null,s=null;if(null!==(i=i.firstBaseUpdate)){do{var o={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};null===s?n=s=o:s=s.next=o,i=i.next}while(null!==i);null===s?n=s=e:s=s.next=e}else n=s=e;return i={baseState:r.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:r.shared,effects:r.effects},void(t.updateQueue=i)}null===(t=i.lastBaseUpdate)?i.firstBaseUpdate=e:t.next=e,i.lastBaseUpdate=e}function ds(t,e,i,r){var s=t.updateQueue;os=!1;var o=s.firstBaseUpdate,a=s.lastBaseUpdate,l=s.shared.pending;if(null!==l){s.shared.pending=null;var c=l,h=c.next;c.next=null,null===a?o=h:a.next=h,a=c;var u=t.alternate;if(null!==u){var d=(u=u.updateQueue).lastBaseUpdate;d!==a&&(null===d?u.firstBaseUpdate=h:d.next=h,u.lastBaseUpdate=c)}}if(null!==o){for(d=s.baseState,a=0,u=h=c=null;;){l=o.lane;var p=o.eventTime;if((r&l)===l){null!==u&&(u=u.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});t:{var f=t,m=o;switch(l=e,p=i,m.tag){case 1:if("function"==typeof(f=m.payload)){d=f.call(p,d,l);break t}d=f;break t;case 3:f.flags=-4097&f.flags|64;case 0:if(null==(l="function"==typeof(f=m.payload)?f.call(p,d,l):f))break t;d=n({},d,l);break t;case 2:os=!0}}null!==o.callback&&(t.flags|=32,null===(l=s.effects)?s.effects=[o]:l.push(o))}else p={eventTime:p,lane:l,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(h=u=p,c=d):u=u.next=p,a|=l;if(null===(o=o.next)){if(null===(l=s.shared.pending))break;o=l.next,l.next=null,s.lastBaseUpdate=l,s.shared.pending=null}}null===u&&(c=d),s.baseState=c,s.firstBaseUpdate=h,s.lastBaseUpdate=u,Fa|=a,t.lanes=a,t.memoizedState=d}}function ps(t,e,i){if(t=e.effects,e.effects=null,null!==t)for(e=0;e<t.length;e++){var r=t[e],n=r.callback;if(null!==n){if(r.callback=null,r=i,"function"!=typeof n)throw Error(o(191,n));n.call(r)}}}var fs=(new r.Component).refs;function ms(t,e,i,r){i=null==(i=i(r,e=t.memoizedState))?e:n({},e,i),t.memoizedState=i,0===t.lanes&&(t.updateQueue.baseState=i)}var gs={isMounted:function(t){return!!(t=t._reactInternals)&&$t(t)===t},enqueueSetState:function(t,e,i){t=t._reactInternals;var r=hl(),n=ul(t),s=cs(r,n);s.payload=e,null!=i&&(s.callback=i),hs(t,s),dl(t,n,r)},enqueueReplaceState:function(t,e,i){t=t._reactInternals;var r=hl(),n=ul(t),s=cs(r,n);s.tag=1,s.payload=e,null!=i&&(s.callback=i),hs(t,s),dl(t,n,r)},enqueueForceUpdate:function(t,e){t=t._reactInternals;var i=hl(),r=ul(t),n=cs(i,r);n.tag=2,null!=e&&(n.callback=e),hs(t,n),dl(t,r,i)}};function _s(t,e,i,r,n,s,o){return"function"==typeof(t=t.stateNode).shouldComponentUpdate?t.shouldComponentUpdate(r,s,o):!(e.prototype&&e.prototype.isPureReactComponent&&hr(i,r)&&hr(n,s))}function vs(t,e,i){var r=!1,n=un,s=e.contextType;return"object"==typeof s&&null!==s?s=ss(s):(n=gn(e)?fn:dn.current,s=(r=null!=(r=e.contextTypes))?mn(t,n):un),e=new e(i,s),t.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,e.updater=gs,t.stateNode=e,e._reactInternals=t,r&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=n,t.__reactInternalMemoizedMaskedChildContext=s),e}function ys(t,e,i,r){t=e.state,"function"==typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(i,r),"function"==typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(i,r),e.state!==t&&gs.enqueueReplaceState(e,e.state,null)}function bs(t,e,i,r){var n=t.stateNode;n.props=i,n.state=t.memoizedState,n.refs=fs,as(t);var s=e.contextType;"object"==typeof s&&null!==s?n.context=ss(s):(s=gn(e)?fn:dn.current,n.context=mn(t,s)),ds(t,i,n,r),n.state=t.memoizedState,"function"==typeof(s=e.getDerivedStateFromProps)&&(ms(t,e,s,i),n.state=t.memoizedState),"function"==typeof e.getDerivedStateFromProps||"function"==typeof n.getSnapshotBeforeUpdate||"function"!=typeof n.UNSAFE_componentWillMount&&"function"!=typeof n.componentWillMount||(e=n.state,"function"==typeof n.componentWillMount&&n.componentWillMount(),"function"==typeof n.UNSAFE_componentWillMount&&n.UNSAFE_componentWillMount(),e!==n.state&&gs.enqueueReplaceState(n,n.state,null),ds(t,i,n,r),n.state=t.memoizedState),"function"==typeof n.componentDidMount&&(t.flags|=4)}var As=Array.isArray;function xs(t,e,i){if(null!==(t=i.ref)&&"function"!=typeof t&&"object"!=typeof t){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(o(309));var r=i.stateNode}if(!r)throw Error(o(147,t));var n=""+t;return null!==e&&null!==e.ref&&"function"==typeof e.ref&&e.ref._stringRef===n?e.ref:(e=function(t){var e=r.refs;e===fs&&(e=r.refs={}),null===t?delete e[n]:e[n]=t},e._stringRef=n,e)}if("string"!=typeof t)throw Error(o(284));if(!i._owner)throw Error(o(290,t))}return t}function Cs(t,e){if("textarea"!==t.type)throw Error(o(31,"[object Object]"===Object.prototype.toString.call(e)?"object with keys {"+Object.keys(e).join(", ")+"}":e))}function Es(t){function e(e,i){if(t){var r=e.lastEffect;null!==r?(r.nextEffect=i,e.lastEffect=i):e.firstEffect=e.lastEffect=i,i.nextEffect=null,i.flags=8}}function i(i,r){if(!t)return null;for(;null!==r;)e(i,r),r=r.sibling;return null}function r(t,e){for(t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function n(t,e){return(t=Hl(t,e)).index=0,t.sibling=null,t}function s(e,i,r){return e.index=r,t?null!==(r=e.alternate)?(r=r.index)<i?(e.flags=2,i):r:(e.flags=2,i):i}function a(e){return t&&null===e.alternate&&(e.flags=2),e}function l(t,e,i,r){return null===e||6!==e.tag?((e=Jl(i,t.mode,r)).return=t,e):((e=n(e,i)).return=t,e)}function c(t,e,i,r){return null!==e&&e.elementType===i.type?((r=n(e,i.props)).ref=xs(t,e,i),r.return=t,r):((r=Yl(i.type,i.key,i.props,null,t.mode,r)).ref=xs(t,e,i),r.return=t,r)}function h(t,e,i,r){return null===e||4!==e.tag||e.stateNode.containerInfo!==i.containerInfo||e.stateNode.implementation!==i.implementation?((e=$l(i,t.mode,r)).return=t,e):((e=n(e,i.children||[])).return=t,e)}function u(t,e,i,r,s){return null===e||7!==e.tag?((e=Xl(i,t.mode,r,s)).return=t,e):((e=n(e,i)).return=t,e)}function d(t,e,i){if("string"==typeof e||"number"==typeof e)return(e=Jl(""+e,t.mode,i)).return=t,e;if("object"==typeof e&&null!==e){switch(e.$$typeof){case x:return(i=Yl(e.type,e.key,e.props,null,t.mode,i)).ref=xs(t,null,e),i.return=t,i;case C:return(e=$l(e,t.mode,i)).return=t,e}if(As(e)||z(e))return(e=Xl(e,t.mode,i,null)).return=t,e;Cs(t,e)}return null}function p(t,e,i,r){var n=null!==e?e.key:null;if("string"==typeof i||"number"==typeof i)return null!==n?null:l(t,e,""+i,r);if("object"==typeof i&&null!==i){switch(i.$$typeof){case x:return i.key===n?i.type===E?u(t,e,i.props.children,r,n):c(t,e,i,r):null;case C:return i.key===n?h(t,e,i,r):null}if(As(i)||z(i))return null!==n?null:u(t,e,i,r,null);Cs(t,i)}return null}function f(t,e,i,r,n){if("string"==typeof r||"number"==typeof r)return l(e,t=t.get(i)||null,""+r,n);if("object"==typeof r&&null!==r){switch(r.$$typeof){case x:return t=t.get(null===r.key?i:r.key)||null,r.type===E?u(e,t,r.props.children,n,r.key):c(e,t,r,n);case C:return h(e,t=t.get(null===r.key?i:r.key)||null,r,n)}if(As(r)||z(r))return u(e,t=t.get(i)||null,r,n,null);Cs(e,r)}return null}function m(n,o,a,l){for(var c=null,h=null,u=o,m=o=0,g=null;null!==u&&m<a.length;m++){u.index>m?(g=u,u=null):g=u.sibling;var _=p(n,u,a[m],l);if(null===_){null===u&&(u=g);break}t&&u&&null===_.alternate&&e(n,u),o=s(_,o,m),null===h?c=_:h.sibling=_,h=_,u=g}if(m===a.length)return i(n,u),c;if(null===u){for(;m<a.length;m++)null!==(u=d(n,a[m],l))&&(o=s(u,o,m),null===h?c=u:h.sibling=u,h=u);return c}for(u=r(n,u);m<a.length;m++)null!==(g=f(u,n,m,a[m],l))&&(t&&null!==g.alternate&&u.delete(null===g.key?m:g.key),o=s(g,o,m),null===h?c=g:h.sibling=g,h=g);return t&&u.forEach((function(t){return e(n,t)})),c}function g(n,a,l,c){var h=z(l);if("function"!=typeof h)throw Error(o(150));if(null==(l=h.call(l)))throw Error(o(151));for(var u=h=null,m=a,g=a=0,_=null,v=l.next();null!==m&&!v.done;g++,v=l.next()){m.index>g?(_=m,m=null):_=m.sibling;var y=p(n,m,v.value,c);if(null===y){null===m&&(m=_);break}t&&m&&null===y.alternate&&e(n,m),a=s(y,a,g),null===u?h=y:u.sibling=y,u=y,m=_}if(v.done)return i(n,m),h;if(null===m){for(;!v.done;g++,v=l.next())null!==(v=d(n,v.value,c))&&(a=s(v,a,g),null===u?h=v:u.sibling=v,u=v);return h}for(m=r(n,m);!v.done;g++,v=l.next())null!==(v=f(m,n,g,v.value,c))&&(t&&null!==v.alternate&&m.delete(null===v.key?g:v.key),a=s(v,a,g),null===u?h=v:u.sibling=v,u=v);return t&&m.forEach((function(t){return e(n,t)})),h}return function(t,r,s,l){var c="object"==typeof s&&null!==s&&s.type===E&&null===s.key;c&&(s=s.props.children);var h="object"==typeof s&&null!==s;if(h)switch(s.$$typeof){case x:t:{for(h=s.key,c=r;null!==c;){if(c.key===h){if(7===c.tag){if(s.type===E){i(t,c.sibling),(r=n(c,s.props.children)).return=t,t=r;break t}}else if(c.elementType===s.type){i(t,c.sibling),(r=n(c,s.props)).ref=xs(t,c,s),r.return=t,t=r;break t}i(t,c);break}e(t,c),c=c.sibling}s.type===E?((r=Xl(s.props.children,t.mode,l,s.key)).return=t,t=r):((l=Yl(s.type,s.key,s.props,null,t.mode,l)).ref=xs(t,r,s),l.return=t,t=l)}return a(t);case C:t:{for(c=s.key;null!==r;){if(r.key===c){if(4===r.tag&&r.stateNode.containerInfo===s.containerInfo&&r.stateNode.implementation===s.implementation){i(t,r.sibling),(r=n(r,s.children||[])).return=t,t=r;break t}i(t,r);break}e(t,r),r=r.sibling}(r=$l(s,t.mode,l)).return=t,t=r}return a(t)}if("string"==typeof s||"number"==typeof s)return s=""+s,null!==r&&6===r.tag?(i(t,r.sibling),(r=n(r,s)).return=t,t=r):(i(t,r),(r=Jl(s,t.mode,l)).return=t,t=r),a(t);if(As(s))return m(t,r,s,l);if(z(s))return g(t,r,s,l);if(h&&Cs(t,s),void 0===s&&!c)switch(t.tag){case 1:case 22:case 0:case 11:case 15:throw Error(o(152,W(t.type)||"Component"))}return i(t,r)}}var Ms=Es(!0),Ss=Es(!1),ws={},Ps=ln(ws),Ts=ln(ws),Os=ln(ws);function Rs(t){if(t===ws)throw Error(o(174));return t}function Ns(t,e){switch(hn(Os,e),hn(Ts,t),hn(Ps,ws),t=e.nodeType){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:pt(null,"");break;default:e=pt(e=(t=8===t?e.parentNode:e).namespaceURI||null,t=t.tagName)}cn(Ps),hn(Ps,e)}function Ls(){cn(Ps),cn(Ts),cn(Os)}function Ds(t){Rs(Os.current);var e=Rs(Ps.current),i=pt(e,t.type);e!==i&&(hn(Ts,t),hn(Ps,i))}function ks(t){Ts.current===t&&(cn(Ps),cn(Ts))}var Is=ln(0);function Bs(t){for(var e=t;null!==e;){if(13===e.tag){var i=e.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||"$!"===i.data))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(64&e.flags)return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Us=null,Fs=null,js=!1;function Vs(t,e){var i=zl(5,null,null,0);i.elementType="DELETED",i.type="DELETED",i.stateNode=e,i.return=t,i.flags=8,null!==t.lastEffect?(t.lastEffect.nextEffect=i,t.lastEffect=i):t.firstEffect=t.lastEffect=i}function zs(t,e){switch(t.tag){case 5:var i=t.type;return null!==(e=1!==e.nodeType||i.toLowerCase()!==e.nodeName.toLowerCase()?null:e)&&(t.stateNode=e,!0);case 6:return null!==(e=""===t.pendingProps||3!==e.nodeType?null:e)&&(t.stateNode=e,!0);default:return!1}}function Gs(t){if(js){var e=Fs;if(e){var i=e;if(!zs(t,e)){if(!(e=Xr(i.nextSibling))||!zs(t,e))return t.flags=-1025&t.flags|2,js=!1,void(Us=t);Vs(Us,i)}Us=t,Fs=Xr(e.firstChild)}else t.flags=-1025&t.flags|2,js=!1,Us=t}}function Hs(t){for(t=t.return;null!==t&&5!==t.tag&&3!==t.tag&&13!==t.tag;)t=t.return;Us=t}function Ys(t){if(t!==Us)return!1;if(!js)return Hs(t),js=!0,!1;var e=t.type;if(5!==t.tag||"head"!==e&&"body"!==e&&!zr(e,t.memoizedProps))for(e=Fs;e;)Vs(t,e),e=Xr(e.nextSibling);if(Hs(t),13===t.tag){if(!(t=null!==(t=t.memoizedState)?t.dehydrated:null))throw Error(o(317));t:{for(t=t.nextSibling,e=0;t;){if(8===t.nodeType){var i=t.data;if("/$"===i){if(0===e){Fs=Xr(t.nextSibling);break t}e--}else"$"!==i&&"$!"!==i&&"$?"!==i||e++}t=t.nextSibling}Fs=null}}else Fs=Us?Xr(t.stateNode.nextSibling):null;return!0}function Xs(){Fs=Us=null,js=!1}var Ws=[];function Js(){for(var t=0;t<Ws.length;t++)Ws[t]._workInProgressVersionPrimary=null;Ws.length=0}var $s=A.ReactCurrentDispatcher,qs=A.ReactCurrentBatchConfig,Ks=0,Zs=null,Qs=null,to=null,eo=!1,io=!1;function ro(){throw Error(o(321))}function no(t,e){if(null===e)return!1;for(var i=0;i<e.length&&i<t.length;i++)if(!lr(t[i],e[i]))return!1;return!0}function so(t,e,i,r,n,s){if(Ks=s,Zs=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,$s.current=null===t||null===t.memoizedState?No:Lo,t=i(r,n),io){s=0;do{if(io=!1,!(25>s))throw Error(o(301));s+=1,to=Qs=null,e.updateQueue=null,$s.current=Do,t=i(r,n)}while(io)}if($s.current=Ro,e=null!==Qs&&null!==Qs.next,Ks=0,to=Qs=Zs=null,eo=!1,e)throw Error(o(300));return t}function oo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===to?Zs.memoizedState=to=t:to=to.next=t,to}function ao(){if(null===Qs){var t=Zs.alternate;t=null!==t?t.memoizedState:null}else t=Qs.next;var e=null===to?Zs.memoizedState:to.next;if(null!==e)to=e,Qs=t;else{if(null===t)throw Error(o(310));t={memoizedState:(Qs=t).memoizedState,baseState:Qs.baseState,baseQueue:Qs.baseQueue,queue:Qs.queue,next:null},null===to?Zs.memoizedState=to=t:to=to.next=t}return to}function lo(t,e){return"function"==typeof e?e(t):e}function co(t){var e=ao(),i=e.queue;if(null===i)throw Error(o(311));i.lastRenderedReducer=t;var r=Qs,n=r.baseQueue,s=i.pending;if(null!==s){if(null!==n){var a=n.next;n.next=s.next,s.next=a}r.baseQueue=n=s,i.pending=null}if(null!==n){n=n.next,r=r.baseState;var l=a=s=null,c=n;do{var h=c.lane;if((Ks&h)===h)null!==l&&(l=l.next={lane:0,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),r=c.eagerReducer===t?c.eagerState:t(r,c.action);else{var u={lane:h,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===l?(a=l=u,s=r):l=l.next=u,Zs.lanes|=h,Fa|=h}c=c.next}while(null!==c&&c!==n);null===l?s=r:l.next=a,lr(r,e.memoizedState)||(Io=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=l,i.lastRenderedState=r}return[e.memoizedState,i.dispatch]}function ho(t){var e=ao(),i=e.queue;if(null===i)throw Error(o(311));i.lastRenderedReducer=t;var r=i.dispatch,n=i.pending,s=e.memoizedState;if(null!==n){i.pending=null;var a=n=n.next;do{s=t(s,a.action),a=a.next}while(a!==n);lr(s,e.memoizedState)||(Io=!0),e.memoizedState=s,null===e.baseQueue&&(e.baseState=s),i.lastRenderedState=s}return[s,r]}function uo(t,e,i){var r=e._getVersion;r=r(e._source);var n=e._workInProgressVersionPrimary;if(null!==n?t=n===r:(t=t.mutableReadLanes,(t=(Ks&t)===t)&&(e._workInProgressVersionPrimary=r,Ws.push(e))),t)return i(e._source);throw Ws.push(e),Error(o(350))}function po(t,e,i,r){var n=Ra;if(null===n)throw Error(o(349));var s=e._getVersion,a=s(e._source),l=$s.current,c=l.useState((function(){return uo(n,e,i)})),h=c[1],u=c[0];c=to;var d=t.memoizedState,p=d.refs,f=p.getSnapshot,m=d.source;d=d.subscribe;var g=Zs;return t.memoizedState={refs:p,source:e,subscribe:r},l.useEffect((function(){p.getSnapshot=i,p.setSnapshot=h;var t=s(e._source);if(!lr(a,t)){t=i(e._source),lr(u,t)||(h(t),t=ul(g),n.mutableReadLanes|=t&n.pendingLanes),t=n.mutableReadLanes,n.entangledLanes|=t;for(var r=n.entanglements,o=t;0<o;){var l=31-Ge(o),c=1<<l;r[l]|=t,o&=~c}}}),[i,e,r]),l.useEffect((function(){return r(e._source,(function(){var t=p.getSnapshot,i=p.setSnapshot;try{i(t(e._source));var r=ul(g);n.mutableReadLanes|=r&n.pendingLanes}catch(t){i((function(){throw t}))}}))}),[e,r]),lr(f,i)&&lr(m,e)&&lr(d,r)||((t={pending:null,dispatch:null,lastRenderedReducer:lo,lastRenderedState:u}).dispatch=h=Oo.bind(null,Zs,t),c.queue=t,c.baseQueue=null,u=uo(n,e,i),c.memoizedState=c.baseState=u),u}function fo(t,e,i){return po(ao(),t,e,i)}function mo(t){var e=oo();return"function"==typeof t&&(t=t()),e.memoizedState=e.baseState=t,t=(t=e.queue={pending:null,dispatch:null,lastRenderedReducer:lo,lastRenderedState:t}).dispatch=Oo.bind(null,Zs,t),[e.memoizedState,t]}function go(t,e,i,r){return t={tag:t,create:e,destroy:i,deps:r,next:null},null===(e=Zs.updateQueue)?(e={lastEffect:null},Zs.updateQueue=e,e.lastEffect=t.next=t):null===(i=e.lastEffect)?e.lastEffect=t.next=t:(r=i.next,i.next=t,t.next=r,e.lastEffect=t),t}function _o(t){return t={current:t},oo().memoizedState=t}function vo(){return ao().memoizedState}function yo(t,e,i,r){var n=oo();Zs.flags|=t,n.memoizedState=go(1|e,i,void 0,void 0===r?null:r)}function bo(t,e,i,r){var n=ao();r=void 0===r?null:r;var s=void 0;if(null!==Qs){var o=Qs.memoizedState;if(s=o.destroy,null!==r&&no(r,o.deps))return void go(e,i,s,r)}Zs.flags|=t,n.memoizedState=go(1|e,i,s,r)}function Ao(t,e){return yo(516,4,t,e)}function xo(t,e){return bo(516,4,t,e)}function Co(t,e){return bo(4,2,t,e)}function Eo(t,e){return"function"==typeof e?(t=t(),e(t),function(){e(null)}):null!=e?(t=t(),e.current=t,function(){e.current=null}):void 0}function Mo(t,e,i){return i=null!=i?i.concat([t]):null,bo(4,2,Eo.bind(null,e,t),i)}function So(){}function wo(t,e){var i=ao();e=void 0===e?null:e;var r=i.memoizedState;return null!==r&&null!==e&&no(e,r[1])?r[0]:(i.memoizedState=[t,e],t)}function Po(t,e){var i=ao();e=void 0===e?null:e;var r=i.memoizedState;return null!==r&&null!==e&&no(e,r[1])?r[0]:(t=t(),i.memoizedState=[t,e],t)}function To(t,e){var i=Gn();Yn(98>i?98:i,(function(){t(!0)})),Yn(97<i?97:i,(function(){var i=qs.transition;qs.transition=1;try{t(!1),e()}finally{qs.transition=i}}))}function Oo(t,e,i){var r=hl(),n=ul(t),s={lane:n,action:i,eagerReducer:null,eagerState:null,next:null},o=e.pending;if(null===o?s.next=s:(s.next=o.next,o.next=s),e.pending=s,o=t.alternate,t===Zs||null!==o&&o===Zs)io=eo=!0;else{if(0===t.lanes&&(null===o||0===o.lanes)&&null!==(o=e.lastRenderedReducer))try{var a=e.lastRenderedState,l=o(a,i);if(s.eagerReducer=o,s.eagerState=l,lr(l,a))return}catch(t){}dl(t,n,r)}}var Ro={readContext:ss,useCallback:ro,useContext:ro,useEffect:ro,useImperativeHandle:ro,useLayoutEffect:ro,useMemo:ro,useReducer:ro,useRef:ro,useState:ro,useDebugValue:ro,useDeferredValue:ro,useTransition:ro,useMutableSource:ro,useOpaqueIdentifier:ro,unstable_isNewReconciler:!1},No={readContext:ss,useCallback:function(t,e){return oo().memoizedState=[t,void 0===e?null:e],t},useContext:ss,useEffect:Ao,useImperativeHandle:function(t,e,i){return i=null!=i?i.concat([t]):null,yo(4,2,Eo.bind(null,e,t),i)},useLayoutEffect:function(t,e){return yo(4,2,t,e)},useMemo:function(t,e){var i=oo();return e=void 0===e?null:e,t=t(),i.memoizedState=[t,e],t},useReducer:function(t,e,i){var r=oo();return e=void 0!==i?i(e):e,r.memoizedState=r.baseState=e,t=(t=r.queue={pending:null,dispatch:null,lastRenderedReducer:t,lastRenderedState:e}).dispatch=Oo.bind(null,Zs,t),[r.memoizedState,t]},useRef:_o,useState:mo,useDebugValue:So,useDeferredValue:function(t){var e=mo(t),i=e[0],r=e[1];return Ao((function(){var e=qs.transition;qs.transition=1;try{r(t)}finally{qs.transition=e}}),[t]),i},useTransition:function(){var t=mo(!1),e=t[0];return _o(t=To.bind(null,t[1])),[t,e]},useMutableSource:function(t,e,i){var r=oo();return r.memoizedState={refs:{getSnapshot:e,setSnapshot:null},source:t,subscribe:i},po(r,t,e,i)},useOpaqueIdentifier:function(){if(js){var t=!1,e=function(t){return{$$typeof:k,toString:t,valueOf:t}}((function(){throw t||(t=!0,i("r:"+(Jr++).toString(36))),Error(o(355))})),i=mo(e)[1];return!(2&Zs.mode)&&(Zs.flags|=516,go(5,(function(){i("r:"+(Jr++).toString(36))}),void 0,null)),e}return mo(e="r:"+(Jr++).toString(36)),e},unstable_isNewReconciler:!1},Lo={readContext:ss,useCallback:wo,useContext:ss,useEffect:xo,useImperativeHandle:Mo,useLayoutEffect:Co,useMemo:Po,useReducer:co,useRef:vo,useState:function(){return co(lo)},useDebugValue:So,useDeferredValue:function(t){var e=co(lo),i=e[0],r=e[1];return xo((function(){var e=qs.transition;qs.transition=1;try{r(t)}finally{qs.transition=e}}),[t]),i},useTransition:function(){var t=co(lo)[0];return[vo().current,t]},useMutableSource:fo,useOpaqueIdentifier:function(){return co(lo)[0]},unstable_isNewReconciler:!1},Do={readContext:ss,useCallback:wo,useContext:ss,useEffect:xo,useImperativeHandle:Mo,useLayoutEffect:Co,useMemo:Po,useReducer:ho,useRef:vo,useState:function(){return ho(lo)},useDebugValue:So,useDeferredValue:function(t){var e=ho(lo),i=e[0],r=e[1];return xo((function(){var e=qs.transition;qs.transition=1;try{r(t)}finally{qs.transition=e}}),[t]),i},useTransition:function(){var t=ho(lo)[0];return[vo().current,t]},useMutableSource:fo,useOpaqueIdentifier:function(){return ho(lo)[0]},unstable_isNewReconciler:!1},ko=A.ReactCurrentOwner,Io=!1;function Bo(t,e,i,r){e.child=null===t?Ss(e,null,i,r):Ms(e,t.child,i,r)}function Uo(t,e,i,r,n){i=i.render;var s=e.ref;return ns(e,n),r=so(t,e,i,r,s,n),null===t||Io?(e.flags|=1,Bo(t,e,r,n),e.child):(e.updateQueue=t.updateQueue,e.flags&=-517,t.lanes&=~n,ra(t,e,n))}function Fo(t,e,i,r,n,s){if(null===t){var o=i.type;return"function"!=typeof o||Gl(o)||void 0!==o.defaultProps||null!==i.compare||void 0!==i.defaultProps?((t=Yl(i.type,null,r,e,e.mode,s)).ref=e.ref,t.return=e,e.child=t):(e.tag=15,e.type=o,jo(t,e,o,r,n,s))}return o=t.child,0===(n&s)&&(n=o.memoizedProps,(i=null!==(i=i.compare)?i:hr)(n,r)&&t.ref===e.ref)?ra(t,e,s):(e.flags|=1,(t=Hl(o,r)).ref=e.ref,t.return=e,e.child=t)}function jo(t,e,i,r,n,s){if(null!==t&&hr(t.memoizedProps,r)&&t.ref===e.ref){if(Io=!1,0===(s&n))return e.lanes=t.lanes,ra(t,e,s);16384&t.flags&&(Io=!0)}return Go(t,e,i,r,s)}function Vo(t,e,i){var r=e.pendingProps,n=r.children,s=null!==t?t.memoizedState:null;if("hidden"===r.mode||"unstable-defer-without-hiding"===r.mode)if(4&e.mode){if(!(1073741824&i))return t=null!==s?s.baseLanes|i:i,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t},bl(0,t),null;e.memoizedState={baseLanes:0},bl(0,null!==s?s.baseLanes:i)}else e.memoizedState={baseLanes:0},bl(0,i);else null!==s?(r=s.baseLanes|i,e.memoizedState=null):r=i,bl(0,r);return Bo(t,e,n,i),e.child}function zo(t,e){var i=e.ref;(null===t&&null!==i||null!==t&&t.ref!==i)&&(e.flags|=128)}function Go(t,e,i,r,n){var s=gn(i)?fn:dn.current;return s=mn(e,s),ns(e,n),i=so(t,e,i,r,s,n),null===t||Io?(e.flags|=1,Bo(t,e,i,n),e.child):(e.updateQueue=t.updateQueue,e.flags&=-517,t.lanes&=~n,ra(t,e,n))}function Ho(t,e,i,r,n){if(gn(i)){var s=!0;bn(e)}else s=!1;if(ns(e,n),null===e.stateNode)null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),vs(e,i,r),bs(e,i,r,n),r=!0;else if(null===t){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=i.contextType;c="object"==typeof c&&null!==c?ss(c):mn(e,c=gn(i)?fn:dn.current);var h=i.getDerivedStateFromProps,u="function"==typeof h||"function"==typeof o.getSnapshotBeforeUpdate;u||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==r||l!==c)&&ys(e,o,r,c),os=!1;var d=e.memoizedState;o.state=d,ds(e,r,o,n),l=e.memoizedState,a!==r||d!==l||pn.current||os?("function"==typeof h&&(ms(e,i,h,r),l=e.memoizedState),(a=os||_s(e,i,a,r,d,l,c))?(u||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(e.flags|=4)):("function"==typeof o.componentDidMount&&(e.flags|=4),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):("function"==typeof o.componentDidMount&&(e.flags|=4),r=!1)}else{o=e.stateNode,ls(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:qn(e.type,a),o.props=c,u=e.pendingProps,d=o.context,l="object"==typeof(l=i.contextType)&&null!==l?ss(l):mn(e,l=gn(i)?fn:dn.current);var p=i.getDerivedStateFromProps;(h="function"==typeof p||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==u||d!==l)&&ys(e,o,r,l),os=!1,d=e.memoizedState,o.state=d,ds(e,r,o,n);var f=e.memoizedState;a!==u||d!==f||pn.current||os?("function"==typeof p&&(ms(e,i,p,r),f=e.memoizedState),(c=os||_s(e,i,c,r,d,f,l))?(h||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(r,f,l),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,f,l)),"function"==typeof o.componentDidUpdate&&(e.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(e.flags|=256)):("function"!=typeof o.componentDidUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=256),e.memoizedProps=r,e.memoizedState=f),o.props=r,o.state=f,o.context=l,r=c):("function"!=typeof o.componentDidUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=256),r=!1)}return Yo(t,e,i,r,s,n)}function Yo(t,e,i,r,n,s){zo(t,e);var o=!!(64&e.flags);if(!r&&!o)return n&&An(e,i,!1),ra(t,e,s);r=e.stateNode,ko.current=e;var a=o&&"function"!=typeof i.getDerivedStateFromError?null:r.render();return e.flags|=1,null!==t&&o?(e.child=Ms(e,t.child,null,s),e.child=Ms(e,null,a,s)):Bo(t,e,a,s),e.memoizedState=r.state,n&&An(e,i,!0),e.child}function Xo(t){var e=t.stateNode;e.pendingContext?vn(0,e.pendingContext,e.pendingContext!==e.context):e.context&&vn(0,e.context,!1),Ns(t,e.containerInfo)}var Wo,Jo,$o,qo,Ko={dehydrated:null,retryLane:0};function Zo(t,e,i){var r,n=e.pendingProps,s=Is.current,o=!1;return(r=!!(64&e.flags))||(r=(null===t||null!==t.memoizedState)&&!!(2&s)),r?(o=!0,e.flags&=-65):null!==t&&null===t.memoizedState||void 0===n.fallback||!0===n.unstable_avoidThisFallback||(s|=1),hn(Is,1&s),null===t?(void 0!==n.fallback&&Gs(e),t=n.children,s=n.fallback,o?(t=Qo(e,t,s,i),e.child.memoizedState={baseLanes:i},e.memoizedState=Ko,t):"number"==typeof n.unstable_expectedLoadTime?(t=Qo(e,t,s,i),e.child.memoizedState={baseLanes:i},e.memoizedState=Ko,e.lanes=33554432,t):((i=Wl({mode:"visible",children:t},e.mode,i,null)).return=e,e.child=i)):(t.memoizedState,o?(n=function(t,e,i,r,n){var s=e.mode,o=t.child;t=o.sibling;var a={mode:"hidden",children:i};return 2&s||e.child===o?i=Hl(o,a):((i=e.child).childLanes=0,i.pendingProps=a,null!==(o=i.lastEffect)?(e.firstEffect=i.firstEffect,e.lastEffect=o,o.nextEffect=null):e.firstEffect=e.lastEffect=null),null!==t?r=Hl(t,r):(r=Xl(r,s,n,null)).flags|=2,r.return=e,i.return=e,i.sibling=r,e.child=i,r}(t,e,n.children,n.fallback,i),o=e.child,s=t.child.memoizedState,o.memoizedState=null===s?{baseLanes:i}:{baseLanes:s.baseLanes|i},o.childLanes=t.childLanes&~i,e.memoizedState=Ko,n):(i=function(t,e,i,r){var n=t.child;return t=n.sibling,i=Hl(n,{mode:"visible",children:i}),!(2&e.mode)&&(i.lanes=r),i.return=e,i.sibling=null,null!==t&&(t.nextEffect=null,t.flags=8,e.firstEffect=e.lastEffect=t),e.child=i}(t,e,n.children,i),e.memoizedState=null,i))}function Qo(t,e,i,r){var n=t.mode,s=t.child;return e={mode:"hidden",children:e},2&n||null===s?s=Wl(e,n,0,null):(s.childLanes=0,s.pendingProps=e),i=Xl(i,n,r,null),s.return=t,i.return=t,s.sibling=i,t.child=s,i}function ta(t,e){t.lanes|=e;var i=t.alternate;null!==i&&(i.lanes|=e),rs(t.return,e)}function ea(t,e,i,r,n,s){var o=t.memoizedState;null===o?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:i,tailMode:n,lastEffect:s}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=i,o.tailMode=n,o.lastEffect=s)}function ia(t,e,i){var r=e.pendingProps,n=r.revealOrder,s=r.tail;if(Bo(t,e,r.children,i),2&(r=Is.current))r=1&r|2,e.flags|=64;else{if(null!==t&&64&t.flags)t:for(t=e.child;null!==t;){if(13===t.tag)null!==t.memoizedState&&ta(t,i);else if(19===t.tag)ta(t,i);else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(hn(Is,r),2&e.mode)switch(n){case"forwards":for(i=e.child,n=null;null!==i;)null!==(t=i.alternate)&&null===Bs(t)&&(n=i),i=i.sibling;null===(i=n)?(n=e.child,e.child=null):(n=i.sibling,i.sibling=null),ea(e,!1,n,i,s,e.lastEffect);break;case"backwards":for(i=null,n=e.child,e.child=null;null!==n;){if(null!==(t=n.alternate)&&null===Bs(t)){e.child=n;break}t=n.sibling,n.sibling=i,i=n,n=t}ea(e,!0,i,null,s,e.lastEffect);break;case"together":ea(e,!1,null,null,void 0,e.lastEffect);break;default:e.memoizedState=null}else e.memoizedState=null;return e.child}function ra(t,e,i){if(null!==t&&(e.dependencies=t.dependencies),Fa|=e.lanes,0!==(i&e.childLanes)){if(null!==t&&e.child!==t.child)throw Error(o(153));if(null!==e.child){for(i=Hl(t=e.child,t.pendingProps),e.child=i,i.return=e;null!==t.sibling;)t=t.sibling,(i=i.sibling=Hl(t,t.pendingProps)).return=e;i.sibling=null}return e.child}return null}function na(t,e){if(!js)switch(t.tailMode){case"hidden":e=t.tail;for(var i=null;null!==e;)null!==e.alternate&&(i=e),e=e.sibling;null===i?t.tail=null:i.sibling=null;break;case"collapsed":i=t.tail;for(var r=null;null!==i;)null!==i.alternate&&(r=i),i=i.sibling;null===r?e||null===t.tail?t.tail=null:t.tail.sibling=null:r.sibling=null}}function sa(t,e,i){var r=e.pendingProps;switch(e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:case 17:return gn(e.type)&&_n(),null;case 3:return Ls(),cn(pn),cn(dn),Js(),(r=e.stateNode).pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==t&&null!==t.child||(Ys(e)?e.flags|=4:r.hydrate||(e.flags|=256)),Jo(e),null;case 5:ks(e);var s=Rs(Os.current);if(i=e.type,null!==t&&null!=e.stateNode)$o(t,e,i,r,s),t.ref!==e.ref&&(e.flags|=128);else{if(!r){if(null===e.stateNode)throw Error(o(166));return null}if(t=Rs(Ps.current),Ys(e)){r=e.stateNode,i=e.type;var a=e.memoizedProps;switch(r[qr]=e,r[Kr]=a,i){case"dialog":Pr("cancel",r),Pr("close",r);break;case"iframe":case"object":case"embed":Pr("load",r);break;case"video":case"audio":for(t=0;t<Er.length;t++)Pr(Er[t],r);break;case"source":Pr("error",r);break;case"img":case"image":case"link":Pr("error",r),Pr("load",r);break;case"details":Pr("toggle",r);break;case"input":tt(r,a),Pr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Pr("invalid",r);break;case"textarea":lt(r,a),Pr("invalid",r)}for(var c in Ct(i,a),t=null,a)a.hasOwnProperty(c)&&(s=a[c],"children"===c?"string"==typeof s?r.textContent!==s&&(t=["children",s]):"number"==typeof s&&r.textContent!==""+s&&(t=["children",""+s]):l.hasOwnProperty(c)&&null!=s&&"onScroll"===c&&Pr("scroll",r));switch(i){case"input":q(r),rt(r,a,!0);break;case"textarea":q(r),ht(r);break;case"select":case"option":break;default:"function"==typeof a.onClick&&(r.onclick=Ur)}r=t,e.updateQueue=r,null!==r&&(e.flags|=4)}else{switch(c=9===s.nodeType?s:s.ownerDocument,t===ut&&(t=dt(i)),t===ut?"script"===i?((t=c.createElement("div")).innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):"string"==typeof r.is?t=c.createElement(i,{is:r.is}):(t=c.createElement(i),"select"===i&&(c=t,r.multiple?c.multiple=!0:r.size&&(c.size=r.size))):t=c.createElementNS(t,i),t[qr]=e,t[Kr]=r,Wo(t,e,!1,!1),e.stateNode=t,c=Et(i,r),i){case"dialog":Pr("cancel",t),Pr("close",t),s=r;break;case"iframe":case"object":case"embed":Pr("load",t),s=r;break;case"video":case"audio":for(s=0;s<Er.length;s++)Pr(Er[s],t);s=r;break;case"source":Pr("error",t),s=r;break;case"img":case"image":case"link":Pr("error",t),Pr("load",t),s=r;break;case"details":Pr("toggle",t),s=r;break;case"input":tt(t,r),s=Q(t,r),Pr("invalid",t);break;case"option":s=st(t,r);break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=n({},r,{value:void 0}),Pr("invalid",t);break;case"textarea":lt(t,r),s=at(t,r),Pr("invalid",t);break;default:s=r}Ct(i,s);var h=s;for(a in h)if(h.hasOwnProperty(a)){var u=h[a];"style"===a?At(t,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&gt(t,u):"children"===a?"string"==typeof u?("textarea"!==i||""!==u)&&_t(t,u):"number"==typeof u&&_t(t,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(l.hasOwnProperty(a)?null!=u&&"onScroll"===a&&Pr("scroll",t):null!=u&&b(t,a,u,c))}switch(i){case"input":q(t),rt(t,r,!1);break;case"textarea":q(t),ht(t);break;case"option":null!=r.value&&t.setAttribute("value",""+J(r.value));break;case"select":t.multiple=!!r.multiple,null!=(a=r.value)?ot(t,!!r.multiple,a,!1):null!=r.defaultValue&&ot(t,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof s.onClick&&(t.onclick=Ur)}Vr(i,r)&&(e.flags|=4)}null!==e.ref&&(e.flags|=128)}return null;case 6:if(t&&null!=e.stateNode)qo(t,e,t.memoizedProps,r);else{if("string"!=typeof r&&null===e.stateNode)throw Error(o(166));i=Rs(Os.current),Rs(Ps.current),Ys(e)?(r=e.stateNode,i=e.memoizedProps,r[qr]=e,r.nodeValue!==i&&(e.flags|=4)):((r=(9===i.nodeType?i:i.ownerDocument).createTextNode(r))[qr]=e,e.stateNode=r)}return null;case 13:return cn(Is),r=e.memoizedState,64&e.flags?(e.lanes=i,e):(r=null!==r,i=!1,null===t?void 0!==e.memoizedProps.fallback&&Ys(e):i=null!==t.memoizedState,r&&!i&&2&e.mode&&(null===t&&!0!==e.memoizedProps.unstable_avoidThisFallback||1&Is.current?0===Ia&&(Ia=3):(0!==Ia&&3!==Ia||(Ia=4),null===Ra||!(134217727&Fa)&&!(134217727&ja)||gl(Ra,La))),(r||i)&&(e.flags|=4),null);case 4:return Ls(),Jo(e),null===t&&Or(e.stateNode.containerInfo),null;case 10:return is(e),null;case 19:if(cn(Is),null===(r=e.memoizedState))return null;if(a=!!(64&e.flags),null===(c=r.rendering))if(a)na(r,!1);else{if(0!==Ia||null!==t&&64&t.flags)for(t=e.child;null!==t;){if(null!==(c=Bs(t))){for(e.flags|=64,na(r,!1),null!==(a=c.updateQueue)&&(e.updateQueue=a,e.flags|=4),null===r.lastEffect&&(e.firstEffect=null),e.lastEffect=r.lastEffect,r=i,i=e.child;null!==i;)t=r,(a=i).flags&=2,a.nextEffect=null,a.firstEffect=null,a.lastEffect=null,null===(c=a.alternate)?(a.childLanes=0,a.lanes=t,a.child=null,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,t=c.dependencies,a.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),i=i.sibling;return hn(Is,1&Is.current|2),e.child}t=t.sibling}null!==r.tail&&zn()>Ha&&(e.flags|=64,a=!0,na(r,!1),e.lanes=33554432)}else{if(!a)if(null!==(t=Bs(c))){if(e.flags|=64,a=!0,null!==(i=t.updateQueue)&&(e.updateQueue=i,e.flags|=4),na(r,!0),null===r.tail&&"hidden"===r.tailMode&&!c.alternate&&!js)return null!==(e=e.lastEffect=r.lastEffect)&&(e.nextEffect=null),null}else 2*zn()-r.renderingStartTime>Ha&&1073741824!==i&&(e.flags|=64,a=!0,na(r,!1),e.lanes=33554432);r.isBackwards?(c.sibling=e.child,e.child=c):(null!==(i=r.last)?i.sibling=c:e.child=c,r.last=c)}return null!==r.tail?(i=r.tail,r.rendering=i,r.tail=i.sibling,r.lastEffect=e.lastEffect,r.renderingStartTime=zn(),i.sibling=null,e=Is.current,hn(Is,a?1&e|2:1&e),i):null;case 23:case 24:return Al(),null!==t&&null!==t.memoizedState!=(null!==e.memoizedState)&&"unstable-defer-without-hiding"!==r.mode&&(e.flags|=4),null}throw Error(o(156,e.tag))}function oa(t){switch(t.tag){case 1:gn(t.type)&&_n();var e=t.flags;return 4096&e?(t.flags=-4097&e|64,t):null;case 3:if(Ls(),cn(pn),cn(dn),Js(),64&(e=t.flags))throw Error(o(285));return t.flags=-4097&e|64,t;case 5:return ks(t),null;case 13:return cn(Is),4096&(e=t.flags)?(t.flags=-4097&e|64,t):null;case 19:return cn(Is),null;case 4:return Ls(),null;case 10:return is(t),null;case 23:case 24:return Al(),null;default:return null}}function aa(t,e){try{var i="",r=e;do{i+=X(r),r=r.return}while(r);var n=i}catch(t){n="\nError generating stack: "+t.message+"\n"+t.stack}return{value:t,source:e,stack:n}}function la(t,e){try{console.error(e.value)}catch(t){setTimeout((function(){throw t}))}}Wo=function(t,e){for(var i=e.child;null!==i;){if(5===i.tag||6===i.tag)t.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===e)break;for(;null===i.sibling;){if(null===i.return||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},Jo=function(){},$o=function(t,e,i,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Rs(Ps.current);var o,a=null;switch(i){case"input":s=Q(t,s),r=Q(t,r),a=[];break;case"option":s=st(t,s),r=st(t,r),a=[];break;case"select":s=n({},s,{value:void 0}),r=n({},r,{value:void 0}),a=[];break;case"textarea":s=at(t,s),r=at(t,r),a=[];break;default:"function"!=typeof s.onClick&&"function"==typeof r.onClick&&(t.onclick=Ur)}for(u in Ct(i,r),i=null,s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&null!=s[u])if("style"===u){var c=s[u];for(o in c)c.hasOwnProperty(o)&&(i||(i={}),i[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(l.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in r){var h=r[u];if(c=null!=s?s[u]:void 0,r.hasOwnProperty(u)&&h!==c&&(null!=h||null!=c))if("style"===u)if(c){for(o in c)!c.hasOwnProperty(o)||h&&h.hasOwnProperty(o)||(i||(i={}),i[o]="");for(o in h)h.hasOwnProperty(o)&&c[o]!==h[o]&&(i||(i={}),i[o]=h[o])}else i||(a||(a=[]),a.push(u,i)),i=h;else"dangerouslySetInnerHTML"===u?(h=h?h.__html:void 0,c=c?c.__html:void 0,null!=h&&c!==h&&(a=a||[]).push(u,h)):"children"===u?"string"!=typeof h&&"number"!=typeof h||(a=a||[]).push(u,""+h):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(l.hasOwnProperty(u)?(null!=h&&"onScroll"===u&&Pr("scroll",t),a||c===h||(a=[])):"object"==typeof h&&null!==h&&h.$$typeof===k?h.toString():(a=a||[]).push(u,h))}i&&(a=a||[]).push("style",i);var u=a;(e.updateQueue=u)&&(e.flags|=4)}},qo=function(t,e,i,r){i!==r&&(e.flags|=4)};var ca="function"==typeof WeakMap?WeakMap:Map;function ha(t,e,i){(i=cs(-1,i)).tag=3,i.payload={element:null};var r=e.value;return i.callback=function(){Ja||(Ja=!0,$a=r),la(0,e)},i}function ua(t,e,i){(i=cs(-1,i)).tag=3;var r=t.type.getDerivedStateFromError;if("function"==typeof r){var n=e.value;i.payload=function(){return la(0,e),r(n)}}var s=t.stateNode;return null!==s&&"function"==typeof s.componentDidCatch&&(i.callback=function(){"function"!=typeof r&&(null===qa?qa=new Set([this]):qa.add(this),la(0,e));var t=e.stack;this.componentDidCatch(e.value,{componentStack:null!==t?t:""})}),i}var da="function"==typeof WeakSet?WeakSet:Set;function pa(t){var e=t.ref;if(null!==e)if("function"==typeof e)try{e(null)}catch(e){Ul(t,e)}else e.current=null}function fa(t,e){switch(e.tag){case 0:case 11:case 15:case 22:case 5:case 6:case 4:case 17:return;case 1:if(256&e.flags&&null!==t){var i=t.memoizedProps,r=t.memoizedState;e=(t=e.stateNode).getSnapshotBeforeUpdate(e.elementType===e.type?i:qn(e.type,i),r),t.__reactInternalSnapshotBeforeUpdate=e}return;case 3:return void(256&e.flags&&Yr(e.stateNode.containerInfo))}throw Error(o(163))}function ma(t,e,i){switch(i.tag){case 0:case 11:case 15:case 22:if(null!==(e=null!==(e=i.updateQueue)?e.lastEffect:null)){t=e=e.next;do{if(!(3&~t.tag)){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}if(null!==(e=null!==(e=i.updateQueue)?e.lastEffect:null)){t=e=e.next;do{var n=t;r=n.next,4&(n=n.tag)&&1&n&&(kl(i,t),Dl(i,t)),t=r}while(t!==e)}return;case 1:return t=i.stateNode,4&i.flags&&(null===e?t.componentDidMount():(r=i.elementType===i.type?e.memoizedProps:qn(i.type,e.memoizedProps),t.componentDidUpdate(r,e.memoizedState,t.__reactInternalSnapshotBeforeUpdate))),void(null!==(e=i.updateQueue)&&ps(i,e,t));case 3:if(null!==(e=i.updateQueue)){if(t=null,null!==i.child)switch(i.child.tag){case 5:case 1:t=i.child.stateNode}ps(i,e,t)}return;case 5:return t=i.stateNode,void(null===e&&4&i.flags&&Vr(i.type,i.memoizedProps)&&t.focus());case 6:case 4:case 12:case 19:case 17:case 20:case 21:case 23:case 24:return;case 13:return void(null===i.memoizedState&&(i=i.alternate,null!==i&&(i=i.memoizedState,null!==i&&(i=i.dehydrated,null!==i&&Ae(i)))))}throw Error(o(163))}function ga(t,e){for(var i=t;;){if(5===i.tag){var r=i.stateNode;if(e)"function"==typeof(r=r.style).setProperty?r.setProperty("display","none","important"):r.display="none";else{r=i.stateNode;var n=i.memoizedProps.style;n=null!=n&&n.hasOwnProperty("display")?n.display:null,r.style.display=bt("display",n)}}else if(6===i.tag)i.stateNode.nodeValue=e?"":i.memoizedProps;else if((23!==i.tag&&24!==i.tag||null===i.memoizedState||i===t)&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}}function _a(t,e){if(Cn&&"function"==typeof Cn.onCommitFiberUnmount)try{Cn.onCommitFiberUnmount(xn,e)}catch(t){}switch(e.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(t=e.updateQueue)&&null!==(t=t.lastEffect)){var i=t=t.next;do{var r=i,n=r.destroy;if(r=r.tag,void 0!==n)if(4&r)kl(e,i);else{r=e;try{n()}catch(t){Ul(r,t)}}i=i.next}while(i!==t)}break;case 1:if(pa(e),"function"==typeof(t=e.stateNode).componentWillUnmount)try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(t){Ul(e,t)}break;case 5:pa(e);break;case 4:Ca(t,e)}}function va(t){t.alternate=null,t.child=null,t.dependencies=null,t.firstEffect=null,t.lastEffect=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.return=null,t.updateQueue=null}function ya(t){return 5===t.tag||3===t.tag||4===t.tag}function ba(t){t:{for(var e=t.return;null!==e;){if(ya(e))break t;e=e.return}throw Error(o(160))}var i=e;switch(e=i.stateNode,i.tag){case 5:var r=!1;break;case 3:case 4:e=e.containerInfo,r=!0;break;default:throw Error(o(161))}16&i.flags&&(_t(e,""),i.flags&=-17);t:e:for(i=t;;){for(;null===i.sibling;){if(null===i.return||ya(i.return)){i=null;break t}i=i.return}for(i.sibling.return=i.return,i=i.sibling;5!==i.tag&&6!==i.tag&&18!==i.tag;){if(2&i.flags)continue e;if(null===i.child||4===i.tag)continue e;i.child.return=i,i=i.child}if(!(2&i.flags)){i=i.stateNode;break t}}r?Aa(t,i,e):xa(t,i,e)}function Aa(t,e,i){var r=t.tag,n=5===r||6===r;if(n)t=n?t.stateNode:t.stateNode.instance,e?8===i.nodeType?i.parentNode.insertBefore(t,e):i.insertBefore(t,e):(8===i.nodeType?(e=i.parentNode).insertBefore(t,i):(e=i).appendChild(t),null!=(i=i._reactRootContainer)||null!==e.onclick||(e.onclick=Ur));else if(4!==r&&null!==(t=t.child))for(Aa(t,e,i),t=t.sibling;null!==t;)Aa(t,e,i),t=t.sibling}function xa(t,e,i){var r=t.tag,n=5===r||6===r;if(n)t=n?t.stateNode:t.stateNode.instance,e?i.insertBefore(t,e):i.appendChild(t);else if(4!==r&&null!==(t=t.child))for(xa(t,e,i),t=t.sibling;null!==t;)xa(t,e,i),t=t.sibling}function Ca(t,e){for(var i,r,n=e,s=!1;;){if(!s){s=n.return;t:for(;;){if(null===s)throw Error(o(160));switch(i=s.stateNode,s.tag){case 5:r=!1;break t;case 3:case 4:i=i.containerInfo,r=!0;break t}s=s.return}s=!0}if(5===n.tag||6===n.tag){t:for(var a=t,l=n,c=l;;)if(_a(a,c),null!==c.child&&4!==c.tag)c.child.return=c,c=c.child;else{if(c===l)break t;for(;null===c.sibling;){if(null===c.return||c.return===l)break t;c=c.return}c.sibling.return=c.return,c=c.sibling}r?(a=i,l=n.stateNode,8===a.nodeType?a.parentNode.removeChild(l):a.removeChild(l)):i.removeChild(n.stateNode)}else if(4===n.tag){if(null!==n.child){i=n.stateNode.containerInfo,r=!0,n.child.return=n,n=n.child;continue}}else if(_a(t,n),null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;4===(n=n.return).tag&&(s=!1)}n.sibling.return=n.return,n=n.sibling}}function Ea(t,e){switch(e.tag){case 0:case 11:case 14:case 15:case 22:var i=e.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{!(3&~r.tag)&&(t=r.destroy,r.destroy=void 0,void 0!==t&&t()),r=r.next}while(r!==i)}return;case 1:case 12:case 17:return;case 5:if(null!=(i=e.stateNode)){r=e.memoizedProps;var n=null!==t?t.memoizedProps:r;t=e.type;var s=e.updateQueue;if(e.updateQueue=null,null!==s){for(i[Kr]=r,"input"===t&&"radio"===r.type&&null!=r.name&&et(i,r),Et(t,n),e=Et(t,r),n=0;n<s.length;n+=2){var a=s[n],l=s[n+1];"style"===a?At(i,l):"dangerouslySetInnerHTML"===a?gt(i,l):"children"===a?_t(i,l):b(i,a,l,e)}switch(t){case"input":it(i,r);break;case"textarea":ct(i,r);break;case"select":t=i._wrapperState.wasMultiple,i._wrapperState.wasMultiple=!!r.multiple,null!=(s=r.value)?ot(i,!!r.multiple,s,!1):t!==!!r.multiple&&(null!=r.defaultValue?ot(i,!!r.multiple,r.defaultValue,!0):ot(i,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===e.stateNode)throw Error(o(162));return void(e.stateNode.nodeValue=e.memoizedProps);case 3:return void((i=e.stateNode).hydrate&&(i.hydrate=!1,Ae(i.containerInfo)));case 13:return null!==e.memoizedState&&(Ga=zn(),ga(e.child,!0)),void Ma(e);case 19:return void Ma(e);case 23:case 24:return void ga(e,null!==e.memoizedState)}throw Error(o(163))}function Ma(t){var e=t.updateQueue;if(null!==e){t.updateQueue=null;var i=t.stateNode;null===i&&(i=t.stateNode=new da),e.forEach((function(e){var r=jl.bind(null,t,e);i.has(e)||(i.add(e),e.then(r,r))}))}}function Sa(t,e){return null!==t&&(null===(t=t.memoizedState)||null!==t.dehydrated)&&null!==(e=e.memoizedState)&&null===e.dehydrated}var wa=Math.ceil,Pa=A.ReactCurrentDispatcher,Ta=A.ReactCurrentOwner,Oa=0,Ra=null,Na=null,La=0,Da=0,ka=ln(0),Ia=0,Ba=null,Ua=0,Fa=0,ja=0,Va=0,za=null,Ga=0,Ha=1/0;function Ya(){Ha=zn()+500}var Xa,Wa=null,Ja=!1,$a=null,qa=null,Ka=!1,Za=null,Qa=90,tl=[],el=[],il=null,rl=0,nl=null,sl=-1,ol=0,al=0,ll=null,cl=!1;function hl(){return 48&Oa?zn():-1!==sl?sl:sl=zn()}function ul(t){if(!(2&(t=t.mode)))return 1;if(!(4&t))return 99===Gn()?1:2;if(0===ol&&(ol=Ua),0!==$n.transition){0!==al&&(al=null!==za?za.pendingLanes:0),t=ol;var e=4186112&~al;return 0===(e&=-e)&&0==(e=(t=4186112&~t)&-t)&&(e=8192),e}return t=Gn(),t=Fe(4&Oa&&98===t?12:t=function(t){switch(t){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(t),ol)}function dl(t,e,i){if(50<rl)throw rl=0,nl=null,Error(o(185));if(null===(t=pl(t,e)))return null;ze(t,e,i),t===Ra&&(ja|=e,4===Ia&&gl(t,La));var r=Gn();1===e?8&Oa&&!(48&Oa)?_l(t):(fl(t,i),0===Oa&&(Ya(),Wn())):(!(4&Oa)||98!==r&&99!==r||(null===il?il=new Set([t]):il.add(t)),fl(t,i)),za=t}function pl(t,e){t.lanes|=e;var i=t.alternate;for(null!==i&&(i.lanes|=e),i=t,t=t.return;null!==t;)t.childLanes|=e,null!==(i=t.alternate)&&(i.childLanes|=e),i=t,t=t.return;return 3===i.tag?i.stateNode:null}function fl(t,e){for(var i=t.callbackNode,r=t.suspendedLanes,n=t.pingedLanes,s=t.expirationTimes,a=t.pendingLanes;0<a;){var l=31-Ge(a),c=1<<l,h=s[l];if(-1===h){if(0===(c&r)||0!==(c&n)){h=e,Ie(c);var u=ke;s[l]=10<=u?h+250:6<=u?h+5e3:-1}}else h<=e&&(t.expiredLanes|=c);a&=~c}if(r=Be(t,t===Ra?La:0),e=ke,0===r)null!==i&&(i!==In&&Sn(i),t.callbackNode=null,t.callbackPriority=0);else{if(null!==i){if(t.callbackPriority===e)return;i!==In&&Sn(i)}15===e?(i=_l.bind(null,t),null===Un?(Un=[i],Fn=Mn(Rn,Jn)):Un.push(i),i=In):14===e?i=Xn(99,_l.bind(null,t)):(i=function(t){switch(t){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(o(358,t))}}(e),i=Xn(i,ml.bind(null,t))),t.callbackPriority=e,t.callbackNode=i}}function ml(t){if(sl=-1,al=ol=0,48&Oa)throw Error(o(327));var e=t.callbackNode;if(Ll()&&t.callbackNode!==e)return null;var i=Be(t,t===Ra?La:0);if(0===i)return null;var r=i,n=Oa;Oa|=16;var s=El();for(Ra===t&&La===r||(Ya(),xl(t,r));;)try{wl();break}catch(e){Cl(t,e)}if(es(),Pa.current=s,Oa=n,null!==Na?r=0:(Ra=null,La=0,r=Ia),0!==(Ua&ja))xl(t,0);else if(0!==r){if(2===r&&(Oa|=64,t.hydrate&&(t.hydrate=!1,Yr(t.containerInfo)),0!==(i=Ue(t))&&(r=Ml(t,i))),1===r)throw e=Ba,xl(t,0),gl(t,i),fl(t,zn()),e;switch(t.finishedWork=t.current.alternate,t.finishedLanes=i,r){case 0:case 1:throw Error(o(345));case 2:case 5:Ol(t);break;case 3:if(gl(t,i),(62914560&i)===i&&10<(r=Ga+500-zn())){if(0!==Be(t,0))break;if(((n=t.suspendedLanes)&i)!==i){hl(),t.pingedLanes|=t.suspendedLanes&n;break}t.timeoutHandle=Gr(Ol.bind(null,t),r);break}Ol(t);break;case 4:if(gl(t,i),(4186112&i)===i)break;for(r=t.eventTimes,n=-1;0<i;){var a=31-Ge(i);s=1<<a,(a=r[a])>n&&(n=a),i&=~s}if(i=n,10<(i=(120>(i=zn()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*wa(i/1960))-i)){t.timeoutHandle=Gr(Ol.bind(null,t),i);break}Ol(t);break;default:throw Error(o(329))}}return fl(t,zn()),t.callbackNode===e?ml.bind(null,t):null}function gl(t,e){for(e&=~Va,e&=~ja,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var i=31-Ge(e),r=1<<i;t[i]=-1,e&=~r}}function _l(t){if(48&Oa)throw Error(o(327));if(Ll(),t===Ra&&0!==(t.expiredLanes&La)){var e=La,i=Ml(t,e);0!==(Ua&ja)&&(i=Ml(t,e=Be(t,e)))}else i=Ml(t,e=Be(t,0));if(0!==t.tag&&2===i&&(Oa|=64,t.hydrate&&(t.hydrate=!1,Yr(t.containerInfo)),0!==(e=Ue(t))&&(i=Ml(t,e))),1===i)throw i=Ba,xl(t,0),gl(t,e),fl(t,zn()),i;return t.finishedWork=t.current.alternate,t.finishedLanes=e,Ol(t),fl(t,zn()),null}function vl(t,e){var i=Oa;Oa|=1;try{return t(e)}finally{0===(Oa=i)&&(Ya(),Wn())}}function yl(t,e){var i=Oa;Oa&=-2,Oa|=8;try{return t(e)}finally{0===(Oa=i)&&(Ya(),Wn())}}function bl(t,e){hn(ka,Da),Da|=e,Ua|=e}function Al(){Da=ka.current,cn(ka)}function xl(t,e){t.finishedWork=null,t.finishedLanes=0;var i=t.timeoutHandle;if(-1!==i&&(t.timeoutHandle=-1,Hr(i)),null!==Na)for(i=Na.return;null!==i;){var r=i;switch(r.tag){case 1:null!=(r=r.type.childContextTypes)&&_n();break;case 3:Ls(),cn(pn),cn(dn),Js();break;case 5:ks(r);break;case 4:Ls();break;case 13:case 19:cn(Is);break;case 10:is(r);break;case 23:case 24:Al()}i=i.return}Ra=t,Na=Hl(t.current,null),La=Da=Ua=e,Ia=0,Ba=null,Va=ja=Fa=0}function Cl(t,e){for(;;){var i=Na;try{if(es(),$s.current=Ro,eo){for(var r=Zs.memoizedState;null!==r;){var n=r.queue;null!==n&&(n.pending=null),r=r.next}eo=!1}if(Ks=0,to=Qs=Zs=null,io=!1,Ta.current=null,null===i||null===i.return){Ia=1,Ba=e,Na=null;break}t:{var s=t,o=i.return,a=i,l=e;if(e=La,a.flags|=2048,a.firstEffect=a.lastEffect=null,null!==l&&"object"==typeof l&&"function"==typeof l.then){var c=l;if(!(2&a.mode)){var h=a.alternate;h?(a.updateQueue=h.updateQueue,a.memoizedState=h.memoizedState,a.lanes=h.lanes):(a.updateQueue=null,a.memoizedState=null)}var u=!!(1&Is.current),d=o;do{var p;if(p=13===d.tag){var f=d.memoizedState;if(null!==f)p=null!==f.dehydrated;else{var m=d.memoizedProps;p=void 0!==m.fallback&&(!0!==m.unstable_avoidThisFallback||!u)}}if(p){var g=d.updateQueue;if(null===g){var _=new Set;_.add(c),d.updateQueue=_}else g.add(c);if(!(2&d.mode)){if(d.flags|=64,a.flags|=16384,a.flags&=-2981,1===a.tag)if(null===a.alternate)a.tag=17;else{var v=cs(-1,1);v.tag=2,hs(a,v)}a.lanes|=1;break t}l=void 0,a=e;var y=s.pingCache;if(null===y?(y=s.pingCache=new ca,l=new Set,y.set(c,l)):void 0===(l=y.get(c))&&(l=new Set,y.set(c,l)),!l.has(a)){l.add(a);var b=Fl.bind(null,s,c,a);c.then(b,b)}d.flags|=4096,d.lanes=e;break t}d=d.return}while(null!==d);l=Error((W(a.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==Ia&&(Ia=2),l=aa(l,a),d=o;do{switch(d.tag){case 3:s=l,d.flags|=4096,e&=-e,d.lanes|=e,us(d,ha(0,s,e));break t;case 1:s=l;var A=d.type,x=d.stateNode;if(!(64&d.flags||"function"!=typeof A.getDerivedStateFromError&&(null===x||"function"!=typeof x.componentDidCatch||null!==qa&&qa.has(x)))){d.flags|=4096,e&=-e,d.lanes|=e,us(d,ua(d,s,e));break t}}d=d.return}while(null!==d)}Tl(i)}catch(t){e=t,Na===i&&null!==i&&(Na=i=i.return);continue}break}}function El(){var t=Pa.current;return Pa.current=Ro,null===t?Ro:t}function Ml(t,e){var i=Oa;Oa|=16;var r=El();for(Ra===t&&La===e||xl(t,e);;)try{Sl();break}catch(e){Cl(t,e)}if(es(),Oa=i,Pa.current=r,null!==Na)throw Error(o(261));return Ra=null,La=0,Ia}function Sl(){for(;null!==Na;)Pl(Na)}function wl(){for(;null!==Na&&!wn();)Pl(Na)}function Pl(t){var e=Xa(t.alternate,t,Da);t.memoizedProps=t.pendingProps,null===e?Tl(t):Na=e,Ta.current=null}function Tl(t){var e=t;do{var i=e.alternate;if(t=e.return,2048&e.flags){if(null!==(i=oa(e)))return i.flags&=2047,void(Na=i);null!==t&&(t.firstEffect=t.lastEffect=null,t.flags|=2048)}else{if(null!==(i=sa(i,e,Da)))return void(Na=i);if(24!==(i=e).tag&&23!==i.tag||null===i.memoizedState||1073741824&Da||!(4&i.mode)){for(var r=0,n=i.child;null!==n;)r|=n.lanes|n.childLanes,n=n.sibling;i.childLanes=r}null!==t&&!(2048&t.flags)&&(null===t.firstEffect&&(t.firstEffect=e.firstEffect),null!==e.lastEffect&&(null!==t.lastEffect&&(t.lastEffect.nextEffect=e.firstEffect),t.lastEffect=e.lastEffect),1<e.flags&&(null!==t.lastEffect?t.lastEffect.nextEffect=e:t.firstEffect=e,t.lastEffect=e))}if(null!==(e=e.sibling))return void(Na=e);Na=e=t}while(null!==e);0===Ia&&(Ia=5)}function Ol(t){var e=Gn();return Yn(99,Rl.bind(null,t,e)),null}function Rl(t,e){do{Ll()}while(null!==Za);if(48&Oa)throw Error(o(327));var i=t.finishedWork;if(null===i)return null;if(t.finishedWork=null,t.finishedLanes=0,i===t.current)throw Error(o(177));t.callbackNode=null;var r=i.lanes|i.childLanes,n=r,s=t.pendingLanes&~n;t.pendingLanes=n,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=n,t.mutableReadLanes&=n,t.entangledLanes&=n,n=t.entanglements;for(var a=t.eventTimes,l=t.expirationTimes;0<s;){var c=31-Ge(s),h=1<<c;n[c]=0,a[c]=-1,l[c]=-1,s&=~h}if(null!==il&&!(24&r)&&il.has(t)&&il.delete(t),t===Ra&&(Na=Ra=null,La=0),1<i.flags?null!==i.lastEffect?(i.lastEffect.nextEffect=i,r=i.firstEffect):r=i:r=i.firstEffect,null!==r){if(n=Oa,Oa|=32,Ta.current=null,Fr=Je,mr(a=fr())){if("selectionStart"in a)l={start:a.selectionStart,end:a.selectionEnd};else t:if(l=(l=a.ownerDocument)&&l.defaultView||window,(h=l.getSelection&&l.getSelection())&&0!==h.rangeCount){l=h.anchorNode,s=h.anchorOffset,c=h.focusNode,h=h.focusOffset;try{l.nodeType,c.nodeType}catch(t){l=null;break t}var u=0,d=-1,p=-1,f=0,m=0,g=a,_=null;e:for(;;){for(var v;g!==l||0!==s&&3!==g.nodeType||(d=u+s),g!==c||0!==h&&3!==g.nodeType||(p=u+h),3===g.nodeType&&(u+=g.nodeValue.length),null!==(v=g.firstChild);)_=g,g=v;for(;;){if(g===a)break e;if(_===l&&++f===s&&(d=u),_===c&&++m===h&&(p=u),null!==(v=g.nextSibling))break;_=(g=_).parentNode}g=v}l=-1===d||-1===p?null:{start:d,end:p}}else l=null;l=l||{start:0,end:0}}else l=null;jr={focusedElem:a,selectionRange:l},Je=!1,ll=null,cl=!1,Wa=r;do{try{Nl()}catch(t){if(null===Wa)throw Error(o(330));Ul(Wa,t),Wa=Wa.nextEffect}}while(null!==Wa);ll=null,Wa=r;do{try{for(a=t;null!==Wa;){var y=Wa.flags;if(16&y&&_t(Wa.stateNode,""),128&y){var b=Wa.alternate;if(null!==b){var A=b.ref;null!==A&&("function"==typeof A?A(null):A.current=null)}}switch(1038&y){case 2:ba(Wa),Wa.flags&=-3;break;case 6:ba(Wa),Wa.flags&=-3,Ea(Wa.alternate,Wa);break;case 1024:Wa.flags&=-1025;break;case 1028:Wa.flags&=-1025,Ea(Wa.alternate,Wa);break;case 4:Ea(Wa.alternate,Wa);break;case 8:Ca(a,l=Wa);var x=l.alternate;va(l),null!==x&&va(x)}Wa=Wa.nextEffect}}catch(t){if(null===Wa)throw Error(o(330));Ul(Wa,t),Wa=Wa.nextEffect}}while(null!==Wa);if(A=jr,b=fr(),y=A.focusedElem,a=A.selectionRange,b!==y&&y&&y.ownerDocument&&pr(y.ownerDocument.documentElement,y)){null!==a&&mr(y)&&(b=a.start,void 0===(A=a.end)&&(A=b),"selectionStart"in y?(y.selectionStart=b,y.selectionEnd=Math.min(A,y.value.length)):(A=(b=y.ownerDocument||document)&&b.defaultView||window).getSelection&&(A=A.getSelection(),l=y.textContent.length,x=Math.min(a.start,l),a=void 0===a.end?x:Math.min(a.end,l),!A.extend&&x>a&&(l=a,a=x,x=l),l=dr(y,x),s=dr(y,a),l&&s&&(1!==A.rangeCount||A.anchorNode!==l.node||A.anchorOffset!==l.offset||A.focusNode!==s.node||A.focusOffset!==s.offset)&&((b=b.createRange()).setStart(l.node,l.offset),A.removeAllRanges(),x>a?(A.addRange(b),A.extend(s.node,s.offset)):(b.setEnd(s.node,s.offset),A.addRange(b))))),b=[];for(A=y;A=A.parentNode;)1===A.nodeType&&b.push({element:A,left:A.scrollLeft,top:A.scrollTop});for("function"==typeof y.focus&&y.focus(),y=0;y<b.length;y++)(A=b[y]).element.scrollLeft=A.left,A.element.scrollTop=A.top}Je=!!Fr,jr=Fr=null,t.current=i,Wa=r;do{try{for(y=t;null!==Wa;){var C=Wa.flags;if(36&C&&ma(y,Wa.alternate,Wa),128&C){b=void 0;var E=Wa.ref;if(null!==E){var M=Wa.stateNode;Wa.tag,b=M,"function"==typeof E?E(b):E.current=b}}Wa=Wa.nextEffect}}catch(t){if(null===Wa)throw Error(o(330));Ul(Wa,t),Wa=Wa.nextEffect}}while(null!==Wa);Wa=null,Bn(),Oa=n}else t.current=i;if(Ka)Ka=!1,Za=t,Qa=e;else for(Wa=r;null!==Wa;)e=Wa.nextEffect,Wa.nextEffect=null,8&Wa.flags&&((C=Wa).sibling=null,C.stateNode=null),Wa=e;if(0===(r=t.pendingLanes)&&(qa=null),1===r?t===nl?rl++:(rl=0,nl=t):rl=0,i=i.stateNode,Cn&&"function"==typeof Cn.onCommitFiberRoot)try{Cn.onCommitFiberRoot(xn,i,void 0,!(64&~i.current.flags))}catch(t){}if(fl(t,zn()),Ja)throw Ja=!1,t=$a,$a=null,t;return 8&Oa||Wn(),null}function Nl(){for(;null!==Wa;){var t=Wa.alternate;cl||null===ll||(8&Wa.flags?Qt(Wa,ll)&&(cl=!0):13===Wa.tag&&Sa(t,Wa)&&Qt(Wa,ll)&&(cl=!0));var e=Wa.flags;256&e&&fa(t,Wa),!(512&e)||Ka||(Ka=!0,Xn(97,(function(){return Ll(),null}))),Wa=Wa.nextEffect}}function Ll(){if(90!==Qa){var t=97<Qa?97:Qa;return Qa=90,Yn(t,Il)}return!1}function Dl(t,e){tl.push(e,t),Ka||(Ka=!0,Xn(97,(function(){return Ll(),null})))}function kl(t,e){el.push(e,t),Ka||(Ka=!0,Xn(97,(function(){return Ll(),null})))}function Il(){if(null===Za)return!1;var t=Za;if(Za=null,48&Oa)throw Error(o(331));var e=Oa;Oa|=32;var i=el;el=[];for(var r=0;r<i.length;r+=2){var n=i[r],s=i[r+1],a=n.destroy;if(n.destroy=void 0,"function"==typeof a)try{a()}catch(t){if(null===s)throw Error(o(330));Ul(s,t)}}for(i=tl,tl=[],r=0;r<i.length;r+=2){n=i[r],s=i[r+1];try{var l=n.create;n.destroy=l()}catch(t){if(null===s)throw Error(o(330));Ul(s,t)}}for(l=t.current.firstEffect;null!==l;)t=l.nextEffect,l.nextEffect=null,8&l.flags&&(l.sibling=null,l.stateNode=null),l=t;return Oa=e,Wn(),!0}function Bl(t,e,i){hs(t,e=ha(0,e=aa(i,e),1)),e=hl(),null!==(t=pl(t,1))&&(ze(t,1,e),fl(t,e))}function Ul(t,e){if(3===t.tag)Bl(t,t,e);else for(var i=t.return;null!==i;){if(3===i.tag){Bl(i,t,e);break}if(1===i.tag){var r=i.stateNode;if("function"==typeof i.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===qa||!qa.has(r))){var n=ua(i,t=aa(e,t),1);if(hs(i,n),n=hl(),null!==(i=pl(i,1)))ze(i,1,n),fl(i,n);else if("function"==typeof r.componentDidCatch&&(null===qa||!qa.has(r)))try{r.componentDidCatch(e,t)}catch(t){}break}}i=i.return}}function Fl(t,e,i){var r=t.pingCache;null!==r&&r.delete(e),e=hl(),t.pingedLanes|=t.suspendedLanes&i,Ra===t&&(La&i)===i&&(4===Ia||3===Ia&&(62914560&La)===La&&500>zn()-Ga?xl(t,0):Va|=i),fl(t,e)}function jl(t,e){var i=t.stateNode;null!==i&&i.delete(e),0==(e=0)&&(2&(e=t.mode)?4&e?(0===ol&&(ol=Ua),0===(e=je(62914560&~ol))&&(e=4194304)):e=99===Gn()?1:2:e=1),i=hl(),null!==(t=pl(t,e))&&(ze(t,e,i),fl(t,i))}function Vl(t,e,i,r){this.tag=t,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function zl(t,e,i,r){return new Vl(t,e,i,r)}function Gl(t){return!(!(t=t.prototype)||!t.isReactComponent)}function Hl(t,e){var i=t.alternate;return null===i?((i=zl(t.tag,e,t.key,t.mode)).elementType=t.elementType,i.type=t.type,i.stateNode=t.stateNode,i.alternate=t,t.alternate=i):(i.pendingProps=e,i.type=t.type,i.flags=0,i.nextEffect=null,i.firstEffect=null,i.lastEffect=null),i.childLanes=t.childLanes,i.lanes=t.lanes,i.child=t.child,i.memoizedProps=t.memoizedProps,i.memoizedState=t.memoizedState,i.updateQueue=t.updateQueue,e=t.dependencies,i.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext},i.sibling=t.sibling,i.index=t.index,i.ref=t.ref,i}function Yl(t,e,i,r,n,s){var a=2;if(r=t,"function"==typeof t)Gl(t)&&(a=1);else if("string"==typeof t)a=5;else t:switch(t){case E:return Xl(i.children,n,s,e);case I:a=8,n|=16;break;case M:a=8,n|=1;break;case S:return(t=zl(12,i,e,8|n)).elementType=S,t.type=S,t.lanes=s,t;case O:return(t=zl(13,i,e,n)).type=O,t.elementType=O,t.lanes=s,t;case R:return(t=zl(19,i,e,n)).elementType=R,t.lanes=s,t;case B:return Wl(i,n,s,e);case U:return(t=zl(24,i,e,n)).elementType=U,t.lanes=s,t;default:if("object"==typeof t&&null!==t)switch(t.$$typeof){case w:a=10;break t;case P:a=9;break t;case T:a=11;break t;case N:a=14;break t;case L:a=16,r=null;break t;case D:a=22;break t}throw Error(o(130,null==t?t:typeof t,""))}return(e=zl(a,i,e,n)).elementType=t,e.type=r,e.lanes=s,e}function Xl(t,e,i,r){return(t=zl(7,t,r,e)).lanes=i,t}function Wl(t,e,i,r){return(t=zl(23,t,r,e)).elementType=B,t.lanes=i,t}function Jl(t,e,i){return(t=zl(6,t,null,e)).lanes=i,t}function $l(t,e,i){return(e=zl(4,null!==t.children?t.children:[],t.key,e)).lanes=i,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function ql(t,e,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=i,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Ve(0),this.expirationTimes=Ve(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ve(0),this.mutableSourceEagerHydrationData=null}function Kl(t,e,i,r){var n=e.current,s=hl(),a=ul(n);t:if(i){e:{if($t(i=i._reactInternals)!==i||1!==i.tag)throw Error(o(170));var l=i;do{switch(l.tag){case 3:l=l.stateNode.context;break e;case 1:if(gn(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break e}}l=l.return}while(null!==l);throw Error(o(171))}if(1===i.tag){var c=i.type;if(gn(c)){i=yn(i,c,l);break t}}i=l}else i=un;return null===e.context?e.context=i:e.pendingContext=i,(e=cs(s,a)).payload={element:t},null!==(r=void 0===r?null:r)&&(e.callback=r),hs(n,e),dl(n,a,s),a}function Zl(t){return(t=t.current).child?(t.child.tag,t.child.stateNode):null}function Ql(t,e){if(null!==(t=t.memoizedState)&&null!==t.dehydrated){var i=t.retryLane;t.retryLane=0!==i&&i<e?i:e}}function tc(t,e){Ql(t,e),(t=t.alternate)&&Ql(t,e)}function ec(t,e,i){var r=null!=i&&null!=i.hydrationOptions&&i.hydrationOptions.mutableSources||null;if(i=new ql(t,e,null!=i&&!0===i.hydrate),e=zl(3,null,null,2===e?7:1===e?3:0),i.current=e,e.stateNode=i,as(e),t[Zr]=i.current,Or(8===t.nodeType?t.parentNode:t),r)for(t=0;t<r.length;t++){var n=(e=r[t])._getVersion;n=n(e._source),null==i.mutableSourceEagerHydrationData?i.mutableSourceEagerHydrationData=[e,n]:i.mutableSourceEagerHydrationData.push(e,n)}this._internalRoot=i}function ic(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType&&(8!==t.nodeType||" react-mount-point-unstable "!==t.nodeValue))}function rc(t,e,i,r,n){var s=i._reactRootContainer;if(s){var o=s._internalRoot;if("function"==typeof n){var a=n;n=function(){var t=Zl(o);a.call(t)}}Kl(e,o,t,n)}else{if(s=i._reactRootContainer=function(t,e){if(e||(e=!(!(e=t?9===t.nodeType?t.documentElement:t.firstChild:null)||1!==e.nodeType||!e.hasAttribute("data-reactroot"))),!e)for(var i;i=t.lastChild;)t.removeChild(i);return new ec(t,0,e?{hydrate:!0}:void 0)}(i,r),o=s._internalRoot,"function"==typeof n){var l=n;n=function(){var t=Zl(o);l.call(t)}}yl((function(){Kl(e,o,t,n)}))}return Zl(o)}function nc(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!ic(e))throw Error(o(200));return function(t,e,i){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:C,key:null==r?null:""+r,children:t,containerInfo:e,implementation:i}}(t,e,null,i)}Xa=function(t,e,i){var r=e.lanes;if(null!==t)if(t.memoizedProps!==e.pendingProps||pn.current)Io=!0;else{if(0===(i&r)){switch(Io=!1,e.tag){case 3:Xo(e),Xs();break;case 5:Ds(e);break;case 1:gn(e.type)&&bn(e);break;case 4:Ns(e,e.stateNode.containerInfo);break;case 10:r=e.memoizedProps.value;var n=e.type._context;hn(Kn,n._currentValue),n._currentValue=r;break;case 13:if(null!==e.memoizedState)return 0!==(i&e.child.childLanes)?Zo(t,e,i):(hn(Is,1&Is.current),null!==(e=ra(t,e,i))?e.sibling:null);hn(Is,1&Is.current);break;case 19:if(r=0!==(i&e.childLanes),64&t.flags){if(r)return ia(t,e,i);e.flags|=64}if(null!==(n=e.memoizedState)&&(n.rendering=null,n.tail=null,n.lastEffect=null),hn(Is,Is.current),r)break;return null;case 23:case 24:return e.lanes=0,Vo(t,e,i)}return ra(t,e,i)}Io=!!(16384&t.flags)}else Io=!1;switch(e.lanes=0,e.tag){case 2:if(r=e.type,null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,n=mn(e,dn.current),ns(e,i),n=so(null,e,r,t,n,i),e.flags|=1,"object"==typeof n&&null!==n&&"function"==typeof n.render&&void 0===n.$$typeof){if(e.tag=1,e.memoizedState=null,e.updateQueue=null,gn(r)){var s=!0;bn(e)}else s=!1;e.memoizedState=null!==n.state&&void 0!==n.state?n.state:null,as(e);var a=r.getDerivedStateFromProps;"function"==typeof a&&ms(e,r,a,t),n.updater=gs,e.stateNode=n,n._reactInternals=e,bs(e,r,t,i),e=Yo(null,e,r,!0,s,i)}else e.tag=0,Bo(null,e,n,i),e=e.child;return e;case 16:n=e.elementType;t:{switch(null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,n=(s=n._init)(n._payload),e.type=n,s=e.tag=function(t){if("function"==typeof t)return Gl(t)?1:0;if(null!=t){if((t=t.$$typeof)===T)return 11;if(t===N)return 14}return 2}(n),t=qn(n,t),s){case 0:e=Go(null,e,n,t,i);break t;case 1:e=Ho(null,e,n,t,i);break t;case 11:e=Uo(null,e,n,t,i);break t;case 14:e=Fo(null,e,n,qn(n.type,t),r,i);break t}throw Error(o(306,n,""))}return e;case 0:return r=e.type,n=e.pendingProps,Go(t,e,r,n=e.elementType===r?n:qn(r,n),i);case 1:return r=e.type,n=e.pendingProps,Ho(t,e,r,n=e.elementType===r?n:qn(r,n),i);case 3:if(Xo(e),r=e.updateQueue,null===t||null===r)throw Error(o(282));if(r=e.pendingProps,n=null!==(n=e.memoizedState)?n.element:null,ls(t,e),ds(e,r,null,i),(r=e.memoizedState.element)===n)Xs(),e=ra(t,e,i);else{if((s=(n=e.stateNode).hydrate)&&(Fs=Xr(e.stateNode.containerInfo.firstChild),Us=e,s=js=!0),s){if(null!=(t=n.mutableSourceEagerHydrationData))for(n=0;n<t.length;n+=2)(s=t[n])._workInProgressVersionPrimary=t[n+1],Ws.push(s);for(i=Ss(e,null,r,i),e.child=i;i;)i.flags=-3&i.flags|1024,i=i.sibling}else Bo(t,e,r,i),Xs();e=e.child}return e;case 5:return Ds(e),null===t&&Gs(e),r=e.type,n=e.pendingProps,s=null!==t?t.memoizedProps:null,a=n.children,zr(r,n)?a=null:null!==s&&zr(r,s)&&(e.flags|=16),zo(t,e),Bo(t,e,a,i),e.child;case 6:return null===t&&Gs(e),null;case 13:return Zo(t,e,i);case 4:return Ns(e,e.stateNode.containerInfo),r=e.pendingProps,null===t?e.child=Ms(e,null,r,i):Bo(t,e,r,i),e.child;case 11:return r=e.type,n=e.pendingProps,Uo(t,e,r,n=e.elementType===r?n:qn(r,n),i);case 7:return Bo(t,e,e.pendingProps,i),e.child;case 8:case 12:return Bo(t,e,e.pendingProps.children,i),e.child;case 10:t:{r=e.type._context,n=e.pendingProps,a=e.memoizedProps,s=n.value;var l=e.type._context;if(hn(Kn,l._currentValue),l._currentValue=s,null!==a)if(l=a.value,0==(s=lr(l,s)?0:0|("function"==typeof r._calculateChangedBits?r._calculateChangedBits(l,s):1073741823))){if(a.children===n.children&&!pn.current){e=ra(t,e,i);break t}}else for(null!==(l=e.child)&&(l.return=e);null!==l;){var c=l.dependencies;if(null!==c){a=l.child;for(var h=c.firstContext;null!==h;){if(h.context===r&&0!==(h.observedBits&s)){1===l.tag&&((h=cs(-1,i&-i)).tag=2,hs(l,h)),l.lanes|=i,null!==(h=l.alternate)&&(h.lanes|=i),rs(l.return,i),c.lanes|=i;break}h=h.next}}else a=10===l.tag&&l.type===e.type?null:l.child;if(null!==a)a.return=l;else for(a=l;null!==a;){if(a===e){a=null;break}if(null!==(l=a.sibling)){l.return=a.return,a=l;break}a=a.return}l=a}Bo(t,e,n.children,i),e=e.child}return e;case 9:return n=e.type,r=(s=e.pendingProps).children,ns(e,i),r=r(n=ss(n,s.unstable_observedBits)),e.flags|=1,Bo(t,e,r,i),e.child;case 14:return s=qn(n=e.type,e.pendingProps),Fo(t,e,n,s=qn(n.type,s),r,i);case 15:return jo(t,e,e.type,e.pendingProps,r,i);case 17:return r=e.type,n=e.pendingProps,n=e.elementType===r?n:qn(r,n),null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),e.tag=1,gn(r)?(t=!0,bn(e)):t=!1,ns(e,i),vs(e,r,n),bs(e,r,n,i),Yo(null,e,r,!0,t,i);case 19:return ia(t,e,i);case 23:case 24:return Vo(t,e,i)}throw Error(o(156,e.tag))},ec.prototype.render=function(t){Kl(t,this._internalRoot,null,null)},ec.prototype.unmount=function(){var t=this._internalRoot,e=t.containerInfo;Kl(null,t,null,(function(){e[Zr]=null}))},te=function(t){13===t.tag&&(dl(t,4,hl()),tc(t,4))},ee=function(t){13===t.tag&&(dl(t,67108864,hl()),tc(t,67108864))},ie=function(t){if(13===t.tag){var e=hl(),i=ul(t);dl(t,i,e),tc(t,i)}},re=function(t,e){return e()},St=function(t,e,i){switch(e){case"input":if(it(t,i),e=i.name,"radio"===i.type&&null!=e){for(i=t;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<i.length;e++){var r=i[e];if(r!==t&&r.form===t.form){var n=nn(r);if(!n)throw Error(o(90));K(r),it(r,n)}}}break;case"textarea":ct(t,i);break;case"select":null!=(e=i.value)&&ot(t,!!i.multiple,e,!1)}},Nt=vl,Lt=function(t,e,i,r,n){var s=Oa;Oa|=4;try{return Yn(98,t.bind(null,e,i,r,n))}finally{0===(Oa=s)&&(Ya(),Wn())}},Dt=function(){!(49&Oa)&&(function(){if(null!==il){var t=il;il=null,t.forEach((function(t){t.expiredLanes|=24&t.pendingLanes,fl(t,zn())}))}Wn()}(),Ll())},kt=function(t,e){var i=Oa;Oa|=2;try{return t(e)}finally{0===(Oa=i)&&(Ya(),Wn())}};var sc={Events:[en,rn,nn,Ot,Rt,Ll,{current:!1}]},oc={findFiberByHostInstance:tn,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},ac={bundleType:oc.bundleType,version:oc.version,rendererPackageName:oc.rendererPackageName,rendererConfig:oc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:A.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return null===(t=Zt(t))?null:t.stateNode},findFiberByHostInstance:oc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var lc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lc.isDisabled&&lc.supportsFiber)try{xn=lc.inject(ac),Cn=lc}catch(mt){}}e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sc,e.createPortal=nc,e.findDOMNode=function(t){if(null==t)return null;if(1===t.nodeType)return t;var e=t._reactInternals;if(void 0===e){if("function"==typeof t.render)throw Error(o(188));throw Error(o(268,Object.keys(t)))}return null===(t=Zt(e))?null:t.stateNode},e.flushSync=function(t,e){var i=Oa;if(48&i)return t(e);Oa|=1;try{if(t)return Yn(99,t.bind(null,e))}finally{Oa=i,Wn()}},e.hydrate=function(t,e,i){if(!ic(e))throw Error(o(200));return rc(null,t,e,!0,i)},e.render=function(t,e,i){if(!ic(e))throw Error(o(200));return rc(null,t,e,!1,i)},e.unmountComponentAtNode=function(t){if(!ic(t))throw Error(o(40));return!!t._reactRootContainer&&(yl((function(){rc(null,null,t,!1,(function(){t._reactRootContainer=null,t[Zr]=null}))})),!0)},e.unstable_batchedUpdates=vl,e.unstable_createPortal=function(t,e){return nc(t,e,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},e.unstable_renderSubtreeIntoContainer=function(t,e,i,r){if(!ic(i))throw Error(o(200));if(null==t||void 0===t._reactInternals)throw Error(o(38));return rc(t,e,i,!1,r)},e.version="17.0.2"},601:t=>{t.exports=function(t){return t[1]}},659:t=>{var e={};t.exports=function(t,i){var r=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(i)}},703:(t,e,i)=>{i.d(e,{A:()=>o});var r=i(84),n=i(156),s=i(9);r.A.GeonextParser={replacePow:function(t){var e,i,r,n,s,o,a,l,c,h,u,d;for(h=(t=t.replace(/(\s*)\^(\s*)/g,"^")).indexOf("^"),n=-1;h>=0&&h<t.length-1;){if(n===h)throw new Error("JSXGraph: Error while parsing expression '"+t+"'");if(n=h,c=t.slice(0,h),u=t.slice(h+1),")"===c.charAt(c.length-1)){for(e=1,i=c.length-2;i>=0&&e>0;)")"===(r=c.charAt(i))?e++:"("===r&&(e-=1),i-=1;if(0!==e)throw new Error("JSXGraph: Missing '(' in expression");for(s="",a=c.substring(0,i+1),l=i;l>=0&&a.slice(l,l+1).match(/([\w.]+)/);)s=RegExp.$1+s,l-=1;s=(s+=c.substring(i+1,c.length)).replace(/([()+*%^\-/\][])/g,"\\$1")}else s="[\\w\\.]+";if(u.match(/^([\w.]*\()/)){for(e=1,i=RegExp.$1.length;i<u.length&&e>0;)")"===(r=u.charAt(i))?e-=1:"("===r&&(e+=1),i+=1;if(0!==e)throw new Error("JSXGraph: Missing ')' in expression");o=(o=u.substring(0,i)).replace(/([()+*%^\-/[\]])/g,"\\$1")}else o="[\\w\\.]+";d=new RegExp("("+s+")\\^("+o+")"),h=(t=t.replace(d,"pow($1,$2)")).indexOf("^")}return t},replaceIf:function(t){var e,i,r,n,s,o,a,l,c,h="",u=null,d=null,p=null;if((r=t.indexOf("If("))<0)return t;for(t=t.replace(/""/g,"0");r>=0;){for(e=t.slice(0,r),i=t.slice(r+3),s=1,n=0,o=-1,a=-1;n<i.length&&s>0;)")"===(l=i.charAt(n))?s-=1:"("===l?s+=1:","===l&&1===s&&(o<0?o=n:a=n),n+=1;if(c=i.slice(0,n-1),i=i.slice(n),o<0)return"";if(a<0)return"";u=c.slice(0,o),d=c.slice(o+1,a),p=c.slice(a+1),h+=e+"(("+(u=this.replaceIf(u))+")?("+(d=this.replaceIf(d))+"):("+(p=this.replaceIf(p))+"))",u=null,d=null,r=(t=i).indexOf("If(")}return h+i},replaceNameById:function(t,e,i){var r,n,s,o,a=0,l=["X","Y","L","V"],c=function(t){return i?"$('"+t+"')":t};for(o=0;o<l.length;o++)for(a=t.indexOf(l[o]+"(");a>=0;)a>=0&&(r=t.indexOf(")",a+2))>=0&&(n=(n=t.slice(a+2,r)).replace(/\\(['"])?/g,"$1"),(s=e.elementsByName[n])&&(t=t.slice(0,a+2)+(i?"$('":"")+c(s.id)+t.slice(r))),r=t.indexOf(")",a+2),a=t.indexOf(l[o]+"(",r);for(a=t.indexOf("Dist(");a>=0;)a>=0&&(r=t.indexOf(",",a+5))>=0&&(n=(n=t.slice(a+5,r)).replace(/\\(['"])?/g,"$1"),(s=e.elementsByName[n])&&(t=t.slice(0,a+5)+c(s.id)+t.slice(r))),r=t.indexOf(",",a+5),a=t.indexOf(",",r),(r=t.indexOf(")",a+1))>=0&&(n=(n=t.slice(a+1,r)).replace(/\\(['"])?/g,"$1"),(s=e.elementsByName[n])&&(t=t.slice(0,a+1)+c(s.id)+t.slice(r))),r=t.indexOf(")",a+1),a=t.indexOf("Dist(",r);for(l=["Deg","Rad"],o=0;o<l.length;o++)for(a=t.indexOf(l[o]+"(");a>=0;)a>=0&&(r=t.indexOf(",",a+4))>=0&&(n=(n=t.slice(a+4,r)).replace(/\\(['"])?/g,"$1"),(s=e.elementsByName[n])&&(t=t.slice(0,a+4)+c(s.id)+t.slice(r))),r=t.indexOf(",",a+4),a=t.indexOf(",",r),(r=t.indexOf(",",a+1))>=0&&(n=(n=t.slice(a+1,r)).replace(/\\(['"])?/g,"$1"),(s=e.elementsByName[n])&&(t=t.slice(0,a+1)+c(s.id)+t.slice(r))),r=t.indexOf(",",a+1),a=t.indexOf(",",r),(r=t.indexOf(")",a+1))>=0&&(n=(n=t.slice(a+1,r)).replace(/\\(['"])?/g,"$1"),(s=e.elementsByName[n])&&(t=t.slice(0,a+1)+c(s.id)+t.slice(r))),r=t.indexOf(")",a+1),a=t.indexOf(l[o]+"(",r);return t},replaceIdByObj:function(t){var e=/(X|Y|L)\(([\w_]+)\)/g;return t=t.replace(e,"$('$2').$1()"),e=/(V)\(([\w_]+)\)/g,t=t.replace(e,"$('$2').Value()"),e=/(Dist)\(([\w_]+),([\w_]+)\)/g,t=t.replace(e,"dist($('$2'), $('$3'))"),e=/(Deg)\(([\w_]+),([ \w[\w_]+),([\w_]+)\)/g,t=t.replace(e,"deg($('$2'),$('$3'),$('$4'))"),e=/Rad\(([\w_]+),([\w_]+),([\w_]+)\)/g,t=t.replace(e,"rad($('$1'),$('$2'),$('$3'))"),e=/N\((.+)\)/g,t.replace(e,"($1)")},geonext2JS:function(t,e){var i,r,n,s=["Abs","ACos","ASin","ATan","Ceil","Cos","Exp","Factorial","Floor","Log","Max","Min","Random","Round","Sin","Sqrt","Tan","Trunc"],o=["abs","acos","asin","atan","ceil","cos","exp","factorial","floor","log","max","min","random","round","sin","sqrt","tan","ceil"];for(r=t=(t=(t=t.replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&amp;/g,"&"),r=this.replaceNameById(r,e),r=this.replaceIf(r),r=this.replacePow(r),r=this.replaceIdByObj(r),n=0;n<s.length;n++)i=new RegExp(["(\\W|^)(",s[n],")"].join(""),"ig"),r=r.replace(i,["$1",o[n]].join(""));return(r=(r=(r=(r=r.replace(/True/g,"true")).replace(/False/g,"false")).replace(/fasle/g,"false")).replace(/Pi/g,"PI")).replace(/"/g,"'")},findDependencies:function(t,e,i){var r,o,a,l;for(o in s.A.exists(i)||(i=t.board),r=i.elementsByName)r.hasOwnProperty(o)&&o!==t.name&&(r[o].elementClass===n.A.OBJECT_CLASS_TEXT&&r[o].evalVisProp("islabel")||(l=(l=o.replace(/\[/g,"\\[")).replace(/\]/g,"\\]"),a=new RegExp("\\(([\\w\\[\\]'_ ]+,)*("+l+")(,[\\w\\[\\]'_ ]+)*\\)","g"),e.search(a)>=0&&r[o].addChild(t)))},gxt2jc:function(t,e){var i;return i=t=(t=(t=t.replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&amp;/g,"&"),(i=(i=(i=this.replaceNameById(i,e,!0)).replace(/True/g,"true")).replace(/False/g,"false")).replace(/fasle/g,"false")}};const o=r.A.GeonextParser},718:(t,e,i)=>{i.d(e,{A:()=>l});var r=i(84),n=i(174),s=i(9);r.A.Math.DoubleBits=function(){var t,e,i,r,n,s,o,a,l=new Float64Array(1),c=new Uint32Array(l.buffer);void 0!==Float64Array&&(l[0]=1,1072693248===c[1]?(t=function(t){return l[0]=t,[c[0],c[1]]},e=function(t,e){return c[0]=t,c[1]=e,l[0]},i=function(t){return l[0]=t,c[0]},r=function(t){return l[0]=t,c[1]},this.doubleBits=t,this.pack=e,this.lo=i,this.hi=r):1072693248===c[0]&&(n=function(t){return l[0]=t,[c[1],c[0]]},s=function(t,e){return c[1]=t,c[0]=e,l[0]},o=function(t){return l[0]=t,c[1]},a=function(t){return l[0]=t,c[0]},this.doubleBits=n,this.pack=s,this.lo=o,this.hi=a))},r.A.extend(r.A.Math.DoubleBits.prototype,{sign:function(t){return this.hi(t)>>>31},exponent:function(t){return(this.hi(t)<<1>>>21)-1023},fraction:function(t){var e=this.lo(t),i=this.hi(t),r=1048575&i;return 2146435072&i&&(r+=1<<20),[e,r]},denormalized:function(t){return!(2146435072&this.hi(t))}});var o=new r.A.Math.DoubleBits,a=function(t,e){if(void 0!==t&&void 0!==e){if(n.A.IntervalArithmetic.isInterval(t)){if(!n.A.IntervalArithmetic.isSingleton(t))throw new TypeError("JXG.Math.IntervalArithmetic: interval `lo` must be a singleton");this.lo=t.lo}else this.lo=t;if(n.A.IntervalArithmetic.isInterval(e)){if(!n.A.IntervalArithmetic.isSingleton(e))throw new TypeError("JXG.Math.IntervalArithmetic: interval `hi` must be a singleton");this.hi=e.hi}else this.hi=e}else{if(void 0!==t)return Array.isArray(t)?new a(t[0],t[1]):new a(t,t);this.lo=this.hi=0}};r.A.extend(a.prototype,{print:function(){console.log("[",this.lo,this.hi,"]")},set:function(t,e){return this.lo=t,this.hi=e,this},bounded:function(t,e){return this.set(n.A.IntervalArithmetic.prev(t),n.A.IntervalArithmetic.next(e))},boundedSingleton:function(t){return this.bounded(t,t)},assign:function(t,e){if("number"!=typeof t||"number"!=typeof e)throw new TypeError("JXG.Math.Interval#assign: arguments must be numbers");return isNaN(t)||isNaN(e)||t>e?this.setEmpty():this.set(t,e)},setEmpty:function(){return this.set(Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY)},setWhole:function(){return this.set(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY)},open:function(t,e){return this.assign(n.A.IntervalArithmetic.next(t),n.A.IntervalArithmetic.prev(e))},halfOpenLeft:function(t,e){return this.assign(n.A.IntervalArithmetic.next(t),e)},halfOpenRight:function(t,e){return this.assign(t,n.A.IntervalArithmetic.prev(e))},toArray:function(){return[this.lo,this.hi]},clone:function(){return(new a).set(this.lo,this.hi)}}),r.A.Math.IntervalArithmetic={Interval:function(t,e){return new a(t,e)},isInterval:function(t){return null!==t&&"object"==typeof t&&"number"==typeof t.lo&&"number"==typeof t.hi},isSingleton:function(t){return t.lo===t.hi},add:function(t,e){return s.A.isNumber(t)&&(t=this.Interval(t)),s.A.isNumber(e)&&(e=this.Interval(e)),new a(this.addLo(t.lo,e.lo),this.addHi(t.hi,e.hi))},sub:function(t,e){return s.A.isNumber(t)&&(t=this.Interval(t)),s.A.isNumber(e)&&(e=this.Interval(e)),new a(this.subLo(t.lo,e.hi),this.subHi(t.hi,e.lo))},mul:function(t,e){var i,r,n,o,l;return s.A.isNumber(t)&&(t=this.Interval(t)),s.A.isNumber(e)&&(e=this.Interval(e)),this.isEmpty(t)||this.isEmpty(e)?this.EMPTY.clone():(i=t.lo,r=t.hi,n=e.lo,o=e.hi,l=new a,i<0?r>0?n<0?o>0?(l.lo=Math.min(this.mulLo(i,o),this.mulLo(r,n)),l.hi=Math.max(this.mulHi(i,n),this.mulHi(r,o))):(l.lo=this.mulLo(r,n),l.hi=this.mulHi(i,n)):o>0?(l.lo=this.mulLo(i,o),l.hi=this.mulHi(r,o)):(l.lo=0,l.hi=0):n<0?o>0?(l.lo=this.mulLo(i,o),l.hi=this.mulHi(i,n)):(l.lo=this.mulLo(r,o),l.hi=this.mulHi(i,n)):o>0?(l.lo=this.mulLo(i,o),l.hi=this.mulHi(r,n)):(l.lo=0,l.hi=0):r>0?n<0?o>0?(l.lo=this.mulLo(r,n),l.hi=this.mulHi(r,o)):(l.lo=this.mulLo(r,n),l.hi=this.mulHi(i,o)):o>0?(l.lo=this.mulLo(i,n),l.hi=this.mulHi(r,o)):(l.lo=0,l.hi=0):(l.lo=0,l.hi=0),l)},div:function(t,e){return s.A.isNumber(t)&&(t=this.Interval(t)),s.A.isNumber(e)&&(e=this.Interval(e)),this.isEmpty(t)||this.isEmpty(e)?this.EMPTY.clone():this.zeroIn(e)?0!==e.lo?0!==e.hi?this.divZero(t):this.divNegative(t,e.lo):0!==e.hi?this.divPositive(t,e.hi):this.EMPTY.clone():this.divNonZero(t,e)},positive:function(t){return new a(t.lo,t.hi)},negative:function(t){return s.A.isNumber(t)?new a(-t):new a(-t.hi,-t.lo)},isEmpty:function(t){return t.lo>t.hi},isWhole:function(t){return t.lo===-1/0&&t.hi===1/0},zeroIn:function(t){return this.hasValue(t,0)},hasValue:function(t,e){return!this.isEmpty(t)&&t.lo<=e&&e<=t.hi},hasInterval:function(t,e){return!!this.isEmpty(t)||!this.isEmpty(e)&&e.lo<=t.lo&&t.hi<=e.hi},intervalsOverlap:function(t,e){return!this.isEmpty(t)&&!this.isEmpty(e)&&(t.lo<=e.lo&&e.lo<=t.hi||e.lo<=t.lo&&t.lo<=e.hi)},divNonZero:function(t,e){var i=t.lo,r=t.hi,n=e.lo,s=e.hi,o=new a;return r<0?s<0?(o.lo=this.divLo(r,n),o.hi=this.divHi(i,s)):(o.lo=this.divLo(i,n),o.hi=this.divHi(r,s)):i<0?s<0?(o.lo=this.divLo(r,s),o.hi=this.divHi(i,s)):(o.lo=this.divLo(i,n),o.hi=this.divHi(r,n)):s<0?(o.lo=this.divLo(r,s),o.hi=this.divHi(i,n)):(o.lo=this.divLo(i,s),o.hi=this.divHi(r,n)),o},divPositive:function(t,e){return 0===t.lo&&0===t.hi?t:this.zeroIn(t)?this.WHOLE:t.hi<0?new a(Number.NEGATIVE_INFINITY,this.divHi(t.hi,e)):new a(this.divLo(t.lo,e),Number.POSITIVE_INFINITY)},divNegative:function(t,e){return 0===t.lo&&0===t.hi?t:this.zeroIn(t)?this.WHOLE:t.hi<0?new a(this.divLo(t.hi,e),Number.POSITIVE_INFINITY):new a(Number.NEGATIVE_INFINITY,this.divHi(t.lo,e))},divZero:function(t){return 0===t.lo&&0===t.hi?t:this.WHOLE},fmod:function(t,e){var i,r;return s.A.isNumber(t)&&(t=this.Interval(t)),s.A.isNumber(e)&&(e=this.Interval(e)),this.isEmpty(t)||this.isEmpty(e)?this.EMPTY.clone():(i=t.lo<0?e.lo:e.hi,r=(r=t.lo/i)<0?Math.ceil(r):Math.floor(r),this.sub(t,this.mul(e,new a(r))))},multiplicativeInverse:function(t){return s.A.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(t)?this.EMPTY.clone():this.zeroIn(t)?0!==t.lo?0!==t.hi?this.WHOLE:new a(Number.NEGATIVE_INFINITY,this.divHi(1,t.lo)):0!==t.hi?new a(this.divLo(1,t.hi),Number.POSITIVE_INFINITY):this.EMPTY.clone():new a(this.divLo(1,t.hi),this.divHi(1,t.lo))},pow:function(t,e){var i,r;if(s.A.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(t))return this.EMPTY.clone();if(this.isInterval(e)){if(!this.isSingleton(e))return this.EMPTY.clone();e=e.lo}return 0===e?0===t.lo&&0===t.hi?this.EMPTY.clone():this.ONE.clone():e<0?this.pow(this.multiplicativeInverse(t),-e):e%1==0?t.hi<0?(i=this.powLo(-t.hi,e),r=this.powHi(-t.lo,e),1&~e?new a(i,r):new a(-r,-i)):t.lo<0?1&~e?new a(0,this.powHi(Math.max(-t.lo,t.hi),e)):new a(-this.powLo(-t.lo,e),this.powHi(t.hi,e)):new a(this.powLo(t.lo,e),this.powHi(t.hi,e)):(console.warn("power is not an integer, you should use nth-root instead, returning an empty interval"),this.EMPTY.clone())},sqrt:function(t){return s.A.isNumber(t)&&(t=this.Interval(t)),this.nthRoot(t,2)},nthRoot:function(t,e){var i,r,n,o,l;if(s.A.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(t)||e<0)return this.EMPTY.clone();if(this.isInterval(e)){if(!this.isSingleton(e))return this.EMPTY.clone();e=e.lo}return i=1/e,t.hi<0?e%1!=0||1&~e?this.EMPTY.clone():(r=this.powHi(-t.lo,i),n=this.powLo(-t.hi,i),new a(-r,-n)):t.lo<0?(o=this.powHi(t.hi,i),e%1!=0||1&~e?new a(0,o):(l=-this.powHi(-t.lo,i),new a(l,o))):new a(this.powLo(t.lo,i),this.powHi(t.hi,i))},exp:function(t){return s.A.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(t)?this.EMPTY.clone():new a(this.expLo(t.lo),this.expHi(t.hi))},log:function(t){var e;return s.A.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(t)?this.EMPTY.clone():(e=t.lo<=0?Number.NEGATIVE_INFINITY:this.logLo(t.lo),new a(e,this.logHi(t.hi)))},ln:function(t){return this.log(t)},log10:function(t){return this.isEmpty(t)?this.EMPTY.clone():this.div(this.log(t),this.log(new a(10,10)))},log2:function(t){return this.isEmpty(t)?this.EMPTY.clone():this.div(this.log(t),this.log(new a(2,2)))},hull:function(t,e){var i=this.isEmpty(t),r=this.isEmpty(e);return i&&r?this.EMPTY.clone():i?e.clone():r?t.clone():new a(Math.min(t.lo,e.lo),Math.max(t.hi,e.hi))},intersection:function(t,e){var i,r;return this.isEmpty(t)||this.isEmpty(e)?this.EMPTY.clone():(i=Math.max(t.lo,e.lo))<=(r=Math.min(t.hi,e.hi))?new a(i,r):this.EMPTY.clone()},union:function(t,e){if(!this.intervalsOverlap(t,e))throw new Error("Interval#unions do not overlap");return new a(Math.min(t.lo,e.lo),Math.max(t.hi,e.hi))},difference:function(t,e){if(this.isEmpty(t)||this.isWhole(e))return this.EMPTY.clone();if(this.intervalsOverlap(t,e)){if(t.lo<e.lo&&e.hi<t.hi)throw new Error("Interval.difference: difference creates multiple intervals");return e.lo<=t.lo&&e.hi===1/0||e.hi>=t.hi&&e.lo===-1/0?this.EMPTY.clone():e.lo<=t.lo?(new a).halfOpenLeft(e.hi,t.hi):(new a).halfOpenRight(t.lo,e.lo)}return t.clone()},width:function(t){return this.isEmpty(t)?0:this.subHi(t.hi,t.lo)},abs:function(t){return s.A.isNumber(t)&&(t=this.Interval(t)),this.isEmpty(t)?this.EMPTY.clone():t.lo>=0?t.clone():t.hi<=0?this.negative(t):new a(0,Math.max(-t.lo,t.hi))},max:function(t,e){var i=this.isEmpty(t),r=this.isEmpty(e);return i&&r?this.EMPTY.clone():i?e.clone():r?t.clone():new a(Math.max(t.lo,e.lo),Math.max(t.hi,e.hi))},min:function(t,e){var i=this.isEmpty(t),r=this.isEmpty(e);return i&&r?this.EMPTY.clone():i?e.clone():r?t.clone():new a(Math.min(t.lo,e.lo),Math.min(t.hi,e.hi))},onlyInfinity:function(t){return!isFinite(t.lo)&&t.lo===t.hi},_handleNegative:function(t){var e;return t.lo<0&&(t.lo===-1/0?(t.lo=0,t.hi=1/0):(e=Math.ceil(-t.lo/this.piTwiceLow),t.lo+=this.piTwiceLow*e,t.hi+=this.piTwiceLow*e)),t},cos:function(t){var e,i,r,n,s,o,l,c;return this.isEmpty(t)||this.onlyInfinity(t)?this.EMPTY.clone():(e=(new a).set(t.lo,t.hi),this._handleNegative(e),i=this.PI_TWICE,r=this.fmod(e,i),this.width(r)>=i.lo?new a(-1,1):r.lo>=this.piHigh?(n=this.cos(this.sub(r,this.PI)),this.negative(n)):(s=r.lo,o=r.hi,l=this.cosLo(o),c=this.cosHi(s),o<=this.piLow?new a(l,c):o<=i.lo?new a(-1,Math.max(l,c)):new a(-1,1)))},sin:function(t){return this.isEmpty(t)||this.onlyInfinity(t)?this.EMPTY.clone():this.cos(this.sub(t,this.PI_HALF))},tan:function(t){var e,i,r;return this.isEmpty(t)||this.onlyInfinity(t)?this.EMPTY.clone():(e=(new a).set(t.lo,t.hi),this._handleNegative(e),r=this.PI,(i=this.fmod(e,r)).lo>=this.piHalfLow&&(i=this.sub(i,r)),i.lo<=-this.piHalfLow||i.hi>=this.piHalfLow?this.WHOLE.clone():new a(this.tanLo(i.lo),this.tanHi(i.hi)))},asin:function(t){var e,i;return this.isEmpty(t)||t.hi<-1||t.lo>1?this.EMPTY.clone():(e=t.lo<=-1?-this.piHalfHigh:this.asinLo(t.lo),i=t.hi>=1?this.piHalfHigh:this.asinHi(t.hi),new a(e,i))},acos:function(t){var e,i;return this.isEmpty(t)||t.hi<-1||t.lo>1?this.EMPTY.clone():(e=t.hi>=1?0:this.acosLo(t.hi),i=t.lo<=-1?this.piHigh:this.acosHi(t.lo),new a(e,i))},acot:function(t){return this.isEmpty(t)?this.EMPTY.clone():new a(this.acotLo(t.lo),this.acotHi(t.hi))},atan:function(t){return this.isEmpty(t)?this.EMPTY.clone():new a(this.atanLo(t.lo),this.atanHi(t.hi))},sinh:function(t){return this.isEmpty(t)?this.EMPTY.clone():new a(this.sinhLo(t.lo),this.sinhHi(t.hi))},cosh:function(t){return this.isEmpty(t)?this.EMPTY.clone():t.hi<0?new a(this.coshLo(t.hi),this.coshHi(t.lo)):t.lo>=0?new a(this.coshLo(t.lo),this.coshHi(t.hi)):new a(1,this.coshHi(-t.lo>t.hi?t.lo:t.hi))},tanh:function(t){return this.isEmpty(t)?this.EMPTY.clone():new a(this.tanhLo(t.lo),this.tanhHi(t.hi))},equal:function(t,e){return this.isEmpty(t)?this.isEmpty(e):!this.isEmpty(e)&&t.lo===e.lo&&t.hi===e.hi},notEqual:function(t,e){return this.isEmpty(t)?!this.isEmpty(e):this.isEmpty(e)||t.hi<e.lo||t.lo>e.hi},lt:function(t,e){return s.A.isNumber(t)&&(t=this.Interval(t)),s.A.isNumber(e)&&(e=this.Interval(e)),!this.isEmpty(t)&&!this.isEmpty(e)&&t.hi<e.lo},gt:function(t,e){return s.A.isNumber(t)&&(t=this.Interval(t)),s.A.isNumber(e)&&(e=this.Interval(e)),!this.isEmpty(t)&&!this.isEmpty(e)&&t.lo>e.hi},leq:function(t,e){return s.A.isNumber(t)&&(t=this.Interval(t)),s.A.isNumber(e)&&(e=this.Interval(e)),!this.isEmpty(t)&&!this.isEmpty(e)&&t.hi<=e.lo},geq:function(t,e){return s.A.isNumber(t)&&(t=this.Interval(t)),s.A.isNumber(e)&&(e=this.Interval(e)),!this.isEmpty(t)&&!this.isEmpty(e)&&t.lo>=e.hi},piLow:3.141592653589793,piHigh:3.1415926535897936,piHalfLow:1.5707963267948966,piHalfHigh:1.5707963267948968,piTwiceLow:6.283185307179586,piTwiceHigh:6.283185307179587,identity:function(t){return t},_prev:function(t){return t===1/0?t:this.nextafter(t,-1/0)},_next:function(t){return t===-1/0?t:this.nextafter(t,1/0)},prev:function(t){return this._prev(t)},next:function(t){return this._next(t)},toInteger:function(t){return t<0?Math.ceil(t):Math.floor(t)},addLo:function(t,e){return this.prev(t+e)},addHi:function(t,e){return this.next(t+e)},subLo:function(t,e){return this.prev(t-e)},subHi:function(t,e){return this.next(t-e)},mulLo:function(t,e){return this.prev(t*e)},mulHi:function(t,e){return this.next(t*e)},divLo:function(t,e){return this.prev(t/e)},divHi:function(t,e){return this.next(t/e)},intLo:function(t){return this.toInteger(this.prev(t))},intHi:function(t){return this.toInteger(this.next(t))},logLo:function(t){return this.prev(Math.log(t))},logHi:function(t){return this.next(Math.log(t))},expLo:function(t){return this.prev(Math.exp(t))},expHi:function(t){return this.next(Math.exp(t))},sinLo:function(t){return this.prev(Math.sin(t))},sinHi:function(t){return this.next(Math.sin(t))},cosLo:function(t){return this.prev(Math.cos(t))},cosHi:function(t){return this.next(Math.cos(t))},tanLo:function(t){return this.prev(Math.tan(t))},tanHi:function(t){return this.next(Math.tan(t))},asinLo:function(t){return this.prev(Math.asin(t))},asinHi:function(t){return this.next(Math.asin(t))},acosLo:function(t){return this.prev(Math.acos(t))},acosHi:function(t){return this.next(Math.acos(t))},acotLo:function(t){return this.prev(n.A.acot(t))},acotHi:function(t){return this.next(n.A.acot(t))},atanLo:function(t){return this.prev(Math.atan(t))},atanHi:function(t){return this.next(Math.atan(t))},sinhLo:function(t){return this.prev(n.A.sinh(t))},sinhHi:function(t){return this.next(n.A.sinh(t))},coshLo:function(t){return this.prev(n.A.cosh(t))},coshHi:function(t){return this.next(n.A.cosh(t))},tanhLo:function(t){return this.prev(n.A.tanh(t))},tanhHi:function(t){return this.next(n.A.tanh(t))},sqrtLo:function(t){return this.prev(Math.sqrt(t))},sqrtHi:function(t){return this.next(Math.sqrt(t))},powLo:function(t,e){var i;if(e%1!=0)return this.prev(Math.pow(t,e));for(i=1&~e?1:t,e>>=1;e>0;)t=this.mulLo(t,t),1&~e||(i=this.mulLo(t,i)),e>>=1;return i},powHi:function(t,e){var i;if(e%1!=0)return this.next(Math.pow(t,e));for(i=1&~e?1:t,e>>=1;e>0;)t=this.mulHi(t,t),1&~e||(i=this.mulHi(t,i)),e>>=1;return i},disable:function(){this.next=this.prev=this.identity},enable:function(){this.prev=function(t){return this._prev(t)},this.next=function(t){return this._next(t)}},SMALLEST_DENORM:Math.pow(2,-1074),UINT_MAX:-1>>>0,nextafter:function(t,e){var i,r;return isNaN(t)||isNaN(e)?NaN:t===e?t:0===t?e<0?-this.SMALLEST_DENORM:this.SMALLEST_DENORM:(r=o.hi(t),i=o.lo(t),e>t==t>0?i===this.UINT_MAX?(r+=1,i=0):i+=1:0===i?(i=this.UINT_MAX,r-=1):i-=1,o.pack(i,r))}},r.A.Math.IntervalArithmetic.PI=new a(n.A.IntervalArithmetic.piLow,n.A.IntervalArithmetic.piHigh),r.A.Math.IntervalArithmetic.PI_HALF=new a(n.A.IntervalArithmetic.piHalfLow,n.A.IntervalArithmetic.piHalfHigh),r.A.Math.IntervalArithmetic.PI_TWICE=new a(n.A.IntervalArithmetic.piTwiceLow,n.A.IntervalArithmetic.piTwiceHigh),r.A.Math.IntervalArithmetic.ZERO=new a(0),r.A.Math.IntervalArithmetic.ONE=new a(1),r.A.Math.IntervalArithmetic.WHOLE=(new a).setWhole(),r.A.Math.IntervalArithmetic.EMPTY=(new a).setEmpty();const l=r.A.Math.IntervalArithmetic},761:(t,e,i)=>{i.d(e,{A:()=>l});var r=i(84),n=i(156),s=i(174),o=i(194),a=i(9);r.A.Options={jc:{enabled:!0,compile:!0},board:{animationDelay:35,axis:!1,boundingBox:[-5,5,5,-5],browserPan:!1,clickDelay:600,dblClickSuppressClick:!1,defaultAxes:{x:{name:"x",fixed:!0,needsRegularUpdate:!1,ticks:{label:{visible:"inherit",anchorX:"middle",anchorY:"top",fontSize:12,offset:[0,-3]},tickEndings:[0,1],majorTickEndings:[1,1],drawZero:!1,visible:"inherit"}},y:{name:"y",fixed:!0,needsRegularUpdate:!1,ticks:{label:{visible:"inherit",anchorX:"right",anchorY:"middle",fontSize:12,offset:[-6,0]},tickEndings:[1,0],majorTickEndings:[1,1],drawZero:!1,visible:"inherit"}}},document:!1,drag:{enabled:!0},fullscreen:{symbol:'<svg height="1em" width="1em" version="1.1" viewBox="10 10 18 18"><path fill="#666" d="m 10,16 2,0 0,-4 4,0 0,-2 L 10,10 l 0,6 0,0 z"></path><path fill="#666" d="m 20,10 0,2 4,0 0,4 2,0 L 26,10 l -6,0 0,0 z"></path><path fill="#666" d="m 24,24 -4,0 0,2 L 26,26 l 0,-6 -2,0 0,4 0,0 z"></path><path fill="#666" d="M 12,20 10,20 10,26 l 6,0 0,-2 -4,0 0,-4 0,0 z"></path></svg>',scale:.85,id:null},ignoreLabels:!0,intl:{enabled:!1},keepAspectRatio:!1,keyboard:{enabled:!0,dx:10,dy:10,panShift:!0,panCtrl:!1},logging:{enabled:!1},minimizeReflow:"none",maxBoundingBox:[-1/0,1/0,1/0,-1/0],maxFrameRate:40,maxNameLength:1,moveTarget:null,offsetX:0,offsetY:0,pan:{enabled:!0,needShift:!0,needTwoFingers:!1},registerEvents:!0,renderer:"auto",resize:{enabled:!0,throttle:10},screenshot:{scale:1,type:"png",symbol:"",css:"background-color:#eeeeee; opacity:1.0; border:2px solid black; border-radius:10px; text-align:center",cssButton:"padding: 4px 10px; border: solid #356AA0 1px; border-radius: 5px; position: absolute; right: 2ex; top: 2ex; background-color: rgba(255, 255, 255, 0.3);"},selection:{enabled:!1,name:"selectionPolygon",needShift:!1,needCtrl:!0,fillColor:"#ffff00",visible:!1,withLines:!1,vertices:{visible:!1}},showClearTraces:!1,showCopyright:!0,showFullscreen:!1,showInfobox:!0,showNavigation:!0,showReload:!1,showScreenshot:!1,showZoom:!0,takeFirst:!1,takeSizeFromFile:!1,theme:"default",title:"",zoom:{enabled:!0,factorX:1.25,factorY:1.25,wheel:!0,needShift:!0,center:"auto",min:1e-4,max:1e4,pinch:!0,pinchHorizontal:!0,pinchVertical:!0,pinchSensitivity:7},zoomX:1,zoomY:1},navbar:{strokeColor:"#333333",fillColor:"transparent",highlightFillColor:"#aaaaaa",padding:"2px",position:"absolute",fontSize:"14px",cursor:"pointer",zIndex:"100",right:"5px",bottom:"5px"},elements:{aria:{enabled:!1,label:"",live:"assertive"},cssClass:"",highlightCssClass:"",dash:0,dashScale:!1,draft:{draft:!1,strokeColor:"#565656",fillColor:"#565656",strokeOpacity:.8,fillOpacity:.8,strokeWidth:1},dragToTopOfLayer:!1,element3D:null,fillColor:o.A.palette.red,fillOpacity:1,fixed:!1,frozen:!1,gradient:null,gradientAngle:0,gradientCX:.5,gradientCY:.5,gradientEndOffset:1,gradientFX:.5,gradientFY:.5,gradientFR:0,gradientR:.5,gradientSecondColor:"#ffffff",gradientSecondOpacity:1,gradientStartOffset:0,highlight:!0,highlightFillColor:"none",highlightFillOpacity:1,highlightStrokeColor:"#c3d9ff",highlightStrokeOpacity:1,highlightStrokeWidth:2,isLabel:!1,layer:0,lineCap:"butt",needsRegularUpdate:!0,nonnegativeOnly:!1,precision:"inherit",priv:!1,rotatable:!0,scalable:!0,shadow:{enabled:!1,color:[0,0,0],opacity:1,blur:3,blend:.1,offset:[5,5]},snapToGrid:!1,strokeColor:o.A.palette.blue,strokeOpacity:1,strokeWidth:2,tabindex:-1,trace:!1,traceAttributes:{},transitionDuration:100,transitionProperties:["fill","fill-opacity","stroke","stroke-opacity","stroke-width"],visible:!0,withLabel:!1},ticks:{generateLabelText:null,generateLabelValue:null,drawLabels:!1,label:{tabindex:null,layer:7,highlight:!1},beautifulScientificTickLabels:!1,useUnicodeMinus:!0,anchor:"left",drawZero:!1,insertTicks:!1,minTicksDistance:10,minorHeight:4,majorHeight:10,tickEndings:[1,1],majorTickEndings:[1,1],ignoreInfiniteTickEndings:!0,minorTicks:4,ticksPerLabel:!1,scale:1,scaleSymbol:"",labels:[],maxLabelLength:5,precision:3,digits:3,ticksDistance:1,face:"|",strokeOpacity:1,strokeWidth:1,strokeColor:"#000000",highlightStrokeColor:"#888888",fillColor:"none",highlightFillColor:"none",visible:"inherit",includeBoundaries:!1,type:"linear",intl:{enabled:"inherit",options:{}},minorTicksInArrow:!1,majorTicksInArrow:!0,labelInArrow:!0,minorTicksInMargin:!1,majorTicksInMargin:!0,labelInMargin:!0},hatch:{drawLabels:!1,drawZero:!0,majorHeight:20,anchor:"middle",face:"|",strokeWidth:2,strokeColor:o.A.palette.blue,ticksDistance:.2},precision:{touch:30,touchMax:100,mouse:4,pen:4,epsilon:1e-4,hasPoint:4},layer:{numlayers:20,unused9:19,unused8:18,unused7:17,unused6:16,unused5:15,unused4:14,unused3:13,unused2:12,unused1:11,unused0:10,text:9,point:9,glider:9,arc:8,line:7,circle:6,curve:5,turtle:5,polygon:3,sector:3,angle:3,integral:3,axis:2,ticks:2,grid:1,image:0,trace:0},angle:{withLabel:!0,radius:"auto",type:"sector",orthoType:"square",orthoSensitivity:1,fillColor:o.A.palette.orange,highlightFillColor:o.A.palette.orange,strokeColor:o.A.palette.orange,fillOpacity:.3,highlightFillOpacity:.3,radiuspoint:{withLabel:!1,visible:!1,name:""},pointsquare:{withLabel:!1,visible:!1,name:""},dot:{visible:!1,strokeColor:"none",fillColor:"#000000",size:2,face:"o",withLabel:!1,name:""},label:{position:"top",offset:[0,0],strokeColor:o.A.palette.blue},arc:{visible:!1,fillColor:"none"}},arc:{selection:"auto",hasInnerPoints:!1,label:{anchorX:"auto",anchorY:"auto"},firstArrow:!1,lastArrow:!1,fillColor:"none",highlightFillColor:"none",strokeColor:o.A.palette.blue,highlightStrokeColor:"#c3d9ff",useDirection:!1,center:{},radiusPoint:{},anglePoint:{}},arrow:{firstArrow:!1,lastArrow:{type:1,highlightSize:6,size:6}},arrowparallel:{firstArrow:!1,lastArrow:{type:1,highlightSize:6,size:6}},axis:{name:"",needsRegularUpdate:!1,strokeWidth:1,lastArrow:{type:1,highlightSize:8,size:8},strokeColor:"#666666",highlightStrokeWidth:1,highlightStrokeColor:"#888888",position:"static",anchor:"",anchorDist:"10%",ticksAutoPos:!1,ticksAutoPosThreshold:"5%",withTicks:!0,straightFirst:!0,straightLast:!0,margin:-4,withLabel:!1,scalable:!1,ticks:{label:{offset:[4,-9],parse:!1,needsRegularUpdate:!1,display:"internal",visible:"inherit",layer:9},visible:"inherit",needsRegularUpdate:!1,strokeWidth:1,strokeColor:"#666666",highlightStrokeColor:"#888888",drawLabels:!0,drawZero:!1,insertTicks:!0,minTicksDistance:5,minorHeight:10,majorHeight:-1,tickEndings:[0,1],majorTickEndings:[1,1],minorTicks:4,ticksDistance:1,strokeOpacity:.25},point1:{needsRegularUpdate:!1,visible:!1},point2:{needsRegularUpdate:!1,visible:!1},tabindex:-1,label:{position:"lft",offset:[10,10]}},bisector:{strokeColor:"#000000",point:{visible:!1,fixed:!1,withLabel:!1,name:""}},bisectorlines:{line1:{strokeColor:"#000000"},line2:{strokeColor:"#000000"}},boxplot:{dir:"vertical",smallWidth:.5,strokeWidth:2,strokeColor:o.A.palette.blue,fillColor:o.A.palette.blue,fillOpacity:.2,highlightStrokeWidth:2,highlightStrokeColor:o.A.palette.blue,highlightFillColor:o.A.palette.blue,highlightFillOpacity:.1},button:{disabled:!1,display:"html"},cardinalspline:{createPoints:!0,isArrayOfCoordinates:!0,points:{strokeOpacity:.05,fillOpacity:.05,highlightStrokeOpacity:1,highlightFillOpacity:1,withLabel:!1,name:"",fixed:!1}},chart:{chartStyle:"line",colors:["#B02B2C","#3F4C6B","#C79810","#D15600","#FFFF88","#c3d9ff","#4096EE","#008C00"],highlightcolors:null,fillcolor:null,highlightonsector:!1,highlightbysize:!1,fillOpacity:.6,withLines:!1,label:{}},checkbox:{disabled:!1,checked:!1,display:"html"},circle:{hasInnerPoints:!1,fillColor:"none",highlightFillColor:"none",strokeColor:o.A.palette.blue,highlightStrokeColor:"#c3d9ff",center:{visible:!1,withLabel:!1,fixed:!1,fillColor:o.A.palette.red,strokeColor:o.A.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",layer:9,name:""},point2:{fillColor:o.A.palette.red,strokeColor:o.A.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",layer:9,visible:!1,withLabel:!1,fixed:!1,name:""},label:{position:"urt"}},circumcircle:{fillColor:"none",highlightFillColor:"none",strokeColor:o.A.palette.blue,highlightStrokeColor:"#c3d9ff",center:{visible:!1,fixed:!1,withLabel:!1,fillColor:o.A.palette.red,strokeColor:o.A.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",name:""}},circumcirclearc:{fillColor:"none",highlightFillColor:"none",strokeColor:o.A.palette.blue,highlightStrokeColor:"#c3d9ff",useDirection:!0,center:{visible:!1,withLabel:!1,fixed:!1,name:""}},circumcirclesector:{useDirection:!0,fillColor:o.A.palette.yellow,highlightFillColor:o.A.palette.yellow,fillOpacity:.3,highlightFillOpacity:.3,strokeColor:o.A.palette.blue,highlightStrokeColor:"#c3d9ff",point:{visible:!1,fixed:!1,withLabel:!1,name:""}},comb:{frequency:.2,width:.4,angle:Math.PI/3,reverse:!1,point1:{visible:!1,withLabel:!1,fixed:!1,name:""},point2:{visible:!1,withLabel:!1,fixed:!1,name:""},strokeWidth:1,strokeColor:"#0000ff",fillColor:"none"},conic:{fillColor:"none",highlightFillColor:"none",strokeColor:o.A.palette.blue,highlightStrokeColor:"#c3d9ff",foci:{fixed:!1,visible:!1,withLabel:!1,name:""},center:{visible:!1,withLabel:!1,name:""},point:{withLabel:!1,name:""},line:{visible:!1}},curve:{strokeWidth:1,strokeColor:o.A.palette.blue,fillColor:"none",fixed:!0,curveType:null,doAdvancedPlot:!0,doAdvancedPlotOld:!1,firstArrow:!1,handDrawing:!1,label:{position:"lft"},lastArrow:!1,lineCap:"round",numberPointsHigh:1600,numberPointsLow:400,plotVersion:2,recursionDepthHigh:17,recursionDepthLow:15},foreignobject:{fixed:!0,visible:!0,needsRegularUpdate:!1,attractors:[],evaluateOnlyOnce:!1},functiongraph:{},glider:{label:{}},grid:{needsRegularUpdate:!1,hasGrid:!1,highlight:!1,gridX:null,gridY:null,majorStep:"auto",minorElements:0,forceSquare:!1,includeBoundaries:!1,size:void 0,face:void 0,margin:void 0,drawZero:void 0,polygonVertices:void 0,major:{size:5,face:"line",margin:0,drawZero:!0,polygonVertices:6},minor:{visible:"inherit",size:3,face:"point",margin:0,drawZero:!0,polygonVertices:6},snapToGrid:!1,strokeColor:"#c0c0c0",strokeWidth:1,strokeOpacity:.5,dash:0,theme:0,themes:[{},{forceSquare:"min",major:{face:"line"}},{major:{face:"line"},minor:{size:3,face:"point"},minorElements:"auto"},{major:{face:"line"},minor:{face:"line",strokeOpacity:.25},minorElements:"auto"},{major:{face:"line"},minor:{face:"+",size:"95%"},minorElements:"auto"},{major:{face:"+",size:10,strokeOpacity:1},minor:{face:"point",size:3},minorElements:"auto"},{major:{face:"circle",size:8,fillColor:"#c0c0c0"},minor:{face:"point",size:3},minorElements:"auto"}]},group:{needsRegularUpdate:!0},htmlslider:{widthRange:100,widthOut:34,step:.01,frozen:!0,isLabel:!1,strokeColor:"#000000",display:"html",anchorX:"left",anchorY:"middle",withLabel:!1},image:{imageString:null,fillOpacity:1,highlightFillOpacity:.6,cssClass:"JXGimage",highlightCssClass:"JXGimageHighlight",rotate:0,snapSizeX:1,snapSizeY:1,attractors:[]},implicitcurve:{margin:1,resolution_outer:5,resolution_inner:5,max_steps:1024,alpha_0:.05,tol_u0:s.A.eps,tol_newton:1e-7,tol_cusp:.05,tol_progress:1e-4,qdt_box:.2,kappa_0:.2,delta_0:.05,h_initial:.1,h_critical:.001,h_max:.5,loop_dist:.09,loop_dir:.99,loop_detection:!0},incircle:{fillColor:"none",highlightFillColor:"none",strokeColor:o.A.palette.blue,highlightStrokeColor:"#c3d9ff",center:{visible:!1,fixed:!1,withLabel:!1,fillColor:o.A.palette.red,strokeColor:o.A.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",name:""}},inequality:{fillColor:o.A.palette.red,fillOpacity:.2,strokeColor:"none",inverse:!1},infobox:{distanceX:-20,distanceY:25,intl:{enabled:"inherit",options:{}},fontSize:12,isLabel:!1,strokeColor:"#bbbbbb",display:"html",anchorX:"left",anchorY:"middle",cssClass:"JXGinfobox",rotate:0,visible:!0,parse:!1,transitionDuration:0,needsRegularUpdate:!1,tabindex:null,viewport:[0,0,0,0]},integral:{axis:"x",withLabel:!0,fixed:!0,strokeWidth:0,strokeOpacity:0,fillColor:o.A.palette.red,fillOpacity:.3,highlightFillColor:o.A.palette.red,highlightFillOpacity:.2,curveLeft:{visible:!0,withLabel:!1,color:o.A.palette.red,fillOpacity:.8,layer:9},baseLeft:{visible:!1,fixed:!1,withLabel:!1,name:""},curveRight:{visible:!0,withLabel:!1,color:o.A.palette.red,fillOpacity:.8,layer:9},baseRight:{visible:!1,fixed:!1,withLabel:!1,name:""},label:{fontSize:20,digits:4,intl:{enabled:!1,options:{}}}},input:{disabled:!1,maxlength:524288,display:"html"},intersection:{alwaysIntersect:!0},label:{visible:"inherit",strokeColor:"#000000",strokeOpacity:1,highlightStrokeOpacity:.666666,highlightStrokeColor:"#000000",fixed:!0,tabindex:null,position:"urt",distance:1.5,offset:[10,10],autoPosition:!1,autoPositionMinDistance:12,autoPositionMaxDistance:28,autoPositionWhitelist:[]},legend:{style:"vertical",labels:["1","2","3","4","5","6","7","8"],colors:["#B02B2C","#3F4C6B","#C79810","#D15600","#FFFF88","#c3d9ff","#4096EE","#008C00"],lineLength:1,strokeOpacity:[1],rowHeight:20,strokeWidth:5,frozen:!1},line:{firstArrow:!1,lastArrow:!1,margin:0,straightFirst:!0,straightLast:!0,fillColor:"none",highlightFillColor:"none",strokeColor:o.A.palette.blue,highlightStrokeColor:"#c3d9ff",withTicks:!1,point1:{fillColor:o.A.palette.red,strokeColor:o.A.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",layer:9,visible:!1,withLabel:!1,fixed:!1,name:""},point2:{fillColor:o.A.palette.red,strokeColor:o.A.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",layer:9,visible:!1,withLabel:!1,fixed:!1,name:""},ticks:{drawLabels:!0,label:{offset:[4,-9]},drawZero:!1,insertTicks:!1,ticksDistance:1,minTicksDistance:50,minorHeight:4,majorHeight:-1,minorTicks:4,strokeOpacity:.3,visible:"inherit"},label:{position:"llft"},snapToGrid:!1,snapSizeX:1,snapSizeY:1,touchFirstPoint:!1,touchLastPoint:!1},locus:{translateToOrigin:!1,translateTo10:!1,stretch:!1,toOrigin:null,to10:null},measurement:{baseUnit:"",units:{},showPrefix:!0,showSuffix:!0,prefix:"",suffix:"",dim:null,formatCoords:function(t,e,i,r){return 1!==parseFloat(r)?"Infinit coords":"("+e+", "+i+")"},formatDirection:function(t,e,i){return"("+e+", "+i+")"}},metapostspline:{createPoints:!0,isArrayOfCoordinates:!0,points:{strokeOpacity:.5,fillOpacity:.5,highlightStrokeOpacity:1,highlightFillOpacity:1,withLabel:!1,name:"",fixed:!1}},mirrorelement:{fixed:!0,point:{},center:{},type:"Euclidean"},nonreflexangle:{},normal:{strokeColor:"#000000",point:{visible:!1,fixed:!1,withLabel:!1,name:""}},orthogonalprojection:{},otherintersection:{alwaysIntersect:!0,precision:.001},parallel:{strokeColor:"#000000",point:{visible:!1,fixed:!1,withLabel:!1,name:""},label:{position:"llft"}},parallelogram:{parallelpoint:{withLabel:!1,name:""}},parallelpoint:{},perpendicular:{strokeColor:"#000000",straightFirst:!0,straightLast:!0},perpendicularsegment:{strokeColor:"#000000",straightFirst:!1,straightLast:!1,point:{visible:!1,fixed:!0,withLabel:!1,name:""}},point:{withLabel:!0,label:{},style:5,face:"o",size:3,sizeUnit:"screen",strokeWidth:2,transitionProperties:["fill","fill-opacity","stroke","stroke-opacity","stroke-width","width","height","rx","ry"],fillColor:o.A.palette.red,strokeColor:o.A.palette.red,highlightFillColor:"#c3d9ff",highlightStrokeColor:"#c3d9ff",zoom:!1,showInfobox:"inherit",infoboxDigits:"auto",draft:!1,attractors:[],attractorUnit:"user",attractorDistance:0,snatchDistance:0,snapToGrid:!1,attractToGrid:!1,snapSizeX:1,snapSizeY:1,snapToPoints:!1,ignoredSnapToPoints:[]},polygon:{hasInnerPoints:!1,fillColor:o.A.palette.yellow,highlightFillColor:o.A.palette.yellow,fillOpacity:.3,highlightFillOpacity:.2,withLines:!0,borders:{withLabel:!1,strokeWidth:1,highlightStrokeWidth:1,layer:5,label:{position:"top"},visible:"inherit"},highlightByStrokeWidth:!1,vertices:{layer:9,withLabel:!1,name:"",strokeColor:o.A.palette.red,fillColor:o.A.palette.red,fixed:!1,visible:"inherit"},label:{offset:[0,0]}},polygonalchain:{fillColor:"none",highlightFillColor:"none"},prescribedangle:{anglePoint:{size:2,visible:!1,withLabel:!1}},reflection:{fixed:!0,center:{},type:"Euclidean"},reflexangle:{},regularpolygon:{hasInnerPoints:!1,fillColor:o.A.palette.yellow,highlightFillColor:o.A.palette.yellow,fillOpacity:.3,highlightFillOpacity:.2,withLines:!0,borders:{withLabel:!1,strokeWidth:1,highlightStrokeWidth:1,layer:5,label:{position:"top"}},vertices:{layer:9,withLabel:!0,strokeColor:o.A.palette.red,fillColor:o.A.palette.red,fixed:!1},label:{offset:[0,0]}},riemannsum:{withLabel:!1,fillOpacity:.3,fillColor:o.A.palette.yellow},sector:{fillColor:o.A.palette.yellow,highlightFillColor:o.A.palette.yellow,fillOpacity:.3,highlightFillOpacity:.3,highlightOnSector:!1,highlightStrokeWidth:0,useDirection:!1,selection:"auto",arc:{visible:!1,fillColor:"none",withLabel:!1,name:"",center:{visible:!1,withLabel:!1,name:""},radiusPoint:{visible:!1,withLabel:!1,name:""},anglePoint:{visible:!1,withLabel:!1,name:""}},radiusPoint:{visible:!1,withLabel:!1},center:{visible:!1,withLabel:!1},anglePoint:{visible:!1,withLabel:!1},label:{offset:[0,0],anchorX:"auto",anchorY:"auto"}},segment:{label:{position:"top"}},semicircle:{center:{visible:!1,withLabel:!1,fixed:!1,fillColor:o.A.palette.red,strokeColor:o.A.palette.red,highlightFillColor:"#eeeeee",highlightStrokeColor:o.A.palette.red,name:""}},slider:{snapWidth:-1,snapValues:[],snapValueDistance:0,precision:2,digits:2,intl:{enabled:"inherit",options:{}},firstArrow:!1,lastArrow:!1,withTicks:!0,withLabel:!0,suffixLabel:null,unitLabel:null,postLabel:null,layer:9,showInfobox:!1,name:"",visible:!0,strokeColor:"#000000",highlightStrokeColor:"#888888",fillColor:"#ffffff",highlightFillColor:"none",size:6,point1:{needsRegularUpdate:!1,showInfobox:!1,withLabel:!1,visible:!1,fixed:!0,name:""},point2:{needsRegularUpdate:!1,showInfobox:!1,withLabel:!1,visible:!1,fixed:!0,name:""},baseline:{needsRegularUpdate:!1,visible:"inherit",fixed:!0,scalable:!1,tabindex:null,name:"",strokeWidth:1,strokeColor:"#000000",highlightStrokeColor:"#888888"},ticks:{needsRegularUpdate:!1,fixed:!0,drawLabels:!1,digits:2,includeBoundaries:!0,drawZero:!0,label:{offset:[-4,-14],display:"internal"},minTicksDistance:30,insertTicks:!0,ticksDistance:1,minorHeight:4,majorHeight:5,minorTicks:0,strokeOpacity:1,strokeWidth:1,tickEndings:[0,1],majortickEndings:[0,1],strokeColor:"#000000",visible:"inherit"},highline:{strokeWidth:3,visible:"inherit",fixed:!0,tabindex:null,name:"",strokeColor:"#000000",highlightStrokeColor:"#888888"},label:{visible:"inherit",strokeColor:"#000000"},moveOnUp:!0},slopefield:{strokeWidth:.5,highlightStrokeWidth:.5,highlightStrokeColor:o.A.palette.blue,highlightStrokeOpacity:.8,scale:1,arrowhead:{enabled:!1,size:5,angle:.125*Math.PI}},slopetriangle:{fillColor:o.A.palette.red,fillOpacity:.4,highlightFillColor:o.A.palette.red,highlightFillOpacity:.3,borders:{lastArrow:{type:1,size:6}},glider:{fixed:!0,visible:!1,withLabel:!1},baseline:{visible:!1,withLabel:!1,name:""},basepoint:{visible:!1,withLabel:!1,name:""},tangent:{visible:!1,withLabel:!1,name:""},toppoint:{visible:!1,withLabel:!1,name:""},label:{visible:!0,position:"first"}},smartlabelangle:{cssClass:"smart-label-solid smart-label-angle",highlightCssClass:"smart-label-solid smart-label-angle",anchorX:"left",anchorY:"middle",unit:"",prefix:"",suffix:"",measure:"deg",useMathJax:!0},smartlabelcircle:{cssClass:"smart-label-solid smart-label-circle",highlightCssClass:"smart-label-solid smart-label-circle",anchorX:"middle",useMathJax:!0,unit:"",prefix:"",suffix:"",measure:"radius"},smartlabelline:{cssClass:"smart-label-solid smart-label-line",highlightCssClass:"smart-label-solid smart-label-line",anchorX:"middle",useMathJax:!0,unit:"",measure:"length"},smartlabelpoint:{cssClass:"smart-label-solid smart-label-point",highlightCssClass:"smart-label-solid smart-label-point",anchorX:"middle",anchorY:"top",useMathJax:!0,dir:"row",unit:""},smartlabelpolygon:{cssClass:"smart-label-solid smart-label-polygon",highlightCssClass:"smart-label-solid smart-label-polygon",anchorX:"middle",useMathJax:!0,unit:"",measure:"area"},stepfunction:{},tangent:{},tangentto:{polar:{visible:!1,strokeWidth:1,dash:3},point:{visible:!1}},tapemeasure:{strokeColor:"#000000",strokeWidth:2,highlightStrokeColor:"#000000",withTicks:!0,withLabel:!0,rotate:0,precision:2,digits:2,point1:{visible:!0,strokeColor:"#000000",fillColor:"#ffffff",fillOpacity:0,highlightFillOpacity:.1,size:6,snapToPoints:!0,attractorUnit:"screen",attractorDistance:20,showInfobox:!1,withLabel:!1,name:""},point2:{visible:!0,strokeColor:"#000000",fillColor:"#ffffff",fillOpacity:0,highlightFillOpacity:.1,size:6,snapToPoints:!0,attractorUnit:"screen",attractorDistance:20,showInfobox:!1,withLabel:!1,name:""},ticks:{drawLabels:!1,drawZero:!0,insertTicks:!0,ticksDistance:.1,minorHeight:8,majorHeight:16,minorTicks:4,tickEndings:[0,1],majorTickEndings:[0,1],strokeOpacity:1,strokeWidth:1,strokeColor:"#000000",visible:"inherit",label:{anchorY:"top",anchorX:"middle",offset:[0,-10]}},label:{position:"top"}},text:{fontSize:12,fontUnit:"px",formatNumber:!1,digits:2,intl:{enabled:"inherit",options:{minimumFractionDigits:0,maximumFractionDigits:2}},parse:!0,useCaja:!1,isLabel:!1,strokeColor:"#000000",highlightStrokeColor:"#000000",highlightStrokeOpacity:.666666,cssDefaultStyle:"font-family: Arial, Helvetica, Geneva, sans-serif;",highlightCssDefaultStyle:"font-family: Arial, Helvetica, Geneva, sans-serif;",cssStyle:"",highlightCssStyle:"",transitionProperties:["color","opacity"],useASCIIMathML:!1,useMathJax:!1,useKatex:!1,katexMacros:{},toFraction:!1,display:"html",anchor:null,anchorX:"left",anchorY:"middle",cssClass:"JXGtext",highlightCssClass:"JXGtext",dragArea:"all",withLabel:!1,rotate:0,visible:!0,snapSizeX:1,snapSizeY:1,attractors:[]},tracecurve:{strokeColor:"#000000",fillColor:"none",numberPoints:100},turtle:{strokeWidth:1,fillColor:"none",strokeColor:"#000000",arrow:{strokeWidth:2,withLabel:!1,strokeColor:o.A.palette.red,lastArrow:!0}},vectorfield:{strokeWidth:.5,highlightStrokeWidth:.5,highlightStrokeColor:o.A.palette.blue,highlightStrokeOpacity:.8,scale:1,arrowhead:{enabled:!0,size:5,angle:.125*Math.PI}},shortcuts:{color:["strokeColor","fillColor"],opacity:["strokeOpacity","fillOpacity"],highlightColor:["highlightStrokeColor","highlightFillColor"],highlightOpacity:["highlightStrokeOpacity","highlightFillOpacity"],strokeWidth:["strokeWidth","highlightStrokeWidth"]}},r.A.Validator=function(){var t,e=function(t){return a.A.isString(t)},i=function(t){return a.A.isNumber(t,!0,!1)},n=function(t){return Math.abs(t-Math.round(t))<s.A.eps},o=function(t){return n(t)&&t>0},l=function(t){return t>0},c=function(t){return t>=0},h={},u={attractorDistance:c,color:e,display:function(t){return"html"===t||"internal"===t},doAdvancedPlot:!1,draft:!1,drawLabels:!1,drawZero:!1,face:function(t){return a.A.exists(r.A.normalizePointFace(t))},factor:i,fillColor:e,fillOpacity:i,firstArrow:!1,fontSize:n,dash:n,gridX:i,gridY:i,hasGrid:!1,highlightFillColor:e,highlightFillOpacity:i,highlightStrokeColor:e,highlightStrokeOpacity:i,insertTicks:!1,lastArrow:!1,layer:function(t){return n(t)&&t>=0},majorHeight:n,minorHeight:n,minorTicks:c,minTicksDistance:o,numberPointsHigh:o,numberPointsLow:o,opacity:i,radius:i,RDPsmoothing:!1,renderer:function(t){return"vml"===t||"svg"===t||"canvas"===t||"no"===t},right:function(t){return/^[0-9]+px$/.test(t)},showCopyright:!1,showInfobox:!1,showNavigation:!1,size:c,snapSizeX:l,snapSizeY:l,snapWidth:i,snapToGrid:!1,snatchDistance:c,straightFirst:!1,straightLast:!1,stretch:!1,strokeColor:e,strokeOpacity:i,strokeWidth:c,takeFirst:!1,takeSizeFromFile:!1,to10:!1,toOrigin:!1,translateTo10:!1,translateToOrigin:!1,useASCIIMathML:!1,useDirection:!1,useMathJax:!1,withLabel:!1,withTicks:!1,zoom:!1};for(t in u)u.hasOwnProperty(t)&&(h[t.toLowerCase()]=u[t]);return h}(),r.A.normalizePointFace=function(t){return{cross:"x",x:"x",circle:"o",o:"o",square:"[]","[]":"[]",plus:"+","+":"+",divide:"|","|":"|",minus:"-","-":"-",diamond:"<>","<>":"<>",diamond2:"<<>>","<<>>":"<<>>",triangleup:"^",A:"^",a:"^","^":"^",triangledown:"v",v:"v",triangleleft:"<","<":"<",triangleright:">",">":">"}[t]},r.A.useStandardOptions=function(t){var e,i,s,o,a=r.A.Options,l=t.hasGrid;for(e in t.options.grid.hasGrid=a.grid.hasGrid,t.options.grid.gridX=a.grid.gridX,t.options.grid.gridY=a.grid.gridY,t.options.grid.gridColor=a.grid.gridColor,t.options.grid.gridOpacity=a.grid.gridOpacity,t.options.grid.gridDash=a.grid.gridDash,t.options.grid.snapToGrid=a.grid.snapToGrid,t.options.grid.snapSizeX=a.grid.SnapSizeX,t.options.grid.snapSizeY=a.grid.SnapSizeY,t.takeSizeFromFile=a.takeSizeFromFile,o=function(t,e){t.visProp.fillcolor=e.fillColor,t.visProp.highlightfillcolor=e.highlightFillColor,t.visProp.strokecolor=e.strokeColor,t.visProp.highlightstrokecolor=e.highlightStrokeColor},t.objects)if(t.objects.hasOwnProperty(e))if((s=t.objects[e]).elementClass===n.A.OBJECT_CLASS_POINT)o(s,a.point);else if(s.elementClass===n.A.OBJECT_CLASS_LINE)for(o(s,a.line),i=0;i<s.ticks.length;i++)s.ticks[i].majorTicks=a.line.ticks.majorTicks,s.ticks[i].minTicksDistance=a.line.ticks.minTicksDistance,s.ticks[i].visProp.minorheight=a.line.ticks.minorHeight,s.ticks[i].visProp.majorheight=a.line.ticks.majorHeight;else s.elementClass===n.A.OBJECT_CLASS_CIRCLE?o(s,a.circle):s.type===n.A.OBJECT_TYPE_ANGLE?o(s,a.angle):s.type===n.A.OBJECT_TYPE_ARC?o(s,a.arc):s.type===n.A.OBJECT_TYPE_POLYGON?o(s,a.polygon):s.type===n.A.OBJECT_TYPE_CONIC?o(s,a.conic):s.type===n.A.OBJECT_TYPE_CURVE?o(s,a.curve):s.type===n.A.OBJECT_TYPE_SECTOR&&(s.arc.visProp.fillcolor=a.sector.fillColor,s.arc.visProp.highlightfillcolor=a.sector.highlightFillColor,s.arc.visProp.fillopacity=a.sector.fillOpacity,s.arc.visProp.highlightfillopacity=a.sector.highlightFillOpacity);t.fullUpdate(),l&&!t.hasGrid?t.removeGrids(t):!l&&t.hasGrid&&t.create("grid",[])},r.A.useBlackWhiteOptions=function(t){var e=r.A.Options;e.point.fillColor=o.A.rgb2bw(e.point.fillColor),e.point.highlightFillColor=o.A.rgb2bw(e.point.highlightFillColor),e.point.strokeColor=o.A.rgb2bw(e.point.strokeColor),e.point.highlightStrokeColor=o.A.rgb2bw(e.point.highlightStrokeColor),e.line.fillColor=o.A.rgb2bw(e.line.fillColor),e.line.highlightFillColor=o.A.rgb2bw(e.line.highlightFillColor),e.line.strokeColor=o.A.rgb2bw(e.line.strokeColor),e.line.highlightStrokeColor=o.A.rgb2bw(e.line.highlightStrokeColor),e.circle.fillColor=o.A.rgb2bw(e.circle.fillColor),e.circle.highlightFillColor=o.A.rgb2bw(e.circle.highlightFillColor),e.circle.strokeColor=o.A.rgb2bw(e.circle.strokeColor),e.circle.highlightStrokeColor=o.A.rgb2bw(e.circle.highlightStrokeColor),e.arc.fillColor=o.A.rgb2bw(e.arc.fillColor),e.arc.highlightFillColor=o.A.rgb2bw(e.arc.highlightFillColor),e.arc.strokeColor=o.A.rgb2bw(e.arc.strokeColor),e.arc.highlightStrokeColor=o.A.rgb2bw(e.arc.highlightStrokeColor),e.polygon.fillColor=o.A.rgb2bw(e.polygon.fillColor),e.polygon.highlightFillColor=o.A.rgb2bw(e.polygon.highlightFillColor),e.sector.fillColor=o.A.rgb2bw(e.sector.fillColor),e.sector.highlightFillColor=o.A.rgb2bw(e.sector.highlightFillColor),e.curve.strokeColor=o.A.rgb2bw(e.curve.strokeColor),e.grid.gridColor=o.A.rgb2bw(e.grid.gridColor),r.A.useStandardOptions(t)},r.A.Options.normalizePointFace=r.A.normalizePointFace;const l=r.A.Options},778:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},805:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(84),n=i(9);r.A.EventEmitter={eventHandlers:{},suspended:{},trigger:function(t,e){var i,r,n,s,o,a;for(o=t.length,r=0;r<o;r++)if(s=this.eventHandlers[t[r]],!this.suspended[t[r]]){if(this.suspended[t[r]]=!0,s)for(a=s.length,i=0;i<a;i++)(n=s[i]).handler.apply(n.context,e);this.suspended[t[r]]=!1}return this},on:function(t,e,i){return n.A.isArray(this.eventHandlers[t])||(this.eventHandlers[t]=[]),i=n.A.def(i,this),this.eventHandlers[t].push({handler:e,context:i}),this},off:function(t,e){var i;return t&&n.A.isArray(this.eventHandlers[t])?(e?((i=n.A.indexOf(this.eventHandlers[t],e,"handler"))>-1&&this.eventHandlers[t].splice(i,1),0===this.eventHandlers[t].length&&delete this.eventHandlers[t]):delete this.eventHandlers[t],this):this},eventify:function(t){t.eventHandlers={clicks:0},t.on=this.on,t.off=this.off,t.triggerEventHandlers=this.trigger,t.trigger=this.trigger,t.suspended={}}};const s=r.A.EventEmitter},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var r="";i.supports&&(r+="@supports (".concat(i.supports,") {")),i.media&&(r+="@media ".concat(i.media," {"));var n=void 0!==i.layer;n&&(r+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),r+=i.css,n&&(r+="}"),i.media&&(r+="}"),i.supports&&(r+="}");var s=i.sourceMap;s&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(r,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},956:(t,e,i)=>{i.d(e,{A:()=>l});var r=i(84),n=i(9),s=i(234),o=i(174),a={rk4:{s:4,A:[[0,0,0,0],[.5,0,0,0],[0,.5,0,0],[0,0,1,0]],b:[1/6,1/3,1/3,1/6],c:[0,.5,.5,1]},heun:{s:2,A:[[0,0],[1,0]],b:[.5,.5],c:[0,1]},euler:{s:1,A:[[0]],b:[1],c:[0]}};o.A.Numerics={Gauss:function(t,e){var i,r,s,a,l,c=o.A.eps,h=t.length>0?t[0].length:0;if(h!==e.length||h!==t.length)throw new Error("JXG.Math.Numerics.Gauss: Dimensions don't match. A must be a square matrix and b must be of the same length as A.");for(a=[],l=e.slice(0,h),i=0;i<h;i++)a[i]=t[i].slice(0,h);for(r=0;r<h;r++){for(i=h-1;i>r;i--)if(Math.abs(a[i][r])>c)if(Math.abs(a[r][r])<c)n.A.swap(a,i,r),n.A.swap(l,i,r);else for(a[i][r]/=a[r][r],l[i]-=a[i][r]*l[r],s=r+1;s<h;s++)a[i][s]-=a[i][r]*a[r][s];if(Math.abs(a[r][r])<c)throw new Error("JXG.Math.Numerics.Gauss(): The given matrix seems to be singular.")}return this.backwardSolve(a,l,!0),l},backwardSolve:function(t,e,i){var r,n,s,o,a;for(r=i?e:e.slice(0,e.length),n=t.length,s=t.length>0?t[0].length:0,o=n-1;o>=0;o--){for(a=s-1;a>o;a--)r[o]-=t[o][a]*r[a];r[o]/=t[o][o]}return r},gaussBareiss:function(t){var e,i,r,n,s,a,l,c,h,u=o.A.eps;if((l=t.length)<=0)return 0;for(t[0].length<l&&(l=t[0].length),c=[],n=0;n<l;n++)c[n]=t[n].slice(0,l);for(i=1,r=1,e=0;e<l-1;e++){if(a=c[e][e],Math.abs(a)<u){for(n=e+1;n<l&&!(Math.abs(c[n][e])>=u);n++);if(n===l)return 0;for(s=e;s<l;s++)h=c[n][s],c[n][s]=c[e][s],c[e][s]=h;r=-r,a=c[e][e]}for(n=e+1;n<l;n++)for(s=e+1;s<l;s++)h=a*c[n][s]-c[n][e]*c[e][s],c[n][s]=h/i;i=a}return r*c[l-1][l-1]},det:function(t){return 2===t.length&&2===t[0].length?t[0][0]*t[1][1]-t[1][0]*t[0][1]:this.gaussBareiss(t)},Jacobi:function(t){var e,i,r,n,s,a,l,c,h,u=o.A.eps*o.A.eps,d=0,p=t.length,f=[[0,0,0],[0,0,0],[0,0,0]],m=[[0,0,0],[0,0,0],[0,0,0]],g=0;for(e=0;e<p;e++){for(i=0;i<p;i++)f[e][i]=0,m[e][i]=t[e][i],d+=Math.abs(m[e][i]);f[e][e]=1}if(1===p)return[m,f];if(d<=0)return[m,f];d/=p*p;do{for(c=0,h=0,i=1;i<p;i++)for(e=0;e<i;e++)if((n=Math.abs(m[e][i]))>h&&(h=n),c+=n,n>=u){for(n=.5*Math.atan2(2*m[e][i],m[e][e]-m[i][i]),s=Math.sin(n),a=Math.cos(n),r=0;r<p;r++)l=m[r][e],m[r][e]=a*l+s*m[r][i],m[r][i]=-s*l+a*m[r][i],l=f[r][e],f[r][e]=a*l+s*f[r][i],f[r][i]=-s*l+a*f[r][i];for(m[e][e]=a*m[e][e]+s*m[i][e],m[i][i]=-s*m[e][i]+a*m[i][i],m[e][i]=0,r=0;r<p;r++)m[e][r]=m[r][e],m[i][r]=m[r][i]}g+=1}while(Math.abs(c)/d>u&&g<2e3);return[m,f]},NewtonCotes:function(t,e,i){var r,s,o,a=0,l=i&&n.A.isNumber(i.number_of_nodes)?i.number_of_nodes:28,c={trapez:!0,simpson:!0,milne:!0},h=i&&i.integration_type&&c.hasOwnProperty(i.integration_type)&&c[i.integration_type]?i.integration_type:"milne",u=(t[1]-t[0])/l;switch(h){case"trapez":for(a=.5*(e(t[0])+e(t[1])),r=t[0],s=0;s<l-1;s++)a+=e(r+=u);a*=u;break;case"simpson":if(l%2>0)throw new Error("JSXGraph:  INT_SIMPSON requires config.number_of_nodes dividable by 2.");for(o=l/2,a=e(t[0])+e(t[1]),r=t[0],s=0;s<o-1;s++)a+=2*e(r+=2*u);for(r=t[0]-u,s=0;s<o;s++)a+=4*e(r+=2*u);a*=u/3;break;default:if(l%4>0)throw new Error("JSXGraph: Error in INT_MILNE: config.number_of_nodes must be a multiple of 4");for(o=.25*l,a=7*(e(t[0])+e(t[1])),r=t[0],s=0;s<o-1;s++)a+=14*e(r+=4*u);for(r=t[0]-3*u,s=0;s<o;s++)a+=32*(e(r+=4*u)+e(r+2*u));for(r=t[0]-2*u,s=0;s<o;s++)a+=12*e(r+=4*u);a*=2*u/45}return a},Romberg:function(t,e,i){var r,s,o,a,l,c,h,u,d=[],p=0,f=1/0,m=i&&n.A.isNumber(i.max_iterations)?i.max_iterations:20,g=i&&n.A.isNumber(i.eps)?i.eps:i.eps||1e-7;for(r=t[0],o=(s=t[1])-r,l=1,d[0]=.5*o*(e(r)+e(s)),c=0;c<m;++c){for(a=0,o*=.5,l*=2,u=1,h=1;h<l;h+=2)a+=e(r+h*o);for(d[c+1]=.5*d[c]+a*o,p=d[c+1],h=c-1;h>=0;--h)u*=4,d[h]=d[h+1]+(d[h+1]-d[h])/(u-1),p=d[h];if(Math.abs(p-f)<g*Math.abs(p))break;f=p}return p},GaussLegendre:function(t,e,i){var r,s,o,a,l,c,h,u,d=0,p=[],f=[],m=i&&n.A.isNumber(i.n)?i.n:12;if(m>18&&(m=18),p[2]=[.5773502691896257],f[2]=[1],p[4]=[.33998104358485626,.8611363115940526],f[4]=[.6521451548625461,.34785484513745385],p[6]=[.2386191860831969,.6612093864662645,.932469514203152],f[6]=[.46791393457269104,.3607615730481386,.17132449237917036],p[8]=[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],f[8]=[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],p[10]=[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],f[10]=[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],p[12]=[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],f[12]=[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],p[14]=[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],f[14]=[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],p[16]=[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499],f[16]=[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096],p[18]=[.0847750130417353,.2518862256915055,.41175116146284263,.5597708310739475,.6916870430603532,.8037049589725231,.8926024664975557,.9558239495713977,.9915651684209309],f[18]=[.1691423829631436,.16427648374583273,.15468467512626524,.14064291467065065,.12255520671147846,.10094204410628717,.07642573025488905,.0497145488949698,.02161601352648331],p[3]=[0,.7745966692414834],f[3]=[.8888888888888888,.5555555555555556],p[5]=[0,.5384693101056831,.906179845938664],f[5]=[.5688888888888889,.47862867049936647,.23692688505618908],p[7]=[0,.4058451513773972,.7415311855993945,.9491079123427585],f[7]=[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],p[9]=[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],f[9]=[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],p[11]=[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],f[11]=[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],p[13]=[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],f[13]=[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],p[15]=[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],f[15]=[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],p[17]=[0,.17848418149584785,.3512317634538763,.5126905370864769,.6576711592166907,.7815140038968014,.8802391537269859,.9506755217687678,.9905754753144174],f[17]=[.17944647035620653,.17656270536699264,.16800410215645004,.15404576107681028,.13513636846852548,.11188384719340397,.08503614831717918,.0554595293739872,.02414830286854793],r=t[0],s=t[1],a=m+1>>1,h=p[m],u=f[m],c=.5*(s-r),l=.5*(s+r),!0&m)for(d=u[0]*e(l),o=1;o<a;++o)d+=u[o]*(e(l+c*h[o])+e(l-c*h[o]));else for(d=0,o=0;o<a;++o)d+=u[o]*(e(l+c*h[o])+e(l-c*h[o]));return c*d},_rescale_error:function(t,e,i){var r,n;return t=Math.abs(t),0!==i&&0!==t&&(t=(r=Math.pow(200*t/i,1.5))<1?i*r:i),e>20041683600089728e-310&&(n=11102230246251565e-30*e)>t&&(t=n),t},_gaussKronrod:function(t,e,i,r,n,s,o){var a,l,c,h,u,d,p,f,m,g,_,v=t[0],y=t[1],b=.5*(v+y),A=.5*(y-v),x=Math.abs(A),C=e(b),E=0,M=C*s[i-1],S=Math.abs(M),w=0,P=[],T=[];for(i%2==0&&(E=C*n[i/2-1]),a=Math.floor((i-1)/2),u=0;u<a;u++)_=(m=e(b-(f=A*r[d=2*u+1])))+(g=e(b+f)),P[d]=m,T[d]=g,E+=n[u]*_,M+=s[d]*_,S+=s[d]*(Math.abs(m)+Math.abs(g));for(a=Math.floor(i/2),u=0;u<a;u++)m=e(b-(f=A*r[p=2*u])),g=e(b+f),P[p]=m,T[p]=g,M+=s[p]*(m+g),S+=s[p]*(Math.abs(m)+Math.abs(g));for(c=.5*M,w=s[i-1]*Math.abs(C-c),u=0;u<i-1;u++)w+=s[u]*(Math.abs(P[u]-c)+Math.abs(T[u]-c));return h=(M-E)*A,S*=x,w*=x,l=M*=A,o.abserr=this._rescale_error(h,S,w),o.resabs=S,o.resasc=w,l},GaussKronrod15:function(t,e,i){return this._gaussKronrod(t,e,8,[.9914553711208126,.9491079123427585,.8648644233597691,.7415311855993945,.5860872354676911,.4058451513773972,.20778495500789848,0],[.1294849661688697,.27970539148927664,.3818300505051189,.4179591836734694],[.022935322010529224,.06309209262997856,.10479001032225019,.14065325971552592,.1690047266392679,.19035057806478542,.20443294007529889,.20948214108472782],i)},GaussKronrod21:function(t,e,i){return this._gaussKronrod(t,e,11,[.9956571630258081,.9739065285171717,.9301574913557082,.8650633666889845,.7808177265864169,.6794095682990244,.5627571346686047,.4333953941292472,.2943928627014602,.14887433898163122,0],[.06667134430868814,.1494513491505806,.21908636251598204,.26926671930999635,.29552422471475287],[.011694638867371874,.032558162307964725,.054755896574351995,.07503967481091996,.0931254545836976,.10938715880229764,.12349197626206584,.13470921731147334,.14277593857706009,.14773910490133849,.1494455540029169],i)},GaussKronrod31:function(t,e,i){return this._gaussKronrod(t,e,16,[.9980022986933971,.9879925180204854,.9677390756791391,.937273392400706,.8972645323440819,.8482065834104272,.790418501442466,.7244177313601701,.650996741297417,.5709721726085388,.4850818636402397,.3941513470775634,.29918000715316884,.20119409399743451,.1011420669187175,0],[.03075324199611727,.07036604748810812,.10715922046717194,.13957067792615432,.16626920581699392,.1861610000155622,.19843148532711158,.2025782419255613],[.005377479872923349,.015007947329316122,.02546084732671532,.03534636079137585,.04458975132476488,.05348152469092809,.06200956780067064,.06985412131872826,.07684968075772038,.08308050282313302,.08856444305621176,.09312659817082532,.09664272698362368,.09917359872179196,.10076984552387559,.10133000701479154],i)},_workspace:function(t,e){return{limit:e,size:0,nrmax:0,i:0,alist:[t[0]],blist:[t[1]],rlist:[0],elist:[0],order:[0],level:[0],qpsrt:function(){var t,e,i,r,n,s=this.size-1,o=this.limit,a=this.nrmax,l=this.order[a];if(s<2)return this.order[0]=0,this.order[1]=1,void(this.i=l);for(t=this.elist[l];a>0&&t>this.elist[this.order[a-1]];)this.order[a]=this.order[a-1],a--;for(n=s<o/2+2?s:o-s+1,i=a+1;i<n&&t<this.elist[this.order[i]];)this.order[i-1]=this.order[i],i++;for(this.order[i-1]=l,e=this.elist[s],r=n-1;r>i-2&&e>=this.elist[this.order[r]];)this.order[r+1]=this.order[r],r--;this.order[r+1]=s,l=this.order[a],this.i=l,this.nrmax=a},set_initial_result:function(t,e){this.size=1,this.rlist[0]=t,this.elist[0]=e},update:function(t,e,i,r,n,s,o,a){var l=this.i,c=this.size,h=this.level[this.i]+1;a>r?(this.alist[l]=n,this.rlist[l]=o,this.elist[l]=a,this.level[l]=h,this.alist[c]=t,this.blist[c]=e,this.rlist[c]=i,this.elist[c]=r,this.level[c]=h):(this.blist[l]=e,this.rlist[l]=i,this.elist[l]=r,this.level[l]=h,this.alist[c]=n,this.blist[c]=s,this.rlist[c]=o,this.elist[c]=a,this.level[c]=h),this.size++,h>this.maximum_level&&(this.maximum_level=h),this.qpsrt()},retrieve:function(){var t=this.i;return{a:this.alist[t],b:this.blist[t],r:this.rlist[t],e:this.elist[t]}},sum_results:function(){var t,e=this.size,i=0;for(t=0;t<e;t++)i+=this.rlist[t];return i},subinterval_too_small:function(t,e,i){var r=1.0000000000000222*(Math.abs(e)+22250738585072014e-321);return Math.abs(t)<=r&&Math.abs(i)<=r}}},Qag:function(t,e,i){var s,a,l,c,h,u,d,p,f,m,g,_,v,y,b,A,x,C,E=this._workspace(t,1e3),M=i&&n.A.isNumber(i.limit)?i.limit:15,S=i&&n.A.isNumber(i.epsrel)?i.epsrel:1e-7,w=i&&n.A.isNumber(i.epsabs)?i.epsabs:1e-7,P=i&&n.A.isFunction(i.q)?i.q:this.GaussKronrod15,T={},O=0,R=0,N=0,L=0,D=0,k=0,I=0,B=0,U=0,F=0;if(M>E.limit&&r.A.warn("iteration limit exceeds available workspace"),w<=0&&(S<50*o.A.eps||S<5e-29)&&r.A.warn("tolerance cannot be acheived with given epsabs and epsrel"),l=P.apply(this,[t,e,T]),c=T.abserr,h=T.resabs,u=T.resasc,E.set_initial_result(l,c),d=Math.max(w,S*Math.abs(l)),c<=11102230246251565e-30*h&&c>d)return r.A.warn("cannot reach tolerance because of roundoff error on first attempt"),-1/0;if(c<=d&&c!==u||0===c)return l;if(1===M)return r.A.warn("a maximum of one iteration was insufficient"),-1/0;s=l,a=c,O=1;do{D=0,k=0,I=0,B=0,U=0,F=0,_=(x=E.retrieve()).a,v=x.b,y=x.r,b=x.e,p=_,m=f=.5*(_+v),g=v,D=P.apply(this,[[p,f],e,T]),B=T.abserr,A=T.resasc,k=P.apply(this,[[m,g],e,T]),a+=(F=B+(U=T.abserr))-b,s+=(I=D+k)-y,A!==B&&T.resasc!==U&&(C=y-I,Math.abs(C)<=1e-5*Math.abs(I)&&F>=.99*b&&R++,O>=10&&F>b&&N++),a>(d=Math.max(w,S*Math.abs(s)))&&((R>=6||N>=20)&&(L=2),E.subinterval_too_small(p,m,g)&&(L=3)),E.update(p,f,D,B,m,g,k,U),_=(x=E.retrieve()).a_i,v=x.b_i,y=x.r_i,b=x.e_i,O++}while(O<M&&!L&&a>d);return E.sum_results()},I:function(t,e){return this.Qag(t,e,{q:this.GaussKronrod15,limit:15,epsrel:1e-7,epsabs:1e-7})},Newton:function(t,e,i){var r,s=0,a=o.A.eps,l=t.apply(i,[e]);for(n.A.isArray(e)&&(e=e[0]);s<50&&Math.abs(l)>a;)r=this.D(t,i)(e),Math.abs(r)>a?e-=l/r:e+=.2*Math.random()-1,l=t.apply(i,[e]),s+=1;return e},root:function(t,e,i){return this.chandrupatla(t,e,i)},generalizedNewton:function(t,e,i,r){var n,s,a,l,c,h,u,d,p,f,m,g,_,v,y=0;for(this.generalizedNewton.t1memo?(n=this.generalizedNewton.t1memo,s=this.generalizedNewton.t2memo):(n=i,s=r),f=(u=t.X(n)-e.X(s))*u+(d=t.Y(n)-e.Y(s))*d,m=this.D(t.X,t),g=this.D(e.X,e),_=this.D(t.Y,t),v=this.D(e.Y,e);f>o.A.eps&&y<10;)a=m(n),l=-g(s),c=_(n),n-=((h=-v(s))*u-l*d)/(p=a*h-l*c),s-=(a*d-c*u)/p,f=(u=t.X(n)-e.X(s))*u+(d=t.Y(n)-e.Y(s))*d,y+=1;return this.generalizedNewton.t1memo=n,this.generalizedNewton.t2memo=s,Math.abs(n)<Math.abs(s)?[t.X(n),t.Y(n)]:[e.X(s),e.Y(s)]},Neville:function(t){var e=[],i=function(i){return function(r,n){var s,a,l,c=o.A.binomial,h=t.length,u=h-1,d=0,p=0;if(!n)for(l=1,s=0;s<h;s++)e[s]=c(u,s)*l,l*=-1;for(a=r,s=0;s<h;s++){if(0===a)return t[s][i]();l=e[s]/a,a-=1,d+=t[s][i]()*l,p+=l}return d/p}};return[i("X"),i("Y"),0,function(){return t.length-1}]},splineDef:function(t,e){var i,r,n,s=Math.min(t.length,e.length),o=[],a=[],l=[],c=[],h=[],u=[];if(2===s)return[0,0];for(r=0;r<s;r++)i={X:t[r],Y:e[r]},l.push(i);for(l.sort((function(t,e){return t.X-e.X})),r=0;r<s;r++)t[r]=l[r].X,e[r]=l[r].Y;for(r=0;r<s-1;r++)c.push(t[r+1]-t[r]);for(r=0;r<s-2;r++)h.push(6*(e[r+2]-e[r+1])/c[r+1]-6*(e[r+1]-e[r])/c[r]);for(o.push(2*(c[0]+c[1])),a.push(h[0]),r=0;r<s-3;r++)n=c[r+1]/o[r],o.push(2*(c[r+1]+c[r+2])-n*c[r+1]),a.push(h[r+1]-n*a[r]);for(u[s-3]=a[s-3]/o[s-3],r=s-4;r>=0;r--)u[r]=(a[r]-c[r+1]*u[r+1])/o[r];for(r=s-3;r>=0;r--)u[r+1]=u[r];return u[0]=0,u[s-1]=0,u},splineEval:function(t,e,i,r){var s,o,a,l,c,h,u,d=Math.min(e.length,i.length),p=1,f=!1,m=[];for(n.A.isArray(t)?(p=t.length,f=!0):t=[t],s=0;s<p;s++){if(t[s]<e[0]||e[s]>e[d-1])return NaN;for(o=1;o<d&&!(t[s]<=e[o]);o++);a=i[o-=1],l=(i[o+1]-i[o])/(e[o+1]-e[o])-(e[o+1]-e[o])/6*(r[o+1]+2*r[o]),c=r[o]/2,h=(r[o+1]-r[o])/(6*(e[o+1]-e[o])),u=t[s]-e[o],m.push(a+(l+(c+h*u)*u)*u)}return f?m:m[0]},generatePolynomialTerm:function(t,e,i,r){var s,o=[];for(s=e;s>=0;s--)n.A.concat(o,["(",t[s].toPrecision(r),")"]),s>1?n.A.concat(o,["*",i,"<sup>",s,"<","/sup> + "]):1===s&&n.A.concat(o,["*",i," + "]);return o.join("")},lagrangePolynomial:function(t){var e=[],i=this,r=function(i,r){var n,s,o,a,l=t.length,c=0,h=0;if(!r)for(n=0;n<l;n++){for(e[n]=1,o=t[n].X(),s=0;s<l;s++)s!==n&&(e[n]*=o-t[s].X());e[n]=1/e[n]}for(n=0;n<l;n++){if(i===(o=t[n].X()))return t[n].Y();h+=a=e[n]/(i-o),c+=a*t[n].Y()}return c/h};return r.getTerm=function(e,r,n){return i.lagrangePolynomialTerm(t,e,r,n)()},r.getCoefficients=function(){return i.lagrangePolynomialCoefficients(t)()},r},lagrangePolynomialTerm:function(t,e,i,n){var a=this;return function(){var l,c,h,u,d,p=t.length,f=!0;for(i=i||"x",void 0===n&&(n=" * "),c=p-1,l=a.lagrangePolynomialCoefficients(t)(),h="",u=0;u<l.length;u++)d=l[u],Math.abs(d)<o.A.eps||(r.A.exists(e)&&(d=s.A._round10(d,-e)),f?(h+=d>0?d:"-"+-d,f=!1):h+=d>0?" + "+d:" - "+-d,c-u>1?h+=n+i+"^"+(c-u):c-u===1&&(h+=n+i));return h}},lagrangePolynomialCoefficients:function(t){return function(){var e,i,r,n,s=t.length,a=[],l=[],c=[];for(i=0;i<s;i++)c[i]=0;for(e=0;e<s;e++){for(r=t[e].Y(),n=t[e].X(),a=[],i=0;i<s;i++)i!==e&&(r/=n-t[i].X(),a.push(t[i].X()));for(l=[1].concat(o.A.Vieta(a)),i=0;i<l.length;i++)c[i]+=(i%2==1?-1:1)*l[i]*r}return c}},_initCubicPoly:function(t,e,i,r){return[t,i,-3*t+3*e-2*i-r,2*t-2*e+i+r]},CardinalSpline:function(t,e,i){var r,s,a,l,c=[],h=this;return l=n.A.isFunction(e)?e:function(){return e},void 0===i&&(i="uniform"),s=function(e){return function(n,s){var u,d,p,f,m,g,_,v,y,b;if(t.length<2)return NaN;if(!s)for(a=l(),p={X:function(){return 2*t[0].X()-t[1].X()},Y:function(){return 2*t[0].Y()-t[1].Y()},Dist:function(t){var e=this.X()-t.X(),i=this.Y()-t.Y();return o.A.hypot(e,i)}},f={X:function(){return 2*t[t.length-1].X()-t[t.length-2].X()},Y:function(){return 2*t[t.length-1].Y()-t[t.length-2].Y()},Dist:function(t){var e=this.X()-t.X(),i=this.Y()-t.Y();return o.A.hypot(e,i)}},b=(r=[p].concat(t,[f])).length,c[e]=[],u=0;u<b-3;u++)"centripetal"===i?(_=r[u].Dist(r[u+1]),v=r[u+2].Dist(r[u+1]),y=r[u+3].Dist(r[u+2]),_=Math.sqrt(_),v=Math.sqrt(v),y=Math.sqrt(y),v<o.A.eps&&(v=1),_<o.A.eps&&(_=v),y<o.A.eps&&(y=v),m=(r[u+1][e]()-r[u][e]())/_-(r[u+2][e]()-r[u][e]())/(v+_)+(r[u+2][e]()-r[u+1][e]())/v,g=(r[u+2][e]()-r[u+1][e]())/v-(r[u+3][e]()-r[u+1][e]())/(y+v)+(r[u+3][e]()-r[u+2][e]())/y,m*=v,g*=v,c[e][u]=h._initCubicPoly(r[u+1][e](),r[u+2][e](),a*m,a*g)):c[e][u]=h._initCubicPoly(r[u+1][e](),r[u+2][e](),a*(r[u+2][e]()-r[u][e]()),a*(r[u+3][e]()-r[u+1][e]()));return isNaN(n)?NaN:(b=t.length,n<=0?t[0][e]():n>=b?t[b-1][e]():(u=Math.floor(n))===n?t[u][e]():(n-=u,void 0===(d=c[e][u])?NaN:((d[3]*n+d[2])*n+d[1])*n+d[0]))}},[s("X"),s("Y"),0,function(){return t.length-1}]},CatmullRomSpline:function(t,e){return this.CardinalSpline(t,.5,e)},regressionPolynomial:function(t,e,i){var r,s,a,l,c,h,u="";if(n.A.isPoint(t)&&n.A.isFunction(t.Value))s=function(){return t.Value()};else if(n.A.isFunction(t))s=t;else{if(!n.A.isNumber(t))throw new Error("JSXGraph: Can't create regressionPolynomial from degree of type'"+typeof t+"'.");s=function(){return t}}if(3===arguments.length&&n.A.isArray(e)&&n.A.isArray(i))c=0;else if(2===arguments.length&&n.A.isArray(e)&&e.length>0&&n.A.isPoint(e[0]))c=1;else{if(!(2===arguments.length&&n.A.isArray(e)&&e.length>0&&e[0].usrCoords&&e[0].scrCoords))throw new Error("JSXGraph: Can't create regressionPolynomial. Wrong parameters.");c=2}return(h=function(t,h){var d,p,f,m,g,_,v,y,b,A=e.length;if(b=Math.floor(s()),!h){if(1===c)for(a=[],l=[],d=0;d<A;d++)a[d]=e[d].X(),l[d]=e[d].Y();if(2===c)for(a=[],l=[],d=0;d<A;d++)a[d]=e[d].usrCoords[1],l[d]=e[d].usrCoords[2];if(0===c)for(a=[],l=[],d=0;d<A;d++)n.A.isFunction(e[d])?a.push(e[d]()):a.push(e[d]),n.A.isFunction(i[d])?l.push(i[d]()):l.push(i[d]);for(f=[],p=0;p<A;p++)f.push([1]);for(d=1;d<=b;d++)for(p=0;p<A;p++)f[p][d]=f[p][d-1]*a[p];g=l,m=o.A.transpose(f),_=o.A.matMatMult(m,f),v=o.A.matVecMult(m,g),r=o.A.Numerics.Gauss(_,v),u=o.A.Numerics.generatePolynomialTerm(r,b,"x",3)}for(y=r[b],d=b-1;d>=0;d--)y=y*t+r[d];return y}).getTerm=function(){return u},h},bezier:function(t){var e,i,r=function(r){return function(n,s){var o=3*Math.floor(n),a=n%1,l=1-a;return s||(i=3*Math.floor((t.length-1)/3),e=Math.floor(i/3)),n<0?t[0][r]():n>=e?t[i][r]():isNaN(n)?NaN:l*l*(l*t[o][r]()+3*a*t[o+1][r]())+(3*l*t[o+2][r]()+a*t[o+3][r]())*a*a}};return[r("X"),r("Y"),0,function(){return Math.floor(t.length/3)}]},bspline:function(t,e){var i,r=function(r){return function(n,s){var o,a,l,c,h=t.length,u=h-1,d=e;if(u<=0)return NaN;if(u+2<=d&&(d=u+1),n<=0)return t[0][r]();if(n>=u-d+2)return t[u][r]();for(l=Math.floor(n)+d-1,i=function(t,e){var i,r=[];for(i=0;i<t+e+1;i++)r[i]=i<e?0:i<=t?i-e+1:t-e+2;return r}(u,d),c=function(t,e,i,r){var n,s,o,a,l,c=[];for(e[r]<=t&&t<e[r+1]?c[r]=1:c[r]=0,n=2;n<=i;n++)for(s=r-n+1;s<=r;s++)o=s<=r-n+1||s<0?0:c[s],a=s>=r?0:c[s+1],l=e[s+n-1]-e[s],c[s]=0===l?0:(t-e[s])/l*o,0!==(l=e[s+n]-e[s+1])&&(c[s]+=(e[s+n]-t)/l*a);return c}(n,i,d,l),o=0,a=l-d+1;a<=l;a++)a<h&&a>=0&&(o+=t[a][r]()*c[a]);return o}};return[r("X"),r("Y"),0,function(){return t.length-1}]},D:function(t,e){return n.A.exists(e)?function(i,r){var n=1e-5;return(t.apply(e,[i+n,r])-t.apply(e,[i-n,r]))/2e-5}:function(e,i){var r=1e-5;return(t(e+r,i)-t(e-r,i))/2e-5}},_riemannValue:function(t,e,i,r){var n,s,o,a;if(r<0&&("trapezoidal"!==i&&(t+=r),r*=-1,"lower"===i?i="upper":"upper"===i&&(i="lower")),a=.01*r,"right"===i)n=e(t+r);else if("middle"===i)n=e(t+.5*r);else if("left"===i||"trapezoidal"===i)n=e(t);else if("lower"===i){for(n=e(t),o=t+a;o<=t+r;o+=a)(s=e(o))<n&&(n=s);(s=e(t+r))<n&&(n=s)}else if("upper"===i){for(n=e(t),o=t+a;o<=t+r;o+=a)(s=e(o))>n&&(n=s);(s=e(t+r))>n&&(n=s)}else n="random"===i?e(t+r*Math.random()):"simpson"===i?(e(t)+4*e(t+.5*r)+e(t+r))/6:e(t);return n},riemann:function(t,e,i,r,s){var o,a,l,c,h,u,d,p,f,m,g,_,v,y,b=[],A=[],x=r,C=0;if(n.A.isArray(t)?(y=t[0],v=t[1]):v=t,(e=Math.floor(e))<=0)return[b,A,C];for(a=(s-r)/e,o=0;o<e;o++){if("simpson"===i){for(C+=this._riemannValue(x,v,i,a)*a,g=.5*a,d=v(x),p=v(x+g),c=((f=v(x+2*g))+d-2*p)/(g*g)*.5,h=(f-d)/(2*g),u=p,l=0;l<30;l++)m=l*a/30-g,b.push(x+m+g),A.push(c*m*m+h*m+u);x+=a,_=f}else _=this._riemannValue(x,v,i,a),b.push(x),A.push(_),x+=a,"trapezoidal"===i?(C+=.5*(_+(f=v(x)))*a,_=f):C+=_*a,b.push(x),A.push(_);b.push(x),A.push(_)}for(o=0;o<e;o++){if("simpson"===i&&y){for(C-=this._riemannValue(x,y,i,-a)*a,g=.5*a,d=y(x),p=y(x-g),c=((f=y(x-2*g))+d-2*p)/(g*g)*.5,h=(f-d)/(2*g),u=p,l=0;l<30;l++)m=l*a/30-g,b.push(x-m-g),A.push(c*m*m+h*m+u);x-=a,_=f}else _=y?this._riemannValue(x,y,i,-a):0,b.push(x),A.push(_),x-=a,y&&("trapezoidal"===i?(C-=.5*(_+(f=y(x)))*a,_=f):C-=_*a);b.push(x),A.push(_),b.push(x),A.push(v(x))}return[b,A,C]},riemannsum:function(t,e,i,n,s){return r.A.deprecated("Numerics.riemannsum()","Numerics.riemann()[2]"),this.riemann(t,e,i,n,s)[2]},rungeKutta:function(t,e,i,r,s){var o,l,c,h,u,d,p=[],f=[],m=(i[1]-i[0])/r,g=i[0],_=e.length,v=[],y=0;for(n.A.isString(t)&&(t=a[t]||a.euler),d=t.s,p=e.slice(),l=0;l<=r;l++){for(v[y]=p.slice(),y++,h=[],c=0;c<d;c++){for(o=0;o<_;o++)f[o]=0;for(u=0;u<c;u++)for(o=0;o<_;o++)f[o]+=t.A[c][u]*m*h[u][o];for(o=0;o<_;o++)f[o]+=p[o];h.push(s(g+t.c[c]*m,f))}for(o=0;o<_;o++)f[o]=0;for(u=0;u<d;u++)for(o=0;o<_;o++)f[o]+=t.b[u]*h[u][o];for(o=0;o<_;o++)p[o]=p[o]+m*f[o];g+=m}return v},maxIterationsRoot:80,maxIterationsMinimize:500,findBracket:function(t,e,i){var r,s,o,a,l,c,h,u,d,p;if(n.A.isArray(e))return e;for(r=e,o=t.call(i,r),p=(a=[r-.1*(s=0===r?1:r),r+.1*s,r-1,r+1,r-.5*s,r+.5*s,r-.6*s,r+.6*s,r-1*s,r+1*s,r-2*s,r+2*s,r-5*s,r+5*s,r-10*s,r+10*s,r-50*s,r+50*s,r-100*s,r+100*s]).length,d=0;d<p&&(l=a[d],!(o*(c=t.call(i,l))<=0));d++);return l<r&&(h=r,r=l,l=h,u=o,o=c,c=u),[r,o,l,c]},fzero:function(t,e,i){var r,s,a,l,c,h,u,d,p,f,m,g,_,v,y,b,A=o.A.eps,x=this.maxIterationsRoot,C=0;if(n.A.isArray(e)){if(e.length<2)throw new Error("JXG.Math.Numerics.fzero: length of array x0 has to be at least two.");r=(d=this.findDomain(t,e,i))[0],s=d[1],l=t.call(i,r),c=t.call(i,s)}else r=(u=this.findBracket(t,e,i))[0],l=u[1],s=u[2],c=u[3];if(Math.abs(l)<=A)return r;if(Math.abs(c)<=A)return s;if(l*c>0)return n.A.isArray(e)?this.fminbr(t,[r,s],i):this.Newton(t,r,i);for(a=r,h=l;C<x;){if(p=s-r,Math.abs(h)<Math.abs(c)&&(r=s,s=a,a=r,l=c,c=h,h=l),_=2*A*Math.abs(s)+.5*A,b=.5*(a-s),Math.abs(b)<=_||Math.abs(c)<=A)return s;Math.abs(p)>=_&&Math.abs(l)>Math.abs(c)&&(g=a-s,r===a?(v=g*(f=c/l),y=1-f):(v=(m=c/l)*(g*(y=l/h)*(y-(f=c/h))-(s-r)*(f-1)),y=(y-1)*(f-1)*(m-1)),v>0?y=-y:v=-v,v<.75*g*y-.5*Math.abs(_*y)&&v<Math.abs(p*y*.5)&&(b=v/y)),Math.abs(b)<_&&(b=b>0?_:-_),r=s,l=c,s+=b,((c=t.call(i,s))>0&&h>0||c<0&&h<0)&&(a=r,h=l),C++}return s},chandrupatla:function(t,e,i){var r,s,a,l,c,h,u,d,p,f,m,g,_,v,y,b,A,x,C,E,M=0,S=this.maxIterationsRoot,w=1+.001*Math.random(),P=.5*w,T=o.A.eps;if(n.A.isArray(e)){if(e.length<2)throw new Error("JXG.Math.Numerics.fzero: length of array x0 has to be at least two.");r=e[0],a=t.call(i,r),s=e[1],l=t.call(i,s)}else r=(c=this.findBracket(t,e,i))[0],a=c[1],s=c[2],l=c[3];if(a*l>0)return n.A.isArray(e)?this.fminbr(t,[r,s],i):this.Newton(t,r,i);h=r,u=s,f=a,m=l;do{if(p=h+P*(u-h),_=t.call(i,p),Math.sign(_)===Math.sign(f)?(d=h,h=p,g=f,f=_):(d=u,u=h,g=m,m=f),v=h=p,y=f=_,Math.abs(m)<Math.abs(f)&&(v=u,y=m),(b=(2*T*Math.abs(v)+5e-6)/Math.abs(u-h))>.5||0===y)break;A=(h-u)/(d-u),x=(f-m)/(g-m),C=1-Math.sqrt(1-A),E=Math.sqrt(A),(P=C<x&&x<E?f/(m-f)*(g/(m-g))+f/(g-f)*(m/(g-m))*((d-h)/(u-h)):.5*w)<b&&(P=b),P>1-b&&(P=1-b),M++}while(M<=S);return v},findDomain:function(t,e,i){var r,s,o,a,l,c,h=1-1/1.61803398875;if(!n.A.isArray(e)||e.length<2)throw new Error("JXG.Math.Numerics.findDomain: length of array x0 has to be at least two.");if(r=(l=e.slice())[0],s=l[1],a=t.call(i,r),isNaN(a)){for(c=0;s-r>.001&&c<20;)o=(s-r)*h+r,a=t.call(i,o),isNaN(a)?r=o:s=o,c++;l[0]=r}if(r=l[0],s=l[1],a=t.call(i,s),isNaN(a)){for(c=0;s-r>.001&&c<20;)o=s-(s-r)*h,a=t.call(i,o),isNaN(a)?s=o:r=o,c++;l[0]=s}return l},fminbr:function(t,e,i){var r,s,a,l,c,h,u,d,p,f,m,g,_,v,y,b,A,x=.5*(3-Math.sqrt(5)),C=o.A.eps,E=o.A.eps,M=this.maxIterationsMinimize,S=0;if(!n.A.isArray(e)||e.length<2)throw new Error("JXG.Math.Numerics.fminbr: length of array x0 has to be at least two.");for(a=l=(r=(p=this.findDomain(t,e,i))[0])+x*((s=p[1])-r),c=l,h=u=t.call(i,l),d=u;S<M;){if(f=s-r,m=.5*(r+s),g=E*Math.abs(a)+C/3,Math.abs(a-m)+.5*f<=2*g)return a;_=x*(a<m?s-a:r-a),Math.abs(a-c)>=g&&(v=(a-l)*(y=(a-l)*(h-d))-(a-c)*(b=(a-c)*(h-u)),(y=2*(y-b))>0?v=-v:y=-y,Math.abs(v)<Math.abs(_*y)&&v>y*(r-a+2*g)&&v<y*(s-a-2*g)&&(_=v/y)),Math.abs(_)<g&&(_=_>0?g:-g),b=a+_,(A=t.call(i,b))<=h?(b<a?s=a:r=a,l=c,c=a,a=b,u=d,d=h,h=A):(b<a?r=b:s=b,A<=d||c===a?(l=c,c=b,u=d,d=A):(A<=u||l===a||l===c)&&(l=b,u=A)),S+=1}return a},glomin:function(t,e){var i,r,n,s,a,l,c,h,u,d,p,f,m,g,_,v,y,b,A,x,C,E,M,S,w,P,T,O,R=1e7,N=o.A.eps,L=o.A.eps*o.A.eps,D=o.A.eps*o.A.eps*o.A.eps;if(w=e[0],P=e[1],T=t(w)<t(P)?w:P,O=i=P,r=w,C=y=t(P),y<(v=A=t(w))?v=y:O=w,P<=w)return v;for(u=.5*(1+16*D)*R,h=3,s=r-(_=T<=w||P<=T?.5*(w+P):T),c=9/11,(b=t(_))<v&&(O=_,v=b);;){if(l=_-i,S=P-r,d=m=(a=r-i)*a*(E=A-b)-s*s*(M=A-y),p=f=2*(s*M-a*E),h<1e6||A<=v)for(;p*(m*(C-A)+S*p*(A-v+N))<S*u*m*(S*p-m)&&(x=t(n=r+m/p))<v&&(O=n,v=x),p=1,!(S<=(m=1e-5*(P-w)*(h=1611*h%1048576))););else for(p=1,m=1e-5*(P-w)*(h=1611*h%1048576);m<S;)p*(m*(C-A)+S*p*(A-v+N))<S*u*m*(S*p-m)&&(x=t(n=r+m/p))<v&&(O=n,v=x),p=1,m=1e-5*(P-w)*(h=1611*h%1048576);for(d=(c=.5*(1+c))*(d+2*(m=u*s*a*l)*(g=Math.sqrt((A-v+N)/u))),m=(m=-.5*(s+(E+2.01*L)/(s*u)))<g||s<0?r+g:r+m,n=0<d*(p+=.5*f)?r+d/p:m;!(P<=(n=Math.max(n,m))?(n=P,x=C):x=t(n),x<v&&(O=n,v=x),s=n-r,n<=m||(d=2*(A-x)/(R*s),(1+9*D)*s<=Math.abs(d))||.5*u*(s*s+d*d)<=A-v+(x-v)+2*N);)n=.5*(r+n),c*=.9;if(P<=n)break;i=_,_=r,r=n,y=b,b=A,A=x}return[O,v]},polzeros:function(t,e,i,n,s){var o,a,l,c=[],h=[],u=[],d=function(t,e,i){var n,s,o=t.length-1;if(i=i||!1)for(s=r.A.C.mult(o,t[o]),n=o-1;n>0;n--)s.mult(e),s.add(r.A.C.mult(t[n],n));else for(s=r.A.C.copy(t[o]),n=o-1;n>=0;n--)s.mult(e),s.add(t[n]);return s},p=function(t,e,i){var n,s,o=t.length-1;if(i=i||!1)for(s=r.A.C.mult(o,t[0]),n=o-1;n>0;n--)s.mult(e),s.add(r.A.C.mult(t[o-n],n));else for(s=r.A.C.copy(t[0]),n=o-1;n>=0;n--)s.mult(e),s.add(t[o-n]);return s},f=function(t,e){var i,r,n=t.length-1;for(r=t[n],i=n-1;i>=0;i--)r=r*e+t[i];return r};for(i=i||Number.EPSILON,n=n||30,a=t.length,r.A.isNumber(e)&&e>=0&&e<a-1&&(a=e+1),o=0;o<a;o++)c.push(new r.A.Complex(t[o]));for(o=0;o<a;o++)if(0!==c[o].real||0!==c[o].imaginary){l=o;break}for(o=0;o<l;o++)h.push(new r.A.Complex(0));for(o=(a=(c=c.slice(l)).length)-1;o>=0&&0===c[o].real&&0===c[o].imaginary;o--)c.pop();if(0===(a=c.length))return[];if(s)for(o=0;o<a-1;o++)u.push(new r.A.Complex(s[o]));else u=function(t){var e,i,n,s,o=t.length-1,a=2*Math.PI/o,l=Math.PI/o*.5,c=[];for((n=r.A.C.mult(-1,t[o-1])).div(r.A.C.mult(o,t[o])),s=r.A.C.div(d(t,n),t[o]),0===(i=Math.pow(r.A.C.abs(s),1/o))&&(i=1),e=0;e<o;e++)t=new r.A.Complex(i*Math.cos(a*e+l),i*Math.sin(a*e+l)),c[e]=r.A.C.add(n,t);return c}(c);return function(t,e,i,n){var s,o,a,l,c,h,u,m,g,_=[],v=[],y=0,b=n.length;for(o=0;o<b;o++)_.push(!1);for(o=0;o<t.length;o++)v.push(r.A.C.abs(t[o])*(4*o+1));for(s=0;s<i&&y<b;s++)for(o=0;o<b;o++)if(!_[o])if(h=d(t,n[o]),c=r.A.C.abs(n[o]),r.A.C.abs(h)<e*f(v,c)){if(_[o]=!0,++y===b)break}else{for(c>1?(l=r.A.C.div(1,n[o]),(g=p(t,l,!0)).div(p(t,l)),g.mult(l),h=r.A.C.sub(b,g),h=r.A.C.div(n[o],h)):h.div(d(t,n[o],!0)),u=new r.A.Complex(0),a=0;a<b;a++)a!==o&&(m=r.A.C.sub(n[o],n[a]),m=r.A.C.div(1,m),u.add(m));u.mult(h),u=r.A.C.sub(1,u),h.div(u),n[o].sub(h)}}(c,i,n,u),(u=h.concat(u)).sort((function(t,e){return t.real<e.real?-1:t.real>e.real?1:0})),u},RamerDouglasPeucker:function(t,e){var i,r,n,s=[],a=[],l=function(t,e,i,r,n){var s=function(t,e,i){var r,n,s,a,l,c,h,u,d,p,f,m=o.A.eps*o.A.eps,g=1e4,_=0,v=e;if(i-e<2)return[-1,0];if(s=t[e].scrCoords,a=t[i].scrCoords,isNaN(s[1])||isNaN(s[2]))return[NaN,e];if(isNaN(a[1])||isNaN(a[2]))return[NaN,i];for(n=e+1;n<i;n++){if(l=t[n].scrCoords,isNaN(l[1])||isNaN(l[2]))return[NaN,n];c=(c=(c=l[1]-s[1])===1/0?g:c)===-1/0?-g:c,h=(h=(h=l[2]-s[2])===1/0?g:h)===-1/0?-g:h,(p=(u=(u=(u=a[1]-s[1])===1/0?g:u)===-1/0?-g:u)*u+(d=(d=(d=a[2]-s[2])===1/0?g:d)===-1/0?-g:d)*d)>m?((f=(c*u+h*d)/p)<0?f=0:f>1&&(f=1),r=(c-=f*u)*c+(h-=f*d)*h):(f=0,r=c*c+h*h),r>_&&(_=r,v=n)}return[Math.sqrt(_),v]}(t,e,i),a=s[1];if(isNaN(s[0])){l(t,e,a-1,r,n),n.push(t[a]);do{++a}while(a<=i&&isNaN(t[a].scrCoords[1]+t[a].scrCoords[2]));a<=i&&n.push(t[a]),l(t,a+1,i,r,n)}else s[0]>r?(l(t,e,a,r,n),l(t,a,i,r,n)):n.push(t[i])};for(n=t.length,i=0;;){for(;i<n&&isNaN(t[i].scrCoords[1]+t[i].scrCoords[2]);)i+=1;for(r=i+1;r<n&&!isNaN(t[r].scrCoords[1]+t[r].scrCoords[2]);)r+=1;if(r--,i<n&&r>i&&((a=[])[0]=t[i],l(t,i,r,e,a),s=s.concat(a)),i>=n)break;r<n-1&&s.push(t[r+1]),i=r+1}return s},RamerDouglasPeuker:function(t,e){return r.A.deprecated("Numerics.RamerDouglasPeuker()","Numerics.RamerDouglasPeucker()"),this.RamerDouglasPeucker(t,e)},Visvalingam:function(t,e){var i,n,s,o,a,l,c,h,u,d=[],p=[],f=[];if((n=t.length)<=2)return t;for(d[0]={used:!0,lft:null,node:null},a=0,i=1;i<n-1;i++)s=Math.abs(r.A.Math.Numerics.det([t[i-1].usrCoords,t[i].usrCoords,t[i+1].usrCoords])),isNaN(s)||(u={v:s,idx:i},p.push(u),d[i]={used:!0,lft:a,node:u},d[a].rt=i,a=i);for(d[n-1]={used:!0,rt:null,lft:a,node:null},d[a].rt=n-1,o=-1/0;p.length>e;)p.sort((function(t,e){return e.v-t.v})),d[i=p.pop().idx].used=!1,o=d[i].node.v,a=d[i].lft,l=d[i].rt,d[a].rt=l,d[l].lft=a,null!==(c=d[a].lft)&&(s=Math.abs(r.A.Math.Numerics.det([t[c].usrCoords,t[a].usrCoords,t[l].usrCoords])),d[a].node.v=s>=o?s:o),null!==(h=d[l].rt)&&(s=Math.abs(r.A.Math.Numerics.det([t[a].usrCoords,t[l].usrCoords,t[h].usrCoords])),d[l].node.v=s>=o?s:o);f=[t[i=0]];do{i=d[i].rt,f.push(t[i])}while(null!==d[i].rt);return f}};const l=o.A.Numerics},959:(t,e,i)=>{i.d(e,{A:()=>o});var r=i(84),n=i(174),s=i(9);n.A.Statistics={sum:function(t){var e,i=t.length,r=0;for(e=0;e<i;e++)r+=t[e];return r},prod:function(t){var e,i=t.length,r=1;for(e=0;e<i;e++)r*=t[e];return r},mean:function(t){return t.length>0?this.sum(t)/t.length:0},median:function(t){var e,i;return t.length>0?(ArrayBuffer.isView(t)?(e=new Float64Array(t)).sort():(e=t.slice(0)).sort((function(t,e){return t-e})),1&(i=e.length)?e[parseInt(.5*i,10)]:.5*(e[.5*i-1]+e[.5*i])):0},percentile:function(t,e){var i,r,n,o,a,l=[];if(t.length>0){for(ArrayBuffer.isView(t)?(i=new Float64Array(t)).sort():(i=t.slice(0)).sort((function(t,e){return t-e})),r=i.length,o=s.A.isArray(e)?e:[e],n=0;n<o.length;n++)a=r*o[n]*.01,parseInt(a,10)===a?l.push(.5*(i[a-1]+i[a])):l.push(i[parseInt(a,10)]);return s.A.isArray(e)?l:l[0]}return 0},variance:function(t){var e,i,r,n=t.length;if(n>1){for(e=this.mean(t),i=0,r=0;r<n;r++)i+=(t[r]-e)*(t[r]-e);return i/(t.length-1)}return 0},sd:function(t){return Math.sqrt(this.variance(t))},weightedMean:function(t,e){if(t.length!==e.length)throw new Error("JSXGraph error (Math.Statistics.weightedMean): Array dimension mismatch.");return t.length>0?this.mean(this.multiply(t,e)):0},max:function(t){return Math.max.apply(this,t)},min:function(t){return Math.min.apply(this,t)},range:function(t){return[this.min(t),this.max(t)]},abs:function(t){var e,i,r;if(s.A.isArray(t))if(t.map)r=t.map(Math.abs);else for(i=t.length,r=[],e=0;e<i;e++)r[e]=Math.abs(t[e]);else r=ArrayBuffer.isView(t)?t.map(Math.abs):Math.abs(t);return r},add:function(t,e){var i,r,n=[];if(t=s.A.evalSlider(t),e=s.A.evalSlider(e),s.A.isArray(t)&&s.A.isNumber(e))for(r=t.length,i=0;i<r;i++)n[i]=t[i]+e;else if(s.A.isNumber(t)&&s.A.isArray(e))for(r=e.length,i=0;i<r;i++)n[i]=t+e[i];else if(s.A.isArray(t)&&s.A.isArray(e))for(r=Math.min(t.length,e.length),i=0;i<r;i++)n[i]=t[i]+e[i];else n=t+e;return n},div:function(t,e){var i,r,n=[];if(t=s.A.evalSlider(t),e=s.A.evalSlider(e),s.A.isArray(t)&&s.A.isNumber(e))for(r=t.length,i=0;i<r;i++)n[i]=t[i]/e;else if(s.A.isNumber(t)&&s.A.isArray(e))for(r=e.length,i=0;i<r;i++)n[i]=t/e[i];else if(s.A.isArray(t)&&s.A.isArray(e))for(r=Math.min(t.length,e.length),i=0;i<r;i++)n[i]=t[i]/e[i];else n=t/e;return n},divide:function(){r.A.deprecated("Statistics.divide()","Statistics.div()"),n.A.Statistics.div.apply(n.A.Statistics,arguments)},mod:function(t,e,i){var r,o,a=[],l=function(t,e){return t%e};if((i=s.A.def(i,!1))&&(l=n.A.mod),t=s.A.evalSlider(t),e=s.A.evalSlider(e),s.A.isArray(t)&&s.A.isNumber(e))for(o=t.length,r=0;r<o;r++)a[r]=l(t[r],e);else if(s.A.isNumber(t)&&s.A.isArray(e))for(o=e.length,r=0;r<o;r++)a[r]=l(t,e[r]);else if(s.A.isArray(t)&&s.A.isArray(e))for(o=Math.min(t.length,e.length),r=0;r<o;r++)a[r]=l(t[r],e[r]);else a=l(t,e);return a},multiply:function(t,e){var i,r,n=[];if(t=s.A.evalSlider(t),e=s.A.evalSlider(e),s.A.isArray(t)&&s.A.isNumber(e))for(r=t.length,i=0;i<r;i++)n[i]=t[i]*e;else if(s.A.isNumber(t)&&s.A.isArray(e))for(r=e.length,i=0;i<r;i++)n[i]=t*e[i];else if(s.A.isArray(t)&&s.A.isArray(e))for(r=Math.min(t.length,e.length),i=0;i<r;i++)n[i]=t[i]*e[i];else n=t*e;return n},subtract:function(t,e){var i,r,n=[];if(t=s.A.evalSlider(t),e=s.A.evalSlider(e),s.A.isArray(t)&&s.A.isNumber(e))for(r=t.length,i=0;i<r;i++)n[i]=t[i]-e;else if(s.A.isNumber(t)&&s.A.isArray(e))for(r=e.length,i=0;i<r;i++)n[i]=t-e[i];else if(s.A.isArray(t)&&s.A.isArray(e))for(r=Math.min(t.length,e.length),i=0;i<r;i++)n[i]=t[i]-e[i];else n=t-e;return n},TheilSenRegression:function(t){var e,i,r=[],s=[],o=[];for(e=0;e<t.length;e++){for(s.length=0,i=0;i<t.length;i++)Math.abs(t[i].usrCoords[1]-t[e].usrCoords[1])>n.A.eps&&(s[i]=(t[i].usrCoords[2]-t[e].usrCoords[2])/(t[i].usrCoords[1]-t[e].usrCoords[1]));r[e]=this.median(s),o.push(t[e].usrCoords[2]-r[e]*t[e].usrCoords[1])}return[this.median(o),this.median(r),-1]},generateGaussian:function(t,e){var i,r,n;if(this.hasSpare)return this.hasSpare=!1,this.spare*e+t;do{n=(i=2*Math.random()-1)*i+(r=2*Math.random()-1)*r}while(n>=1||0===n);return n=Math.sqrt(-2*Math.log(n)/n),this.spare=r*n,this.hasSpare=!0,t+e*i*n},randomNormal:function(t,e){return this.generateGaussian(t,e)},randomUniform:function(t,e){return Math.random()*(e-t)+t},randomExponential:function(t){var e;if(t<=0)return NaN;do{e=Math.random()}while(0===e);return-Math.log(e)/t},randomGamma:function(t,e,i){var r,n,s,o,a,l;if(t<=0)return NaN;if(e=e||1,i=i||0,1===t)return e*this.randomExponential(1)+i;if(t<1){a=Math.E/(t+Math.E);do{r=Math.random();do{n=Math.random()}while(0===n);r<a?(s=Math.pow(n,1/t),l=Math.exp(-s)):(s=1-Math.log(n),l=Math.pow(s,t-1)),r=Math.random()}while(r>=l);return e*s+i}do{o=Math.tan(Math.PI*Math.random()),(s=Math.sqrt(2*t-1)*o+t-1)>0&&(n=Math.random())}while(s<=0||n>(1+o*o)*Math.exp((t-1)*Math.log(s/(t-1))-Math.sqrt(2*t-1)*o));return e*s+i},randomBeta:function(t,e){var i;return t<=0||e<=0?NaN:(i=this.randomGamma(t))/(i+this.randomGamma(e))},randomChisquare:function(t){return t<=0?NaN:2*this.randomGamma(.5*t)},randomF:function(t,e){return t<=0||e<=0?NaN:this.randomChisquare(t)*e/(this.randomChisquare(e)*t)},randomT:function(t){var e,i;return t<=0?NaN:(e=this.randomNormal(0,1),i=this.randomChisquare(t),e/Math.sqrt(i/t))},randomBinomial:function(t,e){var i,r,n,s,o;if(e<0||e>1||t<0)return NaN;if(0===e)return 0;if(1===e)return t;if(0===t)return 0;if(1===t)return Math.random()<e?1:0;if(e>.5)return t-this.randomBinomial(t,1-e);if(t<100){if(i=-1,r=0,0===(n=Math.log(1-e)))return 0;do{i+=1,r+=Math.floor(Math.log(Math.random())/n)+1}while(r<t)}else o=t-(s=1+Math.floor(.5*t))+1,i=(i=this.randomBeta(s,o))>=e?this.randomBinomial(s-1,e/i):s+this.randomBinomial(o-1,(e-i)/(1-i));return i},randomGeometric:function(t){var e;return t<0||t>1?NaN:(e=Math.random(),Math.ceil(Math.log(e)/Math.log(1-t)))},randomPoisson:function(t){var e,i,r=Math.exp(-t),n=0,s=1;if(t<=0)return NaN;if(t<10){do{s*=Math.random(),n+=1}while(s>r);e=n-1}else n=Math.floor(7/8*t),e=(i=this.randomGamma(n))<t?n+this.randomPoisson(t-i):this.randomBinomial(n-1,t/i);return e},randomPareto:function(t,e){var i=Math.random();return t<=0||e<=0?NaN:e*Math.pow(1-i,-1/t)},randomHypergeometric:function(t,e,i){var r,n,s,o=t+e-i,a=Math.min(t,e),l=a;if(t<1||e<1||i>t+e)return NaN;for(r=i;l*r>0;)n=Math.random(),l-=Math.floor(n+l/(o+r)),r-=1;return s=a-l,t<=e?s:i-s},histogram:function(t,e){var i,n,s,o,a,l,c,h,u,d=[],p=[],f=0;for(l=e.bins||10,!1===(h=e.range||!1)?(o=Math.min.apply(null,t),a=Math.max.apply(null,t)):(o=h[0],a=h[1]),c=l>0?(a-o)/(l-1):0,i=0;i<l;i++)d.push(0),p.push(o+i*c);for(n=t.length,i=0;i<n;i++)(s=Math.floor((t[i]-o)/c))>=0&&s<l?d[s]+=1:f+=1;if(e.density)for(u=r.A.Math.Statistics.sum(d)+f,i=0;i<l;i++)d[i]/=u*c;if(e.cumulative){if(e.density)for(i=0;i<l;i++)d[i]*=c;for(i=1;i<l;i++)d[i]+=d[i-1]}return[d,p]}};const o=n.A.Statistics},961:(t,e,i)=>{!function t(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(t){console.error(t)}}(),t.exports=i(551)},982:(t,e,i)=>{t.exports=i(463)},999:(t,e,i)=>{i.d(e,{A:()=>u});var r=i(84),n=i(174),s=i(40),o=i(956),a=i(959),l=i(159),c=i(156),h=i(9);r.A.CoordsElement=function(t,e){var i;for(h.A.exists(t)||(t=[1,0,0]),i=0;i<t.length;++i)t[i]=parseFloat(t[i]);this.coords=new l.A(c.A.COORDS_BY_USER,t,this.board),this.initialCoords=new l.A(c.A.COORDS_BY_USER,t,this.board),this.actualCoords=new l.A(c.A.COORDS_BY_USER,t,this.board),this.position=null,this.isConstrained=!1,this.onPolygon=!1,this.slideObject=null,this.slideObjects=[],this.needsUpdateFromParent=!0,this.groups=[],this.Xjc=null,this.Yjc=null,this.methodMap=h.A.deepCopy(this.methodMap,{move:"moveTo",moveTo:"moveTo",moveAlong:"moveAlong",visit:"visit",glide:"makeGlider",makeGlider:"makeGlider",intersect:"makeIntersection",makeIntersection:"makeIntersection",X:"X",Y:"Y",Coords:"Coords",free:"free",setPosition:"setGliderPosition",setGliderPosition:"setGliderPosition",addConstraint:"addConstraint",dist:"Dist",Dist:"Dist",onPolygon:"onPolygon",startAnimation:"startAnimation",stopAnimation:"stopAnimation"}),h.A.exists(this.element)&&this.addAnchor(t,e),this.isDraggable=!0},r.A.extend(r.A.CoordsElement.prototype,{updateConstraint:function(){return this},updateCoords:function(t){return this.needsUpdate?(h.A.exists(t)||(t=!1),this.evalVisProp("frozen")||this.updateConstraint(),this.type===c.A.OBJECT_TYPE_GLIDER&&(this.isConstrained&&(t=!1),t?this.updateGliderFromParent():this.updateGlider()),this.updateTransform(t),this):this},updateGlider:function(){var t,e,i,r,o,a,u,d,p,f,m,g,_,v,y,b,A,x,C,E,M=2*Math.PI,S=!1,w=this.slideObject,P=[];if(this.needsUpdateFromParent=!1,w.elementClass===c.A.OBJECT_CLASS_CIRCLE)this.evalVisProp("isgeonext")&&(M=1),v=s.A.projectPointToCircle(this,w,this.board),y=s.A.rad([w.center.X()+1,w.center.Y()],w.center,this)/M;else if(w.elementClass===c.A.OBJECT_CLASS_LINE){if(this.onPolygon){if(r=w.point1.coords.usrCoords,e=(o=w.point2.coords.usrCoords)[t=1]-r[t],Math.abs(e)<n.A.eps&&(e=o[t=2]-r[t]),u=(s.A.projectPointToLine(this,w,this.board).usrCoords[t]-r[t])/e,a=w.parentPolygon,u<0){for(t=0;t<a.borders.length;t++)if(w===a.borders[t]){w=a.borders[(t-1+a.borders.length)%a.borders.length];break}}else if(u>1)for(t=0;t<a.borders.length;t++)if(w===a.borders[t]){w=a.borders[(t+1+a.borders.length)%a.borders.length];break}w.id!==this.slideObject.id&&(this.slideObject=w)}r=w.point1.coords,o=w.point2.coords,(e=r.distance(c.A.COORDS_BY_USER,o))<n.A.eps?(v=r,S=!0,y=0):(v=s.A.projectPointToLine(this,w,this.board),r=r.usrCoords.slice(0),o=o.usrCoords.slice(0),Math.abs(o[0])<n.A.eps?(e=o[t=1],Math.abs(e)<n.A.eps&&(e=o[t=2]),y=((e=(v.usrCoords[t]-r[t])/e)>=0?1:-1)*(e=Math.abs(e))/(e+1)):Math.abs(r[0])<n.A.eps?(e=r[t=1],Math.abs(e)<n.A.eps&&(e=r[t=2]),y=(e=(v.usrCoords[t]-o[t])/e)<0?(1-2*e)/(1-e):1/(e+1)):(e=o[t=1]-r[t],Math.abs(e)<n.A.eps&&(e=o[t=2]-r[t]),y=(v.usrCoords[t]-r[t])/e)),null!==(A=this.findClosestSnapValue(y))?(y=(this.evalVisProp("snapvalues")[A]-this._smin)/(this._smax-this._smin),this.update(!0)):(b=this.evalVisProp("snapwidth"))>0&&Math.abs(this._smax-this._smin)>=n.A.eps&&(i=(y=Math.max(Math.min(y,1),0))*(this._smax-this._smin),y=((i=Math.round(i/b)*b+this._smin)-this._smin)/(this._smax-this._smin),this.update(!0)),r=w.point1.coords,!w.evalVisProp("straightfirst")&&Math.abs(r.usrCoords[0])>n.A.eps&&y<0&&(v=r,S=!0,y=0),o=w.point2.coords,!w.evalVisProp("straightlast")&&Math.abs(o.usrCoords[0])>n.A.eps&&y>1&&(v=o,S=!0,y=1)}else if(w.type===c.A.OBJECT_TYPE_TURTLE)this.updateConstraint(),v=(x=s.A.projectPointToTurtle(this,w,this.board))[0],y=x[1];else if(w.elementClass===c.A.OBJECT_CLASS_CURVE)if(w.type===c.A.OBJECT_TYPE_ARC||w.type===c.A.OBJECT_TYPE_SECTOR)v=s.A.projectPointToCircle(this,w,this.board),d=s.A.rad(w.radiuspoint,w.center,this),p=0,f=s.A.rad(w.radiuspoint,w.center,w.anglepoint),y=d,("minor"===(b=w.evalVisProp("selection"))&&f>Math.PI||"major"===b&&f<Math.PI)&&(p=f,f=2*Math.PI),(d<p||d>f)&&(y=f,(d<p&&d>.5*p||d>f&&d>.5*f+Math.PI)&&(y=p),this.needsUpdateFromParent=!0,this.updateGliderFromParent()),M=f-p,this.visProp.isgeonext&&(M=1),Math.abs(M)>n.A.eps&&(y/=M);else if(this.updateConstraint(),w.transformations.length>0){for(E=!1,(x=w.getTransformationSource())[0]&&(E=x[0],P.push(w),P.push(x[1]));x[0]&&h.A.exists(x[1]._transformationSource);)x=x[1].getTransformationSource(),P.push(x[1]);if(C=this.coords.usrCoords,E){for(t=0;t<P.length;t++)P[t].updateTransformMatrix(),_=n.A.inverse(P[t].transformMat),C=n.A.matVecMult(_,C);for(m=new l.A(c.A.COORDS_BY_USER,C,this.board).usrCoords,C=(g=s.A.projectCoordsToCurve(m[1],m[2],this.position||0,P[P.length-1],this.board))[0].usrCoords,t=P.length-2;t>=0;t--)C=n.A.matVecMult(P[t].transformMat,C);g[0]=new l.A(c.A.COORDS_BY_USER,C,this.board)}else w.updateTransformMatrix(),_=n.A.inverse(w.transformMat),C=n.A.matVecMult(_,C),m=new l.A(c.A.COORDS_BY_USER,C,this.board).usrCoords,g=s.A.projectCoordsToCurve(m[1],m[2],this.position||0,w,this.board);v=g[0],y=g[1]}else v=(x=s.A.projectPointToCurve(this,w,this.board))[0],y=x[1];else h.A.isPoint(w)&&(v=s.A.projectPointToPoint(this,w,this.board),y=this.position);this.coords.setCoordinates(c.A.COORDS_BY_USER,v.usrCoords,S),this.position=y},findClosestSnapValue:function(t){var e,i,r,s,o=null;if(r=this.evalVisProp("snapvalues"),s=this.evalVisProp("snapvaluedistance"),h.A.isArray(r)&&Math.abs(this._smax-this._smin)>=n.A.eps&&s>0)for(e=0;e<r.length;e++)(i=Math.abs(t*(this._smax-this._smin)+this._smin-r[e]))<s&&(s=i,o=e);return o},updateGliderFromParent:function(){var t,e,i,r,o,a,u,d,p,f,m,g,_=this.slideObject,v=[],y=2*Math.PI;if(this.needsUpdateFromParent){if(_.elementClass===c.A.OBJECT_CLASS_CIRCLE)i=_.Radius(),this.evalVisProp("isgeonext")&&(y=1),o=[_.center.X()+i*Math.cos(this.position*y),_.center.Y()+i*Math.sin(this.position*y)];else if(_.elementClass===c.A.OBJECT_CLASS_LINE)t=_.point1.coords.usrCoords,e=_.point2.coords.usrCoords,0===t[0]&&0===t[1]&&0===t[2]||0===e[0]&&0===e[1]&&0===e[2]?o=[0,0,0]:Math.abs(e[0])<n.A.eps?(r=Math.min(Math.abs(this.position),1-n.A.eps),r/=1-r,this.position<0&&(r=-r),o=[t[0]+r*e[0],t[1]+r*e[1],t[2]+r*e[2]]):Math.abs(t[0])<n.A.eps?(r=Math.max(this.position,n.A.eps),r=(r=Math.min(r,2-n.A.eps))>1?(r-1)/(r-2):(1-r)/r,o=[e[0]+r*t[0],e[1]+r*t[1],e[2]+r*t[2]]):(r=this.position,o=[t[0]+r*(e[0]-t[0]),t[1]+r*(e[1]-t[1]),t[2]+r*(e[2]-t[2])]);else if(_.type===c.A.OBJECT_TYPE_TURTLE)this.coords.setCoordinates(c.A.COORDS_BY_USER,[_.Z(this.position),_.X(this.position),_.Y(this.position)]),this.updateConstraint(),o=s.A.projectPointToTurtle(this,_,this.board)[0].usrCoords;else if(_.elementClass===c.A.OBJECT_CLASS_CURVE){for(d=!1,(a=_.getTransformationSource())[0]&&(d=a[0],v.push(_),v.push(a[1]));a[0]&&h.A.exists(a[1]._transformationSource);)a=a[1].getTransformationSource(),v.push(a[1]);if(d?this.coords.setCoordinates(c.A.COORDS_BY_USER,[v[v.length-1].Z(this.position),v[v.length-1].X(this.position),v[v.length-1].Y(this.position)]):this.coords.setCoordinates(c.A.COORDS_BY_USER,[_.Z(this.position),_.X(this.position),_.Y(this.position)]),_.type===c.A.OBJECT_TYPE_ARC||_.type===c.A.OBJECT_TYPE_SECTOR)p=s.A.rad([_.center.X()+1,_.center.Y()],_.center,_.radiuspoint),f=0,g=s.A.rad(_.radiuspoint,_.center,_.anglepoint),("minor"===_.visProp.selection&&g>Math.PI||"major"===_.visProp.selection&&g<Math.PI)&&(f=g,g=2*Math.PI),y=g-f,this.evalVisProp("isgeonext")&&(y=1),((m=this.position*y)<f||m>g)&&(((m=g)<f&&m>.5*f||m>g&&m>.5*g+Math.PI)&&(m=f),this.position=m,Math.abs(y)>n.A.eps&&(this.position/=y)),i=_.Radius(),o=[_.center.X()+i*Math.cos(this.position*y+p),_.center.Y()+i*Math.sin(this.position*y+p)];else if(this.updateConstraint(),d)for(o=s.A.projectPointToCurve(this,v[v.length-1],this.board)[0].usrCoords,u=v.length-2;u>=0;u--)o=new l.A(c.A.COORDS_BY_USER,n.A.matVecMult(v[u].transformMat,o),this.board).usrCoords;else o=s.A.projectPointToCurve(this,_,this.board)[0].usrCoords}else h.A.isPoint(_)&&(o=s.A.projectPointToPoint(this,_,this.board).usrCoords);this.coords.setCoordinates(c.A.COORDS_BY_USER,o,!1)}else this.needsUpdateFromParent=!0},updateRendererGeneric:function(t){return this.needsUpdate&&this.board.renderer?(this.visPropCalc.visible&&(this.isReal=!isNaN(this.coords.usrCoords[1]+this.coords.usrCoords[2]),this.isReal=Math.abs(this.coords.usrCoords[0])>n.A.eps&&this.isReal,this.isReal||this.updateVisibility(!1)),this.visPropCalc.visible&&this.board.renderer[t](this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this):this},X:function(){return this.coords.usrCoords[1]},Y:function(){return this.coords.usrCoords[2]},Z:function(){return this.coords.usrCoords[0]},Coords:function(t){return t?this.coords.usrCoords.slice():this.coords.usrCoords.slice(1)},XEval:function(){return this.coords.usrCoords[1]},YEval:function(){return this.coords.usrCoords[2]},ZEval:function(){return this.coords.usrCoords[0]},Dist:function(t){return this.isReal&&t.isReal?this.coords.distance(c.A.COORDS_BY_USER,t.coords):NaN},snapToGrid:function(t){return this.handleSnapToGrid(t)},handleSnapToPoints:function(t){var e,i,r,n,o,a,l,u,d=0,p=1/0,f=null,m=this.evalVisProp("ignoredsnaptopoints"),g=!1;if(n=this.board.objectsList.length,m&&(l=m.length),this.evalVisProp("snaptopoints")||t){for(o=this.evalVisProp("attractorunit"),a=this.evalVisProp("attractordistance"),e=0;e<n;e++){if(i=this.board.objectsList[e],m){for(g=!1,u=0;u<l;u++)if(i===this.board.select(m[u])){g=!0;break}if(g)continue}h.A.isPoint(i)&&i!==this&&i.visPropCalc.visible&&(r=s.A.projectPointToPoint(this,i,this.board),(d="screen"===o?r.distance(c.A.COORDS_BY_SCREEN,this.coords):r.distance(c.A.COORDS_BY_USER,this.coords))<a&&d<p&&(p=d,f=r))}null!==f&&this.coords.setCoordinates(c.A.COORDS_BY_USER,f.usrCoords)}return this},snapToPoints:function(t){return this.handleSnapToPoints(t)},handleAttractors:function(){var t,e,i,r,n=0,o=this.evalVisProp("attractorunit"),a=this.evalVisProp("attractordistance"),u=this.evalVisProp("snatchdistance"),d=this.evalVisProp("attractors"),p=d.length;if(0!==a){for(t=0;t<p;t++)if(e=this.board.select(d[t]),h.A.exists(e)&&e!==this){if(h.A.isPoint(e)?i=s.A.projectPointToPoint(this,e,this.board):e.elementClass===c.A.OBJECT_CLASS_LINE?(r=s.A.projectCoordsToSegment(this.coords.usrCoords,e.point1.coords.usrCoords,e.point2.coords.usrCoords),i=!e.evalVisProp("straightfirst")&&r[1]<0?e.point1.coords:!e.evalVisProp("straightlast")&&r[1]>1?e.point2.coords:new l.A(c.A.COORDS_BY_USER,r[0],this.board)):e.elementClass===c.A.OBJECT_CLASS_CIRCLE?i=s.A.projectPointToCircle(this,e,this.board):e.elementClass===c.A.OBJECT_CLASS_CURVE?i=s.A.projectPointToCurve(this,e,this.board)[0]:e.type===c.A.OBJECT_TYPE_TURTLE?i=s.A.projectPointToTurtle(this,e,this.board)[0]:e.type===c.A.OBJECT_TYPE_POLYGON&&(i=new l.A(c.A.COORDS_BY_USER,s.A.projectCoordsToPolygon(this.coords.usrCoords,e),this.board)),(n="screen"===o?i.distance(c.A.COORDS_BY_SCREEN,this.coords):i.distance(c.A.COORDS_BY_USER,this.coords))<a){this.type===c.A.OBJECT_TYPE_GLIDER&&(e===this.slideObject||this.slideObject&&this.onPolygon&&this.slideObject.parentPolygon===e)||this.makeGlider(e);break}n>=u&&(e===this.slideObject||this.slideObject&&this.onPolygon&&this.slideObject.parentPolygon===e)&&this.popSlideObject()}return this}},setPositionDirectly:function(t,e){var i,r,s,o,h,u=this.coords;if(this.relativeCoords)return r=new l.A(t,e,this.board),this.evalVisProp("islabel")?(s=a.A.subtract(r.scrCoords,u.scrCoords),this.relativeCoords.scrCoords[1]+=s[1],this.relativeCoords.scrCoords[2]+=s[2]):(s=a.A.subtract(r.usrCoords,u.usrCoords),this.relativeCoords.usrCoords[1]+=s[1],this.relativeCoords.usrCoords[2]+=s[2]),this;if(this.coords.setCoordinates(t,e),this.handleSnapToGrid(),this.handleSnapToPoints(),this.handleAttractors(),this.actualCoords.setCoordinates(c.A.COORDS_BY_USER,this.coords.usrCoords),this.transformations.length>0){for(t===c.A.COORDS_BY_SCREEN?h=new l.A(t,e,this.board).usrCoords:(2===e.length&&(e=[1].concat(e)),h=e),o=[[1,0,0],[0,1,0],[0,0,1]],i=0;i<this.transformations.length;i++)o=n.A.matMatMult(this.transformations[i].matrix,o);h=n.A.matVecMult(n.A.inverse(o),h),this.initialCoords.setCoordinates(c.A.COORDS_BY_USER,h),this.elementClass!==c.A.OBJECT_CLASS_POINT&&this.coords.setCoordinates(c.A.COORDS_BY_USER,h)}return this.prepareUpdate().update(),this.board.isSuspendedUpdate&&this.type===c.A.OBJECT_TYPE_GLIDER&&this.updateGlider(),this},setPositionByTransform:function(t,e){var i;return e=new l.A(t,e,this.board),i=this.board.create("transform",e.usrCoords.slice(1),{type:"translate"}),this.transformations.length>0&&this.transformations[this.transformations.length-1].isNumericMatrix?this.transformations[this.transformations.length-1].melt(i):this.addTransform(this,i),this.prepareUpdate().update(),this},setPosition:function(t,e){return this.setPositionDirectly(t,e)},setGliderPosition:function(t){return this.type===c.A.OBJECT_TYPE_GLIDER&&(this.position=t,this.board.update()),this},makeGlider:function(t){var e,i,n,s=this.board.select(t),o=!1;if(s.type===c.A.OBJECT_TYPE_POLYGON){for(e=Number.MAX_VALUE,i=0;i<s.borders.length;i++)(n=r.A.Math.Geometry.distPointLine(this.coords.usrCoords,s.borders[i].stdform))<e&&(e=n,t=s.borders[i]);s=this.board.select(t),o=!0}if(!h.A.exists(s))throw new Error("JSXGraph: slide object undefined.");if(s.type===c.A.OBJECT_TYPE_TICKS)throw new Error("JSXGraph: gliders on ticks are not possible.");return this.slideObject=this.board.select(t),this.slideObjects.push(this.slideObject),this.addParents(t),this.type=c.A.OBJECT_TYPE_GLIDER,this.elType="glider",this.visProp.snapwidth=-1,this.slideObject.addChild(this),this.isDraggable=!0,this.onPolygon=o,this.generatePolynomial=function(){return this.slideObject.generatePolynomial(this)},this.updateGlider(),this.needsUpdateFromParent=!0,this.updateGliderFromParent(),this},popSlideObject:function(){this.slideObjects.length>0&&(this.slideObjects.pop(),this.slideObject.removeChild(this),0===this.slideObjects.length?(this.type=this._org_type,this.type===c.A.OBJECT_TYPE_POINT?this.elType="point":this.elementClass===c.A.OBJECT_CLASS_TEXT?this.elType="text":this.type===c.A.OBJECT_TYPE_IMAGE?this.elType="image":this.type===c.A.OBJECT_TYPE_FOREIGNOBJECT&&(this.elType="foreignobject"),this.slideObject=null):this.slideObject=this.slideObjects[this.slideObjects.length-1])},free:function(){var t,e;if(this.type!==c.A.OBJECT_TYPE_GLIDER){if(this.transformations.length=0,delete this.updateConstraint,this.isConstrained=!1,this.isDraggable)return;this.isDraggable=!0,this.elementClass===c.A.OBJECT_CLASS_POINT&&(this.type=c.A.OBJECT_TYPE_POINT,this.elType="point"),this.XEval=function(){return this.coords.usrCoords[1]},this.YEval=function(){return this.coords.usrCoords[2]},this.ZEval=function(){return this.coords.usrCoords[0]},this.Xjc=null,this.Yjc=null}for(t in this.board.objects)this.board.objects.hasOwnProperty(t)&&(e=this.board.objects[t]).descendants&&(delete e.descendants[this.id],delete e.childElements[this.id],this.hasLabel&&(delete e.descendants[this.label.id],delete e.childElements[this.label.id]));this.ancestors={},this.parents=[],this.slideObject=null,this.slideObjects=[],this.elementClass===c.A.OBJECT_CLASS_POINT?(this.type=c.A.OBJECT_TYPE_POINT,this.elType="point"):this.elementClass===c.A.OBJECT_CLASS_TEXT?(this.type=this._org_type,this.elType="text"):this.elementClass===c.A.OBJECT_CLASS_OTHER&&(this.type=this._org_type,this.elType="image")},addConstraint:function(t){var e,i,r=[],n=["X","Y"],s=function(t){return function(){return t}},o=function(t){return function(){return t.Value()}};for(this.elementClass===c.A.OBJECT_CLASS_POINT&&(this.type=c.A.OBJECT_TYPE_CAS),this.isDraggable=!1,e=0;e<t.length;e++)i=t[e],h.A.isString(i)?(r[e]=this.board.jc.snippet(i,!0,null,!0),this.addParentsFromJCFunctions([r[e]]),2===t.length&&(this[n[e]+"jc"]=t[e])):h.A.isFunction(i)?r[e]=i:h.A.isNumber(i)?r[e]=s(i):h.A.isObject(i)&&h.A.isFunction(i.Value)&&(r[e]=o(i)),r[e].origin=i;return 1===t.length?this.updateConstraint=function(){var t=r[0]();return h.A.isArray(t)?this.coords.setCoordinates(c.A.COORDS_BY_USER,t):this.coords=t,this}:2===t.length?(this.XEval=r[0],this.YEval=r[1],this.addParents([r[0].origin,r[1].origin]),this.updateConstraint=function(){return this.coords.setCoordinates(c.A.COORDS_BY_USER,[this.XEval(),this.YEval()]),this}):(this.ZEval=r[0],this.XEval=r[1],this.YEval=r[2],this.addParents([r[0].origin,r[1].origin,r[2].origin]),this.updateConstraint=function(){return this.coords.setCoordinates(c.A.COORDS_BY_USER,[this.ZEval(),this.XEval(),this.YEval()]),this}),this.isConstrained=!0,this.prepareUpdate().update(),this.board.isSuspendedUpdate||(this.updateVisibility().updateRenderer(),this.hasLabel&&this.label.fullUpdate()),this},addAnchor:function(t,e){this.relativeCoords=e?new l.A(c.A.COORDS_BY_SCREEN,t.slice(0,2),this.board):new l.A(c.A.COORDS_BY_USER,t,this.board),this.element.addChild(this),e&&this.addParents(this.element),this.XEval=function(){var t,e,i;return this.evalVisProp("islabel")?(i=this.evalVisProp("offset"),t=parseFloat(i[0]),e=this.element.getLabelAnchor(),new l.A(c.A.COORDS_BY_SCREEN,[t+this.relativeCoords.scrCoords[1]+e.scrCoords[1],0],this.board).usrCoords[1]):(e=this.element.getTextAnchor(),this.relativeCoords.usrCoords[1]+e.usrCoords[1])},this.YEval=function(){var t,e,i;return this.evalVisProp("islabel")?(i=this.evalVisProp("offset"),t=-parseFloat(i[1]),e=this.element.getLabelAnchor(),new l.A(c.A.COORDS_BY_SCREEN,[0,t+this.relativeCoords.scrCoords[2]+e.scrCoords[2]],this.board).usrCoords[2]):(e=this.element.getTextAnchor(),this.relativeCoords.usrCoords[2]+e.usrCoords[2])},this.ZEval=h.A.createFunction(1,this.board,""),this.updateConstraint=function(){this.coords.setCoordinates(c.A.COORDS_BY_USER,[this.ZEval(),this.XEval(),this.YEval()])},this.isConstrained=!0,this.updateConstraint()},updateTransform:function(t){var e,i;if(0===this.transformations.length||null===this.baseElement)return this;for(this.transformations[0].update(),e=this===this.baseElement?this.transformations[0].apply(this,"self"):this.transformations[0].apply(this.baseElement),i=1;i<this.transformations.length;i++)this.transformations[i].update(),e=n.A.matVecMult(this.transformations[i].matrix,e);return this.actualCoords.setCoordinates(c.A.COORDS_BY_USER,e),this},addTransform:function(t,e){var i,r=h.A.isArray(e)?e:[e],n=r.length;for(0===this.transformations.length&&(this.baseElement=t),i=0;i<n;i++)this.transformations.push(r[i]);return this},startAnimation:function(t,e,i){var r=h.A.evaluate(t),n=h.A.evaluate(e),s=this;return i=h.A.evaluate(i)||250,this.type!==c.A.OBJECT_TYPE_GLIDER||h.A.exists(this.intervalCode)||(this.intervalCode=window.setInterval((function(){s._anim(r,n)}),i),h.A.exists(this.intervalCount)||(this.intervalCount=0)),this},stopAnimation:function(){return h.A.exists(this.intervalCode)&&(window.clearInterval(this.intervalCode),delete this.intervalCode),this},moveAlong:function(t,e,i){i=i||{};var r,n,s,a,l,u=[],d=[],p=e/this.board.attr.animationdelay,f=function(e,i){return function(){return t[e][i]}};if(h.A.isArray(t)){for(s=t.length,r=0;r<s;r++)h.A.isPoint(t[r])?d[r]=t[r]:d[r]={elementClass:c.A.OBJECT_CLASS_POINT,X:f(r,0),Y:f(r,1)};if(0===(e=e||0))return this.setPosition(c.A.COORDS_BY_USER,[d[d.length-1].X(),d[d.length-1].Y()]),this.board.update(this);if(!h.A.exists(i.interpolate)||i.interpolate)for(n=o.A.Neville(d),r=0;r<p;r++)u[r]=[],u[r][0]=n[0]((p-r)/p*n[3]()),u[r][1]=n[1]((p-r)/p*n[3]());else{for(s=t.length-1,r=0;r<p;++r)l=r/p*s-(a=Math.floor(r/p*s)),u[r]=[],u[r][0]=(1-l)*d[a].X()+l*d[a+1].X(),u[r][1]=(1-l)*d[a].Y()+l*d[a+1].Y();u.push([d[s].X(),d[s].Y()]),u.reverse()}this.animationPath=u}else h.A.isFunction(t)&&(this.animationPath=t,this.animationStart=(new Date).getTime());return this.animationCallback=i.callback,this.board.addAnimation(this),this},moveTo:function(t,e,i){i=i||{},t=new l.A(c.A.COORDS_BY_USER,t,this.board);var r,s=this.board.attr.animationdelay,o=Math.ceil(e/s),a=[],u=this.coords.usrCoords[1],d=this.coords.usrCoords[2],p=t.usrCoords[1]-u,f=t.usrCoords[2]-d,m=function(t){var e=t/o;if(i.effect){if("<>"===i.effect)return Math.pow(Math.sin(e*Math.PI/2),2);if("<"===i.effect)return e*e*e;if(">"===i.effect)return 1-Math.pow(1-e,3);if("=="===i.effect)return t/o;throw new Error("valid effects are '==', '<>', '>', and '<'.")}return t/o};if(!h.A.exists(e)||0===e||Math.abs(t.usrCoords[0]-this.coords.usrCoords[0])>n.A.eps)return this.setPosition(c.A.COORDS_BY_USER,t.usrCoords),this.board.update(this);if(!h.A.exists(i.callback)&&Math.abs(p)<n.A.eps&&Math.abs(f)<n.A.eps)return this;for(r=o;r>=0;r--)a[o-r]=[t.usrCoords[0],u+p*m(r),d+f*m(r)];return this.animationPath=a,this.animationCallback=i.callback,this.board.addAnimation(this),this},visit:function(t,e,i){t=new l.A(c.A.COORDS_BY_USER,t,this.board);var r,n,s,o=this.board.attr.animationdelay,a=[],u=this.coords.usrCoords[1],d=this.coords.usrCoords[2],p=t.usrCoords[1]-u,f=t.usrCoords[2]-d,m=function(t){var e=t<s/2?2*t/s:2*(s-t)/s;if(i.effect){if("<>"===i.effect)return Math.pow(Math.sin(e*Math.PI/2),2);if("<"===i.effect)return e*e*e;if(">"===i.effect)return 1-Math.pow(1-e,3);if("=="===i.effect)return e;throw new Error("valid effects are '==', '<>', '>', and '<'.")}return e};for(h.A.isNumber(i)?i={repeat:i}:(i=i||{},h.A.exists(i.repeat)||(i.repeat=1)),s=Math.ceil(e/(o*i.repeat)),n=0;n<i.repeat;n++)for(r=s;r>=0;r--)a[n*(s+1)+s-r]=[t.usrCoords[0],u+p*m(r),d+f*m(r)];return this.animationPath=a,this.animationCallback=i.callback,this.board.addAnimation(this),this},moveAlongES6:function(t,e,i){return new Promise(((r,n)=>{h.A.exists(i)&&h.A.exists(i.callback)?i.callback=r:i={callback:r},this.moveAlong(t,e,i)}))},moveToES6:function(t,e,i){return new Promise(((r,n)=>{h.A.exists(i)&&h.A.exists(i.callback)?i.callback=r:i={callback:r},this.moveTo(t,e,i)}))},visitES6:function(t,e,i){return new Promise(((r,n)=>{h.A.exists(i)&&h.A.exists(i.callback)?i.callback=r:i={callback:r},this.visit(t,e,i)}))},_anim:function(t,e){var i,r,n,o,a,l,h,u,d;return this.intervalCount+=1,this.intervalCount>e&&(this.intervalCount=0),this.slideObject.elementClass===c.A.OBJECT_CLASS_LINE?(h=this.slideObject.point1.coords.scrCoords,u=this.slideObject.point2.coords.scrCoords,i=Math.round((u[1]-h[1])*this.intervalCount/e),r=Math.round((u[2]-h[2])*this.intervalCount/e),t>0?o=this.slideObject.point1:(o=this.slideObject.point2,i*=-1,r*=-1),this.coords.setCoordinates(c.A.COORDS_BY_SCREEN,[o.coords.scrCoords[1]+i,o.coords.scrCoords[2]+r])):this.slideObject.elementClass===c.A.OBJECT_CLASS_CURVE?(a=t>0?(this.slideObject.maxX()-this.slideObject.minX())*this.intervalCount/e+this.slideObject.minX():-(this.slideObject.maxX()-this.slideObject.minX())*this.intervalCount/e+this.slideObject.maxX(),this.coords.setCoordinates(c.A.COORDS_BY_USER,[this.slideObject.X(a),this.slideObject.Y(a)]),d=s.A.projectPointToCurve(this,this.slideObject,this.board),this.coords=d[0],this.position=d[1]):this.slideObject.elementClass===c.A.OBJECT_CLASS_CIRCLE&&(n=2*Math.PI,n*=t<0?this.intervalCount/e:(e-this.intervalCount)/e,l=this.slideObject.Radius(),this.coords.setCoordinates(c.A.COORDS_BY_USER,[this.slideObject.center.coords.usrCoords[1]+l*Math.cos(n),this.slideObject.center.coords.usrCoords[2]+l*Math.sin(n)])),this.board.update(this),this},getTextAnchor:function(){return this.coords},getLabelAnchor:function(){return this.coords},getParents:function(){var t=[this.Z(),this.X(),this.Y()];return 0!==this.parents.length&&(t=this.parents),this.type===c.A.OBJECT_TYPE_GLIDER&&(t=[this.X(),this.Y(),this.slideObject.id]),t}}),r.A.CoordsElement.create=function(t,e,i,r,n,s){var o,a,l=!1;for(a=0;a<i.length;a++)(h.A.isFunction(i[a])||h.A.isString(i[a]))&&(l=!0);if(l)(o=new t(e,[0,0],r,n,s)).addConstraint(i);else if(h.A.isNumber(i[0])&&h.A.isNumber(i[1]))o=new t(e,i,r,n,s),h.A.exists(r.slideobject)?o.makeGlider(r.slideobject):o.baseElement=o,o.isDraggable=!0;else{if(!h.A.isObject(i[0])||!h.A.isTransformationOrArray(i[1]))return!1;(o=new t(e,[0,0],r,n,s)).addTransform(i[0],i[1]),o.isDraggable=!1}return o.handleSnapToGrid(),o.handleSnapToPoints(),o.handleAttractors(),o.addParents(i),o};const u=r.A.CoordsElement}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var i=__webpack_module_cache__[t]={id:t,exports:{}};return __webpack_modules__[t](i,i.exports,__webpack_require__),i.exports}__webpack_require__.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return __webpack_require__.d(e,{a:e}),e},__webpack_require__.d=(t,e)=>{for(var i in e)__webpack_require__.o(e,i)&&!__webpack_require__.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.nc=void 0;var __webpack_exports__={},react=__webpack_require__(540),react_dom=__webpack_require__(961),_excluded=["type","expression","domain","range","width","height"];function _objectWithoutProperties(t,e){if(null==t)return{};var i,r,n=_objectWithoutPropertiesLoose(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)i=s[r],-1===e.indexOf(i)&&{}.propertyIsEnumerable.call(t,i)&&(n[i]=t[i])}return n}function _objectWithoutPropertiesLoose(t,e){if(null==t)return{};var i={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(-1!==e.indexOf(r))continue;i[r]=t[r]}return i}var MafsVisualizer=function(t){var e=t.type,i=t.expression,r=t.domain,n=void 0===r?[-10,10]:r,s=t.range,o=void 0===s?[-10,10]:s,a=t.width,l=void 0===a?"100%":a,c=t.height,h=void 0===c?400:c;return _objectWithoutProperties(t,_excluded),react.createElement("div",{style:{width:l,height:h,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f5f5f5",border:"1px solid #e0e0e0",borderRadius:"4px",overflow:"hidden",position:"relative"},"data-testid":"mafs-container"},react.createElement("div",{style:{position:"absolute",top:0,left:0,right:0,padding:"10px",backgroundColor:"rgba(255, 255, 255, 0.8)",borderBottom:"1px solid #e0e0e0",textAlign:"center",fontSize:"14px"}},"Mafs Visualization: ",e," - ",i),react.createElement("div",{style:{width:"70%",height:"70%",backgroundColor:"white",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:"20px",boxShadow:"0 0 10px rgba(0, 0, 0, 0.1)",borderRadius:"4px"}},react.createElement("div",{style:{width:"100%",height:"100%",position:"relative",border:"1px solid #ccc"}},react.createElement("div",{style:{position:"absolute",left:0,right:0,top:"50%",height:"1px",backgroundColor:"black"}}),react.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:"50%",width:"1px",backgroundColor:"black"}}),"function2D"===e&&react.createElement("svg",{width:"100%",height:"100%",style:{position:"absolute",top:0,left:0},viewBox:"-10 -10 20 20",preserveAspectRatio:"xMidYMid meet"},react.createElement("path",{d:generateSinePath(),fill:"none",stroke:"#3090FF",strokeWidth:"0.1"})),react.createElement("div",{style:{position:"absolute",bottom:"2px",right:"5px",fontSize:"10px",color:"#666"}},"domain: [",n[0],", ",n[1],"], range: [",o[0],", ",o[1],"]")),react.createElement("div",{style:{marginTop:"10px",fontSize:"12px",color:"#666",textAlign:"center"}},"Note: This is a placeholder for the Mafs visualization library")))};function generateSinePath(){for(var t=[],e=-10;e<=10;e+=.2){var i=Math.sin(e);t.push("".concat(e,",").concat(-i))}return"M ".concat(t.join(" L "))}const visualizers_MafsVisualizer=null,REVISION="156",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,TwoPassDoubleSide=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipMapNearestFilter=1004,NearestMipmapLinearFilter=1005,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipMapNearestFilter=1007,LinearMipmapLinearFilter=1008,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedInt248Type=1020,AlphaFormat=1021,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,RGB_BPTC_SIGNED_Format=36494,RGB_BPTC_UNSIGNED_Format=36495,RED_RGTC1_Format=36283,SIGNED_RED_RGTC1_Format=36284,RED_GREEN_RGTC2_Format=36285,SIGNED_RED_GREEN_RGTC2_Format=36286,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,LinearEncoding=3e3,sRGBEncoding=3001,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,NoColorSpace="",SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",DisplayP3ColorSpace="display-p3",LinearDisplayP3ColorSpace="display-p3-linear",ZeroStencilOp=0,KeepStencilOp=7680,ReplaceStencilOp=7681,IncrementStencilOp=7682,DecrementStencilOp=7683,IncrementWrapStencilOp=34055,DecrementWrapStencilOp=34056,InvertStencilOp=5386,NeverStencilFunc=512,LessStencilFunc=513,EqualStencilFunc=514,LessEqualStencilFunc=515,GreaterStencilFunc=516,NotEqualStencilFunc=517,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,NeverCompare=512,LessCompare=513,EqualCompare=514,LessEqualCompare=515,GreaterCompare=516,NotEqualCompare=517,GreaterEqualCompare=518,AlwaysCompare=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,StreamDrawUsage=35040,StaticReadUsage=35045,DynamicReadUsage=35049,StreamReadUsage=35041,StaticCopyUsage=35046,DynamicCopyUsage=35050,StreamCopyUsage=35042,GLSL1="100",GLSL3="300 es",_SRGBAFormat=1035,WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001;class EventDispatcher{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,r=i.length;e<r;e++)i[e].call(this,t);t.target=null}}}const _lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _seed=1234567;const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(_lut[255&t]+_lut[t>>8&255]+_lut[t>>16&255]+_lut[t>>24&255]+"-"+_lut[255&e]+_lut[e>>8&255]+"-"+_lut[e>>16&15|64]+_lut[e>>24&255]+"-"+_lut[63&i|128]+_lut[i>>8&255]+"-"+_lut[i>>16&255]+_lut[i>>24&255]+_lut[255&r]+_lut[r>>8&255]+_lut[r>>16&255]+_lut[r>>24&255]).toLowerCase()}function clamp(t,e,i){return Math.max(e,Math.min(i,t))}function euclideanModulo(t,e){return(t%e+e)%e}function mapLinear(t,e,i,r,n){return r+(t-e)*(n-r)/(i-e)}function inverseLerp(t,e,i){return t!==e?(i-t)/(e-t):0}function lerp(t,e,i){return(1-i)*t+i*e}function damp(t,e,i,r){return lerp(t,e,1-Math.exp(-i*r))}function pingpong(t,e=1){return e-Math.abs(euclideanModulo(t,2*e)-e)}function smoothstep(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)}function smootherstep(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)}function randInt(t,e){return t+Math.floor(Math.random()*(e-t+1))}function randFloat(t,e){return t+Math.random()*(e-t)}function randFloatSpread(t){return t*(.5-Math.random())}function seededRandom(t){void 0!==t&&(_seed=t);let e=_seed+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}function degToRad(t){return t*DEG2RAD}function radToDeg(t){return t*RAD2DEG}function isPowerOfTwo(t){return!(t&t-1)&&0!==t}function ceilPowerOfTwo(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function floorPowerOfTwo(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function setQuaternionFromProperEuler(t,e,i,r,n){const s=Math.cos,o=Math.sin,a=s(i/2),l=o(i/2),c=s((e+r)/2),h=o((e+r)/2),u=s((e-r)/2),d=o((e-r)/2),p=s((r-e)/2),f=o((r-e)/2);switch(n){case"XYX":t.set(a*h,l*u,l*d,a*c);break;case"YZY":t.set(l*d,a*h,l*u,a*c);break;case"ZXZ":t.set(l*u,l*d,a*h,a*c);break;case"XZX":t.set(a*h,l*f,l*p,a*c);break;case"YXY":t.set(l*p,a*h,l*f,a*c);break;case"ZYZ":t.set(l*f,l*p,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function denormalize(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function normalize(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const MathUtils={DEG2RAD,RAD2DEG,generateUUID,clamp,euclideanModulo,mapLinear,inverseLerp,lerp,damp,pingpong,smoothstep,smootherstep,randInt,randFloat,randFloatSpread,seededRandom,degToRad,radToDeg,isPowerOfTwo,ceilPowerOfTwo,floorPowerOfTwo,setQuaternionFromProperEuler,normalize,denormalize};class Vector2{constructor(t=0,e=0){Vector2.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6],this.y=r[1]*e+r[4]*i+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(clamp(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),r=Math.sin(e),n=this.x-t.x,s=this.y-t.y;return this.x=n*i-s*r+t.x,this.y=n*r+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Matrix3{constructor(t,e,i,r,n,s,o,a,l){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,i,r,n,s,o,a,l)}set(t,e,i,r,n,s,o,a,l){const c=this.elements;return c[0]=t,c[1]=r,c[2]=o,c[3]=e,c[4]=n,c[5]=a,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,r=e.elements,n=this.elements,s=i[0],o=i[3],a=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],p=i[8],f=r[0],m=r[3],g=r[6],_=r[1],v=r[4],y=r[7],b=r[2],A=r[5],x=r[8];return n[0]=s*f+o*_+a*b,n[3]=s*m+o*v+a*A,n[6]=s*g+o*y+a*x,n[1]=l*f+c*_+h*b,n[4]=l*m+c*v+h*A,n[7]=l*g+c*y+h*x,n[2]=u*f+d*_+p*b,n[5]=u*m+d*v+p*A,n[8]=u*g+d*y+p*x,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*o*l-i*n*c+i*o*a+r*n*l-r*s*a}invert(){const t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=c*s-o*l,u=o*a-c*n,d=l*n-s*a,p=e*h+i*u+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=h*f,t[1]=(r*l-c*i)*f,t[2]=(o*i-r*s)*f,t[3]=u*f,t[4]=(c*e-r*a)*f,t[5]=(r*n-o*e)*f,t[6]=d*f,t[7]=(i*a-l*e)*f,t[8]=(s*e-i*n)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,r,n,s,o){const a=Math.cos(n),l=Math.sin(n);return this.set(i*a,i*l,-i*(a*s+l*o)+s+t,-r*l,r*a,-r*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(_m3.makeScale(t,e)),this}rotate(t){return this.premultiply(_m3.makeRotation(-t)),this}translate(t,e){return this.premultiply(_m3.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const _m3=new Matrix3;function arrayNeedsUint32(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const TYPED_ARRAYS={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function getTypedArray(t,e){return new TYPED_ARRAYS[t](e)}function createElementNS(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function createCanvasElement(){const t=createElementNS("canvas");return t.style.display="block",t}const _cache={};function warnOnce(t){t in _cache||(_cache[t]=!0,console.warn(t))}function SRGBToLinear(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function LinearToSRGB(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const LINEAR_SRGB_TO_LINEAR_DISPLAY_P3=(new Matrix3).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),LINEAR_DISPLAY_P3_TO_LINEAR_SRGB=(new Matrix3).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function DisplayP3ToLinearSRGB(t){return t.convertSRGBToLinear().applyMatrix3(LINEAR_DISPLAY_P3_TO_LINEAR_SRGB)}function LinearSRGBToDisplayP3(t){return t.applyMatrix3(LINEAR_SRGB_TO_LINEAR_DISPLAY_P3).convertLinearToSRGB()}const TO_LINEAR={[LinearSRGBColorSpace]:t=>t,[SRGBColorSpace]:t=>t.convertSRGBToLinear(),[DisplayP3ColorSpace]:DisplayP3ToLinearSRGB},FROM_LINEAR={[LinearSRGBColorSpace]:t=>t,[SRGBColorSpace]:t=>t.convertLinearToSRGB(),[DisplayP3ColorSpace]:LinearSRGBToDisplayP3},ColorManagement={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(t){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!t},get workingColorSpace(){return LinearSRGBColorSpace},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,i){if(!1===this.enabled||e===i||!e||!i)return t;const r=TO_LINEAR[e],n=FROM_LINEAR[i];if(void 0===r||void 0===n)throw new Error(`Unsupported color space conversion, "${e}" to "${i}".`);return n(r(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}};let _canvas;class ImageUtils{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===_canvas&&(_canvas=createElementNS("canvas")),_canvas.width=t.width,_canvas.height=t.height;const i=_canvas.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=_canvas}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=createElementNS("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const r=i.getImageData(0,0,t.width,t.height),n=r.data;for(let t=0;t<n.length;t++)n[t]=255*SRGBToLinear(n[t]/255);return i.putImageData(r,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*SRGBToLinear(e[t]/255)):e[t]=SRGBToLinear(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let sourceId=0;class Source{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:sourceId++}),this.uuid=generateUUID(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(null!==r){let t;if(Array.isArray(r)){t=[];for(let e=0,i=r.length;e<i;e++)r[e].isDataTexture?t.push(serializeImage(r[e].image)):t.push(serializeImage(r[e]))}else t=serializeImage(r);i.url=t}return e||(t.images[this.uuid]=i),i}}function serializeImage(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?ImageUtils.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _textureId=0;class Texture extends EventDispatcher{constructor(t=Texture.DEFAULT_IMAGE,e=Texture.DEFAULT_MAPPING,i=ClampToEdgeWrapping,r=ClampToEdgeWrapping,n=LinearFilter,s=LinearMipmapLinearFilter,o=RGBAFormat,a=UnsignedByteType,l=Texture.DEFAULT_ANISOTROPY,c=NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_textureId++}),this.uuid=generateUUID(),this.name="",this.source=new Source(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=n,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof c?this.colorSpace=c:(warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=c===sRGBEncoding?SRGBColorSpace:NoColorSpace),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==UVMapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case RepeatWrapping:t.x=t.x-Math.floor(t.x);break;case ClampToEdgeWrapping:t.x=t.x<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case RepeatWrapping:t.y=t.y-Math.floor(t.y);break;case ClampToEdgeWrapping:t.y=t.y<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===SRGBColorSpace?sRGBEncoding:LinearEncoding}set encoding(t){warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===sRGBEncoding?SRGBColorSpace:NoColorSpace}}Texture.DEFAULT_IMAGE=null,Texture.DEFAULT_MAPPING=UVMapping,Texture.DEFAULT_ANISOTROPY=1;class Vector4{constructor(t=0,e=0,i=0,r=1){Vector4.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,r=this.z,n=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*r+s[12]*n,this.y=s[1]*e+s[5]*i+s[9]*r+s[13]*n,this.z=s[2]*e+s[6]*i+s[10]*r+s[14]*n,this.w=s[3]*e+s[7]*i+s[11]*r+s[15]*n,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,r,n;const s=.01,o=.1,a=t.elements,l=a[0],c=a[4],h=a[8],u=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-u)<s&&Math.abs(h-f)<s&&Math.abs(p-m)<s){if(Math.abs(c+u)<o&&Math.abs(h+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(d+1)/2,_=(g+1)/2,v=(c+u)/4,y=(h+f)/4,b=(p+m)/4;return t>a&&t>_?t<s?(i=0,r=.707106781,n=.707106781):(i=Math.sqrt(t),r=v/i,n=y/i):a>_?a<s?(i=.707106781,r=0,n=.707106781):(r=Math.sqrt(a),i=v/r,n=b/r):_<s?(i=.707106781,r=.707106781,n=0):(n=Math.sqrt(_),i=y/n,r=b/n),this.set(i,r,n,e),this}let _=Math.sqrt((m-p)*(m-p)+(h-f)*(h-f)+(u-c)*(u-c));return Math.abs(_)<.001&&(_=1),this.x=(m-p)/_,this.y=(h-f)/_,this.z=(u-c)/_,this.w=Math.acos((l+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class RenderTarget extends EventDispatcher{constructor(t=1,e=1,i={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new Vector4(0,0,t,e),this.scissorTest=!1,this.viewport=new Vector4(0,0,t,e);const r={width:t,height:e,depth:1};void 0!==i.encoding&&(warnOnce("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===sRGBEncoding?SRGBColorSpace:NoColorSpace),this.texture=new Texture(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:LinearFilter,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(t,e,i=1){this.width===t&&this.height===e&&this.depth===i||(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new Source(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class WebGLRenderTarget extends RenderTarget{constructor(t=1,e=1,i={}){super(t,e,i),this.isWebGLRenderTarget=!0}}class DataArrayTexture extends Texture{constructor(t=null,e=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:r},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class WebGLArrayRenderTarget extends WebGLRenderTarget{constructor(t=1,e=1,i=1){super(t,e),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new DataArrayTexture(null,t,e,i),this.texture.isRenderTargetTexture=!0}}class Data3DTexture extends Texture{constructor(t=null,e=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:r},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class WebGL3DRenderTarget extends WebGLRenderTarget{constructor(t=1,e=1,i=1){super(t,e),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new Data3DTexture(null,t,e,i),this.texture.isRenderTargetTexture=!0}}class WebGLMultipleRenderTargets extends WebGLRenderTarget{constructor(t=1,e=1,i=1,r={}){super(t,e,r),this.isWebGLMultipleRenderTargets=!0;const n=this.texture;this.texture=[];for(let t=0;t<i;t++)this.texture[t]=n.clone(),this.texture[t].isRenderTargetTexture=!0}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let r=0,n=this.texture.length;r<n;r++)this.texture[r].image.width=t,this.texture[r].image.height=e,this.texture[r].image.depth=i;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}}class Quaternion{constructor(t=0,e=0,i=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=r}static slerpFlat(t,e,i,r,n,s,o){let a=i[r+0],l=i[r+1],c=i[r+2],h=i[r+3];const u=n[s+0],d=n[s+1],p=n[s+2],f=n[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=c,void(t[e+3]=h);if(1===o)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(h!==f||a!==u||l!==d||c!==p){let t=1-o;const e=a*u+l*d+c*p+h*f,i=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){const n=Math.sqrt(r),s=Math.atan2(n,e*i);t=Math.sin(t*s)/n,o=Math.sin(o*s)/n}const n=o*i;if(a=a*t+u*n,l=l*t+d*n,c=c*t+p*n,h=h*t+f*n,t===1-o){const t=1/Math.sqrt(a*a+l*l+c*c+h*h);a*=t,l*=t,c*=t,h*=t}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=h}static multiplyQuaternionsFlat(t,e,i,r,n,s){const o=i[r],a=i[r+1],l=i[r+2],c=i[r+3],h=n[s],u=n[s+1],d=n[s+2],p=n[s+3];return t[e]=o*p+c*h+a*d-l*u,t[e+1]=a*p+c*u+l*h-o*d,t[e+2]=l*p+c*d+o*u-a*h,t[e+3]=c*p-o*h-a*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const i=t._x,r=t._y,n=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(i/2),c=o(r/2),h=o(n/2),u=a(i/2),d=a(r/2),p=a(n/2);switch(s){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,r=Math.sin(i);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],r=e[4],n=e[8],s=e[1],o=e[5],a=e[9],l=e[2],c=e[6],h=e[10],u=i+o+h;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(c-a)*t,this._y=(n-l)*t,this._z=(s-r)*t}else if(i>o&&i>h){const t=2*Math.sqrt(1+i-o-h);this._w=(c-a)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(n+l)/t}else if(o>h){const t=2*Math.sqrt(1+o-i-h);this._w=(n-l)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(a+c)/t}else{const t=2*Math.sqrt(1+h-i-o);this._w=(s-r)/t,this._x=(n+l)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(clamp(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const r=Math.min(1,e/i);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,r=t._y,n=t._z,s=t._w,o=e._x,a=e._y,l=e._z,c=e._w;return this._x=i*c+s*o+r*l-n*a,this._y=r*c+s*a+n*o-i*l,this._z=n*c+s*l+i*a-r*o,this._w=s*c-i*o-r*a-n*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,r=this._y,n=this._z,s=this._w;let o=s*t._w+i*t._x+r*t._y+n*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=i,this._y=r,this._z=n,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*i+e*this._x,this._y=t*r+e*this._y,this._z=t*n+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),h=Math.sin((1-e)*c)/l,u=Math.sin(e*c)/l;return this._w=s*h+this._w*u,this._x=i*h+this._x*u,this._y=r*h+this._y*u,this._z=n*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),r=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(e*Math.cos(r),i*Math.sin(n),i*Math.cos(n),e*Math.sin(r))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Vector3{constructor(t=0,e=0,i=0){Vector3.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(_quaternion$4.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6]*r,this.y=n[1]*e+n[4]*i+n[7]*r,this.z=n[2]*e+n[5]*i+n[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,r=this.z,n=t.elements,s=1/(n[3]*e+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*e+n[4]*i+n[8]*r+n[12])*s,this.y=(n[1]*e+n[5]*i+n[9]*r+n[13])*s,this.z=(n[2]*e+n[6]*i+n[10]*r+n[14])*s,this}applyQuaternion(t){const e=this.x,i=this.y,r=this.z,n=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*r-o*i,c=a*i+o*e-n*r,h=a*r+n*i-s*e,u=-n*e-s*i-o*r;return this.x=l*a+u*-n+c*-o-h*-s,this.y=c*a+u*-s+h*-n-l*-o,this.z=h*a+u*-o+l*-s-c*-n,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[4]*i+n[8]*r,this.y=n[1]*e+n[5]*i+n[9]*r,this.z=n[2]*e+n[6]*i+n[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,r=t.y,n=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-n*o,this.y=n*s-i*a,this.z=i*o-r*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return _vector$b.copy(this).projectOnVector(t),this.sub(_vector$b)}reflect(t){return this.sub(_vector$b.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(clamp(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return e*e+i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const r=Math.sin(e)*t;return this.x=r*Math.sin(i),this.y=Math.cos(e)*t,this.z=r*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _vector$b=new Vector3,_quaternion$4=new Quaternion;class Box3{constructor(t=new Vector3(1/0,1/0,1/0),e=new Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e+=3)this.expandByPoint(_vector$a.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,i=t.count;e<i;e++)this.expandByPoint(_vector$a.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=_vector$a.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){if(t.updateWorldMatrix(!1,!1),void 0!==t.boundingBox)null===t.boundingBox&&t.computeBoundingBox(),_box$3.copy(t.boundingBox),_box$3.applyMatrix4(t.matrixWorld),this.union(_box$3);else{const i=t.geometry;if(void 0!==i)if(e&&void 0!==i.attributes&&void 0!==i.attributes.position){const e=i.attributes.position;for(let i=0,r=e.count;i<r;i++)_vector$a.fromBufferAttribute(e,i).applyMatrix4(t.matrixWorld),this.expandByPoint(_vector$a)}else null===i.boundingBox&&i.computeBoundingBox(),_box$3.copy(i.boundingBox),_box$3.applyMatrix4(t.matrixWorld),this.union(_box$3)}const i=t.children;for(let t=0,r=i.length;t<r;t++)this.expandByObject(i[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,_vector$a),_vector$a.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(t.a,_center),_v1$7.subVectors(t.b,_center),_v2$4.subVectors(t.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$4,_v1$7),_f2.subVectors(_v0$2,_v2$4);let e=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!!satForAxes(e,_v0$2,_v1$7,_v2$4,_extents)&&(e=[1,0,0,0,1,0,0,0,1],!!satForAxes(e,_v0$2,_v1$7,_v2$4,_extents)&&(_triangleNormal.crossVectors(_f0,_f1),e=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(e,_v0$2,_v1$7,_v2$4,_extents)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,_vector$a).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(_vector$a).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(_points)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$a=new Vector3,_box$3=new Box3,_v0$2=new Vector3,_v1$7=new Vector3,_v2$4=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(t,e,i,r,n){for(let s=0,o=t.length-3;s<=o;s+=3){_testAxis.fromArray(t,s);const o=n.x*Math.abs(_testAxis.x)+n.y*Math.abs(_testAxis.y)+n.z*Math.abs(_testAxis.z),a=e.dot(_testAxis),l=i.dot(_testAxis),c=r.dot(_testAxis);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const _box$2=new Box3,_v1$6=new Vector3,_v2$3=new Vector3;class Sphere{constructor(t=new Vector3,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):_box$2.setFromPoints(t).getCenter(i);let r=0;for(let e=0,n=t.length;e<n;e++)r=Math.max(r,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;_v1$6.subVectors(t,this.center);const e=_v1$6.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),i=.5*(t-this.radius);this.center.addScaledVector(_v1$6,i/t),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(_v2$3.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(_v1$6.copy(t.center).add(_v2$3)),this.expandByPoint(_v1$6.copy(t.center).sub(_v2$3))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const _vector$9=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3;class Ray{constructor(t=new Vector3,e=new Vector3(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,_vector$9)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=_vector$9.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(_vector$9.copy(this.origin).addScaledVector(this.direction,e),_vector$9.distanceToSquared(t))}distanceSqToSegment(t,e,i,r){_segCenter.copy(t).add(e).multiplyScalar(.5),_segDir.copy(e).sub(t).normalize(),_diff.copy(this.origin).sub(_segCenter);const n=.5*t.distanceTo(e),s=-this.direction.dot(_segDir),o=_diff.dot(this.direction),a=-_diff.dot(_segDir),l=_diff.lengthSq(),c=Math.abs(1-s*s);let h,u,d,p;if(c>0)if(h=s*a-o,u=s*o-a,p=n*c,h>=0)if(u>=-p)if(u<=p){const t=1/c;h*=t,u*=t,d=h*(h+s*u+2*o)+u*(s*h+u+2*a)+l}else u=n,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;else u=-n,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;else u<=-p?(h=Math.max(0,-(-s*n+o)),u=h>0?-n:Math.min(Math.max(-n,-a),n),d=-h*h+u*(u+2*a)+l):u<=p?(h=0,u=Math.min(Math.max(-n,-a),n),d=u*(u+2*a)+l):(h=Math.max(0,-(s*n+o)),u=h>0?n:Math.min(Math.max(-n,-a),n),d=-h*h+u*(u+2*a)+l);else u=s>0?-n:n,h=Math.max(0,-(s*u+o)),d=-h*h+u*(u+2*a)+l;return i&&i.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(_segCenter).addScaledVector(_segDir,u),d}intersectSphere(t,e){_vector$9.subVectors(t.center,this.origin);const i=_vector$9.dot(this.direction),r=_vector$9.dot(_vector$9)-i*i,n=t.radius*t.radius;if(r>n)return null;const s=Math.sqrt(n-r),o=i-s,a=i+s;return a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,r,n,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(i=(t.min.x-u.x)*l,r=(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,r=(t.min.x-u.x)*l),c>=0?(n=(t.min.y-u.y)*c,s=(t.max.y-u.y)*c):(n=(t.max.y-u.y)*c,s=(t.min.y-u.y)*c),i>s||n>r?null:((n>i||isNaN(i))&&(i=n),(s<r||isNaN(r))&&(r=s),h>=0?(o=(t.min.z-u.z)*h,a=(t.max.z-u.z)*h):(o=(t.max.z-u.z)*h,a=(t.min.z-u.z)*h),i>a||o>r?null:((o>i||i!=i)&&(i=o),(a<r||r!=r)&&(r=a),r<0?null:this.at(i>=0?i:r,e)))}intersectsBox(t){return null!==this.intersectBox(t,_vector$9)}intersectTriangle(t,e,i,r,n){_edge1.subVectors(e,t),_edge2.subVectors(i,t),_normal$1.crossVectors(_edge1,_edge2);let s,o=this.direction.dot(_normal$1);if(o>0){if(r)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}_diff.subVectors(this.origin,t);const a=s*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(a<0)return null;const l=s*this.direction.dot(_edge1.cross(_diff));if(l<0)return null;if(a+l>o)return null;const c=-s*_diff.dot(_normal$1);return c<0?null:this.at(c/o,n)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Matrix4{constructor(t,e,i,r,n,s,o,a,l,c,h,u,d,p,f,m){Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,i,r,n,s,o,a,l,c,h,u,d,p,f,m)}set(t,e,i,r,n,s,o,a,l,c,h,u,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=r,g[1]=n,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Matrix4).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,r=1/_v1$5.setFromMatrixColumn(t,0).length(),n=1/_v1$5.setFromMatrixColumn(t,1).length(),s=1/_v1$5.setFromMatrixColumn(t,2).length();return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=0,e[4]=i[4]*n,e[5]=i[5]*n,e[6]=i[6]*n,e[7]=0,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,r=t.y,n=t.z,s=Math.cos(i),o=Math.sin(i),a=Math.cos(r),l=Math.sin(r),c=Math.cos(n),h=Math.sin(n);if("XYZ"===t.order){const t=s*c,i=s*h,r=o*c,n=o*h;e[0]=a*c,e[4]=-a*h,e[8]=l,e[1]=i+r*l,e[5]=t-n*l,e[9]=-o*a,e[2]=n-t*l,e[6]=r+i*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*c,i=a*h,r=l*c,n=l*h;e[0]=t+n*o,e[4]=r*o-i,e[8]=s*l,e[1]=s*h,e[5]=s*c,e[9]=-o,e[2]=i*o-r,e[6]=n+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*c,i=a*h,r=l*c,n=l*h;e[0]=t-n*o,e[4]=-s*h,e[8]=r+i*o,e[1]=i+r*o,e[5]=s*c,e[9]=n-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*c,i=s*h,r=o*c,n=o*h;e[0]=a*c,e[4]=r*l-i,e[8]=t*l+n,e[1]=a*h,e[5]=n*l+t,e[9]=i*l-r,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,i=s*l,r=o*a,n=o*l;e[0]=a*c,e[4]=n-t*h,e[8]=r*h+i,e[1]=h,e[5]=s*c,e[9]=-o*c,e[2]=-l*c,e[6]=i*h+r,e[10]=t-n*h}else if("XZY"===t.order){const t=s*a,i=s*l,r=o*a,n=o*l;e[0]=a*c,e[4]=-h,e[8]=l*c,e[1]=t*h+n,e[5]=s*c,e[9]=i*h-r,e[2]=r*h-i,e[6]=o*c,e[10]=n*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(_zero,t,_one)}lookAt(t,e,i){const r=this.elements;return _z.subVectors(t,e),0===_z.lengthSq()&&(_z.z=1),_z.normalize(),_x.crossVectors(i,_z),0===_x.lengthSq()&&(1===Math.abs(i.z)?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(i,_z)),_x.normalize(),_y.crossVectors(_z,_x),r[0]=_x.x,r[4]=_y.x,r[8]=_z.x,r[1]=_x.y,r[5]=_y.y,r[9]=_z.y,r[2]=_x.z,r[6]=_y.z,r[10]=_z.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,r=e.elements,n=this.elements,s=i[0],o=i[4],a=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],_=i[3],v=i[7],y=i[11],b=i[15],A=r[0],x=r[4],C=r[8],E=r[12],M=r[1],S=r[5],w=r[9],P=r[13],T=r[2],O=r[6],R=r[10],N=r[14],L=r[3],D=r[7],k=r[11],I=r[15];return n[0]=s*A+o*M+a*T+l*L,n[4]=s*x+o*S+a*O+l*D,n[8]=s*C+o*w+a*R+l*k,n[12]=s*E+o*P+a*N+l*I,n[1]=c*A+h*M+u*T+d*L,n[5]=c*x+h*S+u*O+d*D,n[9]=c*C+h*w+u*R+d*k,n[13]=c*E+h*P+u*N+d*I,n[2]=p*A+f*M+m*T+g*L,n[6]=p*x+f*S+m*O+g*D,n[10]=p*C+f*w+m*R+g*k,n[14]=p*E+f*P+m*N+g*I,n[3]=_*A+v*M+y*T+b*L,n[7]=_*x+v*S+y*O+b*D,n[11]=_*C+v*w+y*R+b*k,n[15]=_*E+v*P+y*N+b*I,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],r=t[8],n=t[12],s=t[1],o=t[5],a=t[9],l=t[13],c=t[2],h=t[6],u=t[10],d=t[14];return t[3]*(+n*a*h-r*l*h-n*o*u+i*l*u+r*o*d-i*a*d)+t[7]*(+e*a*d-e*l*u+n*s*u-r*s*d+r*l*c-n*a*c)+t[11]*(+e*l*h-e*o*d-n*s*h+i*s*d+n*o*c-i*l*c)+t[15]*(-r*o*c-e*a*h+e*o*u+r*s*h-i*s*u+i*a*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],_=h*m*l-f*u*l+f*a*d-o*m*d-h*a*g+o*u*g,v=p*u*l-c*m*l-p*a*d+s*m*d+c*a*g-s*u*g,y=c*f*l-p*h*l+p*o*d-s*f*d-c*o*g+s*h*g,b=p*h*a-c*f*a-p*o*u+s*f*u+c*o*m-s*h*m,A=e*_+i*v+r*y+n*b;if(0===A)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const x=1/A;return t[0]=_*x,t[1]=(f*u*n-h*m*n-f*r*d+i*m*d+h*r*g-i*u*g)*x,t[2]=(o*m*n-f*a*n+f*r*l-i*m*l-o*r*g+i*a*g)*x,t[3]=(h*a*n-o*u*n-h*r*l+i*u*l+o*r*d-i*a*d)*x,t[4]=v*x,t[5]=(c*m*n-p*u*n+p*r*d-e*m*d-c*r*g+e*u*g)*x,t[6]=(p*a*n-s*m*n-p*r*l+e*m*l+s*r*g-e*a*g)*x,t[7]=(s*u*n-c*a*n+c*r*l-e*u*l-s*r*d+e*a*d)*x,t[8]=y*x,t[9]=(p*h*n-c*f*n-p*i*d+e*f*d+c*i*g-e*h*g)*x,t[10]=(s*f*n-p*o*n+p*i*l-e*f*l-s*i*g+e*o*g)*x,t[11]=(c*o*n-s*h*n-c*i*l+e*h*l+s*i*d-e*o*d)*x,t[12]=b*x,t[13]=(c*f*r-p*h*r+p*i*u-e*f*u-c*i*m+e*h*m)*x,t[14]=(p*o*r-s*f*r-p*i*a+e*f*a+s*i*m-e*o*m)*x,t[15]=(s*h*r-c*o*r+c*i*a-e*h*a-s*i*u+e*o*u)*x,this}scale(t){const e=this.elements,i=t.x,r=t.y,n=t.z;return e[0]*=i,e[4]*=r,e[8]*=n,e[1]*=i,e[5]*=r,e[9]*=n,e[2]*=i,e[6]*=r,e[10]*=n,e[3]*=i,e[7]*=r,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}makeTranslation(t,e,i){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),r=Math.sin(e),n=1-i,s=t.x,o=t.y,a=t.z,l=n*s,c=n*o;return this.set(l*s+i,l*o-r*a,l*a+r*o,0,l*o+r*a,c*o+i,c*a-r*s,0,l*a-r*o,c*a+r*s,n*a*a+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,r,n,s){return this.set(1,i,n,0,t,1,s,0,e,r,1,0,0,0,0,1),this}compose(t,e,i){const r=this.elements,n=e._x,s=e._y,o=e._z,a=e._w,l=n+n,c=s+s,h=o+o,u=n*l,d=n*c,p=n*h,f=s*c,m=s*h,g=o*h,_=a*l,v=a*c,y=a*h,b=i.x,A=i.y,x=i.z;return r[0]=(1-(f+g))*b,r[1]=(d+y)*b,r[2]=(p-v)*b,r[3]=0,r[4]=(d-y)*A,r[5]=(1-(u+g))*A,r[6]=(m+_)*A,r[7]=0,r[8]=(p+v)*x,r[9]=(m-_)*x,r[10]=(1-(u+f))*x,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,i){const r=this.elements;let n=_v1$5.set(r[0],r[1],r[2]).length();const s=_v1$5.set(r[4],r[5],r[6]).length(),o=_v1$5.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),t.x=r[12],t.y=r[13],t.z=r[14],_m1$2.copy(this);const a=1/n,l=1/s,c=1/o;return _m1$2.elements[0]*=a,_m1$2.elements[1]*=a,_m1$2.elements[2]*=a,_m1$2.elements[4]*=l,_m1$2.elements[5]*=l,_m1$2.elements[6]*=l,_m1$2.elements[8]*=c,_m1$2.elements[9]*=c,_m1$2.elements[10]*=c,e.setFromRotationMatrix(_m1$2),i.x=n,i.y=s,i.z=o,this}makePerspective(t,e,i,r,n,s,o=WebGLCoordinateSystem){const a=this.elements,l=2*n/(e-t),c=2*n/(i-r),h=(e+t)/(e-t),u=(i+r)/(i-r);let d,p;if(o===WebGLCoordinateSystem)d=-(s+n)/(s-n),p=-2*s*n/(s-n);else{if(o!==WebGPUCoordinateSystem)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);d=-s/(s-n),p=-s*n/(s-n)}return a[0]=l,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=c,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,r,n,s,o=WebGLCoordinateSystem){const a=this.elements,l=1/(e-t),c=1/(i-r),h=1/(s-n),u=(e+t)*l,d=(i+r)*c;let p,f;if(o===WebGLCoordinateSystem)p=(s+n)*h,f=-2*h;else{if(o!==WebGPUCoordinateSystem)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=n*h,f=-1*h}return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const _v1$5=new Vector3,_m1$2=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,_matrix=new Matrix4,_quaternion$3=new Quaternion;class Euler{constructor(t=0,e=0,i=0,r=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,r=this._order){return this._x=t,this._y=e,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const r=t.elements,n=r[0],s=r[4],o=r[8],a=r[1],l=r[5],c=r[9],h=r[2],u=r[6],d=r[10];switch(e){case"XYZ":this._y=Math.asin(clamp(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-h,n),this._z=0);break;case"ZXY":this._x=Math.asin(clamp(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,n));break;case"ZYX":this._y=Math.asin(-clamp(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,n)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(clamp(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,n)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-clamp(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return _matrix.makeRotationFromQuaternion(t),this.setFromRotationMatrix(_matrix,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Layers{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return 0!==(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let _object3DId=0;const _v1$4=new Vector3,_q1=new Quaternion,_m1$1=new Matrix4,_target=new Vector3,_position$3=new Vector3,_scale$2=new Vector3,_quaternion$2=new Quaternion,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};class Object3D extends EventDispatcher{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DEFAULT_UP.clone();const t=new Vector3,e=new Euler,i=new Quaternion,r=new Vector3(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return _q1.setFromAxisAngle(t,e),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(t,e){return _q1.setFromAxisAngle(t,e),this.quaternion.premultiply(_q1),this}rotateX(t){return this.rotateOnAxis(_xAxis,t)}rotateY(t){return this.rotateOnAxis(_yAxis,t)}rotateZ(t){return this.rotateOnAxis(_zAxis,t)}translateOnAxis(t,e){return _v1$4.copy(t).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(_xAxis,t)}translateY(t){return this.translateOnAxis(_yAxis,t)}translateZ(t){return this.translateOnAxis(_zAxis,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(_m1$1.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?_target.copy(t):_target.set(t,e,i);const r=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position$3,_target,this.up):_m1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1),r&&(_m1$1.extractRotation(r.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(_addedEvent)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(_removedEvent)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),_m1$1.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(t.parent.matrixWorld)),t.applyMatrix4(_m1$1),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,r=this.children.length;i<r;i++){const r=this.children[i].getObjectByProperty(t,e);if(void 0!==r)return r}}getObjectsByProperty(t,e){let i=[];this[t]===e&&i.push(this);for(let r=0,n=this.children.length;r<n;r++){const n=this.children[r].getObjectsByProperty(t,e);n.length>0&&(i=i.concat(n))}return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,t,_scale$2),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,r=e.length;i<r;i++){const r=e[i];!0!==r.matrixWorldAutoUpdate&&!0!==t||r.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};function n(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,r=i.length;e<r;e++){const r=i[e];n(t.shapes,r)}else n(t.shapes,i)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(n(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,r=this.material.length;i<r;i++)e.push(n(t.materials,this.material[i]));r.material=e}else r.material=n(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];r.animations.push(n(t.animations,i))}}if(e){const e=s(t.geometries),r=s(t.materials),n=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),c=s(t.animations),h=s(t.nodes);e.length>0&&(i.geometries=e),r.length>0&&(i.materials=r),n.length>0&&(i.textures=n),o.length>0&&(i.images=o),a.length>0&&(i.shapes=a),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c),h.length>0&&(i.nodes=h)}return i.object=r,i;function s(t){const e=[];for(const i in t){const r=t[i];delete r.metadata,e.push(r)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}Object3D.DEFAULT_UP=new Vector3(0,1,0),Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0,Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _v0$1=new Vector3,_v1$3=new Vector3,_v2$2=new Vector3,_v3$1=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3;let warnedGetUV=!1;class Triangle{constructor(t=new Vector3,e=new Vector3,i=new Vector3){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,r){r.subVectors(i,e),_v0$1.subVectors(t,e),r.cross(_v0$1);const n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}static getBarycoord(t,e,i,r,n){_v0$1.subVectors(r,e),_v1$3.subVectors(i,e),_v2$2.subVectors(t,e);const s=_v0$1.dot(_v0$1),o=_v0$1.dot(_v1$3),a=_v0$1.dot(_v2$2),l=_v1$3.dot(_v1$3),c=_v1$3.dot(_v2$2),h=s*l-o*o;if(0===h)return n.set(-2,-1,-1);const u=1/h,d=(l*a-o*c)*u,p=(s*c-o*a)*u;return n.set(1-d-p,p,d)}static containsPoint(t,e,i,r){return this.getBarycoord(t,e,i,r,_v3$1),_v3$1.x>=0&&_v3$1.y>=0&&_v3$1.x+_v3$1.y<=1}static getUV(t,e,i,r,n,s,o,a){return!1===warnedGetUV&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),warnedGetUV=!0),this.getInterpolation(t,e,i,r,n,s,o,a)}static getInterpolation(t,e,i,r,n,s,o,a){return this.getBarycoord(t,e,i,r,_v3$1),a.setScalar(0),a.addScaledVector(n,_v3$1.x),a.addScaledVector(s,_v3$1.y),a.addScaledVector(o,_v3$1.z),a}static isFrontFacing(t,e,i,r){return _v0$1.subVectors(i,e),_v1$3.subVectors(t,e),_v0$1.cross(_v1$3).dot(r)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,r){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,i,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),.5*_v0$1.cross(_v1$3).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Triangle.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Triangle.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,r,n){return!1===warnedGetUV&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),warnedGetUV=!0),Triangle.getInterpolation(t,this.a,this.b,this.c,e,i,r,n)}getInterpolation(t,e,i,r,n){return Triangle.getInterpolation(t,this.a,this.b,this.c,e,i,r,n)}containsPoint(t){return Triangle.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Triangle.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,r=this.b,n=this.c;let s,o;_vab.subVectors(r,i),_vac.subVectors(n,i),_vap.subVectors(t,i);const a=_vab.dot(_vap),l=_vac.dot(_vap);if(a<=0&&l<=0)return e.copy(i);_vbp.subVectors(t,r);const c=_vab.dot(_vbp),h=_vac.dot(_vbp);if(c>=0&&h<=c)return e.copy(r);const u=a*h-c*l;if(u<=0&&a>=0&&c<=0)return s=a/(a-c),e.copy(i).addScaledVector(_vab,s);_vcp.subVectors(t,n);const d=_vab.dot(_vcp),p=_vac.dot(_vcp);if(p>=0&&d<=p)return e.copy(n);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(i).addScaledVector(_vac,o);const m=c*p-d*h;if(m<=0&&h-c>=0&&d-p>=0)return _vbc.subVectors(n,r),o=(h-c)/(h-c+(d-p)),e.copy(r).addScaledVector(_vbc,o);const g=1/(m+f+u);return s=f*g,o=u*g,e.copy(i).addScaledVector(_vab,s).addScaledVector(_vac,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let _materialId=0;class Material extends EventDispatcher{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_materialId++}),this.uuid=generateUUID(),this.name="",this.type="Material",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const r=this[e];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[e]=i:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(t){const e=[];for(const i in t){const r=t[i];delete r.metadata,e.push(r)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(i.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(i.blending=this.blending),this.side!==FrontSide&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaHash&&(i.alphaHash=this.alphaHash),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(i.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),e){const e=r(t.textures),n=r(t.images);e.length>0&&(i.textures=e),n.length>0&&(i.images=n)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let r=0;r!==t;++r)i[r]=e[r].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}class Color{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,i)}set(t,e,i){if(void 0===e&&void 0===i){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,i);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=SRGBColorSpace){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,ColorManagement.toWorkingColorSpace(this,e),this}setRGB(t,e,i,r=ColorManagement.workingColorSpace){return this.r=t,this.g=e,this.b=i,ColorManagement.toWorkingColorSpace(this,r),this}setHSL(t,e,i,r=ColorManagement.workingColorSpace){if(t=euclideanModulo(t,1),e=clamp(e,0,1),i=clamp(i,0,1),0===e)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+e):i+e-i*e,n=2*i-r;this.r=hue2rgb(n,r,t+1/3),this.g=hue2rgb(n,r,t),this.b=hue2rgb(n,r,t-1/3)}return ColorManagement.toWorkingColorSpace(this,r),this}setStyle(t,e=SRGBColorSpace){function i(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(t)){let n;const s=r[1],o=r[2];switch(s){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,e);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,e);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){const i=r[1],n=i.length;if(3===n)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,e);if(6===n)return this.setHex(parseInt(i,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=SRGBColorSpace){const i=_colorKeywords[t.toLowerCase()];return void 0!==i?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=SRGBToLinear(t.r),this.g=SRGBToLinear(t.g),this.b=SRGBToLinear(t.b),this}copyLinearToSRGB(t){return this.r=LinearToSRGB(t.r),this.g=LinearToSRGB(t.g),this.b=LinearToSRGB(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=SRGBColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),t),65536*Math.round(clamp(255*_color.r,0,255))+256*Math.round(clamp(255*_color.g,0,255))+Math.round(clamp(255*_color.b,0,255))}getHexString(t=SRGBColorSpace){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=ColorManagement.workingColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),e);const i=_color.r,r=_color.g,n=_color.b,s=Math.max(i,r,n),o=Math.min(i,r,n);let a,l;const c=(o+s)/2;if(o===s)a=0,l=0;else{const t=s-o;switch(l=c<=.5?t/(s+o):t/(2-s-o),s){case i:a=(r-n)/t+(r<n?6:0);break;case r:a=(n-i)/t+2;break;case n:a=(i-r)/t+4}a/=6}return t.h=a,t.s=l,t.l=c,t}getRGB(t,e=ColorManagement.workingColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),e),t.r=_color.r,t.g=_color.g,t.b=_color.b,t}getStyle(t=SRGBColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),t);const e=_color.r,i=_color.g,r=_color.b;return t!==SRGBColorSpace?`color(${t} ${e.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*r)})`}offsetHSL(t,e,i){return this.getHSL(_hslA),_hslA.h+=t,_hslA.s+=e,_hslA.l+=i,this.setHSL(_hslA.h,_hslA.s,_hslA.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(_hslA),t.getHSL(_hslB);const i=lerp(_hslA.h,_hslB.h,e),r=lerp(_hslA.s,_hslB.s,e),n=lerp(_hslA.l,_hslB.l,e);return this.setHSL(i,r,n),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,i=this.g,r=this.b,n=t.elements;return this.r=n[0]*e+n[3]*i+n[6]*r,this.g=n[1]*e+n[4]*i+n[7]*r,this.b=n[2]*e+n[5]*i+n[8]*r,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _color=new Color;Color.NAMES=_colorKeywords;class MeshBasicMaterial extends Material{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const _tables=_generateTables();function _generateTables(){const t=new ArrayBuffer(4),e=new Float32Array(t),i=new Uint32Array(t),r=new Uint32Array(512),n=new Uint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(r[t]=0,r[256|t]=32768,n[t]=24,n[256|t]=24):e<-14?(r[t]=1024>>-e-14,r[256|t]=1024>>-e-14|32768,n[t]=-e-1,n[256|t]=-e-1):e<=15?(r[t]=e+15<<10,r[256|t]=e+15<<10|32768,n[t]=13,n[256|t]=13):e<128?(r[t]=31744,r[256|t]=64512,n[t]=24,n[256|t]=24):(r[t]=31744,r[256|t]=64512,n[t]=13,n[256|t]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,i=0;for(;!(8388608&e);)e<<=1,i-=8388608;e&=-8388609,i+=947912704,s[t]=e|i}for(let t=1024;t<2048;++t)s[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)o[t]=t<<23;o[31]=1199570944,o[32]=2147483648;for(let t=33;t<63;++t)o[t]=2147483648+(t-32<<23);o[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(a[t]=1024);return{floatView:e,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:o,offsetTable:a}}function toHalfFloat(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=clamp(t,-65504,65504),_tables.floatView[0]=t;const e=_tables.uint32View[0],i=e>>23&511;return _tables.baseTable[i]+((8388607&e)>>_tables.shiftTable[i])}function fromHalfFloat(t){const e=t>>10;return _tables.uint32View[0]=_tables.mantissaTable[_tables.offsetTable[e]+(1023&t)]+_tables.exponentTable[e],_tables.floatView[0]}const DataUtils={toHalfFloat,fromHalfFloat},_vector$8=new Vector3,_vector2$1=new Vector2;class BufferAttribute{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=i,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[t+r]=e.array[i+r];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)_vector2$1.fromBufferAttribute(this,e),_vector2$1.applyMatrix3(t),this.setXY(e,_vector2$1.x,_vector2$1.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)_vector$8.fromBufferAttribute(this,e),_vector$8.applyMatrix3(t),this.setXYZ(e,_vector$8.x,_vector$8.y,_vector$8.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)_vector$8.fromBufferAttribute(this,e),_vector$8.applyMatrix4(t),this.setXYZ(e,_vector$8.x,_vector$8.y,_vector$8.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)_vector$8.fromBufferAttribute(this,e),_vector$8.applyNormalMatrix(t),this.setXYZ(e,_vector$8.x,_vector$8.y,_vector$8.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)_vector$8.fromBufferAttribute(this,e),_vector$8.transformDirection(t),this.setXYZ(e,_vector$8.x,_vector$8.y,_vector$8.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let i=this.array[t*this.itemSize+e];return this.normalized&&(i=denormalize(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=normalize(i,this.array)),this.array[t*this.itemSize+e]=i,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=denormalize(e,this.array)),e}setX(t,e){return this.normalized&&(e=normalize(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=denormalize(e,this.array)),e}setY(t,e){return this.normalized&&(e=normalize(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=denormalize(e,this.array)),e}setZ(t,e){return this.normalized&&(e=normalize(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=denormalize(e,this.array)),e}setW(t,e){return this.normalized&&(e=normalize(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=normalize(e,this.array),i=normalize(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,r){return t*=this.itemSize,this.normalized&&(e=normalize(e,this.array),i=normalize(i,this.array),r=normalize(r,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this}setXYZW(t,e,i,r,n){return t*=this.itemSize,this.normalized&&(e=normalize(e,this.array),i=normalize(i,this.array),r=normalize(r,this.array),n=normalize(n,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==StaticDrawUsage&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}class Int8BufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Int8Array(t),e,i)}}class Uint8BufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Uint8Array(t),e,i)}}class Uint8ClampedBufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Uint8ClampedArray(t),e,i)}}class Int16BufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Int16Array(t),e,i)}}class Uint16BufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class Int32BufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Int32Array(t),e,i)}}class Uint32BufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class Float16BufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Uint16Array(t),e,i),this.isFloat16BufferAttribute=!0}getX(t){let e=fromHalfFloat(this.array[t*this.itemSize]);return this.normalized&&(e=denormalize(e,this.array)),e}setX(t,e){return this.normalized&&(e=normalize(e,this.array)),this.array[t*this.itemSize]=toHalfFloat(e),this}getY(t){let e=fromHalfFloat(this.array[t*this.itemSize+1]);return this.normalized&&(e=denormalize(e,this.array)),e}setY(t,e){return this.normalized&&(e=normalize(e,this.array)),this.array[t*this.itemSize+1]=toHalfFloat(e),this}getZ(t){let e=fromHalfFloat(this.array[t*this.itemSize+2]);return this.normalized&&(e=denormalize(e,this.array)),e}setZ(t,e){return this.normalized&&(e=normalize(e,this.array)),this.array[t*this.itemSize+2]=toHalfFloat(e),this}getW(t){let e=fromHalfFloat(this.array[t*this.itemSize+3]);return this.normalized&&(e=denormalize(e,this.array)),e}setW(t,e){return this.normalized&&(e=normalize(e,this.array)),this.array[t*this.itemSize+3]=toHalfFloat(e),this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=normalize(e,this.array),i=normalize(i,this.array)),this.array[t+0]=toHalfFloat(e),this.array[t+1]=toHalfFloat(i),this}setXYZ(t,e,i,r){return t*=this.itemSize,this.normalized&&(e=normalize(e,this.array),i=normalize(i,this.array),r=normalize(r,this.array)),this.array[t+0]=toHalfFloat(e),this.array[t+1]=toHalfFloat(i),this.array[t+2]=toHalfFloat(r),this}setXYZW(t,e,i,r,n){return t*=this.itemSize,this.normalized&&(e=normalize(e,this.array),i=normalize(i,this.array),r=normalize(r,this.array),n=normalize(n,this.array)),this.array[t+0]=toHalfFloat(e),this.array[t+1]=toHalfFloat(i),this.array[t+2]=toHalfFloat(r),this.array[t+3]=toHalfFloat(n),this}}class Float32BufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Float32Array(t),e,i)}}class Float64BufferAttribute extends BufferAttribute{constructor(t,e,i){super(new Float64Array(t),e,i)}}let _id$2=0;const _m1=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$1=new Box3,_boxMorphTargets=new Box3,_vector$7=new Vector3;class BufferGeometry extends EventDispatcher{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$2++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(arrayNeedsUint32(t)?Uint32BufferAttribute:Uint16BufferAttribute)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new Matrix3).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return _m1.makeRotationFromQuaternion(t),this.applyMatrix4(_m1),this}rotateX(t){return _m1.makeRotationX(t),this.applyMatrix4(_m1),this}rotateY(t){return _m1.makeRotationY(t),this.applyMatrix4(_m1),this}rotateZ(t){return _m1.makeRotationZ(t),this.applyMatrix4(_m1),this}translate(t,e,i){return _m1.makeTranslation(t,e,i),this.applyMatrix4(_m1),this}scale(t,e,i){return _m1.makeScale(t,e,i),this.applyMatrix4(_m1),this}lookAt(t){return _obj.lookAt(t),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(t){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Float32BufferAttribute(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Box3);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];_box$1.setFromBufferAttribute(i),this.morphTargetsRelative?(_vector$7.addVectors(this.boundingBox.min,_box$1.min),this.boundingBox.expandByPoint(_vector$7),_vector$7.addVectors(this.boundingBox.max,_box$1.max),this.boundingBox.expandByPoint(_vector$7)):(this.boundingBox.expandByPoint(_box$1.min),this.boundingBox.expandByPoint(_box$1.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Vector3,1/0);if(t){const i=this.boundingSphere.center;if(_box$1.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];_boxMorphTargets.setFromBufferAttribute(i),this.morphTargetsRelative?(_vector$7.addVectors(_box$1.min,_boxMorphTargets.min),_box$1.expandByPoint(_vector$7),_vector$7.addVectors(_box$1.max,_boxMorphTargets.max),_box$1.expandByPoint(_vector$7)):(_box$1.expandByPoint(_boxMorphTargets.min),_box$1.expandByPoint(_boxMorphTargets.max))}_box$1.getCenter(i);let r=0;for(let e=0,n=t.count;e<n;e++)_vector$7.fromBufferAttribute(t,e),r=Math.max(r,i.distanceToSquared(_vector$7));if(e)for(let n=0,s=e.length;n<s;n++){const s=e[n],o=this.morphTargetsRelative;for(let e=0,n=s.count;e<n;e++)_vector$7.fromBufferAttribute(s,e),o&&(_offset.fromBufferAttribute(t,e),_vector$7.add(_offset)),r=Math.max(r,i.distanceToSquared(_vector$7))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.array,r=e.position.array,n=e.normal.array,s=e.uv.array,o=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*o),4));const a=this.getAttribute("tangent").array,l=[],c=[];for(let t=0;t<o;t++)l[t]=new Vector3,c[t]=new Vector3;const h=new Vector3,u=new Vector3,d=new Vector3,p=new Vector2,f=new Vector2,m=new Vector2,g=new Vector3,_=new Vector3;function v(t,e,i){h.fromArray(r,3*t),u.fromArray(r,3*e),d.fromArray(r,3*i),p.fromArray(s,2*t),f.fromArray(s,2*e),m.fromArray(s,2*i),u.sub(h),d.sub(h),f.sub(p),m.sub(p);const n=1/(f.x*m.y-m.x*f.y);isFinite(n)&&(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(n),_.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(n),l[t].add(g),l[e].add(g),l[i].add(g),c[t].add(_),c[e].add(_),c[i].add(_))}let y=this.groups;0===y.length&&(y=[{start:0,count:i.length}]);for(let t=0,e=y.length;t<e;++t){const e=y[t],r=e.start;for(let t=r,n=r+e.count;t<n;t+=3)v(i[t+0],i[t+1],i[t+2])}const b=new Vector3,A=new Vector3,x=new Vector3,C=new Vector3;function E(t){x.fromArray(n,3*t),C.copy(x);const e=l[t];b.copy(e),b.sub(x.multiplyScalar(x.dot(e))).normalize(),A.crossVectors(C,e);const i=A.dot(c[t])<0?-1:1;a[4*t]=b.x,a[4*t+1]=b.y,a[4*t+2]=b.z,a[4*t+3]=i}for(let t=0,e=y.length;t<e;++t){const e=y[t],r=e.start;for(let t=r,n=r+e.count;t<n;t+=3)E(i[t+0]),E(i[t+1]),E(i[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new BufferAttribute(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const r=new Vector3,n=new Vector3,s=new Vector3,o=new Vector3,a=new Vector3,l=new Vector3,c=new Vector3,h=new Vector3;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),f=t.getX(u+2);r.fromBufferAttribute(e,d),n.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),c.subVectors(s,n),h.subVectors(r,n),c.cross(h),o.fromBufferAttribute(i,d),a.fromBufferAttribute(i,p),l.fromBufferAttribute(i,f),o.add(c),a.add(c),l.add(c),i.setXYZ(d,o.x,o.y,o.z),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,o=e.count;t<o;t+=3)r.fromBufferAttribute(e,t+0),n.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,n),h.subVectors(r,n),c.cross(h),i.setXYZ(t+0,c.x,c.y,c.z),i.setXYZ(t+1,c.x,c.y,c.z),i.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)_vector$7.fromBufferAttribute(t,e),_vector$7.normalize(),t.setXYZ(e,_vector$7.x,_vector$7.y,_vector$7.z)}toNonIndexed(){function t(t,e){const i=t.array,r=t.itemSize,n=t.normalized,s=new i.constructor(e.length*r);let o=0,a=0;for(let n=0,l=e.length;n<l;n++){o=t.isInterleavedBufferAttribute?e[n]*t.data.stride+t.offset:e[n]*r;for(let t=0;t<r;t++)s[a++]=i[o++]}return new BufferAttribute(s,r,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new BufferGeometry,i=this.index.array,r=this.attributes;for(const n in r){const s=t(r[n],i);e.setAttribute(n,s)}const n=this.morphAttributes;for(const r in n){const s=[],o=n[r];for(let e=0,r=o.length;e<r;e++){const r=t(o[e],i);s.push(r)}e.morphAttributes[r]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,i=s.length;t<i;t++){const i=s[t];e.addGroup(i.start,i.count,i.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const r=i[e];t.data.attributes[e]=r.toJSON(t.data)}const r={};let n=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],s=[];for(let e=0,r=i.length;e<r;e++){const r=i[e];s.push(r.toJSON(t.data))}s.length>0&&(r[e]=s,n=!0)}n&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const r=t.attributes;for(const t in r){const i=r[t];this.setAttribute(t,i.clone(e))}const n=t.morphAttributes;for(const t in n){const i=[],r=n[t];for(let t=0,n=r.length;t<n;t++)i.push(r[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const _inverseMatrix$3=new Matrix4,_ray$3=new Ray,_sphere$5=new Sphere,_sphereHitAt=new Vector3,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_tempA=new Vector3,_morphA=new Vector3,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2,_normalA=new Vector3,_normalB=new Vector3,_normalC=new Vector3,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;class Mesh extends Object3D{constructor(t=new BufferGeometry,e=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const i=this.geometry,r=i.attributes.position,n=i.morphAttributes.position,s=i.morphTargetsRelative;e.fromBufferAttribute(r,t);const o=this.morphTargetInfluences;if(n&&o){_morphA.set(0,0,0);for(let i=0,r=n.length;i<r;i++){const r=o[i],a=n[i];0!==r&&(_tempA.fromBufferAttribute(a,t),s?_morphA.addScaledVector(_tempA,r):_morphA.addScaledVector(_tempA.sub(e),r))}e.add(_morphA)}return e}raycast(t,e){const i=this.geometry,r=this.material,n=this.matrixWorld;if(void 0!==r){if(null===i.boundingSphere&&i.computeBoundingSphere(),_sphere$5.copy(i.boundingSphere),_sphere$5.applyMatrix4(n),_ray$3.copy(t.ray).recast(t.near),!1===_sphere$5.containsPoint(_ray$3.origin)){if(null===_ray$3.intersectSphere(_sphere$5,_sphereHitAt))return;if(_ray$3.origin.distanceToSquared(_sphereHitAt)>(t.far-t.near)**2)return}_inverseMatrix$3.copy(n).invert(),_ray$3.copy(t.ray).applyMatrix4(_inverseMatrix$3),null!==i.boundingBox&&!1===_ray$3.intersectsBox(i.boundingBox)||this._computeIntersections(t,e,_ray$3)}}_computeIntersections(t,e,i){let r;const n=this.geometry,s=this.material,o=n.index,a=n.attributes.position,l=n.attributes.uv,c=n.attributes.uv1,h=n.attributes.normal,u=n.groups,d=n.drawRange;if(null!==o)if(Array.isArray(s))for(let n=0,a=u.length;n<a;n++){const a=u[n],p=s[a.materialIndex];for(let n=Math.max(a.start,d.start),s=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));n<s;n+=3)r=checkGeometryIntersection(this,p,t,i,l,c,h,o.getX(n),o.getX(n+1),o.getX(n+2)),r&&(r.faceIndex=Math.floor(n/3),r.face.materialIndex=a.materialIndex,e.push(r))}else for(let n=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);n<a;n+=3)r=checkGeometryIntersection(this,s,t,i,l,c,h,o.getX(n),o.getX(n+1),o.getX(n+2)),r&&(r.faceIndex=Math.floor(n/3),e.push(r));else if(void 0!==a)if(Array.isArray(s))for(let n=0,o=u.length;n<o;n++){const o=u[n],p=s[o.materialIndex];for(let n=Math.max(o.start,d.start),s=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));n<s;n+=3)r=checkGeometryIntersection(this,p,t,i,l,c,h,n,n+1,n+2),r&&(r.faceIndex=Math.floor(n/3),r.face.materialIndex=o.materialIndex,e.push(r))}else for(let n=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);n<o;n+=3)r=checkGeometryIntersection(this,s,t,i,l,c,h,n,n+1,n+2),r&&(r.faceIndex=Math.floor(n/3),e.push(r))}}function checkIntersection(t,e,i,r,n,s,o,a){let l;if(l=e.side===BackSide?r.intersectTriangle(o,s,n,!0,a):r.intersectTriangle(n,s,o,e.side===FrontSide,a),null===l)return null;_intersectionPointWorld.copy(a),_intersectionPointWorld.applyMatrix4(t.matrixWorld);const c=i.ray.origin.distanceTo(_intersectionPointWorld);return c<i.near||c>i.far?null:{distance:c,point:_intersectionPointWorld.clone(),object:t}}function checkGeometryIntersection(t,e,i,r,n,s,o,a,l,c){t.getVertexPosition(a,_vA$1),t.getVertexPosition(l,_vB$1),t.getVertexPosition(c,_vC$1);const h=checkIntersection(t,e,i,r,_vA$1,_vB$1,_vC$1,_intersectionPoint);if(h){n&&(_uvA$1.fromBufferAttribute(n,a),_uvB$1.fromBufferAttribute(n,l),_uvC$1.fromBufferAttribute(n,c),h.uv=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2)),s&&(_uvA$1.fromBufferAttribute(s,a),_uvB$1.fromBufferAttribute(s,l),_uvC$1.fromBufferAttribute(s,c),h.uv1=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2),h.uv2=h.uv1),o&&(_normalA.fromBufferAttribute(o,a),_normalB.fromBufferAttribute(o,l),_normalC.fromBufferAttribute(o,c),h.normal=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_normalA,_normalB,_normalC,new Vector3),h.normal.dot(r.direction)>0&&h.normal.multiplyScalar(-1));const t={a,b:l,c,normal:new Vector3,materialIndex:0};Triangle.getNormal(_vA$1,_vB$1,_vC$1,t.normal),h.face=t}return h}class BoxGeometry extends BufferGeometry{constructor(t=1,e=1,i=1,r=1,n=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:r,heightSegments:n,depthSegments:s};const o=this;r=Math.floor(r),n=Math.floor(n),s=Math.floor(s);const a=[],l=[],c=[],h=[];let u=0,d=0;function p(t,e,i,r,n,s,p,f,m,g,_){const v=s/m,y=p/g,b=s/2,A=p/2,x=f/2,C=m+1,E=g+1;let M=0,S=0;const w=new Vector3;for(let s=0;s<E;s++){const o=s*y-A;for(let a=0;a<C;a++){const u=a*v-b;w[t]=u*r,w[e]=o*n,w[i]=x,l.push(w.x,w.y,w.z),w[t]=0,w[e]=0,w[i]=f>0?1:-1,c.push(w.x,w.y,w.z),h.push(a/m),h.push(1-s/g),M+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const i=u+e+C*t,r=u+e+C*(t+1),n=u+(e+1)+C*(t+1),s=u+(e+1)+C*t;a.push(i,r,s),a.push(r,n,s),S+=6}o.addGroup(d,S,_),d+=S,u+=M}p("z","y","x",-1,-1,i,e,t,s,n,0),p("z","y","x",1,-1,i,e,-t,s,n,1),p("x","z","y",1,1,t,i,e,r,s,2),p("x","z","y",1,-1,t,i,-e,r,s,3),p("x","y","z",1,-1,t,e,i,r,n,4),p("x","y","z",-1,-1,t,e,-i,r,n,5),this.setIndex(a),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(c,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new BoxGeometry(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function cloneUniforms(t){const e={};for(const i in t){e[i]={};for(const r in t[i]){const n=t[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][r]=null):e[i][r]=n.clone():Array.isArray(n)?e[i][r]=n.slice():e[i][r]=n}}return e}function mergeUniforms(t){const e={};for(let i=0;i<t.length;i++){const r=cloneUniforms(t[i]);for(const t in r)e[t]=r[t]}return e}function cloneUniformsGroups(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}function getUnlitUniformColorSpace(t){return null===t.getRenderTarget()?t.outputColorSpace:LinearSRGBColorSpace}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",default_fragment="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";class ShaderMaterial extends Material{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=cloneUniforms(t.uniforms),this.uniformsGroups=cloneUniformsGroups(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const r=this.uniforms[i].value;r&&r.isTexture?e.uniforms[i]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[i]={type:"m4",value:r.toArray()}:e.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}class Camera extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4,this.coordinateSystem=WebGLCoordinateSystem}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class PerspectiveCamera extends Camera{constructor(t=50,e=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*RAD2DEG*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*DEG2RAD*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*RAD2DEG*Math.atan(Math.tan(.5*DEG2RAD*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,r,n,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*DEG2RAD*this.fov)/this.zoom,i=2*e,r=this.aspect*i,n=-.5*r;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;n+=s.offsetX*r/t,e-=s.offsetY*i/o,r*=s.width/t,i*=s.height/o}const o=this.filmOffset;0!==o&&(n+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,e,e-i,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const fov=-90,aspect=1;class CubeCamera extends Object3D{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null;const r=new PerspectiveCamera(fov,aspect,t,e);r.layers=this.layers,this.add(r);const n=new PerspectiveCamera(fov,aspect,t,e);n.layers=this.layers,this.add(n);const s=new PerspectiveCamera(fov,aspect,t,e);s.layers=this.layers,this.add(s);const o=new PerspectiveCamera(fov,aspect,t,e);o.layers=this.layers,this.add(o);const a=new PerspectiveCamera(fov,aspect,t,e);a.layers=this.layers,this.add(a);const l=new PerspectiveCamera(fov,aspect,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[i,r,n,s,o,a]=e;for(const t of e)this.remove(t);if(t===WebGLCoordinateSystem)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),n.up.set(0,0,-1),n.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(t!==WebGPUCoordinateSystem)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),n.up.set(0,0,1),n.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const t of e)this.add(t),t.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[r,n,s,o,a,l]=this.children,c=t.getRenderTarget(),h=t.xr.enabled;t.xr.enabled=!1;const u=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,r),t.setRenderTarget(i,1),t.render(e,n),t.setRenderTarget(i,2),t.render(e,s),t.setRenderTarget(i,3),t.render(e,o),t.setRenderTarget(i,4),t.render(e,a),i.texture.generateMipmaps=u,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(c),t.xr.enabled=h,i.texture.needsPMREMUpdate=!0}}class CubeTexture extends Texture{constructor(t,e,i,r,n,s,o,a,l,c){super(t=void 0!==t?t:[],e=void 0!==e?e:CubeReflectionMapping,i,r,n,s,o,a,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const i={width:t,height:t,depth:1},r=[i,i,i,i,i,i];void 0!==e.encoding&&(warnOnce("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),e.colorSpace=e.encoding===sRGBEncoding?SRGBColorSpace:NoColorSpace),this.texture=new CubeTexture(r,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:LinearFilter}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",n="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new BoxGeometry(5,5,5),o=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(i),vertexShader:r,fragmentShader:n,side:BackSide,blending:NoBlending});o.uniforms.tEquirect.value=e;const a=new Mesh(s,o),l=e.minFilter;return e.minFilter===LinearMipmapLinearFilter&&(e.minFilter=LinearFilter),new CubeCamera(1,10,this).update(t,a),e.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(t,e,i,r){const n=t.getRenderTarget();for(let n=0;n<6;n++)t.setRenderTarget(this,n),t.clear(e,i,r);t.setRenderTarget(n)}}const _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;class Plane{constructor(t=new Vector3(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,r){return this.normal.set(t,e,i),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const r=_vector1.subVectors(i,e).cross(_vector2.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const i=t.delta(_vector1),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const n=-(t.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:e.copy(t.start).addScaledVector(i,n)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||_normalMatrix.getNormalMatrix(t),r=this.coplanarPoint(_vector1).applyMatrix4(t),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const _sphere$4=new Sphere,_vector$6=new Vector3;class Frustum{constructor(t=new Plane,e=new Plane,i=new Plane,r=new Plane,n=new Plane,s=new Plane){this.planes=[t,e,i,r,n,s]}set(t,e,i,r,n,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(r),o[4].copy(n),o[5].copy(s),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t,e=WebGLCoordinateSystem){const i=this.planes,r=t.elements,n=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=r[5],h=r[6],u=r[7],d=r[8],p=r[9],f=r[10],m=r[11],g=r[12],_=r[13],v=r[14],y=r[15];if(i[0].setComponents(a-n,u-l,m-d,y-g).normalize(),i[1].setComponents(a+n,u+l,m+d,y+g).normalize(),i[2].setComponents(a+s,u+c,m+p,y+_).normalize(),i[3].setComponents(a-s,u-c,m-p,y-_).normalize(),i[4].setComponents(a-o,u-h,m-f,y-v).normalize(),e===WebGLCoordinateSystem)i[5].setComponents(a+o,u+h,m+f,y+v).normalize();else{if(e!==WebGPUCoordinateSystem)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);i[5].setComponents(o,h,f,v).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),_sphere$4.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),_sphere$4.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(_sphere$4)}intersectsSprite(t){return _sphere$4.center.set(0,0,0),_sphere$4.radius=.7071067811865476,_sphere$4.applyMatrix4(t.matrixWorld),this.intersectsSphere(_sphere$4)}intersectsSphere(t){const e=this.planes,i=t.center,r=-t.radius;for(let t=0;t<6;t++)if(e[t].distanceToPoint(i)<r)return!1;return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const r=e[i];if(_vector$6.x=r.normal.x>0?t.max.x:t.min.x,_vector$6.y=r.normal.y>0?t.max.y:t.min.y,_vector$6.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(_vector$6)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function WebGLAnimation(){let t=null,e=!1,i=null,r=null;function n(e,s){i(e,s),r=t.requestAnimationFrame(n)}return{start:function(){!0!==e&&null!==i&&(r=t.requestAnimationFrame(n),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function WebGLAttributes(t,e){const i=e.isWebGL2,r=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),r.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const i=r.get(e);i&&(t.deleteBuffer(i.buffer),r.delete(e))},update:function(e,n){if(e.isGLBufferAttribute){const t=r.get(e);return void((!t||t.version<e.version)&&r.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=r.get(e);void 0===s?r.set(e,function(e,r){const n=e.array,s=e.usage,o=t.createBuffer();let a;if(t.bindBuffer(r,o),t.bufferData(r,n,s),e.onUploadCallback(),n instanceof Float32Array)a=t.FLOAT;else if(n instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=t.HALF_FLOAT}else a=t.UNSIGNED_SHORT;else if(n instanceof Int16Array)a=t.SHORT;else if(n instanceof Uint32Array)a=t.UNSIGNED_INT;else if(n instanceof Int32Array)a=t.INT;else if(n instanceof Int8Array)a=t.BYTE;else if(n instanceof Uint8Array)a=t.UNSIGNED_BYTE;else{if(!(n instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+n);a=t.UNSIGNED_BYTE}return{buffer:o,type:a,bytesPerElement:n.BYTES_PER_ELEMENT,version:e.version}}(e,n)):s.version<e.version&&(function(e,r,n){const s=r.array,o=r.updateRange;t.bindBuffer(n,e),-1===o.count?t.bufferSubData(n,0,s):(i?t.bufferSubData(n,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):t.bufferSubData(n,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1),r.onUploadCallback()}(s.buffer,e,n),s.version=e.version)}}}class PlaneGeometry extends BufferGeometry{constructor(t=1,e=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:r};const n=t/2,s=e/2,o=Math.floor(i),a=Math.floor(r),l=o+1,c=a+1,h=t/o,u=e/a,d=[],p=[],f=[],m=[];for(let t=0;t<c;t++){const e=t*u-s;for(let i=0;i<l;i++){const r=i*h-n;p.push(r,-e,0),f.push(0,0,1),m.push(i/o),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const i=e+l*t,r=e+l*(t+1),n=e+1+l*(t+1),s=e+1+l*t;d.push(i,r,s),d.push(r,n,s)}this.setIndex(d),this.setAttribute("position",new Float32BufferAttribute(p,3)),this.setAttribute("normal",new Float32BufferAttribute(f,3)),this.setAttribute("uv",new Float32BufferAttribute(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new PlaneGeometry(t.width,t.height,t.widthSegments,t.heightSegments)}}var alphahash_fragment="#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment="#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment="#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment="#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex="vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs="float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment="#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex="#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment="#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex="#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common="#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment="#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex="vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment="vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment="#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment="#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_vertex="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex="#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex="#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment="#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment="#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment="LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment="varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",envmap_physical_pars_fragment="#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",lights_toon_fragment="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment="varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment="varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tanisotropyV /= material.anisotropy;\n\tmaterial.anisotropy = saturate( material.anisotropy );\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment="struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment="#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment="#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex="#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin="float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps="#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment="#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex="#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex="#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin="#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps="#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment="#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment="#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment="#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment="#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment="#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment="#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex="#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex="#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment="#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment="#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment="#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment="#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment="#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex="#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex="#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif";const vertex$h="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",fragment$h="uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",vertex$g="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",fragment$g="#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",vertex$f="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",fragment$f="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",vertex$e="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",fragment$e="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",vertex$d="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",fragment$d="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",vertex$c="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",fragment$c="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",vertex$b="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",fragment$b="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",vertex$a="#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",fragment$a="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$9="#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragment$9="#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$8="#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",fragment$8="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$7="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",fragment$7="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",vertex$6="#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragment$6="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$5="#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",fragment$5="#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$4="#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragment$4="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$3="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",fragment$3="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",vertex$2="#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragment$2="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",vertex$1="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",fragment$1="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",ShaderChunk={alphahash_fragment,alphahash_pars_fragment,alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,alphatest_pars_fragment,aomap_fragment,aomap_pars_fragment,begin_vertex,beginnormal_vertex,bsdfs,iridescence_fragment,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,colorspace_fragment,colorspace_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_fragment,lightmap_pars_fragment,lights_lambert_fragment,lights_lambert_pars_fragment,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphcolor_vertex,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normal_pars_fragment,normal_pars_vertex,normal_vertex,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,iridescence_pars_fragment,opaque_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,transmission_fragment,transmission_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,worldpos_vertex,background_vert:vertex$h,background_frag:fragment$h,backgroundCube_vert:vertex$g,backgroundCube_frag:fragment$g,cube_vert:vertex$f,cube_frag:fragment$f,depth_vert:vertex$e,depth_frag:fragment$e,distanceRGBA_vert:vertex$d,distanceRGBA_frag:fragment$d,equirect_vert:vertex$c,equirect_frag:fragment$c,linedashed_vert:vertex$b,linedashed_frag:fragment$b,meshbasic_vert:vertex$a,meshbasic_frag:fragment$a,meshlambert_vert:vertex$9,meshlambert_frag:fragment$9,meshmatcap_vert:vertex$8,meshmatcap_frag:fragment$8,meshnormal_vert:vertex$7,meshnormal_frag:fragment$7,meshphong_vert:vertex$6,meshphong_frag:fragment$6,meshphysical_vert:vertex$5,meshphysical_frag:fragment$5,meshtoon_vert:vertex$4,meshtoon_frag:fragment$4,points_vert:vertex$3,points_frag:fragment$3,shadow_vert:vertex$2,shadow_frag:fragment$2,sprite_vert:vertex$1,sprite_frag:fragment$1},UniformsLib={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Matrix3}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Matrix3}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Matrix3}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Matrix3},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Matrix3},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Matrix3},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Matrix3}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Matrix3}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Matrix3}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.meshnormal_vert,fragmentShader:ShaderChunk.meshnormal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.backgroundCube_vert,fragmentShader:ShaderChunk.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Matrix3},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Matrix3},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Matrix3},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Matrix3},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Matrix3},sheen:{value:0},sheenColor:{value:new Color(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Matrix3},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Matrix3},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Matrix3},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Matrix3},attenuationDistance:{value:0},attenuationColor:{value:new Color(0)},specularColor:{value:new Color(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Matrix3},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Matrix3},anisotropyVector:{value:new Vector2},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Matrix3}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};const _rgb={r:0,b:0,g:0};function WebGLBackground(t,e,i,r,n,s,o){const a=new Color(0);let l,c,h=!0===s?0:1,u=null,d=0,p=null;function f(e,i){e.getRGB(_rgb,getUnlitUniformColorSpace(t)),r.buffers.color.setClear(_rgb.r,_rgb.g,_rgb.b,i,o)}return{getClearColor:function(){return a},setClearColor:function(t,e=1){a.set(t),h=e,f(a,h)},getClearAlpha:function(){return h},setClearAlpha:function(t){h=t,f(a,h)},render:function(s,m){let g=!1,_=!0===m.isScene?m.background:null;_&&_.isTexture&&(_=(m.backgroundBlurriness>0?i:e).get(_)),null===_?f(a,h):_&&_.isColor&&(f(_,1),g=!0);const v=t.xr.getEnvironmentBlendMode();"additive"===v?r.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===v&&r.buffers.color.setClear(0,0,0,0,o),(t.autoClear||g)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),_&&(_.isCubeTexture||_.mapping===CubeUVReflectionMapping)?(void 0===c&&(c=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.backgroundCube.uniforms),vertexShader:ShaderLib.backgroundCube.vertexShader,fragmentShader:ShaderLib.backgroundCube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(c)),c.material.uniforms.envMap.value=_,c.material.uniforms.flipEnvMap.value=_.isCubeTexture&&!1===_.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,c.material.toneMapped=_.colorSpace!==SRGBColorSpace,u===_&&d===_.version&&p===t.toneMapping||(c.material.needsUpdate=!0,u=_,d=_.version,p=t.toneMapping),c.layers.enableAll(),s.unshift(c,c.geometry,c.material,0,0,null)):_&&_.isTexture&&(void 0===l&&(l=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(l)),l.material.uniforms.t2D.value=_,l.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,l.material.toneMapped=_.colorSpace!==SRGBColorSpace,!0===_.matrixAutoUpdate&&_.updateMatrix(),l.material.uniforms.uvTransform.value.copy(_.matrix),u===_&&d===_.version&&p===t.toneMapping||(l.material.needsUpdate=!0,u=_,d=_.version,p=t.toneMapping),l.layers.enableAll(),s.unshift(l,l.geometry,l.material,0,0,null))}}}function WebGLBindingStates(t,e,i,r){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),s=r.isWebGL2?null:e.get("OES_vertex_array_object"),o=r.isWebGL2||null!==s,a={},l=p(null);let c=l,h=!1;function u(e){return r.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function d(e){return r.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function p(t){const e=[],i=[],r=[];for(let t=0;t<n;t++)e[t]=0,i[t]=0,r[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:r,object:t,attributes:{},index:null}}function f(){const t=c.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function m(t){g(t,0)}function g(i,n){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;s[i]=1,0===o[i]&&(t.enableVertexAttribArray(i),o[i]=1),a[i]!==n&&((r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,n),a[i]=n)}function _(){const e=c.newAttributes,i=c.enabledAttributes;for(let r=0,n=i.length;r<n;r++)i[r]!==e[r]&&(t.disableVertexAttribArray(r),i[r]=0)}function v(e,i,r,n,s,o,a){!0===a?t.vertexAttribIPointer(e,i,r,s,o):t.vertexAttribPointer(e,i,r,n,s,o)}function y(){b(),h=!0,c!==l&&(c=l,u(c.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(n,l,d,y,b){let A=!1;if(o){const e=function(e,i,n){const o=!0===n.wireframe;let l=a[e.id];void 0===l&&(l={},a[e.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let h=c[o];return void 0===h&&(h=p(r.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),c[o]=h),h}(y,d,l);c!==e&&(c=e,u(c.object)),A=function(t,e,i,r){const n=c.attributes,s=e.attributes;let o=0;const a=i.getAttributes();for(const e in a)if(a[e].location>=0){const i=n[e];let r=s[e];if(void 0===r&&("instanceMatrix"===e&&t.instanceMatrix&&(r=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(r=t.instanceColor)),void 0===i)return!0;if(i.attribute!==r)return!0;if(r&&i.data!==r.data)return!0;o++}return c.attributesNum!==o||c.index!==r}(n,y,d,b),A&&function(t,e,i,r){const n={},s=e.attributes;let o=0;const a=i.getAttributes();for(const e in a)if(a[e].location>=0){let i=s[e];void 0===i&&("instanceMatrix"===e&&t.instanceMatrix&&(i=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(i=t.instanceColor));const r={};r.attribute=i,i&&i.data&&(r.data=i.data),n[e]=r,o++}c.attributes=n,c.attributesNum=o,c.index=r}(n,y,d,b)}else{const t=!0===l.wireframe;c.geometry===y.id&&c.program===d.id&&c.wireframe===t||(c.geometry=y.id,c.program=d.id,c.wireframe=t,A=!0)}null!==b&&i.update(b,t.ELEMENT_ARRAY_BUFFER),(A||h)&&(h=!1,function(n,s,o,a){if(!1===r.isWebGL2&&(n.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;f();const l=a.attributes,c=o.getAttributes(),h=s.defaultAttributeValues;for(const e in c){const s=c[e];if(s.location>=0){let o=l[e];if(void 0===o&&("instanceMatrix"===e&&n.instanceMatrix&&(o=n.instanceMatrix),"instanceColor"===e&&n.instanceColor&&(o=n.instanceColor)),void 0!==o){const e=o.normalized,l=o.itemSize,c=i.get(o);if(void 0===c)continue;const h=c.buffer,u=c.type,d=c.bytesPerElement,p=!0===r.isWebGL2&&(u===t.INT||u===t.UNSIGNED_INT||o.gpuType===IntType);if(o.isInterleavedBufferAttribute){const i=o.data,r=i.stride,c=o.offset;if(i.isInstancedInterleavedBuffer){for(let t=0;t<s.locationSize;t++)g(s.location+t,i.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let t=0;t<s.locationSize;t++)m(s.location+t);t.bindBuffer(t.ARRAY_BUFFER,h);for(let t=0;t<s.locationSize;t++)v(s.location+t,l/s.locationSize,u,e,r*d,(c+l/s.locationSize*t)*d,p)}else{if(o.isInstancedBufferAttribute){for(let t=0;t<s.locationSize;t++)g(s.location+t,o.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let t=0;t<s.locationSize;t++)m(s.location+t);t.bindBuffer(t.ARRAY_BUFFER,h);for(let t=0;t<s.locationSize;t++)v(s.location+t,l/s.locationSize,u,e,l*d,l/s.locationSize*t*d,p)}}else if(void 0!==h){const i=h[e];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(s.location,i);break;case 3:t.vertexAttrib3fv(s.location,i);break;case 4:t.vertexAttrib4fv(s.location,i);break;default:t.vertexAttrib1fv(s.location,i)}}}}_()}(n,l,d,y),null!==b&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const t in a){const e=a[t];for(const t in e){const i=e[t];for(const t in i)d(i[t].object),delete i[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const t in e){const i=e[t];for(const t in i)d(i[t].object),delete i[t];delete e[t]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const i=a[e];if(void 0===i[t.id])continue;const r=i[t.id];for(const t in r)d(r[t].object),delete r[t];delete i[t.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:_}}function WebGLBufferRenderer(t,e,i,r){const n=r.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,r){t.drawArrays(s,e,r),i.update(r,s,1)},this.renderInstances=function(r,o,a){if(0===a)return;let l,c;if(n)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,r,o,a),i.update(o,s,a)}}function WebGLCapabilities(t,e,i){let r;function n(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===t.constructor.name;let o=void 0!==i.precision?i.precision:"highp";const a=n(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=s||e.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,h=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),u=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=t.getParameter(t.MAX_TEXTURE_SIZE),p=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),f=t.getParameter(t.MAX_VERTEX_ATTRIBS),m=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),g=t.getParameter(t.MAX_VARYING_VECTORS),_=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),v=u>0,y=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){const i=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:n,precision:o,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:s?t.getParameter(t.MAX_SAMPLES):0}}function WebGLClipping(t){const e=this;let i=null,r=0,n=!1,s=!1;const o=new Plane,a=new Matrix3,l={value:null,needsUpdate:!1};function c(t,i,r,n){const s=null!==t?t.length:0;let c=null;if(0!==s){if(c=l.value,!0!==n||null===c){const e=r+4*s,n=i.matrixWorldInverse;a.getNormalMatrix(n),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,i=r;e!==s;++e,i+=4)o.copy(t[e]).applyMatrix4(n,a),o.normal.toArray(c,i),c[i+3]=o.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){const i=0!==t.length||e||0!==r||n;return n=e,r=t.length,i},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(t,e){i=c(t,e,0)},this.setState=function(o,a,h){const u=o.clippingPlanes,d=o.clipIntersection,p=o.clipShadows,f=t.get(o);if(!n||null===u||0===u.length||s&&!p)s?c(null):(l.value!==i&&(l.value=i,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0);else{const t=s?0:r,e=4*t;let n=f.clippingState||null;l.value=n,n=c(u,a,e,h);for(let t=0;t!==e;++t)n[t]=i[t];f.clippingState=n,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function WebGLCubeMaps(t){let e=new WeakMap;function i(t,e){return e===EquirectangularReflectionMapping?t.mapping=CubeReflectionMapping:e===EquirectangularRefractionMapping&&(t.mapping=CubeRefractionMapping),t}function r(t){const i=t.target;i.removeEventListener("dispose",r);const n=e.get(i);void 0!==n&&(e.delete(i),n.dispose())}return{get:function(n){if(n&&n.isTexture&&!1===n.isRenderTargetTexture){const s=n.mapping;if(s===EquirectangularReflectionMapping||s===EquirectangularRefractionMapping){if(e.has(n))return i(e.get(n).texture,n.mapping);{const s=n.image;if(s&&s.height>0){const o=new WebGLCubeRenderTarget(s.height/2);return o.fromEquirectangularTexture(t,n),e.set(n,o),n.addEventListener("dispose",r),i(o.texture,n.mapping)}return null}}}return n},dispose:function(){e=new WeakMap}}}class OrthographicCamera extends Camera{constructor(t=-1,e=1,i=1,r=-1,n=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=r,this.near=n,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,r,n,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let n=i-t,s=i+t,o=r+e,a=r-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=t*this.view.offsetX,s=n+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(n,s,o,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const LOD_MIN=4,EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],MAX_SAMPLES=20,_flatCamera=new OrthographicCamera,_clearColor=new Color;let _oldTarget=null;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,PHI,INV_PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(INV_PHI,0,PHI),new Vector3(-INV_PHI,0,PHI),new Vector3(PHI,INV_PHI,0),new Vector3(-PHI,INV_PHI,0)];class PMREMGenerator{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,r=100){_oldTarget=this._renderer.getRenderTarget(),this._setSize(256);const n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(t,i,r,n),e>0&&this._blur(n,0,0,e),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=_getCubemapMaterial(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=_getEquirectMaterial(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(_oldTarget),t.scissorTest=!1,_setViewport(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===CubeReflectionMapping||t.mapping===CubeRefractionMapping?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),_oldTarget=this._renderer.getRenderTarget();const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:LinearFilter,minFilter:LinearFilter,generateMipmaps:!1,type:HalfFloatType,format:RGBAFormat,colorSpace:LinearSRGBColorSpace,depthBuffer:!1},r=_createRenderTarget(t,e,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=_createRenderTarget(t,e,i);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_createPlanes(r)),this._blurMaterial=_getBlurShader(r,t,e)}return r}_compileMaterial(t){const e=new Mesh(this._lodPlanes[0],t);this._renderer.compile(e,_flatCamera)}_sceneToCubeUV(t,e,i,r){const n=new PerspectiveCamera(90,1,e,i),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.toneMapping;a.getClearColor(_clearColor),a.toneMapping=NoToneMapping,a.autoClear=!1;const h=new MeshBasicMaterial({name:"PMREM.Background",side:BackSide,depthWrite:!1,depthTest:!1}),u=new Mesh(new BoxGeometry,h);let d=!1;const p=t.background;p?p.isColor&&(h.color.copy(p),t.background=null,d=!0):(h.color.copy(_clearColor),d=!0);for(let e=0;e<6;e++){const i=e%3;0===i?(n.up.set(0,s[e],0),n.lookAt(o[e],0,0)):1===i?(n.up.set(0,0,s[e]),n.lookAt(0,o[e],0)):(n.up.set(0,s[e],0),n.lookAt(0,0,o[e]));const l=this._cubeSize;_setViewport(r,i*l,e>2?l:0,l,l),a.setRenderTarget(r),d&&a.render(u,n),a.render(t,n)}u.geometry.dispose(),u.material.dispose(),a.toneMapping=c,a.autoClear=l,t.background=p}_textureToCubeUV(t,e){const i=this._renderer,r=t.mapping===CubeReflectionMapping||t.mapping===CubeRefractionMapping;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=_getCubemapMaterial()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=_getEquirectMaterial());const n=r?this._cubemapMaterial:this._equirectMaterial,s=new Mesh(this._lodPlanes[0],n);n.uniforms.envMap.value=t;const o=this._cubeSize;_setViewport(e,0,0,3*o,2*o),i.setRenderTarget(e),i.render(s,_flatCamera)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){const i=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),r=_axisDirections[(e-1)%_axisDirections.length];this._blur(t,e-1,e,i,r)}e.autoClear=i}_blur(t,e,i,r,n){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,i,r,"latitudinal",n),this._halfBlur(s,t,i,i,r,"longitudinal",n)}_halfBlur(t,e,i,r,n,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Mesh(this._lodPlanes[r],l),h=l.uniforms,u=this._sizeLods[i]-1,d=isFinite(n)?Math.PI/(2*u):2*Math.PI/(2*MAX_SAMPLES-1),p=n/d,f=isFinite(n)?1+Math.floor(3*p):MAX_SAMPLES;f>MAX_SAMPLES&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${f} samples when the maximum is set to ${MAX_SAMPLES}`);const m=[];let g=0;for(let t=0;t<MAX_SAMPLES;++t){const e=t/p,i=Math.exp(-e*e/2);m.push(i),0===t?g+=i:t<f&&(g+=2*i)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;h.envMap.value=t.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===s,o&&(h.poleAxis.value=o);const{_lodMax:_}=this;h.dTheta.value=d,h.mipInt.value=_-i;const v=this._sizeLods[r];_setViewport(e,3*v*(r>_-LOD_MIN?r-_+LOD_MIN:0),4*(this._cubeSize-v),3*v,2*v),a.setRenderTarget(e),a.render(c,_flatCamera)}}function _createPlanes(t){const e=[],i=[],r=[];let n=t;const s=t-LOD_MIN+1+EXTRA_LOD_SIGMA.length;for(let o=0;o<s;o++){const s=Math.pow(2,n);i.push(s);let a=1/s;o>t-LOD_MIN?a=EXTRA_LOD_SIGMA[o-t+LOD_MIN-1]:0===o&&(a=0),r.push(a);const l=1/(s-2),c=-l,h=1+l,u=[c,c,h,c,h,h,c,c,h,h,c,h],d=6,p=6,f=3,m=2,g=1,_=new Float32Array(f*p*d),v=new Float32Array(m*p*d),y=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,i=t>2?0:-1,r=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];_.set(r,f*p*t),v.set(u,m*p*t);const n=[t,t,t,t,t,t];y.set(n,g*p*t)}const b=new BufferGeometry;b.setAttribute("position",new BufferAttribute(_,f)),b.setAttribute("uv",new BufferAttribute(v,m)),b.setAttribute("faceIndex",new BufferAttribute(y,g)),e.push(b),n>LOD_MIN&&n--}return{lodPlanes:e,sizeLods:i,sigmas:r}}function _createRenderTarget(t,e,i){const r=new WebGLRenderTarget(t,e,i);return r.texture.mapping=CubeUVReflectionMapping,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function _setViewport(t,e,i,r,n){t.viewport.set(e,i,r,n),t.scissor.set(e,i,r,n)}function _getBlurShader(t,e,i){const r=new Float32Array(MAX_SAMPLES),n=new Vector3(0,1,0);return new ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:MAX_SAMPLES,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:_getCommonVertexShader(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectMaterial(){return new ShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_getCommonVertexShader(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapMaterial(){return new ShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_getCommonVertexShader(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function WebGLCubeUVMaps(t){let e=new WeakMap,i=null;function r(t){const i=t.target;i.removeEventListener("dispose",r);const n=e.get(i);void 0!==n&&(e.delete(i),n.dispose())}return{get:function(n){if(n&&n.isTexture){const s=n.mapping,o=s===EquirectangularReflectionMapping||s===EquirectangularRefractionMapping,a=s===CubeReflectionMapping||s===CubeRefractionMapping;if(o||a){if(n.isRenderTargetTexture&&!0===n.needsPMREMUpdate){n.needsPMREMUpdate=!1;let r=e.get(n);return null===i&&(i=new PMREMGenerator(t)),r=o?i.fromEquirectangular(n,r):i.fromCubemap(n,r),e.set(n,r),r.texture}if(e.has(n))return e.get(n).texture;{const s=n.image;if(o&&s&&s.height>0||a&&s&&function(t){let e=0;for(let i=0;i<6;i++)void 0!==t[i]&&e++;return 6===e}(s)){null===i&&(i=new PMREMGenerator(t));const s=o?i.fromEquirectangular(n):i.fromCubemap(n);return e.set(n,s),n.addEventListener("dispose",r),s.texture}return null}}}return n},dispose:function(){e=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function WebGLExtensions(t){const e={};function i(i){if(void 0!==e[i])return e[i];let r;switch(i){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(i)}return e[i]=r,r}return{has:function(t){return null!==i(t)},init:function(t){t.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(t){const e=i(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function WebGLGeometries(t,e,i,r){const n={},s=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const t in a.attributes)e.remove(a.attributes[t]);for(const t in a.morphAttributes){const i=a.morphAttributes[t];for(let t=0,r=i.length;t<r;t++)e.remove(i[t])}a.removeEventListener("dispose",o),delete n[a.id];const l=s.get(a);l&&(e.remove(l),s.delete(a)),r.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(t){const i=[],r=t.index,n=t.attributes.position;let o=0;if(null!==r){const t=r.array;o=r.version;for(let e=0,r=t.length;e<r;e+=3){const r=t[e+0],n=t[e+1],s=t[e+2];i.push(r,n,n,s,s,r)}}else{if(void 0===n)return;{const t=n.array;o=n.version;for(let e=0,r=t.length/3-1;e<r;e+=3){const t=e+0,r=e+1,n=e+2;i.push(t,r,r,n,n,t)}}}const a=new(arrayNeedsUint32(i)?Uint32BufferAttribute:Uint16BufferAttribute)(i,1);a.version=o;const l=s.get(t);l&&e.remove(l),s.set(t,a)}return{get:function(t,e){return!0===n[e.id]||(e.addEventListener("dispose",o),n[e.id]=!0,i.memory.geometries++),e},update:function(i){const r=i.attributes;for(const i in r)e.update(r[i],t.ARRAY_BUFFER);const n=i.morphAttributes;for(const i in n){const r=n[i];for(let i=0,n=r.length;i<n;i++)e.update(r[i],t.ARRAY_BUFFER)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&a(t)}else a(t);return s.get(t)}}}function WebGLIndexedBufferRenderer(t,e,i,r){const n=r.isWebGL2;let s,o,a;this.setMode=function(t){s=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,r){t.drawElements(s,r,o,e*a),i.update(r,s,1)},this.renderInstances=function(r,l,c){if(0===c)return;let h,u;if(n)h=t,u="drawElementsInstanced";else if(h=e.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](s,l,o,r*a,c),i.update(l,s,c)}}function WebGLInfo(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(i,r,n){switch(e.calls++,r){case t.TRIANGLES:e.triangles+=n*(i/3);break;case t.LINES:e.lines+=n*(i/2);break;case t.LINE_STRIP:e.lines+=n*(i-1);break;case t.LINE_LOOP:e.lines+=n*i;break;case t.POINTS:e.points+=n*i;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function numericalSort(t,e){return t[0]-e[0]}function absNumericalSort(t,e){return Math.abs(e[1])-Math.abs(t[1])}function WebGLMorphtargets(t,e,i){const r={},n=new Float32Array(8),s=new WeakMap,o=new Vector4,a=[];for(let t=0;t<8;t++)a[t]=[t,0];return{update:function(l,c,h){const u=l.morphTargetInfluences;if(!0===e.isWebGL2){const d=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,p=void 0!==d?d.length:0;let f=s.get(c);if(void 0===f||f.count!==p){void 0!==f&&f.texture.dispose();const _=void 0!==c.morphAttributes.position,v=void 0!==c.morphAttributes.normal,y=void 0!==c.morphAttributes.color,b=c.morphAttributes.position||[],A=c.morphAttributes.normal||[],x=c.morphAttributes.color||[];let C=0;!0===_&&(C=1),!0===v&&(C=2),!0===y&&(C=3);let E=c.attributes.position.count*C,M=1;E>e.maxTextureSize&&(M=Math.ceil(E/e.maxTextureSize),E=e.maxTextureSize);const S=new Float32Array(E*M*4*p),w=new DataArrayTexture(S,E,M,p);w.type=FloatType,w.needsUpdate=!0;const P=4*C;for(let O=0;O<p;O++){const R=b[O],N=A[O],L=x[O],D=E*M*4*O;for(let k=0;k<R.count;k++){const I=k*P;!0===_&&(o.fromBufferAttribute(R,k),S[D+I+0]=o.x,S[D+I+1]=o.y,S[D+I+2]=o.z,S[D+I+3]=0),!0===v&&(o.fromBufferAttribute(N,k),S[D+I+4]=o.x,S[D+I+5]=o.y,S[D+I+6]=o.z,S[D+I+7]=0),!0===y&&(o.fromBufferAttribute(L,k),S[D+I+8]=o.x,S[D+I+9]=o.y,S[D+I+10]=o.z,S[D+I+11]=4===L.itemSize?o.w:1)}}function T(){w.dispose(),s.delete(c),c.removeEventListener("dispose",T)}f={count:p,texture:w,size:new Vector2(E,M)},s.set(c,f),c.addEventListener("dispose",T)}let m=0;for(let B=0;B<u.length;B++)m+=u[B];const g=c.morphTargetsRelative?1:1-m;h.getUniforms().setValue(t,"morphTargetBaseInfluence",g),h.getUniforms().setValue(t,"morphTargetInfluences",u),h.getUniforms().setValue(t,"morphTargetsTexture",f.texture,i),h.getUniforms().setValue(t,"morphTargetsTextureSize",f.size)}else{const U=void 0===u?0:u.length;let F=r[c.id];if(void 0===F||F.length!==U){F=[];for(let H=0;H<U;H++)F[H]=[H,0];r[c.id]=F}for(let Y=0;Y<U;Y++){const X=F[Y];X[0]=Y,X[1]=u[Y]}F.sort(absNumericalSort);for(let W=0;W<8;W++)W<U&&F[W][1]?(a[W][0]=F[W][0],a[W][1]=F[W][1]):(a[W][0]=Number.MAX_SAFE_INTEGER,a[W][1]=0);a.sort(numericalSort);const j=c.morphAttributes.position,V=c.morphAttributes.normal;let z=0;for(let J=0;J<8;J++){const $=a[J],q=$[0],K=$[1];q!==Number.MAX_SAFE_INTEGER&&K?(j&&c.getAttribute("morphTarget"+J)!==j[q]&&c.setAttribute("morphTarget"+J,j[q]),V&&c.getAttribute("morphNormal"+J)!==V[q]&&c.setAttribute("morphNormal"+J,V[q]),n[J]=K,z+=K):(j&&!0===c.hasAttribute("morphTarget"+J)&&c.deleteAttribute("morphTarget"+J),V&&!0===c.hasAttribute("morphNormal"+J)&&c.deleteAttribute("morphNormal"+J),n[J]=0)}const G=c.morphTargetsRelative?1:1-z;h.getUniforms().setValue(t,"morphTargetBaseInfluence",G),h.getUniforms().setValue(t,"morphTargetInfluences",n)}}}}function WebGLObjects(t,e,i,r){let n=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(o){const a=r.render.frame,l=o.geometry,c=e.get(o,l);if(n.get(c)!==a&&(e.update(c),n.set(c,a)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",s)&&o.addEventListener("dispose",s),n.get(o)!==a&&(i.update(o.instanceMatrix,t.ARRAY_BUFFER),null!==o.instanceColor&&i.update(o.instanceColor,t.ARRAY_BUFFER),n.set(o,a))),o.isSkinnedMesh){const t=o.skeleton;n.get(t)!==a&&(t.update(),n.set(t,a))}return c},dispose:function(){n=new WeakMap}}}const emptyTexture=new Texture,emptyArrayTexture=new DataArrayTexture,empty3dTexture=new Data3DTexture,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(t,e,i){const r=t[0];if(r<=0||r>0)return t;const n=e*i;let s=arrayCacheF32[n];if(void 0===s&&(s=new Float32Array(n),arrayCacheF32[n]=s),0!==e){r.toArray(s,0);for(let r=1,n=0;r!==e;++r)n+=i,t[r].toArray(s,n)}return s}function arraysEqual(t,e){if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}function copyArray(t,e){for(let i=0,r=e.length;i<r;i++)t[i]=e[i]}function allocTexUnits(t,e){let i=arrayCacheI32[e];void 0===i&&(i=new Int32Array(e),arrayCacheI32[e]=i);for(let r=0;r!==e;++r)i[r]=t.allocateTextureUnit();return i}function setValueV1f(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function setValueV2f(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(arraysEqual(i,e))return;t.uniform2fv(this.addr,e),copyArray(i,e)}}function setValueV3f(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(arraysEqual(i,e))return;t.uniform3fv(this.addr,e),copyArray(i,e)}}function setValueV4f(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(arraysEqual(i,e))return;t.uniform4fv(this.addr,e),copyArray(i,e)}}function setValueM2(t,e){const i=this.cache,r=e.elements;if(void 0===r){if(arraysEqual(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),copyArray(i,e)}else{if(arraysEqual(i,r))return;mat2array.set(r),t.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(i,r)}}function setValueM3(t,e){const i=this.cache,r=e.elements;if(void 0===r){if(arraysEqual(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),copyArray(i,e)}else{if(arraysEqual(i,r))return;mat3array.set(r),t.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(i,r)}}function setValueM4(t,e){const i=this.cache,r=e.elements;if(void 0===r){if(arraysEqual(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),copyArray(i,e)}else{if(arraysEqual(i,r))return;mat4array.set(r),t.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(i,r)}}function setValueV1i(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function setValueV2i(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(arraysEqual(i,e))return;t.uniform2iv(this.addr,e),copyArray(i,e)}}function setValueV3i(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(arraysEqual(i,e))return;t.uniform3iv(this.addr,e),copyArray(i,e)}}function setValueV4i(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(arraysEqual(i,e))return;t.uniform4iv(this.addr,e),copyArray(i,e)}}function setValueV1ui(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function setValueV2ui(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(arraysEqual(i,e))return;t.uniform2uiv(this.addr,e),copyArray(i,e)}}function setValueV3ui(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(arraysEqual(i,e))return;t.uniform3uiv(this.addr,e),copyArray(i,e)}}function setValueV4ui(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(arraysEqual(i,e))return;t.uniform4uiv(this.addr,e),copyArray(i,e)}}function setValueT1(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(e||emptyTexture,n)}function setValueT3D1(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(e||empty3dTexture,n)}function setValueT6(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(e||emptyCubeTexture,n)}function setValueT2DArray1(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(e||emptyArrayTexture,n)}function getSingularSetter(t){switch(t){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(t,e){t.uniform1fv(this.addr,e)}function setValueV2fArray(t,e){const i=flatten(e,this.size,2);t.uniform2fv(this.addr,i)}function setValueV3fArray(t,e){const i=flatten(e,this.size,3);t.uniform3fv(this.addr,i)}function setValueV4fArray(t,e){const i=flatten(e,this.size,4);t.uniform4fv(this.addr,i)}function setValueM2Array(t,e){const i=flatten(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function setValueM3Array(t,e){const i=flatten(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function setValueM4Array(t,e){const i=flatten(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function setValueV1iArray(t,e){t.uniform1iv(this.addr,e)}function setValueV2iArray(t,e){t.uniform2iv(this.addr,e)}function setValueV3iArray(t,e){t.uniform3iv(this.addr,e)}function setValueV4iArray(t,e){t.uniform4iv(this.addr,e)}function setValueV1uiArray(t,e){t.uniform1uiv(this.addr,e)}function setValueV2uiArray(t,e){t.uniform2uiv(this.addr,e)}function setValueV3uiArray(t,e){t.uniform3uiv(this.addr,e)}function setValueV4uiArray(t,e){t.uniform4uiv(this.addr,e)}function setValueT1Array(t,e,i){const r=this.cache,n=e.length,s=allocTexUnits(i,n);arraysEqual(r,s)||(t.uniform1iv(this.addr,s),copyArray(r,s));for(let t=0;t!==n;++t)i.setTexture2D(e[t]||emptyTexture,s[t])}function setValueT3DArray(t,e,i){const r=this.cache,n=e.length,s=allocTexUnits(i,n);arraysEqual(r,s)||(t.uniform1iv(this.addr,s),copyArray(r,s));for(let t=0;t!==n;++t)i.setTexture3D(e[t]||empty3dTexture,s[t])}function setValueT6Array(t,e,i){const r=this.cache,n=e.length,s=allocTexUnits(i,n);arraysEqual(r,s)||(t.uniform1iv(this.addr,s),copyArray(r,s));for(let t=0;t!==n;++t)i.setTextureCube(e[t]||emptyCubeTexture,s[t])}function setValueT2DArrayArray(t,e,i){const r=this.cache,n=e.length,s=allocTexUnits(i,n);arraysEqual(r,s)||(t.uniform1iv(this.addr,s),copyArray(r,s));for(let t=0;t!==n;++t)i.setTexture2DArray(e[t]||emptyArrayTexture,s[t])}function getPureArraySetter(t){switch(t){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35679:case 36299:case 36307:return setValueT3DArray;case 35680:case 36300:case 36308:case 36293:return setValueT6Array;case 36289:case 36303:case 36311:case 36292:return setValueT2DArrayArray}}class SingleUniform{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=getSingularSetter(e.type)}}class PureArrayUniform{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=getPureArraySetter(e.type)}}class StructuredUniform{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){const r=this.seq;for(let n=0,s=r.length;n!==s;++n){const s=r[n];s.setValue(t,e[s.id],i)}}}const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(t,e){t.seq.push(e),t.map[e.id]=e}function parseUniform(t,e,i){const r=t.name,n=r.length;for(RePathPart.lastIndex=0;;){const s=RePathPart.exec(r),o=RePathPart.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===n){addUniform(i,void 0===c?new SingleUniform(a,t,e):new PureArrayUniform(a,t,e));break}{let t=i.map[a];void 0===t&&(t=new StructuredUniform(a),addUniform(i,t)),i=t}}}class WebGLUniforms{constructor(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const i=t.getActiveUniform(e,r);parseUniform(i,t.getUniformLocation(e,i.name),this)}}setValue(t,e,i,r){const n=this.map[e];void 0!==n&&n.setValue(t,i,r)}setOptional(t,e,i){const r=e[i];void 0!==r&&this.setValue(t,i,r)}static upload(t,e,i,r){for(let n=0,s=e.length;n!==s;++n){const s=e[n],o=i[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,r)}}static seqWithValue(t,e){const i=[];for(let r=0,n=t.length;r!==n;++r){const n=t[r];n.id in e&&i.push(n)}return i}}function WebGLShader(t,e,i){const r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}let programIdCount=0;function handleSource(t,e){const i=t.split("\n"),r=[],n=Math.max(e-6,0),s=Math.min(e+6,i.length);for(let t=n;t<s;t++){const n=t+1;r.push(`${n===e?">":" "} ${n}: ${i[t]}`)}return r.join("\n")}function getEncodingComponents(t){switch(t){case LinearSRGBColorSpace:return["Linear","( value )"];case SRGBColorSpace:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",t),["Linear","( value )"]}}function getShaderErrors(t,e,i){const r=t.getShaderParameter(e,t.COMPILE_STATUS),n=t.getShaderInfoLog(e).trim();if(r&&""===n)return"";const s=/ERROR: 0:(\d+)/.exec(n);if(s){const r=parseInt(s[1]);return i.toUpperCase()+"\n\n"+n+"\n\n"+handleSource(t.getShaderSource(e),r)}return n}function getTexelEncodingFunction(t,e){const i=getEncodingComponents(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function getToneMappingFunction(t,e){let i;switch(e){case LinearToneMapping:i="Linear";break;case ReinhardToneMapping:i="Reinhard";break;case CineonToneMapping:i="OptimizedCineon";break;case ACESFilmicToneMapping:i="ACESFilmic";break;case CustomToneMapping:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function generateExtensions(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.normalMapTangentSpace||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\n")}function generateDefines(t){const e=[];for(const i in t){const r=t[i];!1!==r&&e.push("#define "+i+" "+r)}return e.join("\n")}function fetchAttributeLocations(t,e){const i={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const r=t.getActiveAttrib(e,n),s=r.name;let o=1;r.type===t.FLOAT_MAT2&&(o=2),r.type===t.FLOAT_MAT3&&(o=3),r.type===t.FLOAT_MAT4&&(o=4),i[s]={type:r.type,location:t.getAttribLocation(e,s),locationSize:o}}return i}function filterEmptyLine(t){return""!==t}function replaceLightNums(t,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function replaceClippingPlaneNums(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(t){return t.replace(includePattern,includeReplacer)}const shaderChunkMap=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function includeReplacer(t,e){let i=ShaderChunk[e];if(void 0===i){const t=shaderChunkMap.get(e);if(void 0===t)throw new Error("Can not resolve #include <"+e+">");i=ShaderChunk[t],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,t)}return resolveIncludes(i)}const unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(t){return t.replace(unrollLoopPattern,loopReplacer)}function loopReplacer(t,e,i,r){let n="";for(let t=parseInt(e);t<parseInt(i);t++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return n}function generatePrecision(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function generateShadowMapTypeDefine(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===PCFShadowMap?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===PCFSoftShadowMap?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===VSMShadowMap&&(e="SHADOWMAP_TYPE_VSM"),e}function generateEnvMapTypeDefine(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:e="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:e="ENVMAP_TYPE_CUBE_UV"}return e}function generateEnvMapModeDefine(t){let e="ENVMAP_MODE_REFLECTION";return t.envMap&&t.envMapMode===CubeRefractionMapping&&(e="ENVMAP_MODE_REFRACTION"),e}function generateEnvMapBlendingDefine(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case MultiplyOperation:e="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:e="ENVMAP_BLENDING_MIX";break;case AddOperation:e="ENVMAP_BLENDING_ADD"}return e}function generateCubeUVSize(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const i=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:r,maxMip:i}}function WebGLProgram(t,e,i,r){const n=t.getContext(),s=i.defines;let o=i.vertexShader,a=i.fragmentShader;const l=generateShadowMapTypeDefine(i),c=generateEnvMapTypeDefine(i),h=generateEnvMapModeDefine(i),u=generateEnvMapBlendingDefine(i),d=generateCubeUVSize(i),p=i.isWebGL2?"":generateExtensions(i),f=generateDefines(s),m=n.createProgram();let g,_,v=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(g=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f].filter(filterEmptyLine).join("\n"),g.length>0&&(g+="\n"),_=[p,"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f].filter(filterEmptyLine).join("\n"),_.length>0&&(_+="\n")):(g=[generatePrecision(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&!1===i.flatShading?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),_=[p,generatePrecision(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+h:"",i.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&!1===i.flatShading?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",i.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",i.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",ShaderChunk.colorspace_pars_fragment,getTexelEncodingFunction("linearToOutputTexel",i.outputColorSpace),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),o=resolveIncludes(o),o=replaceLightNums(o,i),o=replaceClippingPlaneNums(o,i),a=resolveIncludes(a),a=replaceLightNums(a,i),a=replaceClippingPlaneNums(a,i),o=unrollLoops(o),a=unrollLoops(a),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(v="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,_=["#define varying in",i.glslVersion===GLSL3?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+_);const y=v+g+o,b=v+_+a,A=WebGLShader(n,n.VERTEX_SHADER,y),x=WebGLShader(n,n.FRAGMENT_SHADER,b);if(n.attachShader(m,A),n.attachShader(m,x),void 0!==i.index0AttributeName?n.bindAttribLocation(m,0,i.index0AttributeName):!0===i.morphTargets&&n.bindAttribLocation(m,0,"position"),n.linkProgram(m),t.debug.checkShaderErrors){const e=n.getProgramInfoLog(m).trim(),i=n.getShaderInfoLog(A).trim(),r=n.getShaderInfoLog(x).trim();let s=!0,o=!0;if(!1===n.getProgramParameter(m,n.LINK_STATUS))if(s=!1,"function"==typeof t.debug.onShaderError)t.debug.onShaderError(n,m,A,x);else{const t=getShaderErrors(n,A,"vertex"),i=getShaderErrors(n,x,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(m,n.VALIDATE_STATUS)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+i)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):""!==i&&""!==r||(o=!1);o&&(this.diagnostics={runnable:s,programLog:e,vertexShader:{log:i,prefix:g},fragmentShader:{log:r,prefix:_}})}let C,E;return n.deleteShader(A),n.deleteShader(x),this.getUniforms=function(){return void 0===C&&(C=new WebGLUniforms(n,m)),C},this.getAttributes=function(){return void 0===E&&(E=fetchAttributeLocations(n,m)),E},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(m),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=programIdCount++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=A,this.fragmentShader=x,this}let _id$1=0;class WebGLShaderCache{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,r=this._getShaderStage(e),n=this._getShaderStage(i),s=this._getShaderCacheForMaterial(t);return!1===s.has(r)&&(s.add(r),r.usedTimes++),!1===s.has(n)&&(s.add(n),n.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let i=e.get(t);return void 0===i&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){const e=this.shaderCache;let i=e.get(t);return void 0===i&&(i=new WebGLShaderStage(t),e.set(t,i)),i}}class WebGLShaderStage{constructor(t){this.id=_id$1++,this.code=t,this.usedTimes=0}}function WebGLPrograms(t,e,i,r,n,s,o){const a=new Layers,l=new WebGLShaderCache,c=[],h=n.isWebGL2,u=n.logarithmicDepthBuffer,d=n.vertexTextures;let p=n.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(t){return 0===t?"uv":`uv${t}`}return{getParameters:function(s,a,c,g,_){const v=g.fog,y=_.geometry,b=s.isMeshStandardMaterial?g.environment:null,A=(s.isMeshStandardMaterial?i:e).get(s.envMap||b),x=A&&A.mapping===CubeUVReflectionMapping?A.image.height:null,C=f[s.type];null!==s.precision&&(p=n.getMaxPrecision(s.precision),p!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead."));const E=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,M=void 0!==E?E.length:0;let S,w,P,T,O=0;if(void 0!==y.morphAttributes.position&&(O=1),void 0!==y.morphAttributes.normal&&(O=2),void 0!==y.morphAttributes.color&&(O=3),C){const t=ShaderLib[C];S=t.vertexShader,w=t.fragmentShader}else S=s.vertexShader,w=s.fragmentShader,l.update(s),P=l.getVertexShaderID(s),T=l.getFragmentShaderID(s);const R=t.getRenderTarget(),N=!0===_.isInstancedMesh,L=!!s.map,D=!!s.matcap,k=!!A,I=!!s.aoMap,B=!!s.lightMap,U=!!s.bumpMap,F=!!s.normalMap,j=!!s.displacementMap,V=!!s.emissiveMap,z=!!s.metalnessMap,G=!!s.roughnessMap,H=s.anisotropy>0,Y=s.clearcoat>0,X=s.iridescence>0,W=s.sheen>0,J=s.transmission>0,$=H&&!!s.anisotropyMap,q=Y&&!!s.clearcoatMap,K=Y&&!!s.clearcoatNormalMap,Z=Y&&!!s.clearcoatRoughnessMap,Q=X&&!!s.iridescenceMap,tt=X&&!!s.iridescenceThicknessMap,et=W&&!!s.sheenColorMap,it=W&&!!s.sheenRoughnessMap,rt=!!s.specularMap,nt=!!s.specularColorMap,st=!!s.specularIntensityMap,ot=J&&!!s.transmissionMap,at=J&&!!s.thicknessMap,lt=!!s.gradientMap,ct=!!s.alphaMap,ht=s.alphaTest>0,ut=!!s.alphaHash,dt=!!s.extensions,pt=!!y.attributes.uv1,ft=!!y.attributes.uv2,mt=!!y.attributes.uv3;let gt=NoToneMapping;return s.toneMapped&&(null!==R&&!0!==R.isXRRenderTarget||(gt=t.toneMapping)),{isWebGL2:h,shaderID:C,shaderType:s.type,shaderName:s.name,vertexShader:S,fragmentShader:w,defines:s.defines,customVertexShaderID:P,customFragmentShaderID:T,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,instancing:N,instancingColor:N&&null!==_.instanceColor,supportsVertexTextures:d,outputColorSpace:null===R?t.outputColorSpace:!0===R.isXRRenderTarget?R.texture.colorSpace:LinearSRGBColorSpace,map:L,matcap:D,envMap:k,envMapMode:k&&A.mapping,envMapCubeUVHeight:x,aoMap:I,lightMap:B,bumpMap:U,normalMap:F,displacementMap:d&&j,emissiveMap:V,normalMapObjectSpace:F&&s.normalMapType===ObjectSpaceNormalMap,normalMapTangentSpace:F&&s.normalMapType===TangentSpaceNormalMap,metalnessMap:z,roughnessMap:G,anisotropy:H,anisotropyMap:$,clearcoat:Y,clearcoatMap:q,clearcoatNormalMap:K,clearcoatRoughnessMap:Z,iridescence:X,iridescenceMap:Q,iridescenceThicknessMap:tt,sheen:W,sheenColorMap:et,sheenRoughnessMap:it,specularMap:rt,specularColorMap:nt,specularIntensityMap:st,transmission:J,transmissionMap:ot,thicknessMap:at,gradientMap:lt,opaque:!1===s.transparent&&s.blending===NormalBlending,alphaMap:ct,alphaTest:ht,alphaHash:ut,combine:s.combine,mapUv:L&&m(s.map.channel),aoMapUv:I&&m(s.aoMap.channel),lightMapUv:B&&m(s.lightMap.channel),bumpMapUv:U&&m(s.bumpMap.channel),normalMapUv:F&&m(s.normalMap.channel),displacementMapUv:j&&m(s.displacementMap.channel),emissiveMapUv:V&&m(s.emissiveMap.channel),metalnessMapUv:z&&m(s.metalnessMap.channel),roughnessMapUv:G&&m(s.roughnessMap.channel),anisotropyMapUv:$&&m(s.anisotropyMap.channel),clearcoatMapUv:q&&m(s.clearcoatMap.channel),clearcoatNormalMapUv:K&&m(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Z&&m(s.clearcoatRoughnessMap.channel),iridescenceMapUv:Q&&m(s.iridescenceMap.channel),iridescenceThicknessMapUv:tt&&m(s.iridescenceThicknessMap.channel),sheenColorMapUv:et&&m(s.sheenColorMap.channel),sheenRoughnessMapUv:it&&m(s.sheenRoughnessMap.channel),specularMapUv:rt&&m(s.specularMap.channel),specularColorMapUv:nt&&m(s.specularColorMap.channel),specularIntensityMapUv:st&&m(s.specularIntensityMap.channel),transmissionMapUv:ot&&m(s.transmissionMap.channel),thicknessMapUv:at&&m(s.thicknessMap.channel),alphaMapUv:ct&&m(s.alphaMap.channel),vertexTangents:!!y.attributes.tangent&&(F||H),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,vertexUv1s:pt,vertexUv2s:ft,vertexUv3s:mt,pointsUvs:!0===_.isPoints&&!!y.attributes.uv&&(L||ct),fog:!!v,useFog:!0===s.fog,fogExp2:v&&v.isFogExp2,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===_.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:M,morphTextureStride:O,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&c.length>0,shadowMapType:t.shadowMap.type,toneMapping:gt,useLegacyLights:t._useLegacyLights,decodeVideoTexture:L&&!0===s.map.isVideoTexture&&s.map.colorSpace===SRGBColorSpace,premultipliedAlpha:s.premultipliedAlpha,doubleSided:s.side===DoubleSide,flipSided:s.side===BackSide,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:dt&&!0===s.extensions.derivatives,extensionFragDepth:dt&&!0===s.extensions.fragDepth,extensionDrawBuffers:dt&&!0===s.extensions.drawBuffers,extensionShaderTextureLOD:dt&&!0===s.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||r.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.customVertexShaderID),i.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(function(t,e){t.push(e.precision),t.push(e.outputColorSpace),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.mapUv),t.push(e.alphaMapUv),t.push(e.lightMapUv),t.push(e.aoMapUv),t.push(e.bumpMapUv),t.push(e.normalMapUv),t.push(e.displacementMapUv),t.push(e.emissiveMapUv),t.push(e.metalnessMapUv),t.push(e.roughnessMapUv),t.push(e.anisotropyMapUv),t.push(e.clearcoatMapUv),t.push(e.clearcoatNormalMapUv),t.push(e.clearcoatRoughnessMapUv),t.push(e.iridescenceMapUv),t.push(e.iridescenceThicknessMapUv),t.push(e.sheenColorMapUv),t.push(e.sheenRoughnessMapUv),t.push(e.specularMapUv),t.push(e.specularColorMapUv),t.push(e.specularIntensityMapUv),t.push(e.transmissionMapUv),t.push(e.thicknessMapUv),t.push(e.combine),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(i,e),function(t,e){a.disableAll(),e.isWebGL2&&a.enable(0),e.supportsVertexTextures&&a.enable(1),e.instancing&&a.enable(2),e.instancingColor&&a.enable(3),e.matcap&&a.enable(4),e.envMap&&a.enable(5),e.normalMapObjectSpace&&a.enable(6),e.normalMapTangentSpace&&a.enable(7),e.clearcoat&&a.enable(8),e.iridescence&&a.enable(9),e.alphaTest&&a.enable(10),e.vertexColors&&a.enable(11),e.vertexAlphas&&a.enable(12),e.vertexUv1s&&a.enable(13),e.vertexUv2s&&a.enable(14),e.vertexUv3s&&a.enable(15),e.vertexTangents&&a.enable(16),e.anisotropy&&a.enable(17),t.push(a.mask),a.disableAll(),e.fog&&a.enable(0),e.useFog&&a.enable(1),e.flatShading&&a.enable(2),e.logarithmicDepthBuffer&&a.enable(3),e.skinning&&a.enable(4),e.morphTargets&&a.enable(5),e.morphNormals&&a.enable(6),e.morphColors&&a.enable(7),e.premultipliedAlpha&&a.enable(8),e.shadowMapEnabled&&a.enable(9),e.useLegacyLights&&a.enable(10),e.doubleSided&&a.enable(11),e.flipSided&&a.enable(12),e.useDepthPacking&&a.enable(13),e.dithering&&a.enable(14),e.transmission&&a.enable(15),e.sheen&&a.enable(16),e.opaque&&a.enable(17),e.pointsUvs&&a.enable(18),e.decodeVideoTexture&&a.enable(19),t.push(a.mask)}(i,e),i.push(t.outputColorSpace)),i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=f[t.type];let i;if(e){const t=ShaderLib[e];i=UniformsUtils.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let r;for(let t=0,e=c.length;t<e;t++){const e=c[t];if(e.cacheKey===i){r=e,++r.usedTimes;break}}return void 0===r&&(r=new WebGLProgram(t,i,e,s),c.push(r)),r},releaseProgram:function(t){if(0===--t.usedTimes){const e=c.indexOf(t);c[e]=c[c.length-1],c.pop(),t.destroy()}},releaseShaderCache:function(t){l.remove(t)},programs:c,dispose:function(){l.dispose()}}}function WebGLProperties(){let t=new WeakMap;return{get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,r){t.get(e)[i]=r},dispose:function(){t=new WeakMap}}}function painterSortStable(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function reversePainterSortStable(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function WebGLRenderList(){const t=[];let e=0;const i=[],r=[],n=[];function s(i,r,n,s,o,a){let l=t[e];return void 0===l?(l={id:i.id,object:i,geometry:r,material:n,groupOrder:s,renderOrder:i.renderOrder,z:o,group:a},t[e]=l):(l.id=i.id,l.object=i,l.geometry=r,l.material=n,l.groupOrder=s,l.renderOrder=i.renderOrder,l.z=o,l.group=a),e++,l}return{opaque:i,transmissive:r,transparent:n,init:function(){e=0,i.length=0,r.length=0,n.length=0},push:function(t,e,o,a,l,c){const h=s(t,e,o,a,l,c);o.transmission>0?r.push(h):!0===o.transparent?n.push(h):i.push(h)},unshift:function(t,e,o,a,l,c){const h=s(t,e,o,a,l,c);o.transmission>0?r.unshift(h):!0===o.transparent?n.unshift(h):i.unshift(h)},finish:function(){for(let i=e,r=t.length;i<r;i++){const e=t[i];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){i.length>1&&i.sort(t||painterSortStable),r.length>1&&r.sort(e||reversePainterSortStable),n.length>1&&n.sort(e||reversePainterSortStable)}}}function WebGLRenderLists(){let t=new WeakMap;return{get:function(e,i){const r=t.get(e);let n;return void 0===r?(n=new WebGLRenderList,t.set(e,[n])):i>=r.length?(n=new WebGLRenderList,r.push(n)):n=r[i],n},dispose:function(){t=new WeakMap}}}function UniformsCache(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new Vector3,color:new Color};break;case"SpotLight":i={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":i={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return t[e.id]=i,i}}}function ShadowUniformsCache(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}let nextVersion=0;function shadowCastingAndTexturingLightsFirst(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function WebGLLights(t,e){const i=new UniformsCache,r=ShadowUniformsCache(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let t=0;t<9;t++)n.probe.push(new Vector3);const s=new Vector3,o=new Matrix4,a=new Matrix4;return{setup:function(s,o){let a=0,l=0,c=0;for(let t=0;t<9;t++)n.probe[t].set(0,0,0);let h=0,u=0,d=0,p=0,f=0,m=0,g=0,_=0,v=0,y=0;s.sort(shadowCastingAndTexturingLightsFirst);const b=!0===o?Math.PI:1;for(let t=0,e=s.length;t<e;t++){const e=s[t],o=e.color,A=e.intensity,x=e.distance,C=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)a+=o.r*A*b,l+=o.g*A*b,c+=o.b*A*b;else if(e.isLightProbe)for(let t=0;t<9;t++)n.probe[t].addScaledVector(e.sh.coefficients[t],A);else if(e.isDirectionalLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*b),e.castShadow){const t=e.shadow,i=r.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,n.directionalShadow[h]=i,n.directionalShadowMap[h]=C,n.directionalShadowMatrix[h]=e.shadow.matrix,m++}n.directional[h]=t,h++}else if(e.isSpotLight){const t=i.get(e);t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(o).multiplyScalar(A*b),t.distance=x,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,n.spot[d]=t;const s=e.shadow;if(e.map&&(n.spotLightMap[v]=e.map,v++,s.updateMatrices(e),e.castShadow&&y++),n.spotLightMatrix[d]=s.matrix,e.castShadow){const t=r.get(e);t.shadowBias=s.bias,t.shadowNormalBias=s.normalBias,t.shadowRadius=s.radius,t.shadowMapSize=s.mapSize,n.spotShadow[d]=t,n.spotShadowMap[d]=C,_++}d++}else if(e.isRectAreaLight){const t=i.get(e);t.color.copy(o).multiplyScalar(A),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),n.rectArea[p]=t,p++}else if(e.isPointLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*b),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,i=r.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,n.pointShadow[u]=i,n.pointShadowMap[u]=C,n.pointShadowMatrix[u]=e.shadow.matrix,g++}n.point[u]=t,u++}else if(e.isHemisphereLight){const t=i.get(e);t.skyColor.copy(e.color).multiplyScalar(A*b),t.groundColor.copy(e.groundColor).multiplyScalar(A*b),n.hemi[f]=t,f++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(n.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,n.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(n.rectAreaLTC1=UniformsLib.LTC_HALF_1,n.rectAreaLTC2=UniformsLib.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=a,n.ambient[1]=l,n.ambient[2]=c;const A=n.hash;A.directionalLength===h&&A.pointLength===u&&A.spotLength===d&&A.rectAreaLength===p&&A.hemiLength===f&&A.numDirectionalShadows===m&&A.numPointShadows===g&&A.numSpotShadows===_&&A.numSpotMaps===v||(n.directional.length=h,n.spot.length=d,n.rectArea.length=p,n.point.length=u,n.hemi.length=f,n.directionalShadow.length=m,n.directionalShadowMap.length=m,n.pointShadow.length=g,n.pointShadowMap.length=g,n.spotShadow.length=_,n.spotShadowMap.length=_,n.directionalShadowMatrix.length=m,n.pointShadowMatrix.length=g,n.spotLightMatrix.length=_+v-y,n.spotLightMap.length=v,n.numSpotLightShadowsWithMaps=y,A.directionalLength=h,A.pointLength=u,A.spotLength=d,A.rectAreaLength=p,A.hemiLength=f,A.numDirectionalShadows=m,A.numPointShadows=g,A.numSpotShadows=_,A.numSpotMaps=v,n.version=nextVersion++)},setupView:function(t,e){let i=0,r=0,l=0,c=0,h=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=n.directional[i];t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),i++}else if(d.isSpotLight){const t=n.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const t=n.rectArea[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),a.identity(),o.copy(d.matrixWorld),o.premultiply(u),a.extractRotation(o),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const t=n.point[r];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),r++}else if(d.isHemisphereLight){const t=n.hemi[h];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),h++}}},state:n}}function WebGLRenderState(t,e){const i=new WebGLLights(t,e),r=[],n=[];return{init:function(){r.length=0,n.length=0},state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:function(t){i.setup(r,t)},setupLightsView:function(t){i.setupView(r,t)},pushLight:function(t){r.push(t)},pushShadow:function(t){n.push(t)}}}function WebGLRenderStates(t,e){let i=new WeakMap;return{get:function(r,n=0){const s=i.get(r);let o;return void 0===s?(o=new WebGLRenderState(t,e),i.set(r,[o])):n>=s.length?(o=new WebGLRenderState(t,e),s.push(o)):o=s[n],o},dispose:function(){i=new WeakMap}}}class MeshDepthMaterial extends Material{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class MeshDistanceMaterial extends Material{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const vertex="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragment="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function WebGLShadowMap(t,e,i){let r=new Frustum;const n=new Vector2,s=new Vector2,o=new Vector4,a=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),l=new MeshDistanceMaterial,c={},h=i.maxTextureSize,u={[FrontSide]:BackSide,[BackSide]:FrontSide,[DoubleSide]:DoubleSide},d=new ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vertex,fragmentShader:fragment}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new BufferGeometry;f.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Mesh(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap;let _=this.type;function v(i,r){const s=e.update(m);d.defines.VSM_SAMPLES!==i.blurSamples&&(d.defines.VSM_SAMPLES=i.blurSamples,p.defines.VSM_SAMPLES=i.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===i.mapPass&&(i.mapPass=new WebGLRenderTarget(n.x,n.y)),d.uniforms.shadow_pass.value=i.map.texture,d.uniforms.resolution.value=i.mapSize,d.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(r,null,s,d,m,null),p.uniforms.shadow_pass.value=i.mapPass.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(r,null,s,p,m,null)}function y(e,i,r,n){let s=null;const o=!0===r.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(void 0!==o)s=o;else if(s=!0===r.isPointLight?l:a,t.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0||i.map&&i.alphaTest>0){const t=s.uuid,e=i.uuid;let r=c[t];void 0===r&&(r={},c[t]=r);let n=r[e];void 0===n&&(n=s.clone(),r[e]=n),s=n}return s.visible=i.visible,s.wireframe=i.wireframe,s.side=n===VSMShadowMap?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:u[i.side],s.alphaMap=i.alphaMap,s.alphaTest=i.alphaTest,s.map=i.map,s.clipShadows=i.clipShadows,s.clippingPlanes=i.clippingPlanes,s.clipIntersection=i.clipIntersection,s.displacementMap=i.displacementMap,s.displacementScale=i.displacementScale,s.displacementBias=i.displacementBias,s.wireframeLinewidth=i.wireframeLinewidth,s.linewidth=i.linewidth,!0===r.isPointLight&&!0===s.isMeshDistanceMaterial&&(t.properties.get(s).light=r),s}function b(i,n,s,o,a){if(!1===i.visible)return;if(i.layers.test(n.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&a===VSMShadowMap)&&(!i.frustumCulled||r.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const r=e.update(i),n=i.material;if(Array.isArray(n)){const e=r.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],h=n[c.materialIndex];if(h&&h.visible){const e=y(i,h,o,a);t.renderBufferDirect(s,null,r,e,i,c)}}}else if(n.visible){const e=y(i,n,o,a);t.renderBufferDirect(s,null,r,e,i,null)}}const l=i.children;for(let t=0,e=l.length;t<e;t++)b(l[t],n,s,o,a)}this.render=function(e,i,a){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),c=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(NoBlending),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=_!==VSMShadowMap&&this.type===VSMShadowMap,f=_===VSMShadowMap&&this.type!==VSMShadowMap;for(let l=0,c=e.length;l<c;l++){const c=e[l],u=c.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;n.copy(u.mapSize);const m=u.getFrameExtents();if(n.multiply(m),s.copy(u.mapSize),(n.x>h||n.y>h)&&(n.x>h&&(s.x=Math.floor(h/m.x),n.x=s.x*m.x,u.mapSize.x=s.x),n.y>h&&(s.y=Math.floor(h/m.y),n.y=s.y*m.y,u.mapSize.y=s.y)),null===u.map||!0===p||!0===f){const t=this.type!==VSMShadowMap?{minFilter:NearestFilter,magFilter:NearestFilter}:{};null!==u.map&&u.map.dispose(),u.map=new WebGLRenderTarget(n.x,n.y,t),u.map.texture.name=c.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const g=u.getViewportCount();for(let t=0;t<g;t++){const e=u.getViewport(t);o.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(o),u.updateMatrices(c,t),r=u.getFrustum(),b(i,a,u.camera,c,this.type)}!0!==u.isPointLightShadow&&this.type===VSMShadowMap&&v(u,a),u.needsUpdate=!1}_=this.type,g.needsUpdate=!1,t.setRenderTarget(l,c,u)}}function WebGLState(t,e,i){const r=i.isWebGL2,n=new function(){let e=!1;const i=new Vector4;let r=null;const n=new Vector4(0,0,0,0);return{setMask:function(i){r===i||e||(t.colorMask(i,i,i,i),r=i)},setLocked:function(t){e=t},setClear:function(e,r,s,o,a){!0===a&&(e*=o,r*=o,s*=o),i.set(e,r,s,o),!1===n.equals(i)&&(t.clearColor(e,r,s,o),n.copy(i))},reset:function(){e=!1,r=null,n.set(-1,0,0,0)}}},s=new function(){let e=!1,i=null,r=null,n=null;return{setTest:function(e){e?j(t.DEPTH_TEST):V(t.DEPTH_TEST)},setMask:function(r){i===r||e||(t.depthMask(r),i=r)},setFunc:function(e){if(r!==e){switch(e){case NeverDepth:t.depthFunc(t.NEVER);break;case AlwaysDepth:t.depthFunc(t.ALWAYS);break;case LessDepth:t.depthFunc(t.LESS);break;case LessEqualDepth:t.depthFunc(t.LEQUAL);break;case EqualDepth:t.depthFunc(t.EQUAL);break;case GreaterEqualDepth:t.depthFunc(t.GEQUAL);break;case GreaterDepth:t.depthFunc(t.GREATER);break;case NotEqualDepth:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}r=e}},setLocked:function(t){e=t},setClear:function(e){n!==e&&(t.clearDepth(e),n=e)},reset:function(){e=!1,i=null,r=null,n=null}}},o=new function(){let e=!1,i=null,r=null,n=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(i){e||(i?j(t.STENCIL_TEST):V(t.STENCIL_TEST))},setMask:function(r){i===r||e||(t.stencilMask(r),i=r)},setFunc:function(e,i,o){r===e&&n===i&&s===o||(t.stencilFunc(e,i,o),r=e,n=i,s=o)},setOp:function(e,i,r){o===e&&a===i&&l===r||(t.stencilOp(e,i,r),o=e,a=i,l=r)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,i=null,r=null,n=null,s=null,o=null,a=null,l=null,c=null}}},a=new WeakMap,l=new WeakMap;let c={},h={},u=new WeakMap,d=[],p=null,f=!1,m=null,g=null,_=null,v=null,y=null,b=null,A=null,x=!1,C=null,E=null,M=null,S=null,w=null;const P=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let T=!1,O=0;const R=t.getParameter(t.VERSION);-1!==R.indexOf("WebGL")?(O=parseFloat(/^WebGL (\d)/.exec(R)[1]),T=O>=1):-1!==R.indexOf("OpenGL ES")&&(O=parseFloat(/^OpenGL ES (\d)/.exec(R)[1]),T=O>=2);let N=null,L={};const D=t.getParameter(t.SCISSOR_BOX),k=t.getParameter(t.VIEWPORT),I=(new Vector4).fromArray(D),B=(new Vector4).fromArray(k);function U(e,i,n,s){const o=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let a=0;a<n;a++)!r||e!==t.TEXTURE_3D&&e!==t.TEXTURE_2D_ARRAY?t.texImage2D(i+a,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,o):t.texImage3D(i,0,t.RGBA,1,1,s,0,t.RGBA,t.UNSIGNED_BYTE,o);return a}const F={};function j(e){!0!==c[e]&&(t.enable(e),c[e]=!0)}function V(e){!1!==c[e]&&(t.disable(e),c[e]=!1)}F[t.TEXTURE_2D]=U(t.TEXTURE_2D,t.TEXTURE_2D,1),F[t.TEXTURE_CUBE_MAP]=U(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(F[t.TEXTURE_2D_ARRAY]=U(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),F[t.TEXTURE_3D]=U(t.TEXTURE_3D,t.TEXTURE_3D,1,1)),n.setClear(0,0,0,1),s.setClear(1),o.setClear(0),j(t.DEPTH_TEST),s.setFunc(LessEqualDepth),Y(!1),X(CullFaceBack),j(t.CULL_FACE),H(NoBlending);const z={[AddEquation]:t.FUNC_ADD,[SubtractEquation]:t.FUNC_SUBTRACT,[ReverseSubtractEquation]:t.FUNC_REVERSE_SUBTRACT};if(r)z[MinEquation]=t.MIN,z[MaxEquation]=t.MAX;else{const t=e.get("EXT_blend_minmax");null!==t&&(z[MinEquation]=t.MIN_EXT,z[MaxEquation]=t.MAX_EXT)}const G={[ZeroFactor]:t.ZERO,[OneFactor]:t.ONE,[SrcColorFactor]:t.SRC_COLOR,[SrcAlphaFactor]:t.SRC_ALPHA,[SrcAlphaSaturateFactor]:t.SRC_ALPHA_SATURATE,[DstColorFactor]:t.DST_COLOR,[DstAlphaFactor]:t.DST_ALPHA,[OneMinusSrcColorFactor]:t.ONE_MINUS_SRC_COLOR,[OneMinusSrcAlphaFactor]:t.ONE_MINUS_SRC_ALPHA,[OneMinusDstColorFactor]:t.ONE_MINUS_DST_COLOR,[OneMinusDstAlphaFactor]:t.ONE_MINUS_DST_ALPHA};function H(e,i,r,n,s,o,a,l){if(e!==NoBlending){if(!1===f&&(j(t.BLEND),f=!0),e===CustomBlending)s=s||i,o=o||r,a=a||n,i===g&&s===y||(t.blendEquationSeparate(z[i],z[s]),g=i,y=s),r===_&&n===v&&o===b&&a===A||(t.blendFuncSeparate(G[r],G[n],G[o],G[a]),_=r,v=n,b=o,A=a),m=e,x=!1;else if(e!==m||l!==x){if(g===AddEquation&&y===AddEquation||(t.blendEquation(t.FUNC_ADD),g=AddEquation,y=AddEquation),l)switch(e){case NormalBlending:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:t.blendFunc(t.ONE,t.ONE);break;case SubtractiveBlending:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case MultiplyBlending:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case NormalBlending:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case SubtractiveBlending:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case MultiplyBlending:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}_=null,v=null,b=null,A=null,m=e,x=l}}else!0===f&&(V(t.BLEND),f=!1)}function Y(e){C!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),C=e)}function X(e){e!==CullFaceNone?(j(t.CULL_FACE),e!==E&&(e===CullFaceBack?t.cullFace(t.BACK):e===CullFaceFront?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):V(t.CULL_FACE),E=e}function W(e,i,r){e?(j(t.POLYGON_OFFSET_FILL),S===i&&w===r||(t.polygonOffset(i,r),S=i,w=r)):V(t.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:s,stencil:o},enable:j,disable:V,bindFramebuffer:function(e,i){return h[e]!==i&&(t.bindFramebuffer(e,i),h[e]=i,r&&(e===t.DRAW_FRAMEBUFFER&&(h[t.FRAMEBUFFER]=i),e===t.FRAMEBUFFER&&(h[t.DRAW_FRAMEBUFFER]=i)),!0)},drawBuffers:function(r,n){let s=d,o=!1;if(r)if(s=u.get(n),void 0===s&&(s=[],u.set(n,s)),r.isWebGLMultipleRenderTargets){const e=r.texture;if(s.length!==e.length||s[0]!==t.COLOR_ATTACHMENT0){for(let i=0,r=e.length;i<r;i++)s[i]=t.COLOR_ATTACHMENT0+i;s.length=e.length,o=!0}}else s[0]!==t.COLOR_ATTACHMENT0&&(s[0]=t.COLOR_ATTACHMENT0,o=!0);else s[0]!==t.BACK&&(s[0]=t.BACK,o=!0);o&&(i.isWebGL2?t.drawBuffers(s):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(e){return p!==e&&(t.useProgram(e),p=e,!0)},setBlending:H,setMaterial:function(e,i){e.side===DoubleSide?V(t.CULL_FACE):j(t.CULL_FACE);let r=e.side===BackSide;i&&(r=!r),Y(r),e.blending===NormalBlending&&!1===e.transparent?H(NoBlending):H(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),n.setMask(e.colorWrite);const a=e.stencilWrite;o.setTest(a),a&&(o.setMask(e.stencilWriteMask),o.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),o.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),W(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?j(t.SAMPLE_ALPHA_TO_COVERAGE):V(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Y,setCullFace:X,setLineWidth:function(e){e!==M&&(T&&t.lineWidth(e),M=e)},setPolygonOffset:W,setScissorTest:function(e){e?j(t.SCISSOR_TEST):V(t.SCISSOR_TEST)},activeTexture:function(e){void 0===e&&(e=t.TEXTURE0+P-1),N!==e&&(t.activeTexture(e),N=e)},bindTexture:function(e,i,r){void 0===r&&(r=null===N?t.TEXTURE0+P-1:N);let n=L[r];void 0===n&&(n={type:void 0,texture:void 0},L[r]=n),n.type===e&&n.texture===i||(N!==r&&(t.activeTexture(r),N=r),t.bindTexture(e,i||F[e]),n.type=e,n.texture=i)},unbindTexture:function(){const e=L[N];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{t.compressedTexImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(e,i){let r=l.get(i);void 0===r&&(r=new WeakMap,l.set(i,r));let n=r.get(e);void 0===n&&(n=t.getUniformBlockIndex(i,e.name),r.set(e,n))},uniformBlockBinding:function(e,i){const r=l.get(i).get(e);a.get(i)!==r&&(t.uniformBlockBinding(i,r,e.__bindingPointIndex),a.set(i,r))},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===I.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),I.copy(e))},viewport:function(e){!1===B.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),B.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),!0===r&&(t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),c={},N=null,L={},h={},u=new WeakMap,d=[],p=null,f=!1,m=null,g=null,_=null,v=null,y=null,b=null,A=null,x=!1,C=null,E=null,M=null,S=null,w=null,I.set(0,0,t.canvas.width,t.canvas.height),B.set(0,0,t.canvas.width,t.canvas.height),n.reset(),s.reset(),o.reset()}}}function WebGLTextures(t,e,i,r,n,s,o){const a=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,h=n.maxTextureSize,u=n.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let m;const g=new WeakMap;let _=!1;try{_="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function v(t,e){return _?new OffscreenCanvas(t,e):createElementNS("canvas")}function y(t,e,i,r){let n=1;if((t.width>r||t.height>r)&&(n=r/Math.max(t.width,t.height)),n<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const r=e?floorPowerOfTwo:Math.floor,s=r(n*t.width),o=r(n*t.height);void 0===m&&(m=v(s,o));const a=i?v(s,o):m;return a.width=s,a.height=o,a.getContext("2d").drawImage(t,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+o+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function b(t){return isPowerOfTwo(t.width)&&isPowerOfTwo(t.height)}function A(t,e){return t.generateMipmaps&&e&&t.minFilter!==NearestFilter&&t.minFilter!==LinearFilter}function x(e){t.generateMipmap(e)}function C(i,r,n,s,o=!1){if(!1===a)return r;if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let l=r;return r===t.RED&&(n===t.FLOAT&&(l=t.R32F),n===t.HALF_FLOAT&&(l=t.R16F),n===t.UNSIGNED_BYTE&&(l=t.R8)),r===t.RED_INTEGER&&(n===t.UNSIGNED_BYTE&&(l=t.R8UI),n===t.UNSIGNED_SHORT&&(l=t.R16UI),n===t.UNSIGNED_INT&&(l=t.R32UI),n===t.BYTE&&(l=t.R8I),n===t.SHORT&&(l=t.R16I),n===t.INT&&(l=t.R32I)),r===t.RG&&(n===t.FLOAT&&(l=t.RG32F),n===t.HALF_FLOAT&&(l=t.RG16F),n===t.UNSIGNED_BYTE&&(l=t.RG8)),r===t.RGBA&&(n===t.FLOAT&&(l=t.RGBA32F),n===t.HALF_FLOAT&&(l=t.RGBA16F),n===t.UNSIGNED_BYTE&&(l=s===SRGBColorSpace&&!1===o?t.SRGB8_ALPHA8:t.RGBA8),n===t.UNSIGNED_SHORT_4_4_4_4&&(l=t.RGBA4),n===t.UNSIGNED_SHORT_5_5_5_1&&(l=t.RGB5_A1)),l!==t.R16F&&l!==t.R32F&&l!==t.RG16F&&l!==t.RG32F&&l!==t.RGBA16F&&l!==t.RGBA32F||e.get("EXT_color_buffer_float"),l}function E(t,e,i){return!0===A(t,i)||t.isFramebufferTexture&&t.minFilter!==NearestFilter&&t.minFilter!==LinearFilter?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function M(e){return e===NearestFilter||e===NearestMipmapNearestFilter||e===NearestMipmapLinearFilter?t.NEAREST:t.LINEAR}function S(t){const e=t.target;e.removeEventListener("dispose",S),function(t){const e=r.get(t);if(void 0===e.__webglInit)return;const i=t.source,n=g.get(i);if(n){const r=n[e.__cacheKey];r.usedTimes--,0===r.usedTimes&&P(t),0===Object.keys(n).length&&g.delete(i)}r.remove(t)}(e),e.isVideoTexture&&f.delete(e)}function w(e){const i=e.target;i.removeEventListener("dispose",w),function(e){const i=e.texture,n=r.get(e),s=r.get(i);if(void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),o.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++){if(Array.isArray(n.__webglFramebuffer[e]))for(let i=0;i<n.__webglFramebuffer[e].length;i++)t.deleteFramebuffer(n.__webglFramebuffer[e][i]);else t.deleteFramebuffer(n.__webglFramebuffer[e]);n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[e])}else{if(Array.isArray(n.__webglFramebuffer))for(let e=0;e<n.__webglFramebuffer.length;e++)t.deleteFramebuffer(n.__webglFramebuffer[e]);else t.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let e=0;e<n.__webglColorRenderbuffer.length;e++)n.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(n.__webglColorRenderbuffer[e]);n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer)}if(e.isWebGLMultipleRenderTargets)for(let e=0,n=i.length;e<n;e++){const n=r.get(i[e]);n.__webglTexture&&(t.deleteTexture(n.__webglTexture),o.memory.textures--),r.remove(i[e])}r.remove(i),r.remove(e)}(i)}function P(e){const i=r.get(e);t.deleteTexture(i.__webglTexture);const n=e.source;delete g.get(n)[i.__cacheKey],o.memory.textures--}let T=0;function O(e,n){const s=r.get(e);if(e.isVideoTexture&&function(t){const e=o.render.frame;f.get(t)!==e&&(f.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&s.__version!==e.version){const t=e.image;if(null===t)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==t.complete)return void I(s,e,n);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.bindTexture(t.TEXTURE_2D,s.__webglTexture,t.TEXTURE0+n)}const R={[RepeatWrapping]:t.REPEAT,[ClampToEdgeWrapping]:t.CLAMP_TO_EDGE,[MirroredRepeatWrapping]:t.MIRRORED_REPEAT},N={[NearestFilter]:t.NEAREST,[NearestMipmapNearestFilter]:t.NEAREST_MIPMAP_NEAREST,[NearestMipmapLinearFilter]:t.NEAREST_MIPMAP_LINEAR,[LinearFilter]:t.LINEAR,[LinearMipmapNearestFilter]:t.LINEAR_MIPMAP_NEAREST,[LinearMipmapLinearFilter]:t.LINEAR_MIPMAP_LINEAR},L={[NeverCompare]:t.NEVER,[AlwaysCompare]:t.ALWAYS,[LessCompare]:t.LESS,[LessEqualCompare]:t.LEQUAL,[EqualCompare]:t.EQUAL,[GreaterEqualCompare]:t.GEQUAL,[GreaterCompare]:t.GREATER,[NotEqualCompare]:t.NOTEQUAL};function D(i,s,o){if(o?(t.texParameteri(i,t.TEXTURE_WRAP_S,R[s.wrapS]),t.texParameteri(i,t.TEXTURE_WRAP_T,R[s.wrapT]),i!==t.TEXTURE_3D&&i!==t.TEXTURE_2D_ARRAY||t.texParameteri(i,t.TEXTURE_WRAP_R,R[s.wrapR]),t.texParameteri(i,t.TEXTURE_MAG_FILTER,N[s.magFilter]),t.texParameteri(i,t.TEXTURE_MIN_FILTER,N[s.minFilter])):(t.texParameteri(i,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(i,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i!==t.TEXTURE_3D&&i!==t.TEXTURE_2D_ARRAY||t.texParameteri(i,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),s.wrapS===ClampToEdgeWrapping&&s.wrapT===ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(i,t.TEXTURE_MAG_FILTER,M(s.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,M(s.minFilter)),s.minFilter!==NearestFilter&&s.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),s.compareFunction&&(t.texParameteri(i,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(i,t.TEXTURE_COMPARE_FUNC,L[s.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){const o=e.get("EXT_texture_filter_anisotropic");if(s.magFilter===NearestFilter)return;if(s.minFilter!==NearestMipmapLinearFilter&&s.minFilter!==LinearMipmapLinearFilter)return;if(s.type===FloatType&&!1===e.has("OES_texture_float_linear"))return;if(!1===a&&s.type===HalfFloatType&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||r.get(s).__currentAnisotropy)&&(t.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,n.getMaxAnisotropy())),r.get(s).__currentAnisotropy=s.anisotropy)}}function k(e,i){let r=!1;void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",S));const n=i.source;let s=g.get(n);void 0===s&&(s={},g.set(n,s));const a=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.colorSpace),e.join()}(i);if(a!==e.__cacheKey){void 0===s[a]&&(s[a]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,r=!0),s[a].usedTimes++;const n=s[e.__cacheKey];void 0!==n&&(s[e.__cacheKey].usedTimes--,0===n.usedTimes&&P(i)),e.__cacheKey=a,e.__webglTexture=s[a].texture}return r}function I(e,n,o){let l=t.TEXTURE_2D;(n.isDataArrayTexture||n.isCompressedArrayTexture)&&(l=t.TEXTURE_2D_ARRAY),n.isData3DTexture&&(l=t.TEXTURE_3D);const c=k(e,n),u=n.source;i.bindTexture(l,e.__webglTexture,t.TEXTURE0+o);const d=r.get(u);if(u.version!==d.__version||!0===c){i.activeTexture(t.TEXTURE0+o),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,n.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,n.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);const e=function(t){return!a&&(t.wrapS!==ClampToEdgeWrapping||t.wrapT!==ClampToEdgeWrapping||t.minFilter!==NearestFilter&&t.minFilter!==LinearFilter)}(n)&&!1===b(n.image);let r=y(n.image,e,!1,h);r=z(n,r);const p=b(r)||a,f=s.convert(n.format,n.colorSpace);let m,g=s.convert(n.type),_=C(n.internalFormat,f,g,n.colorSpace,n.isVideoTexture);D(l,n,p);const v=n.mipmaps,M=a&&!0!==n.isVideoTexture,S=void 0===d.__version||!0===c,w=E(n,r,p);if(n.isDepthTexture)_=t.DEPTH_COMPONENT,a?_=n.type===FloatType?t.DEPTH_COMPONENT32F:n.type===UnsignedIntType?t.DEPTH_COMPONENT24:n.type===UnsignedInt248Type?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT16:n.type===FloatType&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===DepthFormat&&_===t.DEPTH_COMPONENT&&n.type!==UnsignedShortType&&n.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=UnsignedIntType,g=s.convert(n.type)),n.format===DepthStencilFormat&&_===t.DEPTH_COMPONENT&&(_=t.DEPTH_STENCIL,n.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=UnsignedInt248Type,g=s.convert(n.type))),S&&(M?i.texStorage2D(t.TEXTURE_2D,1,_,r.width,r.height):i.texImage2D(t.TEXTURE_2D,0,_,r.width,r.height,0,f,g,null));else if(n.isDataTexture)if(v.length>0&&p){M&&S&&i.texStorage2D(t.TEXTURE_2D,w,_,v[0].width,v[0].height);for(let e=0,r=v.length;e<r;e++)m=v[e],M?i.texSubImage2D(t.TEXTURE_2D,e,0,0,m.width,m.height,f,g,m.data):i.texImage2D(t.TEXTURE_2D,e,_,m.width,m.height,0,f,g,m.data);n.generateMipmaps=!1}else M?(S&&i.texStorage2D(t.TEXTURE_2D,w,_,r.width,r.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,r.width,r.height,f,g,r.data)):i.texImage2D(t.TEXTURE_2D,0,_,r.width,r.height,0,f,g,r.data);else if(n.isCompressedTexture)if(n.isCompressedArrayTexture){M&&S&&i.texStorage3D(t.TEXTURE_2D_ARRAY,w,_,v[0].width,v[0].height,r.depth);for(let e=0,s=v.length;e<s;e++)m=v[e],n.format!==RGBAFormat?null!==f?M?i.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,m.width,m.height,r.depth,f,m.data,0,0):i.compressedTexImage3D(t.TEXTURE_2D_ARRAY,e,_,m.width,m.height,r.depth,0,m.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):M?i.texSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,m.width,m.height,r.depth,f,g,m.data):i.texImage3D(t.TEXTURE_2D_ARRAY,e,_,m.width,m.height,r.depth,0,f,g,m.data)}else{M&&S&&i.texStorage2D(t.TEXTURE_2D,w,_,v[0].width,v[0].height);for(let e=0,r=v.length;e<r;e++)m=v[e],n.format!==RGBAFormat?null!==f?M?i.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,m.width,m.height,f,m.data):i.compressedTexImage2D(t.TEXTURE_2D,e,_,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):M?i.texSubImage2D(t.TEXTURE_2D,e,0,0,m.width,m.height,f,g,m.data):i.texImage2D(t.TEXTURE_2D,e,_,m.width,m.height,0,f,g,m.data)}else if(n.isDataArrayTexture)M?(S&&i.texStorage3D(t.TEXTURE_2D_ARRAY,w,_,r.width,r.height,r.depth),i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,r.width,r.height,r.depth,f,g,r.data)):i.texImage3D(t.TEXTURE_2D_ARRAY,0,_,r.width,r.height,r.depth,0,f,g,r.data);else if(n.isData3DTexture)M?(S&&i.texStorage3D(t.TEXTURE_3D,w,_,r.width,r.height,r.depth),i.texSubImage3D(t.TEXTURE_3D,0,0,0,0,r.width,r.height,r.depth,f,g,r.data)):i.texImage3D(t.TEXTURE_3D,0,_,r.width,r.height,r.depth,0,f,g,r.data);else if(n.isFramebufferTexture){if(S)if(M)i.texStorage2D(t.TEXTURE_2D,w,_,r.width,r.height);else{let e=r.width,n=r.height;for(let r=0;r<w;r++)i.texImage2D(t.TEXTURE_2D,r,_,e,n,0,f,g,null),e>>=1,n>>=1}}else if(v.length>0&&p){M&&S&&i.texStorage2D(t.TEXTURE_2D,w,_,v[0].width,v[0].height);for(let e=0,r=v.length;e<r;e++)m=v[e],M?i.texSubImage2D(t.TEXTURE_2D,e,0,0,f,g,m):i.texImage2D(t.TEXTURE_2D,e,_,f,g,m);n.generateMipmaps=!1}else M?(S&&i.texStorage2D(t.TEXTURE_2D,w,_,r.width,r.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,f,g,r)):i.texImage2D(t.TEXTURE_2D,0,_,f,g,r);A(n,p)&&x(l),d.__version=u.version,n.onUpdate&&n.onUpdate(n)}e.__version=n.version}function B(e,n,o,a,l,c){const h=s.convert(o.format,o.colorSpace),u=s.convert(o.type),p=C(o.internalFormat,h,u,o.colorSpace);if(!r.get(n).__hasExternalTextures){const e=Math.max(1,n.width>>c),r=Math.max(1,n.height>>c);l===t.TEXTURE_3D||l===t.TEXTURE_2D_ARRAY?i.texImage3D(l,c,p,e,r,n.depth,0,h,u,null):i.texImage2D(l,c,p,e,r,0,h,u,null)}i.bindFramebuffer(t.FRAMEBUFFER,e),V(n)?d.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,a,l,r.get(o).__webglTexture,0,j(n)):(l===t.TEXTURE_2D||l>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,a,l,r.get(o).__webglTexture,c),i.bindFramebuffer(t.FRAMEBUFFER,null)}function U(e,i,r){if(t.bindRenderbuffer(t.RENDERBUFFER,e),i.depthBuffer&&!i.stencilBuffer){let n=t.DEPTH_COMPONENT16;if(r||V(i)){const e=i.depthTexture;e&&e.isDepthTexture&&(e.type===FloatType?n=t.DEPTH_COMPONENT32F:e.type===UnsignedIntType&&(n=t.DEPTH_COMPONENT24));const r=j(i);V(i)?d.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,r,n,i.width,i.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,r,n,i.width,i.height)}else t.renderbufferStorage(t.RENDERBUFFER,n,i.width,i.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)}else if(i.depthBuffer&&i.stencilBuffer){const n=j(i);r&&!1===V(i)?t.renderbufferStorageMultisample(t.RENDERBUFFER,n,t.DEPTH24_STENCIL8,i.width,i.height):V(i)?d.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,n,t.DEPTH24_STENCIL8,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)}else{const e=!0===i.isWebGLMultipleRenderTargets?i.texture:[i.texture];for(let n=0;n<e.length;n++){const o=e[n],a=s.convert(o.format,o.colorSpace),l=s.convert(o.type),c=C(o.internalFormat,a,l,o.colorSpace),h=j(i);r&&!1===V(i)?t.renderbufferStorageMultisample(t.RENDERBUFFER,h,c,i.width,i.height):V(i)?d.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,h,c,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,c,i.width,i.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function F(e){const n=r.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!n.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(t.FRAMEBUFFER,e),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),O(n.depthTexture,0);const s=r.get(n.depthTexture).__webglTexture,o=j(n);if(n.depthTexture.format===DepthFormat)V(n)?d.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0);else{if(n.depthTexture.format!==DepthStencilFormat)throw new Error("Unknown depthTexture format");V(n)?d.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0)}}(n.__webglFramebuffer,e)}else if(s){n.__webglDepthbuffer=[];for(let r=0;r<6;r++)i.bindFramebuffer(t.FRAMEBUFFER,n.__webglFramebuffer[r]),n.__webglDepthbuffer[r]=t.createRenderbuffer(),U(n.__webglDepthbuffer[r],e,!1)}else i.bindFramebuffer(t.FRAMEBUFFER,n.__webglFramebuffer),n.__webglDepthbuffer=t.createRenderbuffer(),U(n.__webglDepthbuffer,e,!1);i.bindFramebuffer(t.FRAMEBUFFER,null)}function j(t){return Math.min(u,t.samples)}function V(t){const i=r.get(t);return a&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function z(t,i){const r=t.colorSpace,n=t.format,s=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===_SRGBAFormat||r!==LinearSRGBColorSpace&&r!==NoColorSpace&&(r===SRGBColorSpace||r===DisplayP3ColorSpace?!1===a?!0===e.has("EXT_sRGB")&&n===RGBAFormat?(t.format=_SRGBAFormat,t.minFilter=LinearFilter,t.generateMipmaps=!1):i=ImageUtils.sRGBToLinear(i):n===RGBAFormat&&s===UnsignedByteType||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",r)),i}this.allocateTextureUnit=function(){const t=T;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),T+=1,t},this.resetTextureUnits=function(){T=0},this.setTexture2D=O,this.setTexture2DArray=function(e,n){const s=r.get(e);e.version>0&&s.__version!==e.version?I(s,e,n):i.bindTexture(t.TEXTURE_2D_ARRAY,s.__webglTexture,t.TEXTURE0+n)},this.setTexture3D=function(e,n){const s=r.get(e);e.version>0&&s.__version!==e.version?I(s,e,n):i.bindTexture(t.TEXTURE_3D,s.__webglTexture,t.TEXTURE0+n)},this.setTextureCube=function(e,n){const o=r.get(e);e.version>0&&o.__version!==e.version?function(e,n,o){if(6!==n.image.length)return;const l=k(e,n),h=n.source;i.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture,t.TEXTURE0+o);const u=r.get(h);if(h.version!==u.__version||!0===l){i.activeTexture(t.TEXTURE0+o),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,n.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,n.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);const e=n.isCompressedTexture||n.image[0].isCompressedTexture,r=n.image[0]&&n.image[0].isDataTexture,d=[];for(let t=0;t<6;t++)d[t]=e||r?r?n.image[t].image:n.image[t]:y(n.image[t],!1,!0,c),d[t]=z(n,d[t]);const p=d[0],f=b(p)||a,m=s.convert(n.format,n.colorSpace),g=s.convert(n.type),_=C(n.internalFormat,m,g,n.colorSpace),v=a&&!0!==n.isVideoTexture,M=void 0===u.__version||!0===l;let S,w=E(n,p,f);if(D(t.TEXTURE_CUBE_MAP,n,f),e){v&&M&&i.texStorage2D(t.TEXTURE_CUBE_MAP,w,_,p.width,p.height);for(let e=0;e<6;e++){S=d[e].mipmaps;for(let r=0;r<S.length;r++){const s=S[r];n.format!==RGBAFormat?null!==m?v?i.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,0,0,s.width,s.height,m,s.data):i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,_,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):v?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,0,0,s.width,s.height,m,g,s.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,_,s.width,s.height,0,m,g,s.data)}}}else{S=n.mipmaps,v&&M&&(S.length>0&&w++,i.texStorage2D(t.TEXTURE_CUBE_MAP,w,_,d[0].width,d[0].height));for(let e=0;e<6;e++)if(r){v?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,d[e].width,d[e].height,m,g,d[e].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,_,d[e].width,d[e].height,0,m,g,d[e].data);for(let r=0;r<S.length;r++){const n=S[r].image[e].image;v?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,0,0,n.width,n.height,m,g,n.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,_,n.width,n.height,0,m,g,n.data)}}else{v?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,m,g,d[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,_,m,g,d[e]);for(let r=0;r<S.length;r++){const n=S[r];v?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,0,0,m,g,n.image[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,_,m,g,n.image[e])}}}A(n,f)&&x(t.TEXTURE_CUBE_MAP),u.__version=h.version,n.onUpdate&&n.onUpdate(n)}e.__version=n.version}(o,e,n):i.bindTexture(t.TEXTURE_CUBE_MAP,o.__webglTexture,t.TEXTURE0+n)},this.rebindTextures=function(e,i,n){const s=r.get(e);void 0!==i&&B(s.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),void 0!==n&&F(e)},this.setupRenderTarget=function(e){const l=e.texture,c=r.get(e),h=r.get(l);e.addEventListener("dispose",w),!0!==e.isWebGLMultipleRenderTargets&&(void 0===h.__webglTexture&&(h.__webglTexture=t.createTexture()),h.__version=l.version,o.memory.textures++);const u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=b(e)||a;if(u){c.__webglFramebuffer=[];for(let e=0;e<6;e++)if(a&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer[e]=[];for(let i=0;i<l.mipmaps.length;i++)c.__webglFramebuffer[e][i]=t.createFramebuffer()}else c.__webglFramebuffer[e]=t.createFramebuffer()}else{if(a&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer=[];for(let e=0;e<l.mipmaps.length;e++)c.__webglFramebuffer[e]=t.createFramebuffer()}else c.__webglFramebuffer=t.createFramebuffer();if(d)if(n.drawBuffers){const i=e.texture;for(let e=0,n=i.length;e<n;e++){const n=r.get(i[e]);void 0===n.__webglTexture&&(n.__webglTexture=t.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&e.samples>0&&!1===V(e)){const r=d?l:[l];c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=[],i.bindFramebuffer(t.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let i=0;i<r.length;i++){const n=r[i];c.__webglColorRenderbuffer[i]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,c.__webglColorRenderbuffer[i]);const o=s.convert(n.format,n.colorSpace),a=s.convert(n.type),l=C(n.internalFormat,o,a,n.colorSpace,!0===e.isXRRenderTarget),h=j(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,h,l,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+i,t.RENDERBUFFER,c.__webglColorRenderbuffer[i])}t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),U(c.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(t.FRAMEBUFFER,null)}}if(u){i.bindTexture(t.TEXTURE_CUBE_MAP,h.__webglTexture),D(t.TEXTURE_CUBE_MAP,l,p);for(let i=0;i<6;i++)if(a&&l.mipmaps&&l.mipmaps.length>0)for(let r=0;r<l.mipmaps.length;r++)B(c.__webglFramebuffer[i][r],e,l,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+i,r);else B(c.__webglFramebuffer[i],e,l,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0);A(l,p)&&x(t.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(d){const n=e.texture;for(let s=0,o=n.length;s<o;s++){const o=n[s],a=r.get(o);i.bindTexture(t.TEXTURE_2D,a.__webglTexture),D(t.TEXTURE_2D,o,p),B(c.__webglFramebuffer,e,o,t.COLOR_ATTACHMENT0+s,t.TEXTURE_2D,0),A(o,p)&&x(t.TEXTURE_2D)}i.unbindTexture()}else{let r=t.TEXTURE_2D;if((e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(a?r=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(r,h.__webglTexture),D(r,l,p),a&&l.mipmaps&&l.mipmaps.length>0)for(let i=0;i<l.mipmaps.length;i++)B(c.__webglFramebuffer[i],e,l,t.COLOR_ATTACHMENT0,r,i);else B(c.__webglFramebuffer,e,l,t.COLOR_ATTACHMENT0,r,0);A(l,p)&&x(r),i.unbindTexture()}e.depthBuffer&&F(e)},this.updateRenderTargetMipmap=function(e){const n=b(e)||a,s=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let o=0,a=s.length;o<a;o++){const a=s[o];if(A(a,n)){const n=e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,s=r.get(a).__webglTexture;i.bindTexture(n,s),x(n),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(a&&e.samples>0&&!1===V(e)){const n=e.isWebGLMultipleRenderTargets?e.texture:[e.texture],s=e.width,o=e.height;let a=t.COLOR_BUFFER_BIT;const l=[],c=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,h=r.get(e),u=!0===e.isWebGLMultipleRenderTargets;if(u)for(let e=0;e<n.length;e++)i.bindFramebuffer(t.FRAMEBUFFER,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),i.bindFramebuffer(t.FRAMEBUFFER,h.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);i.bindFramebuffer(t.READ_FRAMEBUFFER,h.__webglMultisampledFramebuffer),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,h.__webglFramebuffer);for(let i=0;i<n.length;i++){l.push(t.COLOR_ATTACHMENT0+i),e.depthBuffer&&l.push(c);const d=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;if(!1===d&&(e.depthBuffer&&(a|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&(a|=t.STENCIL_BUFFER_BIT)),u&&t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,h.__webglColorRenderbuffer[i]),!0===d&&(t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[c]),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[c])),u){const e=r.get(n[i]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}t.blitFramebuffer(0,0,s,o,0,0,s,o,a,t.NEAREST),p&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,l)}if(i.bindFramebuffer(t.READ_FRAMEBUFFER,null),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),u)for(let e=0;e<n.length;e++){i.bindFramebuffer(t.FRAMEBUFFER,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,h.__webglColorRenderbuffer[e]);const s=r.get(n[e]).__webglTexture;i.bindFramebuffer(t.FRAMEBUFFER,h.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,s,0)}i.bindFramebuffer(t.DRAW_FRAMEBUFFER,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=F,this.setupFrameBufferTexture=B,this.useMultisampledRTT=V}const LinearTransferFunction=0,SRGBTransferFunction=1;function WebGLUtils(t,e,i){const r=i.isWebGL2;return{convert:function(i,n=NoColorSpace){let s;const o=n===SRGBColorSpace||n===DisplayP3ColorSpace?SRGBTransferFunction:LinearTransferFunction;if(i===UnsignedByteType)return t.UNSIGNED_BYTE;if(i===UnsignedShort4444Type)return t.UNSIGNED_SHORT_4_4_4_4;if(i===UnsignedShort5551Type)return t.UNSIGNED_SHORT_5_5_5_1;if(i===ByteType)return t.BYTE;if(i===ShortType)return t.SHORT;if(i===UnsignedShortType)return t.UNSIGNED_SHORT;if(i===IntType)return t.INT;if(i===UnsignedIntType)return t.UNSIGNED_INT;if(i===FloatType)return t.FLOAT;if(i===HalfFloatType)return r?t.HALF_FLOAT:(s=e.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(i===AlphaFormat)return t.ALPHA;if(i===RGBAFormat)return t.RGBA;if(i===LuminanceFormat)return t.LUMINANCE;if(i===LuminanceAlphaFormat)return t.LUMINANCE_ALPHA;if(i===DepthFormat)return t.DEPTH_COMPONENT;if(i===DepthStencilFormat)return t.DEPTH_STENCIL;if(i===_SRGBAFormat)return s=e.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(i===RedFormat)return t.RED;if(i===RedIntegerFormat)return t.RED_INTEGER;if(i===RGFormat)return t.RG;if(i===RGIntegerFormat)return t.RG_INTEGER;if(i===RGBAIntegerFormat)return t.RGBA_INTEGER;if(i===RGB_S3TC_DXT1_Format||i===RGBA_S3TC_DXT1_Format||i===RGBA_S3TC_DXT3_Format||i===RGBA_S3TC_DXT5_Format)if(o===SRGBTransferFunction){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(i===RGB_S3TC_DXT1_Format)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===RGBA_S3TC_DXT1_Format)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===RGBA_S3TC_DXT3_Format)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===RGBA_S3TC_DXT5_Format)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(i===RGB_S3TC_DXT1_Format)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===RGBA_S3TC_DXT1_Format)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===RGBA_S3TC_DXT3_Format)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===RGBA_S3TC_DXT5_Format)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(i===RGB_PVRTC_4BPPV1_Format||i===RGB_PVRTC_2BPPV1_Format||i===RGBA_PVRTC_4BPPV1_Format||i===RGBA_PVRTC_2BPPV1_Format){if(s=e.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(i===RGB_PVRTC_4BPPV1_Format)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===RGB_PVRTC_2BPPV1_Format)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===RGBA_PVRTC_4BPPV1_Format)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===RGBA_PVRTC_2BPPV1_Format)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(i===RGB_ETC1_Format)return s=e.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(i===RGB_ETC2_Format||i===RGBA_ETC2_EAC_Format){if(s=e.get("WEBGL_compressed_texture_etc"),null===s)return null;if(i===RGB_ETC2_Format)return o===SRGBTransferFunction?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===RGBA_ETC2_EAC_Format)return o===SRGBTransferFunction?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(i===RGBA_ASTC_4x4_Format||i===RGBA_ASTC_5x4_Format||i===RGBA_ASTC_5x5_Format||i===RGBA_ASTC_6x5_Format||i===RGBA_ASTC_6x6_Format||i===RGBA_ASTC_8x5_Format||i===RGBA_ASTC_8x6_Format||i===RGBA_ASTC_8x8_Format||i===RGBA_ASTC_10x5_Format||i===RGBA_ASTC_10x6_Format||i===RGBA_ASTC_10x8_Format||i===RGBA_ASTC_10x10_Format||i===RGBA_ASTC_12x10_Format||i===RGBA_ASTC_12x12_Format){if(s=e.get("WEBGL_compressed_texture_astc"),null===s)return null;if(i===RGBA_ASTC_4x4_Format)return o===SRGBTransferFunction?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===RGBA_ASTC_5x4_Format)return o===SRGBTransferFunction?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===RGBA_ASTC_5x5_Format)return o===SRGBTransferFunction?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===RGBA_ASTC_6x5_Format)return o===SRGBTransferFunction?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===RGBA_ASTC_6x6_Format)return o===SRGBTransferFunction?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===RGBA_ASTC_8x5_Format)return o===SRGBTransferFunction?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===RGBA_ASTC_8x6_Format)return o===SRGBTransferFunction?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===RGBA_ASTC_8x8_Format)return o===SRGBTransferFunction?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===RGBA_ASTC_10x5_Format)return o===SRGBTransferFunction?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===RGBA_ASTC_10x6_Format)return o===SRGBTransferFunction?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===RGBA_ASTC_10x8_Format)return o===SRGBTransferFunction?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===RGBA_ASTC_10x10_Format)return o===SRGBTransferFunction?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===RGBA_ASTC_12x10_Format)return o===SRGBTransferFunction?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===RGBA_ASTC_12x12_Format)return o===SRGBTransferFunction?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===RGBA_BPTC_Format||i===RGB_BPTC_SIGNED_Format||i===RGB_BPTC_UNSIGNED_Format){if(s=e.get("EXT_texture_compression_bptc"),null===s)return null;if(i===RGBA_BPTC_Format)return o===SRGBTransferFunction?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===RGB_BPTC_SIGNED_Format)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===RGB_BPTC_UNSIGNED_Format)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(i===RED_RGTC1_Format||i===SIGNED_RED_RGTC1_Format||i===RED_GREEN_RGTC2_Format||i===SIGNED_RED_GREEN_RGTC2_Format){if(s=e.get("EXT_texture_compression_rgtc"),null===s)return null;if(i===RGBA_BPTC_Format)return s.COMPRESSED_RED_RGTC1_EXT;if(i===SIGNED_RED_RGTC1_Format)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===RED_GREEN_RGTC2_Format)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===SIGNED_RED_GREEN_RGTC2_Format)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return i===UnsignedInt248Type?r?t.UNSIGNED_INT_24_8:(s=e.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==t[i]?t[i]:null}}}class ArrayCamera extends PerspectiveCamera{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class Group extends Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const i of t.hand.values())this._getHandJoint(e,i)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let r=null,n=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(l&&t.hand){s=!0;for(const r of t.hand.values()){const t=e.getJointPose(r,i),n=this._getHandJoint(l,r);null!==t&&(n.matrix.fromArray(t.transform.matrix),n.matrix.decompose(n.position,n.rotation,n.scale),n.matrixWorldNeedsUpdate=!0,n.jointRadius=t.radius),n.visible=null!==t}const r=l.joints["index-finger-tip"],n=l.joints["thumb-tip"],o=r.position.distanceTo(n.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(n=e.getPose(t.gripSpace,i),null!==n&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(r=e.getPose(t.targetRaySpace,i),null===r&&null!==n&&(r=n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent)))}return null!==o&&(o.visible=null!==r),null!==a&&(a.visible=null!==n),null!==l&&(l.visible=null!==s),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const i=new Group;i.matrixAutoUpdate=!1,i.visible=!1,t.joints[e.jointName]=i,t.add(i)}return t.joints[e.jointName]}}class DepthTexture extends Texture{constructor(t,e,i,r,n,s,o,a,l,c){if((c=void 0!==c?c:DepthFormat)!==DepthFormat&&c!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===DepthFormat&&(i=UnsignedIntType),void 0===i&&c===DepthStencilFormat&&(i=UnsignedInt248Type),super(null,r,n,s,o,a,c,i,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==o?o:NearestFilter,this.minFilter=void 0!==a?a:NearestFilter,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}class WebXRManager extends EventDispatcher{constructor(t,e){super();const i=this;let r=null,n=1,s=null,o="local-floor",a=1,l=null,c=null,h=null,u=null,d=null,p=null;const f=e.getContextAttributes();let m=null,g=null;const _=[],v=[],y=new PerspectiveCamera;y.layers.enable(1),y.viewport=new Vector4;const b=new PerspectiveCamera;b.layers.enable(2),b.viewport=new Vector4;const A=[y,b],x=new ArrayCamera;x.layers.enable(1),x.layers.enable(2);let C=null,E=null;function M(t){const e=v.indexOf(t.inputSource);if(-1===e)return;const i=_[e];void 0!==i&&(i.update(t.inputSource,t.frame,l||s),i.dispatchEvent({type:t.type,data:t.inputSource}))}function S(){r.removeEventListener("select",M),r.removeEventListener("selectstart",M),r.removeEventListener("selectend",M),r.removeEventListener("squeeze",M),r.removeEventListener("squeezestart",M),r.removeEventListener("squeezeend",M),r.removeEventListener("end",S),r.removeEventListener("inputsourceschange",w);for(let t=0;t<_.length;t++){const e=v[t];null!==e&&(v[t]=null,_[t].disconnect(e))}C=null,E=null,t.setRenderTarget(m),d=null,u=null,h=null,r=null,g=null,N.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function w(t){for(let e=0;e<t.removed.length;e++){const i=t.removed[e],r=v.indexOf(i);r>=0&&(v[r]=null,_[r].disconnect(i))}for(let e=0;e<t.added.length;e++){const i=t.added[e];let r=v.indexOf(i);if(-1===r){for(let t=0;t<_.length;t++){if(t>=v.length){v.push(i),r=t;break}if(null===v[t]){v[t]=i,r=t;break}}if(-1===r)break}const n=_[r];n&&n.connect(i)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=_[t];return void 0===e&&(e=new WebXRController,_[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=_[t];return void 0===e&&(e=new WebXRController,_[t]=e),e.getGripSpace()},this.getHand=function(t){let e=_[t];return void 0===e&&(e=new WebXRController,_[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){n=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(t){l=t},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(c){if(r=c,null!==r){if(m=t.getRenderTarget(),r.addEventListener("select",M),r.addEventListener("selectstart",M),r.addEventListener("selectend",M),r.addEventListener("squeeze",M),r.addEventListener("squeezestart",M),r.addEventListener("squeezeend",M),r.addEventListener("end",S),r.addEventListener("inputsourceschange",w),!0!==f.xrCompatible&&await e.makeXRCompatible(),void 0===r.renderState.layers||!1===t.capabilities.isWebGL2){const i={antialias:void 0!==r.renderState.layers||f.antialias,alpha:!0,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(r,e,i),r.updateRenderState({baseLayer:d}),g=new WebGLRenderTarget(d.framebufferWidth,d.framebufferHeight,{format:RGBAFormat,type:UnsignedByteType,colorSpace:t.outputColorSpace,stencilBuffer:f.stencil})}else{let i=null,s=null,o=null;f.depth&&(o=f.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,i=f.stencil?DepthStencilFormat:DepthFormat,s=f.stencil?UnsignedInt248Type:UnsignedIntType);const a={colorFormat:e.RGBA8,depthFormat:o,scaleFactor:n};h=new XRWebGLBinding(r,e),u=h.createProjectionLayer(a),r.updateRenderState({layers:[u]}),g=new WebGLRenderTarget(u.textureWidth,u.textureHeight,{format:RGBAFormat,type:UnsignedByteType,depthTexture:new DepthTexture(u.textureWidth,u.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:f.stencil,colorSpace:t.outputColorSpace,samples:f.antialias?4:0}),t.properties.get(g).__ignoreDepthValues=u.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(a),l=null,s=await r.requestReferenceSpace(o),N.setContext(r),N.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode};const P=new Vector3,T=new Vector3;function O(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===r)return;x.near=b.near=y.near=t.near,x.far=b.far=y.far=t.far,C===x.near&&E===x.far||(r.updateRenderState({depthNear:x.near,depthFar:x.far}),C=x.near,E=x.far);const e=t.parent,i=x.cameras;O(x,e);for(let t=0;t<i.length;t++)O(i[t],e);2===i.length?function(t,e,i){P.setFromMatrixPosition(e.matrixWorld),T.setFromMatrixPosition(i.matrixWorld);const r=P.distanceTo(T),n=e.projectionMatrix.elements,s=i.projectionMatrix.elements,o=n[14]/(n[10]-1),a=n[14]/(n[10]+1),l=(n[9]+1)/n[5],c=(n[9]-1)/n[5],h=(n[8]-1)/n[0],u=(s[8]+1)/s[0],d=o*h,p=o*u,f=r/(-h+u),m=f*-h;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=o+f,_=a+f,v=d-m,y=p+(r-m),b=l*a/_*g,A=c*a/_*g;t.projectionMatrix.makePerspective(v,y,b,A,g,_),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()}(x,y,b):x.projectionMatrix.copy(y.projectionMatrix),function(t,e,i){null===i?t.matrix.copy(e.matrixWorld):(t.matrix.copy(i.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld)),t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*RAD2DEG*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}(t,x,e)},this.getCamera=function(){return x},this.getFoveation=function(){if(null!==u||null!==d)return a},this.setFoveation=function(t){a=t,null!==u&&(u.fixedFoveation=t),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=t)};let R=null;const N=new WebGLAnimation;N.setAnimationLoop((function(e,r){if(c=r.getViewerPose(l||s),p=r,null!==c){const e=c.views;null!==d&&(t.setRenderTargetFramebuffer(g,d.framebuffer),t.setRenderTarget(g));let i=!1;e.length!==x.cameras.length&&(x.cameras.length=0,i=!0);for(let r=0;r<e.length;r++){const n=e[r];let s=null;if(null!==d)s=d.getViewport(n);else{const e=h.getViewSubImage(u,n);s=e.viewport,0===r&&(t.setRenderTargetTextures(g,e.colorTexture,u.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(g))}let o=A[r];void 0===o&&(o=new PerspectiveCamera,o.layers.enable(r),o.viewport=new Vector4,A[r]=o),o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(n.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(s.x,s.y,s.width,s.height),0===r&&(x.matrix.copy(o.matrix),x.matrix.decompose(x.position,x.quaternion,x.scale)),!0===i&&x.cameras.push(o)}}for(let t=0;t<_.length;t++){const e=v[t],i=_[t];null!==e&&void 0!==i&&i.update(e,r,l||s)}R&&R(e,r),r.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:r}),p=null})),this.setAnimationLoop=function(t){R=t},this.dispose=function(){}}}function WebGLMaterials(t,e){function i(t,e){!0===t.matrixAutoUpdate&&t.updateMatrix(),e.value.copy(t.matrix)}function r(r,n){r.opacity.value=n.opacity,n.color&&r.diffuse.value.copy(n.color),n.emissive&&r.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(r.map.value=n.map,i(n.map,r.mapTransform)),n.alphaMap&&(r.alphaMap.value=n.alphaMap,i(n.alphaMap,r.alphaMapTransform)),n.bumpMap&&(r.bumpMap.value=n.bumpMap,i(n.bumpMap,r.bumpMapTransform),r.bumpScale.value=n.bumpScale,n.side===BackSide&&(r.bumpScale.value*=-1)),n.normalMap&&(r.normalMap.value=n.normalMap,i(n.normalMap,r.normalMapTransform),r.normalScale.value.copy(n.normalScale),n.side===BackSide&&r.normalScale.value.negate()),n.displacementMap&&(r.displacementMap.value=n.displacementMap,i(n.displacementMap,r.displacementMapTransform),r.displacementScale.value=n.displacementScale,r.displacementBias.value=n.displacementBias),n.emissiveMap&&(r.emissiveMap.value=n.emissiveMap,i(n.emissiveMap,r.emissiveMapTransform)),n.specularMap&&(r.specularMap.value=n.specularMap,i(n.specularMap,r.specularMapTransform)),n.alphaTest>0&&(r.alphaTest.value=n.alphaTest);const s=e.get(n).envMap;if(s&&(r.envMap.value=s,r.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,r.reflectivity.value=n.reflectivity,r.ior.value=n.ior,r.refractionRatio.value=n.refractionRatio),n.lightMap){r.lightMap.value=n.lightMap;const e=!0===t._useLegacyLights?Math.PI:1;r.lightMapIntensity.value=n.lightMapIntensity*e,i(n.lightMap,r.lightMapTransform)}n.aoMap&&(r.aoMap.value=n.aoMap,r.aoMapIntensity.value=n.aoMapIntensity,i(n.aoMap,r.aoMapTransform))}return{refreshFogUniforms:function(e,i){i.color.getRGB(e.fogColor.value,getUnlitUniformColorSpace(t)),i.isFog?(e.fogNear.value=i.near,e.fogFar.value=i.far):i.isFogExp2&&(e.fogDensity.value=i.density)},refreshMaterialUniforms:function(t,n,s,o,a){n.isMeshBasicMaterial||n.isMeshLambertMaterial?r(t,n):n.isMeshToonMaterial?(r(t,n),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,n)):n.isMeshPhongMaterial?(r(t,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,n)):n.isMeshStandardMaterial?(r(t,n),function(t,r){t.metalness.value=r.metalness,r.metalnessMap&&(t.metalnessMap.value=r.metalnessMap,i(r.metalnessMap,t.metalnessMapTransform)),t.roughness.value=r.roughness,r.roughnessMap&&(t.roughnessMap.value=r.roughnessMap,i(r.roughnessMap,t.roughnessMapTransform));e.get(r).envMap&&(t.envMapIntensity.value=r.envMapIntensity)}(t,n),n.isMeshPhysicalMaterial&&function(t,e,r){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap,i(e.sheenColorMap,t.sheenColorMapTransform)),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap,i(e.sheenRoughnessMap,t.sheenRoughnessMapTransform))),e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap,i(e.clearcoatMap,t.clearcoatMapTransform)),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap,i(e.clearcoatRoughnessMap,t.clearcoatRoughnessMapTransform)),e.clearcoatNormalMap&&(t.clearcoatNormalMap.value=e.clearcoatNormalMap,i(e.clearcoatNormalMap,t.clearcoatNormalMapTransform),t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),e.side===BackSide&&t.clearcoatNormalScale.value.negate())),e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap,i(e.iridescenceMap,t.iridescenceMapTransform)),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap,i(e.iridescenceThicknessMap,t.iridescenceThicknessMapTransform))),e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=r.texture,t.transmissionSamplerSize.value.set(r.width,r.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap,i(e.transmissionMap,t.transmissionMapTransform)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap,i(e.thicknessMap,t.thicknessMapTransform)),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)),e.anisotropy>0&&(t.anisotropyVector.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation)),e.anisotropyMap&&(t.anisotropyMap.value=e.anisotropyMap,i(e.anisotropyMap,t.anisotropyMapTransform))),t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap,i(e.specularColorMap,t.specularColorMapTransform)),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap,i(e.specularIntensityMap,t.specularIntensityMapTransform))}(t,n,a)):n.isMeshMatcapMaterial?(r(t,n),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,n)):n.isMeshDepthMaterial?r(t,n):n.isMeshDistanceMaterial?(r(t,n),function(t,i){const r=e.get(i).light;t.referencePosition.value.setFromMatrixPosition(r.matrixWorld),t.nearDistance.value=r.shadow.camera.near,t.farDistance.value=r.shadow.camera.far}(t,n)):n.isMeshNormalMaterial?r(t,n):n.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,e.map&&(t.map.value=e.map,i(e.map,t.mapTransform))}(t,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,n)):n.isPointsMaterial?function(t,e,r,n){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*r,t.scale.value=.5*n,e.map&&(t.map.value=e.map,i(e.map,t.uvTransform)),e.alphaMap&&(t.alphaMap.value=e.alphaMap,i(e.alphaMap,t.alphaMapTransform)),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,n,s,o):n.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map,i(e.map,t.mapTransform)),e.alphaMap&&(t.alphaMap.value=e.alphaMap,i(e.alphaMap,t.alphaMapTransform)),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,n):n.isShadowMaterial?(t.color.value.copy(n.color),t.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function WebGLUniformsGroups(t,e,i,r){let n={},s={},o=[];const a=i.isWebGL2?t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(t,e,i){const r=t.value;if(void 0===i[e]){if("number"==typeof r)i[e]=r;else{const t=Array.isArray(r)?r:[r],n=[];for(let e=0;e<t.length;e++)n.push(t[e].clone());i[e]=n}return!0}if("number"==typeof r){if(i[e]!==r)return i[e]=r,!0}else{const t=Array.isArray(i[e])?i[e]:[i[e]],n=Array.isArray(r)?r:[r];for(let e=0;e<t.length;e++){const i=t[e];if(!1===i.equals(n[e]))return i.copy(n[e]),!0}}return!1}function c(t){const e={boundary:0,storage:0};return"number"==typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),e}function h(e){const i=e.target;i.removeEventListener("dispose",h);const r=o.indexOf(i.__bindingPointIndex);o.splice(r,1),t.deleteBuffer(n[i.id]),delete n[i.id],delete s[i.id]}return{bind:function(t,e){const i=e.program;r.uniformBlockBinding(t,i)},update:function(i,u){let d=n[i.id];void 0===d&&(function(t){const e=t.uniforms;let i=0;let r=0;for(let t=0,n=e.length;t<n;t++){const n=e[t],s={boundary:0,storage:0},o=Array.isArray(n.value)?n.value:[n.value];for(let t=0,e=o.length;t<e;t++){const e=c(o[t]);s.boundary+=e.boundary,s.storage+=e.storage}n.__data=new Float32Array(s.storage/Float32Array.BYTES_PER_ELEMENT),n.__offset=i,t>0&&(r=i%16,0!==r&&16-r-s.boundary<0&&(i+=16-r,n.__offset=i)),i+=s.storage}r=i%16,r>0&&(i+=16-r),t.__size=i,t.__cache={}}(i),d=function(e){const i=function(){for(let t=0;t<a;t++)if(-1===o.indexOf(t))return o.push(t),t;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();e.__bindingPointIndex=i;const r=t.createBuffer(),n=e.__size,s=e.usage;return t.bindBuffer(t.UNIFORM_BUFFER,r),t.bufferData(t.UNIFORM_BUFFER,n,s),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,i,r),r}(i),n[i.id]=d,i.addEventListener("dispose",h));const p=u.program;r.updateUBOMapping(i,p);const f=e.render.frame;s[i.id]!==f&&(function(e){const i=n[e.id],r=e.uniforms,s=e.__cache;t.bindBuffer(t.UNIFORM_BUFFER,i);for(let e=0,i=r.length;e<i;e++){const i=r[e];if(!0===l(i,e,s)){const e=i.__offset,r=Array.isArray(i.value)?i.value:[i.value];let n=0;for(let s=0;s<r.length;s++){const o=r[s],a=c(o);"number"==typeof o?(i.__data[0]=o,t.bufferSubData(t.UNIFORM_BUFFER,e+n,i.__data)):o.isMatrix3?(i.__data[0]=o.elements[0],i.__data[1]=o.elements[1],i.__data[2]=o.elements[2],i.__data[3]=o.elements[0],i.__data[4]=o.elements[3],i.__data[5]=o.elements[4],i.__data[6]=o.elements[5],i.__data[7]=o.elements[0],i.__data[8]=o.elements[6],i.__data[9]=o.elements[7],i.__data[10]=o.elements[8],i.__data[11]=o.elements[0]):(o.toArray(i.__data,n),n+=a.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,e,i.__data)}}t.bindBuffer(t.UNIFORM_BUFFER,null)}(i),s[i.id]=f)},dispose:function(){for(const e in n)t.deleteBuffer(n[e]);o=[],n={},s={}}}}class WebGLRenderer{constructor(t={}){const{canvas:e=createCanvasElement(),context:i=null,depth:r=!0,stencil:n=!0,alpha:s=!1,antialias:o=!1,premultipliedAlpha:a=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:h=!1}=t;let u;this.isWebGLRenderer=!0,u=null!==i?i.getContextAttributes().alpha:s;const d=new Uint32Array(4),p=new Int32Array(4);let f=null,m=null;const g=[],_=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=SRGBColorSpace,this._useLegacyLights=!1,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const v=this;let y=!1,b=0,A=0,x=null,C=-1,E=null;const M=new Vector4,S=new Vector4;let w=null;const P=new Color(0);let T=0,O=e.width,R=e.height,N=1,L=null,D=null;const k=new Vector4(0,0,O,R),I=new Vector4(0,0,O,R);let B=!1;const U=new Frustum;let F=!1,j=!1,V=null;const z=new Matrix4,G=new Vector2,H=new Vector3,Y={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function X(){return null===x?N:1}let W,J,$,q,K,Z,Q,tt,et,it,rt,nt,st,ot,at,lt,ct,ht,ut,dt,pt,ft,mt,gt,_t=i;function vt(t,i){for(let r=0;r<t.length;r++){const n=t[r],s=e.getContext(n,i);if(null!==s)return s}return null}try{const t={alpha:!0,depth:r,stencil:n,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${REVISION}`),e.addEventListener("webglcontextlost",At,!1),e.addEventListener("webglcontextrestored",xt,!1),e.addEventListener("webglcontextcreationerror",Ct,!1),null===_t){const e=["webgl2","webgl","experimental-webgl"];if(!0===v.isWebGL1Renderer&&e.shift(),_t=vt(e,t),null===_t)throw vt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&_t instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===_t.getShaderPrecisionFormat&&(_t.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function yt(){W=new WebGLExtensions(_t),J=new WebGLCapabilities(_t,W,t),W.init(J),ft=new WebGLUtils(_t,W,J),$=new WebGLState(_t,W,J),q=new WebGLInfo(_t),K=new WebGLProperties,Z=new WebGLTextures(_t,W,$,K,J,ft,q),Q=new WebGLCubeMaps(v),tt=new WebGLCubeUVMaps(v),et=new WebGLAttributes(_t,J),mt=new WebGLBindingStates(_t,W,et,J),it=new WebGLGeometries(_t,et,q,mt),rt=new WebGLObjects(_t,it,et,q),ut=new WebGLMorphtargets(_t,J,Z),lt=new WebGLClipping(K),nt=new WebGLPrograms(v,Q,tt,W,J,mt,lt),st=new WebGLMaterials(v,K),ot=new WebGLRenderLists,at=new WebGLRenderStates(W,J),ht=new WebGLBackground(v,Q,tt,$,rt,u,a),ct=new WebGLShadowMap(v,rt,J),gt=new WebGLUniformsGroups(_t,q,J,$),dt=new WebGLBufferRenderer(_t,W,q,J),pt=new WebGLIndexedBufferRenderer(_t,W,q,J),q.programs=nt.programs,v.capabilities=J,v.extensions=W,v.properties=K,v.renderLists=ot,v.shadowMap=ct,v.state=$,v.info=q}yt();const bt=new WebXRManager(v,_t);function At(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function xt(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const t=q.autoReset,e=ct.enabled,i=ct.autoUpdate,r=ct.needsUpdate,n=ct.type;yt(),q.autoReset=t,ct.enabled=e,ct.autoUpdate=i,ct.needsUpdate=r,ct.type=n}function Ct(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function Et(t){const e=t.target;e.removeEventListener("dispose",Et),function(t){(function(t){const e=K.get(t).programs;void 0!==e&&(e.forEach((function(t){nt.releaseProgram(t)})),t.isShaderMaterial&&nt.releaseShaderCache(t))})(t),K.remove(t)}(e)}this.xr=bt,this.getContext=function(){return _t},this.getContextAttributes=function(){return _t.getContextAttributes()},this.forceContextLoss=function(){const t=W.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=W.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return N},this.setPixelRatio=function(t){void 0!==t&&(N=t,this.setSize(O,R,!1))},this.getSize=function(t){return t.set(O,R)},this.setSize=function(t,i,r=!0){bt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(O=t,R=i,e.width=Math.floor(t*N),e.height=Math.floor(i*N),!0===r&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return t.set(O*N,R*N).floor()},this.setDrawingBufferSize=function(t,i,r){O=t,R=i,N=r,e.width=Math.floor(t*r),e.height=Math.floor(i*r),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return t.copy(M)},this.getViewport=function(t){return t.copy(k)},this.setViewport=function(t,e,i,r){t.isVector4?k.set(t.x,t.y,t.z,t.w):k.set(t,e,i,r),$.viewport(M.copy(k).multiplyScalar(N).floor())},this.getScissor=function(t){return t.copy(I)},this.setScissor=function(t,e,i,r){t.isVector4?I.set(t.x,t.y,t.z,t.w):I.set(t,e,i,r),$.scissor(S.copy(I).multiplyScalar(N).floor())},this.getScissorTest=function(){return B},this.setScissorTest=function(t){$.setScissorTest(B=t)},this.setOpaqueSort=function(t){L=t},this.setTransparentSort=function(t){D=t},this.getClearColor=function(t){return t.copy(ht.getClearColor())},this.setClearColor=function(){ht.setClearColor.apply(ht,arguments)},this.getClearAlpha=function(){return ht.getClearAlpha()},this.setClearAlpha=function(){ht.setClearAlpha.apply(ht,arguments)},this.clear=function(t=!0,e=!0,i=!0){let r=0;if(t){let t=!1;if(null!==x){const e=x.texture.format;t=e===RGBAIntegerFormat||e===RGIntegerFormat||e===RedIntegerFormat}if(t){const t=x.texture.type,e=t===UnsignedByteType||t===UnsignedIntType||t===UnsignedShortType||t===UnsignedInt248Type||t===UnsignedShort4444Type||t===UnsignedShort5551Type,i=ht.getClearColor(),r=ht.getClearAlpha(),n=i.r,s=i.g,o=i.b;e?(d[0]=n,d[1]=s,d[2]=o,d[3]=r,_t.clearBufferuiv(_t.COLOR,0,d)):(p[0]=n,p[1]=s,p[2]=o,p[3]=r,_t.clearBufferiv(_t.COLOR,0,p))}else r|=_t.COLOR_BUFFER_BIT}e&&(r|=_t.DEPTH_BUFFER_BIT),i&&(r|=_t.STENCIL_BUFFER_BIT),_t.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",At,!1),e.removeEventListener("webglcontextrestored",xt,!1),e.removeEventListener("webglcontextcreationerror",Ct,!1),ot.dispose(),at.dispose(),K.dispose(),Q.dispose(),tt.dispose(),rt.dispose(),mt.dispose(),gt.dispose(),nt.dispose(),bt.dispose(),bt.removeEventListener("sessionstart",St),bt.removeEventListener("sessionend",wt),V&&(V.dispose(),V=null),Pt.stop()},this.renderBufferDirect=function(t,e,i,r,n,s){null===e&&(e=Y);const o=n.isMesh&&n.matrixWorld.determinant()<0,a=function(t,e,i,r,n){!0!==e.isScene&&(e=Y),Z.resetTextureUnits();const s=e.fog,o=r.isMeshStandardMaterial?e.environment:null,a=null===x?v.outputColorSpace:!0===x.isXRRenderTarget?x.texture.colorSpace:LinearSRGBColorSpace,l=(r.isMeshStandardMaterial?tt:Q).get(r.envMap||o),c=!0===r.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,h=!!i.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),u=!!i.morphAttributes.position,d=!!i.morphAttributes.normal,p=!!i.morphAttributes.color;let f=NoToneMapping;r.toneMapped&&(null!==x&&!0!==x.isXRRenderTarget||(f=v.toneMapping));const g=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,_=void 0!==g?g.length:0,y=K.get(r),b=m.state.lights;if(!0===F&&(!0===j||t!==E)){const e=t===E&&r.id===C;lt.setState(r,t,e)}let A=!1;r.version===y.__version?y.needsLights&&y.lightsStateVersion!==b.state.version||y.outputColorSpace!==a||n.isInstancedMesh&&!1===y.instancing?A=!0:n.isInstancedMesh||!0!==y.instancing?n.isSkinnedMesh&&!1===y.skinning?A=!0:n.isSkinnedMesh||!0!==y.skinning?n.isInstancedMesh&&!0===y.instancingColor&&null===n.instanceColor||n.isInstancedMesh&&!1===y.instancingColor&&null!==n.instanceColor||y.envMap!==l||!0===r.fog&&y.fog!==s?A=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===lt.numPlanes&&y.numIntersection===lt.numIntersection?(y.vertexAlphas!==c||y.vertexTangents!==h||y.morphTargets!==u||y.morphNormals!==d||y.morphColors!==p||y.toneMapping!==f||!0===J.isWebGL2&&y.morphTargetsCount!==_)&&(A=!0):A=!0:A=!0:A=!0:(A=!0,y.__version=r.version);let M=y.currentProgram;!0===A&&(M=Lt(r,e,n));let S=!1,w=!1,P=!1;const T=M.getUniforms(),O=y.uniforms;if($.useProgram(M.program)&&(S=!0,w=!0,P=!0),r.id!==C&&(C=r.id,w=!0),S||E!==t){T.setValue(_t,"projectionMatrix",t.projectionMatrix),T.setValue(_t,"viewMatrix",t.matrixWorldInverse);const e=T.map.cameraPosition;void 0!==e&&e.setValue(_t,H.setFromMatrixPosition(t.matrixWorld)),J.logarithmicDepthBuffer&&T.setValue(_t,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&T.setValue(_t,"isOrthographic",!0===t.isOrthographicCamera),E!==t&&(E=t,w=!0,P=!0)}if(n.isSkinnedMesh){T.setOptional(_t,n,"bindMatrix"),T.setOptional(_t,n,"bindMatrixInverse");const t=n.skeleton;t&&(J.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),T.setValue(_t,"boneTexture",t.boneTexture,Z),T.setValue(_t,"boneTextureSize",t.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const L=i.morphAttributes;if((void 0!==L.position||void 0!==L.normal||void 0!==L.color&&!0===J.isWebGL2)&&ut.update(n,i,M),(w||y.receiveShadow!==n.receiveShadow)&&(y.receiveShadow=n.receiveShadow,T.setValue(_t,"receiveShadow",n.receiveShadow)),r.isMeshGouraudMaterial&&null!==r.envMap&&(O.envMap.value=l,O.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),w&&(T.setValue(_t,"toneMappingExposure",v.toneMappingExposure),y.needsLights&&function(t,e){t.ambientLightColor.needsUpdate=e,t.lightProbe.needsUpdate=e,t.directionalLights.needsUpdate=e,t.directionalLightShadows.needsUpdate=e,t.pointLights.needsUpdate=e,t.pointLightShadows.needsUpdate=e,t.spotLights.needsUpdate=e,t.spotLightShadows.needsUpdate=e,t.rectAreaLights.needsUpdate=e,t.hemisphereLights.needsUpdate=e}(O,P),s&&!0===r.fog&&st.refreshFogUniforms(O,s),st.refreshMaterialUniforms(O,r,N,R,V),WebGLUniforms.upload(_t,y.uniformsList,O,Z)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(WebGLUniforms.upload(_t,y.uniformsList,O,Z),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&T.setValue(_t,"center",n.center),T.setValue(_t,"modelViewMatrix",n.modelViewMatrix),T.setValue(_t,"normalMatrix",n.normalMatrix),T.setValue(_t,"modelMatrix",n.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const t=r.uniformsGroups;for(let e=0,i=t.length;e<i;e++)if(J.isWebGL2){const i=t[e];gt.update(i,M),gt.bind(i,M)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return M}(t,e,i,r,n);$.setMaterial(r,o);let l=i.index,c=1;if(!0===r.wireframe){if(l=it.getWireframeAttribute(i),void 0===l)return;c=2}const h=i.drawRange,u=i.attributes.position;let d=h.start*c,p=(h.start+h.count)*c;null!==s&&(d=Math.max(d,s.start*c),p=Math.min(p,(s.start+s.count)*c)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):null!=u&&(d=Math.max(d,0),p=Math.min(p,u.count));const f=p-d;if(f<0||f===1/0)return;let g;mt.setup(n,r,a,i,l);let _=dt;if(null!==l&&(g=et.get(l),_=pt,_.setIndex(g)),n.isMesh)!0===r.wireframe?($.setLineWidth(r.wireframeLinewidth*X()),_.setMode(_t.LINES)):_.setMode(_t.TRIANGLES);else if(n.isLine){let t=r.linewidth;void 0===t&&(t=1),$.setLineWidth(t*X()),n.isLineSegments?_.setMode(_t.LINES):n.isLineLoop?_.setMode(_t.LINE_LOOP):_.setMode(_t.LINE_STRIP)}else n.isPoints?_.setMode(_t.POINTS):n.isSprite&&_.setMode(_t.TRIANGLES);if(n.isInstancedMesh)_.renderInstances(d,f,n.count);else if(i.isInstancedBufferGeometry){const t=void 0!==i._maxInstanceCount?i._maxInstanceCount:1/0,e=Math.min(i.instanceCount,t);_.renderInstances(d,f,e)}else _.render(d,f)},this.compile=function(t,e){function i(t,e,i){!0===t.transparent&&t.side===DoubleSide&&!1===t.forceSinglePass?(t.side=BackSide,t.needsUpdate=!0,Lt(t,e,i),t.side=FrontSide,t.needsUpdate=!0,Lt(t,e,i),t.side=DoubleSide):Lt(t,e,i)}m=at.get(t),m.init(),_.push(m),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(m.pushLight(t),t.castShadow&&m.pushShadow(t))})),m.setupLights(v._useLegacyLights),t.traverse((function(e){const r=e.material;if(r)if(Array.isArray(r))for(let n=0;n<r.length;n++)i(r[n],t,e);else i(r,t,e)})),_.pop(),m=null};let Mt=null;function St(){Pt.stop()}function wt(){Pt.start()}const Pt=new WebGLAnimation;function Tt(t,e,i,r){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)m.pushLight(t),t.castShadow&&m.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||U.intersectsSprite(t)){r&&H.setFromMatrixPosition(t.matrixWorld).applyMatrix4(z);const e=rt.update(t),n=t.material;n.visible&&f.push(t,e,n,i,H.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||U.intersectsObject(t))){const e=rt.update(t),n=t.material;if(r&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),H.copy(t.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),H.copy(e.boundingSphere.center)),H.applyMatrix4(t.matrixWorld).applyMatrix4(z)),Array.isArray(n)){const r=e.groups;for(let s=0,o=r.length;s<o;s++){const o=r[s],a=n[o.materialIndex];a&&a.visible&&f.push(t,e,a,i,H.z,o)}}else n.visible&&f.push(t,e,n,i,H.z,null)}const n=t.children;for(let t=0,s=n.length;t<s;t++)Tt(n[t],e,i,r)}function Ot(t,e,i,r){const n=t.opaque,s=t.transmissive,o=t.transparent;m.setupLightsView(i),!0===F&&lt.setGlobalState(v.clippingPlanes,i),s.length>0&&function(t,e,i,r){const n=J.isWebGL2;null===V&&(V=new WebGLRenderTarget(1,1,{generateMipmaps:!0,type:W.has("EXT_color_buffer_half_float")?HalfFloatType:UnsignedByteType,minFilter:LinearMipmapLinearFilter,samples:n?4:0})),v.getDrawingBufferSize(G),n?V.setSize(G.x,G.y):V.setSize(floorPowerOfTwo(G.x),floorPowerOfTwo(G.y));const s=v.getRenderTarget();v.setRenderTarget(V),v.getClearColor(P),T=v.getClearAlpha(),T<1&&v.setClearColor(16777215,.5),v.clear();const o=v.toneMapping;v.toneMapping=NoToneMapping,Rt(t,i,r),Z.updateMultisampleRenderTarget(V),Z.updateRenderTargetMipmap(V);let a=!1;for(let t=0,n=e.length;t<n;t++){const n=e[t],s=n.object,o=n.geometry,l=n.material,c=n.group;if(l.side===DoubleSide&&s.layers.test(r.layers)){const t=l.side;l.side=BackSide,l.needsUpdate=!0,Nt(s,i,r,o,l,c),l.side=t,l.needsUpdate=!0,a=!0}}!0===a&&(Z.updateMultisampleRenderTarget(V),Z.updateRenderTargetMipmap(V)),v.setRenderTarget(s),v.setClearColor(P,T),v.toneMapping=o}(n,s,e,i),r&&$.viewport(M.copy(r)),n.length>0&&Rt(n,e,i),s.length>0&&Rt(s,e,i),o.length>0&&Rt(o,e,i),$.buffers.depth.setTest(!0),$.buffers.depth.setMask(!0),$.buffers.color.setMask(!0),$.setPolygonOffset(!1)}function Rt(t,e,i){const r=!0===e.isScene?e.overrideMaterial:null;for(let n=0,s=t.length;n<s;n++){const s=t[n],o=s.object,a=s.geometry,l=null===r?s.material:r,c=s.group;o.layers.test(i.layers)&&Nt(o,e,i,a,l,c)}}function Nt(t,e,i,r,n,s){t.onBeforeRender(v,e,i,r,n,s),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),n.onBeforeRender(v,e,i,r,t,s),!0===n.transparent&&n.side===DoubleSide&&!1===n.forceSinglePass?(n.side=BackSide,n.needsUpdate=!0,v.renderBufferDirect(i,e,r,n,t,s),n.side=FrontSide,n.needsUpdate=!0,v.renderBufferDirect(i,e,r,n,t,s),n.side=DoubleSide):v.renderBufferDirect(i,e,r,n,t,s),t.onAfterRender(v,e,i,r,n,s)}function Lt(t,e,i){!0!==e.isScene&&(e=Y);const r=K.get(t),n=m.state.lights,s=m.state.shadowsArray,o=n.state.version,a=nt.getParameters(t,n.state,s,e,i),l=nt.getProgramCacheKey(a);let c=r.programs;r.environment=t.isMeshStandardMaterial?e.environment:null,r.fog=e.fog,r.envMap=(t.isMeshStandardMaterial?tt:Q).get(t.envMap||r.environment),void 0===c&&(t.addEventListener("dispose",Et),c=new Map,r.programs=c);let h=c.get(l);if(void 0!==h){if(r.currentProgram===h&&r.lightsStateVersion===o)return Dt(t,a),h}else a.uniforms=nt.getUniforms(t),t.onBuild(i,a,v),t.onBeforeCompile(a,v),h=nt.acquireProgram(a,l),c.set(l,h),r.uniforms=a.uniforms;const u=r.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=lt.uniform),Dt(t,a),r.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),r.lightsStateVersion=o,r.needsLights&&(u.ambientLightColor.value=n.state.ambient,u.lightProbe.value=n.state.probe,u.directionalLights.value=n.state.directional,u.directionalLightShadows.value=n.state.directionalShadow,u.spotLights.value=n.state.spot,u.spotLightShadows.value=n.state.spotShadow,u.rectAreaLights.value=n.state.rectArea,u.ltc_1.value=n.state.rectAreaLTC1,u.ltc_2.value=n.state.rectAreaLTC2,u.pointLights.value=n.state.point,u.pointLightShadows.value=n.state.pointShadow,u.hemisphereLights.value=n.state.hemi,u.directionalShadowMap.value=n.state.directionalShadowMap,u.directionalShadowMatrix.value=n.state.directionalShadowMatrix,u.spotShadowMap.value=n.state.spotShadowMap,u.spotLightMatrix.value=n.state.spotLightMatrix,u.spotLightMap.value=n.state.spotLightMap,u.pointShadowMap.value=n.state.pointShadowMap,u.pointShadowMatrix.value=n.state.pointShadowMatrix);const d=h.getUniforms(),p=WebGLUniforms.seqWithValue(d.seq,u);return r.currentProgram=h,r.uniformsList=p,h}function Dt(t,e){const i=K.get(t);i.outputColorSpace=e.outputColorSpace,i.instancing=e.instancing,i.instancingColor=e.instancingColor,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphColors=e.morphColors,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents,i.toneMapping=e.toneMapping}Pt.setAnimationLoop((function(t){Mt&&Mt(t)})),"undefined"!=typeof self&&Pt.setContext(self),this.setAnimationLoop=function(t){Mt=t,bt.setAnimationLoop(t),null===t?Pt.stop():Pt.start()},bt.addEventListener("sessionstart",St),bt.addEventListener("sessionend",wt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===y)return;!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===bt.enabled&&!0===bt.isPresenting&&(!0===bt.cameraAutoUpdate&&bt.updateCamera(e),e=bt.getCamera()),!0===t.isScene&&t.onBeforeRender(v,t,e,x),m=at.get(t,_.length),m.init(),_.push(m),z.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),U.setFromProjectionMatrix(z),j=this.localClippingEnabled,F=lt.init(this.clippingPlanes,j),f=ot.get(t,g.length),f.init(),g.push(f),Tt(t,e,0,v.sortObjects),f.finish(),!0===v.sortObjects&&f.sort(L,D),this.info.render.frame++,!0===F&&lt.beginShadows();const i=m.state.shadowsArray;if(ct.render(i,t,e),!0===F&&lt.endShadows(),!0===this.info.autoReset&&this.info.reset(),ht.render(f,t),m.setupLights(v._useLegacyLights),e.isArrayCamera){const i=e.cameras;for(let e=0,r=i.length;e<r;e++){const r=i[e];Ot(f,t,r,r.viewport)}}else Ot(f,t,e);null!==x&&(Z.updateMultisampleRenderTarget(x),Z.updateRenderTargetMipmap(x)),!0===t.isScene&&t.onAfterRender(v,t,e),mt.resetDefaultState(),C=-1,E=null,_.pop(),m=_.length>0?_[_.length-1]:null,g.pop(),f=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return A},this.getRenderTarget=function(){return x},this.setRenderTargetTextures=function(t,e,i){K.get(t.texture).__webglTexture=e,K.get(t.depthTexture).__webglTexture=i;const r=K.get(t);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===i,r.__autoAllocateDepthBuffer||!0===W.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){const i=K.get(t);i.__webglFramebuffer=e,i.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,i=0){x=t,b=e,A=i;let r=!0,n=null,s=!1,o=!1;if(t){const a=K.get(t);void 0!==a.__useDefaultFramebuffer?($.bindFramebuffer(_t.FRAMEBUFFER,null),r=!1):void 0===a.__webglFramebuffer?Z.setupRenderTarget(t):a.__hasExternalTextures&&Z.rebindTextures(t,K.get(t.texture).__webglTexture,K.get(t.depthTexture).__webglTexture);const l=t.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(o=!0);const c=K.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(n=Array.isArray(c[e])?c[e][i]:c[e],s=!0):n=J.isWebGL2&&t.samples>0&&!1===Z.useMultisampledRTT(t)?K.get(t).__webglMultisampledFramebuffer:Array.isArray(c)?c[i]:c,M.copy(t.viewport),S.copy(t.scissor),w=t.scissorTest}else M.copy(k).multiplyScalar(N).floor(),S.copy(I).multiplyScalar(N).floor(),w=B;if($.bindFramebuffer(_t.FRAMEBUFFER,n)&&J.drawBuffers&&r&&$.drawBuffers(t,n),$.viewport(M),$.scissor(S),$.setScissorTest(w),s){const r=K.get(t.texture);_t.framebufferTexture2D(_t.FRAMEBUFFER,_t.COLOR_ATTACHMENT0,_t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r.__webglTexture,i)}else if(o){const r=K.get(t.texture),n=e||0;_t.framebufferTextureLayer(_t.FRAMEBUFFER,_t.COLOR_ATTACHMENT0,r.__webglTexture,i||0,n)}C=-1},this.readRenderTargetPixels=function(t,e,i,r,n,s,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=K.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){$.bindFramebuffer(_t.FRAMEBUFFER,a);try{const o=t.texture,a=o.format,l=o.type;if(a!==RGBAFormat&&ft.convert(a)!==_t.getParameter(_t.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===HalfFloatType&&(W.has("EXT_color_buffer_half_float")||J.isWebGL2&&W.has("EXT_color_buffer_float"));if(!(l===UnsignedByteType||ft.convert(l)===_t.getParameter(_t.IMPLEMENTATION_COLOR_READ_TYPE)||l===FloatType&&(J.isWebGL2||W.has("OES_texture_float")||W.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-r&&i>=0&&i<=t.height-n&&_t.readPixels(e,i,r,n,ft.convert(a),ft.convert(l),s)}finally{const t=null!==x?K.get(x).__webglFramebuffer:null;$.bindFramebuffer(_t.FRAMEBUFFER,t)}}},this.copyFramebufferToTexture=function(t,e,i=0){const r=Math.pow(2,-i),n=Math.floor(e.image.width*r),s=Math.floor(e.image.height*r);Z.setTexture2D(e,0),_t.copyTexSubImage2D(_t.TEXTURE_2D,i,0,0,t.x,t.y,n,s),$.unbindTexture()},this.copyTextureToTexture=function(t,e,i,r=0){const n=e.image.width,s=e.image.height,o=ft.convert(i.format),a=ft.convert(i.type);Z.setTexture2D(i,0),_t.pixelStorei(_t.UNPACK_FLIP_Y_WEBGL,i.flipY),_t.pixelStorei(_t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),_t.pixelStorei(_t.UNPACK_ALIGNMENT,i.unpackAlignment),e.isDataTexture?_t.texSubImage2D(_t.TEXTURE_2D,r,t.x,t.y,n,s,o,a,e.image.data):e.isCompressedTexture?_t.compressedTexSubImage2D(_t.TEXTURE_2D,r,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):_t.texSubImage2D(_t.TEXTURE_2D,r,t.x,t.y,o,a,e.image),0===r&&i.generateMipmaps&&_t.generateMipmap(_t.TEXTURE_2D),$.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i,r,n=0){if(v.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,a=t.max.z-t.min.z+1,l=ft.convert(r.format),c=ft.convert(r.type);let h;if(r.isData3DTexture)Z.setTexture3D(r,0),h=_t.TEXTURE_3D;else{if(!r.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Z.setTexture2DArray(r,0),h=_t.TEXTURE_2D_ARRAY}_t.pixelStorei(_t.UNPACK_FLIP_Y_WEBGL,r.flipY),_t.pixelStorei(_t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),_t.pixelStorei(_t.UNPACK_ALIGNMENT,r.unpackAlignment);const u=_t.getParameter(_t.UNPACK_ROW_LENGTH),d=_t.getParameter(_t.UNPACK_IMAGE_HEIGHT),p=_t.getParameter(_t.UNPACK_SKIP_PIXELS),f=_t.getParameter(_t.UNPACK_SKIP_ROWS),m=_t.getParameter(_t.UNPACK_SKIP_IMAGES),g=i.isCompressedTexture?i.mipmaps[0]:i.image;_t.pixelStorei(_t.UNPACK_ROW_LENGTH,g.width),_t.pixelStorei(_t.UNPACK_IMAGE_HEIGHT,g.height),_t.pixelStorei(_t.UNPACK_SKIP_PIXELS,t.min.x),_t.pixelStorei(_t.UNPACK_SKIP_ROWS,t.min.y),_t.pixelStorei(_t.UNPACK_SKIP_IMAGES,t.min.z),i.isDataTexture||i.isData3DTexture?_t.texSubImage3D(h,n,e.x,e.y,e.z,s,o,a,l,c,g.data):i.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),_t.compressedTexSubImage3D(h,n,e.x,e.y,e.z,s,o,a,l,g.data)):_t.texSubImage3D(h,n,e.x,e.y,e.z,s,o,a,l,c,g),_t.pixelStorei(_t.UNPACK_ROW_LENGTH,u),_t.pixelStorei(_t.UNPACK_IMAGE_HEIGHT,d),_t.pixelStorei(_t.UNPACK_SKIP_PIXELS,p),_t.pixelStorei(_t.UNPACK_SKIP_ROWS,f),_t.pixelStorei(_t.UNPACK_SKIP_IMAGES,m),0===n&&r.generateMipmaps&&_t.generateMipmap(h),$.unbindTexture()},this.initTexture=function(t){t.isCubeTexture?Z.setTextureCube(t,0):t.isData3DTexture?Z.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?Z.setTexture2DArray(t,0):Z.setTexture2D(t,0),$.unbindTexture()},this.resetState=function(){b=0,A=0,x=null,$.reset(),mt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return WebGLCoordinateSystem}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(t){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!t}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===SRGBColorSpace?sRGBEncoding:LinearEncoding}set outputEncoding(t){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=t===sRGBEncoding?SRGBColorSpace:LinearSRGBColorSpace}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(t){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=t}}class WebGL1Renderer extends WebGLRenderer{}WebGL1Renderer.prototype.isWebGL1Renderer=!0;class FogExp2{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new Color(t),this.density=e}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Fog{constructor(t,e=1,i=1e3){this.isFog=!0,this.name="",this.color=new Color(t),this.near=e,this.far=i}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Scene extends Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e}}class InterleavedBuffer{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=generateUUID()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let r=0,n=this.stride;r<n;r++)this.array[t+r]=e.array[i+r];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _vector$5=new Vector3;class InterleavedBufferAttribute{constructor(t,e,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)_vector$5.fromBufferAttribute(this,e),_vector$5.applyMatrix4(t),this.setXYZ(e,_vector$5.x,_vector$5.y,_vector$5.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)_vector$5.fromBufferAttribute(this,e),_vector$5.applyNormalMatrix(t),this.setXYZ(e,_vector$5.x,_vector$5.y,_vector$5.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)_vector$5.fromBufferAttribute(this,e),_vector$5.transformDirection(t),this.setXYZ(e,_vector$5.x,_vector$5.y,_vector$5.z);return this}setX(t,e){return this.normalized&&(e=normalize(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=normalize(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=normalize(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=normalize(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=denormalize(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=denormalize(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=denormalize(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=denormalize(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=normalize(e,this.array),i=normalize(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=normalize(e,this.array),i=normalize(i,this.array),r=normalize(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this}setXYZW(t,e,i,r,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=normalize(e,this.array),i=normalize(i,this.array),r=normalize(r,this.array),n=normalize(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this.data.array[t+3]=n,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new BufferAttribute(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new InterleavedBufferAttribute(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class SpriteMaterial extends Material{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let _geometry;const _intersectPoint=new Vector3,_worldScale=new Vector3,_mvPosition=new Vector3,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA=new Vector3,_vB=new Vector3,_vC=new Vector3,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2;class Sprite extends Object3D{constructor(t){if(super(),this.isSprite=!0,this.type="Sprite",void 0===_geometry){_geometry=new BufferGeometry;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new InterleavedBuffer(t,5);_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(e,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(e,2,3,!1))}this.geometry=_geometry,this.material=void 0!==t?t:new SpriteMaterial,this.center=new Vector2(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&_worldScale.multiplyScalar(-_mvPosition.z);const i=this.material.rotation;let r,n;0!==i&&(n=Math.cos(i),r=Math.sin(i));const s=this.center;transformVertex(_vA.set(-.5,-.5,0),_mvPosition,s,_worldScale,r,n),transformVertex(_vB.set(.5,-.5,0),_mvPosition,s,_worldScale,r,n),transformVertex(_vC.set(.5,.5,0),_mvPosition,s,_worldScale,r,n),_uvA.set(0,0),_uvB.set(1,0),_uvC.set(1,1);let o=t.ray.intersectTriangle(_vA,_vB,_vC,!1,_intersectPoint);if(null===o&&(transformVertex(_vB.set(-.5,.5,0),_mvPosition,s,_worldScale,r,n),_uvB.set(0,1),o=t.ray.intersectTriangle(_vA,_vC,_vB,!1,_intersectPoint),null===o))return;const a=t.ray.origin.distanceTo(_intersectPoint);a<t.near||a>t.far||e.push({distance:a,point:_intersectPoint.clone(),uv:Triangle.getInterpolation(_intersectPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2),face:null,object:this})}copy(t,e){return super.copy(t,e),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function transformVertex(t,e,i,r,n,s){_alignedPosition.subVectors(t,i).addScalar(.5).multiply(r),void 0!==n?(_rotatedPosition.x=s*_alignedPosition.x-n*_alignedPosition.y,_rotatedPosition.y=n*_alignedPosition.x+s*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),t.copy(e),t.x+=_rotatedPosition.x,t.y+=_rotatedPosition.y,t.applyMatrix4(_viewWorldMatrix)}const _v1$2=new Vector3,_v2$1=new Vector3;class LOD extends Object3D{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let t=0,i=e.length;t<i;t++){const i=e[t];this.addLevel(i.object.clone(),i.distance,i.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0,i=0){e=Math.abs(e);const r=this.levels;let n;for(n=0;n<r.length&&!(e<r[n].distance);n++);return r.splice(n,0,{distance:e,hysteresis:i,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let i,r;for(i=1,r=e.length;i<r;i++){let r=e[i].distance;if(e[i].object.visible&&(r-=r*e[i].hysteresis),t<r)break}return e[i-1].object}return null}raycast(t,e){if(this.levels.length>0){_v1$2.setFromMatrixPosition(this.matrixWorld);const i=t.ray.origin.distanceTo(_v1$2);this.getObjectForDistance(i).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){_v1$2.setFromMatrixPosition(t.matrixWorld),_v2$1.setFromMatrixPosition(this.matrixWorld);const i=_v1$2.distanceTo(_v2$1)/t.zoom;let r,n;for(e[0].object.visible=!0,r=1,n=e.length;r<n;r++){let t=e[r].distance;if(e[r].object.visible&&(t-=t*e[r].hysteresis),!(i>=t))break;e[r-1].object.visible=!1,e[r].object.visible=!0}for(this._currentLevel=r-1;r<n;r++)e[r].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const i=this.levels;for(let t=0,r=i.length;t<r;t++){const r=i[t];e.object.levels.push({object:r.object.uuid,distance:r.distance,hysteresis:r.hysteresis})}return e}}const _basePosition=new Vector3,_skinIndex=new Vector4,_skinWeight=new Vector4,_vector3=new Vector3,_matrix4=new Matrix4,_vertex=new Vector3,_sphere$3=new Sphere,_inverseMatrix$2=new Matrix4,_ray$2=new Ray;class SkinnedMesh extends Mesh{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)_vertex.fromBufferAttribute(e,t),this.applyBoneTransform(t,_vertex),this.boundingBox.expandByPoint(_vertex)}computeBoundingSphere(){const t=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)_vertex.fromBufferAttribute(e,t),this.applyBoneTransform(t,_vertex),this.boundingSphere.expandByPoint(_vertex)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const i=this.material,r=this.matrixWorld;void 0!==i&&(null===this.boundingSphere&&this.computeBoundingSphere(),_sphere$3.copy(this.boundingSphere),_sphere$3.applyMatrix4(r),!1!==t.ray.intersectsSphere(_sphere$3)&&(_inverseMatrix$2.copy(r).invert(),_ray$2.copy(t.ray).applyMatrix4(_inverseMatrix$2),null!==this.boundingBox&&!1===_ray$2.intersectsBox(this.boundingBox)||this._computeIntersections(t,e,_ray$2)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Vector4,e=this.geometry.attributes.skinWeight;for(let i=0,r=e.count;i<r;i++){t.fromBufferAttribute(e,i);const r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const i=this.skeleton,r=this.geometry;_skinIndex.fromBufferAttribute(r.attributes.skinIndex,t),_skinWeight.fromBufferAttribute(r.attributes.skinWeight,t),_basePosition.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const r=_skinWeight.getComponent(t);if(0!==r){const n=_skinIndex.getComponent(t);_matrix4.multiplyMatrices(i.bones[n].matrixWorld,i.boneInverses[n]),e.addScaledVector(_vector3.copy(_basePosition).applyMatrix4(_matrix4),r)}}return e.applyMatrix4(this.bindMatrixInverse)}boneTransform(t,e){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(t,e)}}class Bone extends Object3D{constructor(){super(),this.isBone=!0,this.type="Bone"}}class DataTexture extends Texture{constructor(t=null,e=1,i=1,r,n,s,o,a,l=NearestFilter,c=NearestFilter,h,u){super(null,s,o,a,l,c,r,n,h,u),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const _offsetMatrix=new Matrix4,_identityMatrix=new Matrix4;class Skeleton{constructor(t=[],e=[]){this.uuid=generateUUID(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Matrix4)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new Matrix4;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let r=0,n=t.length;r<n;r++){const n=t[r]?t[r].matrixWorld:_identityMatrix;_offsetMatrix.multiplyMatrices(n,e[r]),_offsetMatrix.toArray(i,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=ceilPowerOfTwo(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new DataTexture(e,t,t,RGBAFormat,FloatType);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const i=this.bones[e];if(i.name===t)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,r=t.bones.length;i<r;i++){const r=t.bones[i];let n=e[r];void 0===n&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),n=new Bone),this.bones.push(n),this.boneInverses.push((new Matrix4).fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let r=0,n=e.length;r<n;r++){const n=e[r];t.bones.push(n.uuid);const s=i[r];t.boneInverses.push(s.toArray())}return t}}class InstancedBufferAttribute extends BufferAttribute{constructor(t,e,i,r=1){super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_box3=new Box3,_identity=new Matrix4,_mesh=new Mesh,_sphere$2=new Sphere;class InstancedMesh extends Mesh{constructor(t,e,i){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new InstancedBufferAttribute(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let t=0;t<i;t++)this.setMatrixAt(t,_identity)}computeBoundingBox(){const t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new Box3),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,_instanceLocalMatrix),_box3.copy(t.boundingBox).applyMatrix4(_instanceLocalMatrix),this.boundingBox.union(_box3)}computeBoundingSphere(){const t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new Sphere),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,_instanceLocalMatrix),_sphere$2.copy(t.boundingSphere).applyMatrix4(_instanceLocalMatrix),this.boundingSphere.union(_sphere$2)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const i=this.matrixWorld,r=this.count;if(_mesh.geometry=this.geometry,_mesh.material=this.material,void 0!==_mesh.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),_sphere$2.copy(this.boundingSphere),_sphere$2.applyMatrix4(i),!1!==t.ray.intersectsSphere(_sphere$2)))for(let n=0;n<r;n++){this.getMatrixAt(n,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(i,_instanceLocalMatrix),_mesh.matrixWorld=_instanceWorldMatrix,_mesh.raycast(t,_instanceIntersects);for(let t=0,i=_instanceIntersects.length;t<i;t++){const i=_instanceIntersects[t];i.instanceId=n,i.object=this,e.push(i)}_instanceIntersects.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new InstancedBufferAttribute(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class LineBasicMaterial extends Material{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Color(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const _start$1=new Vector3,_end$1=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray,_sphere$1=new Sphere;class Line extends Object3D{constructor(t=new BufferGeometry,e=new LineBasicMaterial){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,r=e.count;t<r;t++)_start$1.fromBufferAttribute(e,t-1),_end$1.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=_start$1.distanceTo(_end$1);t.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const i=this.geometry,r=this.matrixWorld,n=t.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),_sphere$1.copy(i.boundingSphere),_sphere$1.applyMatrix4(r),_sphere$1.radius+=n,!1===t.ray.intersectsSphere(_sphere$1))return;_inverseMatrix$1.copy(r).invert(),_ray$1.copy(t.ray).applyMatrix4(_inverseMatrix$1);const o=n/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new Vector3,c=new Vector3,h=new Vector3,u=new Vector3,d=this.isLineSegments?2:1,p=i.index,f=i.attributes.position;if(null!==p)for(let i=Math.max(0,s.start),r=Math.min(p.count,s.start+s.count)-1;i<r;i+=d){const r=p.getX(i),n=p.getX(i+1);if(l.fromBufferAttribute(f,r),c.fromBufferAttribute(f,n),_ray$1.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);const s=t.ray.origin.distanceTo(u);s<t.near||s>t.far||e.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}else for(let i=Math.max(0,s.start),r=Math.min(f.count,s.start+s.count)-1;i<r;i+=d){if(l.fromBufferAttribute(f,i),c.fromBufferAttribute(f,i+1),_ray$1.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);const r=t.ray.origin.distanceTo(u);r<t.near||r>t.far||e.push({distance:r,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}const _start=new Vector3,_end=new Vector3;class LineSegments extends Line{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,r=e.count;t<r;t+=2)_start.fromBufferAttribute(e,t),_end.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+_start.distanceTo(_end);t.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class LineLoop extends Line{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class PointsMaterial extends Material{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const _inverseMatrix=new Matrix4,_ray=new Ray,_sphere=new Sphere,_position$2=new Vector3;class Points extends Object3D{constructor(t=new BufferGeometry,e=new PointsMaterial){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,r=this.matrixWorld,n=t.params.Points.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),_sphere.copy(i.boundingSphere),_sphere.applyMatrix4(r),_sphere.radius+=n,!1===t.ray.intersectsSphere(_sphere))return;_inverseMatrix.copy(r).invert(),_ray.copy(t.ray).applyMatrix4(_inverseMatrix);const o=n/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=i.index,c=i.attributes.position;if(null!==l)for(let i=Math.max(0,s.start),n=Math.min(l.count,s.start+s.count);i<n;i++){const n=l.getX(i);_position$2.fromBufferAttribute(c,n),testPoint(_position$2,n,a,r,t,e,this)}else for(let i=Math.max(0,s.start),n=Math.min(c.count,s.start+s.count);i<n;i++)_position$2.fromBufferAttribute(c,i),testPoint(_position$2,i,a,r,t,e,this)}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function testPoint(t,e,i,r,n,s,o){const a=_ray.distanceSqToPoint(t);if(a<i){const i=new Vector3;_ray.closestPointToPoint(t,i),i.applyMatrix4(r);const l=n.ray.origin.distanceTo(i);if(l<n.near||l>n.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:i,index:e,face:null,object:o})}}class VideoTexture extends Texture{constructor(t,e,i,r,n,s,o,a,l){super(t,e,i,r,n,s,o,a,l),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:LinearFilter,this.magFilter=void 0!==n?n:LinearFilter,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1=="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class FramebufferTexture extends Texture{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.generateMipmaps=!1,this.needsUpdate=!0}}class CompressedTexture extends Texture{constructor(t,e,i,r,n,s,o,a,l,c,h,u){super(null,s,o,a,l,c,r,n,h,u),this.isCompressedTexture=!0,this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class CompressedArrayTexture extends CompressedTexture{constructor(t,e,i,r,n,s){super(t,e,i,n,s),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=ClampToEdgeWrapping}}class CompressedCubeTexture extends CompressedTexture{constructor(t,e,i){super(void 0,t[0].width,t[0].height,e,i,CubeReflectionMapping),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class CanvasTexture extends Texture{constructor(t,e,i,r,n,s,o,a,l){super(t,e,i,r,n,s,o,a,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Curve{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,r=this.getPoint(0),n=0;e.push(0);for(let s=1;s<=t;s++)i=this.getPoint(s/t),n+=i.distanceTo(r),e.push(n),r=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let r=0;const n=i.length;let s;s=e||t*i[n-1];let o,a=0,l=n-1;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),o=i[r]-s,o<0)a=r+1;else{if(!(o>0)){l=r;break}l=r-1}if(r=l,i[r]===s)return r/(n-1);const c=i[r];return(r+(s-c)/(i[r+1]-c))/(n-1)}getTangent(t,e){const i=1e-4;let r=t-i,n=t+i;r<0&&(r=0),n>1&&(n=1);const s=this.getPoint(r),o=this.getPoint(n),a=e||(s.isVector2?new Vector2:new Vector3);return a.copy(o).sub(s).normalize(),a}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new Vector3,r=[],n=[],s=[],o=new Vector3,a=new Matrix4;for(let e=0;e<=t;e++){const i=e/t;r[e]=this.getTangentAt(i,new Vector3)}n[0]=new Vector3,s[0]=new Vector3;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),h=Math.abs(r[0].y),u=Math.abs(r[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),u<=l&&i.set(0,0,1),o.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],o),s[0].crossVectors(r[0],n[0]);for(let e=1;e<=t;e++){if(n[e]=n[e-1].clone(),s[e]=s[e-1].clone(),o.crossVectors(r[e-1],r[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(clamp(r[e-1].dot(r[e]),-1,1));n[e].applyMatrix4(a.makeRotationAxis(o,t))}s[e].crossVectors(r[e],n[e])}if(!0===e){let e=Math.acos(clamp(n[0].dot(n[t]),-1,1));e/=t,r[0].dot(o.crossVectors(n[0],n[t]))>0&&(e=-e);for(let i=1;i<=t;i++)n[i].applyMatrix4(a.makeRotationAxis(r[i],e*i)),s[i].crossVectors(r[i],n[i])}return{tangents:r,normals:n,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class EllipseCurve extends Curve{constructor(t=0,e=0,i=1,r=1,n=0,s=2*Math.PI,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t,e){const i=e||new Vector2,r=2*Math.PI;let n=this.aEndAngle-this.aStartAngle;const s=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(n=s?0:r),!0!==this.aClockwise||s||(n===r?n=-r:n-=r);const o=this.aStartAngle+t*n;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=a-this.aX,r=l-this.aY;a=i*t-r*e+this.aX,l=i*e+r*t+this.aY}return i.set(a,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class ArcCurve extends EllipseCurve{constructor(t,e,i,r,n,s){super(t,e,i,i,r,n,s),this.isArcCurve=!0,this.type="ArcCurve"}}function CubicPoly(){let t=0,e=0,i=0,r=0;function n(n,s,o,a){t=n,e=o,i=-3*n+3*s-2*o-a,r=2*n-2*s+o+a}return{initCatmullRom:function(t,e,i,r,s){n(e,i,s*(i-t),s*(r-e))},initNonuniformCatmullRom:function(t,e,i,r,s,o,a){let l=(e-t)/s-(i-t)/(s+o)+(i-e)/o,c=(i-e)/o-(r-e)/(o+a)+(r-i)/a;l*=o,c*=o,n(e,i,l,c)},calc:function(n){const s=n*n;return t+e*n+i*s+r*(s*n)}}}const tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;class CatmullRomCurve3 extends Curve{constructor(t=[],e=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=r}getPoint(t,e=new Vector3){const i=e,r=this.points,n=r.length,s=(n-(this.closed?0:1))*t;let o,a,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/n)+1)*n:0===c&&l===n-1&&(l=n-2,c=1),this.closed||l>0?o=r[(l-1)%n]:(tmp.subVectors(r[0],r[1]).add(r[0]),o=tmp);const h=r[l%n],u=r[(l+1)%n];if(this.closed||l+2<n?a=r[(l+2)%n]:(tmp.subVectors(r[n-1],r[n-2]).add(r[n-1]),a=tmp),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(h),t),i=Math.pow(h.distanceToSquared(u),t),r=Math.pow(u.distanceToSquared(a),t);i<1e-4&&(i=1),e<1e-4&&(e=i),r<1e-4&&(r=i),px.initNonuniformCatmullRom(o.x,h.x,u.x,a.x,e,i,r),py.initNonuniformCatmullRom(o.y,h.y,u.y,a.y,e,i,r),pz.initNonuniformCatmullRom(o.z,h.z,u.z,a.z,e,i,r)}else"catmullrom"===this.curveType&&(px.initCatmullRom(o.x,h.x,u.x,a.x,this.tension),py.initCatmullRom(o.y,h.y,u.y,a.y,this.tension),pz.initCatmullRom(o.z,h.z,u.z,a.z,this.tension));return i.set(px.calc(c),py.calc(c),pz.calc(c)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new Vector3).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function CatmullRom(t,e,i,r,n){const s=.5*(r-e),o=.5*(n-i),a=t*t;return(2*i-2*r+s+o)*(t*a)+(-3*i+3*r-2*s-o)*a+s*t+i}function QuadraticBezierP0(t,e){const i=1-t;return i*i*e}function QuadraticBezierP1(t,e){return 2*(1-t)*t*e}function QuadraticBezierP2(t,e){return t*t*e}function QuadraticBezier(t,e,i,r){return QuadraticBezierP0(t,e)+QuadraticBezierP1(t,i)+QuadraticBezierP2(t,r)}function CubicBezierP0(t,e){const i=1-t;return i*i*i*e}function CubicBezierP1(t,e){const i=1-t;return 3*i*i*t*e}function CubicBezierP2(t,e){return 3*(1-t)*t*t*e}function CubicBezierP3(t,e){return t*t*t*e}function CubicBezier(t,e,i,r,n){return CubicBezierP0(t,e)+CubicBezierP1(t,i)+CubicBezierP2(t,r)+CubicBezierP3(t,n)}class CubicBezierCurve extends Curve{constructor(t=new Vector2,e=new Vector2,i=new Vector2,r=new Vector2){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=r}getPoint(t,e=new Vector2){const i=e,r=this.v0,n=this.v1,s=this.v2,o=this.v3;return i.set(CubicBezier(t,r.x,n.x,s.x,o.x),CubicBezier(t,r.y,n.y,s.y,o.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class CubicBezierCurve3 extends Curve{constructor(t=new Vector3,e=new Vector3,i=new Vector3,r=new Vector3){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=r}getPoint(t,e=new Vector3){const i=e,r=this.v0,n=this.v1,s=this.v2,o=this.v3;return i.set(CubicBezier(t,r.x,n.x,s.x,o.x),CubicBezier(t,r.y,n.y,s.y,o.y),CubicBezier(t,r.z,n.z,s.z,o.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class LineCurve extends Curve{constructor(t=new Vector2,e=new Vector2){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Vector2){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new Vector2){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class LineCurve3 extends Curve{constructor(t=new Vector3,e=new Vector3){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new Vector3){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new Vector3){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class QuadraticBezierCurve extends Curve{constructor(t=new Vector2,e=new Vector2,i=new Vector2){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Vector2){const i=e,r=this.v0,n=this.v1,s=this.v2;return i.set(QuadraticBezier(t,r.x,n.x,s.x),QuadraticBezier(t,r.y,n.y,s.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class QuadraticBezierCurve3 extends Curve{constructor(t=new Vector3,e=new Vector3,i=new Vector3){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Vector3){const i=e,r=this.v0,n=this.v1,s=this.v2;return i.set(QuadraticBezier(t,r.x,n.x,s.x),QuadraticBezier(t,r.y,n.y,s.y),QuadraticBezier(t,r.z,n.z,s.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class SplineCurve extends Curve{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new Vector2){const i=e,r=this.points,n=(r.length-1)*t,s=Math.floor(n),o=n-s,a=r[0===s?s:s-1],l=r[s],c=r[s>r.length-2?r.length-1:s+1],h=r[s>r.length-3?r.length-1:s+2];return i.set(CatmullRom(o,a.x,l.x,c.x,h.x),CatmullRom(o,a.y,l.y,c.y,h.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new Vector2).fromArray(i))}return this}}var Curves=Object.freeze({__proto__:null,ArcCurve,CatmullRomCurve3,CubicBezierCurve,CubicBezierCurve3,EllipseCurve,LineCurve,LineCurve3,QuadraticBezierCurve,QuadraticBezierCurve3,SplineCurve});class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new LineCurve(e,t))}getPoint(t,e){const i=t*this.getLength(),r=this.getCurveLengths();let n=0;for(;n<r.length;){if(r[n]>=i){const t=r[n]-i,s=this.curves[n],o=s.getLength(),a=0===o?0:1-t/o;return s.getPointAt(a,e)}n++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,r=this.curves.length;i<r;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let r=0,n=this.curves;r<n.length;r++){const s=n[r],o=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,a=s.getPoints(o);for(let t=0;t<a.length;t++){const r=a[t];i&&i.equals(r)||(e.push(r),i=r)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new Curves[i.type]).fromJSON(i))}return this}}class Path extends CurvePath{constructor(t){super(),this.type="Path",this.currentPoint=new Vector2,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new LineCurve(this.currentPoint.clone(),new Vector2(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,r){const n=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(t,e),new Vector2(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this}bezierCurveTo(t,e,i,r,n,s){const o=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(t,e),new Vector2(i,r),new Vector2(n,s));return this.curves.push(o),this.currentPoint.set(n,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new SplineCurve(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,r,n,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,i,r,n,s),this}absarc(t,e,i,r,n,s){return this.absellipse(t,e,i,i,r,n,s),this}ellipse(t,e,i,r,n,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,i,r,n,s,o,a),this}absellipse(t,e,i,r,n,s,o,a){const l=new EllipseCurve(t,e,i,r,n,s,o,a);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class LatheGeometry extends BufferGeometry{constructor(t=[new Vector2(0,-.5),new Vector2(.5,0),new Vector2(0,.5)],e=12,i=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:r},e=Math.floor(e),r=clamp(r,0,2*Math.PI);const n=[],s=[],o=[],a=[],l=[],c=1/e,h=new Vector3,u=new Vector2,d=new Vector3,p=new Vector3,f=new Vector3;let m=0,g=0;for(let e=0;e<=t.length-1;e++)switch(e){case 0:m=t[e+1].x-t[e].x,g=t[e+1].y-t[e].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),a.push(d.x,d.y,d.z);break;case t.length-1:a.push(f.x,f.y,f.z);break;default:m=t[e+1].x-t[e].x,g=t[e+1].y-t[e].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),a.push(d.x,d.y,d.z),f.copy(p)}for(let n=0;n<=e;n++){const d=i+n*c*r,p=Math.sin(d),f=Math.cos(d);for(let i=0;i<=t.length-1;i++){h.x=t[i].x*p,h.y=t[i].y,h.z=t[i].x*f,s.push(h.x,h.y,h.z),u.x=n/e,u.y=i/(t.length-1),o.push(u.x,u.y);const r=a[3*i+0]*p,c=a[3*i+1],d=a[3*i+0]*f;l.push(r,c,d)}}for(let i=0;i<e;i++)for(let e=0;e<t.length-1;e++){const r=e+i*t.length,s=r,o=r+t.length,a=r+t.length+1,l=r+1;n.push(s,o,l),n.push(a,l,o)}this.setIndex(n),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("uv",new Float32BufferAttribute(o,2)),this.setAttribute("normal",new Float32BufferAttribute(l,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new LatheGeometry(t.points,t.segments,t.phiStart,t.phiLength)}}class CapsuleGeometry extends LatheGeometry{constructor(t=1,e=1,i=4,r=8){const n=new Path;n.absarc(0,-e/2,t,1.5*Math.PI,0),n.absarc(0,e/2,t,0,.5*Math.PI),super(n.getPoints(i),r),this.type="CapsuleGeometry",this.parameters={radius:t,length:e,capSegments:i,radialSegments:r}}static fromJSON(t){return new CapsuleGeometry(t.radius,t.length,t.capSegments,t.radialSegments)}}class CircleGeometry extends BufferGeometry{constructor(t=1,e=32,i=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:r},e=Math.max(3,e);const n=[],s=[],o=[],a=[],l=new Vector3,c=new Vector2;s.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let n=0,h=3;n<=e;n++,h+=3){const u=i+n/e*r;l.x=t*Math.cos(u),l.y=t*Math.sin(u),s.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(s[h]/t+1)/2,c.y=(s[h+1]/t+1)/2,a.push(c.x,c.y)}for(let t=1;t<=e;t++)n.push(t,t+1,0);this.setIndex(n),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("normal",new Float32BufferAttribute(o,3)),this.setAttribute("uv",new Float32BufferAttribute(a,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new CircleGeometry(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class CylinderGeometry extends BufferGeometry{constructor(t=1,e=1,i=1,r=32,n=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:o,thetaLength:a};const l=this;r=Math.floor(r),n=Math.floor(n);const c=[],h=[],u=[],d=[];let p=0;const f=[],m=i/2;let g=0;function _(i){const n=p,s=new Vector2,f=new Vector3;let _=0;const v=!0===i?t:e,y=!0===i?1:-1;for(let t=1;t<=r;t++)h.push(0,m*y,0),u.push(0,y,0),d.push(.5,.5),p++;const b=p;for(let t=0;t<=r;t++){const e=t/r*a+o,i=Math.cos(e),n=Math.sin(e);f.x=v*n,f.y=m*y,f.z=v*i,h.push(f.x,f.y,f.z),u.push(0,y,0),s.x=.5*i+.5,s.y=.5*n*y+.5,d.push(s.x,s.y),p++}for(let t=0;t<r;t++){const e=n+t,r=b+t;!0===i?c.push(r,r+1,e):c.push(r+1,r,e),_+=3}l.addGroup(g,_,!0===i?1:2),g+=_}!function(){const s=new Vector3,_=new Vector3;let v=0;const y=(e-t)/i;for(let l=0;l<=n;l++){const c=[],g=l/n,v=g*(e-t)+t;for(let t=0;t<=r;t++){const e=t/r,n=e*a+o,l=Math.sin(n),f=Math.cos(n);_.x=v*l,_.y=-g*i+m,_.z=v*f,h.push(_.x,_.y,_.z),s.set(l,y,f).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-g),c.push(p++)}f.push(c)}for(let t=0;t<r;t++)for(let e=0;e<n;e++){const i=f[e][t],r=f[e+1][t],n=f[e+1][t+1],s=f[e][t+1];c.push(i,r,s),c.push(r,n,s),v+=6}l.addGroup(g,v,0),g+=v}(),!1===s&&(t>0&&_(!0),e>0&&_(!1)),this.setIndex(c),this.setAttribute("position",new Float32BufferAttribute(h,3)),this.setAttribute("normal",new Float32BufferAttribute(u,3)),this.setAttribute("uv",new Float32BufferAttribute(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new CylinderGeometry(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class ConeGeometry extends CylinderGeometry{constructor(t=1,e=1,i=32,r=1,n=!1,s=0,o=2*Math.PI){super(0,t,e,i,r,n,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:s,thetaLength:o}}static fromJSON(t){return new ConeGeometry(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class PolyhedronGeometry extends BufferGeometry{constructor(t=[],e=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:r};const n=[],s=[];function o(t,e,i,r){const n=r+1,s=[];for(let r=0;r<=n;r++){s[r]=[];const o=t.clone().lerp(i,r/n),a=e.clone().lerp(i,r/n),l=n-r;for(let t=0;t<=l;t++)s[r][t]=0===t&&r===n?o:o.clone().lerp(a,t/l)}for(let t=0;t<n;t++)for(let e=0;e<2*(n-t)-1;e++){const i=Math.floor(e/2);e%2==0?(a(s[t][i+1]),a(s[t+1][i]),a(s[t][i])):(a(s[t][i+1]),a(s[t+1][i+1]),a(s[t+1][i]))}}function a(t){n.push(t.x,t.y,t.z)}function l(e,i){const r=3*e;i.x=t[r+0],i.y=t[r+1],i.z=t[r+2]}function c(t,e,i,r){r<0&&1===t.x&&(s[e]=t.x-1),0===i.x&&0===i.z&&(s[e]=r/2/Math.PI+.5)}function h(t){return Math.atan2(t.z,-t.x)}!function(t){const i=new Vector3,r=new Vector3,n=new Vector3;for(let s=0;s<e.length;s+=3)l(e[s+0],i),l(e[s+1],r),l(e[s+2],n),o(i,r,n,t)}(r),function(t){const e=new Vector3;for(let i=0;i<n.length;i+=3)e.x=n[i+0],e.y=n[i+1],e.z=n[i+2],e.normalize().multiplyScalar(t),n[i+0]=e.x,n[i+1]=e.y,n[i+2]=e.z}(i),function(){const t=new Vector3;for(let i=0;i<n.length;i+=3){t.x=n[i+0],t.y=n[i+1],t.z=n[i+2];const r=h(t)/2/Math.PI+.5,o=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(r,1-o)}var e;(function(){const t=new Vector3,e=new Vector3,i=new Vector3,r=new Vector3,o=new Vector2,a=new Vector2,l=new Vector2;for(let u=0,d=0;u<n.length;u+=9,d+=6){t.set(n[u+0],n[u+1],n[u+2]),e.set(n[u+3],n[u+4],n[u+5]),i.set(n[u+6],n[u+7],n[u+8]),o.set(s[d+0],s[d+1]),a.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),r.copy(t).add(e).add(i).divideScalar(3);const p=h(r);c(o,d+0,t,p),c(a,d+2,e,p),c(l,d+4,i,p)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],i=s[t+2],r=s[t+4],n=Math.max(e,i,r),o=Math.min(e,i,r);n>.9&&o<.1&&(e<.2&&(s[t+0]+=1),i<.2&&(s[t+2]+=1),r<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("normal",new Float32BufferAttribute(n.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(s,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new PolyhedronGeometry(t.vertices,t.indices,t.radius,t.details)}}class DodecahedronGeometry extends PolyhedronGeometry{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2,r=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new DodecahedronGeometry(t.radius,t.detail)}}const _v0=new Vector3,_v1$1=new Vector3,_normal=new Vector3,_triangle=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const i=4,r=Math.pow(10,i),n=Math.cos(DEG2RAD*e),s=t.getIndex(),o=t.getAttribute("position"),a=s?s.count:o.count,l=[0,0,0],c=["a","b","c"],h=new Array(3),u={},d=[];for(let t=0;t<a;t+=3){s?(l[0]=s.getX(t),l[1]=s.getX(t+1),l[2]=s.getX(t+2)):(l[0]=t,l[1]=t+1,l[2]=t+2);const{a:e,b:i,c:a}=_triangle;if(e.fromBufferAttribute(o,l[0]),i.fromBufferAttribute(o,l[1]),a.fromBufferAttribute(o,l[2]),_triangle.getNormal(_normal),h[0]=`${Math.round(e.x*r)},${Math.round(e.y*r)},${Math.round(e.z*r)}`,h[1]=`${Math.round(i.x*r)},${Math.round(i.y*r)},${Math.round(i.z*r)}`,h[2]=`${Math.round(a.x*r)},${Math.round(a.y*r)},${Math.round(a.z*r)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let t=0;t<3;t++){const e=(t+1)%3,i=h[t],r=h[e],s=_triangle[c[t]],o=_triangle[c[e]],a=`${i}_${r}`,p=`${r}_${i}`;p in u&&u[p]?(_normal.dot(u[p].normal)<=n&&(d.push(s.x,s.y,s.z),d.push(o.x,o.y,o.z)),u[p]=null):a in u||(u[a]={index0:l[t],index1:l[e],normal:_normal.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:i}=u[t];_v0.fromBufferAttribute(o,e),_v1$1.fromBufferAttribute(o,i),d.push(_v0.x,_v0.y,_v0.z),d.push(_v1$1.x,_v1$1.y,_v1$1.z)}this.setAttribute("position",new Float32BufferAttribute(d,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class Shape extends Path{constructor(t){super(t),this.uuid=generateUUID(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,r=this.holes.length;i<r;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new Path).fromJSON(i))}return this}}const Earcut={triangulate:function(t,e,i=2){const r=e&&e.length,n=r?e[0]*i:t.length;let s=linkedList(t,0,n,i,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,h,u,d,p;if(r&&(s=eliminateHoles(t,e,s,i)),t.length>80*i){a=c=t[0],l=h=t[1];for(let e=i;e<n;e+=i)u=t[e],d=t[e+1],u<a&&(a=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-a,h-l),p=0!==p?32767/p:0}return earcutLinked(s,o,i,a,l,p,0),o}};function linkedList(t,e,i,r,n){let s,o;if(n===signedArea(t,e,i,r)>0)for(s=e;s<i;s+=r)o=insertNode(s,t[s],t[s+1],o);else for(s=i-r;s>=e;s-=r)o=insertNode(s,t[s],t[s+1],o);return o&&equals(o,o.next)&&(removeNode(o),o=o.next),o}function filterPoints(t,e){if(!t)return t;e||(e=t);let i,r=t;do{if(i=!1,r.steiner||!equals(r,r.next)&&0!==three_module_area(r.prev,r,r.next))r=r.next;else{if(removeNode(r),r=e=r.prev,r===r.next)break;i=!0}}while(i||r!==e);return e}function earcutLinked(t,e,i,r,n,s,o){if(!t)return;!o&&s&&indexCurve(t,r,n,s);let a,l,c=t;for(;t.prev!==t.next;)if(a=t.prev,l=t.next,s?isEarHashed(t,r,n,s):isEar(t))e.push(a.i/i|0),e.push(t.i/i|0),e.push(l.i/i|0),removeNode(t),t=l.next,c=l.next;else if((t=l)===c){o?1===o?earcutLinked(t=cureLocalIntersections(filterPoints(t),e,i),e,i,r,n,s,2):2===o&&splitEarcut(t,e,i,r,n,s):earcutLinked(filterPoints(t),e,i,r,n,s,1);break}}function isEar(t){const e=t.prev,i=t,r=t.next;if(three_module_area(e,i,r)>=0)return!1;const n=e.x,s=i.x,o=r.x,a=e.y,l=i.y,c=r.y,h=n<s?n<o?n:o:s<o?s:o,u=a<l?a<c?a:c:l<c?l:c,d=n>s?n>o?n:o:s>o?s:o,p=a>l?a>c?a:c:l>c?l:c;let f=r.next;for(;f!==e;){if(f.x>=h&&f.x<=d&&f.y>=u&&f.y<=p&&pointInTriangle(n,a,s,l,o,c,f.x,f.y)&&three_module_area(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function isEarHashed(t,e,i,r){const n=t.prev,s=t,o=t.next;if(three_module_area(n,s,o)>=0)return!1;const a=n.x,l=s.x,c=o.x,h=n.y,u=s.y,d=o.y,p=a<l?a<c?a:c:l<c?l:c,f=h<u?h<d?h:d:u<d?u:d,m=a>l?a>c?a:c:l>c?l:c,g=h>u?h>d?h:d:u>d?u:d,_=zOrder(p,f,e,i,r),v=zOrder(m,g,e,i,r);let y=t.prevZ,b=t.nextZ;for(;y&&y.z>=_&&b&&b.z<=v;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==n&&y!==o&&pointInTriangle(a,h,l,u,c,d,y.x,y.y)&&three_module_area(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==n&&b!==o&&pointInTriangle(a,h,l,u,c,d,b.x,b.y)&&three_module_area(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;y&&y.z>=_;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==n&&y!==o&&pointInTriangle(a,h,l,u,c,d,y.x,y.y)&&three_module_area(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;b&&b.z<=v;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==n&&b!==o&&pointInTriangle(a,h,l,u,c,d,b.x,b.y)&&three_module_area(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function cureLocalIntersections(t,e,i){let r=t;do{const n=r.prev,s=r.next.next;!equals(n,s)&&intersects(n,r,r.next,s)&&locallyInside(n,s)&&locallyInside(s,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(s.i/i|0),removeNode(r),removeNode(r.next),r=t=s),r=r.next}while(r!==t);return filterPoints(r)}function splitEarcut(t,e,i,r,n,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&isValidDiagonal(o,t)){let a=splitPolygon(o,t);return o=filterPoints(o,o.next),a=filterPoints(a,a.next),earcutLinked(o,e,i,r,n,s,0),void earcutLinked(a,e,i,r,n,s,0)}t=t.next}o=o.next}while(o!==t)}function eliminateHoles(t,e,i,r){const n=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*r,l=s<o-1?e[s+1]*r:t.length,c=linkedList(t,a,l,r,!1),c===c.next&&(c.steiner=!0),n.push(getLeftmost(c));for(n.sort(compareX),s=0;s<n.length;s++)i=eliminateHole(n[s],i);return i}function compareX(t,e){return t.x-e.x}function eliminateHole(t,e){const i=findHoleBridge(t,e);if(!i)return e;const r=splitPolygon(i,t);return filterPoints(r,r.next),filterPoints(i,i.next)}function findHoleBridge(t,e){let i,r=e,n=-1/0;const s=t.x,o=t.y;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){const t=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(t<=s&&t>n&&(n=t,i=r.x<r.next.x?r:r.next,t===s))return i}r=r.next}while(r!==e);if(!i)return null;const a=i,l=i.x,c=i.y;let h,u=1/0;r=i;do{s>=r.x&&r.x>=l&&s!==r.x&&pointInTriangle(o<c?s:n,o,l,c,o<c?n:s,o,r.x,r.y)&&(h=Math.abs(o-r.y)/(s-r.x),locallyInside(r,t)&&(h<u||h===u&&(r.x>i.x||r.x===i.x&&sectorContainsSector(i,r)))&&(i=r,u=h)),r=r.next}while(r!==a);return i}function sectorContainsSector(t,e){return three_module_area(t.prev,t,e.prev)<0&&three_module_area(e.next,t,t.next)<0}function indexCurve(t,e,i,r){let n=t;do{0===n.z&&(n.z=zOrder(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,sortLinked(n)}function sortLinked(t){let e,i,r,n,s,o,a,l,c=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,r=i,a=0,e=0;e<c&&(a++,r=r.nextZ,r);e++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(o>1);return t}function zOrder(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function getLeftmost(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function pointInTriangle(t,e,i,r,n,s,o,a){return(n-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(r-a)>=(i-o)*(e-a)&&(i-o)*(s-a)>=(n-o)*(r-a)}function isValidDiagonal(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!intersectsPolygon(t,e)&&(locallyInside(t,e)&&locallyInside(e,t)&&middleInside(t,e)&&(three_module_area(t.prev,t,e.prev)||three_module_area(t,e.prev,e))||equals(t,e)&&three_module_area(t.prev,t,t.next)>0&&three_module_area(e.prev,e,e.next)>0)}function three_module_area(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function equals(t,e){return t.x===e.x&&t.y===e.y}function intersects(t,e,i,r){const n=sign(three_module_area(t,e,i)),s=sign(three_module_area(t,e,r)),o=sign(three_module_area(i,r,t)),a=sign(three_module_area(i,r,e));return n!==s&&o!==a||!(0!==n||!onSegment(t,i,e))||!(0!==s||!onSegment(t,r,e))||!(0!==o||!onSegment(i,t,r))||!(0!==a||!onSegment(i,e,r))}function onSegment(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function sign(t){return t>0?1:t<0?-1:0}function intersectsPolygon(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function locallyInside(t,e){return three_module_area(t.prev,t,t.next)<0?three_module_area(t,e,t.next)>=0&&three_module_area(t,t.prev,e)>=0:three_module_area(t,e,t.prev)<0||three_module_area(t,t.next,e)<0}function middleInside(t,e){let i=t,r=!1;const n=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}function splitPolygon(t,e){const i=new Node(t.i,t.x,t.y),r=new Node(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function insertNode(t,e,i,r){const n=new Node(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Node(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(t,e,i,r){let n=0;for(let s=e,o=i-r;s<i;s+=r)n+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return n}class ShapeUtils{static area(t){const e=t.length;let i=0;for(let r=e-1,n=0;n<e;r=n++)i+=t[r].x*t[n].y-t[n].x*t[r].y;return.5*i}static isClockWise(t){return ShapeUtils.area(t)<0}static triangulateShape(t,e){const i=[],r=[],n=[];removeDupEndPts(t),addContour(i,t);let s=t.length;e.forEach(removeDupEndPts);for(let t=0;t<e.length;t++)r.push(s),s+=e[t].length,addContour(i,e[t]);const o=Earcut.triangulate(i,r);for(let t=0;t<o.length;t+=3)n.push(o.slice(t,t+3));return n}}function removeDupEndPts(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function addContour(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class ExtrudeGeometry extends BufferGeometry{constructor(t=new Shape([new Vector2(.5,.5),new Vector2(-.5,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,r=[],n=[];for(let e=0,i=t.length;e<i;e++)s(t[e]);function s(t){const s=[],o=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1,l=void 0!==e.depth?e.depth:1;let c=void 0===e.bevelEnabled||e.bevelEnabled,h=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:h-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:WorldUVGenerator;let g,_,v,y,b,A=!1;f&&(g=f.getSpacedPoints(a),A=!0,c=!1,_=f.computeFrenetFrames(a,!1),v=new Vector3,y=new Vector3,b=new Vector3),c||(p=0,h=0,u=0,d=0);const x=t.extractPoints(o);let C=x.shape;const E=x.holes;if(!ShapeUtils.isClockWise(C)){C=C.reverse();for(let t=0,e=E.length;t<e;t++){const e=E[t];ShapeUtils.isClockWise(e)&&(E[t]=e.reverse())}}const M=ShapeUtils.triangulateShape(C,E),S=C;for(let t=0,e=E.length;t<e;t++){const e=E[t];C=C.concat(e)}function w(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().addScaledVector(e,i)}const P=C.length,T=M.length;function O(t,e,i){let r,n,s;const o=t.x-e.x,a=t.y-e.y,l=i.x-t.x,c=i.y-t.y,h=o*o+a*a,u=o*c-a*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),p=e.x-a/u,f=e.y+o/u,m=((i.x-c/d-p)*c-(i.y+l/d-f)*l)/(o*c-a*l);r=p+o*m-t.x,n=f+a*m-t.y;const g=r*r+n*n;if(g<=2)return new Vector2(r,n);s=Math.sqrt(g/2)}else{let t=!1;o>Number.EPSILON?l>Number.EPSILON&&(t=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(c)&&(t=!0),t?(r=-a,n=o,s=Math.sqrt(h)):(r=o,n=a,s=Math.sqrt(h/2))}return new Vector2(r/s,n/s)}const R=[];for(let t=0,e=S.length,i=e-1,r=t+1;t<e;t++,i++,r++)i===e&&(i=0),r===e&&(r=0),R[t]=O(S[t],S[i],S[r]);const N=[];let L,D=R.concat();for(let t=0,e=E.length;t<e;t++){const e=E[t];L=[];for(let t=0,i=e.length,r=i-1,n=t+1;t<i;t++,r++,n++)r===i&&(r=0),n===i&&(n=0),L[t]=O(e[t],e[r],e[n]);N.push(L),D=D.concat(L)}for(let t=0;t<p;t++){const e=t/p,i=h*Math.cos(e*Math.PI/2),r=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=S.length;t<e;t++){const e=w(S[t],R[t],r);B(e.x,e.y,-i)}for(let t=0,e=E.length;t<e;t++){const e=E[t];L=N[t];for(let t=0,n=e.length;t<n;t++){const n=w(e[t],L[t],r);B(n.x,n.y,-i)}}}const k=u+d;for(let t=0;t<P;t++){const e=c?w(C[t],D[t],k):C[t];A?(y.copy(_.normals[0]).multiplyScalar(e.x),v.copy(_.binormals[0]).multiplyScalar(e.y),b.copy(g[0]).add(y).add(v),B(b.x,b.y,b.z)):B(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<P;e++){const i=c?w(C[e],D[e],k):C[e];A?(y.copy(_.normals[t]).multiplyScalar(i.x),v.copy(_.binormals[t]).multiplyScalar(i.y),b.copy(g[t]).add(y).add(v),B(b.x,b.y,b.z)):B(i.x,i.y,l/a*t)}for(let t=p-1;t>=0;t--){const e=t/p,i=h*Math.cos(e*Math.PI/2),r=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=S.length;t<e;t++){const e=w(S[t],R[t],r);B(e.x,e.y,l+i)}for(let t=0,e=E.length;t<e;t++){const e=E[t];L=N[t];for(let t=0,n=e.length;t<n;t++){const n=w(e[t],L[t],r);A?B(n.x,n.y+g[a-1].y,g[a-1].x+i):B(n.x,n.y,l+i)}}}function I(t,e){let i=t.length;for(;--i>=0;){const r=i;let n=i-1;n<0&&(n=t.length-1);for(let t=0,i=a+2*p;t<i;t++){const i=P*t,s=P*(t+1);F(e+r+i,e+n+i,e+n+s,e+r+s)}}}function B(t,e,i){s.push(t),s.push(e),s.push(i)}function U(t,e,n){j(t),j(e),j(n);const s=r.length/3,o=m.generateTopUV(i,r,s-3,s-2,s-1);V(o[0]),V(o[1]),V(o[2])}function F(t,e,n,s){j(t),j(e),j(s),j(e),j(n),j(s);const o=r.length/3,a=m.generateSideWallUV(i,r,o-6,o-3,o-2,o-1);V(a[0]),V(a[1]),V(a[3]),V(a[1]),V(a[2]),V(a[3])}function j(t){r.push(s[3*t+0]),r.push(s[3*t+1]),r.push(s[3*t+2])}function V(t){n.push(t.x),n.push(t.y)}!function(){const t=r.length/3;if(c){let t=0,e=P*t;for(let t=0;t<T;t++){const i=M[t];U(i[2]+e,i[1]+e,i[0]+e)}t=a+2*p,e=P*t;for(let t=0;t<T;t++){const i=M[t];U(i[0]+e,i[1]+e,i[2]+e)}}else{for(let t=0;t<T;t++){const e=M[t];U(e[2],e[1],e[0])}for(let t=0;t<T;t++){const e=M[t];U(e[0]+P*a,e[1]+P*a,e[2]+P*a)}}i.addGroup(t,r.length/3-t,0)}(),function(){const t=r.length/3;let e=0;I(S,e),e+=S.length;for(let t=0,i=E.length;t<i;t++){const i=E[t];I(i,e),e+=i.length}i.addGroup(t,r.length/3-t,1)}()}this.setAttribute("position",new Float32BufferAttribute(r,3)),this.setAttribute("uv",new Float32BufferAttribute(n,2)),this.computeVertexNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return toJSON$1(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const i=[];for(let r=0,n=t.shapes.length;r<n;r++){const n=e[t.shapes[r]];i.push(n)}const r=t.options.extrudePath;return void 0!==r&&(t.options.extrudePath=(new Curves[r.type]).fromJSON(r)),new ExtrudeGeometry(i,t.options)}}const WorldUVGenerator={generateTopUV:function(t,e,i,r,n){const s=e[3*i],o=e[3*i+1],a=e[3*r],l=e[3*r+1],c=e[3*n],h=e[3*n+1];return[new Vector2(s,o),new Vector2(a,l),new Vector2(c,h)]},generateSideWallUV:function(t,e,i,r,n,s){const o=e[3*i],a=e[3*i+1],l=e[3*i+2],c=e[3*r],h=e[3*r+1],u=e[3*r+2],d=e[3*n],p=e[3*n+1],f=e[3*n+2],m=e[3*s],g=e[3*s+1],_=e[3*s+2];return Math.abs(a-h)<Math.abs(o-c)?[new Vector2(o,1-l),new Vector2(c,1-u),new Vector2(d,1-f),new Vector2(m,1-_)]:[new Vector2(a,1-l),new Vector2(h,1-u),new Vector2(p,1-f),new Vector2(g,1-_)]}};function toJSON$1(t,e,i){if(i.shapes=[],Array.isArray(t))for(let e=0,r=t.length;e<r;e++){const r=t[e];i.shapes.push(r.uuid)}else i.shapes.push(t.uuid);return i.options=Object.assign({},e),void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON()),i}class IcosahedronGeometry extends PolyhedronGeometry{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new IcosahedronGeometry(t.radius,t.detail)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new OctahedronGeometry(t.radius,t.detail)}}class RingGeometry extends BufferGeometry{constructor(t=.5,e=1,i=32,r=1,n=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:s},i=Math.max(3,i);const o=[],a=[],l=[],c=[];let h=t;const u=(e-t)/(r=Math.max(1,r)),d=new Vector3,p=new Vector2;for(let t=0;t<=r;t++){for(let t=0;t<=i;t++){const r=n+t/i*s;d.x=h*Math.cos(r),d.y=h*Math.sin(r),a.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,c.push(p.x,p.y)}h+=u}for(let t=0;t<r;t++){const e=t*(i+1);for(let t=0;t<i;t++){const r=t+e,n=r,s=r+i+1,a=r+i+2,l=r+1;o.push(n,s,l),o.push(s,a,l)}}this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new RingGeometry(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class ShapeGeometry extends BufferGeometry{constructor(t=new Shape([new Vector2(0,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const i=[],r=[],n=[],s=[];let o=0,a=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(o,a,e),o+=a,a=0;function l(t){const o=r.length/3,l=t.extractPoints(e);let c=l.shape;const h=l.holes;!1===ShapeUtils.isClockWise(c)&&(c=c.reverse());for(let t=0,e=h.length;t<e;t++){const e=h[t];!0===ShapeUtils.isClockWise(e)&&(h[t]=e.reverse())}const u=ShapeUtils.triangulateShape(c,h);for(let t=0,e=h.length;t<e;t++){const e=h[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];r.push(e.x,e.y,0),n.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],r=e[0]+o,n=e[1]+o,s=e[2]+o;i.push(r,n,s),a+=3}}this.setIndex(i),this.setAttribute("position",new Float32BufferAttribute(r,3)),this.setAttribute("normal",new Float32BufferAttribute(n,3)),this.setAttribute("uv",new Float32BufferAttribute(s,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return toJSON(this.parameters.shapes,t)}static fromJSON(t,e){const i=[];for(let r=0,n=t.shapes.length;r<n;r++){const n=e[t.shapes[r]];i.push(n)}return new ShapeGeometry(i,t.curveSegments)}}function toJSON(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,r=t.length;i<r;i++){const r=t[i];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}class SphereGeometry extends BufferGeometry{constructor(t=1,e=32,i=16,r=0,n=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:r,phiLength:n,thetaStart:s,thetaLength:o},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));const a=Math.min(s+o,Math.PI);let l=0;const c=[],h=new Vector3,u=new Vector3,d=[],p=[],f=[],m=[];for(let d=0;d<=i;d++){const g=[],_=d/i;let v=0;0===d&&0===s?v=.5/e:d===i&&a===Math.PI&&(v=-.5/e);for(let i=0;i<=e;i++){const a=i/e;h.x=-t*Math.cos(r+a*n)*Math.sin(s+_*o),h.y=t*Math.cos(s+_*o),h.z=t*Math.sin(r+a*n)*Math.sin(s+_*o),p.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),m.push(a+v,1-_),g.push(l++)}c.push(g)}for(let t=0;t<i;t++)for(let r=0;r<e;r++){const e=c[t][r+1],n=c[t][r],o=c[t+1][r],l=c[t+1][r+1];(0!==t||s>0)&&d.push(e,n,l),(t!==i-1||a<Math.PI)&&d.push(n,o,l)}this.setIndex(d),this.setAttribute("position",new Float32BufferAttribute(p,3)),this.setAttribute("normal",new Float32BufferAttribute(f,3)),this.setAttribute("uv",new Float32BufferAttribute(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new SphereGeometry(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new TetrahedronGeometry(t.radius,t.detail)}}class TorusGeometry extends BufferGeometry{constructor(t=1,e=.4,i=12,r=48,n=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:r,arc:n},i=Math.floor(i),r=Math.floor(r);const s=[],o=[],a=[],l=[],c=new Vector3,h=new Vector3,u=new Vector3;for(let s=0;s<=i;s++)for(let d=0;d<=r;d++){const p=d/r*n,f=s/i*Math.PI*2;h.x=(t+e*Math.cos(f))*Math.cos(p),h.y=(t+e*Math.cos(f))*Math.sin(p),h.z=e*Math.sin(f),o.push(h.x,h.y,h.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),u.subVectors(h,c).normalize(),a.push(u.x,u.y,u.z),l.push(d/r),l.push(s/i)}for(let t=1;t<=i;t++)for(let e=1;e<=r;e++){const i=(r+1)*t+e-1,n=(r+1)*(t-1)+e-1,o=(r+1)*(t-1)+e,a=(r+1)*t+e;s.push(i,n,a),s.push(n,o,a)}this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(a,3)),this.setAttribute("uv",new Float32BufferAttribute(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new TorusGeometry(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class TorusKnotGeometry extends BufferGeometry{constructor(t=1,e=.4,i=64,r=8,n=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:r,p:n,q:s},i=Math.floor(i),r=Math.floor(r);const o=[],a=[],l=[],c=[],h=new Vector3,u=new Vector3,d=new Vector3,p=new Vector3,f=new Vector3,m=new Vector3,g=new Vector3;for(let o=0;o<=i;++o){const v=o/i*n*Math.PI*2;_(v,n,s,t,d),_(v+.01,n,s,t,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let t=0;t<=r;++t){const n=t/r*Math.PI*2,s=-e*Math.cos(n),p=e*Math.sin(n);h.x=d.x+(s*g.x+p*f.x),h.y=d.y+(s*g.y+p*f.y),h.z=d.z+(s*g.z+p*f.z),a.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(o/i),c.push(t/r)}}for(let t=1;t<=i;t++)for(let e=1;e<=r;e++){const i=(r+1)*(t-1)+(e-1),n=(r+1)*t+(e-1),s=(r+1)*t+e,a=(r+1)*(t-1)+e;o.push(i,n,a),o.push(n,s,a)}function _(t,e,i,r,n){const s=Math.cos(t),o=Math.sin(t),a=i/e*t,l=Math.cos(a);n.x=r*(2+l)*.5*s,n.y=r*(2+l)*o*.5,n.z=r*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new TorusKnotGeometry(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class TubeGeometry extends BufferGeometry{constructor(t=new QuadraticBezierCurve3(new Vector3(-1,-1,0),new Vector3(-1,1,0),new Vector3(1,1,0)),e=64,i=1,r=8,n=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:r,closed:n};const s=t.computeFrenetFrames(e,n);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new Vector3,a=new Vector3,l=new Vector2;let c=new Vector3;const h=[],u=[],d=[],p=[];function f(n){c=t.getPointAt(n/e,c);const l=s.normals[n],d=s.binormals[n];for(let t=0;t<=r;t++){const e=t/r*Math.PI*2,n=Math.sin(e),s=-Math.cos(e);a.x=s*l.x+n*d.x,a.y=s*l.y+n*d.y,a.z=s*l.z+n*d.z,a.normalize(),u.push(a.x,a.y,a.z),o.x=c.x+i*a.x,o.y=c.y+i*a.y,o.z=c.z+i*a.z,h.push(o.x,o.y,o.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===n?e:0),function(){for(let t=0;t<=e;t++)for(let i=0;i<=r;i++)l.x=t/e,l.y=i/r,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=r;e++){const i=(r+1)*(t-1)+(e-1),n=(r+1)*t+(e-1),s=(r+1)*t+e,o=(r+1)*(t-1)+e;p.push(i,n,o),p.push(n,s,o)}}()}(),this.setIndex(p),this.setAttribute("position",new Float32BufferAttribute(h,3)),this.setAttribute("normal",new Float32BufferAttribute(u,3)),this.setAttribute("uv",new Float32BufferAttribute(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new TubeGeometry((new Curves[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class WireframeGeometry extends BufferGeometry{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],i=new Set,r=new Vector3,n=new Vector3;if(null!==t.index){const s=t.attributes.position,o=t.index;let a=t.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let t=0,l=a.length;t<l;++t){const l=a[t],c=l.start;for(let t=c,a=c+l.count;t<a;t+=3)for(let a=0;a<3;a++){const l=o.getX(t+a),c=o.getX(t+(a+1)%3);r.fromBufferAttribute(s,l),n.fromBufferAttribute(s,c),!0===isUniqueEdge(r,n,i)&&(e.push(r.x,r.y,r.z),e.push(n.x,n.y,n.z))}}}else{const s=t.attributes.position;for(let t=0,o=s.count/3;t<o;t++)for(let o=0;o<3;o++){const a=3*t+o,l=3*t+(o+1)%3;r.fromBufferAttribute(s,a),n.fromBufferAttribute(s,l),!0===isUniqueEdge(r,n,i)&&(e.push(r.x,r.y,r.z),e.push(n.x,n.y,n.z))}}this.setAttribute("position",new Float32BufferAttribute(e,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function isUniqueEdge(t,e,i){const r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,n=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==i.has(r)&&!0!==i.has(n)&&(i.add(r),i.add(n),!0)}var Geometries=Object.freeze({__proto__:null,BoxGeometry,CapsuleGeometry,CircleGeometry,ConeGeometry,CylinderGeometry,DodecahedronGeometry,EdgesGeometry,ExtrudeGeometry,IcosahedronGeometry,LatheGeometry,OctahedronGeometry,PlaneGeometry,PolyhedronGeometry,RingGeometry,ShapeGeometry,SphereGeometry,TetrahedronGeometry,TorusGeometry,TorusKnotGeometry,TubeGeometry,WireframeGeometry});class ShadowMaterial extends Material{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class RawShaderMaterial extends ShaderMaterial{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class MeshStandardMaterial extends Material{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return clamp(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Color(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Color(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Color(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class MeshPhongMaterial extends Material{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class MeshToonMaterial extends Material{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class MeshNormalMaterial extends Material{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class MeshLambertMaterial extends Material{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class MeshMatcapMaterial extends Material{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class LineDashedMaterial extends LineBasicMaterial{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function arraySlice(t,e,i){return isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)}function convertArray(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}function isTypedArray(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function getKeyframeOrder(t){const e=t.length,i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort((function(e,i){return t[e]-t[i]})),i}function sortedArray(t,e,i){const r=t.length,n=new t.constructor(r);for(let s=0,o=0;o!==r;++s){const r=i[s]*e;for(let i=0;i!==e;++i)n[o++]=t[r+i]}return n}function flattenJSON(t,e,i,r){let n=1,s=t[0];for(;void 0!==s&&void 0===s[r];)s=t[n++];if(void 0===s)return;let o=s[r];if(void 0!==o)if(Array.isArray(o))do{o=s[r],void 0!==o&&(e.push(s.time),i.push.apply(i,o)),s=t[n++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[r],void 0!==o&&(e.push(s.time),o.toArray(i,i.length)),s=t[n++]}while(void 0!==s);else do{o=s[r],void 0!==o&&(e.push(s.time),i.push(o)),s=t[n++]}while(void 0!==s)}function subclip(t,e,i,r,n=30){const s=t.clone();s.name=e;const o=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],a=e.getValueSize(),l=[],c=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*n;if(!(s<i||s>=r)){l.push(e.times[t]);for(let i=0;i<a;++i)c.push(e.values[t*a+i])}}0!==l.length&&(e.times=convertArray(l,e.times.constructor),e.values=convertArray(c,e.values.constructor),o.push(e))}s.tracks=o;let a=1/0;for(let t=0;t<s.tracks.length;++t)a>s.tracks[t].times[0]&&(a=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*a);return s.resetDuration(),s}function makeClipAdditive(t,e=0,i=t,r=30){r<=0&&(r=30);const n=i.tracks.length,s=e/r;for(let e=0;e<n;++e){const r=i.tracks[e],n=r.ValueTypeName;if("bool"===n||"string"===n)continue;const o=t.tracks.find((function(t){return t.name===r.name&&t.ValueTypeName===n}));if(void 0===o)continue;let a=0;const l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const u=r.times.length-1;let d;if(s<=r.times[0]){const t=a,e=l-a;d=arraySlice(r.values,t,e)}else if(s>=r.times[u]){const t=u*l+a,e=t+l-a;d=arraySlice(r.values,t,e)}else{const t=r.createInterpolant(),e=a,i=l-a;t.evaluate(s),d=arraySlice(t.resultBuffer,e,i)}"quaternion"===n&&(new Quaternion).fromArray(d).normalize().conjugate().toArray(d);const p=o.times.length;for(let t=0;t<p;++t){const e=t*h+c;if("quaternion"===n)Quaternion.multiplyQuaternionsFlat(o.values,e,d,0,o.values,e);else{const t=h-2*c;for(let i=0;i<t;++i)o.values[e+i]-=d[i]}}}return t.blendMode=AdditiveAnimationBlendMode,t}const AnimationUtils={arraySlice,convertArray,isTypedArray,getKeyframeOrder,sortedArray,flattenJSON,subclip,makeClipAdditive};class Interpolant{constructor(t,e,i,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,r=e[i],n=e[i-1];t:{e:{let s;i:{r:if(!(t<r)){for(let s=i+2;;){if(void 0===r){if(t<n)break r;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===s)break;if(n=r,r=e[++i],t<r)break e}s=e.length;break i}if(t>=n)break t;{const o=e[1];t<o&&(i=2,n=o);for(let s=i-2;;){if(void 0===n)return this._cachedIndex=0,this.copySampleValue_(0);if(i===s)break;if(r=n,n=e[--i-1],t>=n)break e}s=i,i=0}}for(;i<s;){const r=i+s>>>1;t<e[r]?s=r:i=r+1}if(r=e[i],n=e[i-1],void 0===n)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=t*r;for(let t=0;t!==r;++t)e[t]=i[n+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class CubicInterpolant extends Interpolant{constructor(t,e,i,r){super(t,e,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding}}intervalChanged_(t,e,i){const r=this.parameterPositions;let n=t-2,s=t+1,o=r[n],a=r[s];if(void 0===o)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:n=t,o=2*e-i;break;case WrapAroundEnding:n=r.length-2,o=e+r[n]-r[n+1];break;default:n=t,o=i}if(void 0===a)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:s=t,a=2*i-e;break;case WrapAroundEnding:s=1,a=i+r[1]-r[0];break;default:s=t-1,a=e}const l=.5*(i-e),c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-i),this._offsetPrev=n*c,this._offsetNext=s*c}interpolate_(t,e,i,r){const n=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-e)/(r-e),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,_=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,v=(-1-d)*m+(1.5+d)*f+.5*p,y=d*m-d*f;for(let t=0;t!==o;++t)n[t]=g*s[c+t]+_*s[l+t]+v*s[a+t]+y*s[h+t];return n}}class LinearInterpolant extends Interpolant{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t,e,i,r){const n=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=(i-e)/(r-e),h=1-c;for(let t=0;t!==o;++t)n[t]=s[l+t]*h+s[a+t]*c;return n}}class DiscreteInterpolant extends Interpolant{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t){return this.copySampleValue_(t-1)}}class KeyframeTrack{constructor(t,e,i,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=convertArray(e,this.TimeBufferType),this.values=convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:convertArray(t.times,Array),values:convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new LinearInterpolant(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new CubicInterpolant(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case InterpolateDiscrete:e=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:e=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,r=e.length;i!==r;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,r=e.length;i!==r;++i)e[i]*=t}return this}trim(t,e){const i=this.times,r=i.length;let n=0,s=r-1;for(;n!==r&&i[n]<t;)++n;for(;-1!==s&&i[s]>e;)--s;if(++s,0!==n||s!==r){n>=s&&(s=Math.max(s,1),n=s-1);const t=this.getValueSize();this.times=arraySlice(i,n,s),this.values=arraySlice(this.values,n*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,r=this.values,n=i.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==n;e++){const r=i[e];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,r),t=!1;break}if(null!==s&&s>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,r,s),t=!1;break}s=r}if(void 0!==r&&isTypedArray(r))for(let e=0,i=r.length;e!==i;++e){const i=r[e];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,i),t=!1;break}}return t}optimize(){const t=arraySlice(this.times),e=arraySlice(this.values),i=this.getValueSize(),r=this.getInterpolation()===InterpolateSmooth,n=t.length-1;let s=1;for(let o=1;o<n;++o){let n=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(r)n=!0;else{const t=o*i,r=t-i,s=t+i;for(let o=0;o!==i;++o){const i=e[t+o];if(i!==e[r+o]||i!==e[s+o]){n=!0;break}}}if(n){if(o!==s){t[s]=t[o];const r=o*i,n=s*i;for(let t=0;t!==i;++t)e[n+t]=e[r+t]}++s}}if(n>0){t[s]=t[n];for(let t=n*i,r=s*i,o=0;o!==i;++o)e[r+o]=e[t+o];++s}return s!==t.length?(this.times=arraySlice(t,0,s),this.values=arraySlice(e,0,s*i)):(this.times=t,this.values=e),this}clone(){const t=arraySlice(this.times,0),e=arraySlice(this.values,0),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}KeyframeTrack.prototype.TimeBufferType=Float32Array,KeyframeTrack.prototype.ValueBufferType=Float32Array,KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{}BooleanKeyframeTrack.prototype.ValueTypeName="bool",BooleanKeyframeTrack.prototype.ValueBufferType=Array,BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete,BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0,BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t,e,i,r){const n=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(i-e)/(r-e);let l=t*o;for(let t=l+o;l!==t;l+=4)Quaternion.slerpFlat(n,0,s,l-o,s,l,a);return n}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(t){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),t)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion",QuaternionKeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear,QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{}StringKeyframeTrack.prototype.ValueTypeName="string",StringKeyframeTrack.prototype.ValueBufferType=Array,StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete,StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0,StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(t,e=-1,i,r=NormalAnimationBlendMode){this.name=t,this.tracks=i,this.duration=e,this.blendMode=r,this.uuid=generateUUID(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,r=1/(t.fps||1);for(let t=0,n=i.length;t!==n;++t)e.push(parseKeyframeTrack(i[t]).scale(r));const n=new this(t.name,t.duration,e,t.blendMode);return n.uuid=t.uuid,n}static toJSON(t){const e=[],i=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,r=i.length;t!==r;++t)e.push(KeyframeTrack.toJSON(i[t]));return r}static CreateFromMorphTargetSequence(t,e,i,r){const n=e.length,s=[];for(let t=0;t<n;t++){let o=[],a=[];o.push((t+n-1)%n,t,(t+1)%n),a.push(0,1,0);const l=getKeyframeOrder(o);o=sortedArray(o,1,l),a=sortedArray(a,1,l),r||0!==o[0]||(o.push(n),a.push(a[0])),s.push(new NumberKeyframeTrack(".morphTargetInfluences["+e[t].name+"]",o,a).scale(1/i))}return new this(t,-1,s)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const r={},n=/^([\w-]*?)([\d]+)$/;for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.name.match(n);if(s&&s.length>1){const t=s[1];let e=r[t];e||(r[t]=e=[]),e.push(i)}}const s=[];for(const t in r)s.push(this.CreateFromMorphTargetSequence(t,r[t],e,i));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(t,e,i,r,n){if(0!==i.length){const s=[],o=[];flattenJSON(i,s,o,r),0!==s.length&&n.push(new t(e,s,o))}},r=[],n=t.name||"default",s=t.fps||30,o=t.blendMode;let a=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const n=l[t].keys;if(n&&0!==n.length)if(n[0].morphTargets){const t={};let e;for(e=0;e<n.length;e++)if(n[e].morphTargets)for(let i=0;i<n[e].morphTargets.length;i++)t[n[e].morphTargets[i]]=-1;for(const i in t){const t=[],s=[];for(let r=0;r!==n[e].morphTargets.length;++r){const r=n[e];t.push(r.time),s.push(r.morphTarget===i?1:0)}r.push(new NumberKeyframeTrack(".morphTargetInfluence["+i+"]",t,s))}a=t.length*s}else{const s=".bones["+e[t].name+"]";i(VectorKeyframeTrack,s+".position",n,"pos",r),i(QuaternionKeyframeTrack,s+".quaternion",n,"rot",r),i(VectorKeyframeTrack,s+".scale",n,"scl",r)}}return 0===r.length?null:new this(n,a,r,o)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function parseKeyframeTrack(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=getTrackTypeForValueTypeName(t.type);if(void 0===t.times){const e=[],i=[];flattenJSON(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Cache={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class LoadingManager{constructor(t,e,i){const r=this;let n,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){a++,!1===s&&void 0!==r.onStart&&r.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,a),o===a&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return n?n(t):t},this.setURLModifier=function(t){return n=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=l.length;e<i;e+=2){const i=l[e],r=l[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return r}return null}}}const DefaultLoadingManager=new LoadingManager;class Loader{constructor(t){this.manager=void 0!==t?t:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise((function(r,n){i.load(t,r,e,n)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}Loader.DEFAULT_MATERIAL_NAME="__DEFAULT";const loading={};class HttpError extends Error{constructor(t,e){super(t),this.response=e}}class FileLoader extends Loader{constructor(t){super(t)}load(t,e,i,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const n=Cache.get(t);if(void 0!==n)return this.manager.itemStart(t),setTimeout((()=>{e&&e(n),this.manager.itemEnd(t)}),0),n;if(void 0!==loading[t])return void loading[t].push({onLoad:e,onProgress:i,onError:r});loading[t]=[],loading[t].push({onLoad:e,onProgress:i,onError:r});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const i=loading[t],r=e.body.getReader(),n=e.headers.get("Content-Length")||e.headers.get("X-File-Size"),s=n?parseInt(n):0,o=0!==s;let a=0;const l=new ReadableStream({start(t){!function e(){r.read().then((({done:r,value:n})=>{if(r)t.close();else{a+=n.byteLength;const r=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onProgress&&e.onProgress(r)}t.enqueue(n),e()}}))}()}});return new Response(l)}throw new HttpError(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((t=>{switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,o)));case"json":return t.json();default:if(void 0===o)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(o),i=e&&e[1]?e[1].toLowerCase():void 0,r=new TextDecoder(i);return t.arrayBuffer().then((t=>r.decode(t)))}}})).then((e=>{Cache.add(t,e);const i=loading[t];delete loading[t];for(let t=0,r=i.length;t<r;t++){const r=i[t];r.onLoad&&r.onLoad(e)}})).catch((e=>{const i=loading[t];if(void 0===i)throw this.manager.itemError(t),e;delete loading[t];for(let t=0,r=i.length;t<r;t++){const r=i[t];r.onError&&r.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class AnimationLoader extends Loader{constructor(t){super(t)}load(t,e,i,r){const n=this,s=new FileLoader(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(i){try{e(n.parse(JSON.parse(i)))}catch(e){r?r(e):console.error(e),n.manager.itemError(t)}}),i,r)}parse(t){const e=[];for(let i=0;i<t.length;i++){const r=AnimationClip.parse(t[i]);e.push(r)}return e}}class CompressedTextureLoader extends Loader{constructor(t){super(t)}load(t,e,i,r){const n=this,s=[],o=new CompressedTexture,a=new FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(n.withCredentials);let l=0;function c(c){a.load(t[c],(function(t){const i=n.parse(t,!0);s[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},l+=1,6===l&&(1===i.mipmapCount&&(o.minFilter=LinearFilter),o.image=s,o.format=i.format,o.needsUpdate=!0,e&&e(o))}),i,r)}if(Array.isArray(t))for(let e=0,i=t.length;e<i;++e)c(e);else a.load(t,(function(t){const i=n.parse(t,!0);if(i.isCubemap){const t=i.mipmaps.length/i.mipmapCount;for(let e=0;e<t;e++){s[e]={mipmaps:[]};for(let t=0;t<i.mipmapCount;t++)s[e].mipmaps.push(i.mipmaps[e*i.mipmapCount+t]),s[e].format=i.format,s[e].width=i.width,s[e].height=i.height}o.image=s}else o.image.width=i.width,o.image.height=i.height,o.mipmaps=i.mipmaps;1===i.mipmapCount&&(o.minFilter=LinearFilter),o.format=i.format,o.needsUpdate=!0,e&&e(o)}),i,r);return o}}class ImageLoader extends Loader{constructor(t){super(t)}load(t,e,i,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const n=this,s=Cache.get(t);if(void 0!==s)return n.manager.itemStart(t),setTimeout((function(){e&&e(s),n.manager.itemEnd(t)}),0),s;const o=createElementNS("img");function a(){c(),Cache.add(t,this),e&&e(this),n.manager.itemEnd(t)}function l(e){c(),r&&r(e),n.manager.itemError(t),n.manager.itemEnd(t)}function c(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),n.manager.itemStart(t),o.src=t,o}}class CubeTextureLoader extends Loader{constructor(t){super(t)}load(t,e,i,r){const n=new CubeTexture;n.colorSpace=SRGBColorSpace;const s=new ImageLoader(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(i){s.load(t[i],(function(t){n.images[i]=t,o++,6===o&&(n.needsUpdate=!0,e&&e(n))}),void 0,r)}for(let e=0;e<t.length;++e)a(e);return n}}class DataTextureLoader extends Loader{constructor(t){super(t)}load(t,e,i,r){const n=this,s=new DataTexture,o=new FileLoader(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(n.withCredentials),o.load(t,(function(t){let i;try{i=n.parse(t)}catch(t){if(void 0===r)return void console.error(t);r(t)}void 0!==i.image?s.image=i.image:void 0!==i.data&&(s.image.width=i.width,s.image.height=i.height,s.image.data=i.data),s.wrapS=void 0!==i.wrapS?i.wrapS:ClampToEdgeWrapping,s.wrapT=void 0!==i.wrapT?i.wrapT:ClampToEdgeWrapping,s.magFilter=void 0!==i.magFilter?i.magFilter:LinearFilter,s.minFilter=void 0!==i.minFilter?i.minFilter:LinearFilter,s.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.colorSpace?s.colorSpace=i.colorSpace:void 0!==i.encoding&&(s.encoding=i.encoding),void 0!==i.flipY&&(s.flipY=i.flipY),void 0!==i.format&&(s.format=i.format),void 0!==i.type&&(s.type=i.type),void 0!==i.mipmaps&&(s.mipmaps=i.mipmaps,s.minFilter=LinearMipmapLinearFilter),1===i.mipmapCount&&(s.minFilter=LinearFilter),void 0!==i.generateMipmaps&&(s.generateMipmaps=i.generateMipmaps),s.needsUpdate=!0,e&&e(s,i)}),i,r),s}}class TextureLoader extends Loader{constructor(t){super(t)}load(t,e,i,r){const n=new Texture,s=new ImageLoader(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){n.image=t,n.needsUpdate=!0,void 0!==e&&e(n)}),i,r),n}}class Light extends Object3D{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Color(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}class HemisphereLight extends Light{constructor(t,e,i){super(t,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Color(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3,_lookTarget$1=new Vector3;class LightShadow{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(t.matrixWorld),e.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(_lookTarget$1),e.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(_projScreenMatrix$1)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,i=2*RAD2DEG*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,n=t.distance||e.far;i===e.fov&&r===e.aspect&&n===e.far||(e.fov=i,e.aspect=r,e.far=n,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class SpotLight extends Light{constructor(t,e,i=0,r=Math.PI/3,n=0,s=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.distance=i,this.angle=r,this.penumbra=n,this.decay=s,this.map=null,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const _projScreenMatrix=new Matrix4,_lightPositionWorld=new Vector3,_lookTarget=new Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,r=this.matrix,n=t.distance||i.far;n!==i.far&&(i.far=n,i.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(t.matrixWorld),i.position.copy(_lightPositionWorld),_lookTarget.copy(i.position),_lookTarget.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(_lookTarget),i.updateMatrixWorld(),r.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix)}}class PointLight extends Light{constructor(t,e,i=0,r=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new PointLightShadow}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class DirectionalLight extends Light{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class AmbientLight extends Light{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class RectAreaLight extends Light{constructor(t,e,i=10,r=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class SphericalHarmonics3{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Vector3)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,r=t.y,n=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*r),e.addScaledVector(s[2],.488603*n),e.addScaledVector(s[3],.488603*i),e.addScaledVector(s[4],i*r*1.092548),e.addScaledVector(s[5],r*n*1.092548),e.addScaledVector(s[6],.315392*(3*n*n-1)),e.addScaledVector(s[7],i*n*1.092548),e.addScaledVector(s[8],.546274*(i*i-r*r)),e}getIrradianceAt(t,e){const i=t.x,r=t.y,n=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*r),e.addScaledVector(s[2],1.023328*n),e.addScaledVector(s[3],1.023328*i),e.addScaledVector(s[4],.858086*i*r),e.addScaledVector(s[5],.858086*r*n),e.addScaledVector(s[6],.743125*n*n-.247708),e.addScaledVector(s[7],.858086*i*n),e.addScaledVector(s[8],.429043*(i*i-r*r)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(t,e+3*r);return this}toArray(t=[],e=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(t,e+3*r);return t}static getBasisAt(t,e){const i=t.x,r=t.y,n=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*n,e[3]=.488603*i,e[4]=1.092548*i*r,e[5]=1.092548*r*n,e[6]=.315392*(3*n*n-1),e[7]=1.092548*i*n,e[8]=.546274*(i*i-r*r)}}class LightProbe extends Light{constructor(t=new SphericalHarmonics3,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class MaterialLoader extends Loader{constructor(t){super(t),this.textures={}}load(t,e,i,r){const n=this,s=new FileLoader(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(t,(function(i){try{e(n.parse(JSON.parse(i)))}catch(e){r?r(e):console.error(e),n.manager.itemError(t)}}),i,r)}parse(t){const e=this.textures;function i(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const r=MaterialLoader.createMaterialFromType(t.type);if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&void 0!==r.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.sheen&&(r.sheen=t.sheen),void 0!==t.sheenColor&&(r.sheenColor=(new Color).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(r.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==r.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==r.specular&&r.specular.setHex(t.specular),void 0!==t.specularIntensity&&(r.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearcoat&&(r.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(r.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.iridescence&&(r.iridescence=t.iridescence),void 0!==t.iridescenceIOR&&(r.iridescenceIOR=t.iridescenceIOR),void 0!==t.iridescenceThicknessRange&&(r.iridescenceThicknessRange=t.iridescenceThicknessRange),void 0!==t.transmission&&(r.transmission=t.transmission),void 0!==t.thickness&&(r.thickness=t.thickness),void 0!==t.attenuationDistance&&(r.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(t.attenuationColor),void 0!==t.anisotropy&&(r.anisotropy=t.anisotropy),void 0!==t.anisotropyRotation&&(r.anisotropyRotation=t.anisotropyRotation),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.combine&&(r.combine=t.combine),void 0!==t.side&&(r.side=t.side),void 0!==t.shadowSide&&(r.shadowSide=t.shadowSide),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.alphaHash&&(r.alphaHash=t.alphaHash),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(r.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(r.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(r.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(r.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(r.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(r.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(r.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(r.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),1!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.alphaToCoverage&&(r.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(r.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.forceSinglePass&&(r.forceSinglePass=t.forceSinglePass),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?r.vertexColors=t.vertexColors>0:r.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const n=t.uniforms[e];switch(r.uniforms[e]={},n.type){case"t":r.uniforms[e].value=i(n.value);break;case"c":r.uniforms[e].value=(new Color).setHex(n.value);break;case"v2":r.uniforms[e].value=(new Vector2).fromArray(n.value);break;case"v3":r.uniforms[e].value=(new Vector3).fromArray(n.value);break;case"v4":r.uniforms[e].value=(new Vector4).fromArray(n.value);break;case"m3":r.uniforms[e].value=(new Matrix3).fromArray(n.value);break;case"m4":r.uniforms[e].value=(new Matrix4).fromArray(n.value);break;default:r.uniforms[e].value=n.value}}if(void 0!==t.defines&&(r.defines=t.defines),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.glslVersion&&(r.glslVersion=t.glslVersion),void 0!==t.extensions)for(const e in t.extensions)r.extensions[e]=t.extensions[e];if(void 0!==t.lights&&(r.lights=t.lights),void 0!==t.clipping&&(r.clipping=t.clipping),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=i(t.map)),void 0!==t.matcap&&(r.matcap=i(t.matcap)),void 0!==t.alphaMap&&(r.alphaMap=i(t.alphaMap)),void 0!==t.bumpMap&&(r.bumpMap=i(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=i(t.normalMap)),void 0!==t.normalMapType&&(r.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),r.normalScale=(new Vector2).fromArray(e)}return void 0!==t.displacementMap&&(r.displacementMap=i(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=i(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=i(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=i(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=i(t.specularMap)),void 0!==t.specularIntensityMap&&(r.specularIntensityMap=i(t.specularIntensityMap)),void 0!==t.specularColorMap&&(r.specularColorMap=i(t.specularColorMap)),void 0!==t.envMap&&(r.envMap=i(t.envMap)),void 0!==t.envMapIntensity&&(r.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(r.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(r.lightMap=i(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=i(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=i(t.gradientMap)),void 0!==t.clearcoatMap&&(r.clearcoatMap=i(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=i(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(r.clearcoatNormalMap=i(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Vector2).fromArray(t.clearcoatNormalScale)),void 0!==t.iridescenceMap&&(r.iridescenceMap=i(t.iridescenceMap)),void 0!==t.iridescenceThicknessMap&&(r.iridescenceThicknessMap=i(t.iridescenceThicknessMap)),void 0!==t.transmissionMap&&(r.transmissionMap=i(t.transmissionMap)),void 0!==t.thicknessMap&&(r.thicknessMap=i(t.thicknessMap)),void 0!==t.anisotropyMap&&(r.anisotropyMap=i(t.anisotropyMap)),void 0!==t.sheenColorMap&&(r.sheenColorMap=i(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(r.sheenRoughnessMap=i(t.sheenRoughnessMap)),r}setTextures(t){return this.textures=t,this}static createMaterialFromType(t){return new{ShadowMaterial,SpriteMaterial,RawShaderMaterial,ShaderMaterial,PointsMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshPhongMaterial,MeshToonMaterial,MeshNormalMaterial,MeshLambertMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshBasicMaterial,MeshMatcapMaterial,LineDashedMaterial,LineBasicMaterial,Material}[t]}}class LoaderUtils{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,r=t.length;i<r;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class InstancedBufferGeometry extends BufferGeometry{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class BufferGeometryLoader extends Loader{constructor(t){super(t)}load(t,e,i,r){const n=this,s=new FileLoader(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(t,(function(i){try{e(n.parse(JSON.parse(i)))}catch(e){r?r(e):console.error(e),n.manager.itemError(t)}}),i,r)}parse(t){const e={},i={};function r(t,r){if(void 0!==e[r])return e[r];const n=t.interleavedBuffers[r],s=function(t,e){if(void 0!==i[e])return i[e];const r=t.arrayBuffers[e],n=new Uint32Array(r).buffer;return i[e]=n,n}(t,n.buffer),o=getTypedArray(n.type,s),a=new InterleavedBuffer(o,n.stride);return a.uuid=n.uuid,e[r]=a,a}const n=t.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,s=t.data.index;if(void 0!==s){const t=getTypedArray(s.type,s.array);n.setIndex(new BufferAttribute(t,1))}const o=t.data.attributes;for(const e in o){const i=o[e];let s;if(i.isInterleavedBufferAttribute){const e=r(t.data,i.data);s=new InterleavedBufferAttribute(e,i.itemSize,i.offset,i.normalized)}else{const t=getTypedArray(i.type,i.array);s=new(i.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute)(t,i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),void 0!==i.usage&&s.setUsage(i.usage),void 0!==i.updateRange&&(s.updateRange.offset=i.updateRange.offset,s.updateRange.count=i.updateRange.count),n.setAttribute(e,s)}const a=t.data.morphAttributes;if(a)for(const e in a){const i=a[e],s=[];for(let e=0,n=i.length;e<n;e++){const n=i[e];let o;if(n.isInterleavedBufferAttribute){const e=r(t.data,n.data);o=new InterleavedBufferAttribute(e,n.itemSize,n.offset,n.normalized)}else{const t=getTypedArray(n.type,n.array);o=new BufferAttribute(t,n.itemSize,n.normalized)}void 0!==n.name&&(o.name=n.name),s.push(o)}n.morphAttributes[e]=s}t.data.morphTargetsRelative&&(n.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let t=0,e=l.length;t!==e;++t){const e=l[t];n.addGroup(e.start,e.count,e.materialIndex)}const c=t.data.boundingSphere;if(void 0!==c){const t=new Vector3;void 0!==c.center&&t.fromArray(c.center),n.boundingSphere=new Sphere(t,c.radius)}return t.name&&(n.name=t.name),t.userData&&(n.userData=t.userData),n}}class ObjectLoader extends Loader{constructor(t){super(t)}load(t,e,i,r){const n=this,s=""===this.path?LoaderUtils.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const o=new FileLoader(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(i){let s=null;try{s=JSON.parse(i)}catch(e){return void 0!==r&&r(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const o=s.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())return void 0!==r&&r(new Error("THREE.ObjectLoader: Can't load "+t)),void console.error("THREE.ObjectLoader: Can't load "+t);n.parse(s,e)}),i,r)}async loadAsync(t,e){const i=""===this.path?LoaderUtils.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||i;const r=new FileLoader(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const n=await r.loadAsync(t,e),s=JSON.parse(n),o=s.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(s)}parse(t,e){const i=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,r),s=this.parseImages(t.images,(function(){void 0!==e&&e(l)})),o=this.parseTextures(t.textures,s),a=this.parseMaterials(t.materials,o),l=this.parseObject(t.object,n,a,o,i),c=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,c),void 0!==e){let t=!1;for(const e in s)if(s[e].data instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}async parseAsync(t){const e=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,i),n=await this.parseImagesAsync(t.images),s=this.parseTextures(t.textures,n),o=this.parseMaterials(t.materials,s),a=this.parseObject(t.object,r,o,s,e),l=this.parseSkeletons(t.skeletons,a);return this.bindSkeletons(a,l),a}parseShapes(t){const e={};if(void 0!==t)for(let i=0,r=t.length;i<r;i++){const r=(new Shape).fromJSON(t[i]);e[r.uuid]=r}return e}parseSkeletons(t,e){const i={},r={};if(e.traverse((function(t){t.isBone&&(r[t.uuid]=t)})),void 0!==t)for(let e=0,n=t.length;e<n;e++){const n=(new Skeleton).fromJSON(t[e],r);i[n.uuid]=n}return i}parseGeometries(t,e){const i={};if(void 0!==t){const r=new BufferGeometryLoader;for(let n=0,s=t.length;n<s;n++){let s;const o=t[n];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":s=r.parse(o);break;default:o.type in Geometries?s=Geometries[o.type].fromJSON(o,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.userData&&(s.userData=o.userData),i[o.uuid]=s}}return i}parseMaterials(t,e){const i={},r={};if(void 0!==t){const n=new MaterialLoader;n.setTextures(e);for(let e=0,s=t.length;e<s;e++){const s=t[e];void 0===i[s.uuid]&&(i[s.uuid]=n.parse(s)),r[s.uuid]=i[s.uuid]}}return r}parseAnimations(t){const e={};if(void 0!==t)for(let i=0;i<t.length;i++){const r=t[i],n=AnimationClip.parse(r);e[n.uuid]=n}return e}parseImages(t,e){const i=this,r={};let n;function s(t){if("string"==typeof t){const e=t;return function(t){return i.manager.itemStart(t),n.load(t,(function(){i.manager.itemEnd(t)}),void 0,(function(){i.manager.itemError(t),i.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:i.resourcePath+e)}return t.data?{data:getTypedArray(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const i=new LoadingManager(e);n=new ImageLoader(i),n.setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],n=i.url;if(Array.isArray(n)){const t=[];for(let e=0,i=n.length;e<i;e++){const i=s(n[e]);null!==i&&(i instanceof HTMLImageElement?t.push(i):t.push(new DataTexture(i.data,i.width,i.height)))}r[i.uuid]=new Source(t)}else{const t=s(i.url);r[i.uuid]=new Source(t)}}}return r}async parseImagesAsync(t){const e=this,i={};let r;async function n(t){if("string"==typeof t){const i=t,n=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(i)?i:e.resourcePath+i;return await r.loadAsync(n)}return t.data?{data:getTypedArray(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){r=new ImageLoader(this.manager),r.setCrossOrigin(this.crossOrigin);for(let e=0,r=t.length;e<r;e++){const r=t[e],s=r.url;if(Array.isArray(s)){const t=[];for(let e=0,i=s.length;e<i;e++){const i=s[e],r=await n(i);null!==r&&(r instanceof HTMLImageElement?t.push(r):t.push(new DataTexture(r.data,r.width,r.height)))}i[r.uuid]=new Source(t)}else{const t=await n(r.url);i[r.uuid]=new Source(t)}}}return i}parseTextures(t,e){function i(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const r={};if(void 0!==t)for(let n=0,s=t.length;n<s;n++){const s=t[n];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const o=e[s.image],a=o.data;let l;Array.isArray(a)?(l=new CubeTexture,6===a.length&&(l.needsUpdate=!0)):(l=a&&a.data?new DataTexture:new Texture,a&&(l.needsUpdate=!0)),l.source=o,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=i(s.mapping,TEXTURE_MAPPING)),void 0!==s.channel&&(l.channel=s.channel),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=i(s.wrap[0],TEXTURE_WRAPPING),l.wrapT=i(s.wrap[1],TEXTURE_WRAPPING)),void 0!==s.format&&(l.format=s.format),void 0!==s.internalFormat&&(l.internalFormat=s.internalFormat),void 0!==s.type&&(l.type=s.type),void 0!==s.colorSpace&&(l.colorSpace=s.colorSpace),void 0!==s.encoding&&(l.encoding=s.encoding),void 0!==s.minFilter&&(l.minFilter=i(s.minFilter,TEXTURE_FILTER)),void 0!==s.magFilter&&(l.magFilter=i(s.magFilter,TEXTURE_FILTER)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.generateMipmaps&&(l.generateMipmaps=s.generateMipmaps),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),void 0!==s.compareFunction&&(l.compareFunction=s.compareFunction),void 0!==s.userData&&(l.userData=s.userData),r[s.uuid]=l}return r}parseObject(t,e,i,r,n){let s,o,a;function l(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function c(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let r=0,n=t.length;r<n;r++){const n=t[r];void 0===i[n]&&console.warn("THREE.ObjectLoader: Undefined material",n),e.push(i[n])}return e}return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),i[t]}}function h(t){return void 0===r[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),r[t]}switch(t.type){case"Scene":s=new Scene,void 0!==t.background&&(Number.isInteger(t.background)?s.background=new Color(t.background):s.background=h(t.background)),void 0!==t.environment&&(s.environment=h(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?s.fog=new Fog(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(s.fog=new FogExp2(t.fog.color,t.fog.density))),void 0!==t.backgroundBlurriness&&(s.backgroundBlurriness=t.backgroundBlurriness),void 0!==t.backgroundIntensity&&(s.backgroundIntensity=t.backgroundIntensity);break;case"PerspectiveCamera":s=new PerspectiveCamera(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"AmbientLight":s=new AmbientLight(t.color,t.intensity);break;case"DirectionalLight":s=new DirectionalLight(t.color,t.intensity);break;case"PointLight":s=new PointLight(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":s=new RectAreaLight(t.color,t.intensity,t.width,t.height);break;case"SpotLight":s=new SpotLight(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":s=new HemisphereLight(t.color,t.groundColor,t.intensity);break;case"LightProbe":s=(new LightProbe).fromJSON(t);break;case"SkinnedMesh":o=l(t.geometry),a=c(t.material),s=new SkinnedMesh(o,a),void 0!==t.bindMode&&(s.bindMode=t.bindMode),void 0!==t.bindMatrix&&s.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(s.skeleton=t.skeleton);break;case"Mesh":o=l(t.geometry),a=c(t.material),s=new Mesh(o,a);break;case"InstancedMesh":o=l(t.geometry),a=c(t.material);const e=t.count,i=t.instanceMatrix,r=t.instanceColor;s=new InstancedMesh(o,a,e),s.instanceMatrix=new InstancedBufferAttribute(new Float32Array(i.array),16),void 0!==r&&(s.instanceColor=new InstancedBufferAttribute(new Float32Array(r.array),r.itemSize));break;case"LOD":s=new LOD;break;case"Line":s=new Line(l(t.geometry),c(t.material));break;case"LineLoop":s=new LineLoop(l(t.geometry),c(t.material));break;case"LineSegments":s=new LineSegments(l(t.geometry),c(t.material));break;case"PointCloud":case"Points":s=new Points(l(t.geometry),c(t.material));break;case"Sprite":s=new Sprite(c(t.material));break;case"Group":s=new Group;break;case"Bone":s=new Bone;break;default:s=new Object3D}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(s.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(s.matrixAutoUpdate=t.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.quaternion&&s.quaternion.fromArray(t.quaternion),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.up&&s.up.fromArray(t.up),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(s.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(s.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(s.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&s.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(s.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.frustumCulled&&(s.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(s.renderOrder=t.renderOrder),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.layers&&(s.layers.mask=t.layers),void 0!==t.children){const o=t.children;for(let t=0;t<o.length;t++)s.add(this.parseObject(o[t],e,i,r,n))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const i=e[t];s.animations.push(n[i])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(s.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const i=e[t],r=s.getObjectByProperty("uuid",i.object);void 0!==r&&s.addLevel(r,i.distance,i.hysteresis)}}return s}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const i=e[t.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(i,t.bindMatrix)}}))}}const TEXTURE_MAPPING={UVMapping,CubeReflectionMapping,CubeRefractionMapping,EquirectangularReflectionMapping,EquirectangularRefractionMapping,CubeUVReflectionMapping},TEXTURE_WRAPPING={RepeatWrapping,ClampToEdgeWrapping,MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter,NearestMipmapNearestFilter,NearestMipmapLinearFilter,LinearFilter,LinearMipmapNearestFilter,LinearMipmapLinearFilter};class ImageBitmapLoader extends Loader{constructor(t){super(t),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const n=this,s=Cache.get(t);if(void 0!==s)return n.manager.itemStart(t),setTimeout((function(){e&&e(s),n.manager.itemEnd(t)}),0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(n.options,{colorSpaceConversion:"none"}))})).then((function(i){Cache.add(t,i),e&&e(i),n.manager.itemEnd(t)})).catch((function(e){r&&r(e),n.manager.itemError(t),n.manager.itemEnd(t)})),n.manager.itemStart(t)}}let _context;class AudioContext{static getContext(){return void 0===_context&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context}static setContext(t){_context=t}}class AudioLoader extends Loader{constructor(t){super(t)}load(t,e,i,r){const n=this,s=new FileLoader(this.manager);function o(e){r?r(e):console.error(e),n.manager.itemError(t)}s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(t){try{const i=t.slice(0);AudioContext.getContext().decodeAudioData(i,(function(t){e(t)}),o)}catch(t){o(t)}}),i,r)}}class HemisphereLightProbe extends LightProbe{constructor(t,e,i=1){super(void 0,i),this.isHemisphereLightProbe=!0;const r=(new Color).set(t),n=(new Color).set(e),s=new Vector3(r.r,r.g,r.b),o=new Vector3(n.r,n.g,n.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(l)}}class AmbientLightProbe extends LightProbe{constructor(t,e=1){super(void 0,e),this.isAmbientLightProbe=!0;const i=(new Color).set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const _eyeRight=new Matrix4,_eyeLeft=new Matrix4,_projectionMatrix=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,_projectionMatrix.copy(t.projectionMatrix);const i=e.eyeSep/2,r=i*e.near/e.focus,n=e.near*Math.tan(DEG2RAD*e.fov*.5)/e.zoom;let s,o;_eyeLeft.elements[12]=-i,_eyeRight.elements[12]=i,s=-n*e.aspect+r,o=n*e.aspect+r,_projectionMatrix.elements[0]=2*e.near/(o-s),_projectionMatrix.elements[8]=(o+s)/(o-s),this.cameraL.projectionMatrix.copy(_projectionMatrix),s=-n*e.aspect-r,o=n*e.aspect-r,_projectionMatrix.elements[0]=2*e.near/(o-s),_projectionMatrix.elements[8]=(o+s)/(o-s),this.cameraR.projectionMatrix.copy(_projectionMatrix)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(_eyeRight)}}class Clock{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function now(){return("undefined"==typeof performance?Date:performance).now()}const _position$1=new Vector3,_quaternion$1=new Quaternion,_scale$1=new Vector3,_orientation$1=new Vector3;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$1,_quaternion$1,_scale$1),_orientation$1.set(0,0,-1).applyQuaternion(_quaternion$1),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(_position$1.x,t),e.positionY.linearRampToValueAtTime(_position$1.y,t),e.positionZ.linearRampToValueAtTime(_position$1.z,t),e.forwardX.linearRampToValueAtTime(_orientation$1.x,t),e.forwardY.linearRampToValueAtTime(_orientation$1.y,t),e.forwardZ.linearRampToValueAtTime(_orientation$1.z,t),e.upX.linearRampToValueAtTime(i.x,t),e.upY.linearRampToValueAtTime(i.y,t),e.upZ.linearRampToValueAtTime(i.z,t)}else e.setPosition(_position$1.x,_position$1.y,_position$1.z),e.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z,i.x,i.y,i.z)}}class Audio extends Object3D{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const _position=new Vector3,_quaternion=new Quaternion,_scale=new Vector3,_orientation=new Vector3;class PositionalAudio extends Audio{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,i){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=i,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(_position,_quaternion,_scale),_orientation.set(0,0,1).applyQuaternion(_quaternion);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(_position.x,t),e.positionY.linearRampToValueAtTime(_position.y,t),e.positionZ.linearRampToValueAtTime(_position.z,t),e.orientationX.linearRampToValueAtTime(_orientation.x,t),e.orientationY.linearRampToValueAtTime(_orientation.y,t),e.orientationZ.linearRampToValueAtTime(_orientation.z,t)}else e.setPosition(_position.x,_position.y,_position.z),e.setOrientation(_orientation.x,_orientation.y,_orientation.z)}}class AudioAnalyser{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let i=0;i<e.length;i++)t+=e[i];return t/e.length}}class PropertyMixer{constructor(t,e,i){let r,n,s;switch(this.binding=t,this.valueSize=i,e){case"quaternion":r=this._slerp,n=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":r=this._select,n=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:r=this._lerp,n=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=n,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,r=this.valueSize,n=t*r+r;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==r;++t)i[n+t]=i[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(i,n,0,t,r)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,r=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,r=t*e+e,n=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){const t=e*this._origIndex;this._mixBufferRegion(i,r,t,1-n,e)}s>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*e,1,e);for(let t=e,n=e+e;t!==n;++t)if(i[t]!==i[t+e]){o.setValue(i,r);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,r=i*this._origIndex;t.getValue(e,r);for(let t=i,n=r;t!==n;++t)e[t]=e[r+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,r,n){if(r>=.5)for(let r=0;r!==n;++r)t[e+r]=t[i+r]}_slerp(t,e,i,r){Quaternion.slerpFlat(t,e,t,e,t,i,r)}_slerpAdditive(t,e,i,r,n){const s=this._workIndex*n;Quaternion.multiplyQuaternionsFlat(t,s,t,e,t,i),Quaternion.slerpFlat(t,e,t,e,t,s,r)}_lerp(t,e,i,r,n){const s=1-r;for(let o=0;o!==n;++o){const n=e+o;t[n]=t[n]*s+t[i+o]*r}}_lerpAdditive(t,e,i,r,n){for(let s=0;s!==n;++s){const n=e+s;t[n]=t[n]+t[i+s]*r}}}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones","map"];class Composite{constructor(t,e,i){const r=i||PropertyBinding.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];void 0!==r&&r.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}}class PropertyBinding{constructor(t,e,i){this.path=e,this.parsedPath=i||PropertyBinding.parseTrackName(e),this.node=PropertyBinding.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new PropertyBinding.Composite(t,e,i):new PropertyBinding(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(_reservedRe,"")}static parseTrackName(t){const e=_trackRe.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const t=i.nodeName.substring(r+1);-1!==_supportedObjectNames.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let r=0;r<t.length;r++){const n=t[r];if(n.name===e||n.uuid===e)return n;const s=i(n.children);if(s)return s}return null},r=i(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)t[e++]=i[r]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,r=e.propertyName;let n=e.propertyIndex;if(t||(t=PropertyBinding.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(i){let r=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===r){r=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==r){if(void 0===t[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[r]}}const s=t[r];if(void 0===s){const i=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+r+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[n]&&(n=t.morphTargetDictionary[n])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=Composite,PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray],PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AnimationObjectGroup{constructor(){this.isAnimationObjectGroup=!0,this.uuid=generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,i=arguments.length;e!==i;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,i=this._paths,r=this._parsedPaths,n=this._bindings,s=n.length;let o,a=t.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const h=arguments[c],u=h.uuid;let d=e[u];if(void 0===d){d=a++,e[u]=d,t.push(h);for(let t=0,e=s;t!==e;++t)n[t].push(new PropertyBinding(h,i[t],r[t]))}else if(d<l){o=t[d];const a=--l,c=t[a];e[c.uuid]=d,t[d]=c,e[u]=a,t[a]=h;for(let t=0,e=s;t!==e;++t){const e=n[t],s=e[a];let o=e[d];e[d]=s,void 0===o&&(o=new PropertyBinding(h,i[t],r[t])),e[a]=o}}else t[d]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,r=i.length;let n=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s],a=o.uuid,l=e[a];if(void 0!==l&&l>=n){const s=n++,c=t[s];e[c.uuid]=l,t[l]=c,e[a]=s,t[s]=o;for(let t=0,e=r;t!==e;++t){const e=i[t],r=e[s],n=e[l];e[l]=r,e[s]=n}}}this.nCachedObjects_=n}uncache(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,r=i.length;let n=this.nCachedObjects_,s=t.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,l=e[a];if(void 0!==l)if(delete e[a],l<n){const o=--n,a=t[o],c=--s,h=t[c];e[a.uuid]=l,t[l]=a,e[h.uuid]=o,t[o]=h,t.pop();for(let t=0,e=r;t!==e;++t){const e=i[t],r=e[o],n=e[c];e[l]=r,e[o]=n,e.pop()}}else{const n=--s,o=t[n];n>0&&(e[o.uuid]=l),t[l]=o,t.pop();for(let t=0,e=r;t!==e;++t){const e=i[t];e[l]=e[n],e.pop()}}}this.nCachedObjects_=n}subscribe_(t,e){const i=this._bindingsIndicesByPath;let r=i[t];const n=this._bindings;if(void 0!==r)return n[r];const s=this._paths,o=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,h=new Array(l);r=n.length,i[t]=r,s.push(t),o.push(e),n.push(h);for(let i=c,r=a.length;i!==r;++i){const r=a[i];h[i]=new PropertyBinding(r,t,e)}return h}unsubscribe_(t){const e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){const r=this._paths,n=this._parsedPaths,s=this._bindings,o=s.length-1,a=s[o];e[t[o]]=i,s[i]=a,s.pop(),n[i]=n[o],n.pop(),r[i]=r[o],r.pop()}}}class AnimationAction{constructor(t,e,i=null,r=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=r;const n=e.tracks,s=n.length,o=new Array(s),a={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(let t=0;t!==s;++t){const e=n[t].createInterpolant(null);o[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const i=this._clip.duration,r=t._clip.duration,n=r/i,s=i/r;t.warp(1,n,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const r=this._mixer,n=r.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=n,a[1]=n+i,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,r){if(!this.enabled)return void this._updateWeight(t);const n=this._startTime;if(null!==n){const r=(t-n)*i;r<0||0===i?e=0:(this._startTime=null,e=i*r)}e*=this._updateTimeScale(t);const s=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(this.blendMode===AdditiveAnimationBlendMode)for(let i=0,r=t.length;i!==r;++i)t[i].evaluate(s),e[i].accumulateAdditive(o);else for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(s),e[i].accumulate(r,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const r=i.evaluate(t)[0];e*=r,t>i.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;null!==i&&(e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let r=this.time+t,n=this._loopCount;const s=i===LoopPingPong;if(0===t)return-1===n||!s||1&~n?r:e-r;if(i===LoopOnce){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(r>=e)r=e;else{if(!(r<0)){this.time=r;break t}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===n&&(t>=0?(n=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),r>=e||r<0){const i=Math.floor(r/e);r-=e*i,n+=Math.abs(i);const o=this.repetitions-n;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=n,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=r;if(s&&!(1&~n))return e-r}return r}_setEndings(t,e,i){const r=this._interpolantSettings;i?(r.endingStart=ZeroSlopeEnding,r.endingEnd=ZeroSlopeEnding):(r.endingStart=t?this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding,r.endingEnd=e?this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding)}_scheduleFading(t,e,i){const r=this._mixer,n=r.time;let s=this._weightInterpolant;null===s&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=n,a[0]=e,o[1]=n+t,a[1]=i,this}}const _controlInterpolantsResultBuffer=new Float32Array(1);class AnimationMixer extends EventDispatcher{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,r=t._clip.tracks,n=r.length,s=t._propertyBindings,o=t._interpolants,a=i.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let t=0;t!==n;++t){const n=r[t],l=n.name;let h=c[l];if(void 0!==h)++h.referenceCount,s[t]=h;else{if(h=s[t],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,a,l));continue}const r=e&&e._propertyBindings[t].binding.parsedPath;h=new PropertyMixer(PropertyBinding.create(i,l,r),n.ValueTypeName,n.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,a,l),s[t]=h}o[t].resultBuffer=h.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,r=this._actionsByClip[i];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0===i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0===--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){const r=this._actions,n=this._actionsByClip;let s=n[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,n[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=r.length,r.push(t),s.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],r=t._cacheIndex;i._cacheIndex=r,e[r]=i,e.pop(),t._cacheIndex=null;const n=t._clip.uuid,s=this._actionsByClip,o=s[n],a=o.knownActions,l=a[a.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[n],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0===--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,r=this._nActiveActions++,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,r=--this._nActiveActions,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_addInactiveBinding(t,e,i){const r=this._bindingsByRootAndName,n=this._bindings;let s=r[e];void 0===s&&(s={},r[e]=s),s[i]=t,t._cacheIndex=n.length,n.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,r=i.rootNode.uuid,n=i.path,s=this._bindingsByRootAndName,o=s[r],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete o[n],0===Object.keys(o).length&&delete s[r]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,r=this._nActiveBindings++,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,r=--this._nActiveBindings,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&(i=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,_controlInterpolantsResultBuffer),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,r=--this._nActiveControlInterpolants,n=e[r];t.__cacheIndex=r,e[r]=t,n.__cacheIndex=i,e[i]=n}clipAction(t,e,i){const r=e||this._root,n=r.uuid;let s="string"==typeof t?AnimationClip.findByName(r,t):t;const o=null!==s?s.uuid:t,a=this._actionsByClip[o];let l=null;if(void 0===i&&(i=null!==s?s.blendMode:NormalAnimationBlendMode),void 0!==a){const t=a.actionByRoot[n];if(void 0!==t&&t.blendMode===i)return t;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new AnimationAction(this,s,e,i);return this._bindAction(c,l),this._addInactiveAction(c,o,n),c}existingAction(t,e){const i=e||this._root,r=i.uuid,n="string"==typeof t?AnimationClip.findByName(i,t):t,s=n?n.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[r]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,r=this.time+=t,n=Math.sign(t),s=this._accuIndex^=1;for(let o=0;o!==i;++o)e[o]._update(r,t,n,s);const o=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)o[t].apply(s);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,r=this._actionsByClip,n=r[i];if(void 0!==n){const t=n.knownActions;for(let i=0,r=t.length;i!==r;++i){const r=t[i];this._deactivateAction(r);const n=r._cacheIndex,s=e[e.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,s._cacheIndex=n,e[n]=s,e.pop(),this._removeInactiveBindingsForAction(r)}delete r[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const t in i){const r=i[t].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[e];if(void 0!==r)for(const t in r){const e=r[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class Uniform{constructor(t){this.value=t}clone(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())}}let _id=0;class UniformsGroup extends EventDispatcher{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:_id++}),this.name="",this.usage=StaticDrawUsage,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const e=this.uniforms.indexOf(t);return-1!==e&&this.uniforms.splice(e,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(t){this.name=t.name,this.usage=t.usage;const e=t.uniforms;this.uniforms.length=0;for(let t=0,i=e.length;t<i;t++)this.uniforms.push(e[t].clone());return this}clone(){return(new this.constructor).copy(this)}}class InstancedInterleavedBuffer extends InterleavedBuffer{constructor(t,e,i=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}class GLBufferAttribute{constructor(t,e,i,r,n){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=e,this.itemSize=i,this.elementSize=r,this.count=n,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}class Raycaster{constructor(t,e,i=0,r=1/0){this.ray=new Ray(t,e),this.near=i,this.far=r,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,i=[]){return intersectObject(t,this,i,e),i.sort(ascSort),i}intersectObjects(t,e=!0,i=[]){for(let r=0,n=t.length;r<n;r++)intersectObject(t[r],this,i,e);return i.sort(ascSort),i}}function ascSort(t,e){return t.distance-e.distance}function intersectObject(t,e,i,r){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===r){const r=t.children;for(let t=0,n=r.length;t<n;t++)intersectObject(r[t],e,i,!0)}}class Spherical{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(clamp(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Cylindrical{constructor(t=1,e=0,i=0){return this.radius=t,this.theta=e,this.y=i,this}set(t,e,i){return this.radius=t,this.theta=e,this.y=i,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+i*i),this.theta=Math.atan2(t,i),this.y=e,this}clone(){return(new this.constructor).copy(this)}}const _vector$4=new Vector2;class Box2{constructor(t=new Vector2(1/0,1/0),e=new Vector2(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=_vector$4.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,_vector$4).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const _startP=new Vector3,_startEnd=new Vector3;class Line3{constructor(t=new Vector3,e=new Vector3){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){_startP.subVectors(t,this.start),_startEnd.subVectors(this.end,this.start);const i=_startEnd.dot(_startEnd);let r=_startEnd.dot(_startP)/i;return e&&(r=clamp(r,0,1)),r}closestPointToPoint(t,e,i){const r=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const _vector$3=new Vector3;class SpotLightHelper extends Object3D{constructor(t,e){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const i=new BufferGeometry,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,i=32;t<i;t++,e++){const n=t/i*Math.PI*2,s=e/i*Math.PI*2;r.push(Math.cos(n),Math.sin(n),1,Math.cos(s),Math.sin(s),1)}i.setAttribute("position",new Float32BufferAttribute(r,3));const n=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(i,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),_vector$3.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$3),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const _vector$2=new Vector3,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;class SkeletonHelper extends LineSegments{constructor(t){const e=getBoneList(t),i=new BufferGeometry,r=[],n=[],s=new Color(0,0,1),o=new Color(0,1,0);for(let t=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),n.push(s.r,s.g,s.b),n.push(o.r,o.g,o.b))}i.setAttribute("position",new Float32BufferAttribute(r,3)),i.setAttribute("color",new Float32BufferAttribute(n,3)),super(i,new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,i=this.geometry,r=i.getAttribute("position");_matrixWorldInv.copy(this.root.matrixWorld).invert();for(let t=0,i=0;t<e.length;t++){const n=e[t];n.parent&&n.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,n.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),r.setXYZ(i,_vector$2.x,_vector$2.y,_vector$2.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,n.parent.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),r.setXYZ(i+1,_vector$2.x,_vector$2.y,_vector$2.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose()}}function getBoneList(t){const e=[];!0===t.isBone&&e.push(t);for(let i=0;i<t.children.length;i++)e.push.apply(e,getBoneList(t.children[i]));return e}class PointLightHelper extends Mesh{constructor(t,e,i){super(new SphereGeometry(e,4,2),new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const _vector$1=new Vector3,_color1=new Color,_color2=new Color;class HemisphereLightHelper extends Object3D{constructor(t,e,i){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const r=new OctahedronGeometry(e);r.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const n=r.getAttribute("position"),s=new Float32Array(3*n.count);r.setAttribute("color",new BufferAttribute(s,3)),this.add(new Mesh(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(let t=0,i=e.count;t<i;t++){const r=t<i/2?_color1:_color2;e.setXYZ(t,r.r,r.g,r.b)}e.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(_vector$1.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(t=10,e=10,i=4473924,r=8947848){i=new Color(i),r=new Color(r);const n=e/2,s=t/e,o=t/2,a=[],l=[];for(let t=0,c=0,h=-o;t<=e;t++,h+=s){a.push(-o,0,h,o,0,h),a.push(h,0,-o,h,0,o);const e=t===n?i:r;e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3}const c=new BufferGeometry;c.setAttribute("position",new Float32BufferAttribute(a,3)),c.setAttribute("color",new Float32BufferAttribute(l,3)),super(c,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class PolarGridHelper extends LineSegments{constructor(t=10,e=16,i=8,r=64,n=4473924,s=8947848){n=new Color(n),s=new Color(s);const o=[],a=[];if(e>1)for(let i=0;i<e;i++){const r=i/e*(2*Math.PI),l=Math.sin(r)*t,c=Math.cos(r)*t;o.push(0,0,0),o.push(l,0,c);const h=1&i?n:s;a.push(h.r,h.g,h.b),a.push(h.r,h.g,h.b)}for(let e=0;e<i;e++){const l=1&e?n:s,c=t-t/i*e;for(let t=0;t<r;t++){let e=t/r*(2*Math.PI),i=Math.sin(e)*c,n=Math.cos(e)*c;o.push(i,0,n),a.push(l.r,l.g,l.b),e=(t+1)/r*(2*Math.PI),i=Math.sin(e)*c,n=Math.cos(e)*c,o.push(i,0,n),a.push(l.r,l.g,l.b)}}const l=new BufferGeometry;l.setAttribute("position",new Float32BufferAttribute(o,3)),l.setAttribute("color",new Float32BufferAttribute(a,3)),super(l,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const _v1=new Vector3,_v2=new Vector3,_v3=new Vector3;class DirectionalLightHelper extends Object3D{constructor(t,e,i){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",void 0===e&&(e=1);let r=new BufferGeometry;r.setAttribute("position",new Float32BufferAttribute([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const n=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(r,n),this.add(this.lightPlane),r=new BufferGeometry,r.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(r,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),_v1.setFromMatrixPosition(this.light.matrixWorld),_v2.setFromMatrixPosition(this.light.target.matrixWorld),_v3.subVectors(_v2,_v1),this.lightPlane.lookAt(_v2),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2),this.targetLine.scale.z=_v3.length()}}const _vector=new Vector3,_camera=new Camera;class CameraHelper extends LineSegments{constructor(t){const e=new BufferGeometry,i=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={};function o(t,e){a(t),a(e)}function a(t){r.push(0,0,0),n.push(0,0,0),void 0===s[t]&&(s[t]=[]),s[t].push(r.length/3-1)}o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4"),e.setAttribute("position",new Float32BufferAttribute(r,3)),e.setAttribute("color",new Float32BufferAttribute(n,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const l=new Color(16755200),c=new Color(16711680),h=new Color(43775),u=new Color(16777215),d=new Color(3355443);this.setColors(l,c,h,u,d)}setColors(t,e,i,r,n){const s=this.geometry.getAttribute("color");s.setXYZ(0,t.r,t.g,t.b),s.setXYZ(1,t.r,t.g,t.b),s.setXYZ(2,t.r,t.g,t.b),s.setXYZ(3,t.r,t.g,t.b),s.setXYZ(4,t.r,t.g,t.b),s.setXYZ(5,t.r,t.g,t.b),s.setXYZ(6,t.r,t.g,t.b),s.setXYZ(7,t.r,t.g,t.b),s.setXYZ(8,t.r,t.g,t.b),s.setXYZ(9,t.r,t.g,t.b),s.setXYZ(10,t.r,t.g,t.b),s.setXYZ(11,t.r,t.g,t.b),s.setXYZ(12,t.r,t.g,t.b),s.setXYZ(13,t.r,t.g,t.b),s.setXYZ(14,t.r,t.g,t.b),s.setXYZ(15,t.r,t.g,t.b),s.setXYZ(16,t.r,t.g,t.b),s.setXYZ(17,t.r,t.g,t.b),s.setXYZ(18,t.r,t.g,t.b),s.setXYZ(19,t.r,t.g,t.b),s.setXYZ(20,t.r,t.g,t.b),s.setXYZ(21,t.r,t.g,t.b),s.setXYZ(22,t.r,t.g,t.b),s.setXYZ(23,t.r,t.g,t.b),s.setXYZ(24,e.r,e.g,e.b),s.setXYZ(25,e.r,e.g,e.b),s.setXYZ(26,e.r,e.g,e.b),s.setXYZ(27,e.r,e.g,e.b),s.setXYZ(28,e.r,e.g,e.b),s.setXYZ(29,e.r,e.g,e.b),s.setXYZ(30,e.r,e.g,e.b),s.setXYZ(31,e.r,e.g,e.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,n.r,n.g,n.b),s.setXYZ(41,n.r,n.g,n.b),s.setXYZ(42,n.r,n.g,n.b),s.setXYZ(43,n.r,n.g,n.b),s.setXYZ(44,n.r,n.g,n.b),s.setXYZ(45,n.r,n.g,n.b),s.setXYZ(46,n.r,n.g,n.b),s.setXYZ(47,n.r,n.g,n.b),s.setXYZ(48,n.r,n.g,n.b),s.setXYZ(49,n.r,n.g,n.b),s.needsUpdate=!0}update(){const t=this.geometry,e=this.pointMap;_camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",e,t,_camera,0,0,-1),setPoint("t",e,t,_camera,0,0,1),setPoint("n1",e,t,_camera,-1,-1,-1),setPoint("n2",e,t,_camera,1,-1,-1),setPoint("n3",e,t,_camera,-1,1,-1),setPoint("n4",e,t,_camera,1,1,-1),setPoint("f1",e,t,_camera,-1,-1,1),setPoint("f2",e,t,_camera,1,-1,1),setPoint("f3",e,t,_camera,-1,1,1),setPoint("f4",e,t,_camera,1,1,1),setPoint("u1",e,t,_camera,.7,1.1,-1),setPoint("u2",e,t,_camera,-.7,1.1,-1),setPoint("u3",e,t,_camera,0,2,-1),setPoint("cf1",e,t,_camera,-1,0,1),setPoint("cf2",e,t,_camera,1,0,1),setPoint("cf3",e,t,_camera,0,-1,1),setPoint("cf4",e,t,_camera,0,1,1),setPoint("cn1",e,t,_camera,-1,0,-1),setPoint("cn2",e,t,_camera,1,0,-1),setPoint("cn3",e,t,_camera,0,-1,-1),setPoint("cn4",e,t,_camera,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function setPoint(t,e,i,r,n,s,o){_vector.set(n,s,o).unproject(r);const a=e[t];if(void 0!==a){const t=i.getAttribute("position");for(let e=0,i=a.length;e<i;e++)t.setXYZ(a[e],_vector.x,_vector.y,_vector.z)}}const _box=new Box3;class BoxHelper extends LineSegments{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),n=new BufferGeometry;n.setIndex(new BufferAttribute(i,1)),n.setAttribute("position",new BufferAttribute(r,3)),super(n,new LineBasicMaterial({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&_box.setFromObject(this.object),_box.isEmpty())return;const e=_box.min,i=_box.max,r=this.geometry.attributes.position,n=r.array;n[0]=i.x,n[1]=i.y,n[2]=i.z,n[3]=e.x,n[4]=i.y,n[5]=i.z,n[6]=e.x,n[7]=e.y,n[8]=i.z,n[9]=i.x,n[10]=e.y,n[11]=i.z,n[12]=i.x,n[13]=i.y,n[14]=e.z,n[15]=e.x,n[16]=i.y,n[17]=e.z,n[18]=e.x,n[19]=e.y,n[20]=e.z,n[21]=i.x,n[22]=e.y,n[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,e){return super.copy(t,e),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Box3Helper extends LineSegments{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new BufferGeometry;r.setIndex(new BufferAttribute(i,1)),r.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new LineBasicMaterial({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class PlaneHelper extends Line{constructor(t,e=1,i=16776960){const r=i,n=new BufferGeometry;n.setAttribute("position",new Float32BufferAttribute([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),n.computeBoundingSphere(),super(n,new LineBasicMaterial({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const s=new BufferGeometry;s.setAttribute("position",new Float32BufferAttribute([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),s.computeBoundingSphere(),this.add(new Mesh(s,new MeshBasicMaterial({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const _axis=new Vector3;let _lineGeometry,_coneGeometry;class ArrowHelper extends Object3D{constructor(t=new Vector3(0,0,1),e=new Vector3(0,0,0),i=1,r=16776960,n=.2*i,s=.2*n){super(),this.type="ArrowHelper",void 0===_lineGeometry&&(_lineGeometry=new BufferGeometry,_lineGeometry.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),_coneGeometry=new CylinderGeometry(0,.5,1,5,1),_coneGeometry.translate(0,-.5,0)),this.position.copy(e),this.line=new Line(_lineGeometry,new LineBasicMaterial({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,n,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{_axis.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(_axis,e)}}setLength(t,e=.2*t,i=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class AxesHelper extends LineSegments{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new BufferGeometry;i.setAttribute("position",new Float32BufferAttribute(e,3)),i.setAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(i,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,i){const r=new Color,n=this.geometry.attributes.color.array;return r.set(t),r.toArray(n,0),r.toArray(n,3),r.set(e),r.toArray(n,6),r.toArray(n,9),r.set(i),r.toArray(n,12),r.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ShapePath{constructor(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,i,r){return this.currentPath.quadraticCurveTo(t,e,i,r),this}bezierCurveTo(t,e,i,r,n,s){return this.currentPath.bezierCurveTo(t,e,i,r,n,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function e(t,e){const i=e.length;let r=!1;for(let n=i-1,s=0;s<i;n=s++){let i=e[n],o=e[s],a=o.x-i.x,l=o.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=e[s],a=-a,o=e[n],l=-l),t.y<i.y||t.y>o.y)continue;if(t.y===i.y){if(t.x===i.x)return!0}else{const e=l*(t.x-i.x)-a*(t.y-i.y);if(0===e)return!0;if(e<0)continue;r=!r}}else{if(t.y!==i.y)continue;if(o.x<=t.x&&t.x<=i.x||i.x<=t.x&&t.x<=o.x)return!0}}return r}const i=ShapeUtils.isClockWise,r=this.subPaths;if(0===r.length)return[];let n,s,o;const a=[];if(1===r.length)return s=r[0],o=new Shape,o.curves=s.curves,a.push(o),a;let l=!i(r[0].getPoints());l=t?!l:l;const c=[],h=[];let u,d,p=[],f=0;h[f]=void 0,p[f]=[];for(let e=0,o=r.length;e<o;e++)s=r[e],u=s.getPoints(),n=i(u),n=t?!n:n,n?(!l&&h[f]&&f++,h[f]={s:new Shape,p:u},h[f].s.curves=s.curves,l&&f++,p[f]=[]):p[f].push({h:s,p:u[0]});if(!h[0])return function(t){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i],n=new Shape;n.curves=r.curves,e.push(n)}return e}(r);if(h.length>1){let t=!1,i=0;for(let t=0,e=h.length;t<e;t++)c[t]=[];for(let r=0,n=h.length;r<n;r++){const n=p[r];for(let s=0;s<n.length;s++){const o=n[s];let a=!0;for(let n=0;n<h.length;n++)e(o.p,h[n].p)&&(r!==n&&i++,a?(a=!1,c[n].push(o)):t=!0);a&&c[r].push(o)}}i>0&&!1===t&&(p=c)}for(let t=0,e=h.length;t<e;t++){o=h[t].s,a.push(o),d=p[t];for(let t=0,e=d.length;t<e;t++)o.holes.push(d[t].h)}return a}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);var MathBoxVisualizer_excluded=["type","expression","domain","range","zRange","width","height"];function MathBoxVisualizer_objectWithoutProperties(t,e){if(null==t)return{};var i,r,n=MathBoxVisualizer_objectWithoutPropertiesLoose(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)i=s[r],-1===e.indexOf(i)&&{}.propertyIsEnumerable.call(t,i)&&(n[i]=t[i])}return n}function MathBoxVisualizer_objectWithoutPropertiesLoose(t,e){if(null==t)return{};var i={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(-1!==e.indexOf(r))continue;i[r]=t[r]}return i}var MathBoxVisualizer=function(t){var e=t.type,i=t.expression,r=t.domain,n=void 0===r?[-10,10]:r,s=t.range,o=void 0===s?[-10,10]:s,a=t.zRange,l=void 0===a?[-10,10]:a,c=t.width,h=void 0===c?"100%":c,u=t.height,d=void 0===u?400:u,p=MathBoxVisualizer_objectWithoutProperties(t,MathBoxVisualizer_excluded),f=(0,react.useRef)(null),m=(0,react.useRef)(null),g=(0,react.useRef)(null),_=(0,react.useRef)(null),v=(0,react.useRef)(null);return(0,react.useEffect)((function(){if(f.current){m.current&&(cancelAnimationFrame(v.current),f.current.removeChild(m.current.domElement),m.current.dispose());var t=f.current.clientWidth,r="string"==typeof d?parseInt(d,10):d,s=new Scene;s.background=new Color(15790320),g.current=s;var a=new PerspectiveCamera(75,t/r,.1,1e3);a.position.set(15,15,15),a.lookAt(0,0,0),_.current=a;var c=new WebGLRenderer({antialias:!0});c.setSize(t,r),c.setPixelRatio(window.devicePixelRatio),f.current.appendChild(c.domElement),m.current=c;var h=new AmbientLight(16777215,.5);s.add(h);var u=new DirectionalLight(16777215,.8);u.position.set(1,1,1),s.add(u),createAxes(s,n,o,l),createVisualization(s,e,i,n,o,l,p);var y=!1,b={x:0,y:0},A=function(t){y=!0,b={x:t.clientX,y:t.clientY}},x=function(t){if(y){var e=t.clientX-b.x,i=t.clientY-b.y,r=(new Quaternion).setFromEuler(new Euler(.01*i,.01*e,0,"XYZ"));a.position.applyQuaternion(r),a.lookAt(s.position),b={x:t.clientX,y:t.clientY}}},C=function(){y=!1},E=function(t){t.preventDefault();var e=.1*-Math.sign(t.deltaY),i=(new Vector3).subVectors(a.position,s.position).normalize().multiplyScalar(5*e);a.position.add(i)};c.domElement.addEventListener("mousedown",A),c.domElement.addEventListener("mousemove",x),c.domElement.addEventListener("mouseup",C),c.domElement.addEventListener("wheel",E);var M=function(){v.current=requestAnimationFrame(M),c.render(s,a)};M();var S=function(){if(f.current&&a&&c){var t=f.current.clientWidth,e="string"==typeof d?parseInt(d,10):d;a.aspect=t/e,a.updateProjectionMatrix(),c.setSize(t,e)}};return window.addEventListener("resize",S),function(){cancelAnimationFrame(v.current),window.removeEventListener("resize",S),m.current&&(c.domElement.removeEventListener("mousedown",A),c.domElement.removeEventListener("mousemove",x),c.domElement.removeEventListener("mouseup",C),c.domElement.removeEventListener("wheel",E),f.current&&f.current.removeChild(m.current.domElement),m.current.dispose()),g.current&&g.current.traverse((function(t){t instanceof Mesh&&(t.geometry&&t.geometry.dispose(),t.material&&(Array.isArray(t.material)?t.material.forEach((function(t){return t.dispose()})):t.material.dispose()))}))}}}),[e,i,n,o,l,d,p]),react.createElement("div",{ref:f,style:{width:h,height:d,overflow:"hidden"},"data-testid":"mathbox-container"})};function createAxes(t,e,i,r){var n=Math.max(Math.abs(e[0]),Math.abs(e[1])),s=Math.max(Math.abs(r[0]),Math.abs(r[1])),o=Math.max(Math.abs(i[0]),Math.abs(i[1])),a=Math.max(n,s,o,10),l=new AxesHelper(a);t.add(l);var c=new GridHelper(2*a,20);t.add(c);for(var h=a/5,u=-a;u<=a;u+=h)if(0!==u){var d=new BufferGeometry,p=new Float32Array([u,0,0,u,-.2,0]);d.setAttribute("position",new BufferAttribute(p,3));var f=new LineBasicMaterial({color:16711680}),m=new Line(d,f);t.add(m)}for(var g=-a;g<=a;g+=h)if(0!==g){var _=new BufferGeometry,v=new Float32Array([0,g,0,-.2,g,0]);_.setAttribute("position",new BufferAttribute(v,3));var y=new LineBasicMaterial({color:65280}),b=new Line(_,y);t.add(b)}for(var A=-a;A<=a;A+=h)if(0!==A){var x=new BufferGeometry,C=new Float32Array([0,0,A,0,-.2,A]);x.setAttribute("position",new BufferAttribute(C,3));var E=new LineBasicMaterial({color:255}),M=new Line(x,E);t.add(M)}}function createVisualization(t,e,i,r,n,s,o){try{switch(e){case"function3D":createFunction3D(t,i,r,n,s,o);break;case"parametric3D":createParametric3D(t,i,r,n,s,o);break;case"vectorField3D":createVectorField3D(t,i,r,n,s,o);break;default:var a=new PlaneGeometry(10,10,10,10),l=new MeshBasicMaterial({color:3182847,wireframe:!0,side:DoubleSide}),c=new Mesh(a,l);t.add(c)}}catch(e){console.error("Error creating visualization:",e);var h=new PlaneGeometry(5,1),u=new MeshBasicMaterial({color:16711680,side:DoubleSide}),d=new Mesh(h,u);d.position.set(0,5,0),d.lookAt(0,10,10),t.add(d)}}function createFunction3D(t,e,i,r,n,s){for(var o=createFunctionFromExpression(e||"Math.sin(x) * Math.cos(y)"),a=s.resolution||50,l=new BufferGeometry,c=[],h=[],u=[],d=[],p=(i[1]-i[0])/a,f=(r[1]-r[0])/a,m=0;m<=a;m++)for(var g=0;g<=a;g++){var _=i[0]+m*p,v=r[0]+g*f,y=void 0;try{y=o(_,v),y=Math.max(n[0],Math.min(n[1],y))}catch(t){y=0}c.push(_,y,v);var b=(y-n[0])/(n[1]-n[0]),A=new Color("hsl(".concat(240*(1-b),", 100%, 50%)"));d.push(A.r,A.g,A.b)}for(var x=0;x<a;x++)for(var C=0;C<a;C++){var E=x*(a+1)+C,M=x*(a+1)+C+1,S=(x+1)*(a+1)+C,w=(x+1)*(a+1)+C+1;h.push(E,S,M),h.push(S,w,M)}for(var P=0;P<c.length/3;P++)u.push(0,1,0);l.setIndex(h),l.setAttribute("position",new Float32BufferAttribute(c,3)),l.setAttribute("normal",new Float32BufferAttribute(u,3)),l.setAttribute("color",new Float32BufferAttribute(d,3)),l.computeVertexNormals();var T=new MeshPhongMaterial({side:DoubleSide,vertexColors:!0,shininess:30,wireframe:s.wireframe||!1}),O=new Mesh(l,T);t.add(O)}function createParametric3D(t,e,i,r,n,s){for(var o=s.expressions||{x:"u * Math.cos(v)",y:"u * Math.sin(v)",z:"v"},a=createFunctionFromExpression(o.x),l=createFunctionFromExpression(o.y),c=createFunctionFromExpression(o.z),h=s.uRange||[0,1],u=s.vRange||[0,2*Math.PI],d=s.uResolution||30,p=s.vResolution||30,f=new BufferGeometry,m=[],g=[],_=[],v=(h[1]-h[0])/d,y=(u[1]-u[0])/p,b=0;b<=d;b++)for(var A=0;A<=p;A++){var x=h[0]+b*v,C=u[0]+A*y,E=void 0,M=void 0,S=void 0;try{E=a(x,C),M=l(x,C),S=c(x,C)}catch(t){E=M=S=0}m.push(E,M,S);var w=(x-h[0])/(h[1]-h[0]),P=new Color("hsl(".concat(360*w,", 100%, 50%)"));_.push(P.r,P.g,P.b)}for(var T=0;T<d;T++)for(var O=0;O<p;O++){var R=T*(p+1)+O,N=T*(p+1)+O+1,L=(T+1)*(p+1)+O,D=(T+1)*(p+1)+O+1;g.push(R,L,N),g.push(L,D,N)}f.setIndex(g),f.setAttribute("position",new Float32BufferAttribute(m,3)),f.setAttribute("color",new Float32BufferAttribute(_,3)),f.computeVertexNormals();var k=new MeshPhongMaterial({side:DoubleSide,vertexColors:!0,shininess:30,wireframe:s.wireframe||!1}),I=new Mesh(f,k);t.add(I)}function createVectorField3D(t,e,i,r,n,s){for(var o=s.expressions||{x:"y",y:"-x",z:"0"},a=createFunctionFromExpression(o.x),l=createFunctionFromExpression(o.y),c=createFunctionFromExpression(o.z),h=s.resolution||5,u=s.vectorScale||.5,d=new Group,p=(i[1]-i[0])/h,f=(n[1]-n[0])/h,m=(r[1]-r[0])/h,g=0;g<=h;g++)for(var _=0;_<=h;_++)for(var v=0;v<=h;v++){var y=i[0]+g*p,b=n[0]+_*f,A=r[0]+v*m,x=void 0,C=void 0,E=void 0;try{x=a(y,b,A),C=l(y,b,A),E=c(y,b,A)}catch(t){x=C=E=0}var M=Math.sqrt(x*x+C*C+E*E);if(!(M<.01)){var S=new Vector3(x/M*u,C/M*u,E/M*u),w=new Vector3(y,b,A),P=240*(1-Math.min(M,5)/5),T=new Color("hsl(".concat(P,", 100%, 50%)")),O=new ArrowHelper(S.normalize(),w,u,T,.2*u,.1*u);d.add(O)}}t.add(d)}function createFunctionFromExpression(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"x",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"y";try{var r=t.replace(/Math\./g,"").replace(/sin/g,"Math.sin").replace(/cos/g,"Math.cos").replace(/tan/g,"Math.tan").replace(/exp/g,"Math.exp").replace(/log/g,"Math.log").replace(/sqrt/g,"Math.sqrt").replace(/pow/g,"Math.pow").replace(/PI/g,"Math.PI");return new Function(e,i,"return ".concat(r,";"))}catch(t){return console.error("Error creating function from expression:",t),function(){return 0}}}const visualizers_MathBoxVisualizer=null,_changeEvent={type:"change"},_startEvent={type:"start"},_endEvent={type:"end"},OrbitControls_ray=new Ray,_plane=new Plane,TILT_LIMIT=Math.cos(70*MathUtils.DEG2RAD);class OrbitControls extends EventDispatcher{constructor(t,e){super(),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN},this.touches={ONE:TOUCH.ROTATE,TWO:TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",X),this._domElementKeyEvents=t},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",X),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(_changeEvent),i.update(),n=r.NONE},this.update=function(){const e=new Vector3,h=(new Quaternion).setFromUnitVectors(t.up,new Vector3(0,1,0)),u=h.clone().invert(),d=new Vector3,p=new Quaternion,f=new Vector3,m=2*Math.PI;return function(g=null){const _=i.object.position;e.copy(_).sub(i.target),e.applyQuaternion(h),o.setFromVector3(e),i.autoRotate&&n===r.NONE&&M(function(t){return null!==t?2*Math.PI/60*i.autoRotateSpeed*t:2*Math.PI/60/60*i.autoRotateSpeed}(g)),i.enableDamping?(o.theta+=a.theta*i.dampingFactor,o.phi+=a.phi*i.dampingFactor):(o.theta+=a.theta,o.phi+=a.phi);let v=i.minAzimuthAngle,x=i.maxAzimuthAngle;isFinite(v)&&isFinite(x)&&(v<-Math.PI?v+=m:v>Math.PI&&(v-=m),x<-Math.PI?x+=m:x>Math.PI&&(x-=m),o.theta=v<=x?Math.max(v,Math.min(x,o.theta)):o.theta>(v+x)/2?Math.max(v,o.theta):Math.min(x,o.theta)),o.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,o.phi)),o.makeSafe(),!0===i.enableDamping?i.target.addScaledVector(c,i.dampingFactor):i.target.add(c),i.zoomToCursor&&A||i.object.isOrthographicCamera?o.radius=L(o.radius):o.radius=L(o.radius*l),e.setFromSpherical(o),e.applyQuaternion(u),_.copy(i.target).add(e),i.object.lookAt(i.target),!0===i.enableDamping?(a.theta*=1-i.dampingFactor,a.phi*=1-i.dampingFactor,c.multiplyScalar(1-i.dampingFactor)):(a.set(0,0,0),c.set(0,0,0));let C=!1;if(i.zoomToCursor&&A){let r=null;if(i.object.isPerspectiveCamera){const t=e.length();r=L(t*l);const n=t-r;i.object.position.addScaledVector(y,n),i.object.updateMatrixWorld()}else if(i.object.isOrthographicCamera){const t=new Vector3(b.x,b.y,0);t.unproject(i.object),i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/l)),i.object.updateProjectionMatrix(),C=!0;const n=new Vector3(b.x,b.y,0);n.unproject(i.object),i.object.position.sub(n).add(t),i.object.updateMatrixWorld(),r=e.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;null!==r&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(r).add(i.object.position):(OrbitControls_ray.origin.copy(i.object.position),OrbitControls_ray.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(OrbitControls_ray.direction))<TILT_LIMIT?t.lookAt(i.target):(_plane.setFromNormalAndCoplanarPoint(i.object.up,i.target),OrbitControls_ray.intersectPlane(_plane,i.target))))}else i.object.isOrthographicCamera&&(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/l)),i.object.updateProjectionMatrix(),C=!0);return l=1,A=!1,!!(C||d.distanceToSquared(i.object.position)>s||8*(1-p.dot(i.object.quaternion))>s||f.distanceToSquared(i.target)>0)&&(i.dispatchEvent(_changeEvent),d.copy(i.object.position),p.copy(i.object.quaternion),f.copy(i.target),C=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",W),i.domElement.removeEventListener("pointerdown",z),i.domElement.removeEventListener("pointercancel",H),i.domElement.removeEventListener("wheel",Y),i.domElement.removeEventListener("pointermove",G),i.domElement.removeEventListener("pointerup",H),null!==i._domElementKeyEvents&&(i._domElementKeyEvents.removeEventListener("keydown",X),i._domElementKeyEvents=null)};const i=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let n=r.NONE;const s=1e-6,o=new Spherical,a=new Spherical;let l=1;const c=new Vector3,h=new Vector2,u=new Vector2,d=new Vector2,p=new Vector2,f=new Vector2,m=new Vector2,g=new Vector2,_=new Vector2,v=new Vector2,y=new Vector3,b=new Vector2;let A=!1;const x=[],C={};function E(){return Math.pow(.95,i.zoomSpeed)}function M(t){a.theta-=t}function S(t){a.phi-=t}const w=function(){const t=new Vector3;return function(e,i){t.setFromMatrixColumn(i,0),t.multiplyScalar(-e),c.add(t)}}(),P=function(){const t=new Vector3;return function(e,r){!0===i.screenSpacePanning?t.setFromMatrixColumn(r,1):(t.setFromMatrixColumn(r,0),t.crossVectors(i.object.up,t)),t.multiplyScalar(e),c.add(t)}}(),T=function(){const t=new Vector3;return function(e,r){const n=i.domElement;if(i.object.isPerspectiveCamera){const s=i.object.position;t.copy(s).sub(i.target);let o=t.length();o*=Math.tan(i.object.fov/2*Math.PI/180),w(2*e*o/n.clientHeight,i.object.matrix),P(2*r*o/n.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(w(e*(i.object.right-i.object.left)/i.object.zoom/n.clientWidth,i.object.matrix),P(r*(i.object.top-i.object.bottom)/i.object.zoom/n.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function O(t){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?l/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function R(t){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?l*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function N(t){if(!i.zoomToCursor)return;A=!0;const e=i.domElement.getBoundingClientRect(),r=t.clientX-e.left,n=t.clientY-e.top,s=e.width,o=e.height;b.x=r/s*2-1,b.y=-n/o*2+1,y.set(b.x,b.y,1).unproject(i.object).sub(i.object.position).normalize()}function L(t){return Math.max(i.minDistance,Math.min(i.maxDistance,t))}function D(t){h.set(t.clientX,t.clientY)}function k(t){p.set(t.clientX,t.clientY)}function I(){if(1===x.length)h.set(x[0].pageX,x[0].pageY);else{const t=.5*(x[0].pageX+x[1].pageX),e=.5*(x[0].pageY+x[1].pageY);h.set(t,e)}}function B(){if(1===x.length)p.set(x[0].pageX,x[0].pageY);else{const t=.5*(x[0].pageX+x[1].pageX),e=.5*(x[0].pageY+x[1].pageY);p.set(t,e)}}function U(){const t=x[0].pageX-x[1].pageX,e=x[0].pageY-x[1].pageY,i=Math.sqrt(t*t+e*e);g.set(0,i)}function F(t){if(1==x.length)u.set(t.pageX,t.pageY);else{const e=$(t),i=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);u.set(i,r)}d.subVectors(u,h).multiplyScalar(i.rotateSpeed);const e=i.domElement;M(2*Math.PI*d.x/e.clientHeight),S(2*Math.PI*d.y/e.clientHeight),h.copy(u)}function j(t){if(1===x.length)f.set(t.pageX,t.pageY);else{const e=$(t),i=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);f.set(i,r)}m.subVectors(f,p).multiplyScalar(i.panSpeed),T(m.x,m.y),p.copy(f)}function V(t){const e=$(t),r=t.pageX-e.x,n=t.pageY-e.y,s=Math.sqrt(r*r+n*n);_.set(0,s),v.set(0,Math.pow(_.y/g.y,i.zoomSpeed)),O(v.y),g.copy(_)}function z(t){!1!==i.enabled&&(0===x.length&&(i.domElement.setPointerCapture(t.pointerId),i.domElement.addEventListener("pointermove",G),i.domElement.addEventListener("pointerup",H)),function(t){x.push(t)}(t),"touch"===t.pointerType?function(t){switch(J(t),x.length){case 1:switch(i.touches.ONE){case TOUCH.ROTATE:if(!1===i.enableRotate)return;I(),n=r.TOUCH_ROTATE;break;case TOUCH.PAN:if(!1===i.enablePan)return;B(),n=r.TOUCH_PAN;break;default:n=r.NONE}break;case 2:switch(i.touches.TWO){case TOUCH.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&U(),i.enablePan&&B(),n=r.TOUCH_DOLLY_PAN;break;case TOUCH.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&U(),i.enableRotate&&I(),n=r.TOUCH_DOLLY_ROTATE;break;default:n=r.NONE}break;default:n=r.NONE}n!==r.NONE&&i.dispatchEvent(_startEvent)}(t):function(t){let e;switch(t.button){case 0:e=i.mouseButtons.LEFT;break;case 1:e=i.mouseButtons.MIDDLE;break;case 2:e=i.mouseButtons.RIGHT;break;default:e=-1}switch(e){case MOUSE.DOLLY:if(!1===i.enableZoom)return;!function(t){N(t),g.set(t.clientX,t.clientY)}(t),n=r.DOLLY;break;case MOUSE.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===i.enablePan)return;k(t),n=r.PAN}else{if(!1===i.enableRotate)return;D(t),n=r.ROTATE}break;case MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===i.enableRotate)return;D(t),n=r.ROTATE}else{if(!1===i.enablePan)return;k(t),n=r.PAN}break;default:n=r.NONE}n!==r.NONE&&i.dispatchEvent(_startEvent)}(t))}function G(t){!1!==i.enabled&&("touch"===t.pointerType?function(t){switch(J(t),n){case r.TOUCH_ROTATE:if(!1===i.enableRotate)return;F(t),i.update();break;case r.TOUCH_PAN:if(!1===i.enablePan)return;j(t),i.update();break;case r.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(t){i.enableZoom&&V(t),i.enablePan&&j(t)}(t),i.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(t){i.enableZoom&&V(t),i.enableRotate&&F(t)}(t),i.update();break;default:n=r.NONE}}(t):function(t){switch(n){case r.ROTATE:if(!1===i.enableRotate)return;!function(t){u.set(t.clientX,t.clientY),d.subVectors(u,h).multiplyScalar(i.rotateSpeed);const e=i.domElement;M(2*Math.PI*d.x/e.clientHeight),S(2*Math.PI*d.y/e.clientHeight),h.copy(u),i.update()}(t);break;case r.DOLLY:if(!1===i.enableZoom)return;!function(t){_.set(t.clientX,t.clientY),v.subVectors(_,g),v.y>0?O(E()):v.y<0&&R(E()),g.copy(_),i.update()}(t);break;case r.PAN:if(!1===i.enablePan)return;!function(t){f.set(t.clientX,t.clientY),m.subVectors(f,p).multiplyScalar(i.panSpeed),T(m.x,m.y),p.copy(f),i.update()}(t)}}(t))}function H(t){!function(t){delete C[t.pointerId];for(let e=0;e<x.length;e++)if(x[e].pointerId==t.pointerId)return void x.splice(e,1)}(t),0===x.length&&(i.domElement.releasePointerCapture(t.pointerId),i.domElement.removeEventListener("pointermove",G),i.domElement.removeEventListener("pointerup",H)),i.dispatchEvent(_endEvent),n=r.NONE}function Y(t){!1!==i.enabled&&!1!==i.enableZoom&&n===r.NONE&&(t.preventDefault(),i.dispatchEvent(_startEvent),function(t){N(t),t.deltaY<0?R(E()):t.deltaY>0&&O(E()),i.update()}(t),i.dispatchEvent(_endEvent))}function X(t){!1!==i.enabled&&!1!==i.enablePan&&function(t){let e=!1;switch(t.code){case i.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?S(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):T(0,i.keyPanSpeed),e=!0;break;case i.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?S(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):T(0,-i.keyPanSpeed),e=!0;break;case i.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?M(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):T(i.keyPanSpeed,0),e=!0;break;case i.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?M(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):T(-i.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),i.update())}(t)}function W(t){!1!==i.enabled&&t.preventDefault()}function J(t){let e=C[t.pointerId];void 0===e&&(e=new Vector2,C[t.pointerId]=e),e.set(t.pageX,t.pageY)}function $(t){const e=t.pointerId===x[0].pointerId?x[1]:x[0];return C[e.pointerId]}i.domElement.addEventListener("contextmenu",W),i.domElement.addEventListener("pointerdown",z),i.domElement.addEventListener("pointercancel",H),i.domElement.addEventListener("wheel",Y,{passive:!1}),this.update()}}var ThreeJSVisualizer_excluded=["type","expression","domain","range","zRange","width","height"];function _construct(t,e,i){if(_isNativeReflectConstruct())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var n=new(t.bind.apply(t,r));return i&&_setPrototypeOf(n,i.prototype),n}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_isNativeReflectConstruct=function(){return!!t})()}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _createForOfIteratorHelper(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){a=!0,s=t},f:function(){try{o||null==i.return||i.return()}finally{if(a)throw s}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function ThreeJSVisualizer_objectWithoutProperties(t,e){if(null==t)return{};var i,r,n=ThreeJSVisualizer_objectWithoutPropertiesLoose(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)i=s[r],-1===e.indexOf(i)&&{}.propertyIsEnumerable.call(t,i)&&(n[i]=t[i])}return n}function ThreeJSVisualizer_objectWithoutPropertiesLoose(t,e){if(null==t)return{};var i={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(-1!==e.indexOf(r))continue;i[r]=t[r]}return i}var ThreeJSVisualizer=function(t){var e=t.type,i=t.expression,r=t.domain,n=void 0===r?[-10,10]:r,s=t.range,o=void 0===s?[-10,10]:s,a=t.zRange,l=void 0===a?[-10,10]:a,c=t.width,h=void 0===c?"100%":c,u=t.height,d=void 0===u?400:u,p=ThreeJSVisualizer_objectWithoutProperties(t,ThreeJSVisualizer_excluded),f=(0,react.useRef)(null),m=(0,react.useRef)(null),g=(0,react.useRef)(null),_=(0,react.useRef)(null),v=(0,react.useRef)(null),y=(0,react.useRef)(null);return(0,react.useRef)(null),(0,react.useEffect)((function(){if(f.current){m.current&&(cancelAnimationFrame(y.current),f.current.removeChild(m.current.domElement),v.current&&v.current.dispose(),m.current&&m.current.dispose(),g.current&&disposeScene(g.current));var t=f.current.clientWidth,r="string"==typeof d?parseInt(d,10):d,s=new Scene;s.background=new Color(15790320),g.current=s;var a=new PerspectiveCamera(75,t/r,.1,1e3);a.position.set(15,15,15),a.lookAt(0,0,0),_.current=a;var c=new WebGLRenderer({antialias:!0});c.setSize(t,r),c.setPixelRatio(window.devicePixelRatio),f.current.appendChild(c.domElement),m.current=c;var h=new OrbitControls(a,c.domElement);h.enableDamping=!0,h.dampingFactor=.05,v.current=h;var u=new AmbientLight(16777215,.5);s.add(u);var b=new DirectionalLight(16777215,.8);b.position.set(1,1,1),s.add(b),addGridAndAxes(s,n,o,l),ThreeJSVisualizer_createVisualization(s,e,i,n,o,l,p);var A=function(){y.current=requestAnimationFrame(A),h.update(),c.render(s,a)};A();var x=function(){if(f.current&&a&&c){var t=f.current.clientWidth,e="string"==typeof d?parseInt(d,10):d;a.aspect=t/e,a.updateProjectionMatrix(),c.setSize(t,e)}};return window.addEventListener("resize",x),function(){cancelAnimationFrame(y.current),window.removeEventListener("resize",x),v.current&&v.current.dispose(),m.current&&(f.current&&f.current.removeChild(m.current.domElement),m.current.dispose()),g.current&&disposeScene(g.current)}}}),[e,i,n,o,l,d,p]),react.createElement("div",{ref:f,style:{width:h,height:d,overflow:"hidden"},"data-testid":"threejs-container"})};function disposeScene(t){t.traverse((function(t){t instanceof Mesh&&(t.geometry&&t.geometry.dispose(),t.material&&(Array.isArray(t.material)?t.material.forEach((function(t){return t.dispose()})):t.material.dispose()))}))}function addGridAndAxes(t,e,i,r){var n=Math.max(Math.abs(e[0]),Math.abs(e[1])),s=Math.max(Math.abs(i[0]),Math.abs(i[1])),o=Math.max(n,s,10),a=new GridHelper(2*o,2*o);t.add(a);var l=new AxesHelper(o);t.add(l);for(var c=[[o+1,0,0],[0,o+1,0],[0,0,o+1]],h=[16711680,65280,255],u=0;u<3;u++){var d=[];d.push(new Vector3(.9*c[u][0],.9*c[u][1],.9*c[u][2])),d.push(new Vector3(c[u][0],c[u][1],c[u][2]));var p=(new BufferGeometry).setFromPoints(d),f=new LineBasicMaterial({color:h[u]}),m=new Line(p,f);t.add(m)}}function ThreeJSVisualizer_createVisualization(t,e,i,r,n,s,o){switch(e){case"function3D":case"surface":createSurface(t,i,r,n,s,o);break;case"parametric3D":createParametricSurface(t,i,r,n,s,o);break;case"vectorField3D":createVectorField(t,i,r,n,s,o);break;case"scatter3D":createScatterPlot3D(t,o.data||[],r,n,s);break;default:var a=new BoxGeometry(1,1,1),l=new MeshLambertMaterial({color:3182847}),c=new Mesh(a,l);t.add(c)}}function createSurface(t,e,i,r,n,s){try{for(var o=ThreeJSVisualizer_createFunctionFromExpression(e),a=new PlaneGeometry(i[1]-i[0],r[1]-r[0],50,50),l=a.attributes.position,c=new Vector3,h=0;h<l.count;h++){c.fromBufferAttribute(l,h);var u=i[0]+(c.x+(i[1]-i[0])/2)/(i[1]-i[0])*(i[1]-i[0]),d=r[0]+(c.y+(r[1]-r[0])/2)/(r[1]-r[0])*(r[1]-r[0]),p=void 0;try{p=o(u,d),p=Math.max(n[0],Math.min(n[1],p))}catch(t){p=0}l.setXYZ(h,u,p,d)}a.computeVertexNormals();var f=new MeshPhongMaterial({color:s.color||3182847,side:DoubleSide,flatShading:!1,shininess:50,wireframe:s.wireframe||!1}),m=new Mesh(a,f);return t.add(m),m}catch(t){return console.error("Error creating surface:",t),null}}function createParametricSurface(t,e,i,r,n,s){try{if(!(s.expressions&&s.expressions.x&&s.expressions.y&&s.expressions.z))throw new Error("Parametric surface requires x, y, z expressions");for(var o=ThreeJSVisualizer_createFunctionFromExpression(s.expressions.x,"u","v"),a=ThreeJSVisualizer_createFunctionFromExpression(s.expressions.y,"u","v"),l=ThreeJSVisualizer_createFunctionFromExpression(s.expressions.z,"u","v"),c=s.uRange||[0,1],h=s.vRange||[0,1],u=new PlaneGeometry(1,1,50,50),d=u.attributes.position,p=new Vector3,f=0;f<d.count;f++){p.fromBufferAttribute(d,f);var m=c[0]+(p.x+.5)*(c[1]-c[0]),g=h[0]+(p.y+.5)*(h[1]-h[0]),_=void 0,v=void 0,y=void 0;try{_=o(m,g),v=a(m,g),y=l(m,g)}catch(t){_=v=y=0}d.setXYZ(f,_,v,y)}u.computeVertexNormals();var b=new MeshPhongMaterial({color:s.color||3182847,side:DoubleSide,flatShading:!1,shininess:50,wireframe:s.wireframe||!1}),A=new Mesh(u,b);return t.add(A),A}catch(t){return console.error("Error creating parametric surface:",t),null}}function createVectorField(t,e,i,r,n,s){try{if(!(s.expressions&&s.expressions.x&&s.expressions.y&&s.expressions.z))throw new Error("Vector field requires x, y, z component expressions");for(var o=ThreeJSVisualizer_createFunctionFromExpression(s.expressions.x,"x","y","z"),a=ThreeJSVisualizer_createFunctionFromExpression(s.expressions.y,"x","y","z"),l=ThreeJSVisualizer_createFunctionFromExpression(s.expressions.z,"x","y","z"),c=s.resolution||5,h=s.vectorScale||1,u=(i[1]-i[0])/c,d=(n[1]-n[0])/c,p=(r[1]-r[0])/c,f=new Group,m=0;m<=c;m++)for(var g=0;g<=c;g++)for(var _=0;_<=c;_++){var v=i[0]+m*u,y=n[0]+g*d,b=r[0]+_*p,A=o(v,y,b),x=a(v,y,b),C=l(v,y,b),E=Math.sqrt(A*A+x*x+C*C);if(!(E<.01)){var M=new ArrowHelper(new Vector3(A/E*h,x/E*h,C/E*h).normalize(),new Vector3(v,y,b),h,getColorFromMagnitude(E));f.add(M)}}return t.add(f),f}catch(t){return console.error("Error creating vector field:",t),null}}function createScatterPlot3D(t,e,i,r,n){var s,o=new Group,a=_createForOfIteratorHelper(e);try{for(a.s();!(s=a.n()).done;){var l=s.value,c=new SphereGeometry(l.size||.2,16,16),h=new MeshLambertMaterial({color:new Color(l.color||3182847)}),u=new Mesh(c,h);if(u.position.set(l.x,l.y,l.z),o.add(u),l.label){var d=new SphereGeometry(.05,8,8),p=new MeshBasicMaterial({color:16711680}),f=new Mesh(d,p);f.position.set(l.x+.3,l.y+.3,l.z+.3),o.add(f)}}}catch(t){a.e(t)}finally{a.f()}return t.add(o),o}function ThreeJSVisualizer_createFunctionFromExpression(t){try{for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];var n=i.length>0?i:["x"],s=t.replace(/Math\./g,"").replace(/sin/g,"Math.sin").replace(/cos/g,"Math.cos").replace(/tan/g,"Math.tan").replace(/exp/g,"Math.exp").replace(/log/g,"Math.log").replace(/sqrt/g,"Math.sqrt").replace(/pow/g,"Math.pow").replace(/PI/g,"Math.PI");return _construct(Function,_toConsumableArray(n).concat(["return ".concat(s,";")]))}catch(t){return console.error("Error creating function from expression:",t),function(){return 0}}}function getColorFromMagnitude(t){var e=Math.max(0,Math.min(240-60*t,240));return new Color("hsl(".concat(e,", 100%, 50%)"))}const visualizers_ThreeJSVisualizer=null;var jxg=__webpack_require__(84),env=__webpack_require__(234),constants=__webpack_require__(156),utils_type=__webpack_require__(9);jxg.A.XML={cleanWhitespace:function(t){for(var e=t.firstChild;utils_type.A.exists(e);)3!==e.nodeType||/\S/.test(e.nodeValue)?1===e.nodeType&&this.cleanWhitespace(e):t.removeChild(e),e=e.nextSibling},parse:function(t){var e,i;return i="function"==typeof DOMParser||"object"==typeof DOMParser?DOMParser:function(){this.parseFromString=function(t){var e;return"function"==typeof ActiveXObject&&(e=new ActiveXObject("MSXML.DomDocument")).loadXML(t),e}},e=(new i).parseFromString(t,"text/xml"),this.cleanWhitespace(e),e}};const xml=jxg.A.XML;var utils_event=__webpack_require__(805),expect=__webpack_require__(320),math=__webpack_require__(174);math.A.ProbFuncs={MAXNUM:17014118346046923e22,SQRTH:.7071067811865476,SQRT2:1.4142135623730951,MAXLOG:708.3964185322641,P:[2.461969814735305e-10,.5641895648310689,7.463210564422699,48.63719709856814,196.5208329560771,526.4451949954773,934.5285271719576,1027.5518868951572,557.5353353693994],Q:[13.228195115474499,86.70721408859897,354.9377788878199,975.7085017432055,1823.9091668790973,2246.3376081871097,1656.6630919416134,557.5353408177277],R:[.5641895835477551,1.275366707599781,5.019050422511805,6.160210979930536,7.4097426995044895,2.9788666537210022],S:[2.2605286322011726,9.396035249380015,12.048953980809666,17.08144507475659,9.608968090632859,3.369076451000815],T:[9.604973739870516,90.02601972038427,2232.005345946843,7003.325141128051,55592.30130103949],U:[33.56171416475031,521.3579497801527,4594.323829709801,22629.000061389095,49267.39426086359],M:128,MINV:.0078125,expx2:function(t,e){var i,r,n,s;return t=Math.abs(t),e<0&&(t=-t),i=(n=this.MINV*Math.floor(this.M*t+.5))*n,r=2*n*(s=t-n)+s*s,e<0&&(i=-i,r=-r),i+r>this.MAXLOG?1/0:i=Math.exp(i)*Math.exp(r)},polevl:function(t,e,i){var r,n;if(utils_type.A.exists(e.reduce))return e.reduce((function(e,i){return e*t+i}),0);for(n=0,r=0;n<=i;n++)r=r*t+e[n];return r},p1evl:function(t,e,i){var r,n;if(utils_type.A.exists(e.reduce))return e.reduce((function(e,i){return e*t+i}),1);for(n=0,r=1;n<i;n++)r=r*t+e[n];return r},ndtr:function(t){var e,i,r;return e=t*this.SQRTH,(r=Math.abs(e))<1?i=.5+.5*this.erf(e):(i=.5*this.erfce(r),r=this.expx2(t,-1),i*=Math.sqrt(r),e>0&&(i=1-i)),i},_underflow:function(t){return console.log("erfc","UNDERFLOW"),t<0?2:0},erfc:function(t){var e,i,r,n,s;return(r=t<0?-t:t)<1?1-this.erf(t):(s=-t*t)<-this.MAXLOG?this._underflow(t):(s=this.expx2(t,-1),r<8?(e=this.polevl(r,this.P,8),i=this.p1evl(r,this.Q,8)):(e=this.polevl(r,this.R,5),i=this.p1evl(r,this.S,6)),n=s*e/i,t<0&&(n=2-n),0===n?this._underflow(t):n)},erfce:function(t){var e,i;return t<8?(e=this.polevl(t,this.P,8),i=this.p1evl(t,this.Q,8)):(e=this.polevl(t,this.R,5),i=this.p1evl(t,this.S,6)),e/i},erf:function(t){var e;return Math.abs(t)>1?1-this.erfc(t):(e=t*t,t*this.polevl(e,this.T,4)/this.p1evl(e,this.U,5))},s2pi:2.5066282746310007,P0:[-59.96335010141079,98.00107541859997,-56.67628574690703,13.931260938727968,-1.2391658386738125],Q0:[1.9544885833814176,4.676279128988815,86.36024213908905,-225.46268785411937,200.26021238006066,-82.03722561683334,15.90562251262117,-1.1833162112133],P1:[4.0554489230596245,31.525109459989388,57.16281922464213,44.08050738932008,14.684956192885803,2.1866330685079025,-.1402560791713545,-.03504246268278482,-.0008574567851546854],Q1:[15.779988325646675,45.39076351288792,41.3172038254672,15.04253856929075,2.504649462083094,-.14218292285478779,-.03808064076915783,-.0009332594808954574],P2:[3.2377489177694603,6.915228890689842,3.9388102529247444,1.3330346081580755,.20148538954917908,.012371663481782003,.00030158155350823543,26580697468673755e-22,6.239745391849833e-9],Q2:[6.02427039364742,3.6798356385616087,1.3770209948908132,.21623699359449663,.013420400608854318,.00032801446468212774,28924786474538068e-22,6.790194080099813e-9],ndtri:function(t){var e,i,r,n,s;return t<=0?-1/0:t>=1?1/0:(s=1,(i=t)>.8646647167633873&&(i=1-i,s=0),i>.1353352832366127?(e=(i-=.5)+i*((n=i*i)*this.polevl(n,this.P0,4)/this.p1evl(n,this.Q0,8)),e*=this.s2pi):(r=1/(e=Math.sqrt(-2*Math.log(i))),e=e-Math.log(e)/e-(e<8?r*this.polevl(r,this.P1,8)/this.p1evl(r,this.Q1,8):r*this.polevl(r,this.P2,8)/this.p1evl(r,this.Q2,8)),0!==s&&(e=-e),e))},erfi:function(t){return this.ndtri(.5*(t+1))*this.SQRTH}};const probfuncs=math.A.ProbFuncs;var ia=__webpack_require__(718);math.A.Extrapolate={upper:15,infty:1e4,wynnEps:function(t,e,i){var r,n,s,o,a;if(i[e]=t,0===e)a=t;else{for(s=0,r=e;r>0;r--)n=s,s=i[r-1],o=i[r]-s,Math.abs(o)<=1e-15?i[r-1]=1e20:i[r-1]=1*n+1/o;a=i[e%2]}return a},aitken:function(t,e,i){var r,n,s,o,a,l;if(i[e]=t,e<2)r=t;else{for(o=e/2,a=1;a<=o;a++)n=i[2+(l=e-2*a)]-2*i[l+1]+i[l],Math.abs(n)<1e-15?i[l]=1e20:(s=i[l]-i[l+1],i[l]-=s*s/n);r=i[e%2]}return r},brezinski:function(t,e,i){var r,n,s,o,a,l,c,h;if(i[e]=t,e<3)r=t;else{for(l=e/3,h=e,c=1;c<=l;c++)s=i[1+(h-=3)]-i[h],o=i[h+2]-i[h+1],n=(a=i[h+3]-i[h+2])*(o-s)-s*(a-o),Math.abs(n)<1e-15?i[h]=1e20:i[h]=i[h+1]-s*o*(a-o)/n;r=i[e%3]}return r},iteration:function(t,e,i,r,n){var s,o,a,l,c=NaN,h=[],u="finite",d=e;for(n=n||0,s=1;s<=this.upper;s++){if(o=i(t+(d=0===n?e/(s+1):.5*d),!0),a=this[r](o,s-1,h),isNaN(a)){u="NaN";break}if(0!==o&&a/o>this.infty){c=a,u="infinite";break}if(l=a-c,Math.abs(l)<1e-7)break;c=a}return[c,u,1-(s-1)/this.upper]},levin:function(t,e,i,r,n,s){var o,a,l,c;if(c=1/(r+e),n[e]=t/i,s[e]=1/i,e>0&&(n[e-1]=n[e]-n[e-1],s[e-1]=s[e]-s[e-1],e>1))for(l=(r+e-1)*c,o=2;o<=e;o++)a=(r+e-o)*Math.pow(l,o-2)*c,n[e-o]=n[e-o+1]-a*n[e-o],s[e-o]=s[e-o+1]-a*s[e-o],c*=l;return Math.abs(s[0])<1e-15?1e20:n[0]/s[0]},iteration_levin:function(t,e,i,r){var n,s,o,a,l,c,h,u=NaN,d=[],p=[],f="finite",m=e;for(r=r||0,a=i(t+e,!0),n=1;n<=this.upper;n++){if(l=(s=i(t+(m=0===r?e/(n+1):.5*m),!0))-a,h="u"==(Math.abs(l)<1?"u":"t")?(1+n)*l:l,a=s,c=(o=this.levin(s,n-1,h,1,d,p))-u,isNaN(o)){f="NaN";break}if(0!==s&&o/s>this.infty){u=o,f="infinite";break}if(Math.abs(c)<1e-7)break;u=o}return[u,f,1-(n-1)/this.upper]},limit:function(t,e,i){return this.iteration_levin(t,e,i,0)}};const extrapolate=math.A.Extrapolate;var geometry=__webpack_require__(40);math.A.Quadtree=function(t,e,i){e=e||{capacity:10,pointType:"coords"},this.config={},this.config.capacity=e.capacity||10,this.config.pointType=e.pointType||"coords",this.points=[],this.xlb=t[0],this.xub=t[2],this.ylb=t[3],this.yub=t[1],this.parent=i||null,this.northWest=null,this.northEast=null,this.southEast=null,this.southWest=null},utils_type.A.extend(math.A.Quadtree.prototype,{contains:function(t,e){return this.xlb<t&&t<=this.xub&&this.ylb<e&&e<=this.yub},insert:function(t){switch(this.config.pointType){case"coords":if(!this.contains(t.usrCoords[1],t.usrCoords[2]))return!1;break;case"object":if(!this.contains(t.x,t.y))return!1}return this.points.length<this.config.capacity&&null===this.northWest?(this.points.push(t),!0):(null===this.northWest&&this.subdivide(),!!(this.northWest.insert(t)||this.northEast.insert(t)||this.southEast.insert(t)||this.southWest.insert(t)))},subdivide:function(){var t=this.xlb+.5*(this.xub-this.xlb),e=this.ylb+.5*(this.yub-this.ylb);this.northWest=new math.A.Quadtree([this.xlb,this.yub,t,e],this.config,this),this.northEast=new math.A.Quadtree([t,this.yub,this.xub,e],this.config,this),this.southEast=new math.A.Quadtree([this.xlb,e,t,this.ylb],this.config,this),this.southWest=new math.A.Quadtree([t,e,this.xub,this.ylb],this.config,this)},_query:function(t,e){var i;if(this.contains(t,e)){if(null===this.northWest)return this;if(i=this.northWest._query(t,e))return i;if(i=this.northEast._query(t,e))return i;if(i=this.southEast._query(t,e))return i;if(i=this.southWest._query(t,e))return i}return!1},query:function(t,e){var i,r;return utils_type.A.exists(e)?(i=t,r=e):(i=t.usrCoords[1],r=t.usrCoords[2]),this._query(i,r)},hasPoint:function(t,e,i){var r,n,s;if(this.contains(t,e)){switch(s=this.points.length,this.config.pointType){case"coords":for(n=0;n<s;n++)if(geometry.A.distance([t,e],this.points[n].usrCoords.slice(1),2)<i)return!0;break;case"object":for(n=0;n<s;n++)if(geometry.A.distance([t,e],[this.points[n].x,this.points[n].y],2)<i)return!0}if(null===this.northWest)return!1;if(r=this.northWest.hasPoint(t,e,i))return r;if(r=this.northEast.hasPoint(t,e,i))return r;if(r=this.southEast.hasPoint(t,e,i))return r;if(r=this.southWest.hasPoint(t,e,i))return r}return!1},getAllPoints:function(){var t=[];return this.getAllPointsRecursive(t),t},getAllPointsRecursive(t){Array.prototype.push.apply(t,this.points.slice()),null!==this.northWest&&(this.northWest.getAllPointsRecursive(t),this.northEast.getAllPointsRecursive(t),this.southEast.getAllPointsRecursive(t),this.southWest.getAllPointsRecursive(t))}});const qdt=math.A.Quadtree;math.A.BoxQuadtree=function(t,e,i){var r,n,s,o;t--,this.depth=t,this.capacity=e,this.items=[],this.northWest=null,this.northEast=null,this.southEast=null,this.southWest=null,this.bbox=null,this.cx=null,this.cy=null,i&&(r=i[0],n=i[1],s=i[2],o=i[3],this.cx=.5*(r+s),this.cy=.5*(n+o),this.bbox=[r,n,s,o])},utils_type.A.extend(math.A.BoxQuadtree.prototype,{insert:function(t){var e,i,r,n,s,o,a,l,c,h,u,d=[],p=[],f=[],m=[];if(null===this.bbox){for(i=t.length,r=o=1/0,s=n=-1/0,e=0;e<t.length;e++)r=(a=t[e]).xlb<r?a.xlb:r,n=a.yub>n?a.yub:n,s=a.xub>s?a.xub:s,o=a.ylb<o?a.ylb:o;this.cx=.5*(r+s),this.cy=.5*(n+o),this.bbox=[r,n,s,o]}else r=this.bbox[0],n=this.bbox[1],s=this.bbox[2],o=this.bbox[3];if(0===this.depth||this.items.length+t.length<this.capacity)return this.items=this.items.concat(t),this;for(i=t.length,e=0;e<i;e++)l=(a=t[e]).xlb<=this.cx&&a.yub>this.cy,h=a.xlb<=this.cx&&a.ylb<=this.cy,c=a.xub>this.cx&&a.yub>this.cy,u=a.xub>this.cx&&a.ylb<=this.cy,l&&c&&u&&h?this.items.push(a):(l&&d.push(a),h&&f.push(a),c&&p.push(a),u&&m.push(a));return this.subdivide(d,f,p,m,r,n,s,o),this},insertItem:function(t){var e,i,r,n,s,o,a,l,c=[],h=[],u=[],d=[];return null===this.bbox?(e=n=1/0,r=i=-1/0,e=t.xlb<e?t.xlb:e,i=t.yub>i?t.yub:i,r=t.xub>r?t.xub:r,n=t.ylb<n?t.ylb:n,this.cx=.5*(e+r),this.cy=.5*(i+n),this.bbox=[e,i,r,n]):(e=this.bbox[0],i=this.bbox[1],r=this.bbox[2],n=this.bbox[3]),0===this.depth||this.items.length+1<this.capacity?(this.items.push(t),this):(s=t.xlb<=this.cx&&t.yub>this.cy,a=t.xlb<=this.cx&&t.ylb<=this.cy,o=t.xub>this.cx&&t.yub>this.cy,l=t.xub>this.cx&&t.ylb<=this.cy,s&&o&&l&&a?this.items.push(t):(s&&c.push(t),a&&u.push(t),o&&h.push(t),l&&d.push(t)),this.subdivide(c,u,h,d,e,i,r,n),this)},subdivide:function(t,e,i,r,n,s,o,a){return t.length>0&&(null===this.northWest&&(this.northWest=new JXG.Math.BoxQuadtree(this.depth,this.capacity,[n,s,this.cx,this.cy])),this.northWest.insert(t)),e.length>0&&(null===this.southWest&&(this.southWest=new JXG.Math.BoxQuadtree(this.depth,this.capacity,[n,this.cy,this.cx,a])),this.southWest.insert(e)),i.length>0&&(null===this.northEast&&(this.northEast=new JXG.Math.BoxQuadtree(this.depth,this.capacity,[this.cx,s,o,this.cy])),this.northEast.insert(i)),r.length>0&&(null===this.southEast&&(this.southEast=new JXG.Math.BoxQuadtree(this.depth,this.capacity,[this.cx,this.cy,o,a])),this.southEast.insert(r)),this},find:function(t){var e,i,r,n=[];for(i=this.items.length,e=0;e<i;e++)r=this.items[e],t[2]>=r.xlb&&t[0]<=r.xub&&t[3]<=r.yub&&t[1]>=r.ylb&&n.push(this.items[e]);return null!==this.northWest&&t[0]<=this.cx&t[1]>=this.cy&&utils_type.A.concat(n,this.northWest.find(t)),null!==this.southWest&&t[0]<=this.cx&t[3]<=this.cy&&utils_type.A.concat(n,this.southWest.find(t)),null!==this.northEast&&t[2]>=this.cx&t[1]>=this.cy&&utils_type.A.concat(n,this.northEast.find(t)),null!==this.southEast&&t[2]>=this.cx&t[3]<=this.cy&&utils_type.A.concat(n,this.southEast.find(t)),n},analyzeTree:function(){var t,e={number_items:this.items.length,depth:1};return null!==this.northWest&&(t=this.northWest.analyzeTree(),e.number_items+=t.number_items,e.depth=Math.max(e.depth,1+t.depth)),null!==this.southWest&&(t=this.southWest.analyzeTree(),e.number_items+=t.number_items,e.depth=Math.max(e.depth,1+t.depth)),null!==this.northEast&&(t=this.northEast.analyzeTree(),e.number_items+=t.number_items,e.depth=Math.max(e.depth,1+t.depth)),null!==this.southEast&&(t=this.southEast.analyzeTree(),e.number_items+=t.number_items,e.depth=Math.max(e.depth,1+t.depth)),e},plot:function(){var t,e=[],i=[];return e.push(this.bbox[0]),i.push(this.bbox[3]),e.push(this.bbox[2]),i.push(this.bbox[3]),e.push(this.bbox[2]),i.push(this.bbox[1]),e.push(this.bbox[0]),i.push(this.bbox[1]),e.push(this.bbox[0]),i.push(this.bbox[3]),e.push(NaN),i.push(NaN),null!==this.northWest&&(t=this.northWest.plot(),utils_type.A.concat(e,t[0]),utils_type.A.concat(i,t[1])),null!==this.northEast&&(t=this.northEast.plot(),utils_type.A.concat(e,t[0]),utils_type.A.concat(i,t[1])),null!==this.southEast&&(t=this.southEast.plot(),utils_type.A.concat(e,t[0]),utils_type.A.concat(i,t[1])),null!==this.southWest&&(t=this.southWest.plot(),utils_type.A.concat(e,t[0]),utils_type.A.concat(i,t[1])),[e,i]}});const bqdt=math.A.BoxQuadtree;var numerics=__webpack_require__(956);jxg.A.Math.Nlp={arr:function(t){return new Float64Array(t)},arr2:function(t,e){for(var i=0,r=new Array(t);i<t;)r[i]=this.arr(e),i++;return r},arraycopy:function(t,e,i,r,n){for(var s=0;s<n;)i[s+r]=t[s+e],s++},lastNumberOfEvaluations:0,GetLastNumberOfEvaluations:function(){return this.lastNumberOfEvaluations},Normal:0,MaxIterationsReached:1,DivergingRoundingErrors:2,FindMinimum:function(t,e,i,r,n,s,o,a,l){var c,h,u=i+2,d=this.arr(e+1),p=this;return this.lastNumberOfEvaluations=0,l&&console.log("Experimental feature 'testForRoundingErrors' is activated."),d[0]=0,this.arraycopy(r,0,d,1,e),h=function(e,i,r,n){var s,o,a=p.arr(e);return p.lastNumberOfEvaluations=p.lastNumberOfEvaluations+1,p.arraycopy(r,1,a,0,e),s=p.arr(i),o=t(e,i,a,s),p.arraycopy(s,0,n,1,i),o},c=this.cobylb(h,e,i,u,d,n,s,o,a,l),this.arraycopy(d,1,r,0,e),c},cobylb:function(t,e,i,r,n,s,o,a,l,c){var h,u,d,p,f,m,g,_,v,y,b,A,x,C,E,M,S,w,P,T,O,R,N,L,D,k,I,B,U,F=-1,j=0,V=0,z=e+1,G=i+1,H=s,Y=0,X=!1,W=!1,J=0,$=0,q=0,K=this.arr(1+r),Z=this.arr2(1+e,1+z),Q=this.arr2(1+e,1+e),tt=this.arr2(1+r,1+z),et=this.arr2(1+e,1+G),it=this.arr(1+e),rt=this.arr(1+e),nt=this.arr(1+e),st=this.arr(1+e),ot=this.arr(1+e);for(a>=2&&console.log("The initial value of RHO is "+H+" and PARMU is set to zero."),_=0,m=1/H,u=1;u<=e;++u)Z[u][z]=n[u],Z[u][u]=H,Q[u][u]=m;v=z,y=!1;t:for(;;){if(_>=l&&_>0){F=this.MaxIterationsReached;break t}for(++_,j=t(e,i,n,K),V=0,p=1;p<=i;++p)V=Math.max(V,-K[p]);if(_!==a-1&&3!==a||this.PrintIterationResult(_,j,V,n,e,a),K[G]=j,K[r]=V,b=!0,!y){for(b=!1,u=1;u<=r;++u)tt[u][v]=K[u];if(_<=z){if(v<=e)if(tt[G][z]<=j)n[v]=Z[v][z];else{for(Z[v][z]=n[v],p=1;p<=r;++p)tt[p][v]=tt[p][z],tt[p][z]=K[p];for(p=1;p<=v;++p){for(Z[v][p]=-H,m=0,u=p;u<=v;++u)m-=Q[u][p];Q[v][p]=m}}if(_<=e){n[v=_]+=H;continue t}}y=!0}e:for(;;){i:do{if(!b){for(A=tt[G][z]+Y*tt[r][z],x=z,d=1;d<=e;++d)(m=tt[G][d]+Y*tt[r][d])<A?(x=d,A=m):m===A&&0===Y&&tt[r][d]<tt[r][x]&&(x=d);if(x<=e){for(u=1;u<=r;++u)m=tt[u][z],tt[u][z]=tt[u][x],tt[u][x]=m;for(u=1;u<=e;++u){for(m=Z[u][x],Z[u][x]=0,Z[u][z]+=m,g=0,p=1;p<=e;++p)Z[u][p]-=m,g-=Q[p][u];Q[x][u]=g}}if(C=0,c)for(u=1;u<=e;++u)for(d=1;d<=e;++d)m=this.DOT_PRODUCT_ROW_COL(Q,u,Z,d,1,e)-(u===d?1:0),C=Math.max(C,Math.abs(m));if(C>.1){F=this.DivergingRoundingErrors;break t}for(p=1;p<=G;++p){for(K[p]=-tt[p][z],d=1;d<=e;++d)ot[d]=tt[p][d]+K[p];for(u=1;u<=e;++u)et[u][p]=(p===G?-1:1)*this.DOT_PRODUCT_ROW_COL(ot,-1,Q,u,1,e)}for(X=!0,J=.25*H,E=2.1*H,d=1;d<=e;++d){for(M=0,S=0,p=1;p<=e;++p)M+=Q[d][p]*Q[d][p],S+=Z[p][d]*Z[p][d];it[d]=1/Math.sqrt(M),rt[d]=Math.sqrt(S),(it[d]<J||rt[d]>E)&&(X=!1)}if(!y&&!X){for(v=0,m=E,d=1;d<=e;++d)rt[d]>m&&(v=d,m=rt[d]);if(0===v)for(d=1;d<=e;++d)it[d]<m&&(v=d,m=it[d]);for(m=.5*H*it[v],p=1;p<=e;++p)st[p]=m*Q[v][p];for(w=0,P=0,h=0,p=1;p<=G;++p)h=this.DOT_PRODUCT_ROW_COL(st,-1,et,p,1,e),p<G&&(m=tt[p][z],w=Math.max(w,-h-m),P=Math.max(P,h-m));for(T=Y*(w-P)>2*h?-1:1,m=0,u=1;u<=e;++u)st[u]=T*st[u],Z[u][v]=st[u],m+=Q[v][u]*st[u];for(p=1;p<=e;++p)Q[v][p]/=m;for(d=1;d<=e;++d){if(d!==v)for(m=this.DOT_PRODUCT_ROW_COL(Q,d,st,-1,1,e),p=1;p<=e;++p)Q[d][p]-=m*Q[v][p];n[d]=Z[d][z]+st[d]}continue t}if(!(W=this.trstlp(e,i,et,K,H,st))){for(m=0,p=1;p<=e;++p)m+=st[p]*st[p];if(m<.25*H*H){y=!0;break i}}for(h=0,O=0,K[G]=0,p=1;p<=G;++p)h=K[p]-this.DOT_PRODUCT_ROW_COL(st,-1,et,p,1,e),p<G&&(O=Math.max(O,h));if(Y<1.5*(R=($=tt[r][z]-O)>0?h/$:0))for(Y=2*R,a>=2&&console.log("Increase in PARMU to "+Y),N=tt[G][z]+Y*tt[r][z],d=1;d<=e;++d)if((m=tt[G][d]+Y*tt[r][d])<N||m===N&&0===Y&&tt[r][d]<tt[r][z])continue e;for(q=Y*$-h,p=1;p<=e;++p)n[p]=Z[p][z]+st[p];y=!0;continue t}for(b=!1,L=tt[G][z]+Y*tt[r][z]-(j+Y*V),0===Y&&j===tt[G][z]&&(q=$,L=tt[r][z]-V),D=L<=0?1:0,v=0,d=1;d<=e;++d)(m=Math.abs(this.DOT_PRODUCT_ROW_COL(Q,d,st,-1,1,e)))>D&&(v=d,D=m),nt[d]=m*it[d];for(k=1.1*H,f=0,d=1;d<=e;++d)if(nt[d]>=J||nt[d]>=it[d]){if(m=rt[d],L>0){for(m=0,p=1;p<=e;++p)m+=Math.pow(st[p]-Z[p][d],2);m=Math.sqrt(m)}m>k&&(f=d,k=m)}if(f>0&&(v=f),0!==v){for(m=0,u=1;u<=e;++u)Z[u][v]=st[u],m+=Q[v][u]*st[u];for(p=1;p<=e;++p)Q[v][p]/=m;for(d=1;d<=e;++d)if(d!==v)for(m=this.DOT_PRODUCT_ROW_COL(Q,d,st,-1,1,e),p=1;p<=e;++p)Q[d][p]-=m*Q[v][p];for(p=1;p<=r;++p)tt[p][v]=K[p];if(L>0&&L>=.1*q)continue e}}while(0);if(X){if(H<=o){F=this.Normal;break t}if(I=0,B=0,(H*=.5)<=1.5*o&&(H=o),Y>0){for(U=0,p=1;p<=G;++p){for(B=I=tt[p][z],u=1;u<=e;++u)I=Math.min(I,tt[p][u]),B=Math.max(B,tt[p][u]);p<=i&&I<.5*B&&(m=Math.max(B,0)-I,U=U<=0?m:Math.min(U,m))}0===U?Y=0:B-I<Y*U&&(Y=(B-I)/U)}a>=2&&console.log("Reduction in RHO to "+H+"  and PARMU = "+Y),2===a&&this.PrintIterationResult(_,tt[G][z],tt[r][z],this.COL(Z,z),e,a)}else y=!1}}switch(F){case this.Normal:if(a>=1&&console.log("%nNormal return from subroutine COBYLA%n"),W)return a>=1&&this.PrintIterationResult(_,j,V,n,e,a),F;break;case this.MaxIterationsReached:a>=1&&console.log("%nReturn from subroutine COBYLA because the MAXFUN limit has been reached.%n");break;case this.DivergingRoundingErrors:a>=1&&console.log("%nReturn from subroutine COBYLA because rounding errors are becoming damaging.%n")}for(p=1;p<=e;++p)n[p]=Z[p][z];return j=tt[G][z],V=tt[r][z],a>=1&&this.PrintIterationResult(_,j,V,n,e,a),F},trstlp:function(t,e,i,r,n,s){var o,a,l,c,h,u,d,p,f,m,g,_,v,y,b,A,x,C,E,M,S,w,P,T,O,R,N,L,D,k,I,B,U,F=0,j=0,V=0,z=this.arr2(1+t,1+t),G=this.arr(2+e),H=this.arr(2+e),Y=this.arr(1+t),X=this.arr(1+t),W=this.arr(2+e),J=this.arr(2+e),$=e,q=0;for(l=1;l<=t;++l)z[l][l]=1,s[l]=0;if(o=0,a=0,e>=1){for(c=1;c<=e;++c)r[c]>a&&(a=r[c],o=c);for(c=1;c<=e;++c)J[c]=c,H[c]=a-r[c]}h=!0;do{t:for(;;){(!h||h&&0===a)&&(o=$=e+1,J[$]=$,H[$]=0),h=!1,u=0,d=0,p=0,f=0;e:do{if(m=$===e?a:-this.DOT_PRODUCT_ROW_COL(s,-1,i,$,1,t),0===d||m<u?(u=m,j=q,d=3):q>j?(j=q,d=3):--d,0===d)break t;if(g=0,o<=q){if(o<q){_=J[o],v=H[o],c=o;do{for(A=J[b=c+1],x=this.DOT_PRODUCT(this.PART(this.COL(z,c),1,t),this.PART(this.COL(i,A),1,t)),F=math.A.hypot(x,G[b]),C=G[b]/F,E=x/F,G[b]=C*G[c],G[c]=F,l=1;l<=t;++l)F=C*z[l][b]+E*z[l][c],z[l][b]=C*z[l][c]-E*z[l][b],z[l][c]=F;J[c]=A,H[c]=H[b],c=b}while(c<q);J[c]=_,H[c]=v}if(--q,$>e)for(F=1/G[q],c=1;c<=t;++c)Y[c]=F*z[c][q];else for(F=this.DOT_PRODUCT_ROW_COL(Y,-1,z,q+1,1,t),c=1;c<=t;++c)Y[c]-=F*z[c][q+1]}else{for(A=J[o],c=1;c<=t;++c)X[c]=i[c][A];for(M=0,c=t;c>q;){for(x=0,S=0,l=1;l<=t;++l)x+=F=z[l][c]*X[l],S+=Math.abs(F);if(w=S+.1*Math.abs(x),P=S+.2*Math.abs(x),(S>=w||w>=P)&&(x=0),0===M)M=x;else for(b=c+1,C=x/(F=math.A.hypot(x,M)),E=M/F,M=F,l=1;l<=t;++l)F=C*z[l][c]+E*z[l][b],z[l][b]=C*z[l][b]-E*z[l][c],z[l][c]=F;--c}if(0===M){g=-1,c=q;do{for(T=0,O=0,l=1;l<=t;++l)T+=F=z[l][c]*X[l],O+=Math.abs(F);if(w=O+.1*Math.abs(T),P=O+.2*Math.abs(T),O<w&&w<P){if((F=T/G[c])>0&&J[c]<=e&&(U=H[c]/F,(g<0||U<g)&&(g=U)),c>=2)for(R=J[c],l=1;l<=t;++l)X[l]-=F*i[l][R];W[c]=F}else W[c]=0}while(--c>0);if(g<0)break t;for(c=1;c<=q;++c)H[c]=Math.max(0,H[c]-g*W[c]);if(o<q){_=J[o],v=H[o],c=o;do{for(R=J[b=c+1],x=this.DOT_PRODUCT(this.PART(this.COL(z,c),1,t),this.PART(this.COL(i,R),1,t)),F=math.A.hypot(x,G[b]),C=G[b]/F,E=x/F,G[b]=C*G[c],G[c]=F,l=1;l<=t;++l)F=C*z[l][b]+E*z[l][c],z[l][b]=C*z[l][c]-E*z[l][b],z[l][c]=F;J[c]=R,H[c]=H[b],c=b}while(c<q);J[c]=_,H[c]=v}if(0===(F=this.DOT_PRODUCT(this.PART(this.COL(z,q),1,t),this.PART(this.COL(i,A),1,t))))break t;G[q]=F,H[o]=0,H[q]=g}else G[++q]=M,H[o]=H[q],H[q]=0;if(J[o]=J[q],J[q]=A,$>e&&A!==$){for(c=q-1,x=this.DOT_PRODUCT(this.PART(this.COL(z,c),1,t),this.PART(this.COL(i,A),1,t)),F=math.A.hypot(x,G[q]),C=G[q]/F,E=x/F,G[q]=C*G[c],G[c]=F,l=1;l<=t;++l)F=C*z[l][q]+E*z[l][c],z[l][q]=C*z[l][c]-E*z[l][q],z[l][c]=F;J[q]=J[c],J[c]=A,F=H[c],H[c]=H[q],H[q]=F}if($>e)for(F=1/G[q],c=1;c<=t;++c)Y[c]=F*z[c][q];else for(A=J[q],F=(this.DOT_PRODUCT_ROW_COL(Y,-1,i,A,1,t)-1)/G[q],c=1;c<=t;++c)Y[c]-=F*z[c][q]}for(N=n*n,D=0,L=0,l=1;l<=t;++l)Math.abs(s[l])>=1e-6*n&&(N-=s[l]*s[l]),D+=s[l]*Y[l],L+=Y[l]*Y[l];if(N<=0)break t;if(F=Math.sqrt(L*N),Math.abs(D)>=1e-6*F&&(F=Math.sqrt(L*N+D*D)),p=f=N/(F+D),$===e){if(P=p+.2*a,p>=(w=p+.1*a)||w>=P)break e;p=Math.min(p,a)}for(c=1;c<=t;++c)X[c]=s[c]+p*Y[c];if($===e)for(V=a,a=0,c=1;c<=q;++c)F=r[A=J[c]]-this.DOT_PRODUCT_ROW_COL(X,-1,i,A,1,t),a=Math.max(a,F);c=q;do{for(k=0,I=0,l=1;l<=t;++l)k+=F=z[l][c]*X[l],I+=Math.abs(F);if(w=I+.1*Math.abs(k),P=I+.2*Math.abs(k),(I>=w||w>=P)&&(k=0),W[c]=k/G[c],c>=2)for(A=J[c],l=1;l<=t;++l)X[l]-=W[c]*i[l][A]}while(c-- >=2);for($>e&&(W[q]=Math.max(0,W[q])),c=1;c<=t;++c)X[c]=s[c]+p*Y[c];if($>q)for(c=q+1;c<=$;++c){for(y=a-r[A=J[c]],B=a+Math.abs(r[A]),l=1;l<=t;++l)y+=F=i[l][A]*X[l],B+=Math.abs(F);w=B+.1*Math.abs(y),P=B+.2*Math.abs(y),(B>=w||w>=P)&&(y=0),W[c]=y}for(g=1,o=0,c=1;c<=$;++c)W[c]<0&&(F=H[c]/(H[c]-W[c]))<g&&(g=F,o=c);for(F=1-g,c=1;c<=t;++c)s[c]=F*s[c]+g*X[c];for(c=1;c<=$;++c)H[c]=Math.max(0,F*H[c]+g*W[c]);$===e&&(a=V+g*(a-V))}while(o>0);if(p===f)return!0}}while($===e);return!1},PrintIterationResult:function(t,e,i,r,n,s){s>1&&console.log("NFVALS = "+t+"  F = "+e+"  MAXCV = "+i),s>1&&console.log("X = "+this.PART(r,1,n))},ROW:function(t,e){return t[e].slice()},COL:function(t,e){var i,r=t.length,n=[];for(i=0;i<r;++i)n[i]=t[i][e];return n},PART:function(t,e,i){return t.slice(e,i+1)},FORMAT:function(t){return t.join(",")},DOT_PRODUCT:function(t,e){var i,r=0,n=t.length;for(i=0;i<n;++i)r+=t[i]*e[i];return r},DOT_PRODUCT_ROW_COL:function(t,e,i,r,n,s){var o,a=0;if(-1===e)for(o=n;o<=s;++o)a+=t[o]*i[o][r];else if(-1===r)for(o=n;o<=s;++o)a+=t[e][o]*i[o];else for(o=n;o<=s;++o)a+=t[e][o]*i[o][r];return a}};const nlp=jxg.A.Math.Nlp;var base_coords=__webpack_require__(159),statistics=__webpack_require__(959);math.A.Plot={checkReal:function(t){var e,i,r=!1,n=t.length;for(e=0;e<n;e++)if(i=t[e].usrCoords,!isNaN(i[1])&&!isNaN(i[2])&&Math.abs(i[0])>math.A.eps){r=!0;break}return r},updateParametricCurveNaive:function(t,e,i,r){var n,s,o=!1,a=(i-e)/r;for(n=0;n<r;n++)s=e+n*a,t.points[n].setCoordinates(constants.A.COORDS_BY_USER,[t.X(s,o),t.Y(s,o)],!1),t.points[n]._t=s,o=!0;return t},isSegmentOutside:function(t,e,i,r,n){return e<0&&r<0||e>n.canvasHeight&&r>n.canvasHeight||t<0&&i<0||t>n.canvasWidth&&i>n.canvasWidth},isDistOK:function(t,e,i,r){return Math.abs(t)<i&&Math.abs(e)<r&&!isNaN(t+e)},isSegmentDefined:function(t,e,i,r){return!(isNaN(t+e)&&isNaN(i+r))},updateParametricCurveOld:function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p,f=!1,m=new base_coords.A(constants.A.COORDS_BY_USER,[0,0],t.board,!1),g=[],_=[],v=[],y=[],b=!1,A=0,x=function(t,e,i){var r,n=i[1]-t[1],s=i[2]-t[2],o=e[0]-t[1],a=e[1]-t[2],l=o*o+a*a;return l>=math.A.eps&&(r=(n*o+s*a)/l)>0&&(r<=1?(n-=r*o,s-=r*a):(n-=o,s-=a)),math.A.hypot(n,s)};for(jxg.A.deprecated("Curve.updateParametricCurveOld()"),t.board.updateQuality===t.board.BOARD_QUALITY_LOW?(u=15,d=10,p=10):(u=21,d=.7,p=.7),y[0]=i-e,r=1;r<u;r++)y[r]=.5*y[r-1];r=1,g[0]=1,_[0]=0,n=e,m.setCoordinates(constants.A.COORDS_BY_USER,[t.X(n,f),t.Y(n,f)],!1),f=!0,a=m.scrCoords[1],l=m.scrCoords[2],n=i,m.setCoordinates(constants.A.COORDS_BY_USER,[t.X(n,f),t.Y(n,f)],!1),s=m.scrCoords[1],o=m.scrCoords[2],v[0]=[s,o],c=1,h=0,t.points=[],t.points[A++]=new base_coords.A(constants.A.COORDS_BY_SCREEN,[a,l],t.board,!1);do{for(b=this.isDistOK(s-a,o-l,d,p)||this.isSegmentOutside(a,l,s,o,t.board);h<u&&(!b||h<6)&&(h<=7||this.isSegmentDefined(a,l,s,o));)g[c]=r,_[c]=h,v[c]=[s,o],c+=1,n=e+(r=2*r-1)*y[++h],m.setCoordinates(constants.A.COORDS_BY_USER,[t.X(n,f),t.Y(n,f)],!1,!0),s=m.scrCoords[1],o=m.scrCoords[2],b=this.isDistOK(s-a,o-l,d,p)||this.isSegmentOutside(a,l,s,o,t.board);A>1&&x(t.points[A-2].scrCoords,[s,o],t.points[A-1].scrCoords)<.015&&(A-=1),t.points[A]=new base_coords.A(constants.A.COORDS_BY_SCREEN,[s,o],t.board,!1),t.points[A]._t=n,A+=1,a=s,l=o,s=v[c-=1][0],o=v[c][1],h=_[c]+1,r=2*g[c]}while(c>0&&A<5e5);return t.numberPoints=t.points.length,t},_insertPoint_v2:function(t,e,i){var r=!isNaN(this._lastCrds[1]+this._lastCrds[2]),n=!isNaN(e.scrCoords[1]+e.scrCoords[2]),s=t.board.canvasWidth,o=t.board.canvasHeight;(!(n=n&&e.scrCoords[1]>-500&&e.scrCoords[2]>-500&&e.scrCoords[1]<s+500&&e.scrCoords[2]<o+500)&&r||n&&(!r||Math.abs(e.scrCoords[1]-this._lastCrds[1])>.7||Math.abs(e.scrCoords[2]-this._lastCrds[2])>.7))&&(e._t=i,t.points.push(e),this._lastCrds=e.copy("scrCoords"))},neighborhood_isNaN_v2:function(t,e){var i,r,n=new base_coords.A(constants.A.COORDS_BY_USER,[0,0],t.board,!1);return i=e+math.A.eps,n.setCoordinates(constants.A.COORDS_BY_USER,[t.X(i,!0),t.Y(i,!0)],!1),r=n.usrCoords,!(!isNaN(r[1]+r[2])&&(i=e-math.A.eps,n.setCoordinates(constants.A.COORDS_BY_USER,[t.X(i,!0),t.Y(i,!0)],!1),r=n.usrCoords,!isNaN(r[1]+r[2])))},_borderCase:function(t,e,i,r,n,s,o,a){var l,c,h,u,d,p,f=null,m=!1;if(a<=1){if(c=new base_coords.A(constants.A.COORDS_BY_USER,[0,0],t.board,!1),isNaN(e[1]+e[2])&&!isNaN(r[1]+r[2])&&!this.neighborhood_isNaN_v2(t,n))return!1;if(isNaN(i[1]+i[2])&&!isNaN(r[1]+r[2])&&!this.neighborhood_isNaN_v2(t,s))return!1;if(isNaN(r[1]+r[2])&&(!isNaN(e[1]+e[2])||!isNaN(i[1]+i[2]))&&!this.neighborhood_isNaN_v2(t,o))return!1;u=0;do{if(isNaN(e[1]+e[2])&&!isNaN(r[1]+r[2]))d=n,p=o;else if(isNaN(i[1]+i[2])&&!isNaN(r[1]+r[2]))d=s,p=o;else if(isNaN(r[1]+r[2])&&!isNaN(i[1]+i[2]))d=o,p=s;else{if(!isNaN(r[1]+r[2])||isNaN(e[1]+e[2]))return!1;d=o,p=n}l=.5*(d+p),c.setCoordinates(constants.A.COORDS_BY_USER,[t.X(l,!0),t.Y(l,!0)],!1),h=c.usrCoords,(m=isNaN(h[1]+h[2]))?d=l:p=l,++u}while(m&&u<30);if(u<30&&(f=h.slice(),r=h.slice(),p=l),null!==f)return this._insertPoint_v2(t,new base_coords.A(constants.A.COORDS_BY_USER,f,t.board,!1)),!0}return!1},_plotRecursive_v2:function(t,e,i,r,n,s,o){var a,l,c,h,u,d=0,p=new base_coords.A(constants.A.COORDS_BY_USER,[0,0],t.board,!1);if(!(t.numberPoints>65536))return s<this.nanLevel&&this._isUndefined(t,e,i,r,n)||s<this.nanLevel&&this._isOutside(e,i,r,n,t.board)||(a=.5*(i+n),p.setCoordinates(constants.A.COORDS_BY_USER,[t.X(a,!0),t.Y(a,!0)],!1),l=p.scrCoords,this._borderCase(t,e,r,l,i,n,a,s)||(c=this._triangleDists(e,r,l),h=s<this.smoothLevel&&c[3]<o,u=s<=this.jumpLevel&&(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))||s<this.jumpLevel&&(c[2]>.99*c[0]||c[1]>.99*c[0]||c[0]===1/0||c[1]===1/0||c[2]===1/0),s<this.smoothLevel+2&&c[0]<.5*(c[1]+c[2])&&(d=0,h=!1),--s,u?this._insertPoint_v2(t,new base_coords.A(constants.A.COORDS_BY_SCREEN,[NaN,NaN],t.board,!1),a):s<=d||h?this._insertPoint_v2(t,p,a):(this._plotRecursive_v2(t,e,i,l,a,s,o),isNaN(p.scrCoords[1]+p.scrCoords[2])||this._insertPoint_v2(t,p,a),this._plotRecursive_v2(t,l,a,r,n,s,o)))),this},updateParametricCurve_v2:function(t,e,i){var r,n,s,o,a,l,c,h,u,d=!1,p=new base_coords.A(constants.A.COORDS_BY_USER,[0,0],t.board,!1),f=new base_coords.A(constants.A.COORDS_BY_USER,[0,0],t.board,!1);return t.board.updateQuality===t.board.BOARD_QUALITY_LOW?(a=t.evalVisProp("recursiondepthlow")||13,l=2,this.smoothLevel=a-6,this.jumpLevel=3):(a=t.evalVisProp("recursiondepthhigh")||17,l=2,this.smoothLevel=a-9,this.jumpLevel=2),this.nanLevel=a-4,t.points=[],"x"===this.xterm?(c=.3*((h=t.board.getBoundingBox())[2]-h[0]),r=Math.max(e,h[0]-c),n=Math.min(i,h[2]+c)):(r=e,n=i),p.setCoordinates(constants.A.COORDS_BY_USER,[t.X(r,d),t.Y(r,d)],!1),d=!0,f.setCoordinates(constants.A.COORDS_BY_USER,[t.X(n,d),t.Y(n,d)],!1),u=this._findStartPoint(t,p.scrCoords,r,f.scrCoords,n),p.setCoordinates(constants.A.COORDS_BY_SCREEN,u[0],!1),r=u[1],u=this._findStartPoint(t,f.scrCoords,n,p.scrCoords,r),f.setCoordinates(constants.A.COORDS_BY_SCREEN,u[0],!1),n=u[1],this._visibleArea=[r,n],s=p.copy("scrCoords"),o=f.copy("scrCoords"),p._t=r,t.points.push(p),this._lastCrds=p.copy("scrCoords"),this._plotRecursive_v2(t,s,r,o,n,a,l),f._t=n,t.points.push(f),t.numberPoints=t.points.length,t},_insertLimesPoint:function(t,e,i,r,n){var s,o,a;Math.abs(this._lastUsrCrds[1])===1/0&&Math.abs(n.left_x)===1/0||Math.abs(this._lastUsrCrds[2])===1/0&&Math.abs(n.left_y)===1/0||((s=new base_coords.A(constants.A.COORDS_BY_USER,[n.left_x,n.left_y],t.board))._t=i,t.points.push(s),isNaN(n.left_x)||isNaN(n.left_y)||isNaN(n.right_x)||isNaN(n.right_y)||!(Math.abs(n.left_x-n.right_x)>math.A.eps||Math.abs(n.left_y-n.right_y)>math.A.eps)||((o=new base_coords.A(constants.A.COORDS_BY_SCREEN,e,t.board))._t=i,t.points.push(o)),(a=new base_coords.A(constants.A.COORDS_BY_USER,[n.right_x,n.right_y],t.board))._t=i,t.points.push(a),this._lastScrCrds=a.copy("scrCoords"),this._lastUsrCrds=a.copy("usrCoords"))},_insertPoint:function(t,e,i,r,n){var s,o=!isNaN(this._lastScrCrds[1]+this._lastScrCrds[2]),a=!isNaN(e[1]+e[2]),l=t.board.canvasWidth,c=t.board.canvasHeight;utils_type.A.exists(n)?this._insertLimesPoint(t,e,i,r,n):(a=a&&e[1]>-500&&e[2]>-500&&e[1]<l+500&&e[2]<c+500,(o||a)&&(a&&o&&Math.abs(e[1]-this._lastScrCrds[1])<.8&&Math.abs(e[2]-this._lastScrCrds[2])<.8||Math.abs(e[1])===1/0&&Math.abs(this._lastUsrCrds[1])===1/0||Math.abs(e[2])===1/0&&Math.abs(this._lastUsrCrds[2])===1/0||((s=new base_coords.A(constants.A.COORDS_BY_SCREEN,e,t.board))._t=i,t.points.push(s),this._lastScrCrds=s.copy("scrCoords"),this._lastUsrCrds=s.copy("usrCoords"))))},_triangleDists:function(t,e,i){var r;return r=[t[0]*e[0],.5*(t[1]+e[1]),.5*(t[2]+e[2])],[geometry.A.distance(t,e,3),geometry.A.distance(t,i,3),geometry.A.distance(i,e,3),geometry.A.distance(i,r,3)]},_isUndefined:function(t,e,i,r,n){var s,o,a;if(!isNaN(e[1]+e[2])||!isNaN(r[1]+r[2]))return!1;for(a=new base_coords.A(constants.A.COORDS_BY_USER,[0,0],t.board,!1),o=0;o<20;++o)if(s=i+Math.random()*(n-i),a.setCoordinates(constants.A.COORDS_BY_USER,[t.X(s,!0),t.Y(s,!0)],!1),!isNaN(a.scrCoords[0]+a.scrCoords[1]+a.scrCoords[2]))return!1;return!0},_isOutside:function(t,e,i,r,n){var s=500,o=n.canvasWidth,a=n.canvasHeight;return!!(t[1]<-500&&i[1]<-500||t[2]<-500&&i[2]<-500||t[1]>o+s&&i[1]>o+s||t[2]>a+s&&i[2]>a+s)},_isOutsidePoint:function(t,e){var i=e.canvasWidth,r=e.canvasHeight;return!!(t[1]<-500||t[2]<-500||t[1]>i+500||t[2]>r+500)},_findStartPoint:function(t,e,i,r,n){return[e,i]},_getBorderPos:function(t,e,i,r,n,s,o){var a,l,c,h,u,d;if(l=new base_coords.A(constants.A.COORDS_BY_USER,[0,0],t.board,!1),h=0,isNaN(i[1]+i[2])&&!isNaN(n[1]+n[2]))d=e,u=r;else if(isNaN(o[1]+o[2])&&!isNaN(n[1]+n[2]))d=s,u=r;else if(isNaN(n[1]+n[2])&&!isNaN(o[1]+o[2]))d=r,u=s;else{if(!isNaN(n[1]+n[2])||isNaN(i[1]+i[2]))return!1;d=r,u=e}do{a=.5*(u+d),l.setCoordinates(constants.A.COORDS_BY_USER,[t.X(a,!0),t.Y(a,!0)],!1),c=l.usrCoords,isNaN(c[1]+c[2])?d=a:u=a,++h}while(h<30&&Math.abs(u-d)>math.A.eps);return a},_getCuspPos:function(t,e,i){var r=[t.X(e,!0),t.Y(e,!0)],n=[t.X(i,!0),t.Y(i,!0)];return numerics.A.fminbr((function(e){var i=[t.X(e,!0),t.Y(e,!0)];return-(math.A.hypot(r[0]-i[0],r[1]-i[1])+math.A.hypot(n[0]-i[0],n[1]-i[1]))}),[e,i],t)},_getJumpPos:function(t,e,i){return numerics.A.fminbr((function(e){var i=math.A.eps*math.A.eps,r=[t.X(e,!0),t.Y(e,!0)],n=[t.X(e+i,!0),t.Y(e+i,!0)];return-Math.abs((n[1]-r[1])/(n[0]-r[0]))}),[e,i],t)},_getLimits:function(t,e){var i,r,n,s,o,a=2/(t.maxX()-t.minX());return r=(i=extrapolate.limit(e,-a,t.X))[0],"infinite"===i[1]&&(r=Math.sign(r)*(1/0)),s=(i=extrapolate.limit(e,-a,t.Y))[0],"infinite"===i[1]&&(s=Math.sign(s)*(1/0)),n=(i=extrapolate.limit(e,a,t.X))[0],"infinite"===i[1]&&(n=Math.sign(n)*(1/0)),o=(i=extrapolate.limit(e,a,t.Y))[0],"infinite"===i[1]&&(o=Math.sign(o)*(1/0)),{left_x:r,left_y:s,right_x:n,right_y:o,t:e}},_getLimes:function(t,e,i,r,n,s,o,a,l){var c;return"border"===a?c=this._getBorderPos(t,e,i,r,n,s,o):"cusp"===a?c=this._getCuspPos(t,e,s):"jump"===a&&(c=this._getJumpPos(t,e,s)),this._getLimits(t,c)},_plotNonRecursive:function(t,e,i,r,n,s){var o,a,l,c,h,u,d,p,f,m,g,_=null,v=!1,y="",b=[],A=0;for(p=t.board.origin.scrCoords,b[A++]=[e,i,r,n,s,1/0];A>0;){if(e=(g=b[--A])[0],i=g[1],r=g[2],n=g[3],f=g[4],m=g[5],v=!1,y="",_=null,t.points.length>65536)return;if(f<this.nanLevel){if(this._isUndefined(t,e,i,r,n))continue;if(this._isOutside(e,i,r,n,t.board))continue}o=.5*(i+n),u=t.X(o,!0),d=t.Y(o,!0),a=[1,p[1]+u*t.board.unitX,p[2]-d*t.board.unitY],l=this._triangleDists(e,r,a),c=isNaN(e[1]+e[2]),h=isNaN(r[1]+r[2]),c&&!h||!c&&h?y="border":l[0]>.66*m||l[0]<this.cusp_threshold*(l[1]+l[2])||l[1]>5*l[2]||l[2]>5*l[1]?y="cusp":(l[2]>this.jump_threshold*l[0]||l[1]>this.jump_threshold*l[0]||l[0]===1/0||l[1]===1/0||l[2]===1/0)&&(y="jump"),v=""===y&&f<this.smoothLevel&&l[3]<this.smooth_threshold,f<this.testLevel&&!v&&(""===y?v=!0:_=this._getLimes(t,i,e,o,a,n,r,y,f)),null!==_?(a=[1,NaN,NaN],this._insertPoint(t,a,o,f,_)):f<=0||v?this._insertPoint(t,a,o,f,null):(b[A++]=[a,o,r,n,f-1,l[0]],b[A++]=[e,i,a,o,f-1,l[0]])}return this},updateParametricCurve_v3:function(t,e,i){var r,n,s,o,a,l,c,h,u=!1,d=new base_coords.A(constants.A.COORDS_BY_USER,[0,0],t.board,!1),p=new base_coords.A(constants.A.COORDS_BY_USER,[0,0],t.board,!1);return a=t.board.updateQuality===t.board.BOARD_QUALITY_LOW?t.evalVisProp("recursiondepthlow")||14:t.evalVisProp("recursiondepthhigh")||17,this.smoothLevel=7,this.nanLevel=a-4,this.testLevel=4,this.cusp_threshold=.5,this.jump_threshold=.99,this.smooth_threshold=2,t.points=[],"x"===t.xterm?(l=.3*((c=t.board.getBoundingBox())[2]-c[0]),r=Math.max(e,c[0]-l),n=Math.min(i,c[2]+l)):(r=e,n=i),d.setCoordinates(constants.A.COORDS_BY_USER,[t.X(r,u),t.Y(r,u)],!1),u=!0,p.setCoordinates(constants.A.COORDS_BY_USER,[t.X(n,u),t.Y(n,u)],!1),h=this._findStartPoint(t,d.scrCoords,r,p.scrCoords,n),d.setCoordinates(constants.A.COORDS_BY_SCREEN,h[0],!1),r=h[1],h=this._findStartPoint(t,p.scrCoords,n,d.scrCoords,r),p.setCoordinates(constants.A.COORDS_BY_SCREEN,h[0],!1),n=h[1],this._visibleArea=[r,n],s=d.copy("scrCoords"),o=p.copy("scrCoords"),d._t=r,t.points.push(d),this._lastScrCrds=d.copy("scrCoords"),this._lastUsrCrds=d.copy("usrCoords"),this._plotNonRecursive(t,s,r,o,n,a),p._t=n,t.points.push(p),t.numberPoints=t.points.length,t},_criticalInterval:function(t,e,i){var r,n,s,o,a,l,c,h=!1,u=-1/0,d=!1,p=!1,f=0,m=[],g=[],_=[];for(c=statistics.A.abs(t),(o=statistics.A.median(c))<1e-7?(o=1e-7,d=!0):o*=this.criticalThreshold,r=0;r<e;r++)c[r]>o?(_.push({i:r,v:t[r],group:f}),u=r,h||(h=!0)):h&&r>u+4&&(_.length>0&&m.push(_.slice(0)),_=[],h=!1,f++);for(h&&_.length>1&&m.push(_.slice(0)),d&&0===m.length&&(p=!0),n=0;n<m.length;n++)if(g[n]="point",!((s=m[n].length)<64)){for(l=0,a=Math.sign(m[n][0].v),r=1;r<s;r++)Math.sign(m[n][r].v)!==a&&(l++,a=Math.sign(m[n][r].v));6*l>s&&(g[n]="interval")}return{smooth:p,groups:m,types:g}},Component:function(){this.left_isNaN=!1,this.right_isNaN=!1,this.left_t=null,this.right_t=null,this.t_values=[],this.x_values=[],this.y_values=[],this.len=0},findComponents:function(t,e,i,r){var n,s,o,a,l,c,h=[],u=0,d=0,p=0,f=!1,m=!1;for(o=(i-e)/r,h[u]=new this.Component,c=h[u],n=0,s=e;n<=r;n++,s+=o)a=t.X(s,m),l=t.Y(s,m),isNaN(a)||isNaN(l)?++p>1&&f&&(c.right_isNaN=!0,c.right_t=s-o,c.len=d,f=!1,h[++u]=new this.Component,c=h[u],p=0):(f||(f=!0,d=0,p>0&&(c.left_t=s-o,c.left_isNaN=!0)),p=0,c.t_values[d]=s,c.x_values[d]=a,c.y_values[d]=l,d++),0===n&&(m=!0);return f?c.len=d:h.pop(),h},getPointType:function(t,e,i,r,n,s,o){var a=n[0],l=s[0],c=r.length,h={idx:e,t:i,x:a[e],y:l[e],type:"other"};return e<5?(h.type="borderleft",h.idx=0,h.t=r[0],h.x=a[0],h.y=l[0],h):e>o-6?(h.type="borderright",h.idx=c-1,h.t=r[c-1],h.x=a[c-1],h.y=l[c-1],h):h},newtonApprox:function(t,e,i,r,n){var s,o=0;for(s=r;s>0;s--)o=(o+n[s][t])*(e-(s-1)*i)/s;return o+n[0][t]},thiele:function(t,e,i,r,n){var s,o=0;for(s=n;s>1;s--)o=(t-i[r+s])/(e[s][r+1]-e[s-2][r+1]+o);return e[0][r+1]+(t-i[r+1])/(e[1][r+1]+o)},differenceMethodExperiments:function(t,e){var i,r,n,s,o,a,l,c,h,u,d,p=t.t_values,f=t.x_values,m=t.y_values,g=[],_=[],v=[],y=[],b=[],A=[],x=[],C=[],E=0,M=[];for(o=p[1]-p[0],b.push([]),A.push([]),x.push([]),C.push([]),n=m.length,i=0;i<n;i++)b[0][i]=f[i],A[0][i]=m[i],x[0][i]=f[i],C[0][i]=m[i];for(b.push([]),A.push([]),x.push([]),C.push([]),a=o,n=m.length-1,i=0;i<n;i++)g[i]=f[i+1]-f[i],_[i]=m[i+1]-m[i],v[i]=g[i],y[i]=_[i],b[1][i]=g[i],A[1][i]=_[i],x[1][i]=a/g[i],C[1][i]=a/_[i];for(n--,s=Math.min(8,m.length-1),r=1;r<s;r++){for(b.push([]),A.push([]),x.push([]),C.push([]),a*=o,i=0;i<n;i++)g[i]=g[i+1]-g[i],_[i]=_[i+1]-_[i],b[r+1][i]=g[i],A[r+1][i]=_[i],x[r+1][i]=a/(x[r][i+1]-x[r][i])+x[r-1][i+1],C[r+1][i]=a/(C[r][i+1]-C[r][i])+C[r-1][i+1];if(!1===(d=this._criticalPoints(_,n,r))){console.log("Polynomial of degree",r),d=[];break}if(d.length>0&&++E>1&&r%2==0)break;n--}for(i=0;i<d.length;i++){for(c=-1/0,h=0;h<d[i].length;h++)(u=Math.abs(d[i][h].v))>c&&(c=u,l=h);l=Math.floor(d[i][l].i+r/2),M.push(this.getPointType(e,l,p,f,m,v,y,n+1))}return[M,b,A,x,C]},getCenterOfCriticalInterval:function(t,e,i){var r,n,s,o,a,l=0,c=0,h=i[1]-i[0],u=[];for(r=-1/0,u=[],n=0;n<t.length;n++)(o=Math.abs(t[n].v))>r?(u=[n],r=o,s=n):r===o&&u.push(n);if(u.length>0&&(a=u.reduce((function(t,e){return t+e}),0)/u.length,s=Math.floor(a),a+=t[0].i),r<1/0){for(n=0;n<t.length;n++)l+=Math.abs(t[n].v)*t[n].i,c+=Math.abs(t[n].v);a=l/c}return a+=e/2,[t[s].i+e/2,a,i[Math.floor(a)]+h*(a-Math.floor(a))]},differenceMethod:function(t,e){var i,r,n,s,o,a,l,c,h,u,d=t.t_values,p=t.x_values,f=t.y_values,m=[],g=[],_=0,v=-1,y=-1,b=[],A=[];for(n=f.length,m.push(new Float64Array(p)),g.push(new Float64Array(f)),n--,s=Math.min(12,n),r=0;r<s&&(m.push(new Float64Array(n)),g.push(new Float64Array(n)),m[r+1]=m[r].map((function(t,e,i){return i[e+1]-t})),g[r+1]=g[r].map((function(t,e,i){return i[e+1]-t})),!0===(c=this._criticalInterval(g[r+1],n,r)).smooth&&(y=r,b=[]),l=this._criticalInterval(m[r+1],n,r),-1===v&&!0===l.smooth&&(v=r),!(y>=0));r++){if(c.groups.length>0&&++_>2&&(r+1)%2==0){b=c.groups,u=c.types;break}n--}for(i=0;i<b.length;i++)"interval"!==u[i]&&(a=this.getCenterOfCriticalInterval(b[i],r+1,d),c[0],o=Math.floor(a[1]),h=a[2],A.push(this.getPointType(e,o,h,d,m,g,n+1)));return[A,m,g,v,y]},_insertPoint_v4:function(t,e,i,r){var n,s,o,a=null;t.points.length>0&&(a=t.points[t.points.length-1].scrCoords),n=new base_coords.A(constants.A.COORDS_BY_USER,e,t.board),null!==a&&(s=n.scrCoords[1]-a[1])*s+(o=n.scrCoords[2]-a[2])*o<.8*.8||(n._t=i,t.points.push(n))},getInterval:function(t,e,i){var r,n;return ia.A.disable(),r=ia.A.Interval(e,i),t.board.mathLib=ia.A,t.board.mathLibJXG=ia.A,n=t.Y(r,!0),t.board.mathLib=Math,t.board.mathLibJXG=jxg.A.Math,n},sign:function(t){return t<0?-1:t>0?1:0},handleBorder:function(t,e,i,r,n){var s,o,a,l,c,h,u,d,p,f,m,g,_=i.idx;if(g=e.t_values[1]-e.t_values[0],"borderleft"===i.type?a=(o=s=e.left_isNaN?e.left_t:i.t-g)+g:"borderright"===i.type?o=(a=s=e.right_isNaN?e.right_t:i.t+g)-g:console.log("No bordercase!!!"),0!==(f=this.findComponents(t,o,a,32)).length){for("borderleft"===i.type&&(o=f[0].left_t,a=f[0].t_values[0],g=f[0].t_values[1]-f[0].t_values[0],s=o=null===o?a-g:o,l=this.getInterval(t,o,a),utils_type.A.isObject(l)&&(u=l.lo,d=l.hi,c=t.X(s,!0),h=n[1][_]<0?d:u,this._insertPoint_v4(t,[1,c,h],s))),m=f[0].t_values.length,p=0;p<m;p++)s=f[0].t_values[p],c=f[0].x_values[p],h=f[0].y_values[p],this._insertPoint_v4(t,[1,c,h],s);"borderright"===i.type&&(o=f[0].t_values[m-1],a=f[0].right_t,g=f[0].t_values[1]-f[0].t_values[0],s=a=null===a?o+g:a,l=this.getInterval(t,o,a),utils_type.A.isObject(l)&&(u=l.lo,d=l.hi,c=t.X(s,!0),h=n[1][_]>0?d:u,this._insertPoint_v4(t,[1,c,h],s)))}},_seconditeration_v4:function(t,e,i,r,n){var s,o,a,l,c,h,u,d,p,f,m,g,_;for(o=e.t_values[i.idx-2],a=e.t_values[i.idx+2],c=this.findComponents(t,o,a,64),u=0;u<c.length;u++){for(h=c[u],d=(l=this.differenceMethod(h,t))[0],f=l[1],m=l[2],g=0,p=0;p<=d.length;p++){for(_=p===d.length?h.len:d[p].idx,s=g;s<_;s++)isNaN(h.x_values[s])||isNaN(h.y_values[s])||this._insertPoint_v4(t,[1,h.x_values[s],h.y_values[s]],h.t_values[s]);p<d.length&&(this.handleSingularity(t,h,d[p],f,m),g=d[p].idx+1)}_=h.len,u<c.length-1&&this._insertPoint_v4(t,[1,NaN,NaN],h.right_t)}return this},_recurse_v4:function(t,e,i,r,n,s,o,a){var l,c,h=.5*(e+i),u=t.X(h,!0),d=t.Y(h,!0);0!==a?(l=(u-r)*t.board.unitX,c=(d-n)*t.board.unitY,math.A.hypot(l,c)>2?this._recurse_v4(t,e,h,r,n,u,d,a-1):this._insertPoint_v4(t,[1,u,d],h),l=(u-s)*t.board.unitX,c=(d-o)*t.board.unitY,math.A.hypot(l,c)>2?this._recurse_v4(t,h,i,u,d,s,o,a-1):this._insertPoint_v4(t,[1,u,d],h)):this._insertPoint_v4(t,[1,NaN,NaN],h)},handleSingularity:function(t,e,i,r,n){var s,o,a,l,c,h,u,d,p,f,m,g=i.idx;s=i.t,console.log("HandleSingularity at t =",s),o=e.t_values[g-5],a=e.t_values[g+5],l=this.getInterval(t,o,a),utils_type.A.isObject(l)?(d=l.lo,p=l.hi):n[0][g-1]<n[0][g+1]?(d=n[0][g-1],p=n[0][g+1]):(d=n[0][g+1],p=n[0][g-1]),u=t.X(s,!0),f=(n[0][g-3]-n[0][g-5])/(e.t_values[g-3]-e.t_values[g-5]),m=(n[0][g+3]-n[0][g+5])/(e.t_values[g+3]-e.t_values[g+5]),console.log(":::",f,m),f<-100?(this._insertPoint_v4(t,[1,u,d],s,!0),m<=100&&this._insertPoint_v4(t,[1,NaN,NaN],s)):f>100?(this._insertPoint_v4(t,[1,u,p],s),m>=-100&&this._insertPoint_v4(t,[1,NaN,NaN],s)):(d===-1/0&&(this._insertPoint_v4(t,[1,u,d],s,!0),this._insertPoint_v4(t,[1,NaN,NaN],s)),p===1/0&&(this._insertPoint_v4(t,[1,NaN,NaN],s),this._insertPoint_v4(t,[1,u,p],s,!0)),i.t<e.t_values[g]?(c=g-1,h=g):(c=g,h=g+1),o=e.t_values[c],a=e.t_values[h],this._recurse_v4(t,o,a,r[0][c],n[0][c],r[0][h],n[0][h],10)),m<-100?this._insertPoint_v4(t,[1,u,p],s):m>100&&this._insertPoint_v4(t,[1,u,d],s)},steps:1021,criticalThreshold:1e3,plot_v4:function(t,e,i,r){var n,s,o,a,l,c,h,u,d,p,f,m,g,_,v,y=(i-e)/r,b=function(e){return t.Y(e,!0)},A=function(e){return-t.Y(e,!0)},x=.5*y;for(o=this.findComponents(t,e,i,r),a=0;a<o.length;a++){for(l=o[a],c=(d=this.differenceMethod(l,t))[0],p=d[1],f=d[2],0!==c.length&&"borderleft"===c[0].type||c.unshift({idx:0,t:l.t_values[0],x:l.x_values[0],y:l.y_values[0],type:"borderleft"}),"borderright"!==c[c.length-1].type&&(s=l.t_values.length,c.push({idx:s-1,t:l.t_values[s-1],x:l.x_values[s-1],y:l.y_values[s-1],type:"borderright"})),u=0,h=0;h<=c.length;h++){for(s=h===c.length?l.len:c[h].idx-1,n=u;n<s-2;n++)this._insertPoint_v4(t,[1,l.x_values[n],l.y_values[n]],l.t_values[n]),n>=u+3&&n<s-3&&f.length>3&&Math.abs(f[2][n])>.2*Math.abs(f[0][n])&&(m=l.t_values[n],x=.25*y,v=this.getInterval(t,m,m+y),utils_type.A.isObject(v)?f[2][n]>0?this._insertPoint_v4(t,[1,m+x,v.lo],m+x):this._insertPoint_v4(t,[1,m+y-x,v.hi],m+y-x):(g=numerics.A.fminbr(b,[m,m+y]))<(_=numerics.A.fminbr(A,[m,m+y]))?(this._insertPoint_v4(t,[1,t.X(g,!0),t.Y(g,!0)],g),this._insertPoint_v4(t,[1,t.X(_,!0),t.Y(_,!0)],_)):(this._insertPoint_v4(t,[1,t.X(_,!0),t.Y(_,!0)],_),this._insertPoint_v4(t,[1,t.X(g,!0),t.Y(g,!0)],g)));h<c.length&&(n=c[h].idx,"borderleft"===c[h].type||"borderright"===c[h].type?this.handleBorder(t,l,c[h],p,f):this._seconditeration_v4(t,l,c[h],p,f),u=c[h].idx+1+1)}s=l.len,a<o.length-1&&this._insertPoint_v4(t,[1,NaN,NaN],l.right_t)}},updateParametricCurve_v4:function(t,e,i){var r,n,s,o;"x"===t.xterm?(s=.3*((o=t.board.getBoundingBox())[2]-o[0]),r=Math.max(e,o[0]-s),n=Math.min(i,o[2]+s)):(r=e,n=i),t.points=[],this.plot_v4(t,r,n,this.steps),t.numberPoints=t.points.length},updateParametricCurve:function(t,e,i){return this.updateParametricCurve_v2(t,e,i)}};const plot=math.A.Plot;math.A.ImplicitPlot=function(t,e,i,r,n){var s={resolution_out:5,resolution_in:5,max_steps:1024,alpha_0:.05,tol_u0:math.A.eps,tol_newton:1e-7,tol_cusp:.05,tol_progress:1e-4,qdt_box:.2,kappa_0:.2,delta_0:.05,h_initial:.1,h_critical:.001,h_max:1,loop_dist:.09,loop_dir:.99,loop_detection:!0,unitX:10,unitY:10};this.config=utils_type.A.merge(s,e),this.f=i,this.dfx=null,this.dfy=null,utils_type.A.isFunction(r)?this.dfx=r:this.dfx=function(t,e){var i=math.A.eps*math.A.eps;return.5*(this.f(t+i,e)-this.f(t-i,e))/i},utils_type.A.isFunction(n)?this.dfy=n:this.dfy=function(t,e){var i=math.A.eps*math.A.eps;return.5*(this.f(t,e+i)-this.f(t,e-i))/i},this.bbox=t,this.qdt=new bqdt(20,5,t),this.components=[]},utils_type.A.extend(math.A.ImplicitPlot.prototype,{plot:function(){var t,e,i,r,n,s,o,a=[],l=[],c=[],h=0,u=this,d=function(e){return u.f(t,e)},p=function(e){return-u.f(t,e)},f=function(t){return u.f(t,e)},m=function(t){return-u.f(t,e)};for(i=Math.min(this.bbox[0],this.bbox[2])-math.A.eps,r=Math.max(this.bbox[0],this.bbox[2]),n=Math.min(this.bbox[1],this.bbox[3])+math.A.eps,s=Math.max(this.bbox[1],this.bbox[3]),o=this.config.resolution_out/this.config.unitX,o*=1+math.A.eps,t=i;t<r;t+=o)!1!==(c=this.searchLine(d,p,t,[n,s],"vertical",h,a,l,20))&&(a=c[0],l=c[1],h=c[2]);for(o=this.config.resolution_out/this.config.unitY,o*=1+math.A.eps,e=n;e<s;e+=o)!1!==(c=this.searchLine(f,m,e,[i,r],"horizontal",h,a,l,20))&&(a=c[0],l=c[1],h=c[2]);return[a,l,h]},searchLine:function(t,e,i,r,n,s,o,a,l){var c,h,u,d,p,f,m,g,_,v,y,b,A,x,C=this.config.tol_u0,E=r[0],M=r[1];if(p=t(c=numerics.A.fminbr(t,[E,M])),f=t(h=numerics.A.fminbr(e,[E,M])),p<C&&f>-C){if(m=c,c=Math.min(m,h),h=Math.max(m,h),d=t(u=numerics.A.fzero(t,[c,h])),Math.abs(d)>Math.max((f-p)*math.A.eps,.001))return!1;if("vertical"===n?(_=[1,i,u],x=this.config.resolution_in/this.config.unitY):(_=[1,u,i],x=this.config.resolution_in/this.config.unitX),x*=1+math.A.eps,this.curveContainsPoint(_,o,a,2*x,this.config.qdt_box));else if((b=this.traceComponent(_,1))[0].length>0){for(s>0&&(o.push(NaN),a.push(NaN)),A=o.length,y=b[0].length,v=1;v<y;v++)this.qdt.insertItem({xlb:Math.min(b[0][v-1],b[0][v]),xub:Math.max(b[0][v-1],b[0][v]),ylb:Math.min(b[1][v-1],b[1][v]),yub:Math.max(b[1][v-1],b[1][v]),idx1:A+v-1,idx2:A+v,comp:s});s++,utils_type.A.concat(o,b[0]),utils_type.A.concat(a,b[1])}return(g=u-.01*x)-E>x&&l>0&&!1!==(b=this.searchLine(t,e,i,[E,g],n,s,o,a,l-1))&&(o=b[0],a=b[1],s=b[2]),M-(g=u+.01*x)>x&&l>0&&!1!==(b=this.searchLine(t,e,i,[g,M],n,s,o,a,l-1))&&(o=b[0],a=b[1],s=b[2]),[o,a,s]}return!1},curveContainsPoint:function(t,e,i,r,n){var s,o,a,l=t[1],c=t[2];for(o=(a=this.qdt.find([l-n,c+n,l+n,c-n])).length,s=0;s<o;s++)if(geometry.A.distPointSegment(t,[1,e[a[s].idx1],i[a[s].idx1]],[1,e[a[s].idx2],i[a[s].idx2]])<r)return!0;return!1},traceComponent:function(t){var e=[],i=[],r=[];return 0===(r=this.tracing(t,1)).length||(e=r[0],i=r[1]),r[2]||0===(r=this.tracing(t,-1)).length||(e=r[0].reverse().concat(e.slice(1)),i=r[1].reverse().concat(i.slice(1))),e.length>0&&e.length<6&&(e.push(e[e.length-1]),i.push(i[i.length-1])),[e,i]},tracing:function(t,e){var i,r,n,s,o,a,l,c,h,u,d,p,f,m,g,_,v,y=[],b=[],A=[],x=0,C=0,E=!1,M=!1,S=!1,w=this.config.kappa_0,P=this.config.delta_0,T=this.config.alpha_0,O=this.config.h_initial,R=this.config.max_steps,N=e,L=[],D=[],k=[];if(y=t.slice(1),L.push(y[0]),D.push(y[1]),!1===(i=this.tangent(y)))return[];this.dfx(y[0],y[1]),this.dfy(y[0],y[1]);do{if(!1===(i=this.tangent(y))){y=b.slice(),L.push(y[0]),D.push(y[1]);break}if(1===L.length)n=i.slice();else if(2===L.length)k.push(L.length-1);else if(M&&L.length>2&&!S){if(geometry.A.distPointSegment([1,y[0],y[1]],[1,L[0],D[0]],[1,L[1],D[1]])<this.config.loop_dist*O&&math.A.innerProduct(i,n,2)>this.config.loop_dir){y=t.slice(1),L.push(y[0]),D.push(y[1]),E=!0;break}if(this.config.loop_detection){for(m=L.length-1,g=Math.floor(math.A.log2(m)),_=0;_<=g&&!(geometry.A.distPointSegment([1,y[0],y[1]],[1,L[k[_]-1],D[k[_]-1]],[1,L[k[_]],D[k[_]]])<this.config.loop_dist*O&&(r=this.tangent([L[k[_]],D[k[_]]]),math.A.innerProduct(i,r,2)>this.config.loop_dir));_++);if(_<=g){E=!0;break}for(g=1,v=0,_=0;_<100&&(m+1)%g===0;_++)g*=2,v++;k[v]=m}}b[0]=y[0]+O*N*i[0],b[1]=y[1]+O*N*i[1],C=0;do{h=(s=[this.dfx(b[0],b[1]),this.dfy(b[0],b[1])])[0]*s[0]+s[1]*s[1],o=this.f(b[0],b[1])/h,A[0]=b[0]-s[0]*o,A[1]=b[1]-s[1]*o,0===C?l=Math.abs(o)*Math.sqrt(h):1===C&&(c=Math.abs(o)*Math.sqrt(h)),b[0]=A[0],b[1]=A[1],C++}while(C<20&&Math.abs(this.f(b[0],b[1]))>this.config.tol_newton);if(d=l,u=C>1?c/l:0,r=this.tangent(b),a=math.A.innerProduct(i,r,2),a=Math.max(-1,Math.min(1,a)),p=Math.acos(a),S=!1,geometry.A.distance(y,b,2)<this.config.tol_progress){y=b.slice(),L.push(y[0]),D.push(y[1]);break}if(a<0)if(O>this.config.h_critical);else{if(S=!0,!this.isBifurcation(y,this.config.tol_cusp)){y=b.slice(),L.push(y[0]),D.push(y[1]);break}N*=-1,p=0}if(!S&&(f=Math.max(Math.sqrt(u/w),Math.sqrt(d/P),p/T),isNaN(f)&&(f=1),O/=f=Math.max(Math.min(f,2),.5),O=Math.min(this.config.h_max,O),f>=2)){if(++x>=3*R)break;M=!1}else y=b.slice(),L.push(y[0]),D.push(y[1]),M=!0,x++}while(x<R&&y[0]>=this.bbox[0]&&y[1]<=this.bbox[1]&&y[0]<=this.bbox[2]&&y[1]>=this.bbox[3]);return[L,D,E]},isBifurcation:function(t,e){var i,r,n,s,o,a,l,c,h,u,d=math.A.eps*math.A.eps*100;return i=t[0],r=t[1],n=.5*(this.dfx(i+d,r)-this.dfx(i-d,r))/d,s=.5*(this.dfx(i,r+d)-this.dfx(i,r-d))/d,o=.5*(this.dfy(i+d,r)-this.dfy(i-d,r))/d,u=(l=n+(a=.5*(this.dfy(i,r+d)-this.dfy(i,r-d))/d))*l-4*(n*a-s*o),c=.5*(l+Math.sqrt(u)),h=.5*(l-Math.sqrt(u)),Math.abs(c)>e&&Math.abs(h)>e},handleCriticalPoint:function(t,e,i,r){var n,s=Math.atan2(r*e[1],r*e[0]);return n=numerics.A.root((function(e){var r=t[0]+i*Math.cos(e),n=t[1]+i*Math.sin(e);return this.f(r,n)}),s),[t[0]+i*Math.cos(n),t[1]+i*Math.sin(n)]},updateA:function(t,e,i){var r,n,s=[i[0]-e[0],i[1]-e[1]],o=this.f(i[0],i[1])-this.f(e[0],e[1]);return n=s[0]*s[0]+s[1]*s[1],r=o-(t[0]*s[0]+t[1]*s[1]),r/=n,t[0]+=r*s[0],t[1]+=r*s[1],t},tangent_A:function(t){var e=[-t[1],t[0]],i=math.A.norm(e,2);return math.A.eps,[e[0]/i,e[1]/i]},tangent:function(t){var e=[-this.dfy(t[0],t[1]),this.dfx(t[0],t[1])],i=math.A.norm(e,2);return!(i<math.A.eps*math.A.eps)&&[e[0]/i,e[1]/i]}});const implicitplot=math.A.ImplicitPlot;math.A.Metapost={MP_ENDPOINT:0,MP_EXPLICIT:1,MP_GIVEN:2,MP_CURL:3,MP_OPEN:4,MP_END_CYCLE:5,UNITY:1,FRACTION_ONE:1,FRACTION_THREE:3,ONE_EIGHTY_DEG:Math.PI,THREE_SIXTY_DEG:2*Math.PI,EPS_SQ:1e-5*1e-5,make_choices:function(t){var e,i,r,n,s,o,a,l,c,h,u,d,p,f,m;a=t[0];do{if(!a)break;o=a.next,a.rtype>this.MP_EXPLICIT&&(a.x-o.x)*(a.x-o.x)+(a.y-o.y)*(a.y-o.y)<this.EPS_SQ&&(a.rtype=this.MP_EXPLICIT,a.ltype===this.MP_OPEN&&(a.ltype=this.MP_CURL,a.set_left_curl(this.UNITY)),o.ltype=this.MP_EXPLICIT,o.rtype===this.MP_OPEN&&(o.rtype=this.MP_CURL,o.set_right_curl(this.UNITY)),a.rx=a.x,o.lx=a.x,a.ry=a.y,o.ly=a.y),a=o}while(a!==t[0]);for(i=t[0];i.ltype===this.MP_OPEN&&i.rtype===this.MP_OPEN;)if((i=i.next)===t[0]){i.ltype=this.MP_END_CYCLE;break}for(a=i;a;){if(o=a.next,a.rtype>=this.MP_GIVEN){for(;o.ltype===this.MP_OPEN&&o.rtype===this.MP_OPEN;)o=o.next;for(r=0,l=a,s=t.length,d=[],p=[],f=[],m=[null];h=l.next,d.push(h.x-l.x),p.push(h.y-l.y),f.push(this.mp_pyth_add(d[r],p[r])),r>0&&(u=p[r-1]/f[r-1],c=d[r-1]/f[r-1],m.push(Math.atan2(p[r]*c-d[r]*u,d[r]*c+p[r]*u))),r++,(l=h)===o&&(s=r),!(r>=s&&l.ltype!==this.MP_END_CYCLE););r===s?m.push(0):m.push(m[1]),o.ltype===this.MP_OPEN&&((n=o.rx-o.x)*n+(e=o.ry-o.y)*e<this.EPS_SQ?(o.ltype=this.MP_CURL,o.set_left_curl(this.UNITY)):(o.ltype=this.MP_GIVEN,o.set_left_given(Math.atan2(e,n)))),a.rtype===this.MP_OPEN&&a.ltype===this.MP_EXPLICIT&&((n=a.x-a.lx)*n+(e=a.y-a.ly)*e<this.EPS_SQ?(a.rtype=this.MP_CURL,a.set_right_curl(this.UNITY)):(a.rtype=this.MP_GIVEN,a.set_right_given(Math.atan2(e,n)))),this.mp_solve_choices(a,o,s,d,p,f,m)}else a.rtype===this.MP_ENDPOINT&&(a.rx=a.x,a.ry=a.y,o.lx=o.x,o.ly=o.y);if((a=o)===i)break}},mp_solve_choices:function(t,e,i,r,n,s,o){var a,l,c,h,u,d,p,f,m,g,_,v,y,b,A,x,C,E,M,S,w,P,T,O,R,N;for(u=s.length+1,g=new Array(u),m=new Array(u),c=new Array(u),A=new Array(u),R=0;R<u;R++)A[R]=c[R]=m[R]=g[R]=0;for(p=0,f=t,v=0;;){if(y=f.next,0===p)if(f.rtype===this.MP_GIVEN){if(y.ltype===this.MP_GIVEN)return a=Math.atan2(n[0],r[0]),S=(M=this.mp_n_sin_cos(t.right_given()-a))[0],w=M[1],T=(P=this.mp_n_sin_cos(e.left_given()-a))[0],O=P[1],void this.mp_set_controls(t,e,r[0],n[0],w,S,-O,T);c[0]=f.right_given()-Math.atan2(n[0],r[0]),c[0]=this.reduce_angle(c[0]),g[0]=0,m[0]=0}else if(f.rtype===this.MP_CURL){if(y.ltype===this.MP_CURL)return t.rtype=this.MP_EXPLICIT,e.ltype=this.MP_EXPLICIT,_=Math.abs(e.left_tension()),x=Math.abs(t.right_tension()),b=this.UNITY/(3*x),t.rx=t.x+r[0]*b,t.ry=t.y+n[0]*b,b=this.UNITY/(3*_),e.lx=e.x-r[0]*b,void(e.ly=e.y-n[0]*b);E=f.right_curl(),_=Math.abs(y.left_tension()),x=Math.abs(f.right_tension()),g[0]=this.mp_curl_ratio(E,x,_),c[0]=-o[1]*g[0],m[0]=0}else f.rtype===this.MP_OPEN&&(g[0]=0,c[0]=0,m[0]=this.FRACTION_ONE);else if(f.ltype===this.MP_END_CYCLE||f.ltype===this.MP_OPEN){if(a=this.UNITY/(3*Math.abs(v.right_tension())-this.UNITY),C=s[p]*(this.FRACTION_THREE-this.UNITY/Math.abs(v.right_tension())),h=this.UNITY/(3*Math.abs(y.left_tension())-this.UNITY),d=s[p-1]*(this.FRACTION_THREE-this.UNITY/Math.abs(y.left_tension())),C*=E=this.FRACTION_ONE-g[p-1]*a,(_=Math.abs(f.left_tension()))<(x=Math.abs(f.right_tension()))?C*=Math.pow(_/x,2):_>x&&(d*=Math.pow(x/_,2)),b=d/(d+C),g[p]=b*h,l=-o[p+1]*g[p],v.rtype===this.MP_CURL?(m[p]=0,c[p]=l-o[1]*(this.FRACTION_ONE-b)):(b=(this.FRACTION_ONE-b)/E,l-=o[p]*b,b*=a,c[p]=l-c[p-1]*b,m[p]=-m[p-1]*b),f.ltype===this.MP_END_CYCLE){for(a=0,h=this.FRACTION_ONE;0==(p-=1)&&(p=i),a=c[p]-a*g[p],h=m[p]-h*g[p],p!==i;);for(a/=this.FRACTION_ONE-h,A[i]=a,c[0]=a,N=1;N<i;N++)c[N]=c[N]+a*m[N];break}}else{if(f.ltype===this.MP_CURL){E=f.left_curl(),_=Math.abs(f.left_tension()),x=Math.abs(v.right_tension()),b=this.mp_curl_ratio(E,_,x),A[i]=-c[i-1]*b/(this.FRACTION_ONE-b*g[i-1]);break}if(f.ltype===this.MP_GIVEN){A[i]=f.left_given()-Math.atan2(n[i-1],r[i-1]),A[i]=this.reduce_angle(A[i]);break}}v=f,f=y,p+=1}for(p=i-1;p>-1;p--)A[p]=c[p]-A[p+1]*g[p];for(f=t,p=0;y=f.next,S=(M=this.mp_n_sin_cos(A[p]))[0],w=M[1],T=(P=this.mp_n_sin_cos(-o[p+1]-A[p+1]))[0],O=P[1],this.mp_set_controls(f,y,r[p],n[p],w,S,O,T),f=y,++p!==i;);},mp_n_sin_cos:function(t){return[Math.cos(t),Math.sin(t)]},mp_set_controls:function(t,e,i,r,n,s,o,a){var l,c,h,u,d;h=Math.abs(e.left_tension()),l=Math.abs(t.right_tension()),d=this.mp_velocity(n,s,o,a,l),c=this.mp_velocity(o,a,n,s,h),(t.right_tension()<0||e.left_tension()<0)&&(n>=0&&o>=0||n<=0&&o<=0)&&(u=Math.abs(n)*a+Math.abs(o)*s)>0&&(u*=1.00024414062,t.right_tension()<0&&this.mp_ab_vs_cd(Math.abs(o),this.FRACTION_ONE,d,u)<0&&(d=Math.abs(o)/u),e.left_tension()<0&&this.mp_ab_vs_cd(Math.abs(n),this.FRACTION_ONE,c,u)<0&&(c=Math.abs(n)/u)),t.rx=t.x+(i*s-r*n)*d,t.ry=t.y+(r*s+i*n)*d,e.lx=e.x-(i*a+r*o)*c,e.ly=e.y-(r*a-i*o)*c,t.rtype=this.MP_EXPLICIT,e.ltype=this.MP_EXPLICIT},mp_pyth_add:function(t,e){return math.A.hypot(t,e)},mp_curl_ratio:function(t,e,i){var r=1/e,n=1/i;return Math.min(4,((3-r)*r*r*t+n*n*n)/(r*r*r*t+(3-n)*n*n))},mp_ab_vs_cd:function(t,e,i,r){return t*e===i*r?0:t*e>i*r?1:-1},mp_velocity:function(t,e,i,r,n){return Math.min(4,(2+Math.sqrt(2)*(t-i/16)*(i-t/16)*(e-r))/(1.5*n*(2+(Math.sqrt(5)-1)*e+(3-Math.sqrt(5))*r)))},reduce_angle:function(t){return Math.abs(t)>this.ONE_EIGHTY_DEG&&(t>0?t-=this.THREE_SIXTY_DEG:t+=this.THREE_SIXTY_DEG),t},makeknots:function(t,e){var i,r,n=[];for(r=t.length,i=0;i<r;i++)n.push({x:t[i][0],y:t[i][1],ltype:this.MP_OPEN,rtype:this.MP_OPEN,lx:!1,rx:!1,ly:e,ry:e,left_curl:function(){return this.lx||0},right_curl:function(){return this.rx||0},left_tension:function(){return this.ly||1},right_tension:function(){return this.ry||1},set_right_curl:function(t){this.rx=t||0},set_left_curl:function(t){this.lx=t||0}});for(r=n.length,i=0;i<r;i++)n[i].next=n[i+1]||n[i],n[i].set_right_given=n[i].set_right_curl,n[i].set_left_given=n[i].set_left_curl,n[i].right_given=n[i].right_curl,n[i].left_given=n[i].left_curl;return n[r-1].next=n[0],n},curve:function(t,e){var i,r,n,s,o,a,l=!1,c=[],h=[];for(s in o=1,(e=e||{tension:1,direction:{},curl:{},isClosed:!1}).hasOwnProperty("tension")&&(o=utils_type.A.evaluate(e.tension)),r=(i=this.makeknots(t,o)).length,utils_type.A.exists(e.isClosed)&&utils_type.A.evaluate(e.isClosed)&&(l=!0),l||(i[0].ltype=this.MP_ENDPOINT,i[0].rtype=this.MP_CURL,i[r-1].rtype=this.MP_ENDPOINT,i[r-1].ltype=this.MP_CURL),e)if(e.hasOwnProperty(s)){if(n=parseInt(s,10),isNaN(n)||n<0||n>=r)continue;a=e[n],utils_type.A.exists(a.type)&&"curl"===a.type&&(o=utils_type.A.evaluate(a.curl),0===n?(i[n].rtype=this.MP_CURL,i[n].set_right_curl(o)):n===r-1?(i[n].ltype=this.MP_CURL,i[n].set_left_curl(o)):(i[n].ltype=this.MP_CURL,i[n].rtype=this.MP_CURL,i[n].lx=o,i[n].rx=o)),utils_type.A.exists(a.direction)&&(o=utils_type.A.evaluate(a.direction),utils_type.A.isArray(o)?(!1!==o[0]&&(i[n].lx=o[0]*Math.PI/180,i[n].ltype=this.MP_GIVEN),!1!==o[1]&&(i[n].rx=o[1]*Math.PI/180,i[n].rtype=this.MP_GIVEN)):(i[n].lx=o*Math.PI/180,i[n].rx=o*Math.PI/180,i[n].ltype=i[n].rtype=this.MP_GIVEN)),utils_type.A.exists(a.tension)&&(o=utils_type.A.evaluate(a.tension),utils_type.A.isArray(o)?(!1!==o[0]&&(i[n].ly=utils_type.A.evaluate(o[0])),!1!==o[1]&&(i[n].ry=utils_type.A.evaluate(o[1]))):(i[n].ly=o,i[n].ry=o))}for(this.make_choices(i),n=0;n<r-1;n++)c.push(i[n].x),c.push(i[n].rx),c.push(i[n+1].lx),h.push(i[n].y),h.push(i[n].ry),h.push(i[n+1].ly);return c.push(i[r-1].x),h.push(i[r-1].y),l&&(c.push(i[r-1].rx),h.push(i[r-1].ry),c.push(i[0].lx),h.push(i[0].ly),c.push(i[0].x),h.push(i[0].y)),[c,h]}};const metapost=math.A.Metapost;math.A.Clip={_isSeparator:function(t){return isNaN(t.coords.usrCoords[1])&&isNaN(t.coords.usrCoords[2])},makeDoublyLinkedList:function(t){var e,i=null,r=[],n=t.length;if(n>0)for(e=0;e<n;e++)this._isSeparator(t[e])?(t[e]._next=t[(e+1)%n],t[e]._prev=t[(n+e-1)%n]):(null===i&&(i=e,r.push(i)),this._isSeparator(t[(e+1)%n])||e===n-1?(t[e]._next=t[i],t[i]._prev=t[e],t[e]._end=!0,i=null):(t[e]._next=t[(e+1)%n],t[i]._prev=t[e]),this._isSeparator(t[(n+e-1)%n])||(t[e]._prev=t[(n+e-1)%n]));return r},Vertex:function(t,e,i,r,n,s){this.pos=e,this.intersection=!0,this.coords=t,this.elementClass=constants.A.OBJECT_CLASS_POINT,this.data={alpha:i,path:r,pathname:n,done:!1,type:s,idx:0},this.neighbour=null,this.entry_exit=!1},_addToList:function(t,e,i){var r=t.length,n=math.A.eps*math.A.eps;r>0&&Math.abs(t[r-1].coords.usrCoords[0]-e.usrCoords[0])<n&&Math.abs(t[r-1].coords.usrCoords[1]-e.usrCoords[1])<n&&Math.abs(t[r-1].coords.usrCoords[2]-e.usrCoords[2])<n||t.push({pos:i,intersection:!1,coords:e,elementClass:constants.A.OBJECT_CLASS_POINT})},sortIntersections:function(t){var e,i,r,n,s,o,a=[],l=t.length;for(e=0;e<l;e++)if(t[e].sort((function(t,e){return t.data.alpha>e.data.alpha?1:-1})),t[e].length>0){for(s=t[e].length-1,o=(n=(r=t[e][0]).data.path[r.pos])._next,e===l-1&&(n._end=!1),0===r.data.alpha&&"T"===r.data.type?(n.intersection=!0,n.data=r.data,n.neighbour=r.neighbour,n.neighbour.neighbour=n,n.entry_exit=!1,t[e][0]=n):(r._prev=n,r._prev._next=r),i=1;i<=s;i++)(r=t[e][i])._prev=t[e][i-1],r._prev._next=r;(r=t[e][s])._next=o,r._next._prev=r,e===l-1&&(r._end=!0),a=a.concat(t[e])}return a},_inbetween:function(t,e,i){var r,n=math.A.eps*math.A.eps,s=i[1]-e[1],o=i[2]-e[2],a=t[1]-e[1],l=t[2]-e[2];return 0===s&&0===o&&0===a&&0===l||(r=Math.abs(a)<n&&Math.abs(s)<n?l/o:a/s,Math.abs(r)<n&&(r=0),r)},_print_array:function(t){var e,i;for(e=0;e<t.length;e++)try{i="",t[e]._end&&(i=" end"),console.log(e,t[e].coords.usrCoords,t[e].data.type,"\t","prev",t[e]._prev.coords.usrCoords,"next",t[e]._next.coords.usrCoords+i)}catch(i){console.log(e,t[e].coords.usrCoords)}},_print_list:function(t){for(var e,i=0;i<100&&(e=t.data?t.data.alpha:"-",console.log("\t",t.coords.usrCoords,"\n\t\tis:",t.intersection,"end:",t._end,e,"\n\t\t-:",t._prev.coords.usrCoords,"\n\t\t+:",t._next.coords.usrCoords,"\n\t\tn:",t.intersection?t.neighbour.coords.usrCoords:"-"),!t._end);)t=t._next,i++},_noOverlap:function(t,e,i,r){var n,s,o,a,l,c=Math.sqrt(math.A.eps),h=!1;for(n=0;n<3;n++)if(s=Math.min(t[n],e[n]),o=Math.max(t[n],e[n]),a=Math.min(i[n],r[n]),l=Math.max(i[n],r[n]),o<a-c||s>l+c){h=!0;break}return h},findIntersections:function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p,f,m,g=[],_=100*math.A.eps,v=t.length,y=e.length,b=[],A=[],x=[],C=!1,E=!1;for(n=0;n<y;n++)x.push([]);for(r=0;r<v;r++)if(A.push([]),this._isSeparator(t[r])||this._isSeparator(t[(r+1)%v]))C=!0;else{if(C&&r===v-1)break;for(o=t[r].coords.usrCoords,a=t[(r+1)%v].coords.usrCoords,n=0;n<y;n++)if(this._isSeparator(e[n])||this._isSeparator(e[(n+1)%y]))E=!0;else{if(E&&n===y-1)break;if(l=e[n].coords.usrCoords,c=e[(n+1)%y].coords.usrCoords,!this._noOverlap(o,a,l,c)&&(g=geometry.A.meetSegmentSegment(o,a,l,c),h=geometry.A.distance(o,a,3),u=geometry.A.distance(l,c,3),g[1]*h>-_&&g[1]<1-_/h&&g[2]*u>-_&&g[2]<1-_/u||g[1]===1/0&&g[2]===1/0&&math.A.norm(g[0],3)<_)){if(s=new base_coords.A(constants.A.COORDS_BY_USER,g[0],i),p="X",Math.abs(g[1])*h<_||Math.abs(g[2])*u<_)p="T",Math.abs(g[1])*h<_&&(g[1]=0),Math.abs(g[2])*u<_&&(g[2]=0),s=0===g[1]?new base_coords.A(constants.A.COORDS_BY_USER,o,i):new base_coords.A(constants.A.COORDS_BY_USER,l,i);else if(g[1]===1/0&&g[2]===1/0&&math.A.norm(g[0],3)<_){(d=this._inbetween(o,l,c))>=0&&d<1&&(p="T",s=new base_coords.A(constants.A.COORDS_BY_USER,o,i),g[1]=0,g[2]=d,f=new this.Vertex(s,r,g[1],t,"S",p),m=new this.Vertex(s,n,g[2],e,"C",p),f.neighbour=m,m.neighbour=f,A[r].push(f),x[n].push(m)),d=this._inbetween(l,o,a),geometry.A.distance(o,l,3)>_&&d>=0&&d<1&&(p="T",s=new base_coords.A(constants.A.COORDS_BY_USER,l,i),g[1]=d,g[2]=0,f=new this.Vertex(s,r,g[1],t,"S",p),m=new this.Vertex(s,n,g[2],e,"C",p),f.neighbour=m,m.neighbour=f,A[r].push(f),x[n].push(m));continue}f=new this.Vertex(s,r,g[1],t,"S",p),m=new this.Vertex(s,n,g[2],e,"C",p),f.neighbour=m,m.neighbour=f,A[r].push(f),x[n].push(m)}}}for(b=this.sortIntersections(A),r=0;r<b.length;r++)b[r].data.idx=r,b[r].neighbour.data.idx=r;return[b,this.sortIntersections(x)]},_getPosition:function(t,e,i,r){var n=geometry.A.det3p(t,e,i),s=geometry.A.det3p(t,i,r);return geometry.A.det3p(e,i,r)>=0?n>=0&&s>=0?"left":"right":n>=0||s>=0?"left":"right"},_classifyDegenerateIntersections:function(t){var e,i,r,n,s,o,a,l,c,h,u,d,p,f;for(c=geometry.A.det3p,a=0,t._tours=0;;){if(t.intersection&&"T"===t.data.type&&(e=t._next.coords.usrCoords,i=t._prev.coords.usrCoords,geometry.A.distance(t.coords.usrCoords,e,3)<math.A.eps&&(e=t._next._next.coords.usrCoords),geometry.A.distance(t.coords.usrCoords,i,3)<math.A.eps&&(i=t._prev._prev.coords.usrCoords),n=(s=t.neighbour)._prev.coords.usrCoords,r=s._next.coords.usrCoords,geometry.A.distance(s.coords.usrCoords,r,3)<math.A.eps&&(r=s._next._next.coords.usrCoords),geometry.A.distance(s.coords.usrCoords,n,3)<math.A.eps&&(n=s._prev._prev.coords.usrCoords),u=c(t.coords.usrCoords,i,n),d=c(t.coords.usrCoords,e,r),p=c(t.coords.usrCoords,i,r),f=c(t.coords.usrCoords,e,n),0===u&&0===d&&0===p&&0===f&&(t.coords.usrCoords[1]*=1+Math.random()*math.A.eps,t.coords.usrCoords[2]*=1+Math.random()*math.A.eps,s.coords.usrCoords[1]=t.coords.usrCoords[1],s.coords.usrCoords[2]=t.coords.usrCoords[2],u=c(t.coords.usrCoords,i,n),d=c(t.coords.usrCoords,e,r),p=c(t.coords.usrCoords,i,r),f=c(t.coords.usrCoords,e,n)),h=!1,0===u?geometry.A.affineRatio(t.coords.usrCoords,i,n)<0&&(h=!0):0===d?geometry.A.affineRatio(t.coords.usrCoords,e,r)<0&&(h=!0):0===p?geometry.A.affineRatio(t.coords.usrCoords,i,r)>0&&(h=!0):0===f&&geometry.A.affineRatio(t.coords.usrCoords,e,n)>0&&(h=!0),h&&(l=n,n=r,r=l,l=u,u=p,p=l,l=d,d=f,f=l),utils_type.A.exists(t.delayedStatus)||(t.delayedStatus=[]),0===u&&0===d?t.delayedStatus=["on","on"]:0===u?(o=this._getPosition(e,n,s.coords.usrCoords,r),t.delayedStatus=["on",o]):0===d?(o=this._getPosition(i,n,s.coords.usrCoords,r),t.delayedStatus=[o,"on"]):0===t.delayedStatus.length&&(this._getPosition(i,n,s.coords.usrCoords,r)!==this._getPosition(e,n,s.coords.usrCoords,r)?t.data.type="X":t.data.type="B")),utils_type.A.exists(t._tours)&&t._tours++,t._tours>3||t._end||a>1e3){a>1e3&&console.log("Clipping: _classifyDegenerateIntersections exit"),utils_type.A.exists(t._tours)&&delete t._tours;break}t.intersection&&a++,t=t._next}},_handleIntersectionChains:function(t){for(var e,i=0,r="Null",n=!1,s=!1;!0===t.intersection&&("T"===t.data.type&&("on"!==t.delayedStatus[0]&&"on"===t.delayedStatus[1]?(n=!0,e=t,r=t.delayedStatus[0]):n&&"on"===t.delayedStatus[0]&&"on"===t.delayedStatus[1]?t.data.type="B":n&&"on"===t.delayedStatus[0]&&"on"!==t.delayedStatus[1]&&(n=!1,r===t.delayedStatus[1]?(e.data.type="DB",t.data.type="DB"):(e.data.type="DX",t.data.type="DX"))),i++),t._end&&(s=!0),!s||n;){if(i>1e3){console.log("Warning: _handleIntersectionChains: intersection chain reached maximum numbers of iterations");break}t=t._next}},_handleFullyDegenerateCase:function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p,f,m,g,_=[t,e];for(s=0;s<2;s++){for(d=(r=_[s]).length,h=0,g=!0;h<d;h++)if(!r[h].intersection){g=!1;break}if(g)for(p=(n=_[(s+1)%2]).length,h=0;h<d;h++){for(a=r[h].coords.usrCoords,l=r[h]._next.coords.usrCoords,o=[.5*(a[0]+l[0]),.5*(a[1]+l[1]),.5*(a[2]+l[2])],u=0,f=!1;u<p;u++)if(Math.abs(geometry.A.det3p(n[u].coords.usrCoords,n[(u+1)%p].coords.usrCoords,o))<math.A.eps){f=!0;break}if(!f){c={pos:h,intersection:!1,coords:new base_coords.A(constants.A.COORDS_BY_USER,o,i),elementClass:constants.A.OBJECT_CLASS_POINT},m=r[h]._next,r[h]._next=c,c._prev=r[h],c._next=m,m._prev=c,r[h]._end&&(r[h]._end=!1,c._end=!0);break}}}},_getStatus:function(t,e){for(;t.intersection&&!t._end;)t=t._next;return[t,0===geometry.A.windingNumber(t.coords.usrCoords,e)?"entry":"exit"]},markEntryExit:function(t,e,i){var r,n,s,o,a,l,c,h=null,u=0;for(l=i.length,a=0;a<l;a++)for(c=i[a],this._classifyDegenerateIntersections(t[c]),this._handleIntersectionChains(t[c]),n=(o=this._getStatus(t[c],e))[0],r=o[1],n._starter=!0,s=0,h=null,u=0;!0===n.intersection&&("X"===n.data.type&&1===u&&(h.entry_exit=r,"exit"===r&&(h.data.type="X"),u=2),"X"!==n.data.type&&"DB"!==n.data.type||(n.entry_exit=r,r="entry"===r?"exit":"entry"),"DX"===n.data.type&&(0===u?(h=n,u=1):1===u?(n.entry_exit=r,h.entry_exit=r,"exit"===r?h.data.type="X":n.data.type="X",r="entry"===r?"exit":"entry",h=null,u=0):2===u&&(n.entry_exit=r,n.data.type="X",r="entry"===r?"exit":"entry",h=null,u=0))),n=n._next,!(utils_type.A.exists(n._starter)||s>1e4);)s++},_stayOnPath:function(t,e){var i=!0;return t.intersection&&"B"!==t.data.type&&(i=e===t.entry_exit),i},_addVertex:function(t,e,i){return isNaN(e.coords.usrCoords[1])||isNaN(e.coords.usrCoords[2])||t.push(e),e.intersection&&e.data.done?(i&&console.log("Add last intersection point",e.coords.usrCoords,"on",e.data.pathname,e.entry_exit,e.data.type),!0):(e.intersection&&(e.data.done=!0,i&&console.log("Add intersection point",e.coords.usrCoords,"on",e.data.pathname,e.entry_exit,e.data.type)),!1)},tracing:function(t,e,i){for(var r,n,s,o,a=0,l=1e4,c=0,h=[],u=!1,d=!1;c<e.length&&a<l;)if((s=e[c]).data.done||"X"!==s.data.type)c++;else{h.length>0&&h.push([NaN,NaN]),o=s.data.idx,r=t,u=this._addVertex(h,s,d),n=s.entry_exit;do{if(u)break;if("intersection"===i&&"entry"===s.entry_exit||"union"===i&&"exit"===s.entry_exit||"difference"===i&&r===t==("exit"===s.entry_exit)){do{if(s=s._next,u=this._addVertex(h,s,d))break}while(this._stayOnPath(s,n));a++}else{do{if(s=s._prev,u=this._addVertex(h,s,d))break}while(this._stayOnPath(s,n));a++}if(u)break;if(!s.neighbour)return console.log("Tracing: emergency break - no neighbour!!!!!!!!!!!!!!!!!",a),[[0],[0]];if((s=s.neighbour).data.done)break;s.data.done=!0,n=s.entry_exit,r=s.data.path}while(s.data.idx!==o&&a<l);a>=l&&console.log("Tracing: stopping an infinite loop!",a),c++}return this._getCoordsArrays(h,!1)},isEmptyCase:function(t,e,i){return"intersection"===i&&(0===t.length||0===e.length)||"union"===i&&0===t.length&&0===e.length||"difference"===i&&0===t.length},_getCoordsArrays:function(t,e){var i,r=[],n=[],s=t.length;for(i=0;i<s;i++)t[i].coords?(r.push(t[i].coords.usrCoords[1]),n.push(t[i].coords.usrCoords[2])):(r.push(t[i][0]),n.push(t[i][1]));return e&&s>0&&(t[0].coords?(r.push(t[0].coords.usrCoords[1]),n.push(t[0].coords.usrCoords[2])):(r.push(t[0][0]),n.push(t[0][1]))),[r,n]},handleEmptyIntersection:function(t,e,i){var r,n,s=!1,o=[];if(0===t.length)return o="union"===i?e:[],this._getCoordsArrays(o,!0);if(0===e.length)return o="intersection"===i?[]:t,this._getCoordsArrays(o,!0);if(t.length>0)for(r=t[0];r.intersection&&!(r=r._next)._end;);if(e.length>0)for(n=e[0];n.intersection&&!(n=n._next)._end;);return 0===geometry.A.windingNumber(r.coords.usrCoords,e)?0!==geometry.A.windingNumber(n.coords.usrCoords,t)?("union"===i?(utils_type.A.concat(o,t),o.push(t[0])):"difference"===i&&(utils_type.A.concat(o,t),o.push(t[0]),geometry.A.signedPolygon(t)*geometry.A.signedPolygon(e)>0&&o.reverse(),o.push([NaN,NaN])),"difference"!==i&&"intersection"!==i||(utils_type.A.concat(o,e),o.push(e[0]),s=!1)):"difference"===i?(utils_type.A.concat(o,t),s=!0):"union"===i&&(utils_type.A.concat(o,t),o.push(t[0]),o.push([NaN,NaN]),utils_type.A.concat(o,e),o.push(e[0])):"intersection"===i?(utils_type.A.concat(o,t),s=!0):"union"===i&&(utils_type.A.concat(o,e),o.push(e[0])),this._getCoordsArrays(o,s)},_countCrossingIntersections:function(t){var e,i=t.length,r=0;for(e=0;e<i;e++)"X"===t[e].data.type&&r++;return r},_getPath:function(t,e){var i,r,n,s,o,a,l,c=[];if(t.elementClass!==constants.A.OBJECT_CLASS_CURVE||t.type!==constants.A.OBJECT_TYPE_ARC&&t.type!==constants.A.OBJECT_TYPE_SECTOR){if(t.elementClass===constants.A.OBJECT_CLASS_CURVE&&utils_type.A.exists(t.points))for(r=t.numberPoints,i=0;i<r;i++)this._addToList(c,t.points[i],i);else if(t.type===constants.A.OBJECT_TYPE_POLYGON)for(i=0;i<t.vertices.length;i++)this._addToList(c,t.vertices[i].coords,i);else if(t.elementClass===constants.A.OBJECT_CLASS_CIRCLE)for(l=359,n=t.Radius(),s=2*Math.PI/l,i=0;i<=l;i++)this._addToList(c,new base_coords.A(constants.A.COORDS_BY_USER,[t.center.coords.usrCoords[0],t.center.coords.usrCoords[1]+Math.cos(i*s)*n,t.center.coords.usrCoords[2]+Math.sin(i*s)*n],e),i);else if(utils_type.A.isArray(t))for(r=t.length,i=0;i<r;i++)utils_type.A.exists(t[i].coords)?this._addToList(c,t[i].coords,i):utils_type.A.isArray(t[i])?this._addToList(c,new base_coords.A(constants.A.COORDS_BY_USER,t[i],e),i):utils_type.A.exists(t[i].usrCoords)&&this._addToList(c,t[i],i)}else{for(o=geometry.A.rad(t.radiuspoint,t.center,t.anglepoint),l=Math.floor(180*o/Math.PI),n=t.Radius(),s=o/l,a=Math.atan2(t.radiuspoint.coords.usrCoords[2]-t.center.coords.usrCoords[2],t.radiuspoint.coords.usrCoords[1]-t.center.coords.usrCoords[1]),t.type===constants.A.OBJECT_TYPE_SECTOR&&this._addToList(c,t.center.coords,0),i=0;i<=l;i++)this._addToList(c,new base_coords.A(constants.A.COORDS_BY_USER,[t.center.coords.usrCoords[0],t.center.coords.usrCoords[1]+Math.cos(i*s+a)*n,t.center.coords.usrCoords[2]+Math.sin(i*s+a)*n],e),i+1);t.type===constants.A.OBJECT_TYPE_SECTOR&&this._addToList(c,t.center.coords,l+2)}return c},greinerHormann:function(t,e,i,r){var n,s,o,a,l=[],c=[];return(n=(l=this._getPath(t,r)).length)>0&&geometry.A.distance(l[0].coords.usrCoords,l[n-1].coords.usrCoords,3)<math.A.eps&&l.pop(),(n=(c=this._getPath(e,r)).length)>0&&geometry.A.distance(c[0].coords.usrCoords,c[n-1].coords.usrCoords,3)<math.A.eps*math.A.eps&&c.pop(),this.isEmptyCase(l,c,i)?[[],[]]:(o=this.makeDoublyLinkedList(l),a=this.makeDoublyLinkedList(c),s=this.findIntersections(l,c,r)[0],this._handleFullyDegenerateCase(l,c,r),this.markEntryExit(l,c,o),this.markEntryExit(c,l,a),0===this._countCrossingIntersections(s)?this.handleEmptyIntersection(l,c,i):this.tracing(l,s,i))},union:function(t,e,i){return this.greinerHormann(t,e,"union",i)},intersection:function(t,e,i){return this.greinerHormann(t,e,"intersection",i)},difference:function(t,e,i){return this.greinerHormann(t,e,"difference",i)}};const clip=math.A.Clip;math.A.Poly={},math.A.Poly.Ring=function(t){this.vars=t},jxg.A.extend(math.A.Poly.Ring.prototype,{}),math.A.Poly.Monomial=function(t,e,i){var r;if(!utils_type.A.exists(t))throw new Error("JSXGraph error: In JXG.Math.Poly.monomial missing parameter 'ring'.");for(utils_type.A.isArray(i)||(i=[]),r=(i=i.slice(0,t.vars.length)).length;r<t.vars.length;r++)i.push(0);this.ring=t,this.coefficient=e||0,this.exponents=utils_type.A.deepCopy(i)},jxg.A.extend(math.A.Poly.Monomial.prototype,{copy:function(){return new math.A.Poly.Monomial(this.ring,this.coefficient,this.exponents)},print:function(){var t,e=[];for(t=0;t<this.ring.vars.length;t++)e.push(this.ring.vars[t]+"^"+this.exponents[t]);return this.coefficient+"*"+e.join("*")}}),math.A.Poly.Polynomial=function(t,e){var i;if(!utils_type.A.exists(t))throw new Error("JSXGraph error: In JXG.Math.Poly.polynomial missing parameter 'ring'.");i=utils_type.A.exists(e)&&utils_type.A.isString(e)?void 0:[],this.ring=t,this.monomials=i},jxg.A.extend(math.A.Poly.Polynomial.prototype,{findSignature:function(t){var e;for(e=0;e<this.monomials.length;e++)if(utils_type.A.cmpArrays(this.monomials[e].exponents,t))return e;return-1},addSubMonomial:function(t,e){var i;(i=this.findSignature(t.exponents))>-1?this.monomials[i].coefficient+=e*t.coefficient:(t.coefficient*=e,this.monomials.push(t))},add:function(t){var e;if(!utils_type.A.exists(t)||t.ring!==this.ring)throw new Error("JSXGraph error: In JXG.Math.Poly.polynomial.add either summand is undefined or rings don't match.");if(utils_type.A.isArray(t.exponents))this.addSubMonomial(t,1);else for(e=0;e<t.monomials.length;e++)this.addSubMonomial(t.monomials[e],1)},sub:function(t){var e;if(!utils_type.A.exists(t)||t.ring!==this.ring)throw new Error("JSXGraph error: In JXG.Math.Poly.polynomial.sub either summand is undefined or rings don't match.");if(utils_type.A.isArray(t.exponents))this.addSubMonomial(t,-1);else for(e=0;e<t.monomials.length;e++)this.addSubMonomial(t.monomials[e],-1)},copy:function(){var t,e;for(e=new math.A.Poly.Polynomial(this.ring),t=0;t<this.monomials.length;t++)e.monomials.push(this.monomials[t].copy());return e},print:function(){var t,e=[];for(t=0;t<this.monomials.length;t++)e.push("("+this.monomials[t].print()+")");return e.join("+")}});const poly=math.A.Poly;jxg.A.Complex=function(t,e){this.isComplex=!0,t&&t.isComplex&&(e=t.imaginary,t=t.real),this.real=t||0,this.imaginary=e||0,this.absval=0,this.angle=0},jxg.A.extend(jxg.A.Complex.prototype,{toString:function(){return this.real+" + "+this.imaginary+"i"},add:function(t){return utils_type.A.isNumber(t)?this.real+=t:(this.real+=t.real,this.imaginary+=t.imaginary),this},sub:function(t){return utils_type.A.isNumber(t)?this.real-=t:(this.real-=t.real,this.imaginary-=t.imaginary),this},mult:function(t){var e,i;return utils_type.A.isNumber(t)?(this.real*=t,this.imaginary*=t):(e=this.real,i=this.imaginary,this.real=e*t.real-i*t.imaginary,this.imaginary=e*t.imaginary+i*t.real),this},div:function(t){var e,i,r;if(utils_type.A.isNumber(t)){if(Math.abs(t)<Math.eps)return this.real=1/0,this.imaginary=1/0,this;this.real/=t,this.imaginary/=t}else{if(Math.abs(t.real)<Math.eps&&Math.abs(t.imaginary)<Math.eps)return this.real=1/0,this.imaginary=1/0,this;e=t.real*t.real+t.imaginary*t.imaginary,r=this.real,i=this.imaginary,this.real=(r*t.real+i*t.imaginary)/e,this.imaginary=(i*t.real-r*t.imaginary)/e}return this},conj:function(){return this.imaginary*=-1,this}}),jxg.A.C={},jxg.A.C.add=function(t,e){var i=new jxg.A.Complex(t);return i.add(e),i},jxg.A.C.sub=function(t,e){var i=new jxg.A.Complex(t);return i.sub(e),i},jxg.A.C.mult=function(t,e){var i=new jxg.A.Complex(t);return i.mult(e),i},jxg.A.C.div=function(t,e){var i=new jxg.A.Complex(t);return i.div(e),i},jxg.A.C.conj=function(t){var e=new jxg.A.Complex(t);return e.conj(),e},jxg.A.C.abs=function(t){var e=new jxg.A.Complex(t);return e.conj(),e.mult(t),Math.sqrt(e.real)},jxg.A.C.copy=function(t){return new jxg.A.Complex(t)},jxg.A.Complex.C=jxg.A.C;const complex=jxg.A.Complex;var src_options=__webpack_require__(761);jxg.A.AbstractRenderer=function(){this.vOffsetText=0,this.enhancedRendering=!0,this.container=null,this.type="",this.supportsForeignObject=!1,this.dashArray=[[2,2],[5,5],[10,10],[20,20],[20,10,10,10],[20,5,10,5],[0,5]]},jxg.A.extend(jxg.A.AbstractRenderer.prototype,{_updateVisual:function(t,e,i){(i||this.enhancedRendering)&&(e=e||{},this.setObjectTransition(t),t.evalVisProp("draft")?this.setDraft(t):(e.stroke||(t.highlighted?(this.setObjectStrokeColor(t,t.evalVisProp("highlightstrokecolor"),t.evalVisProp("highlightstrokeopacity")),this.setObjectStrokeWidth(t,t.evalVisProp("highlightstrokewidth"))):(this.setObjectStrokeColor(t,t.evalVisProp("strokecolor"),t.evalVisProp("strokeopacity")),this.setObjectStrokeWidth(t,t.evalVisProp("strokewidth")))),e.fill||(t.highlighted?this.setObjectFillColor(t,t.evalVisProp("highlightfillcolor"),t.evalVisProp("highlightfillopacity")):this.setObjectFillColor(t,t.evalVisProp("fillcolor"),t.evalVisProp("fillopacity"))),e.dash||this.setDashStyle(t,t.visProp),e.shadow||this.setShadow(t),e.tabindex||this.setTabindex(t)),t.highlighted?this.setCssClass(t,t.evalVisProp("highlightcssclass")):this.setCssClass(t,t.evalVisProp("cssclass")),t.evalVisProp("aria.enabled")&&this.setARIA(t))},_getHighlighted:function(t){var e=!1;return utils_type.A.exists(t.board)&&utils_type.A.exists(t.board.highlightedObjects)||(e=!0),!e&&utils_type.A.exists(t.board.highlightedObjects[t.id])?"highlight":""},drawPoint:function(t){var e,i=src_options.A.normalizePointFace(t.evalVisProp("face"));e="o"===i?"ellipse":"[]"===i?"rect":"path",t.rendNode=this.appendChildPrim(this.createPrim(e,t.id),t.evalVisProp("layer")),this.appendNodesToElement(t,e),this._updateVisual(t,{dash:!0,shadow:!0},!0),this.updatePoint(t)},updatePoint:function(t){var e,i=t.evalVisProp("size"),r=src_options.A.normalizePointFace(t.evalVisProp("face")),n=t.evalVisProp("sizeunit"),s=t.evalVisProp("zoom");isNaN(t.coords.scrCoords[2]+t.coords.scrCoords[1])||("user"===n&&(i*=Math.sqrt(Math.abs(t.board.unitX*t.board.unitY))),e=0===(i*=t.board&&s?Math.sqrt(t.board.zoomX*t.board.zoomY):1)?0:i+1,"o"===r?this.updateEllipsePrim(t.rendNode,t.coords.scrCoords[1],t.coords.scrCoords[2],e,e):"[]"===r?this.updateRectPrim(t.rendNode,t.coords.scrCoords[1]-i,t.coords.scrCoords[2]-i,2*i,2*i):this.updatePathPrim(t.rendNode,this.updatePathStringPoint(t,i,r),t.board),this._updateVisual(t,{dash:!1,shadow:!1}),this.setShadow(t))},changePointStyle:function(t){var e=this.getElementById(t.id);utils_type.A.exists(e)&&this.remove(e),this.drawPoint(t),utils_type.A.clearVisPropOld(t),t.visPropCalc.visible||this.display(t,!1),t.evalVisProp("draft")&&this.setDraft(t)},drawLine:function(t){t.rendNode=this.appendChildPrim(this.createPrim("line",t.id),t.evalVisProp("layer")),this.appendNodesToElement(t,"lines"),this.updateLine(t)},updateLine:function(t){this._updateVisual(t),this.updatePathWithArrowHeads(t),this.setLineCap(t)},drawCurve:function(t){t.rendNode=this.appendChildPrim(this.createPrim("path",t.id),t.evalVisProp("layer")),this.appendNodesToElement(t,"path"),this.updateCurve(t)},updateCurve:function(t){this._updateVisual(t),this.updatePathWithArrowHeads(t),this.setLineCap(t)},updatePathWithArrowHeads:function(t,e){var i,r,n=e?"highlight":"";i=e&&t.evalVisProp("highlightstrokewidth")?Math.max(t.evalVisProp("highlightstrokewidth"),t.evalVisProp("strokewidth")):t.evalVisProp("strokewidth"),r=this.getArrowHeadData(t,i,n),this.makeArrows(t,r),t.elementClass===constants.A.OBJECT_CLASS_LINE?this.updateLineWithEndings(t,r):t.elementClass===constants.A.OBJECT_CLASS_CURVE&&this.updatePath(t),this.setArrowSize(t,r)},getArrowHeadData:function(t,e,i){var r,n,s,o,a=math.A.eps,l=0,c=0,h=0,u=0,d=t.evalVisProp("firstarrow"),p=t.evalVisProp("lastarrow");return(d||p)&&(r=utils_type.A.exists(d.type)?t.eval(d.type):t.elementClass===constants.A.OBJECT_CLASS_LINE?1:7,n=utils_type.A.exists(p.type)?t.eval(p.type):t.elementClass===constants.A.OBJECT_CLASS_LINE?1:7,d&&(o=6,utils_type.A.exists(d.size)&&(o=t.eval(d.size)),""!==i&&utils_type.A.exists(d[i+"size"])&&(o=t.eval(d[i+"size"])),s=e*o,2===r?(s*=.5,a+=e*o):3===r?(s=e*o/3,a+=e):4===r||5===r||6===r?(s=e*o/1.5,a+=e*o):7===r?(s=0,o=10,a+=e):a+=e*o,l+=s,h=o),p&&(o=6,utils_type.A.exists(p.size)&&(o=t.eval(p.size)),""!==i&&utils_type.A.exists(p[i+"size"])&&(o=t.eval(p[i+"size"])),s=e*o,2===n?(s*=.5,a+=e*o):3===n?(s=e*o/3,a+=e):4===n||5===n||6===n?(s=e*o/1.5,a+=e*o):7===n?(s=0,o=10,a+=e):a+=e*o,c+=s,u=o)),t.visPropCalc.typeFirst=r,t.visPropCalc.typeLast=n,{evFirst:d,evLast:p,typeFirst:r,typeLast:n,offFirst:l,offLast:c,sizeFirst:h,sizeLast:u,showFirst:1,showLast:1,minLen:a,strokeWidth:e}},updateLineWithEndings:function(t,e){var i,r,n;return i=new base_coords.A(constants.A.COORDS_BY_USER,t.point1.coords.usrCoords,t.board),r=new base_coords.A(constants.A.COORDS_BY_USER,t.point2.coords.usrCoords,t.board),n=t.evalVisProp("margin"),geometry.A.calcStraight(t,i,r,n),this.handleTouchpoints(t,i,r,e),this.getPositionArrowHead(t,i,r,e),this.updateLinePrim(t.rendNode,i.scrCoords[1],i.scrCoords[2],r.scrCoords[1],r.scrCoords[2],t.board),this},updatePath:function(t){return t.evalVisProp("handdrawing")?this.updatePathPrim(t.rendNode,this.updatePathStringBezierPrim(t),t.board):this.updatePathPrim(t.rendNode,this.updatePathStringPrim(t),t.board),this},getPositionArrowHead:function(t,e,i,r){var n,s,o,a,l;return(r.evFirst||r.evLast)&&(s=o=a=l=0,n=e.distance(constants.A.COORDS_BY_SCREEN,i),r.evFirst&&"vml"!==t.board.renderer.type&&(n>=r.minLen?(s=(i.scrCoords[1]-e.scrCoords[1])*r.offFirst/n,o=(i.scrCoords[2]-e.scrCoords[2])*r.offFirst/n):r.showFirst=0),r.evLast&&"vml"!==t.board.renderer.type&&(n>=r.minLen?(a=(i.scrCoords[1]-e.scrCoords[1])*r.offLast/n,l=(i.scrCoords[2]-e.scrCoords[2])*r.offLast/n):r.showLast=0),e.setCoordinates(constants.A.COORDS_BY_SCREEN,[e.scrCoords[1]+s,e.scrCoords[2]+o],!1,!0),i.setCoordinates(constants.A.COORDS_BY_SCREEN,[i.scrCoords[1]-a,i.scrCoords[2]-l],!1,!0)),this},handleTouchpoints:function(t,e,i,r){var n,s,o,a,l,c,h;return(r.evFirst||r.evLast)&&(o=a=l=c=h=0,n=t.point1.evalVisProp("size")+t.point1.evalVisProp("strokewidth"),s=t.point2.evalVisProp("size")+t.point2.evalVisProp("strokewidth"),r.evFirst&&t.evalVisProp("touchfirstpoint")&&t.point1.evalVisProp("visible")&&(o=e.distance(constants.A.COORDS_BY_SCREEN,i),a=(i.scrCoords[1]-e.scrCoords[1])*n/o,l=(i.scrCoords[2]-e.scrCoords[2])*n/o),r.evLast&&t.evalVisProp("touchlastpoint")&&t.point2.evalVisProp("visible")&&(o=e.distance(constants.A.COORDS_BY_SCREEN,i),c=(i.scrCoords[1]-e.scrCoords[1])*s/o,h=(i.scrCoords[2]-e.scrCoords[2])*s/o),e.setCoordinates(constants.A.COORDS_BY_SCREEN,[e.scrCoords[1]+a,e.scrCoords[2]+l],!1,!0),i.setCoordinates(constants.A.COORDS_BY_SCREEN,[i.scrCoords[1]-c,i.scrCoords[2]-h],!1,!0)),this},setArrowSize:function(t,e){return e.evFirst&&this._setArrowWidth(t.rendNodeTriangleStart,e.showFirst*e.strokeWidth,t.rendNode,e.sizeFirst),e.evLast&&this._setArrowWidth(t.rendNodeTriangleEnd,e.showLast*e.strokeWidth,t.rendNode,e.sizeLast),this},setLineCap:function(t){},drawTicks:function(t){t.rendNode=this.appendChildPrim(this.createPrim("path",t.id),t.evalVisProp("layer")),this.appendNodesToElement(t,"path")},updateTicks:function(t){},drawEllipse:function(t){t.rendNode=this.appendChildPrim(this.createPrim("ellipse",t.id),t.evalVisProp("layer")),this.appendNodesToElement(t,"ellipse"),this.updateEllipse(t)},updateEllipse:function(t){this._updateVisual(t);var e=t.Radius();Math.abs(t.center.coords.usrCoords[0])>math.A.eps&&!isNaN(e+t.center.coords.scrCoords[1]+t.center.coords.scrCoords[2])&&e*t.board.unitX<2e6&&this.updateEllipsePrim(t.rendNode,t.center.coords.scrCoords[1],t.center.coords.scrCoords[2],e*t.board.unitX,e*t.board.unitY),this.setLineCap(t)},drawPolygon:function(t){t.rendNode=this.appendChildPrim(this.createPrim("polygon",t.id),t.evalVisProp("layer")),this.appendNodesToElement(t,"polygon"),this.updatePolygon(t)},updatePolygon:function(t){this._updateVisual(t,{stroke:!0,dash:!0}),this.updatePolygonPrim(t.rendNode,t)},displayCopyright:function(t,e){},drawInternalText:function(t){},updateInternalText:function(t){},drawText:function(t){var e,i,r,n;"html"===t.evalVisProp("display")&&env.A.isBrowser&&"no"!==this.type?((e=this.container.ownerDocument.createElement("div")).style.position="absolute",e.className=t.evalVisProp("cssclass"),r=t.evalVisProp("layer"),utils_type.A.exists(r)||(r=0),i=""===this.container.style.zIndex?0:parseInt(this.container.style.zIndex,10),e.style.zIndex=i+r,this.container.appendChild(e),e.setAttribute("id",this.container.id+"_"+t.id)):e=this.drawInternalText(t),t.rendNode=e,t.htmlStr="",t.visProp.islabel&&utils_type.A.exists(t.visProp.anchor)?(n=t.visProp.anchor.evalVisProp("visible"),t.prepareUpdate().updateVisibility(n)):t.prepareUpdate().updateVisibility(),this.updateText(t)},updateText:function(t){var e,i,r,n,s,o,a,l,c,h,u,d=t.plaintext;if(t.visPropCalc.visible)if(this.updateTextStyle(t,!1),"html"===t.evalVisProp("display")&&"no"!==this.type){if(isNaN(t.coords.scrCoords[1]+t.coords.scrCoords[2])||(i=t.coords.scrCoords[1],i=Math.abs(i)<1e6?i:1e6,"right"===(s=t.getAnchorX())?(e=t.board.canvasWidth-i,h="right"):"middle"===s?(e=i-.5*t.size[0],h="center"):(e=i,h="left"),t.visPropOld.left!==s+e&&("right"===s?(t.rendNode.style.right=e+"px",t.rendNode.style.left="auto"):(t.rendNode.style.left=e+"px",t.rendNode.style.right="auto"),t.visPropOld.left=s+e),i=t.coords.scrCoords[2]+this.vOffsetText,i=Math.abs(i)<1e6?i:1e6,"bottom"===(o=t.getAnchorY())?(e=t.board.canvasHeight-i,u="bottom"):"middle"===o?(e=i-.5*t.size[1],u="center"):(e=i,u="top"),t.visPropOld.top!==o+e&&("bottom"===o?(t.rendNode.style.top="auto",t.rendNode.style.bottom=e+"px"):(t.rendNode.style.bottom="auto",t.rendNode.style.top=e+"px"),t.visPropOld.top=o+e)),t.htmlStr!==d){try{t.type===utils_type.A.OBJECT_TYPE_BUTTON?t.rendNodeButton.innerHTML=d:t.type===utils_type.A.OBJECT_TYPE_CHECKBOX||t.type===utils_type.A.OBJECT_TYPE_INPUT?t.rendNodeLabel.innerHTML=d:t.rendNode.innerHTML=d}catch(e){r=t.rendNode.parentNode,t.rendNode.parentNode.removeChild(t.rendNode),t.rendNode.innerHTML=d,r.appendChild(t.rendNode)}if(t.htmlStr=d,t.evalVisProp("usemathjax"))try{MathJax.typeset?MathJax.typeset([t.rendNode]):MathJax.Hub.Queue(["Typeset",MathJax.Hub,t.rendNode])}catch(t){jxg.A.debug("MathJax (not yet) loaded")}else if(t.evalVisProp("usekatex"))try{(n=0===t.rendNode.innerHTML.indexOf("<span")&&t.rendNode.innerHTML.indexOf("<label")>0&&(t.rendNode.innerHTML.indexOf("<checkbox")>0||t.rendNode.innerHTML.indexOf("<input")>0)?t.rendNodeLabel:0===t.rendNode.innerHTML.indexOf("<button")?t.rendNodeButton:t.rendNode)&&katex.render(d,n,{macros:t.evalVisProp("katexmacros"),throwOnError:!1})}catch(t){jxg.A.debug("KaTeX not loaded (yet)")}else if(t.evalVisProp("useasciimathml"))try{AMprocessNode(t.rendNode,!1)}catch(t){jxg.A.debug("AsciiMathML not loaded (yet)")}}0!==(a=t.evalVisProp("rotate"))&&(a*=Math.PI/180,l=Math.cos(a),c=Math.sin(a),t.rendNode.style.transform="matrix("+[l,-1*c,c,l,0,0].join(",")+")",t.rendNode.style["transform-origin"]=h+" "+u),this.transformRect(t,t.transformations)}else this.updateInternalText(t)},_css2js:function(t){var e,i,r,n,s,o=[],a=utils_type.A.trim(t).replace(/;$/,"").split(";");for(i=a.length,e=0;e<i;++e)""!==utils_type.A.trim(a[e])&&(s=a[e].split(":"),r=utils_type.A.trim(s[0].replace(/-([a-z])/gi,(function(t,e){return e.toUpperCase()}))),n=utils_type.A.trim(s[1]),o.push({key:r,val:n}));return o},updateTextStyle:function(t,e){var i,r,n,s,o,a,l,c,h,u=env.A.isBrowser?t.visProp.display:"internal",d=["rendNode","rendNodeTag","rendNodeLabel"],p=d.length,f=t.evalVisProp("fontunit"),m=["cssdefaultstyle","cssstyle"],g=m.length;if(e?(n=t.evalVisProp("highlightstrokecolor"),r=t.evalVisProp("highlightstrokeopacity"),s=t.evalVisProp("highlightcssclass")):(n=t.evalVisProp("strokecolor"),r=t.evalVisProp("strokeopacity"),s=t.evalVisProp("cssclass")),"no"!==this.type&&("html"===u||"canvas"!==this.type)){for(c=0;c<g;c++)if(""!==(h=t.evalVisProp((e?"highlight":"")+m[c]))&&t.visPropOld[m[c]]!==h){for(a=this._css2js(h),o=0;o<p;o++)if(utils_type.A.exists(t[d[o]]))for(l in a)a.hasOwnProperty(l)&&(t[d[o]].style[a[l].key]=a[l].val);t.visPropOld[m[c]]=h}if(i=t.evalVisProp("fontsize"),t.visPropOld.fontsize!==i){t.needsSizeUpdate=!0;try{for(o=0;o<p;o++)utils_type.A.exists(t[d[o]])&&(t[d[o]].style.fontSize=i+f)}catch(e){for(o=0;o<p;o++)utils_type.A.exists(t[d[o]])&&(t[d[o]].style.fontSize=i)}t.visPropOld.fontsize=i}}return this.setTabindex(t),this.setObjectTransition(t),"html"===u&&"no"!==this.type?(t.visPropOld.cssclass!==s&&(t.rendNode.className=s,t.visPropOld.cssclass=s,t.needsSizeUpdate=!0),this.setObjectStrokeColor(t,n,r)):this.updateInternalTextStyle(t,n,r),t.evalVisProp("aria.enabled")&&this.setARIA(t),this},updateInternalTextStyle:function(t,e,i){this.setObjectStrokeColor(t,e,i)},drawImage:function(t){},updateImage:function(t){this.updateRectPrim(t.rendNode,t.coords.scrCoords[1],t.coords.scrCoords[2]-t.size[1],t.size[0],t.size[1]),this.updateImageURL(t),this.transformRect(t,t.transformations),this._updateVisual(t,{stroke:!0,dash:!0},!0)},joinTransforms:function(t,e){var i,r=t.board.origin.scrCoords[1],n=t.board.origin.scrCoords[2],s=t.board.unitX,o=t.board.unitY,a=e.length,l=[[1,0,0],[-r/s,1/s,0],[n/o,0,-1/o]];for(i=0;i<a;i++)l=math.A.matMatMult(e[i].matrix,l);return math.A.matMatMult([[1,0,0],[r,s,0],[n,0,-o]],l)},transformRect:function(t,e){},updateImageURL:function(t){},updateImageStyle:function(t,e){t.rendNode.className=t.evalVisProp(e?"highlightcssclass":"cssclass")},drawForeignObject:function(t){},updateForeignObject:function(t){},appendChildPrim:function(t,e){},appendNodesToElement:function(t,e){},createPrim:function(t,e){return null},remove:function(t){},makeArrows:function(t,e){},_setArrowWidth:function(t,e,i){},updateEllipsePrim:function(t,e,i,r,n){},updateLinePrim:function(t,e,i,r,n,s){},updatePathPrim:function(t,e,i){},updatePathStringPoint:function(t,e,i){},updatePathStringPrim:function(t){},updatePathStringBezierPrim:function(t){},updatePolygonPrim:function(t,e){},updateRectPrim:function(t,e,i,r,n){},display:function(t,e){t&&(t.visPropOld.visible=e)},hide:function(t){},highlight:function(t,e){var i,r,n;if(this.setObjectTransition(t),!t.visProp.draft){if(t.type===constants.A.OBJECT_TYPE_POLYGON)for(this.setObjectFillColor(t,t.evalVisProp("highlightfillcolor"),t.evalVisProp("highlightfillopacity")),r=t.evalVisProp("highlightbystrokewidth"),i=0;i<t.borders.length;i++)this.highlight(t.borders[i],!r);else t.elementClass===constants.A.OBJECT_CLASS_TEXT?this.updateTextStyle(t,!0):t.type===constants.A.OBJECT_TYPE_IMAGE?(this.updateImageStyle(t,!0),this.setObjectFillColor(t,t.evalVisProp("highlightfillcolor"),t.evalVisProp("highlightfillopacity"))):(this.setObjectStrokeColor(t,t.evalVisProp("highlightstrokecolor"),t.evalVisProp("highlightstrokeopacity")),this.setObjectFillColor(t,t.evalVisProp("highlightfillcolor"),t.evalVisProp("highlightfillopacity")));!e&&t.evalVisProp("highlightstrokewidth")&&(n=Math.max(t.evalVisProp("highlightstrokewidth"),t.evalVisProp("strokewidth")),this.setObjectStrokeWidth(t,n),t.elementClass!==constants.A.OBJECT_CLASS_LINE&&t.elementClass!==constants.A.OBJECT_CLASS_CURVE||this.updatePathWithArrowHeads(t,!0))}return this.setCssClass(t,t.evalVisProp("highlightcssclass")),this},noHighlight:function(t){var e,i;if(this.setObjectTransition(t),!t.evalVisProp("draft")){if(t.type===constants.A.OBJECT_TYPE_POLYGON)for(this.setObjectFillColor(t,t.evalVisProp("fillcolor"),t.evalVisProp("fillopacity")),e=0;e<t.borders.length;e++)this.noHighlight(t.borders[e]);else t.elementClass===constants.A.OBJECT_CLASS_TEXT?this.updateTextStyle(t,!1):t.type===constants.A.OBJECT_TYPE_IMAGE?(this.updateImageStyle(t,!1),this.setObjectFillColor(t,t.evalVisProp("fillcolor"),t.evalVisProp("fillopacity"))):(this.setObjectStrokeColor(t,t.evalVisProp("strokecolor"),t.evalVisProp("strokeopacity")),this.setObjectFillColor(t,t.evalVisProp("fillcolor"),t.evalVisProp("fillopacity")));i=t.evalVisProp("strokewidth"),this.setObjectStrokeWidth(t,i),t.elementClass!==constants.A.OBJECT_CLASS_LINE&&t.elementClass!==constants.A.OBJECT_CLASS_CURVE||this.updatePathWithArrowHeads(t,!1)}return this.setCssClass(t,t.evalVisProp("cssclass")),this},removeDraft:function(t){this.setObjectTransition(t),t.type===constants.A.OBJECT_TYPE_POLYGON?this.setObjectFillColor(t,t.evalVisProp("fillcolor"),t.evalVisProp("fillopacity")):(t.type===constants.A.OBJECT_CLASS_POINT&&this.setObjectFillColor(t,t.evalVisProp("fillcolor"),t.evalVisProp("fillopacity")),this.setObjectStrokeColor(t,t.evalVisProp("strokecolor"),t.evalVisProp("strokeopacity")),this.setObjectStrokeWidth(t,t.evalVisProp("strokewidth")))},setARIA:function(t){},setBuffering:function(t,e){},setCssClass:function(t,e){},setDashStyle:function(t){},setDraft:function(t){if(t.evalVisProp("draft")){var e=t.board.options.elements.draft.color,i=t.board.options.elements.draft.opacity;this.setObjectTransition(t),t.type===constants.A.OBJECT_TYPE_POLYGON?this.setObjectFillColor(t,e,i):(t.elementClass===constants.A.OBJECT_CLASS_POINT?this.setObjectFillColor(t,e,i):this.setObjectFillColor(t,"none",0),this.setObjectStrokeColor(t,e,i),this.setObjectStrokeWidth(t,t.board.options.elements.draft.strokeWidth))}},setGradient:function(t){},setLayer:function(t,e){},setObjectFillColor:function(t,e,i){},setObjectStrokeColor:function(t,e,i){},setObjectStrokeWidth:function(t,e){},setObjectTransition:function(t,e){},setPropertyPrim:function(t,e,i){},setShadow:function(t){},setTabindex:function(t){},show:function(t){},updateGradient:function(t){},suspendRedraw:function(){},unsuspendRedraw:function(){},drawNavigationBar:function(t,e){var i,r,n=function(t){t||(t=window.event),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},s=function(e,s,o,a){var l;o=o||"",(l=i.createElement("span")).innerHTML=e,l.style.paddingLeft="7px",l.style.paddingRight="7px",void 0!==l.classList&&(l.classList.add("JXG_navigation_button"),l.classList.add("JXG_navigation_button_"+a)),l.setAttribute("id",o+"_navigation_"+a),l.setAttribute("aria-hidden","true"),r.appendChild(l),env.A.addEvent(l,"click",(function(e){return utils_type.A.bind(s,t)(),!1}),t),env.A.addEvent(l,"pointerup",n,t),env.A.addEvent(l,"pointerdown",n,t),env.A.addEvent(l,"pointerleave",n,t),env.A.addEvent(l,"mouseup",n,t),env.A.addEvent(l,"mousedown",n,t),env.A.addEvent(l,"touchend",n,t),env.A.addEvent(l,"touchstart",n,t)};env.A.isBrowser&&"no"!==this.type&&(i=t.containerObj.ownerDocument,(r=i.createElement("div")).setAttribute("id",t.container+"_navigationbar"),r.style.color=e.strokecolor,r.style.backgroundColor=e.fillcolor,r.style.padding=e.padding,r.style.position=e.position,r.style.fontSize=e.fontsize,r.style.cursor=e.cursor,r.style.zIndex=e.zindex,t.containerObj.appendChild(r),r.style.right=e.right,r.style.bottom=e.bottom,void 0!==r.classList&&r.classList.add("JXG_navigation"),t.attr.showfullscreen&&s(t.attr.fullscreen.symbol,(function(){t.toFullscreen(t.attr.fullscreen.id)}),t.container,"fullscreen"),t.attr.showscreenshot&&s(t.attr.screenshot.symbol,(function(){window.setTimeout((function(){t.renderer.screenshot(t,"",!1)}),330)}),t.container,"screenshot"),t.attr.showreload&&s("",(function(){t.reload()}),t.container,"reload"),t.attr.showcleartraces&&s("",(function(){t.clearTraces()}),t.container,"cleartraces"),t.attr.shownavigation&&(t.attr.showzoom&&(s("",t.zoomOut,t.container,"out"),s("o",t.zoom100,t.container,"100"),s("+",t.zoomIn,t.container,"in")),s("",t.clickLeftArrow,t.container,"left"),s("",t.clickUpArrow,t.container,"down"),s("",t.clickDownArrow,t.container,"up"),s("",t.clickRightArrow,t.container,"right")))},getElementById:function(t){var e;return utils_type.A.exists(this.container)?(e=this.container.id+"_"+t,utils_type.A.exists(CSS)&&utils_type.A.exists(CSS.escape)&&(e=CSS.escape(e)),this.container.querySelector("#"+e)):""},removeToInsertLater:function(t){var e=t.parentNode,i=t.nextSibling;if(null!==e)return e.removeChild(t),function(){i?e.insertBefore(t,i):e.appendChild(t)}},resize:function(t,e){},createTouchpoints:function(t){},showTouchpoint:function(t){},hideTouchpoint:function(t){},updateTouchpoint:function(t,e){},dumpToDataURI:function(t){},dumpToCanvas:function(t,e,i,r){},screenshot:function(t){}});const renderer_abstract=jxg.A.AbstractRenderer;var UTF8_ACCEPT=0,UTF8D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,10,3,3,3,3,3,3,3,3,3,3,3,3,4,3,3,11,6,6,6,5,8,8,8,8,8,8,8,8,8,8,8,0,12,24,36,60,96,84,12,12,12,48,72,12,12,12,12,12,12,12,12,12,12,12,12,12,0,12,12,12,12,12,0,12,0,12,12,12,24,12,12,12,12,12,24,12,24,12,12,12,12,12,12,12,12,12,24,12,12,12,12,12,24,12,12,12,12,12,12,12,24,12,12,12,12,12,12,12,12,12,36,12,36,12,12,12,36,12,12,12,12,12,36,12,36,12,12,12,36,12,12,12,12,12,12,12,12,12,12];jxg.A.Util=jxg.A.Util||{},jxg.A.Util.UTF8={encode:function(t){var e,i,r="",n=t.length;if(t=t.replace(/\r\n/g,"\n"),"function"==typeof unescape&&"function"==typeof encodeURIComponent)return unescape(encodeURIComponent(t));for(e=0;e<n;e++)(i=t.charCodeAt(e))<128?r+=String.fromCharCode(i):i>127&&i<2048?(r+=String.fromCharCode(i>>6|192),r+=String.fromCharCode(63&i|128)):(r+=String.fromCharCode(i>>12|224),r+=String.fromCharCode(i>>6&63|128),r+=String.fromCharCode(63&i|128));return r},decode:function(t){var e,i,r,n=0,s=0,o=UTF8_ACCEPT,a=[],l=t.length,c=[];for(e=0;e<l;e++)i=t.charCodeAt(e),r=UTF8D[i],s=o!==UTF8_ACCEPT?63&i|s<<6:255>>r&i,(o=UTF8D[256+o+r])===UTF8_ACCEPT&&(s>65535?a.push(55232+(s>>10),56320+(1023&s)):a.push(s),++n%1e4==0&&(c.push(String.fromCharCode.apply(null,a)),a=[]));return c.push(String.fromCharCode.apply(null,a)),c.join("")},asciiCharCodeAt:function(t,e){var i=t.charCodeAt(e);if(i>255)switch(i){case 8364:i=128;break;case 8218:i=130;break;case 402:i=131;break;case 8222:i=132;break;case 8230:i=133;break;case 8224:i=134;break;case 8225:i=135;break;case 710:i=136;break;case 8240:i=137;break;case 352:i=138;break;case 8249:i=139;break;case 338:i=140;break;case 381:i=142;break;case 8216:i=145;break;case 8217:i=146;break;case 8220:i=147;break;case 8221:i=148;break;case 8226:i=149;break;case 8211:i=150;break;case 8212:i=151;break;case 732:i=152;break;case 8482:i=153;break;case 353:i=154;break;case 8250:i=155;break;case 339:i=156;break;case 382:i=158;break;case 376:i=159}return i}};const utils_encoding=jxg.A.Util.UTF8;var alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",pad="=";jxg.A.Util=jxg.A.Util||{},jxg.A.Util.Base64={_getByte:function(t,e){return 255&t.charCodeAt(e)},_getIndex:function(t,e){return alphabet.indexOf(t.charAt(e))},encode:function(t){var e,i,r,n,s,o=[];for(n=(r=(s=utils_encoding.encode(t)).length)%3,e=0;e<r-n;e+=3)i=this._getByte(s,e)<<16|this._getByte(s,e+1)<<8|this._getByte(s,e+2),o.push(alphabet.charAt(i>>18),alphabet.charAt(i>>12&63),alphabet.charAt(i>>6&63),alphabet.charAt(63&i));switch(n){case 1:i=this._getByte(s,r-1),o.push(alphabet.charAt(i>>2),alphabet.charAt(i<<4&63),pad,pad);break;case 2:i=this._getByte(s,r-2)<<8|this._getByte(s,r-1),o.push(alphabet.charAt(i>>10),alphabet.charAt(i>>4&63),alphabet.charAt(i<<2&63),pad)}return o.join("")},decode:function(t,e){var i,r,n,s,o,a,l=[],c=[];if((n=(i=t.replace(/[^A-Za-z0-9+/=]/g,"")).length)%4!=0)throw new Error("JSXGraph/utils/base64: Can't decode string (invalid input length).");for(i.charAt(n-1)===pad&&(s=1,i.charAt(n-2)===pad&&(s=2),n-=4),r=0;r<n;r+=4)o=this._getIndex(i,r)<<18|this._getIndex(i,r+1)<<12|this._getIndex(i,r+2)<<6|this._getIndex(i,r+3),c.push(o>>16,o>>8&255,255&o),r%1e4==0&&(l.push(String.fromCharCode.apply(null,c)),c=[]);switch(s){case 1:o=this._getIndex(i,n)<<12|this._getIndex(i,n+1)<<6|this._getIndex(i,n+2),c.push(o>>10,o>>2&255);break;case 2:o=this._getIndex(i,r)<<6|this._getIndex(i,r+1),c.push(o>>4)}return l.push(String.fromCharCode.apply(null,c)),a=l.join(""),e&&(a=utils_encoding.decode(a)),a},decodeAsArray:function(t){var e,i=this.decode(t),r=[],n=i.length;for(e=0;e<n;e++)r[e]=i.charCodeAt(e);return r}};const base64=jxg.A.Util.Base64;jxg.A.FileReader={handleRemoteFile:function(t,e,i,r,n,s){var o=!1;try{o=new XMLHttpRequest,"raw"===i.toLowerCase()?o.overrideMimeType("text/plain; charset="+n):o.overrideMimeType("text/xml; charset="+n)}catch(t){try{o=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{o=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){o=!1}}}if(o){o.open("GET",t,r),"raw"===i.toLowerCase()?this.cbp=function(){var t=o;4===t.readyState&&e(t.responseText)}:this.cbp=function(){var t=o,r="";4===t.readyState&&(r=!utils_type.A.exists(t.responseStream)||"PK"!==t.responseText.slice(0,2)&&31!==utils_encoding.asciiCharCodeAt(t.responseText.slice(0,1),0)?t.responseText:base64.decode(jxgBinFileReader(t)),this.parseString(r,e,i,s))},this.cb=utils_type.A.bind(this.cbp,this),o.onreadystatechange=this.cb;try{o.send(null)}catch(e){throw new Error("JSXGraph: A problem occurred while trying to read remote file '"+t+"'.")}}else jxg.A.debug("AJAX not activated!")},handleLocalFile:function(t,e,i,r,n,s){utils_type.A.exists(r)||(r=!0),"raw"===i.toLowerCase()?this.cbp=function(t){e(t.target.result)}:this.cbp=function(t){var r=t.target.result;this.parseString(r,e,i,s)},this.cb=utils_type.A.bind(this.cbp,this);var o=new FileReader;o.onload=this.cb,"raw"===i.toLowerCase()?o.readAsText(t):o.readAsText(t,n)},parseFileContent:function(t,e,i,r,n,s){utils_type.A.isString(t)||void 0===FileReader?this.handleRemoteFile(t,e,i,r,n,s):this.handleLocalFile(t,e,i,r,n,s)},parseString:function(t,e,i,r){var n;if(i=i.toLowerCase(),n=jxg.A.readers[i],utils_type.A.exists(n))new n(e,t).read();else if("jessiecode"!==i)throw new Error("JSXGraph: There is no reader available for '"+i+"'.");utils_type.A.isFunction(r)&&r(e)}},!env.A.isMetroApp()&&env.A.isBrowser&&"object"==typeof navigator&&/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)&&document&&document.write&&document.write('<script type="text/vbscript">\nFunction Base64Encode(inData)\n  Const Base64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"\n  Dim cOut, sOut, I\n  For I = 1 To LenB(inData) Step 3\n    Dim nGroup, pOut, sGroup\n    nGroup = &H10000 * AscB(MidB(inData, I, 1)) + _\n      &H100 * MyASC(MidB(inData, I + 1, 1)) + MyASC(MidB(inData, I + 2, 1))\n    nGroup = Oct(nGroup)\n    nGroup = String(8 - Len(nGroup), "0") & nGroup\n    pOut = Mid(Base64, CLng("&o" & Mid(nGroup, 1, 2)) + 1, 1) + _\n      Mid(Base64, CLng("&o" & Mid(nGroup, 3, 2)) + 1, 1) + _\n      Mid(Base64, CLng("&o" & Mid(nGroup, 5, 2)) + 1, 1) + _\n      Mid(Base64, CLng("&o" & Mid(nGroup, 7, 2)) + 1, 1)\n    sOut = sOut + pOut\n  Next\n  Select Case LenB(inData) Mod 3\n    Case 1: \'8 bit final\n      sOut = Left(sOut, Len(sOut) - 2) + "=="\n    Case 2: \'16 bit final\n      sOut = Left(sOut, Len(sOut) - 1) + "="\n  End Select\n  Base64Encode = sOut\nEnd Function\n\nFunction MyASC(OneChar)\n  If OneChar = "" Then MyASC = 0 Else MyASC = AscB(OneChar)\nEnd Function\n\nFunction jxgBinFileReader(xhr)\n    Dim byteString\n    Dim b64String\n    Dim i\n    byteString = xhr.responseBody\n    ReDim byteArray(LenB(byteString))\n    For i = 1 To LenB(byteString)\n        byteArray(i-1) = AscB(MidB(byteString, i, 1))\n    Next\n    b64String = Base64Encode(byteString)\n    jxgBinFileReader = b64String\nEnd Function\n<\/script>\n');const reader_file=jxg.A.FileReader;var geonext=__webpack_require__(703),jessiecode=__webpack_require__(219),utils_color=__webpack_require__(194);jxg.A.Composition=function(t){var e,i=this,r=["setAttribute","setParents","prepareUpdate","updateRenderer","update","fullUpdate","highlight","noHighlight"],n=function(t){return function(){var e;for(e in i.elements)i.elements.hasOwnProperty(e)&&utils_type.A.exists(i.elements[e][t])&&i.elements[e][t].apply(i.elements[e],arguments);return i}};for(e=0;e<r.length;e++)this[r[e]]=n(r[e]);for(e in this.elements={},this.objects=this.elements,this.elementsByName={},this.objectsList=[],this.groups={},this.methodMap={setAttribute:"setAttribute",setProperty:"setAttribute",setParents:"setParents",add:"add",remove:"remove",select:"select"},t)t.hasOwnProperty(e)&&this.add(e,t[e]);this.dump=!0,this.subs={}},jxg.A.extend(jxg.A.Composition.prototype,{add:function(t,e){return!(utils_type.A.exists(this[t])||!utils_type.A.exists(e)||(utils_type.A.exists(e.id)?this.elements[e.id]=e:this.elements[t]=e,utils_type.A.exists(e.name)&&(this.elementsByName[e.name]=e),e.on("attribute:name",this.nameListener,this),this.objectsList.push(e),this[t]=e,this.methodMap[t]=e,0))},remove:function(t){var e,i=!1;for(e in this.elements)if(this.elements.hasOwnProperty(e)&&this.elements[e].id===this[t].id){i=!0;break}return i&&(delete this.elements[this[t].id],delete this[t]),i},nameListener:function(t,e,i){delete this.elementsByName[t],this.elementsByName[e]=i},select:function(t){return utils_type.A.exists(jxg.A.Board)?jxg.A.Board.prototype.select.call(this,t):new jxg.A.Composition},getParents:function(){return this.parents},getType:function(){return this.elType},getAttributes:function(){var t,e={};for(t in this.subs)this.subs.hasOwnProperty(t)&&(e[t]=this.subs[t].visProp);return this.attr}});const composition=jxg.A.Composition;jxg.A.Board=function(t,e,i,r,n,s,o,a,l,c,h){if(this.BOARD_MODE_NONE=0,this.BOARD_MODE_DRAG=1,this.BOARD_MODE_MOVE_ORIGIN=2,this.BOARD_MODE_ZOOM=17,this.BOARD_QUALITY_LOW=1,this.BOARD_QUALITY_HIGH=2,utils_type.A.exists(h.document)&&!1!==h.document?this.document=h.document:env.A.isBrowser&&(this.document=document),this.container="",this.id="",this.containerObj=null,utils_type.A.isString(t)?(this.container=t,this.containerObj=env.A.isBrowser?this.document.getElementById(this.container):null):env.A.isBrowser&&(this.containerObj=t,this.container=this.containerObj.getAttribute("id"),null===this.container&&(this.container="null"+parseInt(16777216*Math.random()).toString())),env.A.isBrowser&&"no"!==e.type&&null===this.containerObj)throw new Error('\nJSXGraph: HTML container element "'+t+'" not found.');utils_type.A.exists(i)&&""!==i&&env.A.isBrowser&&!utils_type.A.exists(this.document.getElementById(i))?this.id=i:this.id=this.generateId(),this.renderer=e,this.grids=[],this.options=utils_type.A.deepCopy(src_options.A),this.attr=h,"default"!==this.attr.theme&&utils_type.A.exists(jxg.A.themes[this.attr.theme])&&utils_type.A.mergeAttr(this.options,jxg.A.themes[this.attr.theme],!0),this.dimension=2,this.jc=new jessiecode.A,this.jc.use(this),this.origin={},this.origin.usrCoords=[1,0,0],this.origin.scrCoords=[1,r[0],r[1]],this.zoomX=n,this.zoomY=s,this.unitX=o*this.zoomX,this.unitY=a*this.zoomY,this.keepaspectratio=!1,this.canvasWidth=l,this.canvasHeight=c,utils_event.A.eventify(this),this.hooks=[],this.dependentBoards=[],this.inUpdate=!1,this.objects={},this.objectsList=[],this.groups={},this.animationObjects={},this.highlightedObjects={},this.numObjects=0,this.elementsByName={},this.mode=this.BOARD_MODE_NONE,this.updateQuality=this.BOARD_QUALITY_HIGH,this.isSuspendedRedraw=!1,this.calculateSnapSizes(),this.drag_dx=0,this.drag_dy=0,this.drag_position=[0,0],this.mouse={},this.touches=[],this.xmlString="",this.cPos=[],this.touchMoveLast=0,this.touchMoveLastId=1/0,this.positionAccessLast=0,this.downObjects=[],this.clickObjects={},this.focusObjects=[],this.attr.showcopyright&&this.renderer.displayCopyright(constants.A.licenseText,parseInt(this.options.text.fontSize,10)),this.needsFullUpdate=!1,this.reducedUpdate=!1,this.currentCBDef="none",this.geonextCompatibilityMode=!1,this.options.text.useASCIIMathML&&translateASCIIMath?init():this.options.text.useASCIIMathML=!1,this.hasMouseHandlers=!1,this.hasTouchHandlers=!1,this.hasPointerHandlers=!1,this.hasWheelHandlers=!1,this.hasMouseUp=!1,this.hasTouchEnd=!1,this.hasPointerUp=!1,this.resizeHandlers=[],this._drag_offset=[0,0],this._inputDevice="mouse",this._board_touches=[],this.selectingMode=!1,this.isSelecting=!1,this._isScrolling=!1,this._isResizing=!1,this._change3DView=!1,this.selectingBox=[[0,0],[0,0]],this.userLog=[],this.mathLib=Math,this.mathLibJXG=jxg.A.Math,!0===this.attr.registerevents?this.attr.registerevents={fullscreen:!0,keyboard:!0,pointer:!0,resize:!0,wheel:!0}:"object"==typeof this.attr.registerevents&&(utils_type.A.exists(this.attr.registerevents.fullscreen)||(this.attr.registerevents.fullscreen=!0),utils_type.A.exists(this.attr.registerevents.keyboard)||(this.attr.registerevents.keyboard=!0),utils_type.A.exists(this.attr.registerevents.pointer)||(this.attr.registerevents.pointer=!0),utils_type.A.exists(this.attr.registerevents.resize)||(this.attr.registerevents.resize=!0),utils_type.A.exists(this.attr.registerevents.wheel)||(this.attr.registerevents.wheel=!0)),!1!==this.attr.registerevents&&(this.attr.registerevents.fullscreen&&this.addFullscreenEventHandlers(),this.attr.registerevents.keyboard&&this.addKeyboardEventHandlers(),this.attr.registerevents.pointer&&this.addEventHandlers(),this.attr.registerevents.resize&&this.addResizeEventHandlers(),this.attr.registerevents.wheel&&this.addWheelEventHandlers()),this.methodMap={update:"update",fullUpdate:"fullUpdate",on:"on",off:"off",trigger:"trigger",setAttribute:"setAttribute",setBoundingBox:"setBoundingBox",setView:"setBoundingBox",getBoundingBox:"getBoundingBox",BoundingBox:"getBoundingBox",getView:"getBoundingBox",View:"getBoundingBox",migratePoint:"migratePoint",colorblind:"emulateColorblindness",suspendUpdate:"suspendUpdate",unsuspendUpdate:"unsuspendUpdate",clearTraces:"clearTraces",left:"clickLeftArrow",right:"clickRightArrow",up:"clickUpArrow",down:"clickDownArrow",zoomIn:"zoomIn",zoomOut:"zoomOut",zoom100:"zoom100",zoomElements:"zoomElements",remove:"removeObject",removeObject:"removeObject"}},jxg.A.extend(jxg.A.Board.prototype,{generateName:function(t){var e,i,r=this.attr.maxnamelength,n="",s="",o=[],a="";if(t.type===constants.A.OBJECT_TYPE_TICKS)return"";for(e=utils_type.A.isPoint(t)||utils_type.A.isPoint3D(t)?["","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]:t.type===constants.A.OBJECT_TYPE_ANGLE?["","&alpha;","&beta;","&gamma;","&delta;","&epsilon;","&zeta;","&eta;","&theta;","&iota;","&kappa;","&lambda;","&mu;","&nu;","&xi;","&omicron;","&pi;","&rho;","&sigma;","&tau;","&upsilon;","&phi;","&chi;","&psi;","&omega;"]:["","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],utils_type.A.isPoint(t)||utils_type.A.isPoint3D(t)||t.elementClass===constants.A.OBJECT_CLASS_LINE||t.type===constants.A.OBJECT_TYPE_ANGLE||(n=t.type===constants.A.OBJECT_TYPE_POLYGON?"P_{":t.elementClass===constants.A.OBJECT_CLASS_CIRCLE?"k_{":t.elementClass===constants.A.OBJECT_CLASS_TEXT?"t_{":"s_{",s="}"),i=0;i<r;i++)o[i]=0;for(;o[r-1]<e.length;){for(o[0]=1;o[0]<e.length;o[0]++){for(a=n,i=r;i>0;i--)a+=e[o[i-1]];if(!utils_type.A.exists(this.elementsByName[a+s]))return a+s}for(o[0]=e.length,i=1;i<r;i++)o[i-1]===e.length&&(o[i-1]=1,o[i]+=1)}return""},generateId:function(){for(var t=1;utils_type.A.exists(jxg.A.boards["jxgBoard"+t]);)t=Math.round(16777216*Math.random());return"jxgBoard"+t},setId:function(t,e){var i,r=this.numObjects,n=t.id;if(this.numObjects+=1,""===n||!utils_type.A.exists(n))for(n=this.id+e+r;utils_type.A.exists(this.objects[n]);)i=Math.round(65535*Math.random()),n=this.id+e+r+"-"+i;return t.id=n,this.objects[n]=t,t._pos=this.objectsList.length,this.objectsList[this.objectsList.length]=t,n},finalizeAdding:function(t){!1===t.evalVisProp("visible")&&this.renderer.display(t,!1)},finalizeLabel:function(t){t.hasLabel&&!t.label.evalVisProp("islabel")&&!1===t.label.evalVisProp("visible")&&this.renderer.display(t.label,!1)},checkFrameRate:function(t){var e=!1,i=(new Date).getTime();return utils_type.A.exists(t.pointerId)&&this.touchMoveLastId!==t.pointerId&&(e=!0,this.touchMoveLastId=t.pointerId),!e&&(i-this.touchMoveLast)*this.attr.maxframerate>=1e3&&(e=!0),e&&(this.touchMoveLast=i),e},getCoordsTopLeftCorner:function(){var t,e,i,r,n,s=this.document.ownerDocument||this.document,o=s.documentElement||this.document.body.parentNode,a=s.body,l=this.containerObj;if(this.cPos.length>0&&(this.mode===this.BOARD_MODE_DRAG||this.mode===this.BOARD_MODE_MOVE_ORIGIN||(new Date).getTime()-this.positionAccessLast<1e3))return this.cPos;if(this.positionAccessLast=(new Date).getTime(),l.getBoundingClientRect){for(i=l.getBoundingClientRect(),r=1,n=l;n&&utils_type.A.exists(n.parentNode);)utils_type.A.exists(n.style)&&utils_type.A.exists(n.style.zoom)&&""!==n.style.zoom&&(r*=parseFloat(n.style.zoom)),n=n.parentNode;return(t=[i.left*r,i.top*r])[0]+=env.A.getProp(l,"border-left-width"),t[1]+=env.A.getProp(l,"border-top-width"),"vml"!==this.renderer.type&&(t[0]+=env.A.getProp(l,"padding-left"),t[1]+=env.A.getProp(l,"padding-top")),this.cPos=t.slice(),this.cPos}return t=env.A.getOffset(l),e=this.document.documentElement.ownerDocument,!this.containerObj.currentStyle&&e.defaultView&&(t[0]+=env.A.getProp(o,"margin-left"),t[1]+=env.A.getProp(o,"margin-top"),t[0]+=env.A.getProp(o,"border-left-width"),t[1]+=env.A.getProp(o,"border-top-width"),t[0]+=env.A.getProp(o,"padding-left"),t[1]+=env.A.getProp(o,"padding-top")),a&&(t[0]+=env.A.getProp(a,"left"),t[1]+=env.A.getProp(a,"top")),"object"==typeof google&&google.translate&&(t[0]+=10,t[1]+=25),t[0]+=env.A.getProp(l,"border-left-width"),t[1]+=env.A.getProp(l,"border-top-width"),"vml"!==this.renderer.type&&(t[0]+=env.A.getProp(l,"padding-left"),t[1]+=env.A.getProp(l,"padding-top")),t[0]+=this.attr.offsetx,t[1]+=this.attr.offsety,this.cPos=t.slice(),this.cPos},getPointLoc:function(t,e){var i,r,n,s;return i=this.getBoundingBox(),2===(r=t).length&&r.unshift(void 0),n=[0,0],s=e||0,utils_type.A.isNumber(s)&&(s=[s,s,s,s]),r[1]>i[2]-s[1]&&(n[0]=1),r[1]<i[0]+s[3]&&(n[0]=-1),r[2]>i[1]-s[0]&&(n[1]=1),r[2]<i[3]+s[2]&&(n[1]=-1),n},getLocationOrigin:function(t){return this.getPointLoc([0,0],t)},getMousePosition:function(t,e){var i,r,n=this.getCoordsTopLeftCorner();return i=env.A.getPosition(t,e,this.document),this.updateCSSTransforms(),r=[1,i[0]-n[0],i[1]-n[1]],(r=math.A.matVecMult(this.cssTransMat,r))[1]/=r[0],r[2]/=r[0],[r[1],r[2]]},initMoveOrigin:function(t,e){this.drag_dx=t-this.origin.scrCoords[1],this.drag_dy=e-this.origin.scrCoords[2],this.mode=this.BOARD_MODE_MOVE_ORIGIN,this.updateQuality=this.BOARD_QUALITY_LOW},initMoveObject:function(t,e,i,r){var n,s,o,a=[],l=[],c=this.objectsList.length,h={visProp:{layer:-1e4}};for(this._shiftKey=i.shiftKey,this._ctrlKey=i.ctrlKey,s=0;s<c;s++)o=(n=this.objectsList[s]).hasPoint&&n.hasPoint(t,e),n.visPropCalc.visible&&o&&(n.triggerEventHandlers([r+"down","down"],[i]),this.downObjects.push(n)),o&&n.isDraggable&&n.visPropCalc.visible&&(this.geonextCompatibilityMode&&(utils_type.A.isPoint(n)||n.elementClass===constants.A.OBJECT_CLASS_TEXT)||!this.geonextCompatibilityMode)&&!n.evalVisProp("fixed")&&(n.visProp.layer>h.visProp.layer||n.visProp.layer===h.visProp.layer&&n.lastDragTime.getTime()>=h.lastDragTime.getTime())&&(this.attr.ignorelabels&&utils_type.A.exists(h.label)&&n===h.label||(h=n,a.push(h),utils_type.A.exists(h.coords)?h.elementClass===constants.A.OBJECT_CLASS_POINT||h.relativeCoords?l.push(statistics.A.subtract(h.coords.scrCoords.slice(1),[t,e])):l.push(statistics.A.subtract(h.actualCoords.scrCoords.slice(1),[t,e])):l.push([0,0])));return this.attr.drag.enabled&&a.length>0&&(this.mode=this.BOARD_MODE_DRAG),this.attr.takefirst?(a.length=1,this._drag_offset=l[0]):(a=a.slice(-1),this._drag_offset=l[l.length-1]),this._drag_offset||(this._drag_offset=[0,0]),"svg"===this.renderer.type&&utils_type.A.exists(a[0])&&a[0].evalVisProp("dragtotopoflayer")&&1===a.length&&utils_type.A.exists(a[0].rendNode)&&a[0].rendNode.parentNode.appendChild(a[0].rendNode),a.length>=1&&(a[0].highlight(!0),this.triggerEventHandlers(["mousehit","hit"],[i,a[0]])),a},moveObject:function(t,e,i,r,n){var s,o,a,l=new base_coords.A(constants.A.COORDS_BY_SCREEN,this.getScrCoordsOfMouse(t,e),this);i&&i.obj&&((s=i.obj).coords&&(o=s.coords.scrCoords.slice()),this.addLogEntry("drag",s,l.usrCoords.slice(1)),this.drag_position=[l.scrCoords[1],l.scrCoords[2]],this.drag_position=statistics.A.add(this.drag_position,this._drag_offset),this._shiftKey=r.shiftKey,this._ctrlKey=r.ctrlKey,utils_type.A.exists(s.coords)?s.setPositionDirectly(constants.A.COORDS_BY_SCREEN,this.drag_position,[t,e]):(this.displayInfobox(!1),isNaN(i.targets[0].Xprev+i.targets[0].Yprev)||s.setPositionDirectly(constants.A.COORDS_BY_SCREEN,[l.scrCoords[1],l.scrCoords[2]],[i.targets[0].Xprev,i.targets[0].Yprev]),i.targets[0].Xprev=l.scrCoords[1],i.targets[0].Yprev=l.scrCoords[2]),utils_type.A.exists(s.coords)&&(s.prepareUpdate().update(!1).updateRenderer(),this.updateInfobox(s),s.prepareUpdate().update(!0).updateRenderer()),s.coords&&(a=s.coords.scrCoords),s.coords&&o[1]===a[1]&&o[2]===a[2]||(s.triggerEventHandlers([n+"drag","drag"],[r]),this.update(s)),s.highlight(!0),this.triggerEventHandlers(["mousehit","hit"],[r,s]),s.lastDragTime=new Date)},twoFingerMove:function(t,e,i){var r;utils_type.A.exists(t)&&utils_type.A.exists(t.obj)&&((r=t.obj).elementClass===constants.A.OBJECT_CLASS_LINE||r.type===constants.A.OBJECT_TYPE_POLYGON?this.twoFingerTouchObject(t.targets,r,e):r.elementClass===constants.A.OBJECT_CLASS_CIRCLE&&this.twoFingerTouchCircle(t.targets,r,e),i&&r.triggerEventHandlers(["touchdrag","drag"],[i]))},getTwoFingerTransform(t,e,i,r){var n,s,o,a,l,c,h,u,d,p,f,m,g,_,v,y,b;return s=(n=new base_coords.A(constants.A.COORDS_BY_SCREEN,[t.Xprev,t.Yprev],this).usrCoords)[1],o=n[2],a=(n=new base_coords.A(constants.A.COORDS_BY_SCREEN,[e.Xprev,e.Yprev],this).usrCoords)[1],l=n[2],u=(n=new base_coords.A(constants.A.COORDS_BY_SCREEN,[t.X,t.Y],this).usrCoords)[1],d=n[2],_=((m=(p=(n=new base_coords.A(constants.A.COORDS_BY_SCREEN,[e.X,e.Y],this).usrCoords)[1])-u)*(c=a-s)+(g=(f=n[2])-d)*(h=l-o))/(y=c*c+h*h),v=(g*c-m*h)/y,i||(_/=b=math.A.hypot(_,v),v/=b),r||(v=0),[1,0,0,.5*(u+p-_*(s+a)+v*(o+l)),_,-v,.5*(d+f-v*(s+a)-_*(o+l)),v,_]},twoFingerTouchObject:function(t,e,i){var r,n,s,o,a,l=!1;if(utils_type.A.exists(t[0])&&utils_type.A.exists(t[1])&&!isNaN(t[0].Xprev+t[0].Yprev+t[1].Xprev+t[1].Yprev)){if(n=this.getTwoFingerTransform(t[0],t[1],e.evalVisProp("scalable"),e.evalVisProp("rotatable")),(r=this.create("transform",n,{type:"generic"})).update(),e.elementClass===constants.A.OBJECT_CLASS_LINE)s=[],e.point1.draggable()&&s.push(e.point1),e.point2.draggable()&&s.push(e.point2),r.applyOnce(s);else if(e.type===constants.A.OBJECT_TYPE_POLYGON){for(a=e.vertices.length-1,l=e.evalVisProp("snaptogrid")||e.evalVisProp("snaptopoints"),o=0;o<a&&!l;++o)l=(l=l||e.vertices[o].evalVisProp("snaptogrid")||e.vertices[o].evalVisProp("snaptopoints"))||!e.vertices[o].draggable();if(!l){for(s=[],o=0;o<a;++o)e.vertices[o].draggable()&&s.push(e.vertices[o]);r.applyOnce(s)}}this.update(),e.highlight(!0)}},twoFingerTouchCircle:function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p;"pointCircle"!==e.method&&"pointLine"!==e.method&&utils_type.A.exists(t[0])&&utils_type.A.exists(t[1])&&!isNaN(t[0].Xprev+t[0].Yprev+t[1].Xprev+t[1].Yprev)&&(i===t[0].num?(r=t[1],n=t[0]):(r=t[0],n=t[1]),a=new base_coords.A(constants.A.COORDS_BY_SCREEN,[r.Xprev,r.Yprev],this).usrCoords,o=new base_coords.A(constants.A.COORDS_BY_SCREEN,[n.Xprev,n.Yprev],this).usrCoords,s=new base_coords.A(constants.A.COORDS_BY_SCREEN,[n.X,n.Y],this).usrCoords,c=geometry.A.rad(o.slice(1),a.slice(1),s.slice(1)),h=this.create("transform",[-a[1],-a[2]],{type:"translate"}),u=this.create("transform",[c],{type:"rotate"}),h.melt(u),e.evalVisProp("scalable")&&(l=geometry.A.distance(a,s)/geometry.A.distance(a,o),d=this.create("transform",[l,l],{type:"scale"}),h.melt(d)),p=this.create("transform",[a[1],a[2]],{type:"translate"}),h.melt(p),e.center.draggable()&&h.applyOnce([e.center]),"twoPoints"===e.method?e.point2.draggable()&&h.applyOnce([e.point2]):"pointRadius"===e.method&&utils_type.A.isNumber(e.updateRadius.origin)&&e.setRadius(e.radius*l),this.update(e.center),e.highlight(!0))},highlightElements:function(t,e,i,r){var n,s,o,a={},l=this.objectsList.length;for(n=0;n<l;n++)o=(s=this.objectsList[n]).id,utils_type.A.exists(s.hasPoint)&&s.visPropCalc.visible&&s.hasPoint(t,e)&&(this.updateInfobox(s),utils_type.A.exists(this.highlightedObjects[o])||(a[o]=s,s.highlight(),this.triggerEventHandlers(["mousehit","hit"],[i,s,r])),s.mouseover?s.triggerEventHandlers(["mousemove","move"],[i]):(s.triggerEventHandlers(["mouseover","over"],[i]),s.mouseover=!0));for(n=0;n<l;n++)o=(s=this.objectsList[n]).id,s.mouseover&&(a[o]||(s.triggerEventHandlers(["mouseout","out"],[i]),s.mouseover=!1))},saveStartPos:function(t,e){var i,r,n=[];if(t.type===constants.A.OBJECT_TYPE_TICKS)n.push([1,NaN,NaN]);else if(t.elementClass===constants.A.OBJECT_CLASS_LINE)n.push(t.point1.coords.usrCoords),n.push(t.point2.coords.usrCoords);else if(t.elementClass===constants.A.OBJECT_CLASS_CIRCLE)n.push(t.center.coords.usrCoords),"twoPoints"===t.method&&n.push(t.point2.coords.usrCoords);else if(t.type===constants.A.OBJECT_TYPE_POLYGON)for(r=t.vertices.length-1,i=0;i<r;i++)n.push(t.vertices[i].coords.usrCoords);else if(t.type===constants.A.OBJECT_TYPE_SECTOR)n.push(t.point1.coords.usrCoords),n.push(t.point2.coords.usrCoords),n.push(t.point3.coords.usrCoords);else if(utils_type.A.isPoint(t)||t.type===constants.A.OBJECT_TYPE_GLIDER)n.push(t.coords.usrCoords);else if(t.elementClass===constants.A.OBJECT_CLASS_CURVE)t.points.length>0&&n.push(t.points[0].usrCoords);else try{n.push(t.coords.usrCoords)}catch(t){jxg.A.debug("JSXGraph+ saveStartPos: obj.coords.usrCoords not available: "+t)}for(r=n.length,i=0;i<r;i++)e.Zstart.push(n[i][0]),e.Xstart.push(n[i][1]),e.Ystart.push(n[i][2])},mouseOriginMoveStart:function(t){var e,i;return(e=this._isRequiredKeyPressed(t,"pan"))&&(i=this.getMousePosition(t),this.initMoveOrigin(i[0],i[1])),e},mouseOriginMove:function(t){var e,i=this.mode===this.BOARD_MODE_MOVE_ORIGIN;return i&&(e=this.getMousePosition(t),this.moveOrigin(e[0],e[1],!0)),i},touchStartMoveOriginOneFinger:function(t){var e,i,r=t.touches;return(e=this.attr.pan.enabled&&!this.attr.pan.needtwofingers&&1===r.length)&&(i=this.getMousePosition(t,0),this.initMoveOrigin(i[0],i[1])),e},touchOriginMove:function(t){var e,i=this.mode===this.BOARD_MODE_MOVE_ORIGIN;return i&&(e=this.getMousePosition(t,0),this.moveOrigin(e[0],e[1],!0)),i},originMoveEnd:function(){this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode=this.BOARD_MODE_NONE},suppressDefault:function(t){return utils_type.A.exists(t)&&t.preventDefault(),!1},addEventHandlers:function(){env.A.supportsPointerEvents()?this.addPointerEventHandlers():(this.addMouseEventHandlers(),this.addTouchEventHandlers()),null!==this.containerObj&&env.A.addEvent(this.containerObj,"contextmenu",this.suppressDefault,this)},removeEventHandlers:function(){(this.hasPointerHandlers||this.hasMouseHandlers||this.hasTouchHandlers)&&null!==this.containerObj&&env.A.removeEvent(this.containerObj,"contextmenu",this.suppressDefault,this),this.removeMouseEventHandlers(),this.removeTouchEventHandlers(),this.removePointerEventHandlers(),this.removeFullscreenEventHandlers(),this.removeKeyboardEventHandlers(),this.removeResizeEventHandlers()},addResizeEventHandlers:function(){if(this.resizeHandlers=[],env.A.isBrowser){try{this.startResizeObserver(),this.resizeHandlers.push("resizeobserver")}catch(t){env.A.addEvent(window,"resize",this.resizeListener,this),this.startIntersectionObserver(),this.resizeHandlers.push("resize")}env.A.addEvent(window,"scroll",this.scrollListener,this),this.resizeHandlers.push("scroll");try{window.matchMedia("print").addEventListener("change",this.printListenerMatch.bind(this)),window.matchMedia("screen").addEventListener("change",this.printListenerMatch.bind(this)),this.resizeHandlers.push("print")}catch(t){jxg.A.debug("Error adding printListener",t)}}},removeResizeEventHandlers:function(){var t;if(this.resizeHandlers.length>0&&env.A.isBrowser){for(t=0;t<this.resizeHandlers.length;t++)switch(this.resizeHandlers[t]){case"resizeobserver":utils_type.A.exists(this.resizeObserver)&&this.stopResizeObserver();break;case"resize":env.A.removeEvent(window,"resize",this.resizeListener,this),utils_type.A.exists(this.intersectionObserver)&&this.stopIntersectionObserver();break;case"scroll":env.A.removeEvent(window,"scroll",this.scrollListener,this);break;case"print":window.matchMedia("print").removeEventListener("change",this.printListenerMatch.bind(this),!1),window.matchMedia("screen").removeEventListener("change",this.printListenerMatch.bind(this),!1)}this.resizeHandlers=[]}},addPointerEventHandlers:function(){if(!this.hasPointerHandlers&&env.A.isBrowser){var t=this.attr.movetarget||this.containerObj;window.navigator.msPointerEnabled?(env.A.addEvent(this.containerObj,"MSPointerDown",this.pointerDownListener,this),env.A.addEvent(t,"MSPointerMove",this.pointerMoveListener,this)):(env.A.addEvent(this.containerObj,"pointerdown",this.pointerDownListener,this),env.A.addEvent(t,"pointermove",this.pointerMoveListener,this),env.A.addEvent(t,"pointerleave",this.pointerLeaveListener,this),env.A.addEvent(t,"click",this.pointerClickListener,this),env.A.addEvent(t,"dblclick",this.pointerDblClickListener,this)),null!==this.containerObj&&(this.containerObj.style.touchAction="none"),this.hasPointerHandlers=!0}},addMouseEventHandlers:function(){if(!this.hasMouseHandlers&&env.A.isBrowser){var t=this.attr.movetarget||this.containerObj;env.A.addEvent(this.containerObj,"mousedown",this.mouseDownListener,this),env.A.addEvent(t,"mousemove",this.mouseMoveListener,this),env.A.addEvent(t,"click",this.mouseClickListener,this),env.A.addEvent(t,"dblclick",this.mouseDblClickListener,this),this.hasMouseHandlers=!0}},addTouchEventHandlers:function(t){if(!this.hasTouchHandlers&&env.A.isBrowser){var e=this.attr.movetarget||this.containerObj;env.A.addEvent(this.containerObj,"touchstart",this.touchStartListener,this),env.A.addEvent(e,"touchmove",this.touchMoveListener,this),this.hasTouchHandlers=!0}},addWheelEventHandlers:function(){!this.hasWheelHandlers&&env.A.isBrowser&&(env.A.addEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this),env.A.addEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this),this.hasWheelHandlers=!0)},addFullscreenEventHandlers:function(){var t,e=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"],i=e.length;if(!this.hasFullscreenEventHandlers&&env.A.isBrowser){for(t=0;t<i;t++)env.A.addEvent(this.document,e[t],this.fullscreenListener,this);this.hasFullscreenEventHandlers=!0}},addKeyboardEventHandlers:function(){this.attr.keyboard.enabled&&!this.hasKeyboardHandlers&&env.A.isBrowser&&(env.A.addEvent(this.containerObj,"keydown",this.keyDownListener,this),env.A.addEvent(this.containerObj,"focusin",this.keyFocusInListener,this),env.A.addEvent(this.containerObj,"focusout",this.keyFocusOutListener,this),this.hasKeyboardHandlers=!0)},removeKeyboardEventHandlers:function(){this.hasKeyboardHandlers&&env.A.isBrowser&&(env.A.removeEvent(this.containerObj,"keydown",this.keyDownListener,this),env.A.removeEvent(this.containerObj,"focusin",this.keyFocusInListener,this),env.A.removeEvent(this.containerObj,"focusout",this.keyFocusOutListener,this),this.hasKeyboardHandlers=!1)},removeFullscreenEventHandlers:function(){var t,e=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"],i=e.length;if(this.hasFullscreenEventHandlers&&env.A.isBrowser){for(t=0;t<i;t++)env.A.removeEvent(this.document,e[t],this.fullscreenListener,this);this.hasFullscreenEventHandlers=!1}},removePointerEventHandlers:function(){if(this.hasPointerHandlers&&env.A.isBrowser){var t=this.attr.movetarget||this.containerObj;window.navigator.msPointerEnabled?(env.A.removeEvent(this.containerObj,"MSPointerDown",this.pointerDownListener,this),env.A.removeEvent(t,"MSPointerMove",this.pointerMoveListener,this)):(env.A.removeEvent(this.containerObj,"pointerdown",this.pointerDownListener,this),env.A.removeEvent(t,"pointermove",this.pointerMoveListener,this),env.A.removeEvent(t,"pointerleave",this.pointerLeaveListener,this),env.A.removeEvent(t,"click",this.pointerClickListener,this),env.A.removeEvent(t,"dblclick",this.pointerDblClickListener,this)),this.hasWheelHandlers&&(env.A.removeEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this),env.A.removeEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this)),this.hasPointerUp&&(window.navigator.msPointerEnabled?env.A.removeEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(env.A.removeEvent(this.document,"pointerup",this.pointerUpListener,this),env.A.removeEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!1),this.hasPointerHandlers=!1}},removeMouseEventHandlers:function(){if(this.hasMouseHandlers&&env.A.isBrowser){var t=this.attr.movetarget||this.containerObj;env.A.removeEvent(this.containerObj,"mousedown",this.mouseDownListener,this),env.A.removeEvent(t,"mousemove",this.mouseMoveListener,this),env.A.removeEvent(t,"click",this.mouseClickListener,this),env.A.removeEvent(t,"dblclick",this.mouseDblClickListener,this),this.hasMouseUp&&(env.A.removeEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!1),this.hasWheelHandlers&&(env.A.removeEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this),env.A.removeEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this)),this.hasMouseHandlers=!1}},removeTouchEventHandlers:function(){if(this.hasTouchHandlers&&env.A.isBrowser){var t=this.attr.movetarget||this.containerObj;env.A.removeEvent(this.containerObj,"touchstart",this.touchStartListener,this),env.A.removeEvent(t,"touchmove",this.touchMoveListener,this),this.hasTouchEnd&&(env.A.removeEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!1),this.hasTouchHandlers=!1}},clickLeftArrow:function(){return this.moveOrigin(this.origin.scrCoords[1]+.1*this.canvasWidth,this.origin.scrCoords[2]),this},clickRightArrow:function(){return this.moveOrigin(this.origin.scrCoords[1]-.1*this.canvasWidth,this.origin.scrCoords[2]),this},clickUpArrow:function(){return this.moveOrigin(this.origin.scrCoords[1],this.origin.scrCoords[2]-.1*this.canvasHeight),this},clickDownArrow:function(){return this.moveOrigin(this.origin.scrCoords[1],this.origin.scrCoords[2]+.1*this.canvasHeight),this},gestureChangeListener:function(t){var e,i,r,n,s,o,a,l,c,h,u,d,p,f=!1,m=this.attr.zoom.factorx,g=this.attr.zoom.factory,_=!1;return this.mode!==this.BOARD_MODE_ZOOM||(t.preventDefault(),o=geometry.A.distance([t.touches[0].clientX,t.touches[0].clientY],[t.touches[1].clientX,t.touches[1].clientY],2),void 0===t.scale&&(t.scale=o/this.prevDist),!!utils_type.A.exists(this.prevCoords)&&(i=[t.touches[0].clientX-this.prevCoords[0][0],t.touches[0].clientY-this.prevCoords[0][1]],r=[t.touches[1].clientX-this.prevCoords[1][0],t.touches[1].clientY-this.prevCoords[1][1]],i[0]*i[0]+i[1]*i[1]<100&&r[0]*r[0]+r[1]*r[1]<100||(n=geometry.A.rad(i,[0,0],r),"pan"!==this.isPreviousGesture&&Math.abs(n)>.2*Math.PI&&Math.abs(n)<1.8*Math.PI&&(f=!0),"pan"===this.isPreviousGesture||f||(Math.abs(t.scale)<.77||Math.abs(t.scale)>1.3)&&(f=!0),s=t.scale/this.prevScale,this.prevScale=t.scale,this.prevCoords=[[t.touches[0].clientX,t.touches[0].clientY],[t.touches[1].clientX,t.touches[1].clientY]],e=new base_coords.A(constants.A.COORDS_BY_SCREEN,this.getMousePosition(t,0),this),this.attr.pan.enabled&&this.attr.pan.needtwofingers&&!f?(this.isPreviousGesture="pan",this.moveOrigin(e.scrCoords[1],e.scrCoords[2],!0)):this.attr.zoom.enabled&&Math.abs(s-1)<.5&&(_=!1,c=this.attr.zoom.center,(this.attr.zoom.pinchhorizontal||this.attr.zoom.pinchvertical)&&(h=Math.abs(t.touches[0].clientX-t.touches[1].clientX),u=Math.abs(t.touches[0].clientY-t.touches[1].clientY),a=Math.abs(Math.atan2(u,h)),l=Math.PI*this.attr.zoom.pinchsensitivity/90),!this.keepaspectratio&&this.attr.zoom.pinchhorizontal&&a<l?(this.attr.zoom.factorx=s,this.attr.zoom.factory=1,d=0,p=0,_=!0):!this.keepaspectratio&&this.attr.zoom.pinchvertical&&Math.abs(a-.5*Math.PI)<l?(this.attr.zoom.factorx=1,this.attr.zoom.factory=s,d=0,p=0,_=!0):this.attr.zoom.pinch&&(this.attr.zoom.factorx=s,this.attr.zoom.factory=s,d=e.usrCoords[1],p=e.usrCoords[2],_=!0),_&&("board"===c?this.zoomIn():this.zoomIn(d,p),this.attr.zoom.factorx=m,this.attr.zoom.factory=g))),!1))},gestureStartListener:function(t){var e;return t.preventDefault(),this.prevScale=1,this.prevDist=geometry.A.distance([t.touches[0].clientX,t.touches[0].clientY],[t.touches[1].clientX,t.touches[1].clientY],2),this.prevCoords=[[t.touches[0].clientX,t.touches[0].clientY],[t.touches[1].clientX,t.touches[1].clientY]],this.isPreviousGesture="none",e=this.getMousePosition(t,0),this.initMoveOrigin(e[0],e[1]),this.mode=this.BOARD_MODE_ZOOM,!1},_isRequiredKeyPressed:function(t,e){var i=this.attr[e];return!!i.enabled&&!(!(i.needshift&&t.shiftKey||!i.needshift&&!t.shiftKey)||!(i.needctrl&&t.ctrlKey||!i.needctrl&&!t.ctrlKey))},_isPointerRegistered:function(t){var e,i=this._board_touches.length;for(e=0;e<i;e++)if(this._board_touches[e].pointerId===t.pointerId)return!0;return!1},_pointerStorePosition:function(t){var e,i;for(e=0,i=!1;e<this._board_touches.length;e++)if(this._board_touches[e].pointerId===t.pointerId){this._board_touches[e].clientX=t.clientX,this._board_touches[e].clientY=t.clientY,i=!0;break}return!i&&this._board_touches.length<2&&this._board_touches.push({pointerId:t.pointerId,clientX:t.clientX,clientY:t.clientY}),this},_pointerRemoveTouches:function(t){var e;for(e=0;e<this._board_touches.length;e++)if(this._board_touches[e].pointerId===t.pointerId){this._board_touches.splice(e,1);break}return this},_pointerClearTouches:function(t){this._board_touches.length>0&&this.dehighlightAll(),this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode=this.BOARD_MODE_NONE,this._board_touches=[],this.touches=[]},_getPointerInputDevice:function(t){if(env.A.isBrowser){if("touch"===t.pointerType||window.navigator.msMaxTouchPoints&&window.navigator.msMaxTouchPoints>1)return"touch";if("mouse"===t.pointerType)return"mouse";if("pen"===t.pointerType)return"pen"}return"mouse"},pointerDownListener:function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p;if(!e&&this._isPointerRegistered(t))return!1;if(null===utils_type.A.evaluate(this.attr.movetarget)&&utils_type.A.exists(t.target)&&utils_type.A.exists(t.target.releasePointerCapture)&&t.target.releasePointerCapture(t.pointerId),!e&&t.isPrimary,this.hasPointerUp||(window.navigator.msPointerEnabled?env.A.addEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(env.A.addEvent(this.document,"pointerup",this.pointerUpListener,this),env.A.addEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!0),this.hasMouseHandlers&&this.removeMouseEventHandlers(),this.hasTouchHandlers&&this.removeTouchEventHandlers(),this.document.selection&&utils_type.A.isFunction(this.document.selection.empty))this.document.selection.empty();else if(window.getSelection&&(l=window.getSelection()).removeAllRanges)try{l.removeAllRanges()}catch(t){}if(this._inputDevice=this._getPointerInputDevice(t),h=this._inputDevice,this.options.precision.hasPoint=this.options.precision[h],o=this.getMousePosition(t),this._testForSelection(t),this.selectingMode)return this._startSelecting(o),void this.triggerEventHandlers(["touchstartselecting","pointerstartselecting","startselecting"],[t]);if(this.attr.drag.enabled&&e?(a=[e],this.mode=this.BOARD_MODE_DRAG):a=this.initMoveObject(o[0],o[1],t,h),c={num:t.pointerId,X:o[0],Y:o[1],Xprev:NaN,Yprev:NaN,Xstart:[],Ystart:[],Zstart:[]},a.length>0){for(d=a[a.length-1],u=!1,r=0;r<this.touches.length;r++)if(this.touches[r].obj===d){n=r,s=this.touches[r].targets.push(c)-1,u=!0;break}u||(s=0,n=this.touches.push({obj:d,targets:[c]})-1),this.dehighlightAll(),d.highlight(!0),this.saveStartPos(d,this.touches[n].targets[s]),t&&t.preventDefault&&!i&&t.preventDefault()}return this.touches.length>0&&!i&&(t.preventDefault(),t.stopPropagation()),!!env.A.isBrowser&&("touch"!==this._getPointerInputDevice(t)?this.mode===this.BOARD_MODE_NONE&&this.mouseOriginMoveStart(t):(this._pointerStorePosition(t),t.touches=this._board_touches,1===t.touches.length&&this.mode===this.BOARD_MODE_NONE&&this.touchStartMoveOriginOneFinger(t)||2!==t.touches.length||this.mode!==this.BOARD_MODE_NONE&&this.mode!==this.BOARD_MODE_MOVE_ORIGIN||(this.mode===this.BOARD_MODE_MOVE_ORIGIN&&this.originMoveEnd(),this.gestureStartListener(t))),p="none",this.mode!==this.BOARD_MODE_NONE||!0!==utils_type.A.evaluate(this.attr.browserpan)&&!0!==utils_type.A.evaluate(this.attr.browserpan.enabled)||!1!==utils_type.A.evaluate(this.attr.pan.enabled)&&!0!==utils_type.A.evaluate(this.attr.pan.needtwofingers)||(p="auto"),this.containerObj.style.touchAction=p,this.triggerEventHandlers(["touchstart","down","pointerdown","MSPointerDown"],[t]),!0)},_handleClicks:function(t,e){var i,r,n=this;if(this.selectingMode)t.stopPropagation();else{if(r=utils_type.A.evaluate(this.attr.clickdelay),utils_type.A.evaluate(this.attr.dblclicksuppressclick))this._preventSingleClick=!1,this._singleClickTimer=setTimeout((function(){if(!n._preventSingleClick)for(i in n.triggerEventHandlers(e,[t]),n.clickObjects)n.clickObjects.hasOwnProperty(i)&&(n.clickObjects[i].triggerEventHandlers(e,[t]),delete n.clickObjects[i])}),r);else{for(i in n.triggerEventHandlers(e,[t]),n.clickObjects)n.clickObjects.hasOwnProperty(i)&&n.clickObjects[i].triggerEventHandlers(e,[t]);setTimeout((function(){for(i in n.clickObjects)n.clickObjects.hasOwnProperty(i)&&delete n.clickObjects[i]}),r)}t.stopPropagation()}},_handleDblClicks:function(t,e){var i;if(this.selectingMode)t.stopPropagation();else{for(i in this._preventSingleClick=!0,clearTimeout(this._singleClickTimer),this.triggerEventHandlers(e,[t]),this.clickObjects)this.clickObjects.hasOwnProperty(i)&&(this.clickObjects[i].triggerEventHandlers(e,[t]),delete this.clickObjects[i]);t.stopPropagation()}},pointerClickListener:function(t){this._handleClicks(t,["click","pointerclick"])},pointerDblClickListener:function(t){this._handleDblClicks(t,["dblclick","pointerdblclick"])},mouseClickListener:function(t){this._handleClicks(t,["click","mouseclick"])},mouseDblClickListener:function(t){this._handleDblClicks(t,["dblclick","mousedblclick"])},pointerMoveListener:function(t){var e,i,r,n,s,o;if("touch"===this._getPointerInputDevice(t)&&!this._isPointerRegistered(t))return this.BOARD_MODE_NONE;if(!this.checkFrameRate(t))return!1;if(this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1)),this.mode!==this.BOARD_MODE_NONE&&(t.preventDefault(),t.stopPropagation()),this.updateQuality=this.BOARD_QUALITY_LOW,this._inputDevice=this._getPointerInputDevice(t),o=this._inputDevice,this.options.precision.hasPoint=this.options.precision[o],n=.3333*this.options.precision.hasPoint,r=this.getMousePosition(t),null===utils_type.A.evaluate(this.attr.movetarget)&&r[0]<=n||r[1]<=n||r[0]>=this.canvasWidth-n||r[1]>=this.canvasHeight-n)return this.mode===this.BOARD_MODE_NONE;if(this.selectingMode)this._moveSelecting(r),this.triggerEventHandlers(["touchmoveselecting","moveselecting","pointermoveselecting"],[t,this.mode]);else if(!this.mouseOriginMove(t))if(this.mode===this.BOARD_MODE_DRAG){for(e=0;e<this.touches.length;e++)for(s=this.touches[e].targets,i=0;i<s.length;i++)if(s[i].num===t.pointerId){s[i].X=r[0],s[i].Y=r[1],1===s.length?this.moveObject(r[0],r[1],this.touches[e],t,o):2===s.length&&(this.twoFingerMove(this.touches[e],t.pointerId,t),s[i].Xprev=r[0],s[i].Yprev=r[1]);break}}else"touch"===this._getPointerInputDevice(t)&&(this._pointerStorePosition(t),2===this._board_touches.length&&(t.touches=this._board_touches,this.gestureChangeListener(t))),this.highlightElements(r[0],r[1],t,-1);return this.triggerEventHandlers(["pointermove","MSPointerMove","move"],[t,this.mode]),this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode===this.BOARD_MODE_NONE},pointerUpListener:function(t){var e,i,r,n,s,o=!1;if(this.triggerEventHandlers(["touchend","up","pointerup","MSPointerUp"],[t]),this.displayInfobox(!1),t)for(e=0;e<this.touches.length;e++)for(s=this.touches[e].targets,i=0;i<s.length;i++)if(s[i].num===t.pointerId){s.splice(i,1),0===s.length&&this.touches.splice(e,1);break}if(this.originMoveEnd(),this.update(),this.selectingMode)this._stopSelecting(t),this.triggerEventHandlers(["touchstopselecting","pointerstopselecting","stopselecting"],[t]),this.stopSelectionMode();else for(e=this.downObjects.length-1;e>-1;e--){for(r=!1,i=0;i<this.touches.length;i++)this.touches[i].obj.id===this.downObjects[e].id&&(r=!0);r||(this.downObjects[e].triggerEventHandlers(["touchend","up","pointerup","MSPointerUp"],[t]),utils_type.A.exists(this.downObjects[e].coords)||(this.downObjects[e].snapToGrid(),this.downObjects[e].snapToPoints(),o=!0),n=this.downObjects[e].eventHandlers,(utils_type.A.exists(n.click)&&n.click.length>0||utils_type.A.exists(n.pointerclick)&&n.pointerclick.length>0||utils_type.A.exists(n.dblclick)&&n.dblclick.length>0||utils_type.A.exists(n.pointerdblclick)&&n.pointerdblclick.length>0)&&(this.clickObjects[this.downObjects[e].id]=this.downObjects[e]),this.downObjects.splice(e,1))}return this.hasPointerUp&&(window.navigator.msPointerEnabled?env.A.removeEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(env.A.removeEvent(this.document,"pointerup",this.pointerUpListener,this),env.A.removeEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!1),this._pointerClearTouches(t.pointerId),"touch"!==this._getPointerInputDevice(t)&&this.dehighlightAll(),o&&this.update(),!0},pointerLeaveListener:function(t){return this.displayInfobox(!1),this.dehighlightAll(),!0},touchStartListener:function(t){var e,i,r,n,s,o,a,l,c,h,u=this.options.precision.touch,d=t.touches;for(this.hasTouchEnd||(env.A.addEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!0),this.document.selection&&utils_type.A.isFunction(this.document.selection.empty)?this.document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),this._inputDevice="touch",this.options.precision.hasPoint=this.options.precision.touch,e=0;e<d.length;e++)d[e].jxg_isused=!1;for(e=0;e<this.touches.length;e++)for(h=this.touches[e].targets,i=0;i<h.length;i++){h[i].num=-1,u=this.options.precision.touch;do{for(r=0;r<d.length;r++)if(Math.abs(Math.pow(d[r].screenX-h[i].X,2)+Math.pow(d[r].screenY-h[i].Y,2))<u*u){h[i].num=r,h[i].X=d[r].screenX,h[i].Y=d[r].screenY,d[r].jxg_isused=!0;break}u*=2}while(-1===h[i].num&&u<this.options.precision.touchMax);-1===h[i].num&&(jxg.A.debug("i couldn't find a targettouches for target no "+i+" on "+this.touches[e].obj.name+" ("+this.touches[e].obj.id+"). Removed the target."),jxg.A.debug("eps = "+u+", touchMax = "+src_options.A.precision.touchMax),h.splice(e,1))}for(e=0;e<d.length;e++)if(!d[e].jxg_isused){if(n=this.getMousePosition(t,e),this.selectingMode)return this._startSelecting(n),this.triggerEventHandlers(["touchstartselecting","startselecting"],[t]),t.preventDefault(),t.stopPropagation(),this.options.precision.hasPoint=this.options.precision.mouse,this.touches.length>0;if(0!==(s=this.initMoveObject(n[0],n[1],t,"touch")).length)if(o=s[s.length-1],c={num:e,X:d[e].screenX,Y:d[e].screenY,Xprev:NaN,Yprev:NaN,Xstart:[],Ystart:[],Zstart:[]},utils_type.A.isPoint(o)||o.elementClass===constants.A.OBJECT_CLASS_TEXT||o.type===constants.A.OBJECT_TYPE_TICKS||o.type===constants.A.OBJECT_TYPE_IMAGE)l=[c],this.saveStartPos(o,l[0]),this.touches.push({obj:o,targets:l}),o.highlight(!0);else if(o.elementClass===constants.A.OBJECT_CLASS_LINE||o.elementClass===constants.A.OBJECT_CLASS_CIRCLE||o.elementClass===constants.A.OBJECT_CLASS_CURVE||o.type===constants.A.OBJECT_TYPE_POLYGON){for(a=!1,i=0;i<this.touches.length;i++)o.id===this.touches[i].obj.id&&(a=!0,1===this.touches[i].targets.length&&(this.saveStartPos(o,c),this.touches[i].targets.push(c)),d[e].jxg_isused=!0);a||(l=[c],this.saveStartPos(o,l[0]),this.touches.push({obj:o,targets:l}),o.highlight(!0))}d[e].jxg_isused=!0}return this.touches.length>0&&(t.preventDefault(),t.stopPropagation()),1===d.length&&this.mode===this.BOARD_MODE_NONE&&this.touchStartMoveOriginOneFinger(t)||2!==d.length||this.mode!==this.BOARD_MODE_NONE&&this.mode!==this.BOARD_MODE_MOVE_ORIGIN||(this.mode===this.BOARD_MODE_MOVE_ORIGIN&&this.originMoveEnd(),this.gestureStartListener(t)),this.options.precision.hasPoint=this.options.precision.mouse,this.triggerEventHandlers(["touchstart","down"],[t]),!1},touchMoveListener:function(t){var e,i,r,n,s=t.touches;if(!this.checkFrameRate(t))return!1;if(this.mode!==this.BOARD_MODE_NONE&&(t.preventDefault(),t.stopPropagation()),this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1)),this._inputDevice="touch",this.options.precision.hasPoint=this.options.precision.touch,this.updateQuality=this.BOARD_QUALITY_LOW,this.selectingMode){for(e=0;e<s.length;e++)if(!s[e].jxg_isused){i=this.getMousePosition(t,e),this._moveSelecting(i),this.triggerEventHandlers(["touchmoves","moveselecting"],[t,this.mode]);break}}else if(!this.touchOriginMove(t))if(this.mode===this.BOARD_MODE_DRAG){for(e=0;e<this.touches.length;e++)if(1===(n=this.touches[e].targets).length){if(s[n[0].num]){if((i=this.getMousePosition(t,n[0].num))[0]<0||i[0]>this.canvasWidth||i[1]<0||i[1]>this.canvasHeight)return;n[0].X=i[0],n[0].Y=i[1],this.moveObject(i[0],i[1],this.touches[e],t,"touch")}}else if(2===n.length&&n[0].num>-1&&n[1].num>-1&&s[n[0].num]&&s[n[1].num]){if(i=this.getMousePosition(t,n[0].num),r=this.getMousePosition(t,n[1].num),i[0]<0||i[0]>this.canvasWidth||i[1]<0||i[1]>this.canvasHeight||r[0]<0||r[0]>this.canvasWidth||r[1]<0||r[1]>this.canvasHeight)return;n[0].X=i[0],n[0].Y=i[1],n[1].X=r[0],n[1].Y=r[1],this.twoFingerMove(this.touches[e],n[0].num,t),n[0].Xprev=i[0],n[0].Yprev=i[1],n[1].Xprev=r[0],n[1].Yprev=r[1]}}else 2===s.length&&this.gestureChangeListener(t),i=this.getMousePosition(t,0),this.highlightElements(i[0],i[1],t,-1);return this.mode!==this.BOARD_MODE_DRAG&&this.displayInfobox(!1),this.triggerEventHandlers(["touchmove","move"],[t,this.mode]),this.options.precision.hasPoint=this.options.precision.mouse,this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode===this.BOARD_MODE_NONE},touchEndListener:function(t){var e,i,r,n,s,o,a=this.options.precision.touch,l=[],c=t&&t.touches,h=!1;if(this.triggerEventHandlers(["touchend","up"],[t]),this.displayInfobox(!1),this.selectingMode)this._stopSelecting(t),this.triggerEventHandlers(["touchstopselecting","stopselecting"],[t]),this.stopSelectionMode();else if(c&&c.length>0){for(e=0;e<this.touches.length;e++)l[e]=this.touches[e];for(this.touches.length=0,e=0;e<c.length;e++)c[e].jxg_isused=!1;for(e=0;e<l.length;e++){for(n=!1,s=0,o=l[e].targets,i=0;i<o.length;i++)for(o[i].found=!1,r=0;r<c.length;r++)if(Math.abs(Math.pow(c[r].screenX-o[i].X,2)+Math.pow(c[r].screenY-o[i].Y,2))<a*a){o[i].found=!0,o[i].num=r,o[i].X=c[r].screenX,o[i].Y=c[r].screenY,s+=1;break}if(utils_type.A.isPoint(l[e].obj)?n=o[0]&&o[0].found:l[e].obj.elementClass===constants.A.OBJECT_CLASS_LINE?n=o[0]&&o[0].found||o[1]&&o[1].found:l[e].obj.elementClass===constants.A.OBJECT_CLASS_CIRCLE&&(n=1===s||3===s),n)for(this.touches.push({obj:l[e].obj,targets:[]}),i=0;i<o.length;i++)o[i].found&&this.touches[this.touches.length-1].targets.push({num:o[i].num,X:o[i].screenX,Y:o[i].screenY,Xprev:NaN,Yprev:NaN,Xstart:o[i].Xstart,Ystart:o[i].Ystart,Zstart:o[i].Zstart});else l[e].obj.noHighlight()}}else this.touches.length=0;for(e=this.downObjects.length-1;e>-1;e--){for(n=!1,i=0;i<this.touches.length;i++)this.touches[i].obj.id===this.downObjects[e].id&&(n=!0);n||(this.downObjects[e].triggerEventHandlers(["touchup","up"],[t]),utils_type.A.exists(this.downObjects[e].coords)||(this.downObjects[e].snapToGrid(),this.downObjects[e].snapToPoints(),h=!0),this.downObjects.splice(e,1))}return c&&0!==c.length||(this.hasTouchEnd&&(env.A.removeEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!1),this.dehighlightAll(),this.updateQuality=this.BOARD_QUALITY_HIGH,this.originMoveEnd(),h&&this.update()),!0},mouseDownListener:function(t){var e,i,r;if(this.document.selection&&utils_type.A.isFunction(this.document.selection.empty)?this.document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),!this.hasMouseUp)return env.A.addEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!0,this._inputDevice="mouse",this.options.precision.hasPoint=this.options.precision.mouse,e=this.getMousePosition(t),this._testForSelection(t),this.selectingMode?(this._startSelecting(e),void this.triggerEventHandlers(["mousestartselecting","startselecting"],[t])):(0===(i=this.initMoveObject(e[0],e[1],t,"mouse")).length?(this.mode=this.BOARD_MODE_NONE,r=!0):(this.mouse={obj:null,targets:[{X:e[0],Y:e[1],Xprev:NaN,Yprev:NaN}]},this.mouse.obj=i[i.length-1],this.dehighlightAll(),this.mouse.obj.highlight(!0),this.mouse.targets[0].Xstart=[],this.mouse.targets[0].Ystart=[],this.mouse.targets[0].Zstart=[],this.saveStartPos(this.mouse.obj,this.mouse.targets[0]),t&&t.preventDefault?t.preventDefault():window.event&&(window.event.returnValue=!1)),this.mode===this.BOARD_MODE_NONE&&(r=this.mouseOriginMoveStart(t)),this.triggerEventHandlers(["mousedown","down"],[t]),r)},mouseMoveListener:function(t){var e;if(!this.checkFrameRate(t))return!1;e=this.getMousePosition(t),this.updateQuality=this.BOARD_QUALITY_LOW,this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1)),this.selectingMode?(this._moveSelecting(e),this.triggerEventHandlers(["mousemoveselecting","moveselecting"],[t,this.mode])):this.mouseOriginMove(t)||(this.mode===this.BOARD_MODE_DRAG?this.moveObject(e[0],e[1],this.mouse,t,"mouse"):this.highlightElements(e[0],e[1],t,-1),this.triggerEventHandlers(["mousemove","move"],[t,this.mode])),this.updateQuality=this.BOARD_QUALITY_HIGH},mouseUpListener:function(t){var e;if(!1===this.selectingMode&&this.triggerEventHandlers(["mouseup","up"],[t]),this.updateQuality=this.BOARD_QUALITY_HIGH,this.mouse&&this.mouse.obj&&(utils_type.A.exists(this.mouse.obj.coords)||(this.mouse.obj.snapToGrid(this.mouse.targets[0]),this.mouse.obj.snapToPoints())),this.originMoveEnd(),this.dehighlightAll(),this.update(),this.selectingMode)this._stopSelecting(t),this.triggerEventHandlers(["mousestopselecting","stopselecting"],[t]),this.stopSelectionMode();else for(e=0;e<this.downObjects.length;e++)this.downObjects[e].triggerEventHandlers(["mouseup","up"],[t]);this.downObjects.length=0,this.hasMouseUp&&(env.A.removeEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!1),this.mouse=null},mouseWheelListener:function(t){var e,i;return!(this.attr.zoom.enabled&&this.attr.zoom.wheel&&this._isRequiredKeyPressed(t,"zoom")&&(e=(t=t||window.event).detail?-t.detail:t.wheelDelta/40,i="board"===this.attr.zoom.center?[]:new base_coords.A(constants.A.COORDS_BY_SCREEN,this.getMousePosition(t),this).usrCoords,e>0?this.zoomIn(i[1],i[2]):this.zoomOut(i[1],i[2]),this.triggerEventHandlers(["mousewheel"],[t]),t.preventDefault(),1))},keyDownListener:function(t){var e,i,r,n,s,o,a=t.target.id,l=0,c=0,h=utils_type.A.evaluate(this.attr.keyboard.dx)/this.unitX,u=utils_type.A.evaluate(this.attr.keyboard.dy)/this.unitY,d=!1,p=!0;return!(!this.attr.keyboard.enabled||""===a)&&(!(n=this.containerObj.shadowRoot||document).activeElement||"INPUT"!==(i=n.activeElement).tagName&&"textarea"!==i.tagName)&&(e=a.replace(this.containerObj.id+"_",""),i=this.select(e),utils_type.A.exists(i.coords)&&(o=i.coords.usrCoords.slice(1)),utils_type.A.evaluate(this.attr.keyboard.panshift)&&t.shiftKey||utils_type.A.evaluate(this.attr.keyboard.panctrl)&&t.ctrlKey?(!0===utils_type.A.evaluate(this.attr.zoom.enabled)&&(d=!0),38===t.keyCode?this.clickUpArrow():40===t.keyCode?this.clickDownArrow():37===t.keyCode?this.clickLeftArrow():39===t.keyCode?this.clickRightArrow():d&&171===t.keyCode?this.zoomIn():d&&173===t.keyCode?this.zoomOut():d&&79===t.keyCode?this.zoom100():p=!1):t.shiftKey||t.ctrlKey||(utils_type.A.exists(i.visProp)&&(utils_type.A.exists(i.visProp.snaptogrid)&&i.visProp.snaptogrid&&i.evalVisProp("snapsizex")&&i.evalVisProp("snapsizey")?(h=l=(r=i.getSnapSizes())[0],u=c=r[1]):utils_type.A.exists(i.visProp.attracttogrid)&&i.visProp.attracttogrid&&i.evalVisProp("attractordistance")&&i.evalVisProp("attractorunit")&&(c=l=1.1*i.evalVisProp("attractordistance"),"screen"===i.evalVisProp("attractorunit")&&(l/=this.unitX,c/=this.unitX),h=Math.max(l,h),u=Math.max(c,u))),38===t.keyCode?s=[0,u]:40===t.keyCode?s=[0,-u]:37===t.keyCode?s=[-h,0]:39===t.keyCode?s=[h,0]:p=!1,s&&i.isDraggable&&i.visPropCalc.visible&&(this.geonextCompatibilityMode&&(utils_type.A.isPoint(i)||i.elementClass===constants.A.OBJECT_CLASS_TEXT)||!this.geonextCompatibilityMode)&&!i.evalVisProp("fixed")&&(this.mode=this.BOARD_MODE_DRAG,utils_type.A.exists(i.coords)&&(s[0]+=o[0],s[1]+=o[1]),utils_type.A.exists(i.coords)?(i.setPosition(jxg.A.COORDS_BY_USER,s),this.updateInfobox(i)):(this.displayInfobox(!1),i.setPositionDirectly(constants.A.COORDS_BY_USER,s,[0,0])),this.triggerEventHandlers(["keymove","move"],[t,this.mode]),i.triggerEventHandlers(["keydrag","drag"],[t]),this.mode=this.BOARD_MODE_NONE)),this.update(),p&&utils_type.A.exists(t.preventDefault)&&t.preventDefault(),p)},keyFocusInListener:function(t){var e,i,r=t.target.id;if(!this.attr.keyboard.enabled||""===r)return!1;e=r.replace(this.containerObj.id+"_",""),i=this.select(e),utils_type.A.exists(i.highlight)&&(i.highlight(!0),this.focusObjects=[e],i.triggerEventHandlers(["hit"],[t])),utils_type.A.exists(i.coords)&&this.updateInfobox(i)},keyFocusOutListener:function(t){if(!this.attr.keyboard.enabled)return!1;this.focusObjects=[],this.dehighlightAll(),this.displayInfobox(!1)},updateContainerDims:function(t,e){var i,r,n,s=t,o=e;return void 0===t&&(s=this.containerObj.offsetWidth,o=this.containerObj.offsetHeight),void 0===t&&window&&window.getComputedStyle&&(i=window.getComputedStyle(this.containerObj,null),r=parseFloat(i.getPropertyValue("border-left-width"))+parseFloat(i.getPropertyValue("border-right-width")),isNaN(r)||(s-=r),n=parseFloat(i.getPropertyValue("border-top-width"))+parseFloat(i.getPropertyValue("border-bottom-width")),isNaN(n)||(o-=n)),s<=0||o<=0||isNaN(s)||isNaN(o)||(isNaN(this.getBoundingBox()[0])&&this.setBoundingBox(this.attr.boundingbox,this.keepaspectratio,"keep"),utils_type.A.exists(this._prevDim)&&this._prevDim.w===s&&this._prevDim.h===o||(this.resizeContainer(s,o,!0),this._prevDim={w:s,h:o})),this},startResizeObserver:function(){var t=this;env.A.isBrowser&&this.attr.resize&&this.attr.resize.enabled&&(this.resizeObserver=new ResizeObserver((function(e){var i;t._isResizing||(t._isResizing=!0,i=e[0].contentRect,window.setTimeout((function(){try{t.updateContainerDims(i.width,i.height)}catch(e){jxg.A.debug(e),t.stopResizeObserver()}finally{t._isResizing=!1}}),t.attr.resize.throttle))})),this.resizeObserver.observe(this.containerObj))},stopResizeObserver:function(){env.A.isBrowser&&this.attr.resize&&this.attr.resize.enabled&&utils_type.A.exists(this.resizeObserver)&&this.resizeObserver.unobserve(this.containerObj)},resizeListener:function(){var t=this;env.A.isBrowser&&this.attr.resize&&this.attr.resize.enabled&&(this._isScrolling||this._isResizing||(this._isResizing=!0,window.setTimeout((function(){t.updateContainerDims(),t._isResizing=!1}),this.attr.resize.throttle)))},scrollListener:function(t){var e=this;env.A.isBrowser&&(this._isScrolling||(this._isScrolling=!0,window.setTimeout((function(){e._isScrolling=!1}),66)))},startIntersectionObserver:function(){var t=this;try{this.intersectionObserver=new IntersectionObserver((function(e){isNaN(t.getBoundingBox()[0])&&t.updateContainerDims()}),{root:null,rootMargin:"0px",threshold:.8}),this.intersectionObserver.observe(t.containerObj)}catch(t){jxg.A.debug("JSXGraph: IntersectionObserver not available in this browser.")}},stopIntersectionObserver:function(){utils_type.A.exists(this.intersectionObserver)&&this.intersectionObserver.unobserve(this.containerObj)},printListener:function(t){this.updateContainerDims()},printListenerMatch:function(t){t.matches&&this.printListener()},initInfobox:function(t){var e=utils_type.A.copyAttributes(t,this.options,"infobox");return e.id=this.id+"_infobox",this.infobox=this.create("text",[0,0,"0,0"],e),this.infobox.dump=!1,this.displayInfobox(!1),this},updateInfobox:function(t){var e,i,r,n,s,o,a,l=t.evalVisProp("showinfobox");return!utils_type.A.evaluate(this.attr.showinfobox)&&"inherit"===l||!l||utils_type.A.isPoint(t)&&(r=t.coords.usrCoords[1],n=t.coords.usrCoords[2],o=this.infobox.evalVisProp("distancex"),a=this.infobox.evalVisProp("distancey"),this.infobox.setCoords(r+o/this.unitX,n+a/this.unitY),s=t.evalVisProp("infoboxdigits"),"string"!=typeof t.infoboxText?("auto"===s?this.infobox.useLocale()?(e=this.infobox.formatNumberLocale(r),i=this.infobox.formatNumberLocale(n)):(e=utils_type.A.autoDigits(r),i=utils_type.A.autoDigits(n)):utils_type.A.isNumber(s)?this.infobox.useLocale()?(e=this.infobox.formatNumberLocale(r,s),i=this.infobox.formatNumberLocale(n,s)):(e=utils_type.A.toFixed(r,s),i=utils_type.A.toFixed(n,s)):(e=r,i=n),this.highlightInfobox(e,i,t)):this.highlightCustomInfobox(t.infoboxText,t),this.displayInfobox(!0)),this},displayInfobox:function(t){return!t&&this.focusObjects.length>0&&this.select(this.focusObjects[0]).elementClass===constants.A.OBJECT_CLASS_POINT||this.infobox.hiddenByParent===t&&(this.infobox.hiddenByParent=!t,this.infobox.prepareUpdate().updateVisibility(t).updateRenderer()),this},showInfobox:function(t){return this.displayInfobox(t)},highlightInfobox:function(t,e,i){return this.highlightCustomInfobox("("+t+", "+e+")",i),this},highlightCustomInfobox:function(t,e){return this.infobox.setText(t),this},dehighlightAll:function(){var t,e,i={},r=!1;for(t in this.highlightedObjects)this.highlightedObjects.hasOwnProperty(t)&&(e=this.highlightedObjects[t],this.focusObjects.indexOf(t)<0?((this.hasMouseHandlers||this.hasPointerHandlers)&&e.noHighlight(),r=!0):i[t]=e);return this.highlightedObjects=i,"canvas"===this.renderer.type&&r&&(this.prepareUpdate(),this.renderer.suspendRedraw(this),this.updateRenderer(),this.renderer.unsuspendRedraw()),this},getScrCoordsOfMouse:function(t,e){return[t,e]},getUsrCoordsOfMouse:function(t){var e=this.getCoordsTopLeftCorner(),i=env.A.getPosition(t,null,this.document),r=i[0]-e[0],n=i[1]-e[1];return new base_coords.A(constants.A.COORDS_BY_SCREEN,[r,n],this).usrCoords.slice(1)},getAllUnderMouse:function(t){var e=this.getAllObjectsUnderMouse(t);return e.push(this.getUsrCoordsOfMouse(t)),e},getAllObjectsUnderMouse:function(t){var e,i,r=this.getCoordsTopLeftCorner(),n=env.A.getPosition(t,null,this.document),s=n[0]-r[0],o=n[1]-r[1],a=[],l=this.objectsList.length;for(e=0;e<l;e++)(i=this.objectsList[e]).visPropCalc.visible&&i.hasPoint&&i.hasPoint(s,o)&&(a[a.length]=i);return a},updateCoords:function(){var t,e,i=this.objectsList.length;for(e=0;e<i;e++)t=this.objectsList[e],utils_type.A.exists(t.coords)&&(t.evalVisProp("frozen")?t.is3D?t.element2D.coords.screen2usr():t.coords.screen2usr():t.is3D?t.element2D.coords.usr2screen():(t.coords.usr2screen(),utils_type.A.exists(t.actualCoords)&&t.actualCoords.usr2screen()));return this},moveOrigin:function(t,e,i){var r,n,s,o;return utils_type.A.exists(t)&&utils_type.A.exists(e)&&(r=this.origin.scrCoords[1],n=this.origin.scrCoords[2],this.origin.scrCoords[1]=t,this.origin.scrCoords[2]=e,i&&(this.origin.scrCoords[1]-=this.drag_dx,this.origin.scrCoords[2]-=this.drag_dy),s=new base_coords.A(constants.A.COORDS_BY_SCREEN,[0,0],this).usrCoords,o=new base_coords.A(constants.A.COORDS_BY_SCREEN,[this.canvasWidth,this.canvasHeight],this).usrCoords,(s[1]<this.maxboundingbox[0]-math.A.eps||s[2]>this.maxboundingbox[1]+math.A.eps||o[1]>this.maxboundingbox[2]+math.A.eps||o[2]<this.maxboundingbox[3]-math.A.eps)&&(this.origin.scrCoords[1]=r,this.origin.scrCoords[2]=n)),this.updateCoords().clearTraces().fullUpdate(),this.triggerEventHandlers(["boundingbox"]),this},addConditions:function(t){var e,i,r,n,s,o,a,l=[],c=t.indexOf("<data>"),h=t.indexOf("</data>"),u=function(t,e,i,r){return function(){var n,s;s=(n=t.select(e.id)).coords.usrCoords[r],2===r?n.setPositionDirectly(constants.A.COORDS_BY_USER,[i(),s]):n.setPositionDirectly(constants.A.COORDS_BY_USER,[s,i()]),n.prepareUpdate().update()}},d=function(t,e,i){return function(){var r,n;r=t.select(e.id),n=i(),r.setAttribute({visible:n})}},p=function(t,e,i,r){return function(){var n,s;n=t.select(e.id),s=i(),"strokewidth"===r?n.visProp.strokewidth=s:(s=utils_color.A.rgba2rgbo(s),n.visProp[r+"color"]=s[0],n.visProp[r+"opacity"]=s[1])}},f=function(t,e,i){return function(){t.select(e.id).position=i()}},m=function(t,e,i){return function(){t.select(e.id).setStyle(i())}};if(!(c<0)){for(;c>=0;){if(i=(e=t.slice(c+6,h)).indexOf("="),r=e.slice(0,i),n=e.slice(i+1),i=r.indexOf("."),s=r.slice(0,i),o=this.elementsByName[utils_type.A.unescapeHTML(s)],a=r.slice(i+1).replace(/\s+/g,"").toLowerCase(),n=utils_type.A.createFunction(n,this,"",!0),utils_type.A.exists(this.elementsByName[s]))switch(a){case"x":l.push(u(this,o,n,2));break;case"y":l.push(u(this,o,n,1));break;case"visible":l.push(d(this,o,n));break;case"position":l.push(f(this,o,n));break;case"stroke":l.push(p(this,o,n,"stroke"));break;case"style":l.push(m(this,o,n));break;case"strokewidth":l.push(p(this,o,n,"strokewidth"));break;case"fill":l.push(p(this,o,n,"fill"));break;case"label":break;default:jxg.A.debug('property "'+a+'" in conditions not yet implemented:'+n)}else jxg.A.debug("debug conditions: |"+s+"| undefined");c=(t=t.slice(h+7)).indexOf("<data>"),h=t.indexOf("</data>")}this.updateConditions=function(){var t;for(t=0;t<l.length;t++)l[t]();return this.prepareUpdate().updateElements(),!0},this.updateConditions()}},updateConditions:function(){return!1},calculateSnapSizes:function(){var t,e,i,r,n=this.getBoundingBox(),s=utils_type.A.evaluate(this.options.grid.majorStep),o=utils_type.A.evaluate(this.options.grid.gridX),a=utils_type.A.evaluate(this.options.grid.gridY);for(utils_type.A.isArray(s)||(s=[s,s]),s.length<2&&(s=[s[0],s[0]]),utils_type.A.exists(o)&&(s[0]=o),utils_type.A.exists(a)&&(s[1]=a),"auto"===s[0]?s[0]=1:s[0]=utils_type.A.parseNumber(s[0],Math.abs(n[1]-n[3]),1/this.unitX),"auto"===s[1]?s[1]=1:s[1]=utils_type.A.parseNumber(s[1],Math.abs(n[0]-n[2]),1/this.unitY),t=new base_coords.A(constants.A.COORDS_BY_USER,[0,0],this),e=new base_coords.A(constants.A.COORDS_BY_USER,[s[0],s[1]],this),i=t.scrCoords[1]-e.scrCoords[1],r=t.scrCoords[2]-e.scrCoords[2],this.options.grid.snapSizeX=s[0];Math.abs(i)>25;)this.options.grid.snapSizeX*=2,i/=2;for(this.options.grid.snapSizeY=s[1];Math.abs(r)>25;)this.options.grid.snapSizeY*=2,r/=2;return this},applyZoom:function(){return this.updateCoords().calculateSnapSizes().clearTraces().fullUpdate(),this},zoomIn:function(t,e){var i=this.getBoundingBox(),r=utils_type.A.evaluate(this.attr.zoom.factorx),n=utils_type.A.evaluate(this.attr.zoom.factory),s=(i[2]-i[0])*(1-1/r),o=(i[1]-i[3])*(1-1/n),a=.5,l=.5,c=utils_type.A.evaluate(this.attr.zoom.max),h=utils_type.A.evaluate(this.attr.zoom.eps)||utils_type.A.evaluate(this.attr.zoom.min)||.001;return this.zoomX>c&&r>1||this.zoomY>c&&n>1||this.zoomX<h&&r<1||this.zoomY<h&&n<1?this:(utils_type.A.isNumber(t)&&utils_type.A.isNumber(e)&&(a=(t-i[0])/(i[2]-i[0]),l=(i[1]-e)/(i[1]-i[3])),this.setBoundingBox([i[0]+s*a,i[1]-o*l,i[2]-s*(1-a),i[3]+o*(1-l)],this.keepaspectratio,"update"),this.applyZoom())},zoomOut:function(t,e){var i=this.getBoundingBox(),r=utils_type.A.evaluate(this.attr.zoom.factorx),n=utils_type.A.evaluate(this.attr.zoom.factory),s=(i[2]-i[0])*(1-r),o=(i[1]-i[3])*(1-n),a=.5,l=.5,c=utils_type.A.evaluate(this.attr.zoom.eps)||utils_type.A.evaluate(this.attr.zoom.min)||.001;return this.zoomX<c||this.zoomY<c?this:(utils_type.A.isNumber(t)&&utils_type.A.isNumber(e)&&(a=(t-i[0])/(i[2]-i[0]),l=(i[1]-e)/(i[1]-i[3])),this.setBoundingBox([i[0]+s*a,i[1]-o*l,i[2]-s*(1-a),i[3]+o*(1-l)],this.keepaspectratio,"update"),this.applyZoom())},zoom100:function(){var t,e,i;return utils_type.A.exists(this.attr.boundingbox)?this.setBoundingBox(this.attr.boundingbox,this.keepaspectratio,"reset"):(e=((t=this.getBoundingBox())[2]-t[0])*(1-this.zoomX)*.5,i=(t[1]-t[3])*(1-this.zoomY)*.5,this.setBoundingBox([t[0]+e,t[1]-i,t[2]-e,t[3]+i],this.keepaspectratio,"reset")),this.applyZoom()},zoomAllPoints:function(){var t,e,i,r,n=0,s=0,o=0,a=0,l=this.objectsList.length;for(t=0;t<l;t++)r=this.objectsList[t],utils_type.A.isPoint(r)&&r.visPropCalc.visible&&(r.coords.usrCoords[1]<n?n=r.coords.usrCoords[1]:r.coords.usrCoords[1]>s&&(s=r.coords.usrCoords[1]),r.coords.usrCoords[2]>a?a=r.coords.usrCoords[2]:r.coords.usrCoords[2]<o&&(o=r.coords.usrCoords[2]));return e=50/this.unitX,i=50/this.unitY,this.setBoundingBox([n-e,a+i,s+e,o-i],this.keepaspectratio,"update"),this.applyZoom()},zoomElements:function(t){var e,i,r,n,s,o,a,l=[1/0,-1/0,-1/0,1/0];if(!utils_type.A.isArray(t)||0===t.length)return this;for(e=0;e<t.length;e++)i=this.select(t[e]).bounds(),utils_type.A.isArray(i)&&(i[0]<l[0]&&(l[0]=i[0]),i[1]>l[1]&&(l[1]=i[1]),i[2]>l[2]&&(l[2]=i[2]),i[3]<l[3]&&(l[3]=i[3]));return utils_type.A.isArray(l)&&(r=.5*(l[0]+l[2]),n=.5*(l[1]+l[3]),s=1.5*(l[2]-l[0])*.5,o=1.5*(l[1]-l[3])*.5,a=Math.max(s,o),this.setBoundingBox([r-a,n+a,r+a,n-a],this.keepaspectratio,"update")),this},setZoom:function(t,e){var i=this.attr.zoom.factorx,r=this.attr.zoom.factory;return this.attr.zoom.factorx=t/this.zoomX,this.attr.zoom.factory=e/this.zoomY,this.zoomIn(),this.attr.zoom.factorx=i,this.attr.zoom.factory=r,this},_removeObj:function(t,e){var i,r;if(utils_type.A.isArray(t)){for(r=0;r<t.length;r++)this._removeObj(t[r],e);return this}if(t=this.select(t),!utils_type.A.exists(t)||utils_type.A.isString(t))return this;try{for(i in t.childElements)t.childElements.hasOwnProperty(i)&&t.childElements[i].board._removeObj(t.childElements[i]);for(i in t.objects)t.objects.hasOwnProperty(i)&&t.objects[i].board._removeObj(t.objects[i]);if(e)for(i in this.objects)this.objects.hasOwnProperty(i)&&utils_type.A.exists(this.objects[i].childElements)&&utils_type.A.exists(this.objects[i].childElements.hasOwnProperty(t.id))&&(delete this.objects[i].childElements[t.id],delete this.objects[i].descendants[t.id]);else if(utils_type.A.exists(t.ancestors))for(i in t.ancestors)t.ancestors.hasOwnProperty(i)&&utils_type.A.exists(t.ancestors[i].childElements)&&utils_type.A.exists(t.ancestors[i].childElements.hasOwnProperty(t.id))&&(delete t.ancestors[i].childElements[t.id],delete t.ancestors[i].descendants[t.id]);if(t._pos>-1)for(this.objectsList.splice(t._pos,1),r=t._pos;r<this.objectsList.length;r++)this.objectsList[r]._pos--;else t.type!==constants.A.OBJECT_TYPE_TURTLE&&jxg.A.debug("Board.removeObject: object "+t.id+" not found in list.");delete this.objects[t.id],delete this.elementsByName[t.name],t.visProp&&t.evalVisProp("trace")&&t.clearTrace(),utils_type.A.exists(t.remove)&&t.remove()}catch(e){jxg.A.debug(t.id+": Could not be removed: "+e)}return this},removeObject:function(t,e){var i;if(this.renderer.suspendRedraw(this),utils_type.A.isArray(t))for(i=0;i<t.length;i++)this._removeObj(t[i],e);else this._removeObj(t,e);return this.renderer.unsuspendRedraw(),this.update(),this},removeAncestors:function(t){var e;for(e in t.ancestors)t.ancestors.hasOwnProperty(e)&&this.removeAncestors(t.ancestors[e]);return this.removeObject(t),this},initGeonextBoard:function(){var t,e,i;return t=this.create("point",[0,0],{id:this.id+"g00e0",name:"Ursprung",withLabel:!1,visible:!1,fixed:!0}),e=this.create("point",[1,0],{id:this.id+"gX0e0",name:"Punkt_1_0",withLabel:!1,visible:!1,fixed:!0}),i=this.create("point",[0,1],{id:this.id+"gY0e0",name:"Punkt_0_1",withLabel:!1,visible:!1,fixed:!0}),this.create("line",[t,e],{id:this.id+"gXLe0",name:"X-Achse",withLabel:!1,visible:!1}),this.create("line",[t,i],{id:this.id+"gYLe0",name:"Y-Achse",withLabel:!1,visible:!1}),this},resizeContainer:function(t,e,i,r){var n,s,o,a,l;return s=this.canvasWidth,o=this.canvasHeight,r||(n=this.getBoundingBox()),this.canvasWidth=parseFloat(t),this.canvasHeight=parseFloat(e),i||(this.containerObj.style.width=this.canvasWidth+"px",this.containerObj.style.height=this.canvasHeight+"px"),this.renderer.resize(this.canvasWidth,this.canvasHeight),r?(a=.5*(this.canvasWidth-s),l=.5*(this.canvasHeight-o),this.moveOrigin(this.origin.scrCoords[1]+a,this.origin.scrCoords[2]+l)):this.setBoundingBox(n,this.keepaspectratio,"keep"),this},showDependencies:function(){var t,e,i,r,n;for(t in e="<p>\n",this.objects)if(this.objects.hasOwnProperty(t)){for(i in n=0,this.objects[t].childElements)this.objects[t].childElements.hasOwnProperty(i)&&(n+=1);for(i in n>=0&&(e+="<strong>"+this.objects[t].id+":</strong> "),this.objects[t].childElements)this.objects[t].childElements.hasOwnProperty(i)&&(e+=this.objects[t].childElements[i].id+"("+this.objects[t].childElements[i].name+"), ");e+="<p>\n"}return e+="</p>\n",(r=window.open()).document.open(),r.document.write(e),r.document.close(),this},showXML:function(){var t=window.open("");return t.document.open(),t.document.write("<pre>"+utils_type.A.escapeHTML(this.xmlString)+"</pre>"),t.document.close(),this},prepareUpdate:function(t){var e,i,r,n=this.objectsList.length;for(e=0;e<n;e++)if(r=this.objectsList[e],this._change3DView||utils_type.A.exists(t)&&"view3d_slider"===t.elType){if(r.needsUpdate=r.visProp.element3d||"view3d"===r.elType||"view3d_slider"===r.elType||this.needsFullUpdate,r.visProp.element3d&&r.visProp.element3d.type===constants.A.OBJECT_TYPE_SPHERE3D)for(i=0;i<r.parents.length;i++)this.objects[r.parents[i]].needsUpdate=!0}else r.needsUpdate=r.needsRegularUpdate||this.needsFullUpdate;for(e in this.groups)this.groups.hasOwnProperty(e)&&((r=this.groups[e]).needsUpdate=r.needsRegularUpdate||this.needsFullUpdate);return this},updateElements:function(t){var e,i;for(t=this.select(t),e=0;e<this.objectsList.length;e++)i=this.objectsList[e],this.needsFullUpdate&&i.elementClass===constants.A.OBJECT_CLASS_TEXT&&i.updateSize(),i.update(!utils_type.A.exists(t)||i.id!==t.id).updateVisibility();for(e in this.groups)this.groups.hasOwnProperty(e)&&this.groups[e].update(t);return this},updateRenderer:function(){var t,e=this.objectsList.length;if(this.renderer){if("canvas"===this.renderer.type)this.updateRendererCanvas();else for(t=0;t<e;t++)this.objectsList[t].updateRenderer();return this}},updateRendererCanvas:function(){var t,e,i,r=this.objectsList.length,n=[];for(t=0;t<r;t++)if("view3d"===(e=this.objectsList[t]).elType&&e.evalVisProp("depthorder.enabled")){n=e.evalVisProp("depthorder.layers"),e.updateRenderer();break}for(r=(i=this.objectsList.toSorted((function(t,e){return t.visProp.layer!==e.visProp.layer?t.visProp.layer-e.visProp.layer:-1===n.indexOf(t.visProp.layer)?t._pos-e._pos:t.visProp.element3d||e.visProp.element3d?t.visProp.element3d&&!e.visProp.element3d?-1:e.visProp.element3d&&!t.visProp.element3d?1:t.visProp.element3d.zIndex-e.visProp.element3d.zIndex:t._pos-e._pos}))).length,t=0;t<r;t++)i[t].prepareUpdate().updateRenderer();return this},addHook:function(t,e,i){return jxg.A.deprecated("Board.addHook()","Board.on()"),e=utils_type.A.def(e,"update"),i=utils_type.A.def(i,this),this.hooks.push([e,t]),this.on(e,t,i),this.hooks.length-1},addEvent:jxg.A.shortcut(jxg.A.Board.prototype,"on"),removeHook:function(t){return jxg.A.deprecated("Board.removeHook()","Board.off()"),this.hooks[t]&&(this.off(this.hooks[t][0],this.hooks[t][1]),this.hooks[t]=null),this},removeEvent:jxg.A.shortcut(jxg.A.Board.prototype,"off"),updateHooks:function(t){var e=Array.prototype.slice.call(arguments,0);return jxg.A.deprecated("Board.updateHooks()","Board.triggerEventHandlers()"),e[0]=utils_type.A.def(e[0],"update"),this.triggerEventHandlers([e[0]],arguments),this},addChild:function(t){return utils_type.A.exists(t)&&utils_type.A.exists(t.containerObj)&&(this.dependentBoards.push(t),this.update()),this},removeChild:function(t){var e;for(e=this.dependentBoards.length-1;e>=0;e--)this.dependentBoards[e]===t&&this.dependentBoards.splice(e,1);return this},update:function(t){var e,i,r,n,s;if(this.inUpdate||this.isSuspendedUpdate)return this;for(this.inUpdate=!0,"all"===this.attr.minimizereflow&&this.containerObj&&"vml"!==this.renderer.type&&(s=this.document.activeElement,n=this.renderer.removeToInsertLater(this.containerObj)),"svg"===this.attr.minimizereflow&&"svg"===this.renderer.type&&(s=this.document.activeElement,n=this.renderer.removeToInsertLater(this.renderer.svgRoot)),this.prepareUpdate(t).updateElements(t).updateConditions(),this.renderer.suspendRedraw(this),this.updateRenderer(),this.renderer.unsuspendRedraw(),this.triggerEventHandlers(["update"],[]),n&&(n(),s.focus()),i=this.dependentBoards.length,e=0;e<i;e++)r=this.dependentBoards[e],utils_type.A.exists(r)&&r!==this&&(r.updateQuality=this.updateQuality,r.prepareUpdate().updateElements().updateConditions(),r.renderer.suspendRedraw(this),r.updateRenderer(),r.renderer.unsuspendRedraw(),r.triggerEventHandlers(["update"],[]));return this.inUpdate=!1,this},fullUpdate:function(){return this.needsFullUpdate=!0,this.update(),this.needsFullUpdate=!1,this},addGrid:function(){return this.create("grid",[]),this},removeGrids:function(){var t;for(t=0;t<this.grids.length;t++)this.removeObject(this.grids[t]);return this.grids.length=0,this.update(),this},create:function(t,e,i){var r,n;for(t=t.toLowerCase(),utils_type.A.exists(e)||(e=[]),utils_type.A.exists(i)||(i={}),n=0;n<e.length;n++)!utils_type.A.isString(e[n])||"text"===t&&2===n||"solidofrevolution3d"===t&&2===n||"text3d"===t&&(2===n||4===n)||!("input"!==t&&"checkbox"!==t&&"button"!==t||2!==n&&3!==n)||"curve"===t||"functiongraph"===t||"implicitcurve"===t||(n>0&&"view3d"===e[0].elType?e[n]=e[0].select(e[n]):e[n]=this.select(e[n]));if(!utils_type.A.isFunction(jxg.A.elements[t]))throw new Error("JSXGraph: create: Unknown element type given: "+t);return r=jxg.A.elements[t](this,e,i),utils_type.A.exists(r)?(r.prepareUpdate&&r.update&&r.updateRenderer&&r.fullUpdate(),r):(jxg.A.debug("JSXGraph: create: failure creating "+t),r)},createElement:function(){return jxg.A.deprecated("Board.createElement()","Board.create()"),this.create.apply(this,arguments)},clearTraces:function(){var t;for(t=0;t<this.objectsList.length;t++)this.objectsList[t].clearTrace();return this.numTraces=0,this},suspendUpdate:function(){return this.inUpdate||(this.isSuspendedUpdate=!0),this},unsuspendUpdate:function(){return this.isSuspendedUpdate&&(this.isSuspendedUpdate=!1,this.fullUpdate()),this},setBoundingBox:function(t,e,i){var r,n,s,o,a,l,c,h,u,d=0,p=0,f=1,m=env.A.getDimensions(this.containerObj,this.document);return utils_type.A.isArray(t)?(t[0]<this.maxboundingbox[0]-math.A.eps||t[1]>this.maxboundingbox[1]+math.A.eps||t[2]>this.maxboundingbox[2]+math.A.eps||t[3]<this.maxboundingbox[3]-math.A.eps||(utils_type.A.exists(i)||(i="reset"),s=this.unitX,o=this.unitY,this.canvasWidth=parseFloat(m.width),this.canvasHeight=parseFloat(m.height),n=this.canvasWidth,r=this.canvasHeight,e?(this.keepaspectratio?(a=s/o,isNaN(a)&&(a=1)):a=1,"keep"===i&&(f=this.zoomX/this.zoomY),h=s*(l=t[2]-t[0]),u=o*(c=t[1]-t[3]),n>=r?h>=u?(this.unitY=r/c,this.unitX=this.unitY*a):(this.unitY=r/Math.abs(l)*math.A.sign(c)/f,this.unitX=this.unitY*a):u>h?(this.unitX=n/l,this.unitY=this.unitX/a):(this.unitX=n/Math.abs(c)*math.A.sign(l)*f,this.unitY=this.unitX/a),d=.5*(n/this.unitX-l),p=.5*(r/this.unitY-c),this.keepaspectratio=!0):(this.unitX=n/(t[2]-t[0]),this.unitY=r/(t[1]-t[3]),this.keepaspectratio=!1),this.moveOrigin(-this.unitX*(t[0]-d),this.unitY*(t[1]+p)),"update"===i?(this.zoomX*=this.unitX/s,this.zoomY*=this.unitY/o):"reset"===i&&(this.zoomX=utils_type.A.exists(this.attr.zoomx)?this.attr.zoomx:1,this.zoomY=utils_type.A.exists(this.attr.zoomy)?this.attr.zoomy:1)),this):this},getBoundingBox:function(){var t=new base_coords.A(constants.A.COORDS_BY_SCREEN,[0,0],this).usrCoords,e=new base_coords.A(constants.A.COORDS_BY_SCREEN,[this.canvasWidth,this.canvasHeight],this).usrCoords;return[t[1],t[2],e[1],e[2]]},_set:function(t,e){t=t.toLocaleLowerCase(),null===e||!utils_type.A.isObject(e)||utils_type.A.exists(e.id)||utils_type.A.exists(e.name)?this.attr[t]=e:utils_type.A.mergeAttr(this.attr[t],e)},setAttribute:function(t){var e,i,r,n,s,o,a={};for(e=0;e<arguments.length;e++)i=arguments[e],utils_type.A.isString(i)?(r=i.split(":"),a[utils_type.A.trim(r[0])]=utils_type.A.trim(r[1])):utils_type.A.isArray(i)?a[i[0]]=i[1]:jxg.A.extend(a,i);for(e in a)if(a.hasOwnProperty(e)&&(n=e.replace(/\s+/g,"").toLowerCase(),s=a[e]),s=(!s.toLowerCase||"false"!==s.toLowerCase())&&s,this.attr[n]!==s)switch(n){case"axis":!1===s&&utils_type.A.exists(this.defaultAxes)&&(this.defaultAxes.x.setAttribute({visible:!1}),this.defaultAxes.y.setAttribute({visible:!1}));break;case"boundingbox":this.setBoundingBox(s,this.keepaspectratio),this._set(n,s);break;case"defaultaxes":utils_type.A.exists(this.defaultAxes.x)&&utils_type.A.exists(s.x)&&this.defaultAxes.x.setAttribute(s.x),utils_type.A.exists(this.defaultAxes.y)&&utils_type.A.exists(s.y)&&this.defaultAxes.y.setAttribute(s.y);break;case"title":this.document.getElementById(this.container+"_ARIAlabel").innerHTML=s,this._set(n,s);break;case"keepaspectratio":this._set(n,s),this.setBoundingBox(this.getBoundingBox(),s,"keep");break;case"document":case"maxboundingbox":this[n]=s,this._set(n,s);break;case"zoomx":case"zoomy":this[n]=s,this._set(n,s),this.setZoom(this.attr.zoomx,this.attr.zoomy);break;case"registerevents":case"renderer":break;case"fullscreen":case"screenshot":(o=this.containerObj.ownerDocument.getElementById(this.container+"_navigation_"+n))&&utils_type.A.exists(s.symbol)&&(o.innerHTML=utils_type.A.evaluate(s.symbol)),this._set(n,s);break;case"selection":s.visible=!1,s.withLines=!1,s.vertices={visible:!1},this._set(n,s);break;case"showcopyright":"svg"===this.renderer.type&&((o=this.containerObj.ownerDocument.getElementById(this.renderer.uniqName("licenseText")))?o.style.display=utils_type.A.evaluate(s)?"inline":"none":utils_type.A.evaluate(s)&&this.renderer.displayCopyright(constants.A.licenseText,parseInt(this.options.text.fontSize,10)));default:utils_type.A.exists(this.attr[n])&&this._set(n,s)}return this.containerObj.ownerDocument.getElementById(this.container+"_navigationbar").remove(),this.renderer.drawNavigationBar(this,this.attr.navbar),this.triggerEventHandlers(["attribute"],[a,this]),this.fullUpdate(),this},addAnimation:function(t){var e=this;return this.animationObjects[t.id]=t,this.animationIntervalCode||(this.animationIntervalCode=window.setInterval((function(){e.animate()}),t.board.attr.animationdelay)),this},stopAllAnimation:function(){var t;for(t in this.animationObjects)this.animationObjects.hasOwnProperty(t)&&utils_type.A.exists(this.animationObjects[t])&&(this.animationObjects[t]=null,delete this.animationObjects[t]);return window.clearInterval(this.animationIntervalCode),delete this.animationIntervalCode,this},animate:function(){var t,e,i,r,n,s,o,a,l=0,c=null;for(e in this.animationObjects)if(this.animationObjects.hasOwnProperty(e)&&utils_type.A.exists(this.animationObjects[e])){if(l+=1,(i=this.animationObjects[e]).animationPath&&(r=utils_type.A.isFunction(i.animationPath)?i.animationPath((new Date).getTime()-i.animationStart):i.animationPath.pop(),!utils_type.A.exists(r)||!utils_type.A.isArray(r)&&isNaN(r)?delete i.animationPath:(i.setPositionDirectly(constants.A.COORDS_BY_USER,r),i.fullUpdate(),c=i)),i.animationData){for(n in o=0,i.animationData)i.animationData.hasOwnProperty(n)&&(s=i.animationData[n].pop(),utils_type.A.exists(s)?(o+=1,(t={})[n]=s,i.setAttribute(t)):delete i.animationData[s]);0===o&&delete i.animationData}utils_type.A.exists(i.animationData)||utils_type.A.exists(i.animationPath)||(this.animationObjects[e]=null,delete this.animationObjects[e],utils_type.A.exists(i.animationCallback)&&(a=i.animationCallback,i.animationCallback=null,a()))}return 0===l?(window.clearInterval(this.animationIntervalCode),delete this.animationIntervalCode):this.update(c),this},migratePoint:function(t,e,i){var r,n,s,o,a,l,c=!1;for(n in t=this.select(t),e=this.select(e),utils_type.A.exists(t.label)&&(l=t.label.id,c=!0,this.removeObject(t.label)),t.childElements)if(t.childElements.hasOwnProperty(n)){for(s in o=!1,r=t.childElements[n])r.hasOwnProperty(s)&&r[s]===t&&(r[s]=e,o=!0);for(o&&delete t.childElements[n],a=0;a<r.parents.length;a++)r.parents[a]===t.id&&(r.parents[a]=e.id);e.addChild(r)}return i&&(c&&(delete e.childElements[l],delete e.descendants[l]),e.label&&this.removeObject(e.label),delete this.elementsByName[e.name],e.name=t.name,c&&e.createLabel()),this.removeObject(t),utils_type.A.exists(e.name)&&""!==e.name&&(this.elementsByName[e.name]=e),this.fullUpdate(),this},emulateColorblindness:function(t){var e,i;if(utils_type.A.exists(t)||(t="none"),this.currentCBDef===t)return this;for(e in this.objects)this.objects.hasOwnProperty(e)&&(i=this.objects[e],"none"!==t?("none"===this.currentCBDef&&(i.visPropOriginal={strokecolor:i.visProp.strokecolor,fillcolor:i.visProp.fillcolor,highlightstrokecolor:i.visProp.highlightstrokecolor,highlightfillcolor:i.visProp.highlightfillcolor}),i.setAttribute({strokecolor:utils_color.A.rgb2cb(i.eval(i.visPropOriginal.strokecolor),t),fillcolor:utils_color.A.rgb2cb(i.eval(i.visPropOriginal.fillcolor),t),highlightstrokecolor:utils_color.A.rgb2cb(i.eval(i.visPropOriginal.highlightstrokecolor),t),highlightfillcolor:utils_color.A.rgb2cb(i.eval(i.visPropOriginal.highlightfillcolor),t)})):utils_type.A.exists(i.visPropOriginal)&&jxg.A.extend(i.visProp,i.visPropOriginal));return this.currentCBDef=t,this.update(),this},select:function(t,e){var i,r,n,s,o=t;if(null===o)return o;if(utils_type.A.isString(o)&&""!==o)utils_type.A.exists(this.objects[o])?o=this.objects[o]:utils_type.A.exists(this.elementsByName[o])?o=this.elementsByName[o]:utils_type.A.exists(this.groups[o])&&(o=this.groups[o]);else if(!e&&(utils_type.A.isFunction(o)||utils_type.A.isObject(o)&&!utils_type.A.isFunction(o.setAttribute))){for(r={},s=(i=utils_type.A.filterElements(this.objectsList,o)).length,n=0;n<s;n++)r[i[n].id]=i[n];o=new composition(r)}else utils_type.A.isObject(o)&&utils_type.A.exists(o.id)&&!utils_type.A.exists(this.objects[o.id])&&(o=null);return o},hasPoint:function(t,e){var i=t,r=e,n=this.getBoundingBox();return utils_type.A.exists(t)&&utils_type.A.isArray(t.usrCoords)&&(i=t.usrCoords[1],r=t.usrCoords[2]),!!(utils_type.A.isNumber(i)&&utils_type.A.isNumber(r)&&n[0]<i&&i<n[2]&&n[1]>r&&r>n[3])},updateCSSTransforms:function(){var t=this.containerObj,e=t,i=t;if(this.cssTransMat=env.A.getCSSTransformMatrix(e),utils_type.A.exists(e.getRootNode)){for(e=e.parentNode===e.getRootNode()?e.parentNode.host:e.parentNode;e;)this.cssTransMat=math.A.matMatMult(env.A.getCSSTransformMatrix(e),this.cssTransMat),e=e.parentNode===e.getRootNode()?e.parentNode.host:e.parentNode;this.cssTransMat=math.A.inverse(this.cssTransMat)}else{for(e=e.offsetParent;e;){for(this.cssTransMat=math.A.matMatMult(env.A.getCSSTransformMatrix(e),this.cssTransMat),i=i.parentNode;i!==e;)this.cssTransMat=math.A.matMatMult(env.A.getCSSTransformMatrix(e),this.cssTransMat),i=i.parentNode;e=e.offsetParent}this.cssTransMat=math.A.inverse(this.cssTransMat)}return this},startSelectionMode:function(){this.selectingMode=!0,this.selectionPolygon.setAttribute({visible:!0}),this.selectingBox=[[0,0],[0,0]],this._setSelectionPolygonFromBox(),this.selectionPolygon.fullUpdate()},stopSelectionMode:function(){return this.selectingMode=!1,this.selectionPolygon.setAttribute({visible:!1}),[this.selectionPolygon.vertices[0].coords,this.selectionPolygon.vertices[2].coords]},_startSelecting:function(t){this.isSelecting=!0,this.selectingBox=[[t[0],t[1]],[t[0],t[1]]],this._setSelectionPolygonFromBox()},_moveSelecting:function(t){this.isSelecting&&(this.selectingBox[1]=[t[0],t[1]],this._setSelectionPolygonFromBox(),this.selectionPolygon.fullUpdate())},_stopSelecting:function(t){var e=this.getMousePosition(t);this.isSelecting=!1,this.selectingBox[1]=[e[0],e[1]],this._setSelectionPolygonFromBox()},_setSelectionPolygonFromBox:function(){var t=this.selectingBox[0],e=this.selectingBox[1];this.selectionPolygon.vertices[0].setPositionDirectly(jxg.A.COORDS_BY_SCREEN,[t[0],t[1]]),this.selectionPolygon.vertices[1].setPositionDirectly(jxg.A.COORDS_BY_SCREEN,[t[0],e[1]]),this.selectionPolygon.vertices[2].setPositionDirectly(jxg.A.COORDS_BY_SCREEN,[e[0],e[1]]),this.selectionPolygon.vertices[3].setPositionDirectly(jxg.A.COORDS_BY_SCREEN,[e[0],t[1]])},_testForSelection:function(t){this._isRequiredKeyPressed(t,"selection")&&(utils_type.A.exists(this.selectionPolygon)||this._createSelectionPolygon(this.attr),this.startSelectionMode())},_createSelectionPolygon:function(t){var e;return utils_type.A.exists(this.selectionPolygon)||!0===(e=utils_type.A.copyAttributes(t,src_options.A,"board","selection")).enabled&&(this.selectionPolygon=this.create("polygon",[[0,0],[0,0],[0,0],[0,0]],e)),this},__evt__attribute:function(t){},__evt__down:function(t){},__evt__mousedown:function(t){},__evt__pendown:function(t){},__evt__pointerdown:function(t){},__evt__touchstart:function(t){},__evt__up:function(t){},__evt__mouseup:function(t){},__evt__pointerup:function(t){},__evt__touchend:function(t){},__evt__click:function(t){},__evt__dblclick:function(t){},__evt__mouseclick:function(t){},__evt__mousedblclick:function(t){},__evt__pointerclick:function(t){},__evt__pointerdblclick:function(t){},__evt__move:function(t,e){},__evt__mousemove:function(t,e){},__evt__penmove:function(t,e){},__evt__pointermove:function(t,e){},__evt__touchmove:function(t,e){},__evt__keymove:function(t,e){},__evt__hit:function(t,e,i){},__evt__mousehit:function(t,e,i){},__evt__update:function(){},__evt__boundingbox:function(){},__evt__startselecting:function(){},__evt__mousestartselecting:function(){},__evt__pointerstartselecting:function(){},__evt__touchstartselecting:function(){},__evt__stopselecting:function(){},__evt__mousestopselecting:function(){},__evt__pointerstopselecting:function(){},__evt__touchstopselecting:function(){},__evt__moveselecting:function(){},__evt__mousemoveselecting:function(){},__evt__pointermoveselecting:function(){},__evt__touchmoveselecting:function(){},__evt:function(){},toFullscreen:function(t){var e,i,r,n,s=this.document;return t=t||this.container,this._fullscreen_inner_id=t,r=s.getElementById(t),e="fullscreenwrap_"+t,utils_type.A.exists(r._cssFullscreenStore)||(n=this.containerObj.getBoundingClientRect(),r._cssFullscreenStore={w:n.width,h:n.height}),s.getElementById(e)?i=s.getElementById(e):((i=document.createElement("div")).classList.add("JXG_wrap_private"),i.setAttribute("id",e),r.parentNode.insertBefore(i,r),i.appendChild(r)),i.requestFullscreen=i.requestFullscreen||i.webkitRequestFullscreen||i.mozRequestFullScreen||i.msRequestFullscreen,null===(void 0!==s.fullscreenElement?s.fullscreenElement:void 0!==s.webkitFullscreenElement?s.webkitFullscreenElement:s.msFullscreenElement)?i.requestFullscreen&&(i.requestFullscreen(),this.startFullscreenResizeObserver(i)):(this.stopFullscreenResizeObserver(i),utils_type.A.exists(document.exitFullscreen)?document.exitFullscreen():utils_type.A.exists(document.webkitExitFullscreen)&&document.webkitExitFullscreen()),this},fullscreenListener:function(t){var e,i,r,n=this.document;e=this._fullscreen_inner_id,utils_type.A.exists(e)&&(r=void 0!==n.fullscreenElement?n.fullscreenElement:void 0!==n.webkitFullscreenElement?n.webkitFullscreenElement:n.msFullscreenElement,i=n.getElementById(e),r?(i._cssFullscreenStore.id=r.id,i._cssFullscreenStore.isFullscreen=!0,i._cssFullscreenStore.margin=i.style.margin,i._cssFullscreenStore.width=i.style.width,i._cssFullscreenStore.height=i.style.height,i._cssFullscreenStore.transform=i.style.transform,i.style.width=i._cssFullscreenStore.w+"px",i.style.height=i._cssFullscreenStore.h+"px",i.style.margin="",env.A.scaleJSXGraphDiv(r.id,e,n,utils_type.A.evaluate(this.attr.fullscreen.scale)),r=null):utils_type.A.exists(i._cssFullscreenStore)&&(i._cssFullscreenStore.isFullscreen=!1,i.style.margin=i._cssFullscreenStore.margin,i.style.width=i._cssFullscreenStore.width,i.style.height=i._cssFullscreenStore.height,i.style.transform=i._cssFullscreenStore.transform,i._cssFullscreenStore=null,i.parentElement.replaceWith(i)),this.updateCSSTransforms())},startFullscreenResizeObserver:function(t){var e=this;return env.A.isBrowser&&this.attr.resize&&this.attr.resize.enabled?(this.resizeObserver=new ResizeObserver((function(i){var r,n,s=e.document;e._isResizing||(e._isResizing=!0,window.setTimeout((function(){try{r=e._fullscreen_inner_id,null!==(n=void 0!==s.fullscreenElement?s.fullscreenElement:void 0!==s.webkitFullscreenElement?s.webkitFullscreenElement:s.msFullscreenElement)&&env.A.scaleJSXGraphDiv(n.id,r,s,utils_type.A.evaluate(e.attr.fullscreen.scale))}catch(i){e.stopFullscreenResizeObserver(t)}finally{e._isResizing=!1}}),e.attr.resize.throttle))})),this.resizeObserver.observe(t),this):this},stopFullscreenResizeObserver:function(t){return env.A.isBrowser&&this.attr.resize&&this.attr.resize.enabled?(utils_type.A.exists(this.resizeObserver)&&this.resizeObserver.unobserve(t),this):this},addLogEntry:function(t,e,i){var r,n,s=this.userLog.length-1;return utils_type.A.exists(e.elementClass)&&(n=e.id),utils_type.A.evaluate(this.attr.logging.enabled)&&(r=(new Date).getTime(),s>=0&&this.userLog[s].type===t&&this.userLog[s].id===n&&r-this.userLog[s].end<500?(this.userLog[s].end=r,this.userLog[s].endpos=i):this.userLog.push({type:t,id:n,start:r,startpos:i,end:r,endpos:i,bbox:this.getBoundingBox(),canvas:[this.canvasWidth,this.canvasHeight],zoom:[this.zoomX,this.zoomY]})),this},createRoulette:function(t,e,i,r,n,s,o){var a=this;return new function(){var l,c=0,h=0,u=0,d=i,p=numerics.A.root((function(i){var r=t.X(d),n=t.Y(d),s=e.X(i),o=e.Y(i);return(r-s)*(r-s)+(n-o)*(n-o)}),[0,2*Math.PI]),f=0,m=0,g=a.create("transform",[function(){return c}],{type:"rotate"}),_=a.create("transform",[function(){return c},function(){return t.X(d)},function(){return t.Y(d)}],{type:"rotate"}),v=a.create("transform",[function(){return h},function(){return u}],{type:"translate"}),y=function(t,e,i){var r=numerics.A.D(t.X)(e),n=numerics.A.D(t.Y)(e),s=numerics.A.D(t.X)(i),o=numerics.A.D(t.Y)(i),a=numerics.A.D(t.X)(.5*(e+i)),l=numerics.A.D(t.Y)(.5*(e+i)),c=math.A.hypot(r,n),h=math.A.hypot(s,o);return(c+4*math.A.hypot(a,l)+h)*(i-e)/6},b=function(t){return l-y(e,p,t)},A=Math.PI/18,x=9*A,C=null;return this.rolling=function(){var i,s,C,E,M;l=y(t,d,f=d+n*r),m=numerics.A.root(b,p),i=new complex(t.X(f),t.Y(f)),s=new complex(e.X(m),e.Y(m)),C=new complex(numerics.A.D(t.X)(f),numerics.A.D(t.Y)(f)),E=new complex(numerics.A.D(e.X)(m),numerics.A.D(e.Y)(m)),M=complex.C.div(C,E),c=Math.atan2(M.imaginary,M.real),M.div(complex.C.abs(M)),M.mult(s),h=i.real-M.real,u=i.imaginary-M.imaginary,c<-A&&c>-x?(c=-A,_.applyOnce(o)):c>A&&c<x?(c=A,_.applyOnce(o)):(g.applyOnce(o),v.applyOnce(o),d=f,p=m),a.update()},this.start=function(){return s>0&&(C=window.setInterval(this.rolling,s)),this},this.stop=function(){return window.clearInterval(C),this},this}}});const base_board=jxg.A.Board;jxg.A.SVGRenderer=function(t,e){var i;for(this.type="svg",this.isIE=-1!==navigator.appVersion.indexOf("MSIE")||navigator.userAgent.match(/Trident\//),this.svgRoot=null,this.svgNamespace="http://www.w3.org/2000/svg",this.xlinkNamespace="http://www.w3.org/1999/xlink",this.container=t,this.container.style.MozUserSelect="none",this.container.style.userSelect="none",this.container.style.overflow="hidden",""===this.container.style.position&&(this.container.style.position="relative"),this.svgRoot=this.container.ownerDocument.createElementNS(this.svgNamespace,"svg"),this.svgRoot.style.overflow="hidden",this.svgRoot.style.display="block",this.resize(e.width,e.height),this.container.appendChild(this.svgRoot),this.defs=this.container.ownerDocument.createElementNS(this.svgNamespace,"defs"),this.svgRoot.appendChild(this.defs),this.createShadowFilter=function(t,e,i,r,n,s){var o,a,l,c,h,u=this.container.ownerDocument.createElementNS(this.svgNamespace,"filter");return u.setAttributeNS(null,"id",t),u.setAttributeNS(null,"width","300%"),u.setAttributeNS(null,"height","300%"),u.setAttributeNS(null,"filterUnits","userSpaceOnUse"),(o=this.container.ownerDocument.createElementNS(this.svgNamespace,"feOffset")).setAttributeNS(null,"in","SourceGraphic"),o.setAttributeNS(null,"result","offOut"),o.setAttributeNS(null,"dx",s[0]),o.setAttributeNS(null,"dy",s[1]),u.appendChild(o),(a=this.container.ownerDocument.createElementNS(this.svgNamespace,"feColorMatrix")).setAttributeNS(null,"in","offOut"),a.setAttributeNS(null,"result","colorOut"),a.setAttributeNS(null,"type","matrix"),"none"===e||!utils_type.A.isArray(e)||e.length<3?a.setAttributeNS(null,"values","0.1 0 0 0 0  0 0.1 0 0 0  0 0 0.1 0 0  0 0 0 "+i+" 0"):(e[0]/=255,e[1]/=255,e[2]/=255,h=r+" 0 0 0 "+e[0]+"  0 "+r+" 0 0 "+e[1]+"  0 0 "+r+" 0 "+e[2]+"  0 0 0 "+i+" 0",a.setAttributeNS(null,"values",h)),u.appendChild(a),(l=this.container.ownerDocument.createElementNS(this.svgNamespace,"feGaussianBlur")).setAttributeNS(null,"in","colorOut"),l.setAttributeNS(null,"result","blurOut"),l.setAttributeNS(null,"stdDeviation",n),u.appendChild(l),(c=this.container.ownerDocument.createElementNS(this.svgNamespace,"feBlend")).setAttributeNS(null,"in","SourceGraphic"),c.setAttributeNS(null,"in2","blurOut"),c.setAttributeNS(null,"mode","normal"),u.appendChild(c),u},this.uniqName=function(){return this.container.id+"_"+Array.prototype.slice.call(arguments).join("_")},this.toStr=function(){var t=Array.prototype.slice.call(arguments).join("");return utils_type.A.exists(CSS)&&utils_type.A.exists(CSS.escape)&&(t=CSS.escape(t)),t},this.toURL=function(){return"url(#"+this.toStr.apply(this,arguments)+")"},this.defs.appendChild(this.createShadowFilter(this.uniqName("f1"),"none",1,.1,3,[5,5])),this.layer=[],i=0;i<src_options.A.layer.numlayers;i++)this.layer[i]=this.container.ownerDocument.createElementNS(this.svgNamespace,"g"),this.svgRoot.appendChild(this.layer[i]);try{this.foreignObjLayer=this.container.ownerDocument.createElementNS(this.svgNamespace,"foreignObject"),this.foreignObjLayer.setAttribute("display","none"),this.foreignObjLayer.setAttribute("x",0),this.foreignObjLayer.setAttribute("y",0),this.foreignObjLayer.setAttribute("width","100%"),this.foreignObjLayer.setAttribute("height","100%"),this.foreignObjLayer.setAttribute("id",this.uniqName("foreignObj")),this.svgRoot.appendChild(this.foreignObjLayer),this.supportsForeignObject=!0}catch(t){this.supportsForeignObject=!1}},jxg.A.SVGRenderer.prototype=new renderer_abstract,jxg.A.extend(jxg.A.SVGRenderer.prototype,{_createArrowHead:function(t,e,i){var r,n,s,o,a=t.id+"Triangle";return utils_type.A.exists(e)&&(a+=e),utils_type.A.exists(i)&&(a+=i),(r=this.createPrim("marker",a)).setAttributeNS(null,"stroke",t.evalVisProp("strokecolor")),r.setAttributeNS(null,"stroke-opacity",t.evalVisProp("strokeopacity")),r.setAttributeNS(null,"fill",t.evalVisProp("strokecolor")),r.setAttributeNS(null,"fill-opacity",t.evalVisProp("strokeopacity")),r.setAttributeNS(null,"stroke-width",0),r.setAttributeNS(null,"orient","auto"),r.setAttributeNS(null,"markerUnits","strokeWidth"),n=this.container.ownerDocument.createElementNS(this.svgNamespace,"path"),o=5,"Start"===e?(s=0,2===i?n.setAttributeNS(null,"d","M 10,0 L 0,5 L 10,10 L 5,5 z"):3===i?n.setAttributeNS(null,"d","M 0,0 L 3.33,0 L 3.33,10 L 0,10 z"):4===i?(o=3.31,n.setAttributeNS(null,"d","M 0.00,3.31 C 3.53,3.84 7.13,4.50 10.00,6.63 C 9.33,5.52 8.67,4.42 8.00,3.31 C 8.67,2.21 9.33,1.10 10.00,0.00 C 7.13,2.13 3.53,2.79 0.00,3.31")):5===i?(o=3.28,n.setAttributeNS(null,"d","M 0.00,3.28 C 3.39,4.19 6.81,5.07 10.00,6.55 C 9.38,5.56 9.00,4.44 9.00,3.28 C 9.00,2.11 9.38,0.99 10.00,0.00 C 6.81,1.49 3.39,2.37 0.00,3.28")):6===i?(o=2.84,n.setAttributeNS(null,"d","M 0.00,2.84 C 3.39,3.59 6.79,4.35 10.00,5.68 C 9.67,4.73 9.33,3.78 9.00,2.84 C 9.33,1.89 9.67,0.95 10.00,0.00 C 6.79,1.33 3.39,2.09 0.00,2.84")):7===i?(o=5.2,n.setAttributeNS(null,"d","M 0.00,5.20 C 4.04,5.20 7.99,6.92 10.00,10.39 M 10.00,0.00 C 7.99,3.47 4.04,5.20 0.00,5.20")):n.setAttributeNS(null,"d","M 10,0 L 0,5 L 10,10 z"),t.elementClass===constants.A.OBJECT_CLASS_LINE&&(s=2===i?4.9:3===i?3.3:4===i||5===i||6===i?6.66:7===i?0:10)):(s=10,2===i?n.setAttributeNS(null,"d","M 0,0 L 10,5 L 0,10 L 5,5 z"):3===i?(s=3.3,n.setAttributeNS(null,"d","M 0,0 L 3.33,0 L 3.33,10 L 0,10 z")):4===i?(o=3.31,n.setAttributeNS(null,"d","M 10.00,3.31 C 6.47,3.84 2.87,4.50 0.00,6.63 C 0.67,5.52 1.33,4.42 2.00,3.31 C 1.33,2.21 0.67,1.10 0.00,0.00 C 2.87,2.13 6.47,2.79 10.00,3.31")):5===i?(o=3.28,n.setAttributeNS(null,"d","M 10.00,3.28 C 6.61,4.19 3.19,5.07 0.00,6.55 C 0.62,5.56 1.00,4.44 1.00,3.28 C 1.00,2.11 0.62,0.99 0.00,0.00 C 3.19,1.49 6.61,2.37 10.00,3.28")):6===i?(o=2.84,n.setAttributeNS(null,"d","M 10.00,2.84 C 6.61,3.59 3.21,4.35 0.00,5.68 C 0.33,4.73 0.67,3.78 1.00,2.84 C 0.67,1.89 0.33,0.95 0.00,0.00 C 3.21,1.33 6.61,2.09 10.00,2.84")):7===i?(o=5.2,n.setAttributeNS(null,"d","M 10.00,5.20 C 5.96,5.20 2.01,6.92 0.00,10.39 M 0.00,0.00 C 2.01,3.47 5.96,5.20 10.00,5.20")):n.setAttributeNS(null,"d","M 0,0 L 10,5 L 0,10 z"),t.elementClass===constants.A.OBJECT_CLASS_LINE&&(s=2===i?5.1:3===i?.02:4===i||5===i||6===i?3.33:7===i?10:.05)),7===i&&(r.setAttributeNS(null,"fill","none"),r.setAttributeNS(null,"stroke-width",1)),r.setAttributeNS(null,"refY",o),r.setAttributeNS(null,"refX",s),r.appendChild(n),r},_setArrowColor:function(t,e,i,r,n){t&&(utils_type.A.isString(e)&&(7!==n?this._setAttribute((function(){t.setAttributeNS(null,"stroke",e),t.setAttributeNS(null,"fill",e),t.setAttributeNS(null,"stroke-opacity",i),t.setAttributeNS(null,"fill-opacity",i)}),r.visPropOld.fillcolor):this._setAttribute((function(){t.setAttributeNS(null,"fill","none"),t.setAttributeNS(null,"stroke",e),t.setAttributeNS(null,"stroke-opacity",i)}),r.visPropOld.fillcolor)),r.rendNode.parentNode.insertBefore(r.rendNode,r.rendNode))},_setArrowWidth:function(t,e,i,r){var n,s;t&&(s=(n=e)*r,t.setAttributeNS(null,"viewBox","0 0 "+10*n+" "+10*n),t.setAttributeNS(null,"markerHeight",s),t.setAttributeNS(null,"markerWidth",s),t.setAttributeNS(null,"display","inherit"),i.parentNode.insertBefore(i,i))},updateTicks:function(t){var e,i,r,n,s,o,a,l,c="",h=t.ticks.length,u=!0;for(e=0;e<h;e++){for(s=(r=t.ticks[e])[0],o=r[1],a=s.length,l=" M "+s[0]+" "+o[0],utils_type.A.isNumber(s[0])||(u=!1),i=1;u&&i<a;++i)utils_type.A.isNumber(s[i])?l+=" L "+s[i]+" "+o[i]:u=!1;u&&(c+=l)}n=t.rendNode,utils_type.A.exists(n)||(n=this.createPrim("path",t.id),this.appendChildPrim(n,t.evalVisProp("layer")),t.rendNode=n),n.setAttributeNS(null,"stroke",t.evalVisProp("strokecolor")),n.setAttributeNS(null,"fill","none"),n.setAttributeNS(null,"stroke-opacity",t.evalVisProp("strokeopacity")),n.setAttributeNS(null,"stroke-width",t.evalVisProp("strokewidth")),this.updatePathPrim(n,c,t.board)},displayCopyright:function(t,e){var i,r=this.createPrim("text","licenseText");r.setAttributeNS(null,"x","20px"),r.setAttributeNS(null,"y",2+e+"px"),r.setAttributeNS(null,"style","font-family:Arial,Helvetica,sans-serif; font-size:"+e+"px; fill:#356AA0;  opacity:0.3;"),i=this.container.ownerDocument.createTextNode(t),r.setAttributeNS(null,"aria-hidden","true"),r.appendChild(i),this.appendChildPrim(r,0)},drawInternalText:function(t){var e=this.createPrim("text",t.id);return e.style.whiteSpace="nowrap",t.rendNodeText=this.container.ownerDocument.createTextNode(""),e.appendChild(t.rendNodeText),this.appendChildPrim(e,t.evalVisProp("layer")),e},updateInternalText:function(t){var e,i,r=t.plaintext,n=t.getAnchorX(),s=t.getAnchorY();i=t.evalVisProp("cssclass"),t.rendNode.getAttributeNS(null,"class")!==i&&(t.rendNode.setAttributeNS(null,"class",i),t.needsSizeUpdate=!0),isNaN(t.coords.scrCoords[1]+t.coords.scrCoords[2])||(e=t.coords.scrCoords[1],t.visPropOld.left!==n+e&&(t.rendNode.setAttributeNS(null,"x",e+"px"),"left"===n?t.rendNode.setAttributeNS(null,"text-anchor","start"):"right"===n?t.rendNode.setAttributeNS(null,"text-anchor","end"):"middle"===n&&t.rendNode.setAttributeNS(null,"text-anchor","middle"),t.visPropOld.left=n+e),e=t.coords.scrCoords[2],t.visPropOld.top!==s+e&&(t.rendNode.setAttributeNS(null,"y",e+.5*this.vOffsetText+"px"),"bottom"===s?(t.rendNode.setAttributeNS(null,"dy","0"),t.rendNode.setAttributeNS(null,"dominant-baseline","auto")):"top"===s?(t.rendNode.setAttributeNS(null,"dy","1.6ex"),t.rendNode.setAttributeNS(null,"dominant-baseline","auto")):"middle"===s&&(t.rendNode.setAttributeNS(null,"dy","0.6ex"),t.rendNode.setAttributeNS(null,"dominant-baseline","auto")),t.visPropOld.top=s+e)),t.htmlStr!==r&&(t.rendNodeText.data=r,t.htmlStr=r),this.transformRect(t,t.transformations)},updateInternalTextStyle:function(t,e,i,r){this.setObjectFillColor(t,e,i)},drawImage:function(t){var e=this.createPrim("image",t.id);e.setAttributeNS(null,"preserveAspectRatio","none"),this.appendChildPrim(e,t.evalVisProp("layer")),t.rendNode=e,this.updateImage(t)},transformRect:function(t,e){var i,r,n,s,o,a="";if(e.length>0&&(n=t.rendNode,-1===(i=[(r=this.joinTransforms(t,e))[1][1],r[2][1],r[1][2],r[2][2],r[1][0],r[2][0]].join(",")).indexOf("NaN")))if(a+=" matrix("+i+") ",t.elementClass===constants.A.OBJECT_CLASS_TEXT&&"html"===t.visProp.display){switch(n.style.transform=a,s=-t.coords.scrCoords[1],o=-t.coords.scrCoords[2],t.evalVisProp("anchorx")){case"right":s+=t.size[0];break;case"middle":s+=.5*t.size[0]}switch(t.evalVisProp("anchory")){case"bottom":o+=t.size[1];break;case"middle":o+=.5*t.size[1]}n.style["transform-origin"]=s+"px "+o+"px"}else n.setAttributeNS(null,"transform",a)},updateImageURL:function(t){var e=t.eval(t.url);return t._src!==e&&(t.imgIsLoaded=!1,t.rendNode.setAttributeNS(this.xlinkNamespace,"xlink:href",e),t._src=e,!0)},updateImageStyle:function(t,e){var i=t.evalVisProp(e?"highlightcssclass":"cssclass");t.rendNode.setAttributeNS(null,"class",i)},drawForeignObject:function(t){t.rendNode=this.appendChildPrim(this.createPrim("foreignObject",t.id),t.evalVisProp("layer")),this.appendNodesToElement(t,"foreignObject"),this.updateForeignObject(t)},updateForeignObject:function(t){t._useUserSize?t.rendNode.style.overflow="hidden":t.rendNode.style.overflow="visible",this.updateRectPrim(t.rendNode,t.coords.scrCoords[1],t.coords.scrCoords[2]-t.size[1],t.size[0],t.size[1]),!0===t.evalVisProp("evaluateOnlyOnce")&&t.renderedOnce||(t.rendNode.innerHTML=t.content,t.renderedOnce=!0),this._updateVisual(t,{stroke:!0,dash:!0},!0)},appendChildPrim:function(t,e){return utils_type.A.exists(e)?e>=src_options.A.layer.numlayers&&(e=src_options.A.layer.numlayers-1):e=0,this.layer[e].appendChild(t),t},createPrim:function(t,e){var i=this.container.ownerDocument.createElementNS(this.svgNamespace,t);return i.setAttributeNS(null,"id",this.uniqName(e)),i.style.position="absolute","path"===t&&(i.setAttributeNS(null,"stroke-linecap","round"),i.setAttributeNS(null,"stroke-linejoin","round"),i.setAttributeNS(null,"fill-rule","evenodd")),i},remove:function(t){utils_type.A.exists(t)&&utils_type.A.exists(t.parentNode)&&t.parentNode.removeChild(t)},setLayer:function(t,e){utils_type.A.exists(e)?e>=src_options.A.layer.numlayers&&(e=src_options.A.layer.numlayers-1):e=0,this.layer[e].appendChild(t.rendNode)},makeArrows:function(t,e){var i,r,n=e.evFirst,s=e.evLast;this.isIE&&t.visPropCalc.visible&&(n||s)?t.rendNode.parentNode.insertBefore(t.rendNode,t.rendNode):(i=t.rendNodeTriangleStart,n?(r=this.toStr(this.container.id,"_",t.id,"TriangleStart",e.typeFirst),utils_type.A.exists(i)&&i.id===r||(null===(i=this.container.ownerDocument.getElementById(r))&&(i=this._createArrowHead(t,"Start",e.typeFirst),this.defs.appendChild(i)),t.rendNodeTriangleStart=i,t.rendNode.setAttributeNS(null,"marker-start",this.toURL(r)))):(utils_type.A.exists(i)&&(this.remove(i),t.rendNodeTriangleStart=null),t.rendNode.setAttributeNS(null,"marker-start",null)),i=t.rendNodeTriangleEnd,s?(r=this.toStr(this.container.id,"_",t.id,"TriangleEnd",e.typeLast),utils_type.A.exists(i)&&i.id===r||(null===(i=this.container.ownerDocument.getElementById(r))&&(i=this._createArrowHead(t,"End",e.typeLast),this.defs.appendChild(i)),t.rendNodeTriangleEnd=i,t.rendNode.setAttributeNS(null,"marker-end",this.toURL(r)))):(utils_type.A.exists(i)&&(this.remove(i),t.rendNodeTriangleEnd=null),t.rendNode.setAttributeNS(null,"marker-end",null)))},updateEllipsePrim:function(t,e,i,r,n){var s;s=2e5,e=Math.abs(e)<s?e:s*e/Math.abs(e),i=Math.abs(i)<s?i:s*i/Math.abs(i),r=Math.abs(r)<s?r:s*r/Math.abs(r),n=Math.abs(n)<s?n:s*n/Math.abs(n),t.setAttributeNS(null,"cx",e),t.setAttributeNS(null,"cy",i),t.setAttributeNS(null,"rx",Math.abs(r)),t.setAttributeNS(null,"ry",Math.abs(n))},updateLinePrim:function(t,e,i,r,n){var s;s=2e5,isNaN(e+i+r+n)||(e=Math.abs(e)<s?e:s*e/Math.abs(e),i=Math.abs(i)<s?i:s*i/Math.abs(i),r=Math.abs(r)<s?r:s*r/Math.abs(r),n=Math.abs(n)<s?n:s*n/Math.abs(n),t.setAttributeNS(null,"x1",e),t.setAttributeNS(null,"y1",i),t.setAttributeNS(null,"x2",r),t.setAttributeNS(null,"y2",n))},updatePathPrim:function(t,e){""===e&&(e="M 0 0"),t.setAttributeNS(null,"d",e)},updatePathStringPoint:function(t,e,i){var r="",n=t.coords.scrCoords,s=e*Math.sqrt(3)*.5,o=.5*e;return"x"===i?r=" M "+(n[1]-e)+" "+(n[2]-e)+" L "+(n[1]+e)+" "+(n[2]+e)+" M "+(n[1]+e)+" "+(n[2]-e)+" L "+(n[1]-e)+" "+(n[2]+e):"+"===i?r=" M "+(n[1]-e)+" "+n[2]+" L "+(n[1]+e)+" "+n[2]+" M "+n[1]+" "+(n[2]-e)+" L "+n[1]+" "+(n[2]+e):"|"===i?r=" M "+n[1]+" "+(n[2]-e)+" L "+n[1]+" "+(n[2]+e):"-"===i?r=" M "+(n[1]-e)+" "+n[2]+" L "+(n[1]+e)+" "+n[2]:"<>"===i||"<<>>"===i?("<<>>"===i&&(e*=1.41),r=" M "+(n[1]-e)+" "+n[2]+" L "+n[1]+" "+(n[2]+e)+" L "+(n[1]+e)+" "+n[2]+" L "+n[1]+" "+(n[2]-e)+" Z "):"^"===i?r=" M "+n[1]+" "+(n[2]-e)+" L "+(n[1]-s)+" "+(n[2]+o)+" L "+(n[1]+s)+" "+(n[2]+o)+" Z ":"v"===i?r=" M "+n[1]+" "+(n[2]+e)+" L "+(n[1]-s)+" "+(n[2]-o)+" L "+(n[1]+s)+" "+(n[2]-o)+" Z ":">"===i?r=" M "+(n[1]+e)+" "+n[2]+" L "+(n[1]-o)+" "+(n[2]-s)+" L "+(n[1]-o)+" "+(n[2]+s)+" Z ":"<"===i&&(r=" M "+(n[1]-e)+" "+n[2]+" L "+(n[1]+o)+" "+(n[2]-s)+" L "+(n[1]+o)+" "+(n[2]+s)+" Z "),r},updatePathStringPrim:function(t){var e,i,r,n=" M ",s=n,o="";if(t.numberPoints<=0)return"";if(r=Math.min(t.points.length,t.numberPoints),1===t.bezierDegree)for(e=0;e<r;e++)i=t.points[e].scrCoords,isNaN(i[1])||isNaN(i[2])?s=n:(i[1]=Math.max(Math.min(i[1],5e3),-5e3),i[2]=Math.max(Math.min(i[2],5e3),-5e3),o+=s+i[1]+" "+i[2],s=" L ");else if(3===t.bezierDegree)for(e=0;e<r;)i=t.points[e].scrCoords,isNaN(i[1])||isNaN(i[2])?s=n:(o+=s+i[1]+" "+i[2]," C "===s&&(e+=1,o+=" "+(i=t.points[e].scrCoords)[1]+" "+i[2],e+=1,o+=" "+(i=t.points[e].scrCoords)[1]+" "+i[2]),s=" C "),e+=1;return o},updatePathStringBezierPrim:function(t){var e,i,r,n,s,o,a,l=" M ",c=l,h="",u=t.evalVisProp("strokewidth"),d="plot"!==t.evalVisProp("curvetype");if(t.numberPoints<=0)return"";for(d&&t.board.options.curve.RDPsmoothing&&(t.points=numerics.A.RamerDouglasPeucker(t.points,.5)),a=Math.min(t.points.length,t.numberPoints),i=1;i<3;i++)for(c=l,e=0;e<a;e++)n=t.points[e].scrCoords,isNaN(n[1])||isNaN(n[2])?c=l:(n[1]=Math.max(Math.min(n[1],5e3),-5e3),n[2]=Math.max(Math.min(n[2],5e3),-5e3),c===l?h+=c+n[1]+" "+n[2]:(r=2*i,h+=[c,s+.333*(n[1]-s)+u*(r*Math.random()-i)," ",o+.333*(n[2]-o)+u*(r*Math.random()-i)," ",s+.666*(n[1]-s)+u*(r*Math.random()-i)," ",o+.666*(n[2]-o)+u*(r*Math.random()-i)," ",n[1]," ",n[2]].join("")),c=" C ",s=n[1],o=n[2]);return h},updatePolygonPrim:function(t,e){var i,r,n="",s=e.vertices.length;for(t.setAttributeNS(null,"stroke","none"),t.setAttributeNS(null,"fill-rule","evenodd"),"polygonalchain"===e.elType&&s++,i=0;i<s-1;i++){if(!e.vertices[i].isReal)return void t.setAttributeNS(null,"points","");n=n+(r=e.vertices[i].coords.scrCoords)[1]+","+r[2],i<s-2&&(n+=" ")}-1===n.indexOf("NaN")&&t.setAttributeNS(null,"points",n)},updateRectPrim:function(t,e,i,r,n){t.setAttributeNS(null,"x",e),t.setAttributeNS(null,"y",i),t.setAttributeNS(null,"width",r),t.setAttributeNS(null,"height",n)},_setAttribute:function(t,e){""===e?t():window.setTimeout(t,1)},display:function(t,e){var i;t&&t.rendNode&&(t.visPropOld.visible=e,i=t.rendNode,e?(i.setAttributeNS(null,"display","inline"),i.style.visibility="inherit"):(i.setAttributeNS(null,"display","none"),i.style.visibility="hidden"))},hide:function(t){jxg.A.deprecated("Board.renderer.hide()","Board.renderer.display()"),this.display(t,!1)},setARIA:function(t){var e,i,r;for(e in t.visProp.aria)t.visProp.aria.hasOwnProperty(e)&&"enabled"!==e&&(i="aria."+e,r=t.evalVisProp("aria."+e),t.visPropOld[i]!==r&&(this.setPropertyPrim(t.rendNode,"aria-"+e,r),t.visPropOld[i]=r))},setBuffering:function(t,e){t.rendNode.setAttribute("buffered-rendering",e)},setCssClass(t,e){t.visPropOld.cssclass!==e&&(this.setPropertyPrim(t.rendNode,"class",e),t.visPropOld.cssclass=e)},setDashStyle:function(t){var e=t.evalVisProp("dash"),i=t.evalVisProp("dashscale")?.5*t.evalVisProp("strokewidth"):1,r=t.rendNode;e>0?r.setAttributeNS(null,"stroke-dasharray",this.dashArray[e-1].map((function(t){return t*i})).join(",")):r.hasAttributeNS(null,"stroke-dasharray")&&r.removeAttributeNS(null,"stroke-dasharray")},setGradient:function(t){var e,i,r,n=t.rendNode,s=t.evalVisProp("gradient");"linear"===s||"radial"===s?(e=this.createPrim(s+"Gradient",t.id+"_gradient"),i=this.createPrim("stop",t.id+"_gradient1"),r=this.createPrim("stop",t.id+"_gradient2"),e.appendChild(i),e.appendChild(r),this.defs.appendChild(e),n.setAttributeNS(null,"style","fill:"+this.toURL(this.container.id+"_"+t.id+"_gradient")),t.gradNode1=i,t.gradNode2=r,t.gradNode=e):n.removeAttributeNS(null,"style")},setLineCap:function(t){var e=t.evalVisProp("linecap");void 0!==e&&""!==e&&t.visPropOld.linecap!==e&&utils_type.A.exists(t.rendNode)&&(this.setPropertyPrim(t.rendNode,"stroke-linecap",e),t.visPropOld.linecap=e)},setObjectFillColor:function(t,e,i,r){var n,s,o,a,l=e,c=i,h=t.evalVisProp("gradient");c=c>0?c:0,t.visPropOld.fillcolor===l&&t.visPropOld.fillopacity===c&&null===h||(utils_type.A.exists(l)&&!1!==l&&(9!==l.length?(s=l,a=c):(o=utils_color.A.rgba2rgbo(l),s=o[0],a=c*o[1]),n=void 0===r?t.rendNode:r,"none"!==s&&this._setAttribute((function(){n.setAttributeNS(null,"fill",s)}),t.visPropOld.fillcolor),t.type===jxg.A.OBJECT_TYPE_IMAGE?this._setAttribute((function(){n.setAttributeNS(null,"opacity",a)}),t.visPropOld.fillopacity):("none"===s?(a=0,n.setAttributeNS(null,"pointer-events","visibleStroke")):n.setAttributeNS(null,"pointer-events","visiblePainted"),this._setAttribute((function(){n.setAttributeNS(null,"fill-opacity",a)}),t.visPropOld.fillopacity)),"linear"!==h&&"radial"!==h||this.updateGradient(t)),t.visPropOld.fillcolor=l,t.visPropOld.fillopacity=c)},setObjectStrokeColor:function(t,e,i){var r,n,s,o,a=e,l=i;l=l>0?l:0,t.visPropOld.strokecolor===a&&t.visPropOld.strokeopacity===l||(utils_type.A.exists(a)&&!1!==a&&(9!==a.length?(r=a,s=l):(n=utils_color.A.rgba2rgbo(a),r=n[0],s=l*n[1]),o=t.rendNode,t.elementClass===constants.A.OBJECT_CLASS_TEXT?"html"===t.evalVisProp("display")?this._setAttribute((function(){o.style.color=r,o.style.opacity=s}),t.visPropOld.strokecolor):this._setAttribute((function(){o.setAttributeNS(null,"style","fill:"+r),o.setAttributeNS(null,"style","fill-opacity:"+s)}),t.visPropOld.strokecolor):this._setAttribute((function(){o.setAttributeNS(null,"stroke",r),o.setAttributeNS(null,"stroke-opacity",s)}),t.visPropOld.strokecolor),t.elementClass!==constants.A.OBJECT_CLASS_CURVE&&t.elementClass!==constants.A.OBJECT_CLASS_LINE||(t.evalVisProp("firstarrow")&&this._setArrowColor(t.rendNodeTriangleStart,r,s,t,t.visPropCalc.typeFirst),t.evalVisProp("lastarrow")&&this._setArrowColor(t.rendNodeTriangleEnd,r,s,t,t.visPropCalc.typeLast))),t.visPropOld.strokecolor=a,t.visPropOld.strokeopacity=l)},setObjectStrokeWidth:function(t,e){var i,r=e;isNaN(r)||t.visPropOld.strokewidth===r||(i=t.rendNode,this.setPropertyPrim(i,"stroked","true"),utils_type.A.exists(r)&&this.setPropertyPrim(i,"stroke-width",r+"px"),t.visPropOld.strokewidth=r)},setObjectTransition:function(t,e){var i,r,n,s=[],o=0,a=["rendNode","rendNodeTriangleStart","rendNodeTriangleEnd"];if(void 0===e&&(e=t.evalVisProp("transitionduration")),i=t.evalVisProp("transitionproperties"),e!==t.visPropOld.transitionduration||i!==t.visPropOld.transitionproperties){for(utils_type.A.exists(i)&&(o=i.length),n=0;n<o;n++)s.push(i[n]+" "+e+"ms");for(r=s.join(", "),o=a.length,n=0;n<o;++n)t[a[n]]&&(t[a[n]].style.transition=r);t.visPropOld.transitionduration=e,t.visPropOld.transitionproperties=i}},setShadow:function(t){var e,i,r,n,s,o,a,l,c=t.evalVisProp("shadow"),h=!0,u=!1;(e=JSON.stringify(c))!==t.visPropOld.shadow&&("boolean"==typeof c?(h=!0,u=c,i="none",r=3,n=.1,s=[5,5],o=1):t.evalVisProp("shadow.enabled")?(h=!1,u=!0,i=jxg.A.rgbParser(t.evalVisProp("shadow.color")),r=t.evalVisProp("shadow.blur"),n=t.evalVisProp("shadow.blend"),s=t.evalVisProp("shadow.offset"),o=t.evalVisProp("shadow.opacity")):u=!1,utils_type.A.exists(t.rendNode)&&(u?h?t.rendNode.setAttributeNS(null,"filter",this.toURL(this.container.id+"_f1")):((l=this.container.ownerDocument.getElementById(a))&&this.defs.removeChild(l),a=t.rendNode.id+"_f1",this.defs.appendChild(this.createShadowFilter(a,i,o,n,r,s)),t.rendNode.setAttributeNS(null,"filter",this.toURL(a))):t.rendNode.removeAttributeNS(null,"filter")),t.visPropOld.shadow=e)},setTabindex:function(t){var e;t.board.attr.keyboard.enabled&&utils_type.A.exists(t.rendNode)&&(e=t.evalVisProp("tabindex"),t.visPropCalc.visible||(e=null),e!==t.visPropOld.tabindex&&(t.rendNode.setAttribute("tabindex",e),t.visPropOld.tabindex=e))},setPropertyPrim:function(t,e,i){"stroked"!==e&&t.setAttributeNS(null,e,i)},show:function(t){jxg.A.deprecated("Board.renderer.show()","Board.renderer.display()"),this.display(t,!0)},updateGradient:function(t){var e,i,r=t.gradNode1,n=t.gradNode2,s=t.evalVisProp("gradient");utils_type.A.exists(r)&&utils_type.A.exists(n)&&(i=(i=t.evalVisProp("fillopacity"))>0?i:0,e=t.evalVisProp("fillcolor"),r.setAttributeNS(null,"style","stop-color:"+e+";stop-opacity:"+i),n.setAttributeNS(null,"style","stop-color:"+t.evalVisProp("gradientsecondcolor")+";stop-opacity:"+t.evalVisProp("gradientsecondopacity")),r.setAttributeNS(null,"offset",100*t.evalVisProp("gradientstartoffset")+"%"),n.setAttributeNS(null,"offset",100*t.evalVisProp("gradientendoffset")+"%"),"linear"===s?this.updateGradientAngle(t.gradNode,t.evalVisProp("gradientangle")):"radial"===s&&this.updateGradientCircle(t.gradNode,t.evalVisProp("gradientcx"),t.evalVisProp("gradientcy"),t.evalVisProp("gradientr"),t.evalVisProp("gradientfx"),t.evalVisProp("gradientfy"),t.evalVisProp("gradientfr")))},updateGradientAngle:function(t,e){var i=1,r=Math.cos(e),n=Math.sin(e);Math.abs(r)>Math.abs(n)?i/=Math.abs(r):i/=Math.abs(n),r>=0?(t.setAttributeNS(null,"x1",0),t.setAttributeNS(null,"x2",r*i)):(t.setAttributeNS(null,"x1",-r*i),t.setAttributeNS(null,"x2",0)),n>=0?(t.setAttributeNS(null,"y1",0),t.setAttributeNS(null,"y2",n*i)):(t.setAttributeNS(null,"y1",-n*i),t.setAttributeNS(null,"y2",0))},updateGradientCircle:function(t,e,i,r,n,s,o){t.setAttributeNS(null,"cx",100*e+"%"),t.setAttributeNS(null,"cy",100*i+"%"),t.setAttributeNS(null,"r",100*r+"%"),t.setAttributeNS(null,"fx",100*n+"%"),t.setAttributeNS(null,"fy",100*s+"%"),t.setAttributeNS(null,"fr",100*o+"%")},suspendRedraw:function(){this.suspendHandle=this.svgRoot.suspendRedraw(1e4)},unsuspendRedraw:function(){this.svgRoot.unsuspendRedraw(this.suspendHandle)},resize:function(t,e){this.svgRoot.setAttribute("width",parseFloat(t)),this.svgRoot.setAttribute("height",parseFloat(e))},createTouchpoints:function(t){var e,i,r,n;for(this.touchpoints=[],e=0;e<t;e++)i="touchpoint1_"+e,n=this.createPrim("path",i),this.appendChildPrim(n,19),n.setAttributeNS(null,"d","M 0 0"),this.touchpoints.push(n),this.setPropertyPrim(n,"stroked","true"),this.setPropertyPrim(n,"stroke-width","1px"),n.setAttributeNS(null,"stroke","#000000"),n.setAttributeNS(null,"stroke-opacity",1),n.setAttributeNS(null,"display","none"),r="touchpoint2_"+e,n=this.createPrim("ellipse",r),this.appendChildPrim(n,19),this.updateEllipsePrim(n,0,0,0,0),this.touchpoints.push(n),this.setPropertyPrim(n,"stroked","true"),this.setPropertyPrim(n,"stroke-width","1px"),n.setAttributeNS(null,"stroke","#000000"),n.setAttributeNS(null,"stroke-opacity",1),n.setAttributeNS(null,"fill","#ffffff"),n.setAttributeNS(null,"fill-opacity",0),n.setAttributeNS(null,"display","none")},showTouchpoint:function(t){this.touchpoints&&t>=0&&2*t<this.touchpoints.length&&(this.touchpoints[2*t].setAttributeNS(null,"display","inline"),this.touchpoints[2*t+1].setAttributeNS(null,"display","inline"))},hideTouchpoint:function(t){this.touchpoints&&t>=0&&2*t<this.touchpoints.length&&(this.touchpoints[2*t].setAttributeNS(null,"display","none"),this.touchpoints[2*t+1].setAttributeNS(null,"display","none"))},updateTouchpoint:function(t,e){var i,r;this.touchpoints&&t>=0&&2*t<this.touchpoints.length&&(i=e[0],r=e[1],this.touchpoints[2*t].setAttributeNS(null,"d","M "+(i-37)+" "+r+" L "+(i+37)+" "+r+" M "+i+" "+(r-37)+" L "+i+" "+(r+37)),this.updateEllipsePrim(this.touchpoints[2*t+1],e[0],e[1],25,25))},_getValuesOfDOMElements:function(t){var e=[];if(1===t.nodeType)for(t=t.firstChild;t;)void 0!==t.id&&void 0!==t.value&&e.push([t.id,t.value]),utils_type.A.concat(e,this._getValuesOfDOMElements(t)),t=t.nextSibling;return e},_getImgDataURL:function(t){var e,i,r,n,s,o;if((i=(e=t.getElementsByTagName("image")).length)>0)for(r=document.createElement("canvas"),o=0;o<i;o++){e[o].setAttribute("crossorigin","anonymous"),n=r.getContext("2d"),r.width=e[o].getAttribute("width"),r.height=e[o].getAttribute("height");try{n.drawImage(e[o],0,0,r.width,r.height),s=r.toDataURL(),e[o].setAttribute("xlink:href",s)}catch(t){console.log("CORS problem! Image can not be used",t)}}return!0},dumpToDataURI:function(t){var e,i,r,n=this.svgRoot,s=window.btoa||base64.encode,o=[];if(this.container.hasChildNodes()&&utils_type.A.exists(this.foreignObjLayer))for(t||this.foreignObjLayer.setAttribute("display","inline");n.nextSibling;)utils_type.A.concat(o,this._getValuesOfDOMElements(n.nextSibling)),this.foreignObjLayer.appendChild(n.nextSibling);if(this._getImgDataURL(n),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),e=(new XMLSerializer).serializeToString(n),!0!==t)for(r=o.length,i=0;i<r;i++)e=e.replace('id="'+o[i][0]+'"','id="'+o[i][0]+'" value="'+o[i][1]+'"');if(this.isIE&&(e.match(/xmlns="http:\/\/www.w3.org\/2000\/svg"\s+xmlns="http:\/\/www.w3.org\/2000\/svg"/g)||[]).length>1&&(e=e.replace(/xmlns="http:\/\/www.w3.org\/2000\/svg"\s+xmlns="http:\/\/www.w3.org\/2000\/svg"/g,"")),e=e.replace(/&nbsp;/g," "),utils_type.A.exists(this.foreignObjLayer)&&this.foreignObjLayer.hasChildNodes()){for(;this.foreignObjLayer.firstChild;)this.container.appendChild(this.foreignObjLayer.firstChild);this.foreignObjLayer.setAttribute("display","none")}return"data:image/svg+xml;base64,"+s(unescape(encodeURIComponent(e)))},dumpToCanvas:function(t,e,i,r){var n,s,o,a;return(o=this.container.ownerDocument.getElementById(t)).width=o.width,a=o.getContext("2d"),void 0!==e&&void 0!==i&&(o.style.width=parseFloat(e)+"px",o.style.height=parseFloat(i)+"px",o.setAttribute("width",parseFloat(e)),o.setAttribute("height",parseFloat(i))),s=new Image,n=this.dumpToDataURI(r),s.src=n,"Promise"in window?new Promise((function(t,r){try{s.onload=function(){a.drawImage(s,0,0,e,i),t()}}catch(t){r(t)}})):(s.onload=function(){window.setTimeout((function(){try{a.drawImage(s,0,0,e,i)}catch(t){console.log("screenshots not longer supported on IE")}}),200)},this)},screenshot:function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p,f,m=this.container.ownerDocument,g=this.container.parentNode,_=t.attr.screenshot,v=!1;return"no"===this.type||(c=_.scale*this.container.getBoundingClientRect().width,h=_.scale*this.container.getBoundingClientRect().height,void 0===e||""===e?(v=!0,(o=new Image).style.width=c+"px",o.style.height=h+"px"):(v=!1,o=m.getElementById(e)),v&&((r=m.createElement("div")).style.cssText=_.css,r.style.width=c+"px",r.style.height=h+"px",r.style.zIndex=this.container.style.zIndex+120,r.style.position="absolute",r.style.top=this.container.offsetTop+"px",r.style.left=this.container.offsetLeft+"px"),n=m.createElement("canvas"),s=Math.random().toString(36).slice(2,7),n.setAttribute("id",s),n.setAttribute("width",c),n.setAttribute("height",h),n.style.width=c+"px",n.style.height=c+"px",n.style.display="none",g.appendChild(n),v&&(a=m.createElement("span"),l=m.createTextNode(""),a.style.cssText=_.cssButton,a.appendChild(l),a.onclick=function(){r.parentNode.removeChild(r)},r.appendChild(o),r.appendChild(a),g.insertBefore(r,this.container.nextSibling)),u=m.getElementById(this.uniqName("navigationbar")),utils_type.A.exists(u)&&(d=u.style.display,u.style.display="none",p=this.removeToInsertLater(u)),f=function(){o.src=n.toDataURL("image/png"),g.removeChild(n)},"Promise"in window?this.dumpToCanvas(s,c,h,i).then(f):(this.dumpToCanvas(s,c,h,i),window.setTimeout(f,200)),utils_type.A.exists(u)&&(u.style.display=d,p())),this}});const svg=jxg.A.SVGRenderer;jxg.A.VMLRenderer=function(t){this.type="vml",this.container=t,this.container.style.overflow="hidden",""===this.container.style.position&&(this.container.style.position="relative"),this.container.onselectstart=function(){return!1},this.resolution=10,utils_type.A.exists(jxg.A.vmlStylesheet)||(t.ownerDocument.namespaces.add("jxgvml","urn:schemas-microsoft-com:vml"),jxg.A.vmlStylesheet=this.container.ownerDocument.createStyleSheet(),jxg.A.vmlStylesheet.addRule(".jxgvml","behavior:url(#default#VML)"));try{t.ownerDocument.namespaces.jxgvml||t.ownerDocument.namespaces.add("jxgvml","urn:schemas-microsoft-com:vml"),this.createNode=function(e){return t.ownerDocument.createElement("<jxgvml:"+e+' class="jxgvml">')}}catch(e){this.createNode=function(e){return t.ownerDocument.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="jxgvml">')}}this.dashArray=["Solid","1 1","ShortDash","Dash","LongDash","ShortDashDot","LongDashDot"]},jxg.A.VMLRenderer.prototype=new renderer_abstract,jxg.A.extend(jxg.A.VMLRenderer.prototype,{_setAttr:function(t,e,i,r){try{8===this.container.ownerDocument.documentMode?t[e]=i:t.setAttribute(e,i,r)}catch(t){jxg.A.debug("_setAttr: "+e+" "+i+"<br>\n")}},updateTicks:function(t){var e,i,r,n,s,o=this.resolution,a=[];for(i=t.ticks.length,e=0;e<i;e++)n=(r=t.ticks[e])[0],s=r[1],utils_type.A.isNumber(n[0])&&utils_type.A.isNumber(n[1])&&a.push(" m "+Math.round(o*n[0])+", "+Math.round(o*s[0])+" l "+Math.round(o*n[1])+", "+Math.round(o*s[1])+" ");utils_type.A.exists(t.rendNode)||(t.rendNode=this.createPrim("path",t.id),this.appendChildPrim(t.rendNode,t.evalVisProp("layer"))),this._setAttr(t.rendNode,"stroked","true"),this._setAttr(t.rendNode,"strokecolor",t.evalVisProp("strokecolor"),1),this._setAttr(t.rendNode,"strokeweight",t.evalVisProp("strokewidth")),this._setAttr(t.rendNodeStroke,"opacity",100*t.evalVisProp("strokeopacity")+"%"),this.updatePathPrim(t.rendNode,a,t.board)},displayCopyright:function(t,e){var i,r;(i=this.createNode("textbox")).style.position="absolute",this._setAttr(i,"id",this.container.id+"_licenseText"),i.style.left=20,i.style.top=2,i.style.fontSize=e,i.style.color="#356AA0",i.style.fontFamily="Arial,Helvetica,sans-serif",this._setAttr(i,"opacity","30%"),i.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11='1.0', sizingMethod='auto expand', enabled = false) progid:DXImageTransform.Microsoft.Alpha(opacity = 30, enabled = true)",r=this.container.ownerDocument.createTextNode(t),i.appendChild(r),this.appendChildPrim(i,0)},drawInternalText:function(t){var e;return(e=this.createNode("textbox")).style.position="absolute",t.rendNodeText=this.container.ownerDocument.createTextNode(""),e.appendChild(t.rendNodeText),this.appendChildPrim(e,9),e.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11='1.0', sizingMethod='auto expand', enabled = false) progid:DXImageTransform.Microsoft.Alpha(opacity = 100, enabled = false)",e},updateInternalText:function(t){var e,i,r,n,s,o,a=t.plaintext,l=this.joinTransforms(t,t.transformations),c=[0,0],h=t.rendNode,u=[],d=t.getAnchorX(),p=t.getAnchorY();if(!isNaN(t.coords.scrCoords[1]+t.coords.scrCoords[2])){for("right"===d?c[0]=1:"middle"===d&&(c[0]=.5),"bottom"===p?c[1]=1:"middle"===p&&(c[1]=.5),u[0]=math.A.matVecMult(l,[1,t.coords.scrCoords[1]-c[0]*t.size[0],t.coords.scrCoords[2]+(1-c[1])*t.size[1]+this.vOffsetText]),u[0][1]/=u[0][0],u[0][2]/=u[0][0],u[1]=math.A.matVecMult(l,[1,t.coords.scrCoords[1]+(1-c[0])*t.size[0],t.coords.scrCoords[2]+(1-c[1])*t.size[1]+this.vOffsetText]),u[1][1]/=u[1][0],u[1][2]/=u[1][0],u[2]=math.A.matVecMult(l,[1,t.coords.scrCoords[1]+(1-c[0])*t.size[0],t.coords.scrCoords[2]-c[1]*t.size[1]+this.vOffsetText]),u[2][1]/=u[2][0],u[2][2]/=u[2][0],u[3]=math.A.matVecMult(l,[1,t.coords.scrCoords[1]-c[0]*t.size[0],t.coords.scrCoords[2]-c[1]*t.size[1]+this.vOffsetText]),u[3][1]/=u[3][0],u[3][2]/=u[3][0],i=u[0][1],n=u[0][1],r=u[0][2],s=u[0][2],o=1;o<4;o++)i=Math.max(i,u[o][1]),n=Math.min(n,u[o][1]),r=Math.max(r,u[o][2]),s=Math.min(s,u[o][2]);e=1===c[0]?Math.floor(t.board.canvasWidth-i):Math.floor(n),t.visPropOld.left!==d+e&&(1===c[0]?(t.rendNode.style.right=e+"px",t.rendNode.style.left="auto"):(t.rendNode.style.left=e+"px",t.rendNode.style.right="auto"),t.visPropOld.left=d+e),e=1===c[1]?Math.floor(t.board.canvasHeight-r):Math.floor(s),t.visPropOld.top!==p+e&&(1===c[1]?(t.rendNode.style.bottom=e+"px",t.rendNode.style.top="auto"):(t.rendNode.style.top=e+"px",t.rendNode.style.bottom="auto"),t.visPropOld.top=p+e)}t.htmlStr!==a&&(t.rendNodeText.data=a,t.htmlStr=a),h.filters.item(0).M11=l[1][1],h.filters.item(0).M12=l[1][2],h.filters.item(0).M21=l[2][1],h.filters.item(0).M22=l[2][2],h.filters.item(0).enabled=!0},drawImage:function(t){var e;(e=this.container.ownerDocument.createElement("img")).style.position="absolute",this._setAttr(e,"id",this.container.id+"_"+t.id),this.container.appendChild(e),this.appendChildPrim(e,t.evalVisProp("layer")),e.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11='1.0', sizingMethod='auto expand') progid:DXImageTransform.Microsoft.Alpha(opacity = 100, enabled = false)",t.rendNode=e,this.updateImage(t)},transformRect:function(t,e){var i,r,n,s,o,a,l=t.rendNode,c=[];if(e.length>0){for(i=this.joinTransforms(t,e),c[0]=math.A.matVecMult(i,t.coords.scrCoords),c[0][1]/=c[0][0],c[0][2]/=c[0][0],c[1]=math.A.matVecMult(i,[1,t.coords.scrCoords[1]+t.size[0],t.coords.scrCoords[2]]),c[1][1]/=c[1][0],c[1][2]/=c[1][0],c[2]=math.A.matVecMult(i,[1,t.coords.scrCoords[1]+t.size[0],t.coords.scrCoords[2]-t.size[1]]),c[2][1]/=c[2][0],c[2][2]/=c[2][0],c[3]=math.A.matVecMult(i,[1,t.coords.scrCoords[1],t.coords.scrCoords[2]-t.size[1]]),c[3][1]/=c[3][0],c[3][2]/=c[3][0],r=c[0][1],s=c[0][1],n=c[0][2],o=c[0][2],a=1;a<4;a++)r=Math.max(r,c[a][1]),s=Math.min(s,c[a][1]),n=Math.max(n,c[a][2]),o=Math.min(o,c[a][2]);l.style.left=Math.floor(s)+"px",l.style.top=Math.floor(o)+"px",l.filters.item(0).M11=i[1][1],l.filters.item(0).M12=i[1][2],l.filters.item(0).M21=i[2][1],l.filters.item(0).M22=i[2][2],l.filters.item(0).enabled=!0}},updateImageURL:function(t){var e=t.eval(t.url);this._setAttr(t.rendNode,"src",e)},appendChildPrim:function(t,e){return utils_type.A.exists(e)||(e=0),t.style.zIndex=e,this.container.appendChild(t),t},appendNodesToElement:function(t,e){"shape"!==e&&"path"!==e&&"polygon"!==e||(t.rendNodePath=this.getElementById(t.id+"_path")),t.rendNodeFill=this.getElementById(t.id+"_fill"),t.rendNodeStroke=this.getElementById(t.id+"_stroke"),t.rendNodeShadow=this.getElementById(t.id+"_shadow"),t.rendNode=this.getElementById(t.id)},createPrim:function(t,e){var i,r,n=this.createNode("fill"),s=this.createNode("stroke"),o=this.createNode("shadow");return this._setAttr(n,"id",this.container.id+"_"+e+"_fill"),this._setAttr(s,"id",this.container.id+"_"+e+"_stroke"),this._setAttr(o,"id",this.container.id+"_"+e+"_shadow"),"circle"===t||"ellipse"===t?((i=this.createNode("oval")).appendChild(n),i.appendChild(s),i.appendChild(o)):"polygon"===t||"path"===t||"shape"===t||"line"===t?((i=this.createNode("shape")).appendChild(n),i.appendChild(s),i.appendChild(o),r=this.createNode("path"),this._setAttr(r,"id",this.container.id+"_"+e+"_path"),i.appendChild(r)):((i=this.createNode(t)).appendChild(n),i.appendChild(s),i.appendChild(o)),i.style.position="absolute",i.style.left="0px",i.style.top="0px",this._setAttr(i,"id",this.container.id+"_"+e),i},remove:function(t){utils_type.A.exists(t)&&t.removeNode(!0)},makeArrows:function(t){var e,i=t.evalVisProp("firstarrow"),r=t.evalVisProp("lastarrow");t.visPropOld.firstarrow===i&&t.visPropOld.lastarrow===r||(i?(e=t.rendNodeStroke,this._setAttr(e,"startarrow","block"),this._setAttr(e,"startarrowlength","long")):(e=t.rendNodeStroke,utils_type.A.exists(e)&&this._setAttr(e,"startarrow","none")),r?(e=t.rendNodeStroke,this._setAttr(e,"id",this.container.id+"_"+t.id+"stroke"),this._setAttr(e,"endarrow","block"),this._setAttr(e,"endarrowlength","long")):(e=t.rendNodeStroke,utils_type.A.exists(e)&&this._setAttr(e,"endarrow","none")),t.visPropOld.firstarrow=i,t.visPropOld.lastarrow=r)},updateEllipsePrim:function(t,e,i,r,n){t.style.left=Math.floor(e-r)+"px",t.style.top=Math.floor(i-n)+"px",t.style.width=Math.floor(2*Math.abs(r))+"px",t.style.height=Math.floor(2*Math.abs(n))+"px"},updateLinePrim:function(t,e,i,r,n,s){var o,a=this.resolution;isNaN(e+i+r+n)||(o=["m ",Math.floor(a*e),", ",Math.floor(a*i)," l ",Math.floor(a*r),", ",Math.floor(a*n)],this.updatePathPrim(t,o,s))},updatePathPrim:function(t,e,i){var r=i.canvasWidth,n=i.canvasHeight;e.length<=0&&(e=["m 0,0"]),t.style.width=r,t.style.height=n,this._setAttr(t,"coordsize",[Math.floor(this.resolution*r),Math.floor(this.resolution*n)].join(",")),this._setAttr(t,"path",e.join(""))},updatePathStringPoint:function(t,e,i){var r=[],n=Math.round,s=t.coords.scrCoords,o=e*Math.sqrt(3)*.5,a=.5*e,l=this.resolution;return"x"===i?r.push([" m ",n(l*(s[1]-e)),", ",n(l*(s[2]-e))," l ",n(l*(s[1]+e)),", ",n(l*(s[2]+e))," m ",n(l*(s[1]+e)),", ",n(l*(s[2]-e))," l ",n(l*(s[1]-e)),", ",n(l*(s[2]+e))].join("")):"+"===i?r.push([" m ",n(l*(s[1]-e)),", ",n(l*s[2])," l ",n(l*(s[1]+e)),", ",n(l*s[2])," m ",n(l*s[1]),", ",n(l*(s[2]-e))," l ",n(l*s[1]),", ",n(l*(s[2]+e))].join("")):"<>"===i||"<<>>"===i?("<<>>"===i&&(e*=1.41),r.push([" m ",n(l*(s[1]-e)),", ",n(l*s[2])," l ",n(l*s[1]),", ",n(l*(s[2]+e))," l ",n(l*(s[1]+e)),", ",n(l*s[2])," l ",n(l*s[1]),", ",n(l*(s[2]-e))," x e "].join(""))):"^"===i?r.push([" m ",n(l*s[1]),", ",n(l*(s[2]-e))," l ",n(l*(s[1]-o)),", ",n(l*(s[2]+a))," l ",n(l*(s[1]+o)),", ",n(l*(s[2]+a))," x e "].join("")):"v"===i?r.push([" m ",n(l*s[1]),", ",n(l*(s[2]+e))," l ",n(l*(s[1]-o)),", ",n(l*(s[2]-a))," l ",n(l*(s[1]+o)),", ",n(l*(s[2]-a))," x e "].join("")):">"===i?r.push([" m ",n(l*(s[1]+e)),", ",n(l*s[2])," l ",n(l*(s[1]-a)),", ",n(l*(s[2]-o))," l ",n(l*(s[1]-a)),", ",n(l*(s[2]+o))," l ",n(l*(s[1]+e)),", ",n(l*s[2])].join("")):"<"===i&&r.push([" m ",n(l*(s[1]-e)),", ",n(l*s[2])," l ",n(l*(s[1]+a)),", ",n(l*(s[2]-o))," l ",n(l*(s[1]+a)),", ",n(l*(s[2]+o))," x e "].join("")),r},updatePathStringPrim:function(t){var e,i,r=[],n=this.resolution,s=Math.round,o=" m ",a=o,l=Math.min(t.numberPoints,8192);if(t.numberPoints<=0)return"";if(l=Math.min(l,t.points.length),1===t.bezierDegree)for(e=0;e<l;e++)i=t.points[e].scrCoords,isNaN(i[1])||isNaN(i[2])?a=o:(i[1]>2e4?i[1]=2e4:i[1]<-2e4&&(i[1]=-2e4),i[2]>2e4?i[2]=2e4:i[2]<-2e4&&(i[2]=-2e4),r.push([a,s(n*i[1]),", ",s(n*i[2])].join("")),a=" l ");else if(3===t.bezierDegree)for(e=0;e<l;)i=t.points[e].scrCoords,isNaN(i[1])||isNaN(i[2])?a=o:(r.push([a,s(n*i[1]),", ",s(n*i[2])].join(""))," c "===a&&(e+=1,i=t.points[e].scrCoords,r.push([" ",s(n*i[1]),", ",s(n*i[2])].join("")),e+=1,i=t.points[e].scrCoords,r.push([" ",s(n*i[1]),", ",s(n*i[2])].join(""))),a=" c "),e+=1;return r.push(" e"),r},updatePathStringBezierPrim:function(t){var e,i,r,n,s,o,a=[],l=t.evalVisProp("strokewidth"),c=this.resolution,h=Math.round,u=" m ",d=u,p="plot"!==t.evalVisProp("curvetype"),f=Math.min(t.numberPoints,8192);if(t.numberPoints<=0)return"";for(p&&t.board.options.curve.RDPsmoothing&&(t.points=numerics.A.RamerDouglasPeucker(t.points,1)),f=Math.min(f,t.points.length),i=1;i<3;i++)for(d=u,e=0;e<f;e++)n=t.points[e].scrCoords,isNaN(n[1])||isNaN(n[2])?d=u:(n[1]>2e4?n[1]=2e4:n[1]<-2e4&&(n[1]=-2e4),n[2]>2e4?n[2]=2e4:n[2]<-2e4&&(n[2]=-2e4),d===u?a.push([d,h(c*n[1])," ",h(c*n[2])].join("")):(r=2*i,a.push([d,h(c*(s+.333*(n[1]-s)+l*(r*Math.random()-i)))," ",h(c*(o+.333*(n[2]-o)+l*(r*Math.random()-i)))," ",h(c*(s+.666*(n[1]-s)+l*(r*Math.random()-i)))," ",h(c*(o+.666*(n[2]-o)+l*(r*Math.random()-i)))," ",h(c*n[1])," ",h(c*n[2])].join(""))),d=" c ",s=n[1],o=n[2]);return a.push(" e"),a},updatePolygonPrim:function(t,e){var i,r,n=e.vertices.length,s=this.resolution,o=[];if(this._setAttr(t,"stroked","false"),r=e.vertices[0].coords.scrCoords,!isNaN(r[1]+r[2])){for(o.push(["m ",Math.floor(s*r[1]),",",Math.floor(s*r[2])," l "].join("")),i=1;i<n-1;i++){if(!e.vertices[i].isReal)return void this.updatePathPrim(t,"",e.board);if(r=e.vertices[i].coords.scrCoords,isNaN(r[1]+r[2]))return;o.push(Math.floor(s*r[1])+","+Math.floor(s*r[2])),i<n-2&&o.push(", ")}o.push(" x e"),this.updatePathPrim(t,o,e.board)}},updateRectPrim:function(t,e,i,r,n){t.style.left=Math.floor(e)+"px",t.style.top=Math.floor(i)+"px",r>=0&&(t.style.width=r+"px"),n>=0&&(t.style.height=n+"px")},setPropertyPrim:function(t,e,i){var r,n="";switch(e){case"stroke":n="strokecolor";break;case"stroke-width":n="strokeweight";break;case"stroke-dasharray":n="dashstyle"}""!==n&&(r=i,this._setAttr(t,n,r))},display:function(t,e){t&&t.rendNode&&(t.visPropOld.visible=e,t.rendNode.style.visibility=e?"inherit":"hidden")},show:function(t){jxg.A.deprecated("Board.renderer.show()","Board.renderer.display()"),t&&t.rendNode&&(t.rendNode.style.visibility="inherit")},hide:function(t){jxg.A.deprecated("Board.renderer.hide()","Board.renderer.display()"),t&&t.rendNode&&(t.rendNode.style.visibility="hidden")},setDashStyle:function(t,e){var i;e.dash>=0&&(i=t.rendNodeStroke,this._setAttr(i,"dashstyle",this.dashArray[e.dash]))},setGradient:function(t){var e=t.rendNodeFill,i=t.evalVisProp("gradient");"linear"===i?(this._setAttr(e,"type","gradient"),this._setAttr(e,"color2",t.evalVisProp("gradientsecondcolor")),this._setAttr(e,"opacity2",t.evalVisProp("gradientsecondopacity")),this._setAttr(e,"angle",t.evalVisProp("gradientangle"))):"radial"===i?(this._setAttr(e,"type","gradientradial"),this._setAttr(e,"color2",t.evalVisProp("gradientsecondcolor")),this._setAttr(e,"opacity2",t.evalVisProp("gradientsecondopacity")),this._setAttr(e,"focusposition",100*t.evalVisProp("gradientpositionx")+"%,"+100*t.evalVisProp("gradientpositiony")+"%"),this._setAttr(e,"focussize","0,0")):this._setAttr(e,"type","solid")},setObjectFillColor:function(t,e,i){var r,n,s,o=e,a=i,l=t.rendNode;a=a>0?a:0,t.visPropOld.fillcolor===o&&t.visPropOld.fillopacity===a||(utils_type.A.exists(o)&&!1!==o&&(9!==o.length?(r=o,s=a):(r=(n=utils_color.A.rgba2rgbo(o))[0],s=a*n[1]),"none"===r||!1===r?this._setAttr(t.rendNode,"filled","false"):(this._setAttr(t.rendNode,"filled","true"),this._setAttr(t.rendNode,"fillcolor",r),utils_type.A.exists(s)&&t.rendNodeFill&&this._setAttr(t.rendNodeFill,"opacity",100*s+"%")),t.type===constants.A.OBJECT_TYPE_IMAGE&&l.filters.length>1&&(l.filters.item(1).opacity=Math.round(100*s),l.filters.item(1).enabled=!0)),t.visPropOld.fillcolor=o,t.visPropOld.fillopacity=a)},setObjectStrokeColor:function(t,e,i){var r,n,s,o,a=e,l=i,c=t.rendNode;l=l>0?l:0,t.visPropOld.strokecolor===a&&t.visPropOld.strokeopacity===l||(utils_type.A.exists(a)&&!1!==a&&(9!==a.length?(r=a,s=l):(r=(n=e.rgba2rgbo(a))[0],s=l*n[1]),t.elementClass===constants.A.OBJECT_CLASS_TEXT?(c.filters.length>1&&(c.filters.item(1).opacity=Math.round(100*s),c.filters.item(1).enabled=!0),c.style.color=r):(!1!==r&&(this._setAttr(c,"stroked","true"),this._setAttr(c,"strokecolor",r)),o=t.rendNodeStroke,utils_type.A.exists(s)&&t.type!==constants.A.OBJECT_TYPE_IMAGE&&this._setAttr(o,"opacity",100*s+"%"))),t.visPropOld.strokecolor=a,t.visPropOld.strokeopacity=l)},setObjectStrokeWidth:function(t,e){var i,r=utils_type.A.evaluate(e);isNaN(r)||t.visPropOld.strokewidth===r||(i=t.rendNode,this.setPropertyPrim(i,"stroked","true"),utils_type.A.exists(r)&&(this.setPropertyPrim(i,"stroke-width",r),0===r&&utils_type.A.exists(t.rendNodeStroke)&&this._setAttr(i,"stroked","false")),t.visPropOld.strokewidth=r)},setShadow:function(t){var e=t.rendNodeShadow,i=t.evalVisProp("shadow");e&&t.visPropOld.shadow!==i&&(i?(this._setAttr(e,"On","True"),this._setAttr(e,"Offset","3pt,3pt"),this._setAttr(e,"Opacity","60%"),this._setAttr(e,"Color","#aaaaaa")):this._setAttr(e,"On","False"),t.visPropOld.shadow=i)},suspendRedraw:function(){this.container.style.display="none"},unsuspendRedraw:function(){this.container.style.display=""}});const vml=jxg.A.VMLRenderer;var uuidCharsStr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",uuidChars=uuidCharsStr.split("");jxg.A.Util=jxg.A.Util||{},jxg.A.Util.genUUID=function(t){var e,i,r=[],n=0;for(""!==(t=t||"")&&"-"!==t.slice(t.length-1)&&(t+="-"),i=0;i<36;i++)8===i||13===i||18===i||23===i?r[i]="-":14===i?r[i]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),e=15&n,n>>=4,r[i]=uuidChars[19===i?3&e|8:e]);return t+r.join("")};const uuid=jxg.A.Util;jxg.A.CanvasRenderer=function(t,e){if(this.type="canvas",this.canvasRoot=null,this.suspendHandle=null,this.canvasId=uuid.genUUID(),this.canvasNamespace=null,env.A.isBrowser)this.container=t,this.container.style.MozUserSelect="none",this.container.style.userSelect="none",this.container.style.overflow="hidden",""===this.container.style.position&&(this.container.style.position="relative"),this.container.innerHTML=['<canvas id="',this.canvasId,'" width="',e.width,'px" height="',e.height,'px"></canvas>'].join(""),this.canvasRoot=this.container.ownerDocument.getElementById(this.canvasId),this.canvasRoot.style.display="block",this.context=this.canvasRoot.getContext("2d");else if(env.A.isNode())try{this.canvasRoot=jxg.A.createCanvas(500,500),this.context=this.canvasRoot.getContext("2d")}catch(t){throw new Error('JXG.createCanvas not available.\nInstall the npm package `canvas`\nand call:\n    import { createCanvas } from "canvas.js";\n    JXG.createCanvas = createCanvas;\n')}},jxg.A.CanvasRenderer.prototype=new renderer_abstract,jxg.A.extend(jxg.A.CanvasRenderer.prototype,{_drawPolygon:function(t,e,i){var r,n=t.length,s=this.context;if(n>0){if(i&&(s.lineWidth=0),s.beginPath(),s.moveTo(t[0][0],t[0][1]),1===e)for(r=1;r<n;r++)s.lineTo(t[r][0],t[r][1]);else for(r=1;r<n;r+=3)s.bezierCurveTo(t[r][0],t[r][1],t[r+1][0],t[r+1][1],t[r+2][0],t[r+2][1]);i?(s.lineTo(t[0][0],t[0][1]),s.closePath(),s.fill("evenodd")):s.stroke()}},_fill:function(t){var e=this.context;e.save(),this._setColor(t,"fill")&&e.fill("evenodd"),e.restore()},_rotatePoint:function(t,e,i){return[e*Math.cos(t)-i*Math.sin(t),e*Math.sin(t)+i*Math.cos(t)]},_rotateShape:function(t,e){var i,r=[],n=t.length;if(n<=0)return t;for(i=0;i<n;i++)r.push(this._rotatePoint(e,t[i][0],t[i][1]));return r},updateGradientAngle:function(t,e){var i,r,n,s,o,a,l,c,h,u,d,p,f=1,m=Math.cos(-e),g=Math.sin(-e),_=t.getBoundingBox();return Math.abs(m)>Math.abs(g)?f/=Math.abs(m):f/=Math.abs(g),m>=0?(n=0,s=m*f):(n=-m*f,s=0),g>=0?(o=0,a=g*f):(o=-g*f,a=0),i=new base_coords.A(constants.A.COORDS_BY_USER,[_[0],_[1]],t.board),d=(r=new base_coords.A(constants.A.COORDS_BY_USER,[_[2],_[3]],t.board)).scrCoords[1]-i.scrCoords[1],p=r.scrCoords[2]-i.scrCoords[2],l=i.scrCoords[1]+d*n,h=i.scrCoords[2]+p*o,c=i.scrCoords[1]+d*s,u=i.scrCoords[2]+p*a,this.context.createLinearGradient(l,h,c,u)},updateGradientCircle:function(t,e,i,r,n,s,o){var a,l,c,h,u,d,p,f,m,g,_=t.getBoundingBox();return a=new base_coords.A(constants.A.COORDS_BY_USER,[_[0],_[1]],t.board),m=(l=new base_coords.A(constants.A.COORDS_BY_USER,[_[2],_[3]],t.board)).scrCoords[1]-a.scrCoords[1],g=a.scrCoords[2]-l.scrCoords[2],c=a.scrCoords[1]+m*e,h=l.scrCoords[2]+g*i,d=a.scrCoords[1]+m*n,p=l.scrCoords[2]+g*s,u=r*(m+g)*.5,f=o*(m+g)*.5,this.context.createRadialGradient(d,p,f,c,h,u)},updateGradient:function(t){var e,i,r=t.evalVisProp("gradient");return e=t.evalVisProp("fillcolor"),"linear"===r?i=this.updateGradientAngle(t,t.evalVisProp("gradientangle")):"radial"===r&&(i=this.updateGradientCircle(t,t.evalVisProp("gradientcx"),t.evalVisProp("gradientcy"),t.evalVisProp("gradientr"),t.evalVisProp("gradientfx"),t.evalVisProp("gradientfy"),t.evalVisProp("gradientfr"))),i.addColorStop(t.evalVisProp("gradientstartoffset"),e),i.addColorStop(t.evalVisProp("gradientendoffset"),t.evalVisProp("gradientsecondcolor")),i},_setColor:function(t,e,i){var r,n,s,o,a,l,c,h,u,d=!0;return e=e||"stroke",i=i||e,n=this._getHighlighted(t),"none"!==(o=t.evalVisProp(n+e+"color"))&&!1!==o?(c=(c=t.evalVisProp(n+e+"opacity"))>0?c:0,9!==o.length?(l=o,h=c):(l=(a=utils_color.A.rgba2rgbo(o))[0],h=c*a[1]),this.context.globalAlpha=h,this.context[i+"Style"]=l):d=!1,"linear"===(u=t.evalVisProp("gradient"))||"radial"===u?(this.context.globalAlpha=h,this.context[i+"Style"]=this.updateGradient(t),d):(s=parseFloat(t.evalVisProp(n+"strokewidth")),"stroke"!==e||isNaN(s)||(0===s?this.context.globalAlpha=0:this.context.lineWidth=s),r=t.evalVisProp("linecap"),"stroke"===e&&void 0!==r&&""!==r&&(this.context.lineCap=r),d)},_stroke:function(t){var e=this.context,i=t.evalVisProp("dash"),r=t.evalVisProp("dashscale")?.5*t.evalVisProp("strokewidth"):1;e.save(),i>0?e.setLineDash&&e.setLineDash(this.dashArray[i-1].map((function(t){return t*r}))):this.context.lineDashArray=[],this._setColor(t,"stroke")&&e.stroke(),e.restore()},_translateShape:function(t,e,i){var r,n=[],s=t.length;if(s<=0)return t;for(r=0;r<s;r++)n.push([t[r][0]+e,t[r][1]+i]);return n},drawPoint:function(t){var e=t.evalVisProp("face"),i=t.evalVisProp("size"),r=t.coords.scrCoords,n=i*Math.sqrt(3)*.5,s=.5*i,o=parseFloat(t.evalVisProp("strokewidth"))/2,a=this.context;if(t.visPropCalc.visible)switch(e){case"cross":case"x":a.beginPath(),a.moveTo(r[1]-i,r[2]-i),a.lineTo(r[1]+i,r[2]+i),a.moveTo(r[1]+i,r[2]-i),a.lineTo(r[1]-i,r[2]+i),a.lineCap="round",a.lineJoin="round",a.closePath(),this._stroke(t);break;case"circle":case"o":a.beginPath(),a.arc(r[1],r[2],i+1+o,0,2*Math.PI,!1),a.closePath(),this._fill(t),this._stroke(t);break;case"square":case"[]":if(i<=0)break;a.save(),this._setColor(t,"stroke","fill")&&a.fillRect(r[1]-i-o,r[2]-i-o,2*i+3*o,2*i+3*o),a.restore(),a.save(),this._setColor(t,"fill"),a.fillRect(r[1]-i+o,r[2]-i+o,2*i-o,2*i-o),a.restore();break;case"plus":case"+":a.beginPath(),a.moveTo(r[1]-i,r[2]),a.lineTo(r[1]+i,r[2]),a.moveTo(r[1],r[2]-i),a.lineTo(r[1],r[2]+i),a.lineCap="round",a.lineJoin="round",a.closePath(),this._stroke(t);break;case"divide":case"|":a.beginPath(),a.moveTo(r[1],r[2]-i),a.lineTo(r[1],r[2]+i),a.lineCap="round",a.lineJoin="round",a.closePath(),this._stroke(t);break;case"minus":case"-":a.beginPath(),a.moveTo(r[1]-i,r[2]),a.lineTo(r[1]+i,r[2]),a.lineCap="round",a.lineJoin="round",a.closePath(),this._stroke(t);break;case"diamond2":case"<<>>":i*=1.41;case"diamond":case"<>":a.beginPath(),a.moveTo(r[1]-i,r[2]),a.lineTo(r[1],r[2]+i),a.lineTo(r[1]+i,r[2]),a.lineTo(r[1],r[2]-i),a.closePath(),this._fill(t),this._stroke(t);break;case"triangleup":case"A":case"a":case"^":a.beginPath(),a.moveTo(r[1],r[2]-i),a.lineTo(r[1]-n,r[2]+s),a.lineTo(r[1]+n,r[2]+s),a.closePath(),this._fill(t),this._stroke(t);break;case"triangledown":case"v":a.beginPath(),a.moveTo(r[1],r[2]+i),a.lineTo(r[1]-n,r[2]-s),a.lineTo(r[1]+n,r[2]-s),a.closePath(),this._fill(t),this._stroke(t);break;case"triangleleft":case"<":a.beginPath(),a.moveTo(r[1]-i,r[2]),a.lineTo(r[1]+s,r[2]-n),a.lineTo(r[1]+s,r[2]+n),a.closePath(),this._fill(t),this._stroke(t);break;case"triangleright":case">":a.beginPath(),a.moveTo(r[1]+i,r[2]),a.lineTo(r[1]-s,r[2]-n),a.lineTo(r[1]-s,r[2]+n),a.closePath(),this._fill(t),this._stroke(t)}},updatePoint:function(t){this.drawPoint(t)},drawArrows:function(t,e,i,r,n){var s,o,a,l,c,h,u,d,p,f,m,g,_,v,y,b,A,x,C,E,M=this.context,S=1,w=1,P=1,T=n.evFirst,O=n.evLast;if("none"!==t.evalVisProp("strokecolor")&&(T||O)){if(t.elementClass===constants.A.OBJECT_CLASS_LINE)s=e.scrCoords[1],o=e.scrCoords[2],a=i.scrCoords[1],l=i.scrCoords[2],C=E=Math.atan2(l-o,a-s);else{if(s=t.points[0].scrCoords[1],o=t.points[0].scrCoords[2],(x=t.points.length-1)<1)return;a=t.points[t.points.length-1].scrCoords[1],l=t.points[t.points.length-1].scrCoords[2],v=t.points[1].scrCoords[1]-t.points[0].scrCoords[1],y=t.points[1].scrCoords[2]-t.points[0].scrCoords[2],b=t.points[x].scrCoords[1]-t.points[x-1].scrCoords[1],A=t.points[x].scrCoords[2]-t.points[x-1].scrCoords[2],T&&(C=Math.atan2(y,v)),O&&(E=Math.atan2(A,b))}if(h=t.evalVisProp(r+"strokewidth"),T)if(c=h*n.sizeFirst,p=S=n.typeFirst,2===S)d=[[c,.5*-c],[0,0],[c,.5*c],[.5*c,0]];else if(3===S)d=[[c/3,.5*-c],[0,.5*-c],[0,.5*c],[c/3,.5*c]];else if(4===S)for(c/=10,w=3,_=(d=[[10,3.31],[6.47,3.84],[2.87,4.5],[0,6.63],[.67,5.52],[1.33,4.42],[2,3.31],[1.33,2.21],[.67,1.1],[0,0],[2.87,2.13],[6.47,2.79],[10,3.31]]).length,g=0;g<_;g++)d[g][0]*=-c,d[g][1]*=c,d[g][0]+=10*c,d[g][1]-=3.31*c;else if(5===S)for(c/=10,w=3,_=(d=[[10,3.28],[6.61,4.19],[3.19,5.07],[0,6.55],[.62,5.56],[1,4.44],[1,3.28],[1,2.11],[.62,.99],[0,0],[3.19,1.49],[6.61,2.37],[10,3.28]]).length,g=0;g<_;g++)d[g][0]*=-c,d[g][1]*=c,d[g][0]+=10*c,d[g][1]-=3.28*c;else if(6===S)for(c/=10,w=3,_=(d=[[10,2.84],[6.61,3.59],[3.21,4.35],[0,5.68],[.33,4.73],[.67,3.78],[1,2.84],[.67,1.89],[.33,.95],[0,0],[3.21,1.33],[6.61,2.09],[10,2.84]]).length,g=0;g<_;g++)d[g][0]*=-c,d[g][1]*=c,d[g][0]+=10*c,d[g][1]-=2.84*c;else if(7===S)for(c=h,w=3,_=(d=[[0,10.39],[2.01,6.92],[5.96,5.2],[10,5.2],[5.96,5.2],[2.01,3.47],[0,0]]).length,g=0;g<_;g++)d[g][0]*=-c,d[g][1]*=c,d[g][0]+=10*c,d[g][1]-=5.2*c;else d=[[c,.5*-c],[0,0],[c,.5*c]];if(O)if(c=h*n.sizeLast,f=S=n.typeLast,2===S)u=[[-c,.5*-c],[0,0],[-c,.5*c],[.5*-c,0]];else if(3===S)u=[[-c/3,.5*-c],[0,.5*-c],[0,.5*c],[-c/3,.5*c]];else if(4===S)for(c/=10,P=3,_=(u=[[10,3.31],[6.47,3.84],[2.87,4.5],[0,6.63],[.67,5.52],[1.33,4.42],[2,3.31],[1.33,2.21],[.67,1.1],[0,0],[2.87,2.13],[6.47,2.79],[10,3.31]]).length,g=0;g<_;g++)u[g][0]*=c,u[g][1]*=c,u[g][0]-=10*c,u[g][1]-=3.31*c;else if(5===S)for(c/=10,P=3,_=(u=[[10,3.28],[6.61,4.19],[3.19,5.07],[0,6.55],[.62,5.56],[1,4.44],[1,3.28],[1,2.11],[.62,.99],[0,0],[3.19,1.49],[6.61,2.37],[10,3.28]]).length,g=0;g<_;g++)u[g][0]*=c,u[g][1]*=c,u[g][0]-=10*c,u[g][1]-=3.28*c;else if(6===S)for(c/=10,P=3,_=(u=[[10,2.84],[6.61,3.59],[3.21,4.35],[0,5.68],[.33,4.73],[.67,3.78],[1,2.84],[.67,1.89],[.33,.95],[0,0],[3.21,1.33],[6.61,2.09],[10,2.84]]).length,g=0;g<_;g++)u[g][0]*=c,u[g][1]*=c,u[g][0]-=10*c,u[g][1]-=2.84*c;else if(7===S)for(c=h,P=3,_=(u=[[0,10.39],[2.01,6.92],[5.96,5.2],[10,5.2],[5.96,5.2],[2.01,3.47],[0,0]]).length,g=0;g<_;g++)u[g][0]*=c,u[g][1]*=c,u[g][0]-=10*c,u[g][1]-=5.2*c;else u=[[-c,.5*-c],[0,0],[-c,.5*c]];M.save(),this._setColor(t,"stroke","fill")&&(this._setColor(t,"stroke"),T&&(m=7!==p,this._drawPolygon(this._translateShape(this._rotateShape(d,C),s,o),w,m)),O&&(m=7!==f,this._drawPolygon(this._translateShape(this._rotateShape(u,E),a,l),P,m))),M.restore()}},drawLine:function(t){var e,i,r,n,s,o=new base_coords.A(constants.A.COORDS_BY_USER,t.point1.coords.usrCoords,t.board),a=new base_coords.A(constants.A.COORDS_BY_USER,t.point2.coords.usrCoords,t.board),l=null;t.visPropCalc.visible&&(r=this._getHighlighted(t),n=t.evalVisProp(r+"strokewidth"),((s=this.getArrowHeadData(t,n,r)).evFirst||s.evLast)&&(l=-4),geometry.A.calcStraight(t,o,a,l),this.handleTouchpoints(t,o,a,s),e=new base_coords.A(constants.A.COORDS_BY_USER,o.usrCoords,t.board),i=new base_coords.A(constants.A.COORDS_BY_USER,a.usrCoords,t.board),this.getPositionArrowHead(t,o,a,s),this.context.beginPath(),this.context.moveTo(o.scrCoords[1],o.scrCoords[2]),this.context.lineTo(a.scrCoords[1],a.scrCoords[2]),this._stroke(t),(s.evFirst||s.evLast)&&this.drawArrows(t,e,i,r,s))},updateLine:function(t){this.drawLine(t)},drawTicks:function(){},updateTicks:function(t){var e,i,r,n,s,o,a=t.ticks.length,l=this.context;for(l.beginPath(),e=0;e<a;e++)for(r=(i=t.ticks[e])[0],n=i[1],s=r.length,l.moveTo(r[0],n[0]),o=1;o<s;++o)l.lineTo(r[o],n[o]);l.lineCap="round",this._stroke(t)},drawCurve:function(t){var e,i,r;t.evalVisProp("handdrawing")?this.updatePathStringBezierPrim(t):this.updatePathStringPrim(t),t.numberPoints>1&&(e=this._getHighlighted(t),i=t.evalVisProp(e+"strokewidth"),((r=this.getArrowHeadData(t,i,e)).evFirst||r.evLast)&&this.drawArrows(t,null,null,e,r))},updateCurve:function(t){this.drawCurve(t)},drawEllipse:function(t){var e=t.center.coords.scrCoords[1],i=t.center.coords.scrCoords[2],r=t.board.unitX,n=t.board.unitY,s=2*t.Radius(),o=2*t.Radius(),a=s*r,l=o*n,c=e-a/2,h=i-l/2,u=a/2*.5522848,d=l/2*.5522848,p=c+a,f=h+l,m=c+a/2,g=h+l/2,_=this.context;s>0&&o>0&&!isNaN(e+i)&&(_.beginPath(),_.moveTo(c,g),_.bezierCurveTo(c,g-d,m-u,h,m,h),_.bezierCurveTo(m+u,h,p,g-d,p,g),_.bezierCurveTo(p,g+d,m+u,f,m,f),_.bezierCurveTo(m-u,f,c,g+d,c,g),_.closePath(),this._fill(t),this._stroke(t))},updateEllipse:function(t){return this.drawEllipse(t)},displayCopyright:function(t,e){var i=this.context;i.save(),i.font=e+"px Arial",i.fillStyle="#aaa",i.lineWidth=.5,i.fillText(t,10,2+e),i.restore()},drawInternalText:function(t){var e=t.evalVisProp("fontsize"),i=t.evalVisProp("fontunit"),r=t.getAnchorX(),n=t.getAnchorY(),s=this.context;return s.save(),this._setColor(t,"stroke","fill")&&!isNaN(t.coords.scrCoords[1]+t.coords.scrCoords[2])&&(s.font=(e>0?e:0)+i+" Arial",this.transformRect(t,t.transformations),"left"===r?s.textAlign="left":"right"===r?s.textAlign="right":"middle"===r&&(s.textAlign="center"),"bottom"===n?s.textBaseline="bottom":"top"===n?s.textBaseline="top":"middle"===n&&(s.textBaseline="middle"),s.fillText(t.plaintext,t.coords.scrCoords[1],t.coords.scrCoords[2])),s.restore(),null},updateInternalText:function(t){this.drawInternalText(t)},setObjectStrokeColor:function(t,e,i){var r,n,s,o,a=e,l=i;l=l>0?l:0,t.visPropOld.strokecolor===a&&t.visPropOld.strokeopacity===l||(utils_type.A.exists(a)&&!1!==a&&(9!==a.length?(r=a,s=l):(r=(n=utils_color.A.rgba2rgbo(a))[0],s=l*n[1]),o=t.rendNode,t.elementClass===constants.A.OBJECT_CLASS_TEXT&&"html"===t.evalVisProp("display")&&(o.style.color=r,o.style.opacity=s)),t.visPropOld.strokecolor=a,t.visPropOld.strokeopacity=l)},drawImage:function(t){t.rendNode=new Image,t._src="",this.updateImage(t)},updateImage:function(t){var e=this.context,i=t.evalVisProp("fillopacity"),r=utils_type.A.bind((function(){t.imgIsLoaded=!0,t.size[0]<=0||t.size[1]<=0||(e.save(),e.globalAlpha=i,this.transformRect(t,t.transformations),e.drawImage(t.rendNode,t.coords.scrCoords[1],t.coords.scrCoords[2]-t.size[1],t.size[0],t.size[1]),e.restore())}),this);this.updateImageURL(t)?t.rendNode.onload=r:t.imgIsLoaded&&r()},transformRect:function(t,e){var i,r,n,s,o,a=e.length,l=this.context;if(a>0)if(i=this.joinTransforms(t,e),t.elementClass===constants.A.OBJECT_CLASS_TEXT&&"html"===t.visProp.display){if(-1===(r=" matrix("+[i[1][1],i[2][1],i[1][2],i[2][2],i[1][0],i[2][0]].join(",")+") ").indexOf("NaN")){switch((o=t.rendNode).style.transform=r,n=-t.coords.scrCoords[1],s=-t.coords.scrCoords[2],t.evalVisProp("anchorx")){case"right":n+=t.size[0];break;case"middle":n+=.5*t.size[0]}switch(t.evalVisProp("anchory")){case"bottom":s+=t.size[1];break;case"middle":s+=.5*t.size[1]}o.style["transform-origin"]=n+"px "+s+"px"}}else Math.abs(numerics.A.det(i))>=math.A.eps&&l.transform(i[1][1],i[2][1],i[1][2],i[2][2],i[1][0],i[2][0])},updateImageURL:function(t){var e;return e=t.eval(t.url),t._src!==e&&(t.imgIsLoaded=!1,t.rendNode.src=e,t._src=e,!0)},remove:function(t){utils_type.A.exists(t)&&utils_type.A.exists(t.parentNode)&&t.parentNode.removeChild(t)},updatePathStringPrim:function(t){var e,i,r,n,s,o="M",a=o,l=5e3,c=this.context;if(!(t.numberPoints<=0)){if(s=Math.min(t.points.length,t.numberPoints),c.beginPath(),1===t.bezierDegree)for(e=0;e<s;e++)i=t.points[e].scrCoords,isNaN(i[1])||isNaN(i[2])?a=o:(i[1]>l?i[1]=l:i[1]<-5e3&&(i[1]=-5e3),i[2]>l?i[2]=l:i[2]<-5e3&&(i[2]=-5e3),a===o?c.moveTo(i[1],i[2]):c.lineTo(i[1],i[2]),a="L");else if(3===t.bezierDegree)for(e=0;e<s;)i=t.points[e].scrCoords,isNaN(i[1])||isNaN(i[2])?a=o:(a===o?c.moveTo(i[1],i[2]):(e+=1,r=t.points[e].scrCoords,e+=1,n=t.points[e].scrCoords,c.bezierCurveTo(i[1],i[2],r[1],r[2],n[1],n[2])),a="C"),e+=1;c.lineCap="round",c.lineJoin="round",this._fill(t),this._stroke(t)}},updatePathStringBezierPrim:function(t){var e,i,r,n,s,o,a,l="M",c=l,h=5e3,u=t.evalVisProp("strokewidth"),d="plot"!==t.evalVisProp("curvetype"),p=this.context;if(!(t.numberPoints<=0)){for(d&&t.board.options.curve.RDPsmoothing&&(t.points=numerics.A.RamerDouglasPeucker(t.points,.5)),a=Math.min(t.points.length,t.numberPoints),p.beginPath(),i=1;i<3;i++)for(c=l,e=0;e<a;e++)n=t.points[e].scrCoords,isNaN(n[1])||isNaN(n[2])?c=l:(n[1]>h?n[1]=h:n[1]<-5e3&&(n[1]=-5e3),n[2]>h?n[2]=h:n[2]<-5e3&&(n[2]=-5e3),c===l?p.moveTo(n[1],n[2]):(r=2*i,p.bezierCurveTo(s+.333*(n[1]-s)+u*(r*Math.random()-i),o+.333*(n[2]-o)+u*(r*Math.random()-i),s+.666*(n[1]-s)+u*(r*Math.random()-i),o+.666*(n[2]-o)+u*(r*Math.random()-i),n[1],n[2])),c="C",s=n[1],o=n[2]);p.lineCap="round",p.lineJoin="round",this._fill(t),this._stroke(t)}},updatePolygonPrim:function(t,e){var i,r,n,s=e.vertices.length,o=this.context,a=!0;if(!(s<=0)&&e.visPropCalc.visible){for("polygonalchain"===e.elType&&s++,o.beginPath(),r=0;!e.vertices[r].isReal&&r<s-1;)r++,a=!1;for(i=e.vertices[r].coords.scrCoords,o.moveTo(i[1],i[2]),n=r;n<s-1;n++)e.vertices[n].isReal||(a=!1),i=e.vertices[n].coords.scrCoords,o.lineTo(i[1],i[2]);o.closePath(),a&&this._fill(e)}},display:function(t,e){t&&t.rendNode&&(t.visPropOld.visible=e,t.rendNode.style.visibility=e?"inherit":"hidden")},show:function(t){jxg.A.deprecated("Board.renderer.show()","Board.renderer.display()"),utils_type.A.exists(t.rendNode)&&(t.rendNode.style.visibility="inherit")},hide:function(t){jxg.A.deprecated("Board.renderer.hide()","Board.renderer.display()"),utils_type.A.exists(t.rendNode)&&(t.rendNode.style.visibility="hidden")},setGradient:function(t){},setShadow:function(t){t.visPropOld.shadow!==t.visProp.shadow&&(t.visPropOld.shadow=t.visProp.shadow)},highlight:function(t){return t.elementClass===constants.A.OBJECT_CLASS_TEXT&&"html"===t.evalVisProp("display")?this.updateTextStyle(t,!0):(t.board.prepareUpdate(),t.board.renderer.suspendRedraw(t.board),t.board.updateRenderer(),t.board.renderer.unsuspendRedraw()),this},noHighlight:function(t){return t.elementClass===constants.A.OBJECT_CLASS_TEXT&&"html"===t.evalVisProp("display")?this.updateTextStyle(t,!1):(t.board.prepareUpdate(),t.board.renderer.suspendRedraw(t.board),t.board.updateRenderer(),t.board.renderer.unsuspendRedraw()),this},suspendRedraw:function(t){this.context.save(),this.context.clearRect(0,0,this.canvasRoot.width,this.canvasRoot.height),t&&t.attr.showcopyright&&this.displayCopyright(jxg.A.licenseText,12)},unsuspendRedraw:function(){this.context.restore()},resize:function(t,e){this.container?(this.canvasRoot.style.width=parseFloat(t)+"px",this.canvasRoot.style.height=parseFloat(e)+"px",this.canvasRoot.setAttribute("width",2*parseFloat(t)+"px"),this.canvasRoot.setAttribute("height",2*parseFloat(e)+"px")):(this.canvasRoot.width=2*parseFloat(t),this.canvasRoot.height=2*parseFloat(e)),this.context=this.canvasRoot.getContext("2d"),this.context.scale(2,2)},removeToInsertLater:function(){return function(){}}});const canvas=jxg.A.CanvasRenderer;jxg.A.NoRenderer=function(){this.enhancedRendering=!1,this.type="no"},jxg.A.extend(jxg.A.NoRenderer.prototype,{drawPoint:function(t){},updatePoint:function(t){},changePointStyle:function(t){},drawLine:function(t){},updateLine:function(t){},drawTicks:function(t){},updateTicks:function(t){},drawCurve:function(t){},updateCurve:function(t){},drawEllipse:function(t){},updateEllipse:function(t){},drawPolygon:function(t){},updatePolygon:function(t){},displayCopyright:function(t,e){},drawInternalText:function(t){},updateInternalText:function(t){},drawText:function(t){},updateText:function(t){},updateTextStyle:function(t,e){},updateInternalTextStyle:function(t,e,i){},drawImage:function(t){},updateImage:function(t){},updateImageURL:function(t){},appendChildPrim:function(t,e){},appendNodesToElement:function(t,e){},remove:function(t){},makeArrows:function(t){},updateEllipsePrim:function(t,e,i,r,n){},updateLinePrim:function(t,e,i,r,n,s){},updatePathPrim:function(t,e,i){},updatePathStringPoint:function(t,e,i){},updatePathStringPrim:function(t){},updatePathStringBezierPrim:function(t){},updatePolygonPrim:function(t,e){},updateRectPrim:function(t,e,i,r,n){},setPropertyPrim:function(t,e,i){},show:function(t){},hide:function(t){},setBuffering:function(t,e){},setDashStyle:function(t){},setDraft:function(t){},removeDraft:function(t){},setGradient:function(t){},updateGradient:function(t){},setObjectTransition:function(t,e){},setObjectFillColor:function(t,e,i){},setObjectStrokeColor:function(t,e,i){},setObjectStrokeWidth:function(t,e){},setShadow:function(t){},highlight:function(t){},noHighlight:function(t){},suspendRedraw:function(){},unsuspendRedraw:function(){},drawNavigationBar:function(t){},getElementById:function(t){return null},resize:function(t,e){},removeToInsertLater:function(){return function(){}}}),jxg.A.NoRenderer.prototype=new renderer_abstract;const no=jxg.A.NoRenderer;jxg.A.JSXGraph={rendererType:(src_options.A.board.renderer="no",env.A.supportsVML()&&(src_options.A.board.renderer="vml",document.onmousemove=function(){var t;return document.body&&(t=document.body.scrollLeft,t+=document.body.scrollTop),t}),env.A.supportsCanvas()&&(src_options.A.board.renderer="canvas"),env.A.supportsSVG()&&(src_options.A.board.renderer="svg"),env.A.isNode()&&env.A.supportsCanvas()&&(src_options.A.board.renderer="canvas"),(env.A.isNode()||"no"===src_options.A.renderer)&&(src_options.A.text.display="internal",src_options.A.infobox.display="internal"),src_options.A.board.renderer),initRenderer:function(t,e,i,r){var n;if(utils_type.A.exists(i)&&!1!==i||"object"!=typeof document||(i=document),"object"==typeof i&&null!==t)for(n=utils_type.A.isString(t)?i.getElementById(t):t;n.firstChild;)n.removeChild(n.firstChild);else n=t;return void 0!==r&&"auto"!==r||(r=this.rendererType),"svg"===r?new svg(n,e):"vml"===r?new vml(n):"canvas"===r?new canvas(n,e):new no},_setAttributes:function(t,e){var i,r,n=utils_type.A.copyAttributes(t,e,"board"),s=["drag","fullscreen","intl","keyboard","logging","pan","resize","screenshot","selection","zoom"],o=s.length;for(i=0;i<o;i++)n[r=s[i]]=utils_type.A.copyAttributes(n,e,"board",r);return n.navbar=utils_type.A.copyAttributes(n.navbar,e,"navbar"),n.movetarget=t.moveTarget||t.movetarget||e.board.moveTarget,n},_fillBoard:function(t,e,i){t.initInfobox(e.infobox),t.maxboundingbox=e.maxboundingbox,t.resizeContainer(i.width,i.height,!0,!0),t._createSelectionPolygon(e),t.renderer.drawNavigationBar(t,e.navbar),jxg.A.boards[t.id]=t},_setARIA:function(t,e){var i,r=e.document;if("object"!=typeof r){if(!env.A.isBrowser)return;r=document}(i=utils_type.A.isString(t)?r.getElementById(t):t).setAttribute("role","region"),i.setAttribute("aria-label",e.title)},_removeARIANodes:function(t){var e,i,r;"object"==typeof(r=t.document||document)&&(i=t.containerObj.getAttribute("aria-labelledby"),(e=r.getElementById(i))&&e.parentNode&&e.parentNode.removeChild(e),i=t.containerObj.getAttribute("aria-describedby"),(e=r.getElementById(i))&&e.parentNode&&e.parentNode.removeChild(e))},initBoard:function(t,e){var i,r,n,s,o,a,l,c,h,u,d,p,f,m,g,_=0,v=0,y={};return"default"!==(e=e||{}).theme&&utils_type.A.exists(jxg.A.themes[e.theme])&&(y=jxg.A.themes[e.theme]),m=utils_type.A.deepCopy(src_options.A,y,!0),u=this._setAttributes(e,m),c=env.A.getDimensions(t,u.document),u.unitx||u.unity?(i=utils_type.A.def(u.originx,150),r=utils_type.A.def(u.originy,150),n=utils_type.A.def(u.unitx,50),s=utils_type.A.def(u.unity,50)):((h=u.boundingbox)[0]<u.maxboundingbox[0]&&(h[0]=u.maxboundingbox[0]),h[1]>u.maxboundingbox[1]&&(h[1]=u.maxboundingbox[1]),h[2]>u.maxboundingbox[2]&&(h[2]=u.maxboundingbox[2]),h[3]<u.maxboundingbox[3]&&(h[3]=u.maxboundingbox[3]),o=parseInt(c.width,10),a=parseInt(c.height,10),utils_type.A.exists(h)&&u.keepaspectratio?(n=o/(h[2]-h[0]),s=a/(h[1]-h[3]),Math.abs(n)<Math.abs(s)?v=.5*(a/(s=Math.abs(n)*s/Math.abs(s))-(h[1]-h[3])):_=.5*(o/(n=Math.abs(s)*n/Math.abs(n))-(h[2]-h[0]))):(n=o/(h[2]-h[0]),s=a/(h[1]-h[3])),i=-n*(h[0]-_),r=s*(h[1]+v)),l=this.initRenderer(t,c,u.document,u.renderer),this._setARIA(t,u),(g=new base_board(t,l,u.id,[i,r],u.zoomx,u.zoomy,n,s,c.width,c.height,u)).keepaspectratio=u.keepaspectratio,this._fillBoard(g,u,c),g.suspendUpdate(),(u=g.attr).axis&&(d="object"==typeof u.axis?u.axis:{},p=utils_type.A.deepCopy(m.board.defaultaxes.x,d),f=utils_type.A.deepCopy(m.board.defaultaxes.y,d),u.defaultaxes.x&&(p=utils_type.A.deepCopy(p,u.defaultaxes.x)),u.defaultaxes.y&&(f=utils_type.A.deepCopy(f,u.defaultaxes.y)),g.defaultAxes={},g.defaultAxes.x=g.create("axis",[[0,0],[1,0]],p),g.defaultAxes.y=g.create("axis",[[0,0],[0,1]],f)),u.grid&&g.create("grid",[],"object"==typeof u.grid?u.grid:{}),g.unsuspendUpdate(),g},loadBoardFromFile:function(t,e,i,r,n){var s,o,a,l,c;return r=r||{},s=this._setAttributes(r),l=env.A.getDimensions(t,s.document),o=this.initRenderer(t,l,s.document,s.renderer),this._setARIA(t,s),a=new base_board(t,o,"",[150,150],1,1,50,50,l.width,l.height,s),this._fillBoard(a,s,l),c=s.encoding||"iso-8859-1",reader_file.parseFileContent(e,a,i,!0,c,n),a},loadBoardFromString:function(t,e,i,r,n){var s,o,a,l;return r=r||{},s=this._setAttributes(r),l=env.A.getDimensions(t,s.document),o=this.initRenderer(t,l,s.document,s.renderer),this._setARIA(t,s),a=new base_board(t,o,"",[150,150],1,1,50,50,l.width,l.height,s),this._fillBoard(a,s,l),reader_file.parseString(e,a,i,!0,n),a},freeBoard:function(t){var e;for(e in"string"==typeof t&&(t=jxg.A.boards[t]),this._removeARIANodes(t),t.removeEventHandlers(),t.suspendUpdate(),t.objects)t.objects.hasOwnProperty(e)&&t.objects[e].remove();for(;t.containerObj.firstChild;)t.containerObj.removeChild(t.containerObj.firstChild);for(e in t.objects)t.objects.hasOwnProperty(e)&&delete t.objects[e];delete t.renderer,t.jc.creator.clearCache(),delete t.jc,delete jxg.A.boards[t.id]},registerElement:function(t,e){jxg.A.deprecated("JXG.JSXGraph.registerElement()","JXG.registerElement()"),jxg.A.registerElement(t,e)}},env.A.isBrowser&&"object"==typeof window&&"object"==typeof document&&env.A.addEvent(window,"load",(function(){var t,e,i,r,n,s,o,a,l,c,h,u,d,p,f,m,g,_,v=!1,y=document.getElementsByTagName("script"),b=function(t,e,i){var r=jxg.A.JSXGraph.initBoard(n,{boundingbox:i,keepaspectratio:!0,grid:f,axis:p,showReload:!0});if(e.toLowerCase().indexOf("script")>-1)r.construct(t);else try{r.jc.parse(t)}catch(t){jxg.A.debug(t)}return r},A=function(t,e,i,r){return function(){var n;jxg.A.JSXGraph.freeBoard(t),(n=b(e,i,r)).reload=A(n,e,i,r)}};for(e=0;e<y.length;e++)if(t=y[e].getAttribute("type",!1),utils_type.A.exists(t)&&("text/jessiescript"===t.toLowerCase()||"jessiescript"===t.toLowerCase()||"text/jessiecode"===t.toLowerCase()||"jessiecode"===t.toLowerCase())){if(u=y[e].getAttribute("class",!1)||"",a=y[e].getAttribute("width",!1)||"",l=y[e].getAttribute("height",!1)||"",c=y[e].getAttribute("maxwidth",!1)||"100%",h=y[e].getAttribute("aspectratio",!1)||"1/1",d=y[e].getAttribute("boundingbox",!1)||"-5, 5, 5, -5",n=y[e].getAttribute("container",!1),g=y[e].getAttribute("src",!1),4!==(d=d.split(",")).length)d=[-5,5,5,-5];else for(i=0;i<d.length;i++)d[i]=parseFloat(d[i]);if(p=utils_type.A.str2Bool(y[e].getAttribute("axis",!1)||"false"),f=utils_type.A.str2Bool(y[e].getAttribute("grid",!1)||"false"),utils_type.A.exists(n))r=document.getElementById(n);else{n="jessiescript_autgen_jxg_"+e,(r=document.createElement("div")).setAttribute("id",n),o=""!==a?"width:"+a+";":"",o+=""!==l?"height:"+l+";":"",o+=""!==c?"max-width:"+c+";":"",o+=""!==h?"aspect-ratio:"+h+";":"",r.setAttribute("style",o),r.setAttribute("class","jxgbox "+u);try{document.body.insertBefore(r,y[e])}catch(t){"object"==typeof jQuery&&jQuery(r).insertBefore(y[e])}}m="",utils_type.A.exists(g)?(v=!0,(_=new XMLHttpRequest).open("GET",g),_.overrideMimeType("text/plain; charset=x-user-defined"),_.addEventListener("load",(function(){if(!(this.status<400))throw new Error("\nJSXGraph: failed to load file",g,":",this.responseText);m=this.responseText+"\n"+m,(s=b(m,t,d)).reload=A(s,m,t,d)})),_.addEventListener("error",(function(t){throw new Error("\nJSXGraph: failed to load file",g,":",t)})),_.send()):v=!1,document.getElementById(n)?(m=(m=y[e].innerHTML).replace(/<!\[CDATA\[/g,"").replace(/\]\]>/g,""),y[e].innerHTML=m,v||((s=b(m,t,d)).reload=A(s,m,t,d))):jxg.A.debug("JSXGraph: Apparently the div injection failed. Can't create a board, sorry.")}}),window);const jsxgraph=jxg.A.JSXGraph;var base_element=__webpack_require__(345),coordselement=__webpack_require__(999);jxg.A.Point=function(t,e,i){this.constructor(t,i,constants.A.OBJECT_TYPE_POINT,constants.A.OBJECT_CLASS_POINT),this.element=this.board.select(i.anchor),this.coordsConstructor(e),this.elType="point",this.id=this.board.setId(this,"P"),this.board.renderer.drawPoint(this),this.board.finalizeAdding(this),this.createGradient(),this.createLabel()},jxg.A.Point.prototype=new base_element.A,utils_type.A.copyPrototypeMethods(jxg.A.Point,coordselement.A,"coordsConstructor"),jxg.A.extend(jxg.A.Point.prototype,{hasPoint:function(t,e){var i,r,n,s=this.coords.scrCoords,o=this.evalVisProp("sizeunit");return utils_type.A.isObject(this.evalVisProp("precision"))?(n=this.board._inputDevice,r=this.evalVisProp("precision."+n)):r=this.board.options.precision.hasPoint,i=parseFloat(this.evalVisProp("size")),"user"===o&&(i*=Math.sqrt(Math.abs(this.board.unitX*this.board.unitY))),(i+=.5*parseFloat(this.evalVisProp("strokewidth")))<r&&(i=r),Math.abs(s[1]-t)<i+2&&Math.abs(s[2]-e)<i+2},update:function(t){return this.needsUpdate?(this.updateCoords(t),this.evalVisProp("trace")&&this.cloneToBackground(!0),this):this},updateTransform:function(t){var e,i;if(0===this.transformations.length||null===this.baseElement)return this;for(this.transformations[0].update(),e=this===this.baseElement?this.transformations[0].apply(this,"self"):this.transformations[0].apply(this.baseElement),i=1;i<this.transformations.length;i++)this.transformations[i].update(),e=math.A.matVecMult(this.transformations[i].matrix,e);return this.coords.setCoordinates(constants.A.COORDS_BY_USER,e),this},updateRenderer:function(){return this.updateRendererGeneric("updatePoint"),this},bounds:function(){return this.coords.usrCoords.slice(1).concat(this.coords.usrCoords.slice(1))},makeIntersection:function(t,e,i,r){var n;t=this.board.select(t),e=this.board.select(e),n=geometry.A.intersectionFunction(this.board,t,e,i,r,this.visProp.alwaysintersect),this.addConstraint([n]);try{t.addChild(this),e.addChild(this)}catch(i){throw new Error("JSXGraph: Can't create 'intersection' with parent types '"+typeof t+"' and '"+typeof e+"'.")}this.type=constants.A.OBJECT_TYPE_INTERSECTION,this.elType="intersection",this.parents=[t.id,e.id,i,r],this.generatePolynomial=function(){var i=t.generatePolynomial(this),r=e.generatePolynomial(this);return 0===i.length||0===r.length?[]:[i[0],r[0]]},this.prepareUpdate().update()},setStyle:function(t){return this.visProp.face=["cross","cross","cross","circle","circle","circle","circle","square","square","square","plus","plus","plus"][t],this.visProp.size=[2,3,4,1,2,3,4,2,3,4,2,3,4][t],this.board.renderer.changePointStyle(this),this},normalizeFace:function(t){return jxg.A.deprecated("Point.normalizeFace()","JXG.normalizePointFace()"),src_options.A.normalizePointFace(t)},face:function(t){jxg.A.deprecated("Point.face()","Point.setAttribute()"),this.setAttribute({face:t})},size:function(t){jxg.A.deprecated("Point.size()","Point.setAttribute()"),this.setAttribute({size:t})},isOn:function(t,e){var i,r;return e=e||math.A.eps,utils_type.A.isPoint(t)?this.Dist(t)<e:t.elementClass===constants.A.OBJECT_CLASS_LINE?("segment"!==t.elType||this.evalVisProp("alwaysintersect")||(i=jxg.A.Math.Geometry.projectCoordsToSegment(this.coords.usrCoords,t.point1.coords.usrCoords,t.point2.coords.usrCoords))[1]>=0&&i[1]<=1)&&geometry.A.distPointLine(this.coords.usrCoords,t.stdform)<e:t.elementClass===constants.A.OBJECT_CLASS_CIRCLE?t.evalVisProp("hasinnerpoints")?this.Dist(t.center)<t.Radius()+e:Math.abs(this.Dist(t.center)-t.Radius())<e:t.elementClass===constants.A.OBJECT_CLASS_CURVE?(r=geometry.A.projectPointToCurve(this,t,this.board)[0],geometry.A.distance(this.coords.usrCoords,r.usrCoords,3)<e):t.type===constants.A.OBJECT_TYPE_POLYGON?!(!t.evalVisProp("hasinnerpoints")||!t.pnpoly(this.coords.usrCoords[1],this.coords.usrCoords[2],jxg.A.COORDS_BY_USER))||(i=geometry.A.projectCoordsToPolygon(this.coords.usrCoords,t),geometry.A.distance(this.coords.usrCoords,i,3)<e):t.type===constants.A.OBJECT_TYPE_TURTLE&&(r=geometry.A.projectPointToTurtle(this,t,this.board),geometry.A.distance(this.coords.usrCoords,r.usrCoords,3)<e)},cloneToBackground:function(){var t=utils_type.A.getCloneObject(this);return this.board.renderer.drawPoint(t),this.traces[t.id]=t.rendNode,this}}),jxg.A.createPoint=function(t,e,i){var r,n;if(n=utils_type.A.copyAttributes(i,t.options,"point"),!(r=coordselement.A.create(jxg.A.Point,t,e,n)))throw new Error("JSXGraph: Can't create point with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [x,y], [z,x,y], [element,transformation]");return r},jxg.A.createGlider=function(t,e,i){var r,n,s=utils_type.A.copyAttributes(i,t.options,"glider");return n=1===e.length?[0,0]:e.slice(0,2),(r=t.create("point",n,s)).makeGlider(e[e.length-1]),r},jxg.A.createIntersectionPoint=function(t,e,i){var r,n,s,o,a,l,c=utils_type.A.copyAttributes(i,t.options,"intersection");e.push(0,0),n=t.select(e[0]),s=t.select(e[1]),a=e[2]||0,l=e[3]||0,r=t.create("point",[0,0,0],c),o=geometry.A.intersectionFunction(t,n,s,a,l,r.visProp.alwaysintersect),r.addConstraint([o]);try{n.addChild(r),s.addChild(r)}catch(t){throw new Error("JSXGraph: Can't create 'intersection' with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.")}return r.type=constants.A.OBJECT_TYPE_INTERSECTION,r.elType="intersection",r.setParents([n.id,s.id]),r.intersectionNumbers=[a,l],r.getParents=function(){return this.parents.concat(this.intersectionNumbers)},r.generatePolynomial=function(){var t=n.generatePolynomial(r),e=s.generatePolynomial(r);return 0===t.length||0===e.length?[]:[t[0],e[0]]},r},jxg.A.createOtherIntersectionPoint=function(t,e,i){var r,n,s,o,a,l,c,h=!0,u=utils_type.A.copyAttributes(i,t.options,"otherintersection");if(3!==e.length)h=!1;else{for(n=t.select(e[0]),s=t.select(e[1]),a=utils_type.A.isArray(e[2])?e[2]:[e[2]],o=0;o<a.length;o++)if(a[o]=t.select(a[o]),!utils_type.A.isPoint(a[o])){h=!1;break}h&&((c=[n,s]).sort((function(t,e){return e.elementClass-t.elementClass})),([constants.A.OBJECT_CLASS_CIRCLE,constants.A.OBJECT_CLASS_CURVE].indexOf(c[0].elementClass)<0||[constants.A.OBJECT_CLASS_CIRCLE,constants.A.OBJECT_CLASS_CURVE,constants.A.OBJECT_CLASS_LINE].indexOf(c[1].elementClass)<0)&&(h=!1))}if(!h)throw new Error("JSXGraph: Can't create 'other intersection point' with parent types '"+typeof e[0]+"',  '"+typeof e[1]+"'and  '"+typeof e[2]+"'.\nPossible parent types: [circle|curve|line,circle|curve|line, point], not two lines");return r=t.create("point",[0,0,0],u),l=geometry.A.otherIntersectionFunction(c,a,r.visProp.alwaysintersect,r.visProp.precision),r.addConstraint([l]),r.type=constants.A.OBJECT_TYPE_INTERSECTION,r.elType="otherintersection",r.setParents([n.id,s.id]),r.addParents(a),n.addChild(r),s.addChild(r),n.elementClass===constants.A.OBJECT_CLASS_CIRCLE&&(r.generatePolynomial=function(){var t=n.generatePolynomial(r),e=s.generatePolynomial(r);return 0===t.length||0===e.length?[]:[t[0],e[0]]}),r},jxg.A.createPolePoint=function(t,e,i){var r,n,s,o,a,l,c;if(e.length>1&&(o=e[0].type===constants.A.OBJECT_TYPE_CONIC||e[0].elementClass===constants.A.OBJECT_CLASS_CIRCLE,a=e[1].type===constants.A.OBJECT_TYPE_CONIC||e[1].elementClass===constants.A.OBJECT_CLASS_CIRCLE,l=e[0].elementClass===constants.A.OBJECT_CLASS_LINE,c=e[1].elementClass===constants.A.OBJECT_CLASS_LINE),2!==e.length||!(o&&c||l&&a))throw new Error("JSXGraph: Can't create 'pole point' with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent type: [conic|circle,line], [line,conic|circle]");return c?(n=t.select(e[0]),s=t.select(e[1])):(n=t.select(e[1]),s=t.select(e[0])),(r=t.create("point",[function(){var t=n.quadraticform,e=s.stdform.slice(0,3);return[jxg.A.Math.Numerics.det([e,t[1],t[2]]),jxg.A.Math.Numerics.det([t[0],e,t[2]]),jxg.A.Math.Numerics.det([t[0],t[1],e])]}],i)).elType="polepoint",r.setParents([n.id,s.id]),n.addChild(r),s.addChild(r),r},jxg.A.registerElement("point",jxg.A.createPoint),jxg.A.registerElement("glider",jxg.A.createGlider),jxg.A.registerElement("intersection",jxg.A.createIntersectionPoint),jxg.A.registerElement("otherintersection",jxg.A.createOtherIntersectionPoint),jxg.A.registerElement("polepoint",jxg.A.createPolePoint);const point=jxg.A.Point;jxg.A.Line=function(t,e,i,r){this.constructor(t,r,constants.A.OBJECT_TYPE_LINE,constants.A.OBJECT_CLASS_LINE),this.point1=this.board.select(e),this.point2=this.board.select(i),this.ticks=[],this.defaultTicks=null,this.parentPolygon=null,this.id=this.board.setId(this,"L"),this.board.renderer.drawLine(this),this.board.finalizeAdding(this),this.elType="line",this.point1._is_new?(this.addChild(this.point1),delete this.point1._is_new):this.point1.addChild(this),this.point2._is_new?(this.addChild(this.point2),delete this.point2._is_new):this.point2.addChild(this),this.inherits.push(this.point1,this.point2),this.updateStdform(),this.createLabel(),this.methodMap=jxg.A.deepCopy(this.methodMap,{point1:"point1",point2:"point2",getSlope:"Slope",Slope:"Slope",Direction:"Direction",getRise:"getRise",Rise:"getRise",getYIntersect:"getRise",YIntersect:"getRise",getAngle:"getAngle",Angle:"getAngle",L:"L",length:"L",setFixedLength:"setFixedLength",setStraight:"setStraight"})},jxg.A.Line.prototype=new base_element.A,jxg.A.extend(jxg.A.Line.prototype,{hasPoint:function(t,e){var i,r,n,s,o,a,l,c,h,u=[],d=[1,t,e],p=this.evalVisProp("strokewidth");return utils_type.A.isObject(this.evalVisProp("precision"))?(h=this.board._inputDevice,c=this.evalVisProp("precision."+h)):c=this.board.options.precision.hasPoint,c+=.5*p,u[0]=this.stdform[0]-this.stdform[1]*this.board.origin.scrCoords[1]/this.board.unitX+this.stdform[2]*this.board.origin.scrCoords[2]/this.board.unitY,u[1]=this.stdform[1]/this.board.unitX,u[2]=this.stdform[2]/-this.board.unitY,i=geometry.A.distPointLine(d,u),!(isNaN(i)||i>c||(!this.evalVisProp("straightfirst")||!this.evalVisProp("straightlast"))&&(n=this.point1.coords,s=this.point2.coords,r=[0,u[1],u[2]],r=math.A.crossProduct(r,d),(r=math.A.crossProduct(r,u))[1]/=r[0],r[2]/=r[0],r[0]=1,r=new base_coords.A(constants.A.COORDS_BY_SCREEN,r.slice(1),this.board).usrCoords,o=n.distance(constants.A.COORDS_BY_USER,s),n=n.usrCoords.slice(0),s=s.usrCoords.slice(0),o<math.A.eps?a=0:(o===Number.POSITIVE_INFINITY&&(o=1/math.A.eps,Math.abs(s[0])<math.A.eps?(o/=geometry.A.distance([0,0,0],s),s=[1,n[1]+s[1]*o,n[2]+s[2]*o]):(o/=geometry.A.distance([0,0,0],n),n=[1,s[1]+n[1]*o,s[2]+n[2]*o])),o=s[l=1]-n[l],Math.abs(o)<math.A.eps&&(o=s[l=2]-n[l]),a=(r[l]-n[l])/o),!this.evalVisProp("straightfirst")&&a<0||!this.evalVisProp("straightlast")&&a>1))},update:function(){var t;return this.needsUpdate?(this.constrained&&(utils_type.A.isFunction(this.funps)?(t=this.funps())&&t.length&&2===t.length&&(this.point1=t[0],this.point2=t[1]):(utils_type.A.isFunction(this.funp1)&&(t=this.funp1(),utils_type.A.isPoint(t)?this.point1=t:t&&t.length&&2===t.length&&this.point1.setPositionDirectly(constants.A.COORDS_BY_USER,t)),utils_type.A.isFunction(this.funp2)&&(t=this.funp2(),utils_type.A.isPoint(t)?this.point2=t:t&&t.length&&2===t.length&&this.point2.setPositionDirectly(constants.A.COORDS_BY_USER,t)))),this.updateSegmentFixedLength(),this.updateStdform(),this.evalVisProp("trace")&&this.cloneToBackground(!0),this):this},updateSegmentFixedLength:function(){var t,e,i,r,n,s,o,a;return this.hasFixedLength?(t=this.point1.Dist(this.point2),e=this.evalVisProp("nonnegativeonly")?Math.max(0,this.fixedLength()):Math.abs(this.fixedLength()),i=this.fixedLengthOldCoords[0].distance(constants.A.COORDS_BY_USER,this.point1.coords),r=this.fixedLengthOldCoords[1].distance(constants.A.COORDS_BY_USER,this.point2.coords),(i>math.A.eps||r>math.A.eps||t!==e)&&(n=this.point1.isDraggable&&this.point1.type!==constants.A.OBJECT_TYPE_GLIDER&&!this.point1.evalVisProp("fixed"),s=this.point2.isDraggable&&this.point2.type!==constants.A.OBJECT_TYPE_GLIDER&&!this.point2.evalVisProp("fixed"),t>math.A.eps?i>r&&s||i<=r&&s&&!n?(this.point2.setPositionDirectly(constants.A.COORDS_BY_USER,[this.point1.X()+(this.point2.X()-this.point1.X())*e/t,this.point1.Y()+(this.point2.Y()-this.point1.Y())*e/t]),this.point2.fullUpdate()):(i<=r&&n||i>r&&n&&!s)&&(this.point1.setPositionDirectly(constants.A.COORDS_BY_USER,[this.point2.X()+(this.point1.X()-this.point2.X())*e/t,this.point2.Y()+(this.point1.Y()-this.point2.Y())*e/t]),this.point1.fullUpdate()):(o=Math.random()-.5,a=Math.random()-.5,t=math.A.hypot(o,a),s?(this.point2.setPositionDirectly(constants.A.COORDS_BY_USER,[this.point1.X()+o*e/t,this.point1.Y()+a*e/t]),this.point2.fullUpdate()):n&&(this.point1.setPositionDirectly(constants.A.COORDS_BY_USER,[this.point2.X()+o*e/t,this.point2.Y()+a*e/t]),this.point1.fullUpdate())),this.fixedLengthOldCoords[0].setCoordinates(constants.A.COORDS_BY_USER,this.point1.coords.usrCoords),this.fixedLengthOldCoords[1].setCoordinates(constants.A.COORDS_BY_USER,this.point2.coords.usrCoords)),this):this},updateStdform:function(){var t=math.A.crossProduct(this.point1.coords.usrCoords,this.point2.coords.usrCoords);this.stdform[0]=t[0],this.stdform[1]=t[1],this.stdform[2]=t[2],this.stdform[3]=0,this.normalize()},updateRenderer:function(){return this.needsUpdate?(this.visPropCalc.visible&&(this.isReal=!isNaN(this.point1.coords.usrCoords[1]+this.point1.coords.usrCoords[2]+this.point2.coords.usrCoords[1]+this.point2.coords.usrCoords[2])&&math.A.innerProduct(this.stdform,this.stdform,3)>=math.A.eps*math.A.eps,this.isReal||this.updateVisibility(!1)),this.visPropCalc.visible&&this.board.renderer.updateLine(this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this):this},generatePolynomial:function(t){var e=this.point1.symbolic.x,i=this.point1.symbolic.y,r=this.point2.symbolic.x,n=this.point2.symbolic.y,s=t.symbolic.x,o=t.symbolic.y;return[["(",i,")*(",s,")-(",i,")*(",r,")+(",o,")*(",r,")-(",e,")*(",o,")+(",e,")*(",n,")-(",s,")*(",n,")"].join("")]},getRise:function(){return Math.abs(this.stdform[2])>=math.A.eps?-this.stdform[0]/this.stdform[2]:1/0},Slope:function(){return Math.abs(this.stdform[2])>=math.A.eps?-this.stdform[1]/this.stdform[2]:1/0},getSlope:function(){return this.Slope()},getAngle:function(){return Math.atan2(-this.stdform[1],this.stdform[2])},Direction:function(){var t=this.point1.coords.usrCoords,e=this.point2.coords.usrCoords;return 0===e[0]&&0!==t[0]?e.slice(1):0===t[0]&&0!==e[0]?[-t[1],-t[2]]:[e[1]-t[1],e[2]-t[2]]},isVertical:function(){var t=this.Direction();return 0===t[0]&&0!==t[1]},isHorizontal:function(){var t=this.Direction();return 0===t[1]&&0!==t[0]},setStraight:function(t,e){return this.visProp.straightfirst=t,this.visProp.straightlast=e,this.board.renderer.updateLine(this),this},getTextAnchor:function(){return new base_coords.A(constants.A.COORDS_BY_USER,[.5*(this.point2.X()+this.point1.X()),.5*(this.point2.Y()+this.point1.Y())],this.board)},setLabelRelativeCoords:function(t){utils_type.A.exists(this.label)&&(this.label.relativeCoords=new base_coords.A(constants.A.COORDS_BY_SCREEN,[t[0],-t[1]],this.board))},getLabelAnchor:function(){var t,e,i,r,n,s,o,a,l=1.5,c=0,h=new base_coords.A(constants.A.COORDS_BY_USER,this.point1.coords.usrCoords,this.board),u=new base_coords.A(constants.A.COORDS_BY_USER,this.point2.coords.usrCoords,this.board),d=this.evalVisProp("straightfirst"),p=this.evalVisProp("straightlast");if((d||p)&&geometry.A.calcStraight(this,h,u,0),h=h.scrCoords,u=u.scrCoords,!utils_type.A.exists(this.label))return new base_coords.A(constants.A.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(i=this.label.evalVisProp("position"),!utils_type.A.isString(i))return new base_coords.A(constants.A.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(i.indexOf("right")<0&&i.indexOf("left")<0)switch(i){case"last":t=u[1],e=u[2];break;case"first":t=h[1],e=h[2];break;case"lft":case"llft":case"ulft":h[1]<u[1]+math.A.eps?(t=h[1],e=h[2]):(t=u[1],e=u[2]);break;case"rt":case"lrt":case"urt":h[1]>u[1]+math.A.eps?(t=h[1],e=h[2]):(t=u[1],e=u[2]);break;default:t=.5*(h[1]+u[1]),e=.5*(h[2]+u[2])}else r=utils_type.A.parsePosition(i),n=utils_type.A.parseNumber(r.pos,1,1),s=u[1]-h[1],o=u[2]-h[2],a=math.A.hypot(s,o),r.pos.indexOf("px")>=0||r.pos.indexOf("fr")>=0||r.pos.indexOf("%")>=0?(r.pos.indexOf("px")>=0&&(n/=a),t=h[1]+n*s,e=h[2]+n*o):(t=h[1]+n*this.board.unitX*s/a,e=h[2]+n*this.board.unitY*o/a),"left"===r.side?s*=-1:o*=-1,utils_type.A.exists(this.label)&&(l=.5*this.label.evalVisProp("distance")/a),t+=o*this.label.size[0]*l,e+=s*this.label.size[1]*l;return(d||p)&&(utils_type.A.exists(this.label)&&(c=this.label.evalVisProp("fontsize")),Math.abs(t)<math.A.eps?t=c:this.board.canvasWidth+math.A.eps>t&&t>this.board.canvasWidth-c-math.A.eps&&(t=this.board.canvasWidth-c),math.A.eps+c>e&&e>-math.A.eps?e=c:this.board.canvasHeight+math.A.eps>e&&e>this.board.canvasHeight-c-math.A.eps&&(e=this.board.canvasHeight-c)),new base_coords.A(constants.A.COORDS_BY_SCREEN,[t,e],this.board)},cloneToBackground:function(){var t,e,i,r=utils_type.A.getCloneObject(this);return r.point1=this.point1,r.point2=this.point2,r.stdform=this.stdform,e=this.getSlope(),t=this.getRise(),r.getSlope=function(){return e},r.getRise=function(){return t},i=this.board.renderer.enhancedRendering,this.board.renderer.enhancedRendering=!0,this.board.renderer.drawLine(r),this.board.renderer.enhancedRendering=i,this.traces[r.id]=r.rendNode,this},addTransform:function(t){var e,i=utils_type.A.isArray(t)?t:[t],r=i.length;for(e=0;e<r;e++)this.point1.transformations.push(i[e]),this.point2.transformations.push(i[e]);return this},snapToGrid:function(t){var e,i,r,n,s,o,a,l;return this.evalVisProp("snaptogrid")?this.parents.length<3?(this.point1.handleSnapToGrid(!0,!0),this.point2.handleSnapToGrid(!0,!0)):utils_type.A.exists(t)&&(a=this.evalVisProp("snapsizex"),l=this.evalVisProp("snapsizey"),s=(e=new base_coords.A(constants.A.COORDS_BY_SCREEN,[t.Xprev,t.Yprev],this.board)).usrCoords[1],o=e.usrCoords[2],a<=0&&this.board.defaultAxes&&this.board.defaultAxes.x.defaultTicks&&(a=(n=this.board.defaultAxes.x.defaultTicks).ticksDelta*(n.evalVisProp("minorticks")+1)),l<=0&&this.board.defaultAxes&&this.board.defaultAxes.y.defaultTicks&&(l=(n=this.board.defaultAxes.y.defaultTicks).ticksDelta*(n.evalVisProp("minorticks")+1)),a>0&&l>0&&(i=geometry.A.projectPointToLine({coords:e},this,this.board),r=statistics.A.subtract([1,Math.round(s/a)*a,Math.round(o/l)*l],i.usrCoords),this.board.create("transform",r.slice(1),{type:"translate"}).applyOnce([this.point1,this.point2]))):(this.point1.handleSnapToGrid(!1,!0),this.point2.handleSnapToGrid(!1,!0)),this},snapToPoints:function(){var t=this.evalVisProp("snaptopoints");return this.parents.length<3&&(this.point1.handleSnapToPoints(t),this.point2.handleSnapToPoints(t)),this},X:function(t){var e,i=this.stdform[2];return e=Math.abs(this.point1.coords.usrCoords[0])>math.A.eps?this.point1.coords.usrCoords[1]:this.point2.coords.usrCoords[1],t=2*(t-.5),(1-Math.abs(t))*e-t*i},Y:function(t){var e,i=this.stdform[1];return e=Math.abs(this.point1.coords.usrCoords[0])>math.A.eps?this.point1.coords.usrCoords[2]:this.point2.coords.usrCoords[2],t=2*(t-.5),(1-Math.abs(t))*e+t*i},Z:function(t){var e=Math.abs(this.point1.coords.usrCoords[0])>math.A.eps?this.point1.coords.usrCoords[0]:this.point2.coords.usrCoords[0];return t=2*(t-.5),(1-Math.abs(t))*e},L:function(){return this.point1.Dist(this.point2)},setFixedLength:function(t){return this.hasFixedLength?(this.fixedLength=utils_type.A.createFunction(t,this.board),this.hasFixedLength=!0,this.addParentsFromJCFunctions([this.fixedLength]),this.board.update(),this):this},minX:function(){return 0},maxX:function(){return 1},bounds:function(){var t=this.point1.coords.usrCoords,e=this.point2.coords.usrCoords;return[Math.min(t[1],e[1]),Math.max(t[2],e[2]),Math.max(t[1],e[1]),Math.min(t[2],e[2])]},remove:function(){this.removeAllTicks(),base_element.A.prototype.remove.call(this)}}),jxg.A.createLine=function(t,e,i){var r,n,s,o,a,l,c,h=[],u=!1,d=!1;if(2===e.length){if(l=utils_type.A.copyAttributes(i,t.options,"line","point1"),utils_type.A.isArray(e[0])&&e[0].length>1)s=t.create("point",e[0],l);else if(utils_type.A.isString(e[0])||utils_type.A.isPoint(e[0]))s=t.select(e[0]);else if(utils_type.A.isFunction(e[0])&&utils_type.A.isPoint(e[0]()))s=e[0](),d=!0;else if(utils_type.A.isFunction(e[0])&&e[0]().length&&e[0]().length>=2)s=jxg.A.createPoint(t,e[0](),l),d=!0;else{if(!utils_type.A.isObject(e[0])||!utils_type.A.isTransformationOrArray(e[1]))throw new Error("JSXGraph: Can't create line with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [point,point], [[x1,y1],[x2,y2]], [a,b,c]");u=!0,s=t.create("point",[e[0].point1,e[1]],l)}if(l=utils_type.A.copyAttributes(i,t.options,"line","point2"),u)o=t.create("point",[e[0].point2,e[1]],l);else if(utils_type.A.isArray(e[1])&&e[1].length>1)o=t.create("point",e[1],l);else if(utils_type.A.isString(e[1])||utils_type.A.isPoint(e[1]))o=t.select(e[1]);else if(utils_type.A.isFunction(e[1])&&utils_type.A.isPoint(e[1]()))o=e[1](),d=!0;else{if(!(utils_type.A.isFunction(e[1])&&e[1]().length&&e[1]().length>=2))throw new Error("JSXGraph: Can't create line with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [point,point], [[x1,y1],[x2,y2]], [a,b,c]");o=jxg.A.createPoint(t,e[1](),l),d=!0}l=utils_type.A.copyAttributes(i,t.options,"line"),n=new jxg.A.Line(t,s,o,l),d?(n.constrained=!0,n.funp1=e[0],n.funp2=e[1]):u||(n.isDraggable=!0),n.setParents([s.id,o.id])}else if(3===e.length){for(c=!0,a=0;a<3;a++)if(utils_type.A.isNumber(e[a]))h[a]=utils_type.A.createFunction(e[a]);else{if(!utils_type.A.isFunction(e[a]))throw new Error("JSXGraph: Can't create line with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"' and '"+typeof e[2]+"'.\nPossible parent types: [point,point], [[x1,y1],[x2,y2]], [a,b,c]");h[a]=e[a],c=!1}l=utils_type.A.copyAttributes(i,t.options,"line","point1"),s=c?t.create("point",[h[2]()*h[2]()+h[1]()*h[1](),h[2]()-h[1]()*h[0]()+h[2](),-h[1]()-h[2]()*h[0]()-h[1]()],l):t.create("point",[function(){return.5*(h[2]()*h[2]()+h[1]()*h[1]())},function(){return.5*(h[2]()-h[1]()*h[0]()+h[2]())},function(){return.5*(-h[1]()-h[2]()*h[0]()-h[1]())}],l),l=utils_type.A.copyAttributes(i,t.options,"line","point2"),o=c?t.create("point",[h[2]()*h[2]()+h[1]()*h[1](),-h[1]()*h[0]()+h[2](),-h[2]()*h[0]()-h[1]()],l):t.create("point",[function(){return h[2]()*h[2]()+h[1]()*h[1]()},function(){return-h[1]()*h[0]()+h[2]()},function(){return-h[2]()*h[0]()-h[1]()}],l),s.prepareUpdate().update(),o.prepareUpdate().update(),l=utils_type.A.copyAttributes(i,t.options,"line"),(n=new jxg.A.Line(t,s,o,l)).isDraggable=c,n.setParents([s,o])}else if(1===e.length&&utils_type.A.isFunction(e[0])&&2===e[0]().length&&utils_type.A.isPoint(e[0]()[0])&&utils_type.A.isPoint(e[0]()[1]))r=e[0](),l=utils_type.A.copyAttributes(i,t.options,"line"),(n=new jxg.A.Line(t,r[0],r[1],l)).constrained=!0,n.funps=e[0],n.setParents(r);else{if(!(1===e.length&&utils_type.A.isFunction(e[0])&&3===e[0]().length&&utils_type.A.isNumber(e[0]()[0])&&utils_type.A.isNumber(e[0]()[1])&&utils_type.A.isNumber(e[0]()[2])))throw new Error("JSXGraph: Can't create line with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [point,point], [[x1,y1],[x2,y2]], [a,b,c]");r=e[0],l=utils_type.A.copyAttributes(i,t.options,"line","point1"),s=t.create("point",[function(){var t=r();return[.5*(t[2]*t[2]+t[1]*t[1]),.5*(t[2]-t[1]*t[0]+t[2]),.5*(-t[1]-t[2]*t[0]-t[1])]}],l),l=utils_type.A.copyAttributes(i,t.options,"line","point2"),o=t.create("point",[function(){var t=r();return[t[2]*t[2]+t[1]*t[1],-t[1]*t[0]+t[2],-t[2]*t[0]-t[1]]}],l),l=utils_type.A.copyAttributes(i,t.options,"line"),(n=new jxg.A.Line(t,s,o,l)).constrained=!0,n.funps=e[0],n.setParents([s,o])}return n},jxg.A.registerElement("line",jxg.A.createLine),jxg.A.createSegment=function(t,e,i){var r,n;if(i.straightFirst=!1,i.straightLast=!1,n=utils_type.A.copyAttributes(i,t.options,"segment"),r=t.create("line",e.slice(0,2),n),3===e.length){try{r.hasFixedLength=!0,r.fixedLengthOldCoords=[],r.fixedLengthOldCoords[0]=new base_coords.A(constants.A.COORDS_BY_USER,r.point1.coords.usrCoords.slice(1,3),t),r.fixedLengthOldCoords[1]=new base_coords.A(constants.A.COORDS_BY_USER,r.point2.coords.usrCoords.slice(1,3),t),r.setFixedLength(e[2])}catch(t){throw new Error("JSXGraph: Can't create segment with third parent type '"+typeof e[2]+"'.\nPossible third parent types: number or function")}r.getParents=function(){return this.parents.concat(this.fixedLength())}}return r.elType="segment",r},jxg.A.registerElement("segment",jxg.A.createSegment),jxg.A.createArrow=function(t,e,i){var r,n;return i.straightFirst=!1,i.straightLast=!1,n=utils_type.A.copyAttributes(i,t.options,"arrow"),(r=t.create("line",e,n)).type=constants.A.OBJECT_TYPE_VECTOR,r.elType="arrow",r},jxg.A.registerElement("arrow",jxg.A.createArrow),jxg.A.createAxis=function(t,e,i){var r,n,s,o;n=utils_type.A.copyAttributes(i,t.options,"axis");try{r=t.create("line",e,n)}catch(t){throw new Error("JSXGraph: Can't create axis with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [point,point], [[x1,y1],[x2,y2]]")}for(s in r.type=constants.A.OBJECT_TYPE_AXIS,r.isDraggable=!1,r.point1.isDraggable=!1,r.point2.isDraggable=!1,r._point1UsrCoordsOrg=r.point1.coords.usrCoords.slice(),r._point2UsrCoordsOrg=r.point2.coords.usrCoords.slice(),r.ancestors)r.ancestors.hasOwnProperty(s)&&(r.ancestors[s].type=constants.A.OBJECT_TYPE_AXISPOINT);return o=utils_type.A.exists(n.ticks.ticksdistance)?n.ticks.ticksdistance:utils_type.A.isArray(n.ticks.ticks)?n.ticks.ticks:1,r.defaultTicks=t.create("ticks",[r,o],n.ticks),r.defaultTicks.dump=!1,r.elType="axis",r.subs={ticks:r.defaultTicks},r.inherits.push(r.defaultTicks),r.update=function(){var t,e,i,n,s,o,a,l,c,h,u,d,p,f,m,g,_,v,y;if(!this.needsUpdate)return this;if(t=this.board.getBoundingBox(),e=this.evalVisProp("position"),n=this.Direction(),s=this.isHorizontal(),o=this.isVertical(),a=this.evalVisProp("ticksautopos"),l=this.evalVisProp("ticksautoposthreshold"),l=s?utils_type.A.parseNumber(l,Math.abs(t[1]-t[3]),1/this.board.unitX)*this.board.unitX:o?utils_type.A.parseNumber(l,Math.abs(t[1]-t[3]),1/this.board.unitY)*this.board.unitY:utils_type.A.parseNumber(l,1,1),u=(h=this.evalVisProp("anchor")).indexOf("left")>-1,d=h.indexOf("right")>-1,p=this.evalVisProp("anchordist"),p=s?utils_type.A.parseNumber(p,Math.abs(t[1]-t[3]),1/this.board.unitX):o?utils_type.A.parseNumber(p,Math.abs(t[0]-t[2]),1/this.board.unitY):0,g=this.board.getPointLoc(this._point1UsrCoordsOrg,p),f=this.point1.coords.usrCoords.slice(),m=this.point2.coords.usrCoords.slice(),"static"===e||!o&&!s||("fixed"===e?(s&&(n[0]>0&&d||n[0]<0&&u?(f[2]=t[3]+p,m[2]=t[3]+p):n[0]>0&&u||n[0]<0&&d?(f[2]=t[1]-p,m[2]=t[1]-p):(f=this._point1UsrCoordsOrg.slice(),m=this._point2UsrCoordsOrg.slice())),o&&(n[1]>0&&u||n[1]<0&&d?(f[1]=t[0]+p,m[1]=t[0]+p):n[1]>0&&d||n[1]<0&&u?(f[1]=t[2]-p,m[1]=t[2]-p):(f=this._point1UsrCoordsOrg.slice(),m=this._point2UsrCoordsOrg.slice()))):"sticky"===e&&(s&&(g[1]<0&&(n[0]>0&&d||n[0]<0&&u)?(f[2]=t[3]+p,m[2]=t[3]+p):g[1]>0&&(n[0]>0&&u||n[0]<0&&d)?(f[2]=t[1]-p,m[2]=t[1]-p):(f=this._point1UsrCoordsOrg.slice(),m=this._point2UsrCoordsOrg.slice())),o&&(g[0]<0&&(n[1]>0&&u||n[1]<0&&d)?(f[1]=t[0]+p,m[1]=t[0]+p):g[0]>0&&(n[1]>0&&d||n[1]<0&&u)?(f[1]=t[2]-p,m[1]=t[2]-p):(f=this._point1UsrCoordsOrg.slice(),m=this._point2UsrCoordsOrg.slice())))),this.point1.setPositionDirectly(jxg.A.COORDS_BY_USER,f),this.point2.setPositionDirectly(jxg.A.COORDS_BY_USER,m),utils_type.A.exists(this.defaultTicks)){if(_=this.defaultTicks.visProp.label,a&&(s||o)){if(utils_type.A.exists(_._anchorx_org)||(_._anchorx_org=utils_type.A.def(_.anchorx,this.board.options.text.anchorX)),utils_type.A.exists(_._anchory_org)||(_._anchory_org=utils_type.A.def(_.anchory,this.board.options.text.anchorY)),utils_type.A.exists(_._offset_org)||(_._offset_org=_.offset.slice()),y=_.offset,s){for(c=r.point1.coords.scrCoords[2]-.5*this.board.canvasHeight,v=_.anchory,c<0&&Math.abs(c)>l?"bottom"===_._side&&("top"===_.anchory&&(v="bottom"),y[1]*=-1,_._side="top"):c>0&&Math.abs(c)>l?"top"===_._side&&("bottom"===_.anchory&&(v="top"),y[1]*=-1,_._side="bottom"):(v=_._anchory_org,y=_._offset_org.slice(),"top"===v?_._side="bottom":"bottom"===v?_._side="top":y[1]<0?_._side="bottom":_._side="top"),i=0;i<r.defaultTicks.labels.length;i++)this.defaultTicks.labels[i].visProp.anchory=v;_.anchory=v}else if(o){for((c=r.point1.coords.scrCoords[1]-.5*this.board.canvasWidth)<0&&Math.abs(c)>l?"right"===_._side&&("left"===_.anchorx&&(v="right"),y[0]*=-1,_._side="left"):c>0&&Math.abs(c)>l?"left"===_._side&&("right"===_.anchorx&&(v="left"),y[0]*=-1,_._side="right"):(v=_._anchorx_org,y=_._offset_org.slice(),"left"===v?_._side="right":"right"===v||y[0]<0?_._side="left":_._side="right"),i=0;i<r.defaultTicks.labels.length;i++)this.defaultTicks.labels[i].visProp.anchorx=v;_.anchorx=v}_.offset=y}else delete _._anchorx_org,delete _._anchory_org,delete _._offset_org;this.defaultTicks.needsUpdate=!0}return jxg.A.Line.prototype.update.call(this),this},r},jxg.A.registerElement("axis",jxg.A.createAxis),jxg.A.createTangent=function(t,e,i){var r,n,s,o,a,l,c,h,u,d=[];if(1===e.length)r=e[0],n=r.slideObject;else{if(2!==e.length)throw new Error("JSXGraph: Can't create tangent with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [glider|point], [point,line|curve|circle|conic]");if(utils_type.A.isPoint(e[0]))r=e[0],n=e[1];else{if(!utils_type.A.isPoint(e[1]))throw new Error("JSXGraph: Can't create tangent with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [glider|point], [point,line|curve|circle|conic]");n=e[0],r=e[1]}}if(l=utils_type.A.copyAttributes(i,t.options,"tangent"),n.elementClass===constants.A.OBJECT_CLASS_LINE)(a=t.create("line",[n.point1,n.point2],l)).glider=r;else if(n.elementClass===constants.A.OBJECT_CLASS_CURVE&&n.type!==constants.A.OBJECT_TYPE_CONIC){if(h=n.getTransformationSource(),u=h[0])for(d.push(n);h[0]&&utils_type.A.exists(h[1]._transformationSource);)d.push(h[1]),h=h[1].getTransformationSource();"plot"!==n.evalVisProp("curvetype")||u?(a=t.create("line",[function(){var e,i,s,o,a,l,c,h,p=n.X,f=n.Y;if(h=r.type===constants.A.OBJECT_TYPE_GLIDER?r.position:"functiongraph"===n.evalVisProp("curvetype")?r.X():geometry.A.projectPointToCurve(r,n,t)[1],c=r.Coords(!0),u){for(p=(a=d[d.length-1]._transformationSource).X,f=a.Y,o=0;o<d.length;o++)d[o].updateTransformMatrix(),l=math.A.inverse(d[o].transformMat),c=math.A.matVecMult(l,c);r.type!==constants.A.OBJECT_TYPE_GLIDER&&(c[1]/=c[0],c[2]/=c[0],c[0]/=c[0],h=geometry.A.projectCoordsToCurve(c[1],c[2],0,a,t)[1])}if(e=numerics.A.D(f)(h),i=numerics.A.D(p)(h),s=[-c[1]*e+c[2]*i,c[0]*e,-c[0]*i],u)for(o=d.length-1;o>=0;o--)l=math.A.transpose(math.A.inverse(d[o].transformMat)),s=math.A.matVecMult(l,s);return s}],l),r.addChild(a),a.glider=r):(c=function(t,e,i){var n,s,o,a,l,c,h,u,d,p,f,m,g=Math.floor(t);if(1===e.bezierDegree)g===e.numberPoints-1&&g--;else{if(3!==e.bezierDegree)return 0;o=(t*((m="sector"===e.elType?(f=e.points.slice(3,e.numberPoints-3)).length:(f=e.points).length)-1)-(g=3*Math.floor(t*(m-1)/3)))/3,g>=m-1&&(g=m-4,o=1)}if(g<0)return 1;switch(1===e.bezierDegree?(n=e.points[g].usrCoords,s=e.points[g+1].usrCoords):(a=f[g].usrCoords,l=f[g+1].usrCoords,c=f[g+2].usrCoords,h=f[g+3].usrCoords,u=(1-o)*(1-o)*(l[1]-a[1])+2*(1-o)*o*(c[1]-l[1])+o*o*(h[1]-c[1]),d=(1-o)*(1-o)*(l[2]-a[2])+2*(1-o)*o*(c[2]-l[2])+o*o*(h[2]-c[2]),u/=p=math.A.hypot(u,d),d/=p,s=[1,(n=r.coords.usrCoords)[1]+u,n[2]+d]),i){case 0:return n[2]*s[1]-n[1]*s[2];case 1:return s[2]-n[2];case 2:return n[1]-s[1];default:return[n[2]*s[1]-n[1]*s[2],s[2]-n[2],n[1]-s[1]]}},a=t.create("line",[function(){var e;return e=r.type===constants.A.OBJECT_TYPE_GLIDER?r.position:geometry.A.projectPointToCurve(r,n,t)[1],c(e,n)}],l),r.addChild(a),a.glider=r)}else n.type===constants.A.OBJECT_TYPE_TURTLE?(a=t.create("line",[function(){var e,i;for(i=r.type===constants.A.OBJECT_TYPE_GLIDER?r.position:geometry.A.projectPointToTurtle(r,n,t)[1],e=Math.floor(i),s=0;s<n.objects.length;s++)if((o=n.objects[s]).type===constants.A.OBJECT_TYPE_CURVE){if(e<o.numberPoints)break;e-=o.numberPoints}return e===o.numberPoints-1&&e--,e<0?[1,0,0]:[o.Y(e)*o.X(e+1)-o.X(e)*o.Y(e+1),o.Y(e+1)-o.Y(e),o.X(e)-o.X(e+1)]}],l),r.addChild(a),a.glider=r):n.elementClass!==constants.A.OBJECT_CLASS_CIRCLE&&n.type!==constants.A.OBJECT_TYPE_CONIC||(a=t.create("line",[function(){return math.A.matVecMult(n.quadraticform,r.coords.usrCoords)}],l),r.addChild(a),a.glider=r);if(!utils_type.A.exists(a))throw new Error("JSXGraph: Couldn't create tangent with the given parents.");return a.elType="tangent",a.type=constants.A.OBJECT_TYPE_TANGENT,a.setParents(e),a},jxg.A.createNormal=function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p=[];for(o=0;o<e.length;++o)e[o]=t.select(e[o]);if(1===e.length)r=e[0],n=r.slideObject;else{if(2!==e.length)throw new Error("JSXGraph: Can't create normal with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [point,line], [point,circle], [glider]");if(utils_type.A.isPointType(t,e[0]))r=utils_type.A.providePoints(t,[e[0]],i,"point")[0],n=e[1];else{if(!utils_type.A.isPointType(t,e[1]))throw new Error("JSXGraph: Can't create normal with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [point,line], [point,circle], [glider]");n=e[0],r=utils_type.A.providePoints(t,[e[1]],i,"point")[0]}}if(a=utils_type.A.copyAttributes(i,t.options,"normal"),n.elementClass===constants.A.OBJECT_CLASS_LINE)c=utils_type.A.copyAttributes(i,t.options,"normal","point"),l=t.create("point",[function(){var t=math.A.crossProduct([1,0,0],n.stdform);return[t[0],-t[2],t[1]]}],c),l.isDraggable=!0,(s=t.create("line",[r,l],a)).point=l,s.subs={point:l},s.inherits.push(l);else if(n.elementClass===constants.A.OBJECT_CLASS_CIRCLE)s=t.create("line",[n.midpoint,r],a);else if(n.elementClass===constants.A.OBJECT_CLASS_CURVE){if(u=n.getTransformationSource(),d=u[0])for(p.push(n);u[0]&&utils_type.A.exists(u[1]._transformationSource);)p.push(u[1]),u=u[1].getTransformationSource();"plot"!==n.evalVisProp("curvetype")||d?s=t.create("line",[function(){var e,i,s,o,a,l,c,h,u=n.X,f=n.Y;if(h=r.type===constants.A.OBJECT_TYPE_GLIDER?r.position:"functiongraph"===n.evalVisProp("curvetype")?r.X():geometry.A.projectPointToCurve(r,n,t)[1],c=r.Coords(!0),d){for(u=(a=p[p.length-1]._transformationSource).X,f=a.Y,o=0;o<p.length;o++)p[o].updateTransformMatrix(),l=math.A.inverse(p[o].transformMat),c=math.A.matVecMult(l,c);r.type!==constants.A.OBJECT_TYPE_GLIDER&&(c[1]/=c[0],c[2]/=c[0],c[0]/=c[0],h=geometry.A.projectCoordsToCurve(c[1],c[2],0,a,t)[1])}if(e=numerics.A.D(f)(h),i=numerics.A.D(u)(h),s=[-c[1]*i-c[2]*e,c[0]*i,c[0]*e],d)for(o=p.length-1;o>=0;o--)l=math.A.transpose(math.A.inverse(p[o].transformMat)),s=math.A.matVecMult(l,s);return s}],a):(h=function(t,e,i){var n,s,o,a,l,c,h,u,d,p,f,m,g,_,v,y,b=Math.floor(t);if(1===e.bezierDegree)b===e.numberPoints-1&&b--,a=t;else{if(3!==e.bezierDegree)return 0;a=(t*((y="sector"===e.elType?(v=e.points.slice(3,e.numberPoints-3)).length:(v=e.points).length)-1)-(b=3*Math.floor(t*(y-1)/3)))/3,b>=y-1&&(b=y-4,a=1)}if(b<0)return 1;switch(n=a-b,1===e.bezierDegree?(s=e.points[b].usrCoords,o=e.points[b+1].usrCoords,g=[s[0]+n*(o[0]-s[0]),s[1]+n*(o[1]-s[1]),s[2]+n*(o[2]-s[2])],m=math.A.crossProduct(s,o),_=[(_=math.A.crossProduct([1,0,0],m))[0],-_[2],_[1]],m=math.A.crossProduct(g,_)):(l=v[b].usrCoords,c=v[b+1].usrCoords,h=v[b+2].usrCoords,u=v[b+3].usrCoords,d=(1-a)*(1-a)*(c[1]-l[1])+2*(1-a)*a*(h[1]-c[1])+a*a*(u[1]-h[1]),p=(1-a)*(1-a)*(c[2]-l[2])+2*(1-a)*a*(h[2]-c[2])+a*a*(u[2]-h[2]),d/=f=math.A.hypot(d,p),p/=f,o=[1,(s=r.coords.usrCoords)[1]-p,s[2]+d],m=[s[2]*o[1]-s[1]*o[2],o[2]-s[2],s[1]-o[1]]),i){case 0:return m[0];case 1:return m[1];case 2:return m[2];default:return m}},s=t.create("line",[function(){var e;return e=r.type===constants.A.OBJECT_TYPE_GLIDER?r.position:geometry.A.projectPointToCurve(r,n,t)[1],h(e,n)}],a),r.addChild(s),s.glider=r)}else{if(n.type!==constants.A.OBJECT_TYPE_TURTLE)throw new Error("JSXGraph: Can't create normal with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [point,line], [point,circle], [glider]");s=t.create("line",[function(){var t,e,i=Math.floor(r.position),s=r.position-i;for(e=0;e<n.objects.length;e++)if((t=n.objects[e]).type===constants.A.OBJECT_TYPE_CURVE){if(i<t.numberPoints)break;i-=t.numberPoints}return i===t.numberPoints-1&&(i-=1,s=1),i<0?1:(t.Y(i)+s*(t.Y(i+1)-t.Y(i)))*(t.Y(i)-t.Y(i+1))-(t.X(i)+s*(t.X(i+1)-t.X(i)))*(t.X(i+1)-t.X(i))},function(){var t,e,i=Math.floor(r.position);for(e=0;e<n.objects.length;e++)if((t=n.objects[e]).type===constants.A.OBJECT_TYPE_CURVE){if(i<t.numberPoints)break;i-=t.numberPoints}return i===t.numberPoints-1&&(i-=1),i<0?0:t.X(i+1)-t.X(i)},function(){var t,e,i=Math.floor(r.position);for(e=0;e<n.objects.length;e++)if((t=n.objects[e]).type===constants.A.OBJECT_TYPE_CURVE){if(i<t.numberPoints)break;i-=t.numberPoints}return i===t.numberPoints-1&&(i-=1),i<0?0:t.Y(i+1)-t.Y(i)}],a)}return s.elType="normal",s.setParents(e),utils_type.A.exists(r._is_new)?(s.addChild(r),delete r._is_new):r.addChild(s),n.addChild(s),s},jxg.A.createRadicalAxis=function(t,e,i){var r,n,s;if(2!==e.length||e[0].elementClass!==constants.A.OBJECT_CLASS_CIRCLE||e[1].elementClass!==constants.A.OBJECT_CLASS_CIRCLE)throw new Error("JSXGraph: Can't create 'radical axis' with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent type: [circle,circle]");return n=t.select(e[0]),s=t.select(e[1]),(r=t.create("line",[function(){var t=n.stdform,e=s.stdform;return math.A.matVecMult(math.A.transpose([t.slice(0,3),e.slice(0,3)]),[e[3],-t[3]])}],i)).elType="radicalaxis",r.setParents([n.id,s.id]),n.addChild(r),s.addChild(r),r},jxg.A.createPolarLine=function(t,e,i){var r,n,s,o,a,l,c;if(e.length>1&&(o=e[0].type===constants.A.OBJECT_TYPE_CONIC||e[0].elementClass===constants.A.OBJECT_CLASS_CIRCLE,a=e[1].type===constants.A.OBJECT_TYPE_CONIC||e[1].elementClass===constants.A.OBJECT_CLASS_CIRCLE,l=utils_type.A.isPoint(e[0]),c=utils_type.A.isPoint(e[1])),2!==e.length||!(o&&c||l&&a))throw new Error("JSXGraph: Can't create 'polar line' with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent type: [conic|circle,point], [point,conic|circle]");return c?(n=t.select(e[0]),s=t.select(e[1])):(n=t.select(e[1]),s=t.select(e[0])),(r=t.create("tangent",[n,s],i)).elType="polarline",r},jxg.A.createTangentTo=function(t,e,i){var r,n,s,o,a,l,c;if(s=t.select(e[0]),o=utils_type.A.providePoints(t,e[1],i,"point")[0],a=utils_type.A.def(e[2],0),s.type!==constants.A.OBJECT_TYPE_CIRCLE&&s.type!==constants.A.OBJECT_TYPE_CONIC||o.elementClass!==constants.A.OBJECT_CLASS_POINT)throw new Error("JSXGraph: Can't create tangentto with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"' and '"+typeof e[2]+"'.\nPossible parent types: [circle|conic,point,number]");return n=utils_type.A.copyAttributes(i,t.options,"tangentto"),c=t.create("polar",[s,o],n.polar),l=t.create("intersection",[c,s,a],n.point),(r=t.create("tangent",[s,l],n)).point=l,r.polar=c,r.elType="tangentto",r},jxg.A.registerElement("tangent",jxg.A.createTangent),jxg.A.registerElement("normal",jxg.A.createNormal),jxg.A.registerElement("tangentto",jxg.A.createTangentTo),jxg.A.registerElement("polar",jxg.A.createTangent),jxg.A.registerElement("radicalaxis",jxg.A.createRadicalAxis),jxg.A.registerElement("polarline",jxg.A.createPolarLine);const line=jxg.A.Line;jxg.A.Group=function(t,e,i,r,n){var s,o,a,l;for(this.board=t,this.objects={},s=this.board.numObjects,this.board.numObjects+=1,""!==e&&utils_type.A.exists(e)?this.id=e:this.id=this.board.id+"Group"+s,this.board.groups[this.id]=this,this.type=constants.A.OBJECT_TYPE_POINT,this.elementClass=constants.A.OBJECT_CLASS_POINT,""!==i&&utils_type.A.exists(i)?this.name=i:this.name="group_"+this.board.generateName(this),delete this.type,this.coords={},this.needsRegularUpdate=n.needsregularupdate,this.rotationCenter="centroid",this.scaleCenter=null,this.rotationPoints=[],this.translationPoints=[],this.scalePoints=[],this.scaleDirections={},this.parents=[],o=utils_type.A.isArray(r)?r:Array.prototype.slice.call(arguments,3),a=0;a<o.length;a++)!(l=this.board.select(o[a])).evalVisProp("fixed")&&utils_type.A.exists(l.coords)&&this.addPoint(l);this.methodMap={ungroup:"ungroup",add:"addPoint",addPoint:"addPoint",addPoints:"addPoints",addGroup:"addGroup",remove:"removePoint",removePoint:"removePoint",setAttribute:"setAttribute",setProperty:"setAttribute"}},jxg.A.extend(jxg.A.Group.prototype,{ungroup:function(){var t,e,i;for(t in this.objects)this.objects.hasOwnProperty(t)&&(e=this.objects[t].point,utils_type.A.isArray(e.groups)&&(i=utils_type.A.indexOf(e.groups,this.id))>=0&&delete e.groups[i]);return this.objects={},this},addParents:function(t){var e,i,r;for(i=(r=utils_type.A.isArray(t)?t:arguments).length,e=0;e<i;++e)utils_type.A.isId(this.board,r[e])?this.parents.push(r[e]):utils_type.A.exists(r[e].id)&&this.parents.push(r[e].id);this.parents=utils_type.A.uniqueArray(this.parents)},setParents:function(t){return this.parents=[],this.addParents(t),this},getParents:function(){return utils_type.A.isArray(this.parents)?this.parents:[]},_updateCoordsCache:function(t){var e;""!==t&&utils_type.A.exists(this.objects[t])&&(e=this.objects[t].point,this.coords[e.id]={usrCoords:e.coords.usrCoords.slice(0)})},update:function(){var t,e,i,r,n,s,o,a,l,c,h,u,d=null;if(!this.needsUpdate)return this;if("nothing"===(e=this._update_find_drag_type()).action)return this._updateCoordsCache(e.id),this;if(d=this.objects[e.id].point,"translation"===e.action){if(c=[d.coords.usrCoords[1]-this.coords[e.id].usrCoords[1],d.coords.usrCoords[2]-this.coords[e.id].usrCoords[2]],d.elementClass!==constants.A.OBJECT_CLASS_POINT){for(c.unshift(0),t=0;t<d.transformations.length;t++)c=math.A.matVecMult(d.transformations[t].matrix,c);c.shift()}(h=this.board.create("transform",c,{type:"translate"})).update()}else if("rotation"===e.action||"scaling"===e.action){if(r="rotation"===e.action?"rotationCenter":"scaleCenter",utils_type.A.exists(this[r].coords))u=this[r].coords.usrCoords.slice(1);else if("centroid"===this[r])u=this._update_centroid_center();else if(utils_type.A.isArray(this[r]))u=this[r];else{if(!utils_type.A.isFunction(this[r]))return jxg.A.debug("Group.update: No valid center for this transformation, get out of here."),this;u=this[r]()}if("rotation"===e.action)l=geometry.A.rad(this.coords[e.id].usrCoords.slice(1),u,this.objects[e.id].point),(c=this.board.create("transform",[l,u[0],u[1]],{type:"rotate"})).update();else{if("scaling"!==e.action)return this;if(s=geometry.A.distance(this.coords[e.id].usrCoords.slice(1),u),Math.abs(s)<math.A.eps)return this;s=geometry.A.distance(d.coords.usrCoords.slice(1),u)/s,o=this.scaleDirections[e.id].indexOf("x")>=0?s:1,a=this.scaleDirections[e.id].indexOf("y")>=0?s:1,(c=this.board.create("transform",[1,0,0,u[0]*(1-o),o,0,u[1]*(1-a),0,a],{type:"generic"})).update()}}for(i in this.objects)(d=this.objects[i].point).elementClass!==constants.A.OBJECT_CLASS_POINT&&(utils_type.A.exists(c.board)?c.meltTo(d):e.id!==d.id&&h.meltTo(d));for(i in this._update_apply_transformation(e,c),this.needsUpdate=!1,this.objects)if(this.objects.hasOwnProperty(i))for(n in this.objects[i].descendants)this.objects[i].descendants.hasOwnProperty(n)&&(this.objects[i].descendants.needsUpdate=this.objects[i].descendants.needsRegularUpdate||this.board.needsFullUpdate);for(i in this.board.updateElements(e),this.objects)this.objects.hasOwnProperty(i)&&this._updateCoordsCache(i);return this},_update_find_drag_type:function(){var t,e,i,r="nothing",n=[];for(t in this.objects)this.objects.hasOwnProperty(t)&&(e=this.objects[t].point).coords.distance(constants.A.COORDS_BY_USER,this.coords[t])>math.A.eps&&n.push(e.id);return 0===n.length?{action:r,id:"",changed:n}:(i=n[0],e=this.objects[i].point,n.length>1?r="translation":utils_type.A.isInArray(this.rotationPoints,e)&&utils_type.A.exists(this.rotationCenter)?r="rotation":utils_type.A.isInArray(this.scalePoints,e)&&utils_type.A.exists(this.scaleCenter)?r="scaling":utils_type.A.isInArray(this.translationPoints,e)&&(r="translation"),{action:r,id:i,changed:n})},_update_centroid_center:function(){var t,e,i;for(i in t=[0,0],e=0,this.coords)this.coords.hasOwnProperty(i)&&(t[0]+=this.coords[i].usrCoords[1],t[1]+=this.coords[i].usrCoords[2],++e);return e>0&&(t[0]/=e,t[1]/=e),t},_update_apply_transformation:function(t,e){var i,r;for(i in this.objects)this.objects.hasOwnProperty(i)&&(utils_type.A.exists(this.board.objects[i])?(r=this.objects[i].point).id!==t.id?"translation"===t.action?utils_type.A.isInArray(t.changed,r.id)||r.elementClass===constants.A.OBJECT_CLASS_POINT&&r.coords.setCoordinates(constants.A.COORDS_BY_USER,[this.coords[i].usrCoords[1]+e[0],this.coords[i].usrCoords[2]+e[1]]):"rotation"!==t.action&&"scaling"!==t.action||r.elementClass===constants.A.OBJECT_CLASS_POINT&&e.applyOnce([r]):"rotation"!==t.action&&"scaling"!==t.action||r.coords.setCoordinates(constants.A.COORDS_BY_USER,math.A.matVecMult(e.matrix,this.coords[r.id].usrCoords)):delete this.objects[i])},addPoint:function(t){return this.objects[t.id]={point:this.board.select(t)},this._updateCoordsCache(t.id),this.translationPoints.push(t),t.groups.push(this.id),t.groups=utils_type.A.uniqueArray(t.groups),this},addPoints:function(t){var e;for(e=0;e<t.length;e++)this.addPoint(t[e]);return this},addGroup:function(t){var e;for(e in t.objects)t.objects.hasOwnProperty(e)&&this.addPoint(t.objects[e].point);return this},removePoint:function(t){return delete this.objects[t.id],this},setRotationCenter:function(t){return this.rotationCenter=t,this},setRotationPoints:function(t){return this._setActionPoints("rotation",t)},addRotationPoint:function(t){return this._addActionPoint("rotation",t)},removeRotationPoint:function(t){return this._removeActionPoint("rotation",t)},setTranslationPoints:function(t){return this._setActionPoints("translation",t)},addTranslationPoint:function(t){return this._addActionPoint("translation",t)},removeTranslationPoint:function(t){return this._removeActionPoint("translation",t)},setScaleCenter:function(t){return this.scaleCenter=t,this},setScalePoints:function(t,e){var i,r,n;for(n=(i=utils_type.A.isArray(t)?t:arguments).length,r=0;r<n;++r)this.scaleDirections[this.board.select(i[r]).id]=e||"xy";return this._setActionPoints("scale",t)},addScalePoint:function(t,e){return this._addActionPoint("scale",t),this.scaleDirections[this.board.select(t).id]=e||"xy",this},removeScalePoint:function(t){return this._removeActionPoint("scale",t)},_setActionPoints:function(t,e){var i,r,n;for(n=(i=utils_type.A.isArray(e)?e:arguments).length,this[t+"Points"]=[],r=0;r<n;++r)this._addActionPoint(t,i[r]);return this},_addActionPoint:function(t,e){return this[t+"Points"].push(this.board.select(e)),this},_removeActionPoint:function(t,e){var i=this[t+"Points"].indexOf(this.board.select(e));return i>-1&&this[t+"Points"].splice(i,1),this},setProperty:function(){jxg.A.deprecated("Group.setProperty","Group.setAttribute()"),this.setAttribute.apply(this,arguments)},setAttribute:function(){var t;for(t in this.objects)this.objects.hasOwnProperty(t)&&this.objects[t].point.setAttribute.apply(this.objects[t].point,arguments);return this}}),jxg.A.createGroup=function(t,e,i){var r=utils_type.A.copyAttributes(i,t.options,"group"),n=new jxg.A.Group(t,r.id,r.name,e,r);return n.elType="group",n.setParents(e),n},jxg.A.registerElement("group",jxg.A.createGroup);const group=jxg.A.Group;jxg.A.Circle=function(t,e,i,r,n){this.constructor(t,n,constants.A.OBJECT_TYPE_CIRCLE,constants.A.OBJECT_CLASS_CIRCLE),this.method=e,this.midpoint=this.board.select(i),this.center=this.board.select(i),this.point2=null,this.radius=0,this.line=null,this.circle=null,this.points=[],"twoPoints"===e?(this.point2=t.select(r),this.radius=this.Radius()):"pointRadius"===e?(this.gxtterm=r,this.updateRadius=utils_type.A.createFunction(r,this.board),this.updateRadius(),this.addParentsFromJCFunctions([this.updateRadius])):"pointLine"===e?(this.line=t.select(r),this.radius=this.line.point1.coords.distance(constants.A.COORDS_BY_USER,this.line.point2.coords)):"pointCircle"===e&&(this.circle=t.select(r),this.radius=this.circle.Radius()),this.id=this.board.setId(this,"C"),this.board.renderer.drawEllipse(this),this.board.finalizeAdding(this),this.createGradient(),this.elType="circle",this.createLabel(),utils_type.A.exists(this.center._is_new)?(this.addChild(this.center),delete this.center._is_new):this.center.addChild(this),"pointRadius"===e?this.notifyParents(r):"pointLine"===e?this.line.addChild(this):"pointCircle"===e?this.circle.addChild(this):"twoPoints"===e&&(utils_type.A.exists(this.point2._is_new)?(this.addChild(this.point2),delete this.point2._is_new):this.point2.addChild(this)),this.methodMap=utils_type.A.deepCopy(this.methodMap,{setRadius:"setRadius",getRadius:"getRadius",Area:"Area",area:"Area",Perimeter:"Perimeter",Circumference:"Perimeter",radius:"Radius",Radius:"Radius",Diameter:"Diameter",center:"center",line:"line",point2:"point2"})},jxg.A.Circle.prototype=new base_element.A,jxg.A.extend(jxg.A.Circle.prototype,{hasPoint:function(t,e){var i,r,n,s,o,a=this.center.coords.usrCoords,l=new base_coords.A(constants.A.COORDS_BY_SCREEN,[t,e],this.board),c=this.Radius();return utils_type.A.isObject(this.evalVisProp("precision"))?(r=this.board._inputDevice,i=this.evalVisProp("precision."+r)):i=this.board.options.precision.hasPoint,n=a[1]-l.usrCoords[1],s=a[2]-l.usrCoords[2],o=math.A.hypot(n,s),i+=.5*this.evalVisProp("strokewidth"),i/=Math.sqrt(Math.abs(this.board.unitX*this.board.unitY)),this.evalVisProp("hasinnerpoints")?o<c+i:Math.abs(o-c)<i},generatePolynomial:function(t){var e=this.center.symbolic.x,i=this.center.symbolic.y,r=t.symbolic.x,n=t.symbolic.y,s=this.generateRadiusSquared();return""===s?[]:["(("+r+")-("+e+"))^2 + (("+n+")-("+i+"))^2 - ("+s+")"]},generateRadiusSquared:function(){var t,e,i,r,n="";return"twoPoints"===this.method?(t=this.center.symbolic.x,e=this.center.symbolic.y,n="(("+(i=this.point2.symbolic.x)+")-("+t+"))^2 + (("+(r=this.point2.symbolic.y)+")-("+e+"))^2"):"pointRadius"===this.method?utils_type.A.isNumber(this.radius)&&(n=(this.radius*this.radius).toString()):"pointLine"===this.method?(i=this.line.point1.symbolic.x,r=this.line.point1.symbolic.y,n="(("+i+")-("+this.line.point2.symbolic.x+"))^2 + (("+r+")-("+this.line.point2.symbolic.y+"))^2"):"pointCircle"===this.method&&(n=this.circle.Radius()),n},update:function(){var t,e,i,r,n,s;if(this.needsUpdate)for(this.evalVisProp("trace")&&this.cloneToBackground(!0),"pointLine"===this.method?this.radius=this.line.point1.coords.distance(constants.A.COORDS_BY_USER,this.line.point2.coords):"pointCircle"===this.method?this.radius=this.circle.Radius():"pointRadius"===this.method&&(this.radius=this.updateRadius()),this.radius=Math.abs(this.radius),this.updateStdform(),this.updateQuadraticform(),i=this.center.coords.usrCoords[0],t=this.center.coords.usrCoords[1]/i,e=this.center.coords.usrCoords[2]/i,i/=i,r=this.Radius(),n=.551915024494,this.numberPoints=13,this.dataX=[t+r,t+r,t+r*n,t,t-r*n,t-r,t-r,t-r,t-r*n,t,t+r*n,t+r,t+r],this.dataY=[e,e+r*n,e+r,e+r,e+r,e+r*n,e,e-r*n,e-r,e-r,e-r,e-r*n,e],this.bezierDegree=3,s=0;s<this.numberPoints;s++)this.points[s]=new base_coords.A(constants.A.COORDS_BY_USER,[this.dataX[s],this.dataY[s]],this.board);return this},updateQuadraticform:function(){var t=this.center,e=t.X(),i=t.Y(),r=this.Radius();this.quadraticform=[[e*e+i*i-r*r,-e,-i],[-e,1,0],[-i,0,1]]},updateStdform:function(){this.stdform[3]=.5,this.stdform[4]=this.Radius(),this.stdform[1]=-this.center.coords.usrCoords[1],this.stdform[2]=-this.center.coords.usrCoords[2],isFinite(this.stdform[4])||(this.stdform[0]=utils_type.A.exists(this.point2)?-(this.stdform[1]*this.point2.coords.usrCoords[1]+this.stdform[2]*this.point2.coords.usrCoords[2]):0),this.normalize()},updateRenderer:function(){return this.needsUpdate?(this.visPropCalc.visible&&(this.isReal=!isNaN(this.center.coords.usrCoords[1]+this.center.coords.usrCoords[2]+this.Radius())&&this.center.isReal,this.isReal||this.updateVisibility(!1)),this.visPropCalc.visible&&this.board.renderer.updateEllipse(this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this):this},notifyParents:function(t){utils_type.A.isString(t)&&geonext.A.findDependencies(this,t,this.board)},setRadius:function(t){return this.updateRadius=utils_type.A.createFunction(t,this.board),this.addParentsFromJCFunctions([this.updateRadius]),this.board.update(),this},Radius:function(t){return utils_type.A.exists(t)?(this.setRadius(t),this.Radius()):"twoPoints"===this.method?utils_type.A.cmpArrays(this.point2.coords.usrCoords,[0,0,0])||utils_type.A.cmpArrays(this.center.coords.usrCoords,[0,0,0])?NaN:this.center.Dist(this.point2):"pointLine"===this.method||"pointCircle"===this.method?this.radius:"pointRadius"===this.method?this.evalVisProp("nonnegativeonly")?Math.max(0,this.updateRadius()):Math.abs(this.updateRadius()):NaN},Diameter:function(){return 2*this.Radius()},getRadius:function(){return jxg.A.deprecated("Circle.getRadius()","Circle.Radius()"),this.Radius()},getTextAnchor:function(){return this.center.coords},getLabelAnchor:function(){var t,e,i,r,n,s,o=1.5,a=this.Radius(),l=this.center.coords.usrCoords,c=.7071067811865;if(!utils_type.A.exists(this.label))return new base_coords.A(constants.A.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(i=this.label.evalVisProp("position"),!utils_type.A.isString(i))return new base_coords.A(constants.A.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(!(i.indexOf("right")<0&&i.indexOf("left")<0))return l=this.center.coords.scrCoords,r=utils_type.A.parsePosition(i),n=utils_type.A.parseNumber(r.pos,2*Math.PI,1),r.pos.indexOf("fr")<0&&r.pos.indexOf("%")<0&&(r.pos.indexOf("px")>=0?n=0:n*=Math.PI/180),s=1,"left"===r.side&&(s=-1),utils_type.A.exists(this.label)&&(o=.5*s*this.label.evalVisProp("distance")),t=l[1]+(a*this.board.unitX+this.label.size[0]*o)*Math.cos(n),e=l[2]-(a*this.board.unitY+this.label.size[1]*o)*Math.sin(n),new base_coords.A(constants.A.COORDS_BY_SCREEN,[t,e],this.board);switch(this.evalVisProp("label.position")){case"lft":t=l[1]-a,e=l[2];break;case"llft":t=l[1]-c*a,e=l[2]-c*a;break;case"rt":t=l[1]+a,e=l[2];break;case"lrt":t=l[1]+c*a,e=l[2]-c*a;break;case"urt":t=l[1]+c*a,e=l[2]+c*a;break;case"top":t=l[1],e=l[2]+a;break;case"bot":t=l[1],e=l[2]-a;break;default:t=l[1]-c*a,e=l[2]+c*a}return new base_coords.A(constants.A.COORDS_BY_USER,[t,e],this.board)},cloneToBackground:function(){var t,e=this.Radius(),i=utils_type.A.getCloneObject(this);return i.center={coords:this.center.coords},i.Radius=function(){return e},i.getRadius=function(){return e},t=this.board.renderer.enhancedRendering,this.board.renderer.enhancedRendering=!0,this.board.renderer.drawEllipse(i),this.board.renderer.enhancedRendering=t,this.traces[i.id]=i.rendNode,this},addTransform:function(t){var e,i=utils_type.A.isArray(t)?t:[t],r=i.length;for(e=0;e<r;e++)this.center.transformations.push(i[e]),"twoPoints"===this.method&&this.point2.transformations.push(i[e]);return this},snapToGrid:function(){var t=this.evalVisProp("snaptogrid");return this.center.handleSnapToGrid(t,!0),"twoPoints"===this.method&&this.point2.handleSnapToGrid(t,!0),this},snapToPoints:function(){var t=this.evalVisProp("snaptopoints");return this.center.handleSnapToPoints(t),"twoPoints"===this.method&&this.point2.handleSnapToPoints(t),this},X:function(t){return this.Radius()*Math.cos(2*t*Math.PI)+this.center.coords.usrCoords[1]},Y:function(t){return this.Radius()*Math.sin(2*t*Math.PI)+this.center.coords.usrCoords[2]},Z:function(t){return 1},minX:function(){return 0},maxX:function(){return 1},Area:function(){var t=this.Radius();return t*t*Math.PI},Perimeter:function(){return 2*this.Radius()*Math.PI},bounds:function(){var t=this.center.coords.usrCoords,e=this.Radius();return[t[1]-e,t[2]+e,t[1]+e,t[2]-e]},getParents:function(){return 1===this.parents.length?this.parents.concat(this.radius):this.parents}}),jxg.A.createCircle=function(t,e,i){var r,n,s,o,a,l=["center","point2"];if(n=[],a=t.select(e[0]),utils_type.A.isObject(a)&&a.elementClass===constants.A.OBJECT_CLASS_CIRCLE&&utils_type.A.isTransformationOrArray(e[1]))return o=utils_type.A.copyAttributes(i,t.options,"circle"),(r=jxg.A.createEllipse(t,[a.center,a.center,function(){return 2*a.Radius()}],o)).addTransform(e[1]),r;for(s=0;s<e.length;s++)if(utils_type.A.isPointType(t,e[s])){if(e.length<3?n.push(utils_type.A.providePoints(t,[e[s]],i,"circle",[l[s]])[0]):n.push(utils_type.A.providePoints(t,[e[s]],i,"point")[0]),!1===n[n.length-1])throw new Error("JSXGraph: Can't create circle from this type. Please provide a point type.")}else n.push(e[s]);if(o=utils_type.A.copyAttributes(i,t.options,"circle"),2===n.length&&utils_type.A.isPoint(n[0])&&utils_type.A.isPoint(n[1]))r=new jxg.A.Circle(t,"twoPoints",n[0],n[1],o);else if((utils_type.A.isNumber(n[0])||utils_type.A.isFunction(n[0])||utils_type.A.isString(n[0]))&&utils_type.A.isPoint(n[1]))r=new jxg.A.Circle(t,"pointRadius",n[1],n[0],o);else if((utils_type.A.isNumber(n[1])||utils_type.A.isFunction(n[1])||utils_type.A.isString(n[1]))&&utils_type.A.isPoint(n[0]))r=new jxg.A.Circle(t,"pointRadius",n[0],n[1],o);else if(n[0].elementClass===constants.A.OBJECT_CLASS_CIRCLE&&utils_type.A.isPoint(n[1]))r=new jxg.A.Circle(t,"pointCircle",n[1],n[0],o);else if(n[1].elementClass===constants.A.OBJECT_CLASS_CIRCLE&&utils_type.A.isPoint(n[0]))r=new jxg.A.Circle(t,"pointCircle",n[0],n[1],o);else if(n[0].elementClass===constants.A.OBJECT_CLASS_LINE&&utils_type.A.isPoint(n[1]))r=new jxg.A.Circle(t,"pointLine",n[1],n[0],o);else if(n[1].elementClass===constants.A.OBJECT_CLASS_LINE&&utils_type.A.isPoint(n[0]))r=new jxg.A.Circle(t,"pointLine",n[0],n[1],o);else{if(!(3===e.length&&utils_type.A.isPoint(n[0])&&utils_type.A.isPoint(n[1])&&utils_type.A.isPoint(n[2])))throw new Error("JSXGraph: Can't create circle with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [point,point], [point,number], [point,function], [point,circle], [point,point,point], [circle,transformation]");if(!jxg.A.elements.circumcircle)throw new Error("JSXGraph: Can't create circle with three points. Please include the circumcircle element (element/composition).");r=jxg.A.elements.circumcircle(t,n,o)}for(r.isDraggable=!0,r.setParents(n),r.elType="circle",s=0;s<n.length;s++)utils_type.A.isPoint(n[s])&&r.inherits.push(n[s]);return r},jxg.A.registerElement("circle",jxg.A.createCircle);const circle=jxg.A.Circle;jxg.A.createEllipse=function(t,e,i){var r,n,s,o,a,l,c,h=[],u=utils_type.A.copyAttributes(i,t.options,"conic","foci"),d=utils_type.A.copyAttributes(i,t.options,"conic","center"),p=utils_type.A.copyAttributes(i,t.options,"conic");for(l=0;l<2;l++)if(e[l].length>1)h[l]=t.create("point",e[l],u);else if(utils_type.A.isPoint(e[l]))h[l]=t.select(e[l]);else if(utils_type.A.isFunction(e[l])&&utils_type.A.isPoint(e[l]()))h[l]=e[l]();else{if(!utils_type.A.isString(e[l]))throw new Error("JSXGraph: Can't create Ellipse with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [point,point,point], [point,point,number|function]");h[l]=t.select(e[l])}if(utils_type.A.isNumber(e[2]))a=utils_type.A.createFunction(e[2],t);else if(utils_type.A.isFunction(e[2])&&utils_type.A.isNumber(e[2]()))a=e[2];else{if(utils_type.A.isPoint(e[2]))o=t.select(e[2]);else if(e[2].length>1)o=t.create("point",e[2],u);else if(utils_type.A.isFunction(e[2])&&utils_type.A.isPoint(e[2]()))o=e[2]();else{if(!utils_type.A.isString(e[2]))throw new Error("JSXGraph: Can't create Ellipse with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"' and '"+typeof e[2]+"'.\nPossible parent types: [point,point,point], [point,point,number|function]");o=t.select(e[2])}a=function(){return o.Dist(h[0])+o.Dist(h[1])}}for(utils_type.A.exists(e[4])||(e[4]=2*Math.PI),utils_type.A.exists(e[3])||(e[3]=0),s=t.create("point",[function(){return.5*(h[0].X()+h[1].X())},function(){return.5*(h[0].Y()+h[1].Y())}],d),(n=t.create("curve",[function(t){return 0},function(t){return 0},e[3],e[4]],p)).majorAxis=a,c=n.hasPoint,r=function(t,e){var i,r,s,o,l,c,u,d,p;e||(r=(i=a())*i,s=h[0].X(),o=h[0].Y(),u=s-(l=h[1].X()),d=o-(c=h[1].Y()),p=(r-s*s-o*o+l*l+c*c)/(2*i),n.quadraticform=[[p*p-l*l-c*c,p*u/i+l,p*d/i+c],[p*u/i+l,u*u/r-1,u*d/r],[p*d/i+c,u*d/r,d*d/r-1]])},n.X=function(t,e){var i=a(),n=h[1].Dist(h[0]),s=.5*(n*n-i*i)/(n*Math.cos(t)-i),o=Math.atan2(h[1].Y()-h[0].Y(),h[1].X()-h[0].X());return e||r(0,e),h[0].X()+Math.cos(o+t)*s},n.Y=function(t,e){var i=a(),r=h[1].Dist(h[0]),n=.5*(r*r-i*i)/(r*Math.cos(t)-i),s=Math.atan2(h[1].Y()-h[0].Y(),h[1].X()-h[0].X());return h[0].Y()+Math.sin(s+t)*n},n.midpoint=n.center=s,n.type=constants.A.OBJECT_TYPE_CONIC,n.subs={center:n.center},n.inherits.push(n.center,h[0],h[1]),utils_type.A.isPoint(o)&&n.inherits.push(o),n.hasPoint=function(t,e){var i,r,n,s;return this.evalVisProp("hasinnerpoints")?(i=h[0].coords,r=h[1].coords,n=this.majorAxis(),(s=new base_coords.A(constants.A.COORDS_BY_SCREEN,[t,e],this.board)).distance(constants.A.COORDS_BY_USER,i)+s.distance(constants.A.COORDS_BY_USER,r)<=n):c.apply(this,arguments)},s.addChild(n),l=0;l<2;l++)utils_type.A.isPoint(h[l])&&h[l].addChild(n);return utils_type.A.isPoint(o)&&o.addChild(n),n.setParents(e),n},jxg.A.createHyperbola=function(t,e,i){var r,n,s,o,a,l,c=[],h=utils_type.A.copyAttributes(i,t.options,"conic","foci"),u=utils_type.A.copyAttributes(i,t.options,"conic","center"),d=utils_type.A.copyAttributes(i,t.options,"conic");for(l=0;l<2;l++)if(e[l].length>1)c[l]=t.create("point",e[l],h);else if(utils_type.A.isPoint(e[l]))c[l]=t.select(e[l]);else if(utils_type.A.isFunction(e[l])&&utils_type.A.isPoint(e[l]()))c[l]=e[l]();else{if(!utils_type.A.isString(e[l]))throw new Error("JSXGraph: Can't create Hyperbola with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [point,point,point], [point,point,number|function]");c[l]=t.select(e[l])}if(utils_type.A.isNumber(e[2]))a=utils_type.A.createFunction(e[2],t);else if(utils_type.A.isFunction(e[2])&&utils_type.A.isNumber(e[2]()))a=e[2];else{if(utils_type.A.isPoint(e[2]))o=t.select(e[2]);else if(e[2].length>1)o=t.create("point",e[2],h);else if(utils_type.A.isFunction(e[2])&&utils_type.A.isPoint(e[2]()))o=e[2]();else{if(!utils_type.A.isString(e[2]))throw new Error("JSXGraph: Can't create Hyperbola with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"' and '"+typeof e[2]+"'.\nPossible parent types: [point,point,point], [point,point,number|function]");o=t.select(e[2])}a=function(){return o.Dist(c[0])-o.Dist(c[1])}}for(utils_type.A.exists(e[4])||(e[4]=1.0001*Math.PI),utils_type.A.exists(e[3])||(e[3]=-1.0001*Math.PI),s=t.create("point",[function(){return.5*(c[0].X()+c[1].X())},function(){return.5*(c[0].Y()+c[1].Y())}],u),(n=t.create("curve",[function(t){return 0},function(t){return 0},e[3],e[4]],d)).majorAxis=a,r=function(t,e){var i,r,s,o,l,h,u,d,p;e||(r=(i=a())*i,s=c[0].X(),o=c[0].Y(),u=s-(l=c[1].X()),d=o-(h=c[1].Y()),p=(r-s*s-o*o+l*l+h*h)/(2*i),n.quadraticform=[[p*p-l*l-h*h,p*u/i+l,p*d/i+h],[p*u/i+l,u*u/r-1,u*d/r],[p*d/i+h,u*d/r,d*d/r-1]])},n.X=function(t,e){var i=a(),n=c[1].Dist(c[0]),s=.5*(n*n-i*i)/(n*Math.cos(t)+i),o=Math.atan2(c[1].Y()-c[0].Y(),c[1].X()-c[0].X());return e||r(0,e),c[0].X()+Math.cos(o+t)*s},n.Y=function(t,e){var i=a(),r=c[1].Dist(c[0]),n=.5*(r*r-i*i)/(r*Math.cos(t)+i),s=Math.atan2(c[1].Y()-c[0].Y(),c[1].X()-c[0].X());return c[0].Y()+Math.sin(s+t)*n},n.midpoint=n.center=s,n.subs={center:n.center},n.inherits.push(n.center,c[0],c[1]),utils_type.A.isPoint(o)&&n.inherits.push(o),n.type=constants.A.OBJECT_TYPE_CONIC,s.addChild(n),l=0;l<2;l++)utils_type.A.isPoint(c[l])&&c[l].addChild(n);return utils_type.A.isPoint(o)&&o.addChild(n),n.setParents(e),n},jxg.A.createParabola=function(t,e,i){var r,n,s,o,a=e[0],l=e[1],c=utils_type.A.copyAttributes(i,t.options,"conic","foci"),h=utils_type.A.copyAttributes(i,t.options,"conic","center"),u=utils_type.A.copyAttributes(i,t.options,"conic");if(e[0].length>1)a=t.create("point",e[0],c);else if(utils_type.A.isPoint(e[0]))a=t.select(e[0]);else if(utils_type.A.isFunction(e[0])&&utils_type.A.isPoint(e[0]()))a=e[0]();else{if(!utils_type.A.isString(e[0]))throw new Error("JSXGraph: Can't create Parabola with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [point,line]");a=t.select(e[0])}return utils_type.A.isArray(l)&&2===l.length&&(o=utils_type.A.copyAttributes(i,t.options,"conic","line"),l=t.create("line",l,o)),utils_type.A.exists(e[3])||(e[3]=2*Math.PI),utils_type.A.exists(e[2])||(e[2]=0),s=t.create("point",[function(){return geometry.A.projectPointToLine(a,l,t).usrCoords}],h),(n=t.create("curve",[function(t){return 0},function(t){return 0},e[2],e[3]],u)).midpoint=n.center=s,n.subs={center:n.center},n.inherits.push(n.center),r=function(t,e){var i,r,s,o,c,h;e||(i=l.stdform[1],r=l.stdform[2],s=l.stdform[0],o=i*i+r*r,c=a.X(),h=a.Y(),n.quadraticform=[[s*s-o*(c*c+h*h),s*i+o*c,s*r+o*h],[s*i+o*c,-r*r,i*r],[s*r+o*h,i*r,-i*i]])},n.X=function(t,e){var i,n=l.getAngle(),s=geometry.A.distPointLine(a.coords.usrCoords,l.stdform),o=l.point1.coords.usrCoords,c=l.point2.coords.usrCoords,h=a.coords.usrCoords;return 0===o[0]?o=[1,c[1]+l.stdform[2],c[2]-l.stdform[1]]:0===c[0]&&(c=[1,o[1]+l.stdform[2],o[2]-l.stdform[1]]),i=((c[1]-o[1])*(h[2]-o[2])-(c[2]-o[2])*(h[1]-o[1])>=0?1:-1)*s/(1-Math.sin(t)),e||r(0,e),a.X()+Math.cos(t+n)*i},n.Y=function(t,e){var i,r=l.getAngle(),n=geometry.A.distPointLine(a.coords.usrCoords,l.stdform),s=l.point1.coords.usrCoords,o=l.point2.coords.usrCoords,c=a.coords.usrCoords;return 0===s[0]?s=[1,o[1]+l.stdform[2],o[2]-l.stdform[1]]:0===o[0]&&(o=[1,s[1]+l.stdform[2],s[2]-l.stdform[1]]),i=((o[1]-s[1])*(c[2]-s[2])-(o[2]-s[2])*(c[1]-s[1])>=0?1:-1)*n/(1-Math.sin(t)),a.Y()+Math.sin(t+r)*i},n.type=constants.A.OBJECT_TYPE_CONIC,s.addChild(n),utils_type.A.isPoint(a)&&(a.addChild(n),n.inherits.push(a)),l.addChild(n),n.setParents(e),n},jxg.A.createConic=function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p,f,m,g,_=[[1,0,0],[0,1,0],[0,0,1]],v=[[1,0,0],[0,1,0],[0,0,1]],y=[],b=[],A=utils_type.A.copyAttributes(i,t.options,"conic","point"),x=utils_type.A.copyAttributes(i,t.options,"conic","center"),C=utils_type.A.copyAttributes(i,t.options,"conic");if(5===e.length)g=!0;else{if(6!==e.length)throw new Error("JSXGraph: Can't create generic Conic with "+e.length+" parameters.");g=!1}if(g)for(f=0;f<5;f++)if(e[f].length>1)y[f]=t.create("point",e[f],A);else if(utils_type.A.isPoint(e[f]))y[f]=t.select(e[f]);else if(utils_type.A.isFunction(e[f])&&utils_type.A.isPoint(e[f]()))y[f]=e[f]();else{if(!utils_type.A.isString(e[f]))throw new Error("JSXGraph: Can't create Conic section with parent types '"+typeof e[f]+"'.\nPossible parent types: [point,point,point,point,point], [a00,a11,a22,a01,a02,a12]");y[f]=t.select(e[f])}else(m=[[0,0,0],[0,0,0],[0,0,0]])[0][0]=utils_type.A.isFunction(e[2])?function(){return e[2]()}:function(){return e[2]},m[0][1]=utils_type.A.isFunction(e[4])?function(){return e[4]()}:function(){return e[4]},m[0][2]=utils_type.A.isFunction(e[5])?function(){return e[5]()}:function(){return e[5]},m[1][1]=utils_type.A.isFunction(e[0])?function(){return e[0]()}:function(){return e[0]},m[1][2]=utils_type.A.isFunction(e[3])?function(){return e[3]()}:function(){return e[3]},m[2][2]=utils_type.A.isFunction(e[1])?function(){return e[1]()}:function(){return e[1]};if(a=function(t){var e,i;for(e=0;e<3;e++)for(i=e;i<3;i++)t[e][i]+=t[i][e];for(e=0;e<3;e++)for(i=0;i<e;i++)t[e][i]=t[i][e];return t},o=function(t,e){var i,r,n=[[0,0,0],[0,0,0],[0,0,0]];for(i=0;i<3;i++)for(r=0;r<3;r++)n[i][r]=t[i]*e[r];return a(n)},s=function(t,e,i){var r,n,s,o,a,l=[[0,0,0],[0,0,0],[0,0,0]];for(a=math.A.matVecMult(e,i),s=math.A.innerProduct(i,a),a=math.A.matVecMult(t,i),o=math.A.innerProduct(i,a),r=0;r<3;r++)for(n=0;n<3;n++)l[r][n]=s*t[r][n]-o*e[r][n];return l},n=t.create("curve",[function(t){return 0},function(t){return 0},0,2*Math.PI],C),r=function(t,e){var i,r,a;if(!e){if(g){for(i=0;i<5;i++)b[i]=y[i].coords.usrCoords;d=o(math.A.crossProduct(b[0],b[1]),math.A.crossProduct(b[2],b[3])),p=o(math.A.crossProduct(b[0],b[2]),math.A.crossProduct(b[1],b[3])),v=s(d,p,b[4])}else for(i=0;i<3;i++)for(r=i;r<3;r++)v[i][r]=m[i][r](),r>i&&(v[r][i]=v[i][r]);n.quadraticform=v,(l=numerics.A.Jacobi(v))[0][0][0]<0&&(l[0][0][0]*=-1,l[0][1][1]*=-1,l[0][2][2]*=-1),_=l[1],u=Math.sqrt(Math.abs(l[0][0][0])),c=Math.sqrt(Math.abs(l[0][1][1])),h=Math.sqrt(Math.abs(l[0][2][2]))}return l[0][1][1]<=0&&l[0][2][2]<=0?a=math.A.matVecMult(_,[1/u,Math.cos(t)/c,Math.sin(t)/h]):l[0][1][1]<=0&&l[0][2][2]>0?a=math.A.matVecMult(_,[Math.cos(t)/u,1/c,Math.sin(t)/h]):l[0][2][2]<0&&(a=math.A.matVecMult(_,[Math.sin(t)/u,Math.cos(t)/c,1/h])),utils_type.A.exists(a)?(a[1]/=a[0],a[2]/=a[0],a[0]=1):a=[1,NaN,NaN],a},n.X=function(t,e){return r(t,e)[1]},n.Y=function(t,e){return r(t,e)[2]},n.midpoint=t.create("point",[function(){var t=n.quadraticform;return[t[1][1]*t[2][2]-t[1][2]*t[1][2],t[1][2]*t[0][2]-t[2][2]*t[0][1],t[0][1]*t[1][2]-t[1][1]*t[0][2]]}],x),n.type=constants.A.OBJECT_TYPE_CONIC,n.center=n.midpoint,n.subs={center:n.center},n.inherits.push(n.center),n.inherits=n.inherits.concat(y),g){for(f=0;f<5;f++)utils_type.A.isPoint(y[f])&&y[f].addChild(n);n.setParents(e)}return n.addChild(n.center),n},jxg.A.registerElement("ellipse",jxg.A.createEllipse),jxg.A.registerElement("hyperbola",jxg.A.createHyperbola),jxg.A.registerElement("parabola",jxg.A.createParabola),jxg.A.registerElement("conic",jxg.A.createConic),jxg.A.Polygon=function(t,e,i){this.constructor(t,i,constants.A.OBJECT_TYPE_POLYGON,constants.A.OBJECT_CLASS_AREA);var r,n,s,o,a,l=utils_type.A.copyAttributes(i,t.options,"polygon","borders");for(this.withLines=i.withlines,this.attr_line=l,this.vertices=[],r=0;r<e.length;r++)this.vertices[r]=this.board.select(e[r]),this.vertices[r]._is_new&&(delete this.vertices[r]._is_new,this.vertices[r]._is_new_pol=!0);if(this.vertices.length>0&&this.vertices[this.vertices.length-1].id!==this.vertices[0].id&&this.vertices.push(this.vertices[0]),this.borders=[],this.withLines)for(s=this.vertices.length-1,o=0;o<s;o++)r=(o+1)%s,l.id=l.ids&&l.ids[r],l.name=l.names&&l.names[r],l.strokecolor=utils_type.A.isArray(l.colors)&&l.colors[r%l.colors.length]||l.strokecolor,l.visible=utils_type.A.exists(i.borders.visible)?i.borders.visible:i.visible,!1===l.strokecolor&&(l.strokecolor="none"),(n=t.create("segment",[this.vertices[r],this.vertices[r+1]],l)).dump=!1,this.borders[r]=n,n.parentPolygon=this,this.addChild(n);for(this.inherits.push(this.vertices,this.borders),this.id=this.board.setId(this,"Py"),r=0;r<this.vertices.length-1;r++)a=this.board.select(this.vertices[r]),utils_type.A.exists(a._is_new_pol)?(this.addChild(a),delete a._is_new_pol):a.addChild(this);this.board.renderer.drawPolygon(this),this.board.finalizeAdding(this),this.createGradient(),this.elType="polygon",this.createLabel(),this.methodMap=jxg.A.deepCopy(this.methodMap,{borders:"borders",vertices:"vertices",A:"Area",Area:"Area",Perimeter:"Perimeter",L:"Perimeter",boundingBox:"bounds",BoundingBox:"bounds",addPoints:"addPoints",insertPoints:"insertPoints",removePoints:"removePoints",Intersect:"intersect"})},jxg.A.Polygon.prototype=new base_element.A,jxg.A.extend(jxg.A.Polygon.prototype,{pnpoly:function(t,e,i){return geometry.A.pnpoly(t,e,this.vertices,i,this.board)},hasPoint:function(t,e){var i,r;if(this.evalVisProp("hasinnerpoints")&&this.pnpoly(t,e))return!0;for(r=this.borders.length,i=0;i<r;i++)if(this.borders[i].hasPoint(t,e))return!0;return!1},updateRenderer:function(){var t,e;if(!this.needsUpdate)return this;if(this.visPropCalc.visible){for(e=this.vertices.length-("polygonalchain"===this.elType?0:1),this.isReal=!0,t=0;t<e;++t)if(!this.vertices[t].isReal){this.isReal=!1;break}if(!this.isReal)for(t in this.updateVisibility(!1),this.childElements)this.childElements.hasOwnProperty(t)&&this.childElements[t].setDisplayRendNode(!1)}return this.visPropCalc.visible&&this.board.renderer.updatePolygon(this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this},getTextAnchor:function(){var t,e,i,r,n;if(0===this.vertices.length)return new base_coords.A(constants.A.COORDS_BY_USER,[1,0,0],this.board);for(i=t=this.vertices[0].X(),r=e=this.vertices[0].Y(),n=0;n<this.vertices.length;n++)this.vertices[n].X()<t&&(t=this.vertices[n].X()),this.vertices[n].X()>i&&(i=this.vertices[n].X()),this.vertices[n].Y()>e&&(e=this.vertices[n].Y()),this.vertices[n].Y()<r&&(r=this.vertices[n].Y());return new base_coords.A(constants.A.COORDS_BY_USER,[.5*(t+i),.5*(e+r)],this.board)},getLabelAnchor:jxg.A.shortcut(jxg.A.Polygon.prototype,"getTextAnchor"),cloneToBackground:function(){var t,e=utils_type.A.getCloneObject(this);return e.vertices=this.vertices,t=this.board.renderer.enhancedRendering,this.board.renderer.enhancedRendering=!0,this.board.renderer.drawPolygon(e),this.board.renderer.enhancedRendering=t,this.traces[e.id]=e.rendNode,this},hideElement:function(t){var e;if(jxg.A.deprecated("Element.hideElement()","Element.setDisplayRendNode()"),this.visPropCalc.visible=!1,this.board.renderer.display(this,!1),!t)for(e=0;e<this.borders.length;e++)this.borders[e].hideElement();this.hasLabel&&utils_type.A.exists(this.label)&&(this.label.hiddenByParent=!0,this.label.visPropCalc.visible&&this.label.hideElement())},showElement:function(t){var e;if(jxg.A.deprecated("Element.showElement()","Element.setDisplayRendNode()"),this.visPropCalc.visible=!0,this.board.renderer.display(this,!0),!t)for(e=0;e<this.borders.length;e++)this.borders[e].showElement().updateRenderer();return utils_type.A.exists(this.label)&&this.hasLabel&&this.label.hiddenByParent&&(this.label.hiddenByParent=!1,this.label.visPropCalc.visible||this.label.showElement().updateRenderer()),this},Area:function(){return Math.abs(geometry.A.signedPolygon(this.vertices,!0))},Perimeter:function(){var t,e=this.vertices.length,i=0;for(t=1;t<e;++t)i+=this.vertices[t].Dist(this.vertices[t-1]);return i},L:function(){return this.Perimeter()},boundingBox:function(){var t,e,i=[0,0,0,0],r=this.vertices.length-1;if(0===r)return i;for(i[0]=this.vertices[0].X(),i[2]=i[0],i[1]=this.vertices[0].Y(),i[3]=i[1],t=1;t<r;++t)(e=this.vertices[t].X())<i[0]?i[0]=e:e>i[2]&&(i[2]=e),(e=this.vertices[t].Y())>i[1]?i[1]=e:e<i[3]&&(i[3]=e);return i},bounds:function(){return this.boundingBox()},remove:function(){var t;for(t=0;t<this.borders.length;t++)this.board.removeObject(this.borders[t]);base_element.A.prototype.remove.call(this)},findPoint:function(t){var e;if(!utils_type.A.isPoint(t))return-1;for(e=0;e<this.vertices.length;e++)if(this.vertices[e].id===t.id)return e;return-1},addPoints:function(t){var e,i=Array.prototype.slice.call(arguments);return e="polygonalchain"===this.elType?this.vertices.length-1:this.vertices.length-2,this.insertPoints.apply(this,[e].concat(i))},insertPoints:function(t,e){var i,r,n,s,o;if(0===arguments.length)return this;if(n=this.vertices.length-1,"polygon"===this.elType&&n--,t<-1||t>n)return this;for(r=arguments.length-1,i=1;i<r+1;i++)(o=utils_type.A.providePoints(this.board,[arguments[i]],{},"polygon",["vertices"])[0])._is_new&&(this.addChild(o),delete o._is_new),this.vertices.splice(t+i,0,o);if(this.withLines)for(s=t+1,"polygon"===this.elType?t<0?(this.vertices[this.vertices.length-1]=this.vertices[0],this.borders[this.borders.length-1].point2=this.vertices[this.vertices.length-1]):this.borders[t].point2=this.vertices[s]:t>=0&&(t<this.borders.length?this.borders[t].point2=this.vertices[s]:s=t),i=s;i<s+r;i++)this.borders.splice(i,0,this.board.create("segment",[this.vertices[i],this.vertices[i+1]],this.attr_line));return this.inherits=[],this.inherits.push(this.vertices,this.borders),this.board.update(),this},removePoints:function(t){var e,i,r,n,s=[],o=[],a=[],l=[];for("polygon"===this.elType&&(n=this.vertices.pop()),e=0;e<arguments.length;e++)r=arguments[e],utils_type.A.isPoint(r)&&(r=this.findPoint(r)),utils_type.A.isNumber(r)&&r>-1&&r<this.vertices.length&&-1===utils_type.A.indexOf(a,r)&&a.push(r);if(0===a.length)return"polygon"===this.elType&&this.vertices.push(n),this;for(e=0;e<a.length;e++)this.vertices[a[e]].removeChild(this);for(a=a.sort(),s=this.vertices.slice(),o=this.borders.slice(),this.withLines&&l.push([a[a.length-1]]),e=a.length-1;e>-1;e--)s[a[e]]=-1,this.withLines&&a.length>1&&a[e]-1>a[e-1]&&(l[l.length-1][1]=a[e],l.push([a[e-1]]));for(this.withLines&&(l[l.length-1][1]=a[0]),this.vertices=[],e=0;e<s.length;e++)utils_type.A.isPoint(s[e])&&this.vertices.push(s[e]);if("polygon"===this.elType&&this.vertices.length>1&&this.vertices[this.vertices.length-1].id!==this.vertices[0].id&&this.vertices.push(this.vertices[0]),this.withLines){for(e=0;e<l.length;e++){for(i=l[e][1]-1;i<l[e][0]+1;i++)i<0?"polygon"===this.elType&&(this.board.removeObject(this.borders[o.length-1]),o[o.length-1]=-1):i<o.length&&(this.board.removeObject(this.borders[i]),o[i]=-1);0!==l[e][1]&&l[e][0]!==s.length-1&&(o[l[e][0]-1]=this.board.create("segment",[s[l[e][1]-1],s[l[e][0]+1]],this.attr_line))}for(this.borders=[],e=0;e<o.length;e++)-1!==o[e]&&this.borders.push(o[e]);"polygon"===this.elType&&this.vertices.length>2&&(l[0][1]===this.vertices.length-1||0===l[l.length-1][1])&&this.borders.push(this.board.create("segment",[this.vertices[this.vertices.length-2],this.vertices[0]],this.attr_line))}return this.inherits=[],this.inherits.push(this.vertices,this.borders),this.board.update(),this},getParents:function(){return this.setParents(this.vertices),this.parents},getAttributes:function(){var t,e=base_element.A.prototype.getAttributes.call(this);if(this.withLines)for(e.lines=e.lines||{},e.lines.ids=[],e.lines.colors=[],t=0;t<this.borders.length;t++)e.lines.ids.push(this.borders[t].id),e.lines.colors.push(this.borders[t].visProp.strokecolor);return e},snapToGrid:function(){var t,e;for(e=!!this.evalVisProp("snaptogrid"),t=0;t<this.vertices.length;t++)this.vertices[t].handleSnapToGrid(e,!0)},setPositionDirectly:function(t,e,i){var r,n,s,o=new base_coords.A(t,e,this.board),a=new base_coords.A(t,i,this.board);for(s=this.vertices.length-1,n=0;n<s;n++)if(!this.vertices[n].draggable())return this;return r=statistics.A.subtract(o.usrCoords,a.usrCoords),this.board.create("transform",r.slice(1),{type:"translate"}).applyOnce(this.vertices.slice(0,-1)),this},sutherlandHodgman:function(t){var e,i,r,n,s,o,a,l=jxg.A.Math.Geometry.sortVertices(this.vertices),c=jxg.A.Math.Geometry.sortVertices(t.vertices),h=l.length-1,u=c.length-1,d=[],p=function(t,e,i){return(e[1]-t[1])*(i[2]-t[2])-(e[2]-t[2])*(i[1]-t[1])>=0};for(r=0;r<u;r++)d.push(c[r]);for(r=0;r<h;r++)for(i=d.slice(0),d=[],s=i[(e=i.length)-1],n=0;n<e;n++)o=i[n],p(l[r],l[r+1],o)?(p(l[r],l[r+1],s)||((a=jxg.A.Math.Geometry.meetSegmentSegment(s,o,l[r],l[r+1]))[0][1]/=a[0][0],a[0][2]/=a[0][0],a[0][0]=1,d.push(a[0])),d.push(o)):p(l[r],l[r+1],s)&&((a=jxg.A.Math.Geometry.meetSegmentSegment(s,o,l[r],l[r+1]))[0][1]/=a[0][0],a[0][2]/=a[0][0],a[0][0]=1,d.push(a[0])),s=o;return d},intersect:function(t){return this.sutherlandHodgman(t)}}),jxg.A.createPolygon=function(t,e,i){var r,n,s,o,a,l,c=[],h=!1;if(utils_type.A.copyAttributes(i,t.options,"polygon"),null===(o=t.select(e[0]))&&(o=e[0]),utils_type.A.isObject(o)&&o.type===constants.A.OBJECT_TYPE_POLYGON&&utils_type.A.isTransformationOrArray(e[1]))for(h=!0,s=o.vertices.length-1,l=utils_type.A.copyAttributes(i,t.options,"polygon","vertices"),n=0;n<s;n++)l.withlabel&&(l.name=""===o.vertices[n].name?"":o.vertices[n].name+"'"),c.push(t.create("point",[o.vertices[n],e[1]],l));else if(!1===(c=utils_type.A.providePoints(t,e,i,"polygon",["vertices"])))throw new Error("JSXGraph: Can't create polygon / polygonalchain with parent types other than 'point' and 'coordinate arrays' or a function returning an array of coordinates. Alternatively, a polygon and a transformation can be supplied");if(a=utils_type.A.copyAttributes(i,t.options,"polygon"),(r=new jxg.A.Polygon(t,c,a)).isDraggable=!0,h)for(r.prepareUpdate().update().updateVisibility().updateRenderer(),s=o.vertices.length-1,n=0;n<s;n++)c[n].prepareUpdate().update().updateVisibility().updateRenderer();return r},jxg.A.createRegularPolygon=function(t,e,i){var r,n,s,o,a,l,c,h=[];if(s=e[(a=e.length)-1],utils_type.A.isNumber(s)&&(3!==e.length||s<3))throw new Error("JSXGraph: A regular polygon needs two point types and a number > 2 as input.");if(utils_type.A.isNumber(t.select(s))?(a--,l=!1):(s=a,l=!0),!1===(h=utils_type.A.providePoints(t,e.slice(0,a),i,"regularpolygon",["vertices"])))throw new Error("JSXGraph: Can't create regular polygon with parent types other than 'point' and 'coordinate arrays' or a function returning an array of coordinates");for(c=utils_type.A.copyAttributes(i,t.options,"regularpolygon","vertices"),n=2;n<s;n++)o=t.create("transform",[Math.PI*(2-(s-2)/s),h[n-1]],{type:"rotate"}),l?(h[n].addTransform(h[n-2],o),h[n].fullUpdate()):(utils_type.A.isArray(c.ids)&&c.ids.length>=s-2&&(c.id=c.ids[n-2]),h[n]=t.create("point",[h[n-2],o],c),h[n].type=constants.A.OBJECT_TYPE_CAS,h[n].isDraggable=!0,h[n].visProp.fixed=!1);return c=utils_type.A.copyAttributes(i,t.options,"regularpolygon"),(r=t.create("polygon",h,c)).elType="regularpolygon",r},jxg.A.createPolygonalChain=function(t,e,i){var r,n;return r=utils_type.A.copyAttributes(i,t.options,"polygonalchain"),(n=t.create("polygon",e,r)).elType="polygonalchain",n.vertices.pop(),t.removeObject(n.borders[n.borders.length-1]),n.borders.pop(),n},jxg.A.createParallelogram=function(t,e,i){var r,n,s,o,a;if(!1===(s=utils_type.A.providePoints(t,e,i,"polygon",["vertices"]))||s.length<3)throw new Error("JSXGraph: Can't create parallelogram with parent types other than 'point' and 'coordinate arrays' or a function returning an array of coordinates.");return a=utils_type.A.copyAttributes(i,t.options,"parallelogram","parallelpoint"),n=t.create("parallelpoint",s,a),o=utils_type.A.copyAttributes(i,t.options,"parallelogram"),(r=t.create("polygon",[s[0],s[1],n,s[2]],o)).elType="parallelogram",r.parallelPoint=n,r.isDraggable=!0,n.isDraggable=!0,n.visProp.fixed=!1,r},jxg.A.registerElement("polygon",jxg.A.createPolygon),jxg.A.registerElement("regularpolygon",jxg.A.createRegularPolygon),jxg.A.registerElement("polygonalchain",jxg.A.createPolygonalChain),jxg.A.registerElement("parallelogram",jxg.A.createParallelogram);const polygon=jxg.A.Polygon;jxg.A.Curve=function(t,e,i){this.constructor(t,i,constants.A.OBJECT_TYPE_CURVE,constants.A.OBJECT_CLASS_CURVE),this.points=[],this.numberPoints=this.evalVisProp("numberpointshigh"),this.bezierDegree=1,this.dataX=null,this.dataY=null,this.ticks=[],this.qdt=null,utils_type.A.exists(e[0])?this.varname=e[0]:this.varname="x",this.xterm=e[1],this.yterm=e[2],this.generateTerm(this.varname,this.xterm,this.yterm,e[3],e[4]),this.updateCurve(),this.id=this.board.setId(this,"G"),this.board.renderer.drawCurve(this),this.board.finalizeAdding(this),this.createGradient(),this.elType="curve",this.createLabel(),utils_type.A.isString(this.xterm)&&this.notifyParents(this.xterm),utils_type.A.isString(this.yterm)&&this.notifyParents(this.yterm),this.methodMap=utils_type.A.deepCopy(this.methodMap,{generateTerm:"generateTerm",setTerm:"generateTerm",move:"moveTo",moveTo:"moveTo",MinX:"minX",MaxX:"maxX"})},jxg.A.Curve.prototype=new base_element.A,jxg.A.extend(jxg.A.Curve.prototype,{minX:function(){return"polar"===this.evalVisProp("curvetype")?0:new base_coords.A(constants.A.COORDS_BY_SCREEN,[.1*-this.board.canvasWidth,0],this.board,!1).usrCoords[1]},maxX:function(){return"polar"===this.evalVisProp("curvetype")?2*Math.PI:new base_coords.A(constants.A.COORDS_BY_SCREEN,[1.1*this.board.canvasWidth,0],this.board,!1).usrCoords[1]},X:function(t){return NaN},Y:function(t){return NaN},Z:function(t){return 1},hasPoint:function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p,f,m,g,_,v,y=[],b=this.evalVisProp("numberpointslow"),A=(this.maxX()-this.minX())/b,x=1/0,C=!0;if(utils_type.A.isObject(this.evalVisProp("precision"))?(f=this.board._inputDevice,p=this.evalVisProp("precision."+f)):p=this.board.options.precision.hasPoint,t=(l=new base_coords.A(constants.A.COORDS_BY_SCREEN,[t,e],this.board,!1)).usrCoords[1],e=l.usrCoords[2],1===this.bezierDegree&&this.evalVisProp("hasinnerpoints")&&0!==geometry.A.windingNumber([1,t,e],this.points,!0))return!0;if(p+=.5*this.evalVisProp("strokewidth"),p*=p,m=this.board.unitX*this.board.unitX,g=this.board.unitY*this.board.unitY,v=this.minX(),this.maxX(),utils_type.A.exists(this._visibleArea)&&(v=this._visibleArea[0],A=(this._visibleArea[1]-v)/b),"parameter"===(_=this.evalVisProp("curvetype"))||"polar"===_)for(this.transformations.length>0&&(this.updateTransformMatrix(),h=math.A.inverse(this.transformMat),t=(n=math.A.matVecMult(h,[1,t,e]))[1],e=n[2]),s=0,r=v;s<b;s++){if((x=(t-(o=this.X(r,C)))*(t-o)*m+(e-(a=this.Y(r,C)))*(e-a)*g)<=p)return!0;r+=A}else if("plot"===_||"functiongraph"===_){for((!utils_type.A.exists(i)||i<0)&&(i=0),utils_type.A.exists(this.qdt)&&this.evalVisProp("useqdt")&&3!==this.bezierDegree?c=(u=(d=this.qdt.query(new base_coords.A(constants.A.COORDS_BY_USER,[t,e],this.board))).points).length:(u=this.points,c=this.numberPoints-1),s=i;s<c;s++)if(3===this.bezierDegree?y=geometry.A.projectCoordsToBeziersegment([1,t,e],this,s):d?(u[s].prev&&(y=geometry.A.projectCoordsToSegment([1,t,e],u[s].prev.usrCoords,u[s].usrCoords)),u[s].next&&u[s+1]!==u[s].next&&(y=geometry.A.projectCoordsToSegment([1,t,e],u[s].usrCoords,u[s].next.usrCoords))):y=geometry.A.projectCoordsToSegment([1,t,e],u[s].usrCoords,u[s+1].usrCoords),y[1]>=0&&y[1]<=1&&(t-y[0][1])*(t-y[0][1])*m+(e-y[0][2])*(e-y[0][2])*g<=p)return!0;return!1}return x<p},allocatePoints:function(){var t,e;if(e=this.numberPoints,this.points.length<this.numberPoints)for(t=this.points.length;t<e;t++)this.points[t]=new base_coords.A(constants.A.COORDS_BY_USER,[0,0],this.board,!1)},update:function(){return this.needsUpdate&&(this.evalVisProp("trace")&&this.cloneToBackground(!0),this.updateCurve()),this},updateRenderer:function(){return this.needsUpdate?(this.visPropCalc.visible&&(this.isReal=plot.checkReal(this.points),this.isReal||this.updateVisibility(!1)),this.visPropCalc.visible&&this.board.renderer.updateCurve(this),this.hasLabel&&this.visPropCalc.visible&&this.label&&this.label.visPropCalc.visible&&this.isReal&&(this.label.update(),this.board.renderer.updateText(this.label)),this.setDisplayRendNode(),this.needsUpdate=!1,this):this},updateDataArray:function(){},updateCurve:function(){var t,e,i,r,n,s,o=this.visProp.plotversion,a=!1;if(this.updateTransformMatrix(),this.updateDataArray(),i=this.minX(),r=this.maxX(),utils_type.A.exists(this.dataX))for(this.numberPoints=this.dataX.length,e=this.numberPoints,this.allocatePoints(),t=0;t<e;t++)n=t,utils_type.A.exists(this.dataY)?(s=t,this.points[t].setCoordinates(constants.A.COORDS_BY_USER,[this.dataX[t],this.dataY[t]],!1)):(s=this.X(n),this.points[t].setCoordinates(constants.A.COORDS_BY_USER,[this.dataX[t],this.Y(s,a)],!1)),this.points[t]._t=t,a=!0;else if(this.evalVisProp("doadvancedplot")?1===o||this.evalVisProp("doadvancedplotold")?plot.updateParametricCurveOld(this,i,r):2===o?plot.updateParametricCurve_v2(this,i,r):3===o?plot.updateParametricCurve_v3(this,i,r):4===o?plot.updateParametricCurve_v4(this,i,r):plot.updateParametricCurve_v2(this,i,r):(this.board.updateQuality===this.board.BOARD_QUALITY_HIGH?this.numberPoints=this.evalVisProp("numberpointshigh"):this.numberPoints=this.evalVisProp("numberpointslow"),this.allocatePoints(),plot.updateParametricCurveNaive(this,i,r,this.numberPoints)),e=this.numberPoints,this.evalVisProp("useqdt")&&this.board.updateQuality===this.board.BOARD_QUALITY_HIGH)for(this.qdt=new qdt(this.board.getBoundingBox()),t=0;t<this.points.length;t++)this.qdt.insert(this.points[t]),t>0&&(this.points[t].prev=this.points[t-1]),t<e-1&&(this.points[t].next=this.points[t+1]);for("plot"!==this.evalVisProp("curvetype")&&this.evalVisProp("rdpsmoothing")&&(this.points=numerics.A.RamerDouglasPeucker(this.points,.2),this.numberPoints=this.points.length),e=this.numberPoints,t=0;t<e;t++)this.updateTransform(this.points[t]);return this},updateTransformMatrix:function(){var t,e,i=this.transformations.length;for(this.transformMat=[[1,0,0],[0,1,0],[0,0,1]],e=0;e<i;e++)(t=this.transformations[e]).update(),this.transformMat=math.A.matMatMult(t.matrix,this.transformMat);return this},updateTransform:function(t){var e;return this.transformations.length>0&&(e=math.A.matVecMult(this.transformMat,t.usrCoords),t.setCoordinates(constants.A.COORDS_BY_USER,e,!1,!0)),t},addTransform:function(t){var e,i=utils_type.A.isArray(t)?t:[t],r=i.length;for(e=0;e<r;e++)this.transformations.push(i[e]);return this},interpolationFunctionFromArray:function(t){var e="data"+t,i=this;return function(t,r){var n,s,o,a,l=i[e],c=l.length,h=[];if(isNaN(t))return NaN;if(t<0)return utils_type.A.isFunction(l[0])?l[0]():l[0];if(3===i.bezierDegree){if(t>=(c-1)/3)return utils_type.A.isFunction(l[l.length-1])?l[l.length-1]():l[l.length-1];for(n=3*Math.floor(t),a=1-(o=t%1),s=0;s<4;s++)utils_type.A.isFunction(l[n+s])?h[s]=l[n+s]():h[s]=l[n+s];return a*a*(a*h[0]+3*o*h[1])+(3*a*h[2]+o*h[3])*o*o}if((n=t>c-2?c-2:parseInt(Math.floor(t),10))===t)return utils_type.A.isFunction(l[n])?l[n]():l[n];for(s=0;s<2;s++)utils_type.A.isFunction(l[n+s])?h[s]=l[n+s]():h[s]=l[n+s];return h[0]+(h[1]-h[0])*(t-n)}},generateTerm:function(t,e,i,r,n){var s,o,a;utils_type.A.isArray(e)?(this.dataX=e,this.numberPoints=this.dataX.length,this.X=this.interpolationFunctionFromArray.apply(this,["X"]),this.visProp.curvetype="plot",this.isDraggable=!0):(this.X=utils_type.A.createFunction(e,this.board,t),utils_type.A.isString(e)?this.visProp.curvetype="functiongraph":(utils_type.A.isFunction(e)||utils_type.A.isNumber(e))&&(this.visProp.curvetype="parameter"),this.isDraggable=!0),utils_type.A.isArray(i)?(this.dataY=i,this.Y=this.interpolationFunctionFromArray.apply(this,["Y"])):utils_type.A.exists(i)?this.Y=utils_type.A.createFunction(i,this.board,t):(a=math.A.transpose(e),this.dataX=a[0],this.dataY=a[1],this.numberPoints=this.dataX.length,this.Y=this.interpolationFunctionFromArray.apply(this,["Y"])),utils_type.A.isFunction(e)&&utils_type.A.isArray(i)&&(s=utils_type.A.createFunction(i[0],this.board,""),o=utils_type.A.createFunction(i[1],this.board,""),this.X=function(t){return e(t)*Math.cos(t)+s()},this.X.deps=s.deps,this.Y=function(t){return e(t)*Math.sin(t)+o()},this.Y.deps=o.deps,this.visProp.curvetype="polar"),utils_type.A.exists(r)?this.minX=utils_type.A.createFunction(r,this.board,""):delete this.minX,utils_type.A.exists(n)?this.maxX=utils_type.A.createFunction(n,this.board,""):delete this.maxX,this.addParentsFromJCFunctions([this.X,this.Y,this.minX,this.maxX])},notifyParents:function(t){var e,i,r,n=!1;for(e in r={xterm:1,yterm:1})if(r.hasOwnProperty(e)&&this.hasOwnProperty(e)&&this[e].origin)for(i in n=!0,this[e].origin.deps)this[e].origin.deps.hasOwnProperty(i)&&this[e].origin.deps[i].addChild(this);n||geonext.A.findDependencies(this,t,this.board)},getLabelPosition:function(t,e){var i,r,n,s,o,a,l,c,h,u,d=1.5;return n=utils_type.A.parsePosition(t),l=utils_type.A.parseNumber(n.pos,this.maxX()-this.minX(),1),n.pos.indexOf("fr")<0&&n.pos.indexOf("%")<0&&(l=0),c=this.minX()+l,i=this.X(c),r=this.Y(c),s=new base_coords.A(constants.A.COORDS_BY_USER,[i,r],this.board).scrCoords,a=math.A.eps,c<this.minX()+a?(h=(this.X(c+a)-this.X(c))/a,u=(this.Y(c+a)-this.Y(c))/a):c>this.maxX()-a?(h=(this.X(c)-this.X(c-a))/a,u=(this.Y(c)-this.Y(c-a))/a):(h=.5*(this.X(c+a)-this.X(c-a))/a,u=.5*(this.Y(c+a)-this.Y(c-a))/a),o=math.A.hypot(h,u),"left"===n.side?u*=-1:h*=-1,utils_type.A.exists(this.label)&&(d=.5*e/o),i=s[1]+u*this.label.size[0]*d,r=s[2]-h*this.label.size[1]*d,new base_coords.A(constants.A.COORDS_BY_SCREEN,[i,r],this.board)},getLabelAnchor:function(){var t,e,i,r,n=.05*this.board.canvasWidth,s=.05*this.board.canvasHeight,o=.95*this.board.canvasWidth,a=.95*this.board.canvasHeight;if(!utils_type.A.exists(this.label))return new base_coords.A(constants.A.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(i=this.label.evalVisProp("position"),!utils_type.A.isString(i))return new base_coords.A(constants.A.COORDS_BY_SCREEN,[NaN,NaN],this.board);if(!(i.indexOf("right")<0&&i.indexOf("left")<0))return this.getLabelPosition(i,this.label.evalVisProp("distance"));switch(this.evalVisProp("label.position")){case"ulft":t=n,e=s;break;case"llft":t=n,e=a;break;case"rt":t=o,e=.5*a;break;case"lrt":t=o,e=a;break;case"urt":t=o,e=s;break;case"top":t=.5*o,e=s;break;case"bot":t=.5*o,e=a;break;default:t=n,e=.5*a}return r=new base_coords.A(constants.A.COORDS_BY_SCREEN,[t,e],this.board,!1),geometry.A.projectCoordsToCurve(r.usrCoords[1],r.usrCoords[2],0,this,this.board)[0]},cloneToBackground:function(){var t,e=utils_type.A.getCloneObject(this);return e.points=this.points.slice(0),e.bezierDegree=this.bezierDegree,e.numberPoints=this.numberPoints,t=this.board.renderer.enhancedRendering,this.board.renderer.enhancedRendering=!0,this.board.renderer.drawCurve(e),this.board.renderer.enhancedRendering=t,this.traces[e.id]=e.rendNode,this},bounds:function(){var t,e,i,r=1/0,n=-1/0,s=1/0,o=-1/0,a=this.points.length;if(3===this.bezierDegree){for(t=0;t<a;t++)this.points[t].X=utils_type.A.bind((function(){return this.usrCoords[1]}),this.points[t]),this.points[t].Y=utils_type.A.bind((function(){return this.usrCoords[2]}),this.points[t]);return i=(e=numerics.A.bezier(this.points))[3](),r=numerics.A.fminbr((function(t){return e[0](t)}),[0,i]),n=numerics.A.fminbr((function(t){return-e[0](t)}),[0,i]),s=numerics.A.fminbr((function(t){return e[1](t)}),[0,i]),o=numerics.A.fminbr((function(t){return-e[1](t)}),[0,i]),r=e[0](r),n=e[0](n),s=e[1](s),[r,o=e[1](o),n,s]}for(t=0;t<a;t++)r>this.points[t].usrCoords[1]&&(r=this.points[t].usrCoords[1]),n<this.points[t].usrCoords[1]&&(n=this.points[t].usrCoords[1]),s>this.points[t].usrCoords[2]&&(s=this.points[t].usrCoords[2]),o<this.points[t].usrCoords[2]&&(o=this.points[t].usrCoords[2]);return[r,o,n,s]},getParents:function(){var t=[this.xterm,this.yterm,this.minX(),this.maxX()];return 0!==this.parents.length&&(t=this.parents),t},moveTo:function(t){var e,i=[];return this.points.length>0&&!this.evalVisProp("fixed")?(e=this.points[0],i=3===t.length?[t[0]-e.usrCoords[0],t[1]-e.usrCoords[1],t[2]-e.usrCoords[2]]:[t[0]-e.usrCoords[1],t[1]-e.usrCoords[2]],this.setPosition(constants.A.COORDS_BY_USER,i),this.board.update(this)):this},getTransformationSource:function(){var t,e;return utils_type.A.exists(this._transformationSource)&&(e=this._transformationSource).elementClass===constants.A.OBJECT_CLASS_CURVE&&(t=!0),[t,e]}}),jxg.A.createCurve=function(t,e,i){var r,n,s=utils_type.A.copyAttributes(i,t.options,"curve");return r=t.select(e[0],!0),utils_type.A.isTransformationOrArray(e[1])&&utils_type.A.isObject(r)&&(r.type===constants.A.OBJECT_TYPE_CURVE||r.type===constants.A.OBJECT_TYPE_ANGLE||r.type===constants.A.OBJECT_TYPE_ARC||r.type===constants.A.OBJECT_TYPE_CONIC||r.type===constants.A.OBJECT_TYPE_SECTOR)?(r.type===constants.A.OBJECT_TYPE_SECTOR?s=utils_type.A.copyAttributes(i,t.options,"sector"):r.type===constants.A.OBJECT_TYPE_ARC?s=utils_type.A.copyAttributes(i,t.options,"arc"):r.type===constants.A.OBJECT_TYPE_ANGLE?(utils_type.A.exists(i.withLabel)||(i.withLabel=!1),s=utils_type.A.copyAttributes(i,t.options,"angle")):s=utils_type.A.copyAttributes(i,t.options,"curve"),s=utils_type.A.copyAttributes(s,t.options,"curve"),(n=new jxg.A.Curve(t,["x",[],[]],s)).updateDataArray=function(){var t,e=r.numberPoints;for(this.bezierDegree=r.bezierDegree,this.dataX=[],this.dataY=[],t=0;t<e;t++)this.dataX.push(r.points[t].usrCoords[1]),this.dataY.push(r.points[t].usrCoords[2]);return this},n.addTransform(e[1]),r.addChild(n),n.setParents([r]),n._transformationSource=r,n):(s=utils_type.A.copyAttributes(i,t.options,"curve"),new jxg.A.Curve(t,["x"].concat(e),s))},jxg.A.registerElement("curve",jxg.A.createCurve),jxg.A.createFunctiongraph=function(t,e,i){var r,n=["x","x"].concat(e);return r=utils_type.A.copyAttributes(i,t.options,"functiongraph"),(r=utils_type.A.copyAttributes(r,t.options,"curve")).curvetype="functiongraph",new jxg.A.Curve(t,n,r)},jxg.A.registerElement("functiongraph",jxg.A.createFunctiongraph),jxg.A.registerElement("plot",jxg.A.createFunctiongraph),jxg.A.createSpline=function(t,e,i){var r,n,s;return n=function(){var t,i=[],r=[];return[function(n,s){var o,a,l;if(!s){if(i=[],r=[],2===e.length&&utils_type.A.isArray(e[0])&&utils_type.A.isArray(e[1])&&e[0].length===e[1].length)for(o=0;o<e[0].length;o++)utils_type.A.isFunction(e[0][o])?i.push(e[0][o]()):i.push(e[0][o]),utils_type.A.isFunction(e[1][o])?r.push(e[1][o]()):r.push(e[1][o]);else for(o=0;o<e.length;o++)if(utils_type.A.isPoint(e[o]))i.push(e[o].X()),r.push(e[o].Y());else if(utils_type.A.isArray(e[o])&&2===e[o].length)for(a=0;a<e.length;a++)utils_type.A.isFunction(e[a][0])?i.push(e[a][0]()):i.push(e[a][0]),utils_type.A.isFunction(e[a][1])?r.push(e[a][1]()):r.push(e[a][1]);else utils_type.A.isFunction(e[o])&&2===e[o]().length&&(l=e[o](),i.push(l[0]),r.push(l[1]));t=numerics.A.splineDef(i,r)}return numerics.A.splineEval(n,i,r,t)},function(){return i[0]},function(){return i[i.length-1]}]},(i=utils_type.A.copyAttributes(i,t.options,"curve")).curvetype="functiongraph",s=n(),(r=new jxg.A.Curve(t,["x","x",s[0],s[1],s[2]],i)).setParents(e),r.elType="spline",r},jxg.A.registerElement("spline",jxg.A.createSpline),jxg.A.createCardinalSpline=function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p="\nPossible parent types: [points:array, tau:number|function, type:string]";if(!utils_type.A.exists(e[0])||!utils_type.A.isArray(e[0]))throw new Error("JSXGraph: JXG.createCardinalSpline: argument 1 'points' has to be array of points or coordinate pairs"+p);if(!utils_type.A.exists(e[1])||!utils_type.A.isNumber(e[1])&&!utils_type.A.isFunction(e[1]))throw new Error("JSXGraph: JXG.createCardinalSpline: argument 2 'tau' has to be number between [0,1] or function'"+p);if(a=utils_type.A.exists(e[2])&&utils_type.A.isString(e[2])?e[2]:"uniform",i=utils_type.A.copyAttributes(i,t.options,"curve"),(i=utils_type.A.copyAttributes(i,t.options,"cardinalspline")).curvetype="parameter",l=e[0],c=[],!i.isarrayofcoordinates&&2===l.length&&utils_type.A.isArray(l[0])&&utils_type.A.isArray(l[1])&&l[0].length===l[1].length)for(h=0;h<l[0].length;h++)c[h]=[],utils_type.A.isFunction(l[0][h])?c[h].push(l[0][h]()):c[h].push(l[0][h]),utils_type.A.isFunction(l[1][h])?c[h].push(l[1][h]()):c[h].push(l[1][h]);else for(h=0;h<l.length;h++)utils_type.A.isString(l[h])?c.push(t.select(l[h])):utils_type.A.isPoint(l[h])?c.push(l[h]):utils_type.A.isArray(l[h])&&2===l[h].length?(c[h]=[],utils_type.A.isFunction(l[h][0])?c[h].push(l[h][0]()):c[h].push(l[h][0]),utils_type.A.isFunction(l[h][1])?c[h].push(l[h][1]()):c[h].push(l[h][1])):utils_type.A.isFunction(l[h])&&2===l[h]().length&&c.push(e[h]());if(!0===i.createpoints)s=utils_type.A.providePoints(t,c,i,"cardinalspline",["points"]);else for(s=[],n=function(t){return{X:function(){return c[t][0]},Y:function(){return c[t][1]},Dist:function(t){var e=this.X()-t.X(),i=this.Y()-t.Y();return math.A.hypot(e,i)}}},h=0;h<c.length;h++)utils_type.A.isPoint(c[h])?s.push(c[h]):s.push(n(h));for(o=e[1],d=["x"].concat(numerics.A.CardinalSpline(s,o,a)),r=new jxg.A.Curve(t,d,i),u=s.length,r.setParents(s),h=0;h<u;h++)l=s[h],utils_type.A.isPoint(l)&&(utils_type.A.exists(l._is_new)?(r.addChild(l),delete l._is_new):l.addChild(r));return r.elType="cardinalspline",r},jxg.A.registerElement("cardinalspline",jxg.A.createCardinalSpline),jxg.A.createMetapostSpline=function(t,e,i){var r,n,s,o,a,l,c,h,u="\nPossible parent types: [points:array, controls:object";if(!utils_type.A.exists(e[0])||!utils_type.A.isArray(e[0]))throw new Error("JSXGraph: JXG.createMetapostSpline: argument 1 'points' has to be array of points or coordinate pairs"+u);if(!utils_type.A.exists(e[1])||!utils_type.A.isObject(e[1]))throw new Error("JSXGraph: JXG.createMetapostSpline: argument 2 'controls' has to be a JavaScript object'"+u);if(i=utils_type.A.copyAttributes(i,t.options,"curve"),(i=utils_type.A.copyAttributes(i,t.options,"metapostspline")).curvetype="parameter",a=e[0],l=[],!i.isarrayofcoordinates&&2===a.length&&utils_type.A.isArray(a[0])&&utils_type.A.isArray(a[1])&&a[0].length===a[1].length)for(c=0;c<a[0].length;c++)l[c]=[],utils_type.A.isFunction(a[0][c])?l[c].push(a[0][c]()):l[c].push(a[0][c]),utils_type.A.isFunction(a[1][c])?l[c].push(a[1][c]()):l[c].push(a[1][c]);else for(c=0;c<a.length;c++)utils_type.A.isString(a[c])?l.push(t.select(a[c])):utils_type.A.isPoint(a[c])?l.push(a[c]):utils_type.A.isArray(a[c])&&2===a[c].length?(l[c]=[],utils_type.A.isFunction(a[c][0])?l[c].push(a[c][0]()):l[c].push(a[c][0]),utils_type.A.isFunction(a[c][1])?l[c].push(a[c][1]()):l[c].push(a[c][1])):utils_type.A.isFunction(a[c])&&2===a[c]().length&&l.push(e[c]());if(!0===i.createpoints)s=utils_type.A.providePoints(t,l,i,"metapostspline",["points"]);else for(s=[],n=function(t){return{X:function(){return l[t][0]},Y:function(){return l[t][1]}}},c=0;c<l.length;c++)utils_type.A.isPoint(l[c])?s.push(l[c]):s.push(n);for(o=e[1],(r=new jxg.A.Curve(t,["t",[],[],0,a.length-1],i)).updateDataArray=function(){var t,e,i=s.length,r=[];for(e=0;e<i;e++)r.push([s[e].X(),s[e].Y()]);t=metapost.curve(r,o),this.dataX=t[0],this.dataY=t[1]},r.bezierDegree=3,h=s.length,r.setParents(s),c=0;c<h;c++)utils_type.A.isPoint(s[c])&&s[c].addChild(r);return r.elType="metapostspline",r},jxg.A.registerElement("metapostspline",jxg.A.createMetapostSpline),jxg.A.createRiemannsum=function(t,e,i){var r,n,s,o,a,l;if((l=utils_type.A.copyAttributes(i,t.options,"riemannsum")).curvetype="plot",s=e[0],r=utils_type.A.createFunction(e[1],t,""),!utils_type.A.exists(r))throw new Error("JSXGraph: JXG.createRiemannsum: argument '2' n has to be number or function.\nPossible parent types: [function,n:number|function,type,start:number|function,end:number|function]");if("string"==typeof e[2]&&(e[2]="'"+e[2]+"'"),n=utils_type.A.createFunction(e[2],t,""),!utils_type.A.exists(n))throw new Error("JSXGraph: JXG.createRiemannsum: argument 3 'type' has to be string or function.\nPossible parent types: [function,n:number|function,type,start:number|function,end:number|function]");return o=[[0],[0]].concat(e.slice(3)),(a=t.create("curve",o,l)).sum=0,a.Value=function(){return this.sum},a.updateDataArray=function(){var t=numerics.A.riemann(s,r(),n(),this.minX(),this.maxX());this.dataX=t[0],this.dataY=t[1],this.sum=t[2]},a.addParentsFromJCFunctions([r,n]),a},jxg.A.registerElement("riemannsum",jxg.A.createRiemannsum),jxg.A.createTracecurve=function(t,e,i){var r,n,s,o;if(2!==e.length)throw new Error("JSXGraph: Can't create trace curve with given parent'\nPossible parent types: [glider, point]");if(n=t.select(e[0]),s=t.select(e[1]),n.type!==constants.A.OBJECT_TYPE_GLIDER||!utils_type.A.isPoint(s))throw new Error("JSXGraph: Can't create trace curve with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [glider, point]");return(o=utils_type.A.copyAttributes(i,t.options,"tracecurve")).curvetype="plot",(r=t.create("curve",[[0],[0]],o)).updateDataArray=function(){var t,e,i,r,o,a,l,c,h,u=this.visProp.numberpoints,d=n.position,p=n.slideObject,f=p.minX();for(e=(p.maxX()-f)/u,this.dataX=[],this.dataY=[],p.elementClass!==constants.A.OBJECT_CLASS_CURVE&&u++,t=0;t<u;t++){for(r in i=f+t*e,a=p.X(i)/p.Z(i),l=p.Y(i)/p.Z(i),n.setPositionDirectly(constants.A.COORDS_BY_USER,[a,l]),c=!1,this.board.objects)if(this.board.objects.hasOwnProperty(r)&&((o=this.board.objects[r])===n&&(c=!0),c&&o.needsRegularUpdate&&(h=o.visProp.trace,o.visProp.trace=!1,o.needsUpdate=!0,o.update(!0),o.visProp.trace=h,o===s)))break;this.dataX[t]=s.X(),this.dataY[t]=s.Y()}for(r in n.position=d,c=!1,this.board.objects)if(this.board.objects.hasOwnProperty(r)&&((o=this.board.objects[r])===n&&(c=!0),c&&o.needsRegularUpdate&&(h=o.visProp.trace,o.visProp.trace=!1,o.needsUpdate=!0,o.update(!0),o.visProp.trace=h,o===s)))break},r},jxg.A.registerElement("tracecurve",jxg.A.createTracecurve),jxg.A.createStepfunction=function(t,e,i){var r,n;if(2!==e.length)throw new Error("JSXGraph: Can't create step function with given parent'\nPossible parent types: [array, array|function]");return n=utils_type.A.copyAttributes(i,t.options,"stepfunction"),(r=t.create("curve",e,n)).updateDataArray=function(){var t,e=0,i=this.xterm.length;if(this.dataX=[],this.dataY=[],0!==i)for(this.dataX[e]=this.xterm[0],this.dataY[e]=this.yterm[0],++e,t=1;t<i;++t)this.dataX[e]=this.xterm[t],this.dataY[e]=this.dataY[e-1],++e,this.dataX[e]=this.xterm[t],this.dataY[e]=this.yterm[t],++e},r},jxg.A.registerElement("stepfunction",jxg.A.createStepfunction),jxg.A.createDerivative=function(t,e,i){var r,n,s,o,a;if(1!==e.length&&e[0].class!==constants.A.OBJECT_CLASS_CURVE)throw new Error("JSXGraph: Can't create derivative curve with given parent'\nPossible parent types: [curve]");return a=utils_type.A.copyAttributes(i,t.options,"curve"),n=e[0],s=numerics.A.D(n.X),o=numerics.A.D(n.Y),(r=t.create("curve",[function(t){return n.X(t)},function(t){return o(t)/s(t)},n.minX(),n.maxX()],a)).setParents(n),r},jxg.A.registerElement("derivative",jxg.A.createDerivative),jxg.A.createCurveIntersection=function(t,e,i){var r;if(2!==e.length)throw new Error("JSXGraph: Can't create curve intersection with given parent'\nPossible parent types: [array, array|function]");return(r=t.create("curve",[[],[]],i)).updateDataArray=function(){var t=clip.intersection(e[0],e[1],this.board);this.dataX=t[0],this.dataY=t[1]},r},jxg.A.createCurveUnion=function(t,e,i){var r;if(2!==e.length)throw new Error("JSXGraph: Can't create curve union with given parent'\nPossible parent types: [array, array|function]");return(r=t.create("curve",[[],[]],i)).updateDataArray=function(){var t=clip.union(e[0],e[1],this.board);this.dataX=t[0],this.dataY=t[1]},r},jxg.A.createCurveDifference=function(t,e,i){var r;if(2!==e.length)throw new Error("JSXGraph: Can't create curve difference with given parent'\nPossible parent types: [array, array|function]");return(r=t.create("curve",[[],[]],i)).updateDataArray=function(){var t=clip.difference(e[0],e[1],this.board);this.dataX=t[0],this.dataY=t[1]},r},jxg.A.registerElement("curvedifference",jxg.A.createCurveDifference),jxg.A.registerElement("curveintersection",jxg.A.createCurveIntersection),jxg.A.registerElement("curveunion",jxg.A.createCurveUnion),jxg.A.createBoxPlot=function(t,e,i){var r,n,s,o=utils_type.A.copyAttributes(i,t.options,"boxplot");if(3!==e.length)throw new Error("JSXGraph: Can't create box plot with given parent'\nPossible parent types: [array, number|function, number|function] containing quantiles, axis, width");if(e[0].length<5)throw new Error("JSXGraph: Can't create box plot with given parent[0]'\nparent[0] has to contain at least 5 quantiles.");for(r=t.create("curve",[[],[]],o),s=e[0].length,r.Q=[],n=0;n<s;n++)r.Q[n]=utils_type.A.createFunction(e[0][n],t);return r.x=utils_type.A.createFunction(e[1],t),r.w=utils_type.A.createFunction(e[2],t),r.updateDataArray=function(){var t,e,i,r,n,s,o,a,l;o=this.evalVisProp("smallwidth"),a=this.evalVisProp("dir"),i=(l=this.x())-.5*this.w(),r=l-.5*this.w()*o,n=l+.5*this.w(),t=[l,r,s=l+.5*this.w()*o,l,l,i,i,n,n,l,NaN,i,n,NaN,l,l,r,s,l],e=[this.Q[0](),this.Q[0](),this.Q[0](),this.Q[0](),this.Q[1](),this.Q[1](),this.Q[3](),this.Q[3](),this.Q[1](),this.Q[1](),NaN,this.Q[2](),this.Q[2](),NaN,this.Q[3](),this.Q[4](),this.Q[4](),this.Q[4](),this.Q[4]()],"vertical"===a?(this.dataX=t,this.dataY=e):(this.dataX=e,this.dataY=t)},r.addParentsFromJCFunctions([r.Q,r.x,r.w]),r},jxg.A.registerElement("boxplot",jxg.A.createBoxPlot),jxg.A.createImplicitCurve=function(t,e,i){var r,n;if([1,3,5].indexOf(e.length)<0)throw new Error("JSXGraph: Can't create curve implicitCurve with given parent'\nPossible parent types: [f], [f, rangex, rangey], [f, dfx, dfy] or [f, dfx, dfy, rangex, rangey]\nwith functions f, dfx, dfy and arrays of length 2 rangex, rangey.");return n=utils_type.A.copyAttributes(i,t.options,"implicitcurve"),(r=t.create("curve",[[],[]],n)).f=utils_type.A.createFunction(e[0],t,"x, y"),5===e.length||utils_type.A.isString(e[1])||utils_type.A.isFunction(e[1])?r.dfx=utils_type.A.createFunction(e[1],t,"x, y"):r.dfx=null,5===e.length||utils_type.A.isString(e[2])||utils_type.A.isFunction(e[2])?r.dfy=utils_type.A.createFunction(e[2],t,"x, y"):r.dfy=null,r.domain=null,5===e.length?r.domain=[e[3],e[4]]:3===e.length&&(r.domain=[e[1],e[2]]),r.updateDataArray=function(){var t,e,i,r,n,s,o;null===this.domain?(o=this.evalVisProp("margin"),(t=this.board.getBoundingBox())[0]-=o,t[1]+=o,t[2]+=o,t[3]-=o):(e=utils_type.A.evaluate(this.domain[0]),i=utils_type.A.evaluate(this.domain[1]),t=[e[0],i[1],e[1],i[0]]),n={resolution_out:Math.max(.01,this.evalVisProp("resolution_outer")),resolution_in:Math.max(.01,this.evalVisProp("resolution_inner")),max_steps:this.evalVisProp("max_steps"),alpha_0:this.evalVisProp("alpha_0"),tol_u0:this.evalVisProp("tol_u0"),tol_newton:this.evalVisProp("tol_newton"),tol_cusp:this.evalVisProp("tol_cusp"),tol_progress:this.evalVisProp("tol_progress"),qdt_box:this.evalVisProp("qdt_box"),kappa_0:this.evalVisProp("kappa_0"),delta_0:this.evalVisProp("delta_0"),h_initial:this.evalVisProp("h_initial"),h_critical:this.evalVisProp("h_critical"),h_max:this.evalVisProp("h_max"),loop_dist:this.evalVisProp("loop_dist"),loop_dir:this.evalVisProp("loop_dir"),loop_detection:this.evalVisProp("loop_detection"),unitX:this.board.unitX,unitY:this.board.unitY},this.dataX=[],this.dataY=[],r=new implicitplot(t,n,this.f,this.dfx,this.dfy),this.qdt=r.qdt,s=r.plot(),this.dataX=s[0],this.dataY=s[1]},r.elType="implicitcurve",r},jxg.A.registerElement("implicitcurve",jxg.A.createImplicitCurve);const curve=jxg.A.Curve;jxg.A.createArc=function(t,e,i){var r,n,s;if(!1===(s=utils_type.A.providePoints(t,e,i,"arc",["center","radiuspoint","anglepoint"]))||s.length<3)throw new Error("JSXGraph: Can't create Arc with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"' and '"+typeof e[2]+"'.\nPossible parent types: [point,point,point], [arc, transformation]");return n=utils_type.A.copyAttributes(i,t.options,"arc"),(r=t.create("curve",[[0],[0],0,4],n)).elType="arc",r.setParents(s),r.type=constants.A.OBJECT_TYPE_ARC,r.center=s[0],r.radiuspoint=s[1],r.point2=r.radiuspoint,r.anglepoint=s[2],r.point3=r.anglepoint,utils_type.A.exists(r.center._is_new)?(r.addChild(r.center),delete r.center._is_new):r.center.addChild(r),utils_type.A.exists(r.radiuspoint._is_new)?(r.addChild(r.radiuspoint),delete r.radiuspoint._is_new):r.radiuspoint.addChild(r),utils_type.A.exists(r.anglepoint._is_new)?(r.addChild(r.anglepoint),delete r.anglepoint._is_new):r.anglepoint.addChild(r),r.useDirection=n.usedirection,r.updateDataArray=function(){var t,e,i,r,n,o=1,a=this.radiuspoint,l=this.center,c=this.anglepoint,h=this.evalVisProp("selection");e=geometry.A.rad(a,l,c),("minor"===h&&e>Math.PI||"major"===h&&e<Math.PI)&&(o=-1),this.useDirection&&(i=s[1].coords.usrCoords,r=s[3].coords.usrCoords,n=s[2].coords.usrCoords,(i[1]-n[1])*(i[2]-r[2])-(i[2]-n[2])*(i[1]-r[1])<0?(this.radiuspoint=s[1],this.anglepoint=s[2]):(this.radiuspoint=s[2],this.anglepoint=s[1])),a=a.coords.usrCoords,l=l.coords.usrCoords,c=c.coords.usrCoords,t=geometry.A.bezierArc(a,l,c,!1,o),this.dataX=t[0],this.dataY=t[1],this.bezierDegree=3,this.updateStdform(),this.updateQuadraticform()},r.Radius=function(){return this.radiuspoint.Dist(this.center)},r.getRadius=function(){return jxg.A.deprecated("Arc.getRadius()","Arc.Radius()"),this.Radius()},r.Value=function(t,e){var i;return e=e||geometry.A.rad(this.radiuspoint,this.center,this.anglepoint),""===(t=(t=t||"length").toLocaleLowerCase())||0===t.indexOf("len")?i=e*this.Radius():0===t.indexOf("rad")?i=e:0===t.indexOf("deg")?i=180*e/Math.PI:0===t.indexOf("sem")?i=e/Math.PI:0===t.indexOf("cir")&&(i=.5*e/Math.PI),i},r.L=function(){return this.Value("length")},r.hasPoint=function(t,e){var i,r,n,s,o,a,l,c=this.Radius();return this.evalVisProp("hasinnerpoints")?this.hasPointSector(t,e):(utils_type.A.isObject(this.evalVisProp("precision"))?(l=this.board._inputDevice,a=this.evalVisProp("precision."+l)):a=this.board.options.precision.hasPoint,a/=Math.min(Math.abs(this.board.unitX),Math.abs(this.board.unitY)),r=new base_coords.A(constants.A.COORDS_BY_SCREEN,[t,e],this.board),this.transformations.length>0&&(this.updateTransformMatrix(),s=math.A.inverse(this.transformMat),o=math.A.matVecMult(s,r.usrCoords),r=new base_coords.A(constants.A.COORDS_BY_USER,o,this.board)),i=this.center.coords.distance(constants.A.COORDS_BY_USER,r),(n=Math.abs(i-c)<a)&&(n=geometry.A.coordsOnArc(this,r)),n)},r.hasPointSector=function(t,e){var i=new base_coords.A(constants.A.COORDS_BY_SCREEN,[t,e],this.board),r=this.Radius(),n=this.center.coords.distance(constants.A.COORDS_BY_USER,i)<r;return n&&(n=geometry.A.coordsOnArc(this,i)),n},r.getTextAnchor=function(){return this.center.coords},r.getLabelAnchor=function(){var t,e,i,r,n,s=this.label.evalVisProp("position"),o=geometry.A.rad(this.radiuspoint,this.center,this.anglepoint),a=10/this.board.unitX,l=10/this.board.unitY,c=this.point2.coords.usrCoords,h=this.center.coords.usrCoords,u=c[1]-h[1],d=c[2]-h[2],p=this.evalVisProp("selection"),f=this.label?this.label.visProp:this.visProp.label;return!utils_type.A.isString(s)||s.indexOf("right")<0&&s.indexOf("left")<0?(("minor"===p&&o>Math.PI||"major"===p&&o<Math.PI)&&(o=-(2*Math.PI-o)),i=(t=new base_coords.A(constants.A.COORDS_BY_USER,[h[1]+Math.cos(.5*o)*u-Math.sin(.5*o)*d,h[2]+Math.sin(.5*o)*u+Math.cos(.5*o)*d],this.board)).usrCoords[1]-h[1],r=t.usrCoords[2]-h[2],i=i*((n=math.A.hypot(i,r))+a)/n,r=r*(n+l)/n,e=[h[1]+i,h[2]+r],f.position=geometry.A.calcLabelQuadrant(geometry.A.rad([1,0],[0,0],e)),new base_coords.A(constants.A.COORDS_BY_USER,e,this.board)):this.getLabelPosition(s,this.label.evalVisProp("distance"))},r.updateQuadraticform=circle.prototype.updateQuadraticform,r.updateStdform=circle.prototype.updateStdform,r.methodMap=jxg.A.deepCopy(r.methodMap,{getRadius:"getRadius",radius:"Radius",Radius:"Radius",center:"center",radiuspoint:"radiuspoint",anglepoint:"anglepoint",Value:"Value",L:"L"}),r.prepareUpdate().update(),r},jxg.A.registerElement("arc",jxg.A.createArc),jxg.A.createSemicircle=function(t,e,i){var r,n,s,o;if(!1===(o=utils_type.A.providePoints(t,e,i,"point"))||2!==o.length)throw new Error("JSXGraph: Can't create Semicircle with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [point,point]");return s=utils_type.A.copyAttributes(i,t.options,"semicircle","center"),(n=t.create("midpoint",o,s)).dump=!1,s=utils_type.A.copyAttributes(i,t.options,"semicircle"),(r=t.create("arc",[n,o[1],o[0]],s)).elType="semicircle",r.setParents([o[0].id,o[1].id]),r.subs={midpoint:n},r.inherits.push(n),r.midpoint=r.center=n,r},jxg.A.registerElement("semicircle",jxg.A.createSemicircle),jxg.A.createCircumcircleArc=function(t,e,i){var r,n,s,o;if(!1===(o=utils_type.A.providePoints(t,e,i,"point"))||3!==o.length)throw new Error("JSXGraph: create Circumcircle Arc with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"' and '"+typeof e[2]+"'.\nPossible parent types: [point,point,point]");return s=utils_type.A.copyAttributes(i,t.options,"circumcirclearc","center"),(n=t.create("circumcenter",o,s)).dump=!1,(s=utils_type.A.copyAttributes(i,t.options,"circumcirclearc")).usedirection=!0,(r=t.create("arc",[n,o[0],o[2],o[1]],s)).elType="circumcirclearc",r.setParents([o[0].id,o[1].id,o[2].id]),r.subs={center:n},r.inherits.push(n),r.center=n,r},jxg.A.registerElement("circumcirclearc",jxg.A.createCircumcircleArc),jxg.A.createMinorArc=function(t,e,i){return i.selection="minor",jxg.A.createArc(t,e,i)},jxg.A.registerElement("minorarc",jxg.A.createMinorArc),jxg.A.createMajorArc=function(t,e,i){return i.selection="major",jxg.A.createArc(t,e,i)},jxg.A.registerElement("majorarc",jxg.A.createMajorArc),jxg.A.createSector=function(t,e,i){var r,n,s,o,a,l,c=1e-14,h="invalid";if(e[0].elementClass===constants.A.OBJECT_CLASS_LINE&&e[1].elementClass===constants.A.OBJECT_CLASS_LINE&&(utils_type.A.isArray(e[2])||utils_type.A.isNumber(e[2]))&&(utils_type.A.isArray(e[3])||utils_type.A.isNumber(e[3]))&&(utils_type.A.isNumber(e[4])||utils_type.A.isFunction(e[4])||utils_type.A.isString(e[4])))h="2lines";else{if(!1===(l=utils_type.A.providePoints(t,e,i,"sector",["center","radiusPoint","anglePoint"])))throw new Error("JSXGraph: Can't create Sector with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"' and '"+typeof e[2]+"'.");h="3points"}if(n=utils_type.A.copyAttributes(i,t.options,"sector"),(r=t.create("curve",[[0],[0],0,6],n)).type=constants.A.OBJECT_TYPE_SECTOR,r.elType="sector",r.autoRadius=function(){var t=20/r.board.unitX,e=1/0,i=50/r.board.unitX;return utils_type.A.isPoint(r.center)&&(e=.3333*r.center.Dist(r.point2)),Math.max(t,Math.min(e,i))},"2lines"===h)r.Radius=function(){var t=utils_type.A.evaluate(e[4]);return"auto"===t?this.autoRadius():t},r.line1=t.select(e[0]),r.line2=t.select(e[1]),r.line1.addChild(r),r.line2.addChild(r),r.setParents(e),r.point1={visProp:{}},r.point2={visProp:{}},r.point3={visProp:{}},o=geometry.A.meetLineLine(r.line1.stdform,r.line2.stdform,0,t),geometry.A.distance(o.usrCoords,[0,0,0],3)<c&&(r.line1.point1.Dist(r.line2.point1)<c||r.line1.point1.Dist(r.line2.point2)<c?o=r.line1.point1.coords:r.line1.point2.Dist(r.line2.point1)<c||r.line1.point2.Dist(r.line2.point1)<c?o=r.line1.point2.coords:console.log("JSXGraph warning: Can't create Sector from parallel lines with no common defining point.")),utils_type.A.isArray(e[2])?(2===e[2].length&&(e[2]=[1].concat(e[2])),a=geometry.A.projectPointToLine({coords:{usrCoords:e[2]}},r.line1,t),a=statistics.A.subtract(a.usrCoords,o.usrCoords),r.direction1=math.A.innerProduct(a,[0,r.line1.stdform[2],-r.line1.stdform[1]],3)>=0?1:-1):r.direction1=e[2]>=0?1:-1,utils_type.A.isArray(e[3])?(2===e[3].length&&(e[3]=[1].concat(e[3])),a=geometry.A.projectPointToLine({coords:{usrCoords:e[3]}},r.line2,t),a=statistics.A.subtract(a.usrCoords,o.usrCoords),r.direction2=math.A.innerProduct(a,[0,r.line2.stdform[2],-r.line2.stdform[1]],3)>=0?1:-1):r.direction2=e[3]>=0?1:-1,r.methodMap=jxg.A.deepCopy(r.methodMap,{arc:"arc",center:"center",line1:"line1",line2:"line2"}),r.updateDataArray=function(){var t,e,i,n,s,o,a=1e-14,l=[0,0,0];if(e=this.line1,i=this.line2,l=math.A.crossProduct(e.stdform,i.stdform),geometry.A.distance(l,[0,0,0],3)<a&&(e.point1.Dist(i.point1)<a||e.point1.Dist(i.point2)<a?l=e.point1.coords.usrCoords:(e.point2.Dist(i.point1)<a||e.point2.Dist(i.point1)<a)&&(l=e.point2.coords.usrCoords)),Math.abs(l[0])>a&&(l[1]/=l[0],l[2]/=l[0],l[0]/=l[0]),t=this.direction1*this.Radius(),n=statistics.A.add(l,[0,t*e.stdform[2],-t*e.stdform[1]]),t=this.direction2*this.Radius(),s=statistics.A.add(l,[0,t*i.stdform[2],-t*i.stdform[1]]),this.point2.coords=new base_coords.A(constants.A.COORDS_BY_USER,n,r.board),this.point1.coords=new base_coords.A(constants.A.COORDS_BY_USER,l,r.board),this.point3.coords=new base_coords.A(constants.A.COORDS_BY_USER,s,r.board),Math.abs(n[0])<math.A.eps||Math.abs(l[0])<math.A.eps||Math.abs(s[0])<math.A.eps)return this.dataX=[NaN],void(this.dataY=[NaN]);o=geometry.A.bezierArc(n,l,s,!0,1),this.dataX=o[0],this.dataY=o[1],this.bezierDegree=3};else if("3points"===h){for(r.point1=l[0],r.point2=l[1],r.point3=l[2],s=0;s<3;s++)utils_type.A.exists(l[s]._is_new)?(r.addChild(l[s]),delete l[s]._is_new):l[s].addChild(r);r.useDirection=i.usedirection,r.setParents(l),utils_type.A.exists(l[3])&&(r.point4=l[3],r.point4.addChild(r)),r.methodMap=jxg.A.deepCopy(r.methodMap,{arc:"arc",center:"center",radiuspoint:"radiuspoint",anglepoint:"anglepoint"}),r.updateDataArray=function(){var t,e,i,r,n,s=this.point2,o=this.point1,a=this.point3,l=1,c=this.evalVisProp("selection");if(!s.isReal||!o.isReal||!a.isReal)return this.dataX=[NaN],void(this.dataY=[NaN]);n=geometry.A.rad(s,o,a),("minor"===c&&n>Math.PI||"major"===c&&n<Math.PI)&&(l=-1),this.useDirection&&utils_type.A.exists(this.point4)&&(e=this.point2.coords.usrCoords,i=this.point4.coords.usrCoords,r=this.point3.coords.usrCoords,(e[1]-r[1])*(e[2]-i[2])-(e[2]-r[2])*(e[1]-i[1])>=0&&(a=this.point2,s=this.point3)),s=s.coords.usrCoords,o=o.coords.usrCoords,a=a.coords.usrCoords,t=geometry.A.bezierArc(s,o,a,!0,l),this.dataX=t[0],this.dataY=t[1],this.bezierDegree=3},r.Radius=function(){return this.point2.Dist(this.point1)}}return r.center=r.point1,r.radiuspoint=r.point2,r.anglepoint=r.point3,n=utils_type.A.copyAttributes(i,t.options,"arc"),(n=utils_type.A.copyAttributes(n,t.options,"sector","arc")).withlabel=!1,n.selection=r.visProp.selection,n.name+="_arc","2lines"===h?(r.updateDataArray(),r.arc=t.create("arc",[function(){return r.point1.coords.usrCoords},function(){var t=r.point2.coords.distance(constants.A.COORDS_BY_USER,r.point1.coords);return 0===t?[r.point1.coords.usrCoords[1],r.point1.coords.usrCoords[2]]:[r.point1.coords.usrCoords[1]+r.Radius()*(r.point2.coords.usrCoords[1]-r.point1.coords.usrCoords[1])/t,r.point1.coords.usrCoords[2]+r.Radius()*(r.point2.coords.usrCoords[2]-r.point1.coords.usrCoords[2])/t]},function(){return r.point3.coords.usrCoords}],n)):r.arc=t.create("arc",[r.point1,function(){var t=r.point2.Dist(r.point1);return 0===t?[r.point1.X(),r.point1.Y()]:[r.point1.X()+r.Radius()*(r.point2.X()-r.point1.X())/t,r.point1.Y()+r.Radius()*(r.point2.Y()-r.point1.Y())/t]},r.point3],n),r.addChild(r.arc),r.hasPointCurve=function(t,e){var i,r,n,s,o,a,l=new base_coords.A(constants.A.COORDS_BY_SCREEN,[t,e],this.board),c=this.Radius(),h=this.center.coords.distance(constants.A.COORDS_BY_USER,l),u=this.evalVisProp("selection");return utils_type.A.isObject(this.evalVisProp("precision"))?(o=this.board._inputDevice,s=this.evalVisProp("precision."+o)):s=this.board.options.precision.hasPoint,s/=Math.min(Math.abs(this.board.unitX),Math.abs(this.board.unitY)),(a=Math.abs(h-c)<s)&&(i=geometry.A.rad(this.point2,this.center,l.usrCoords.slice(1)),r=0,n=geometry.A.rad(this.point2,this.center,this.point3),("minor"===u&&n>Math.PI||"major"===u&&n<Math.PI)&&(r=n,n=2*Math.PI),(i<r||i>n)&&(a=!1)),a},r.hasPointSector=function(t,e){var i,r,n,s=new base_coords.A(constants.A.COORDS_BY_SCREEN,[t,e],this.board),o=this.Radius(),a=this.point1.coords.distance(constants.A.COORDS_BY_USER,s)<o,l=this.evalVisProp("selection");return a&&(i=geometry.A.rad(this.radiuspoint,this.center,s.usrCoords.slice(1)),r=0,n=geometry.A.rad(this.radiuspoint,this.center,this.anglepoint),("minor"===l&&n>Math.PI||"major"===l&&n<Math.PI)&&(r=n,n=2*Math.PI),(i<r||i>n)&&(a=!1)),a},r.hasPoint=function(t,e){return this.evalVisProp("highlightonsector")||this.evalVisProp("hasinnerpoints")?this.hasPointSector(t,e):this.hasPointCurve(t,e)},r.getTextAnchor=function(){return this.point1.coords},r.getLabelAnchor=function(){var t,e,i,r,n,s=this.label.evalVisProp("position"),o=geometry.A.rad(this.point2,this.point1,this.point3),a=13/this.board.unitX,l=13/this.board.unitY,c=this.point2.coords.usrCoords,h=this.point1.coords.usrCoords,u=c[1]-h[1],d=c[2]-h[2],p=this.evalVisProp("selection"),f=this.label?this.label.visProp:this.visProp.label;return!utils_type.A.isString(s)||s.indexOf("right")<0&&s.indexOf("left")<0?(("minor"===p&&o>Math.PI||"major"===p&&o<Math.PI)&&(o=-(2*Math.PI-o)),i=(t=new base_coords.A(constants.A.COORDS_BY_USER,[h[1]+Math.cos(.5*o)*u-Math.sin(.5*o)*d,h[2]+Math.sin(.5*o)*u+Math.cos(.5*o)*d],this.board)).usrCoords[1]-h[1],r=t.usrCoords[2]-h[2],i=i*((n=math.A.hypot(i,r))+a)/n,r=r*(n+l)/n,e=[h[1]+i,h[2]+r],f.position=geometry.A.calcLabelQuadrant(geometry.A.rad([1,0],[0,0],e)),new base_coords.A(constants.A.COORDS_BY_USER,e,this.board)):this.getLabelPosition(s,this.label.evalVisProp("distance"))},r.setRadius=function(t){var e=utils_type.A.evaluate(t);"undefined"!=("auto"===t||"auto"===e?"auto":utils_type.A.isNumber(t)?"number":utils_type.A.isFunction(t)&&!utils_type.A.isString(e)?"function":"undefined")&&(this.visProp.radius=t),r.Radius=function(){var e=utils_type.A.evaluate(t);return"auto"===e?this.autoRadius():e}},r.getRadius=function(){return jxg.A.deprecated("Sector.getRadius()","Sector.Radius()"),this.Radius()},r.Value=function(t){return this.arc.Value(t)},r.L=function(){return this.arc.L()},r.Area=function(){var t=this.Radius();return.5*t*t*this.Value("radians")},r.Perimeter=function(){return this.L()+2*this.Radius()},"3points"===h&&(r.setPositionDirectly=function(t,e,i){var n,s=new base_coords.A(t,e,this.board),o=new base_coords.A(t,i,this.board);return r.point1.draggable()&&r.point2.draggable()&&r.point3.draggable()?(n=statistics.A.subtract(s.usrCoords,o.usrCoords),this.board.create("transform",n.slice(1),{type:"translate"}).applyOnce([r.point1,r.point2,r.point3]),this):this}),r.methodMap=jxg.A.deepCopy(r.methodMap,{radius:"Radius",Radius:"Radius",getRadius:"Radius",setRadius:"setRadius",Value:"Value",L:"L",Area:"Area",Perimeter:"Perimeter"}),r},jxg.A.registerElement("sector",jxg.A.createSector),jxg.A.createCircumcircleSector=function(t,e,i){var r,n,s,o;if(!1===(o=utils_type.A.providePoints(t,e,i,"point")))throw new Error("JSXGraph: Can't create circumcircle sector with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"' and '"+typeof e[2]+"'.");return(n=t.create("circumcenter",o.slice(0,3),s)).dump=!1,s=utils_type.A.copyAttributes(i,t.options,"circumcirclesector"),(r=t.create("sector",[n,o[0],o[2],o[1]],s)).elType="circumcirclesector",r.setParents(o),r.center=n,r.subs={center:n},r},jxg.A.registerElement("circumcirclesector",jxg.A.createCircumcircleSector),jxg.A.createMinorSector=function(t,e,i){return i.selection="minor",jxg.A.createSector(t,e,i)},jxg.A.registerElement("minorsector",jxg.A.createMinorSector),jxg.A.createMajorSector=function(t,e,i){return i.selection="major",jxg.A.createSector(t,e,i)},jxg.A.registerElement("majorsector",jxg.A.createMajorSector),jxg.A.createAngle=function(t,e,i){var r,n,s,o,a,l,c="invalid";if(e[0].elementClass===constants.A.OBJECT_CLASS_LINE&&e[1].elementClass===constants.A.OBJECT_CLASS_LINE&&(utils_type.A.isArray(e[2])||utils_type.A.isNumber(e[2]))&&(utils_type.A.isArray(e[3])||utils_type.A.isNumber(e[3])))c="2lines";else{if(s={name:""},!1===(l=utils_type.A.providePoints(t,e,s,"point")))throw new Error("JSXGraph: Can't create angle with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"' and '"+typeof e[2]+"'.");c="3points"}if(s=utils_type.A.copyAttributes(i,t.options,"angle"),utils_type.A.exists(s.name)||(s.name=t.generateName({type:constants.A.OBJECT_TYPE_ANGLE})),n=utils_type.A.exists(s.radius)?s.radius:0,t.suspendUpdate(),"2lines"===c?(e.push(n),(r=t.create("sector",e,s)).updateDataArraySector=r.updateDataArray,r.setAngle=function(t){},r.free=function(t){}):((r=t.create("sector",[l[1],l[0],l[2]],s)).arc.visProp.priv=!0,r.point=r.point2=r.radiuspoint=l[0],r.pointsquare=r.point3=r.anglepoint=l[2],r.Radius=function(){var t=utils_type.A.evaluate(n);return"auto"===t?r.autoRadius():t},r.updateDataArraySector=function(){var t,e,i=this.point2,r=this.point1,n=this.point3,s=this.Radius(),o=r.Dist(i),a=1,l=this.evalVisProp("selection");e=geometry.A.rad(i,r,n),("minor"===l&&e>Math.PI||"major"===l&&e<Math.PI)&&(a=-1),i=i.coords.usrCoords,r=r.coords.usrCoords,n=n.coords.usrCoords,i=[1,r[1]+(i[1]-r[1])*s/o,r[2]+(i[2]-r[2])*s/o],n=[1,r[1]+(n[1]-r[1])*s/o,r[2]+(n[2]-r[2])*s/o],t=geometry.A.bezierArc(i,r,n,!0,a),this.dataX=t[0],this.dataY=t[1],this.bezierDegree=3},r.setAngle=function(t){var e,i,r,n=this.anglepoint,s=this.radiuspoint;return n.draggable()&&(e=this.board.create("transform",[t,this.center],{type:"rotate"}),n.addTransform(s,e),e.update(),n.moveTo(math.A.matVecMult(e.matrix,s.coords.usrCoords)),r=utils_type.A.isFunction(t)?function(){return 2*Math.PI-t()}:function(){return 2*Math.PI-t},i=this.board.create("transform",[r,this.center],{type:"rotate"}),n.coords.on("update",(function(){i.update(),s.setPositionDirectly(constants.A.COORDS_BY_USER,math.A.matVecMult(i.matrix,n.coords.usrCoords))})),n.setParents(s),this.hasFixedAngle=!0),this},r.free=function(){var t=this.anglepoint;return t.transformations.length>0&&(t.transformations.pop(),t.isDraggable=!0,t.parents=[],t.coords.off("update")),this.hasFixedAngle=!1,this},r.setParents(l)),utils_type.A.exists(r.visProp.text)&&r.label.setText(r.evalVisProp("text")),r.elType="angle",r.type=constants.A.OBJECT_TYPE_ANGLE,r.subs={},r.updateDataArraySquare=function(){var t,e,i,r,n,s,o,a,l=this.Radius();"2lines"===c&&this.updateDataArraySector(),t=this.point2,e=this.point1,i=this.point3,t=t.coords.usrCoords,e=e.coords.usrCoords,i=i.coords.usrCoords,r=geometry.A.distance(t,e,3),n=geometry.A.distance(i,e,3),t=[1,e[1]+(t[1]-e[1])*l/r,e[2]+(t[2]-e[2])*l/r],i=[1,e[1]+(i[1]-e[1])*l/n,e[2]+(i[2]-e[2])*l/n],s=math.A.crossProduct(i,e),o=[-t[1]*s[1]-t[2]*s[2],t[0]*s[1],t[0]*s[2]],s=math.A.crossProduct(t,e),a=[-i[1]*s[1]-i[2]*s[2],i[0]*s[1],i[0]*s[2]],(s=math.A.crossProduct(o,a))[1]/=s[0],s[2]/=s[0],this.dataX=[e[1],t[1],s[1],i[1],e[1]],this.dataY=[e[2],t[2],s[2],i[2],e[2]],this.bezierDegree=1},r.updateDataArrayNone=function(){this.dataX=[NaN],this.dataY=[NaN],this.bezierDegree=1},r.updateDataArray=function(){var t=this.evalVisProp("type"),e=geometry.A.trueAngle(this.point2,this.point1,this.point3),i=this.evalVisProp("selection");("minor"===i&&e>180||"major"===i&&e<180)&&(e=360-e),Math.abs(e-90)<this.evalVisProp("orthosensitivity")+math.A.eps&&(t=this.evalVisProp("orthotype")),"none"===t?(this.updateDataArrayNone(),this.maxX=function(){return 0}):"square"===t?(this.updateDataArraySquare(),this.maxX=function(){return 4}):"sector"===t?(this.updateDataArraySector(),this.maxX=function(){return 6}):"sectordot"===t&&(this.updateDataArraySector(),this.maxX=function(){return 6},this.dot.visProp.visible||this.dot.setAttribute({visible:!0})),(!this.visProp.visible||"sectordot"!==t&&this.dot.visProp.visible)&&this.dot.setAttribute({visible:!1})},o=utils_type.A.copyAttributes(i,t.options,"angle","dot"),r.dot=t.create("point",[function(){var t,e,i,n,s,o,a,l,c;return utils_type.A.exists(r.dot)&&!r.dot.visProp.visible?[0,0]:(t=r.point2.coords.usrCoords,e=r.point1.coords.usrCoords,i=r.Radius(),n=geometry.A.distance(t,e,3),s=geometry.A.rad(r.point2,r.point1,r.point3),("minor"===(c=r.evalVisProp("selection"))&&s>Math.PI||"major"===c&&s<Math.PI)&&(s=-(2*Math.PI-s)),s*=.5,o=Math.cos(s),a=Math.sin(s),t=[1,e[1]+(t[1]-e[1])*i/n,e[2]+(t[2]-e[2])*i/n],l=[[1,0,0],[e[1]-.5*e[1]*o+.5*e[2]*a,.5*o,.5*-a],[e[2]-.5*e[1]*a-.5*e[2]*o,.5*a,.5*o]],math.A.matVecMult(l,t))}],o),r.dot.dump=!1,r.subs.dot=r.dot,"2lines"===c)for(a=0;a<2;a++)t.select(e[a]).addChild(r.dot);else for(a=0;a<3;a++)t.select(l[a]).addChild(r.dot);return t.unsuspendUpdate(),r.Value=function(t){return""===(t=t||"radians")&&(t="radians"),r.arc.Value(t)},r.getLabelAnchor=function(){var t,e,i,n,s,o,a,l,c,h=12,u=r.evalVisProp("selection"),d=this.label.evalVisProp("position"),p=this.label?this.label.visProp:this.visProp.label;return!utils_type.A.isString(d)||d.indexOf("right")<0&&d.indexOf("left")<0?(utils_type.A.exists(this.label)&&utils_type.A.exists(this.label.visProp.fontsize)&&(h=this.label.evalVisProp("fontsize")),h/=this.board.unitX,e=r.point2.coords.usrCoords,i=r.point1.coords.usrCoords,n=r.Radius(),s=geometry.A.distance(e,i,3),o=geometry.A.rad(r.point2,r.point1,r.point3),("minor"===u&&o>Math.PI||"major"===u&&o<Math.PI)&&(o=-(2*Math.PI-o)),o*=.5,a=Math.cos(o),l=Math.sin(o),e=[1,i[1]+(e[1]-i[1])*n/s,i[2]+(e[2]-i[2])*n/s],c=[[1,0,0],[i[1]-.5*i[1]*a+.5*i[2]*l,.5*a,.5*-l],[i[2]-.5*i[1]*l-.5*i[2]*a,.5*l,.5*a]],(t=math.A.matVecMult(c,e))[1]/=t[0],t[2]/=t[0],t[0]/=t[0],s=geometry.A.distance(t,i,3),t=[t[0],i[1]+(t[1]-i[1])*(n+h)/s,i[2]+(t[2]-i[2])*(n+h)/s],p.position=geometry.A.calcLabelQuadrant(geometry.A.rad([1,0],[0,0],t)),new base_coords.A(constants.A.COORDS_BY_USER,t,this.board)):this.getLabelPosition(d,this.label.evalVisProp("distance"))},r.methodMap=utils_type.A.deepCopy(r.methodMap,{setAngle:"setAngle",Value:"Value",free:"free"}),r},jxg.A.registerElement("angle",jxg.A.createAngle),jxg.A.createNonreflexAngle=function(t,e,i){var r;return i.selection="minor",i=utils_type.A.copyAttributes(i,t.options,"nonreflexangle"),(r=jxg.A.createAngle(t,e,i)).Value=function(t){var e=geometry.A.rad(this.point2,this.point1,this.point3);return""===(t=t||"radians")&&(t="radians"),e=e<Math.PI?e:2*Math.PI-e,this.arc.Value(t,e)},r},jxg.A.registerElement("nonreflexangle",jxg.A.createNonreflexAngle),jxg.A.createReflexAngle=function(t,e,i){var r;return i.selection="major",i=utils_type.A.copyAttributes(i,t.options,"reflexangle"),(r=jxg.A.createAngle(t,e,i)).Value=function(t){var e=geometry.A.rad(this.point2,this.point1,this.point3);return""===(t=t||"radians")&&(t="radians"),e=e>=Math.PI?e:2*Math.PI-e,this.arc.Value(t,e)},r},jxg.A.registerElement("reflexangle",jxg.A.createReflexAngle),jxg.A.createOrthogonalProjection=function(t,e,i){var r,n,s,o;if(e[0]=t.select(e[0]),e[1]=t.select(e[1]),utils_type.A.isPointType(t,e[0])&&e[1].elementClass===constants.A.OBJECT_CLASS_LINE)n=utils_type.A.providePoints(t,[e[0]],i,"point")[0],r=e[1];else{if(!utils_type.A.isPointType(t,e[1])||e[0].elementClass!==constants.A.OBJECT_CLASS_LINE)throw new Error("JSXGraph: Can't create perpendicular point with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [point,line]");n=utils_type.A.providePoints(t,[e[1]],i,"point")[0],r=e[0]}return o=utils_type.A.copyAttributes(i,t.options,"orthogonalprojection"),s=t.create("point",[function(){return geometry.A.projectPointToLine(n,r,t)}],o),utils_type.A.exists(n._is_new)?(s.addChild(n),delete n._is_new):n.addChild(s),r.addChild(s),s.elType="orthogonalprojection",s.setParents([n.id,s.id]),s.update(),s.generatePolynomial=function(){var t=r.point1.symbolic.x,e=r.point1.symbolic.y,i=r.point2.symbolic.x,o=r.point2.symbolic.y,a=n.symbolic.x,l=n.symbolic.y,c=s.symbolic.x,h=s.symbolic.y;return["("+e+")*("+c+")-("+e+")*("+i+")+("+h+")*("+i+")-("+t+")*("+h+")+("+t+")*("+o+")-("+c+")*("+o+")","("+l+")*("+e+")-("+l+")*("+o+")-("+h+")*("+e+")+("+h+")*("+o+")+("+a+")*("+t+")-("+a+")*("+i+")-("+c+")*("+t+")+("+c+")*("+i+")"]},s},jxg.A.createPerpendicular=function(t,e,i){var r,n,s,o;if(e[0]=t.select(e[0]),e[1]=t.select(e[1]),utils_type.A.isPointType(t,e[0])&&e[1].elementClass===constants.A.OBJECT_CLASS_LINE)n=e[1],r=utils_type.A.providePoints(t,[e[0]],i,"point")[0];else{if(!utils_type.A.isPointType(t,e[1])||e[0].elementClass!==constants.A.OBJECT_CLASS_LINE)throw new Error("JSXGraph: Can't create perpendicular with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [line,point]");n=e[0],r=utils_type.A.providePoints(t,[e[1]],i,"point")[0]}return o=utils_type.A.copyAttributes(i,t.options,"perpendicular"),(s=jxg.A.createLine(t,[function(){return n.stdform[2]*r.X()-n.stdform[1]*r.Y()},function(){return-n.stdform[2]*r.Z()},function(){return n.stdform[1]*r.Z()}],o)).elType="perpendicular",s.setParents([n.id,r.id]),utils_type.A.exists(r._is_new)?(s.addChild(r),delete r._is_new):r.addChild(s),n.addChild(s),s},jxg.A.createPerpendicularPoint=function(t,e,i){var r,n,s;if(e[0]=t.select(e[0]),e[1]=t.select(e[1]),utils_type.A.isPointType(t,e[0])&&e[1].elementClass===constants.A.OBJECT_CLASS_LINE)n=utils_type.A.providePoints(t,[e[0]],i,"point")[0],r=e[1];else{if(!utils_type.A.isPointType(t,e[1])||e[0].elementClass!==constants.A.OBJECT_CLASS_LINE)throw new Error("JSXGraph: Can't create perpendicular point with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [point,line]");n=utils_type.A.providePoints(t,[e[1]],i,"point")[0],r=e[0]}return s=t.create("point",[function(){return geometry.A.perpendicular(r,n,t)[0]}],i),utils_type.A.exists(n._is_new)?(s.addChild(n),delete n._is_new):n.addChild(s),r.addChild(s),s.elType="perpendicularpoint",s.setParents([n.id,r.id]),s.update(),s.generatePolynomial=function(){var t=r.point1.symbolic.x,e=r.point1.symbolic.y,i=r.point2.symbolic.x,o=r.point2.symbolic.y,a=n.symbolic.x,l=n.symbolic.y,c=s.symbolic.x,h=s.symbolic.y;return["("+e+")*("+c+")-("+e+")*("+i+")+("+h+")*("+i+")-("+t+")*("+h+")+("+t+")*("+o+")-("+c+")*("+o+")","("+l+")*("+e+")-("+l+")*("+o+")-("+h+")*("+e+")+("+h+")*("+o+")+("+a+")*("+t+")-("+a+")*("+i+")-("+c+")*("+t+")+("+c+")*("+i+")"]},s},jxg.A.createPerpendicularSegment=function(t,e,i){var r,n,s,o,a;if(e[0]=t.select(e[0]),e[1]=t.select(e[1]),utils_type.A.isPointType(t,e[0])&&e[1].elementClass===constants.A.OBJECT_CLASS_LINE)n=e[1],r=utils_type.A.providePoints(t,[e[0]],i,"point")[0];else{if(!utils_type.A.isPointType(t,e[1])||e[0].elementClass!==constants.A.OBJECT_CLASS_LINE)throw new Error("JSXGraph: Can't create perpendicular with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [line,point]");n=e[0],r=utils_type.A.providePoints(t,[e[1]],i,"point")[0]}return a=utils_type.A.copyAttributes(i,t.options,"perpendicularsegment","point"),(o=jxg.A.createPerpendicularPoint(t,[n,r],a)).dump=!1,utils_type.A.exists(i.layer)||(i.layer=t.options.layer.line),a=utils_type.A.copyAttributes(i,t.options,"perpendicularsegment"),(s=jxg.A.createLine(t,[function(){return geometry.A.perpendicular(n,r,t)[1]?[o,r]:[r,o]}],a)).point=o,utils_type.A.exists(r._is_new)?(s.addChild(r),delete r._is_new):r.addChild(s),n.addChild(s),s.elType="perpendicularsegment",s.setParents([r.id,n.id]),s.subs={point:o},s.inherits.push(o),s},jxg.A.createMidpoint=function(t,e,i){var r,n,s,o,a;for(o=0;o<e.length;++o)e[o]=t.select(e[o]);if(2===e.length&&utils_type.A.isPointType(t,e[0])&&utils_type.A.isPointType(t,e[1]))e=utils_type.A.providePoints(t,e,i,"point"),r=e[0],n=e[1];else{if(1!==e.length||e[0].elementClass!==constants.A.OBJECT_CLASS_LINE)throw new Error("JSXGraph: Can't create midpoint.\nPossible parent types: [point,point], [line]");r=e[0].point1,n=e[0].point2}return a=utils_type.A.copyAttributes(i,t.options,"midpoint"),s=t.create("point",[function(){var t=r.coords.usrCoords[1]+n.coords.usrCoords[1];return isNaN(t)||Math.abs(r.coords.usrCoords[0])<math.A.eps||Math.abs(n.coords.usrCoords[0])<math.A.eps?NaN:.5*t},function(){var t=r.coords.usrCoords[2]+n.coords.usrCoords[2];return isNaN(t)||Math.abs(r.coords.usrCoords[0])<math.A.eps||Math.abs(n.coords.usrCoords[0])<math.A.eps?NaN:.5*t}],a),utils_type.A.exists(r._is_new)?(s.addChild(r),delete r._is_new):r.addChild(s),utils_type.A.exists(n._is_new)?(s.addChild(n),delete n._is_new):n.addChild(s),s.elType="midpoint",s.setParents([r.id,n.id]),s.prepareUpdate().update(),s.generatePolynomial=function(){var t=r.symbolic.x,e=r.symbolic.y,i=n.symbolic.x,o=n.symbolic.y,a=s.symbolic.x,l=s.symbolic.y;return["("+e+")*("+a+")-("+e+")*("+i+")+("+l+")*("+i+")-("+t+")*("+l+")+("+t+")*("+o+")-("+a+")*("+o+")","("+t+")^2 - 2*("+t+")*("+a+")+("+e+")^2-2*("+e+")*("+l+")-("+i+")^2+2*("+i+")*("+a+")-("+o+")^2+2*("+o+")*("+l+")"]},s},jxg.A.createParallelPoint=function(t,e,i){var r,n,s,o,a,l;for(a=0;a<e.length;++a)e[a]=t.select(e[a]);if(3===e.length&&utils_type.A.isPointType(t,e[0])&&utils_type.A.isPointType(t,e[1])&&utils_type.A.isPointType(t,e[2]))e=utils_type.A.providePoints(t,e,i,"point"),r=e[0],n=e[1],s=e[2];else if(utils_type.A.isPointType(t,e[0])&&e[1].elementClass===constants.A.OBJECT_CLASS_LINE)s=utils_type.A.providePoints(t,[e[0]],i,"point")[0],r=e[1].point1,n=e[1].point2;else{if(!utils_type.A.isPointType(t,e[1])||e[0].elementClass!==constants.A.OBJECT_CLASS_LINE)throw new Error("JSXGraph: Can't create parallel point with parent types '"+typeof e[0]+"', '"+typeof e[1]+"' and '"+typeof e[2]+"'.\nPossible parent types: [line,point], [point,point,point]");s=utils_type.A.providePoints(t,[e[1]],i,"point")[0],r=e[0].point1,n=e[0].point2}return l=utils_type.A.copyAttributes(i,t.options,"parallelpoint"),o=t.create("point",[function(){return s.coords.usrCoords[1]+n.coords.usrCoords[1]-r.coords.usrCoords[1]},function(){return s.coords.usrCoords[2]+n.coords.usrCoords[2]-r.coords.usrCoords[2]}],l),utils_type.A.exists(r._is_new)?(o.addChild(r),delete r._is_new):r.addChild(o),utils_type.A.exists(n._is_new)?(o.addChild(n),delete n._is_new):n.addChild(o),utils_type.A.exists(s._is_new)?(o.addChild(s),delete s._is_new):s.addChild(o),o.elType="parallelpoint",o.setParents([r.id,n.id,s.id]),o.prepareUpdate().update(),o.generatePolynomial=function(){var t=r.symbolic.x,e=r.symbolic.y,i=n.symbolic.x,a=n.symbolic.y,l=s.symbolic.x,c=s.symbolic.y,h=o.symbolic.x,u=o.symbolic.y;return["("+a+")*("+h+")-("+a+")*("+l+")-("+e+")*("+h+")+("+e+")*("+l+")-("+u+")*("+i+")+("+u+")*("+t+")+("+c+")*("+i+")-("+c+")*("+t+")","("+u+")*("+t+")-("+u+")*("+l+")-("+a+")*("+t+")+("+a+")*("+l+")-("+h+")*("+e+")+("+h+")*("+c+")+("+i+")*("+e+")-("+i+")*("+c+")"]},o},jxg.A.createParallel=function(t,e,i){var r,n,s,o,a,l,c=1;for(a=0;a<e.length;++a)e[a]=t.select(e[a]);return r=null,3===e.length?(r=(e=utils_type.A.providePoints(t,e,i,"point"))[2],c=0):utils_type.A.isPointType(t,e[0])?(r=utils_type.A.providePoints(t,[e[0]],i,"point")[0],o=function(){return e[1].stdform}):utils_type.A.isPointType(t,e[1])&&(r=utils_type.A.providePoints(t,[e[1]],i,"point")[0],o=function(){return e[0].stdform}),utils_type.A.exists(i.layer)||(i.layer=t.options.layer.line),l=utils_type.A.copyAttributes(i,t.options,"parallel","point"),(n=1===c?t.create("point",[function(){return math.A.crossProduct([1,0,0],o())}],l):t.create("parallelpoint",e,l)).isDraggable=!0,l=utils_type.A.copyAttributes(i,t.options,"parallel"),(s=t.create("line",[r,n],l)).elType="parallel",s.subs={point:n},s.inherits.push(n),s.setParents([e[0].id,e[1].id]),3===e.length&&s.addParents(e[2].id),s.point=n,s},jxg.A.createArrowParallel=function(t,e,i){var r,n;try{return!1===(n=utils_type.A.copyAttributes(i,t.options,"arrowparallel")).lastArrow&&(n.lastArrow=!0),(r=jxg.A.createParallel(t,e,n).setAttribute({straightFirst:!1,straightLast:!1})).type=constants.A.OBJECT_TYPE_VECTOR,r.elType="arrowparallel",r}catch(t){throw new Error("JSXGraph: Can't create arrowparallel with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [line,point], [point,point,point]")}},jxg.A.createBisector=function(t,e,i){var r,n,s,o;if(e=utils_type.A.providePoints(t,e,i,"point"),utils_type.A.isPoint(e[0])&&utils_type.A.isPoint(e[1])&&utils_type.A.isPoint(e[2])){for((o=utils_type.A.copyAttributes(i,t.options,"bisector","point")).snapToGrid=!1,(r=t.create("point",[function(){return geometry.A.angleBisector(e[0],e[1],e[2],t)}],o)).dump=!1,s=0;s<3;s++)utils_type.A.exists(e[s]._is_new)?(r.addChild(e[s]),delete e[s]._is_new):e[s].addChild(r);return utils_type.A.exists(i.layer)||(i.layer=t.options.layer.line),o=utils_type.A.copyAttributes(i,t.options,"bisector"),(n=jxg.A.createLine(t,[e[1],r],o)).point=r,n.elType="bisector",n.setParents(e),n.subs={point:r},n.inherits.push(r),n}throw new Error("JSXGraph: Can't create angle bisector with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [point,point,point]")},jxg.A.createAngularBisectorsOfTwoLines=function(t,e,i){var r,n,s,o,a=t.select(e[0]),l=t.select(e[1]);if(a.elementClass!==constants.A.OBJECT_CLASS_LINE||l.elementClass!==constants.A.OBJECT_CLASS_LINE)throw new Error("JSXGraph: Can't create angle bisectors of two lines with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [line,line]");return utils_type.A.exists(i.layer)||(i.layer=t.options.layer.line),s=utils_type.A.copyAttributes(i,t.options,"bisectorlines","line1"),r=t.create("line",[function(){var t=math.A.hypot(a.stdform[1],a.stdform[2]),e=math.A.hypot(l.stdform[1],l.stdform[2]);return a.stdform[0]/t-l.stdform[0]/e},function(){var t=math.A.hypot(a.stdform[1],a.stdform[2]),e=math.A.hypot(l.stdform[1],l.stdform[2]);return a.stdform[1]/t-l.stdform[1]/e},function(){var t=math.A.hypot(a.stdform[1],a.stdform[2]),e=math.A.hypot(l.stdform[1],l.stdform[2]);return a.stdform[2]/t-l.stdform[2]/e}],s),utils_type.A.exists(i.layer)||(i.layer=t.options.layer.line),s=utils_type.A.copyAttributes(i,t.options,"bisectorlines","line2"),n=t.create("line",[function(){var t=math.A.hypot(a.stdform[1],a.stdform[2]),e=math.A.hypot(l.stdform[1],l.stdform[2]);return a.stdform[0]/t+l.stdform[0]/e},function(){var t=math.A.hypot(a.stdform[1],a.stdform[2]),e=math.A.hypot(l.stdform[1],l.stdform[2]);return a.stdform[1]/t+l.stdform[1]/e},function(){var t=math.A.hypot(a.stdform[1],a.stdform[2]),e=math.A.hypot(l.stdform[1],l.stdform[2]);return a.stdform[2]/t+l.stdform[2]/e}],s),o=new composition({line1:r,line2:n}),r.dump=!1,n.dump=!1,o.elType="bisectorlines",o.setParents([a.id,l.id]),o.subs={line1:r,line2:n},o},jxg.A.createCircumcenter=function(t,e,i){var r,n,s,o,a;if(e=utils_type.A.providePoints(t,e,i,"point"),utils_type.A.isPoint(e[0])&&utils_type.A.isPoint(e[1])&&utils_type.A.isPoint(e[2])){for(s=e[0],o=e[1],a=e[2],r=jxg.A.createPoint(t,[function(){return geometry.A.circumcenter(s,o,a,t)}],i),n=0;n<3;n++)utils_type.A.exists(e[n]._is_new)?(r.addChild(e[n]),delete e[n]._is_new):e[n].addChild(r);return r.elType="circumcenter",r.setParents(e),r.generatePolynomial=function(){var t=s.symbolic.x,e=s.symbolic.y,i=o.symbolic.x,n=o.symbolic.y,l=a.symbolic.x,c=a.symbolic.y,h=r.symbolic.x,u=r.symbolic.y;return[["((",h,")-(",t,"))^2+((",u,")-(",e,"))^2-((",h,")-(",i,"))^2-((",u,")-(",n,"))^2"].join(""),["((",h,")-(",t,"))^2+((",u,")-(",e,"))^2-((",h,")-(",l,"))^2-((",u,")-(",c,"))^2"].join("")]},r}throw new Error("JSXGraph: Can't create circumcircle midpoint with parent types '"+typeof e[0]+"', '"+typeof e[1]+"' and '"+typeof e[2]+"'.\nPossible parent types: [point,point,point]")},jxg.A.createIncenter=function(t,e,i){var r,n,s,o,a;if(!((e=utils_type.A.providePoints(t,e,i,"point")).length>=3&&utils_type.A.isPoint(e[0])&&utils_type.A.isPoint(e[1])&&utils_type.A.isPoint(e[2])))throw new Error("JSXGraph: Can't create incenter with parent types '"+typeof e[0]+"', '"+typeof e[1]+"' and '"+typeof e[2]+"'.\nPossible parent types: [point,point,point]");for(n=e[0],s=e[1],o=e[2],r=t.create("point",[function(){var e,i,r;return e=math.A.hypot(s.X()-o.X(),s.Y()-o.Y()),i=math.A.hypot(n.X()-o.X(),n.Y()-o.Y()),r=math.A.hypot(s.X()-n.X(),s.Y()-n.Y()),new base_coords.A(constants.A.COORDS_BY_USER,[(e*n.X()+i*s.X()+r*o.X())/(e+i+r),(e*n.Y()+i*s.Y()+r*o.Y())/(e+i+r)],t)}],i),a=0;a<3;a++)utils_type.A.exists(e[a]._is_new)?(r.addChild(e[a]),delete e[a]._is_new):e[a].addChild(r);return r.elType="incenter",r.setParents(e),r},jxg.A.createCircumcircle=function(t,e,i){var r,n,s,o;if(!1===(e=utils_type.A.providePoints(t,e,i,"point")))throw new Error("JSXGraph: Can't create circumcircle with parent types '"+typeof e[0]+"', '"+typeof e[1]+"' and '"+typeof e[2]+"'.\nPossible parent types: [point,point,point]");try{for(s=utils_type.A.copyAttributes(i,t.options,"circumcircle","center"),(r=jxg.A.createCircumcenter(t,e,s)).dump=!1,utils_type.A.exists(i.layer)||(i.layer=t.options.layer.circle),s=utils_type.A.copyAttributes(i,t.options,"circumcircle"),(n=jxg.A.createCircle(t,[r,e[0]],s)).elType="circumcircle",n.setParents(e),n.subs={center:r},n.inherits.push(n),o=0;o<3;o++)utils_type.A.exists(e[o]._is_new)?(n.addChild(e[o]),delete e[o]._is_new):e[o].addChild(n)}catch(t){throw new Error("JSXGraph: Can't create circumcircle with parent types '"+typeof e[0]+"', '"+typeof e[1]+"' and '"+typeof e[2]+"'.\nPossible parent types: [point,point,point]")}return n},jxg.A.createIncircle=function(t,e,i){var r,n,s,o;if(!1===(e=utils_type.A.providePoints(t,e,i,"point")))throw new Error("JSXGraph: Can't create circumcircle with parent types '"+typeof e[0]+"', '"+typeof e[1]+"' and '"+typeof e[2]+"'.\nPossible parent types: [point,point,point]");try{for(o=utils_type.A.copyAttributes(i,t.options,"incircle","center"),(n=jxg.A.createIncenter(t,e,o)).dump=!1,utils_type.A.exists(i.layer)||(i.layer=t.options.layer.circle),o=utils_type.A.copyAttributes(i,t.options,"incircle"),(s=jxg.A.createCircle(t,[n,function(){var t=math.A.hypot(e[1].X()-e[2].X(),e[1].Y()-e[2].Y()),i=math.A.hypot(e[0].X()-e[2].X(),e[0].Y()-e[2].Y()),r=math.A.hypot(e[1].X()-e[0].X(),e[1].Y()-e[0].Y()),n=(t+i+r)/2;return Math.sqrt((n-t)*(n-i)*(n-r)/n)}],o)).elType="incircle",s.setParents(e),r=0;r<3;r++)utils_type.A.exists(e[r]._is_new)?(s.addChild(e[r]),delete e[r]._is_new):e[r].addChild(s);s.center=n,s.subs={center:s.center},s.inherits.push(n)}catch(t){throw new Error("JSXGraph: Can't create circumcircle with parent types '"+typeof e[0]+"', '"+typeof e[1]+"' and '"+typeof e[2]+"'.\nPossible parent types: [point,point,point]")}return s},jxg.A.createReflection=function(t,e,i){var r,n,s,o,a,l,c,h,u="\nPossible parent types: [point|line|curve|polygon|circle|arc|sector, line]";for(l=0;l<e.length;++l)e[l]=t.select(e[l]);if(c=utils_type.A.copyAttributes(i,t.options,"reflection"),utils_type.A.isPoint(e[0]))n=utils_type.A.providePoints(t,[e[0]],h)[0];else{if(e[0].elementClass!==constants.A.OBJECT_CLASS_CURVE&&e[0].elementClass!==constants.A.OBJECT_CLASS_LINE&&e[0].type!==constants.A.OBJECT_TYPE_POLYGON&&e[0].elementClass!==constants.A.OBJECT_CLASS_CIRCLE)throw new Error("JSXGraph: Can't create reflection element with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'."+u);n=e[0]}if(e[1].elementClass!==constants.A.OBJECT_CLASS_LINE)throw new Error("JSXGraph: Can't create reflected element with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'."+u);if(r=e[1],a=jxg.A.createTransform(t,[r],{type:"reflect"}),utils_type.A.isPoint(n))s=jxg.A.createPoint(t,[n,a],c);else if(n.elementClass===constants.A.OBJECT_CLASS_CURVE)s=jxg.A.createCurve(t,[n,a],c);else if(n.elementClass===constants.A.OBJECT_CLASS_LINE)s=jxg.A.createLine(t,[n,a],c);else if(n.type===constants.A.OBJECT_TYPE_POLYGON)s=jxg.A.createPolygon(t,[n,a],c);else{if(n.elementClass!==constants.A.OBJECT_CLASS_CIRCLE)throw new Error("JSXGraph: Can't create reflected element with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'."+u);"euclidean"===c.type.toLowerCase()?(h=utils_type.A.copyAttributes(i,t.options,"reflection","center"),(o=jxg.A.createPoint(t,[n.center,a],h)).prepareUpdate().update().updateVisibility(o.evalVisProp("visible")).updateRenderer(),s=jxg.A.createCircle(t,[o,function(){return n.Radius()}],c)):s=jxg.A.createCircle(t,[n,a],c)}return utils_type.A.exists(n._is_new)&&(s.addChild(n),delete n._is_new),r.addChild(s),s.elType="reflection",s.addParents(r),s.prepareUpdate().update(),utils_type.A.isPoint(s)&&(s.generatePolynomial=function(){var t=r.point1.symbolic.x,e=r.point1.symbolic.y,i=r.point2.symbolic.x,o=r.point2.symbolic.y,a=n.symbolic.x,l=n.symbolic.y,c=s.symbolic.x,h=s.symbolic.y;return[["((",h,")-(",l,"))*((",e,")-(",o,"))+((",t,")-(",i,"))*((",c,")-(",a,"))"].join(""),["((",c,")-(",t,"))^2+((",h,")-(",e,"))^2-((",a,")-(",t,"))^2-((",l,")-(",e,"))^2"].join("")]}),s},jxg.A.createMirrorElement=function(t,e,i){var r,n,s,o,a,l,c,h,u="\nPossible parent types: [point|line|curve|polygon|circle|arc|sector, point]";for(n=0;n<e.length;++n)e[n]=t.select(e[n]);if(c=utils_type.A.copyAttributes(i,t.options,"mirrorelement"),utils_type.A.isPoint(e[0]))r=utils_type.A.providePoints(t,[e[0]],c)[0];else{if(e[0].elementClass!==constants.A.OBJECT_CLASS_CURVE&&e[0].elementClass!==constants.A.OBJECT_CLASS_LINE&&e[0].type!==constants.A.OBJECT_TYPE_POLYGON&&e[0].elementClass!==constants.A.OBJECT_CLASS_CIRCLE)throw new Error("JSXGraph: Can't create mirror element with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'."+u);r=e[0]}if(!utils_type.A.isPoint(e[1]))throw new Error("JSXGraph: Can't create mirror element with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'."+u);if(h=utils_type.A.copyAttributes(i,t.options,"mirrorelement","point"),s=utils_type.A.providePoints(t,[e[1]],h)[0],l=jxg.A.createTransform(t,[Math.PI,s],{type:"rotate"}),utils_type.A.isPoint(r))o=jxg.A.createPoint(t,[r,l],c);else if(r.elementClass===constants.A.OBJECT_CLASS_CURVE)o=jxg.A.createCurve(t,[r,l],c);else if(r.elementClass===constants.A.OBJECT_CLASS_LINE)o=jxg.A.createLine(t,[r,l],c);else if(r.type===constants.A.OBJECT_TYPE_POLYGON)o=jxg.A.createPolygon(t,[r,l],c);else{if(r.elementClass!==constants.A.OBJECT_CLASS_CIRCLE)throw new Error("JSXGraph: Can't create mirror element with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'."+u);"euclidean"===c.type.toLowerCase()?(h=utils_type.A.copyAttributes(i,t.options,"mirrorelement","center"),(a=jxg.A.createPoint(t,[r.center,l],h)).prepareUpdate().update().updateVisibility(a.evalVisProp("visible")).updateRenderer(),o=jxg.A.createCircle(t,[a,function(){return r.Radius()}],c)):o=jxg.A.createCircle(t,[r,l],c)}return utils_type.A.exists(r._is_new)&&(o.addChild(r),delete r._is_new),s.addChild(o),o.elType="mirrorelement",o.addParents(s),o.prepareUpdate().update(),o},jxg.A.createMirrorPoint=function(t,e,i){var r=jxg.A.createMirrorElement(t,e,i);return r.elType="mirrorpoint",r},jxg.A.createIntegral=function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p,f,m,g,_,v=null;if(utils_type.A.isArray(e[0])&&e[1].elementClass===constants.A.OBJECT_CLASS_CURVE)r=e[0],n=e[1];else{if(!utils_type.A.isArray(e[1])||e[0].elementClass!==constants.A.OBJECT_CLASS_CURVE)throw new Error("JSXGraph: Can't create integral with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [[number|function,number|function],curve]");r=e[1],n=e[0]}return(s=utils_type.A.copyAttributes(i,t.options,"integral")).withlabel=!1,_=t.create("curve",[[0],[0]],s),t.objectsList.pop(),o=r[0],a=r[1],utils_type.A.isFunction(o)?(c=function(){return n.Y(l())},o=(l=o)()):(l=o,c=n.Y(o)),utils_type.A.isFunction(a)?(u=function(){return n.Y(h())},a=(h=a)()):(h=a,u=n.Y(a)),s=utils_type.A.copyAttributes(i,t.options,"integral","curveleft"),d=t.create("glider",[l,c,n],s),utils_type.A.isFunction(l)&&d.hideElement(),s=utils_type.A.copyAttributes(i,t.options,"integral","baseleft"),p=t.create("point",[function(){return"y"===_.evalVisProp("axis")?0:d.X()},function(){return"y"===_.evalVisProp("axis")?d.Y():0}],s),s=utils_type.A.copyAttributes(i,t.options,"integral","curveright"),f=t.create("glider",[h,u,n],s),utils_type.A.isFunction(h)&&f.hideElement(),s=utils_type.A.copyAttributes(i,t.options,"integral","baseright"),m=t.create("point",[function(){return"y"===_.evalVisProp("axis")?0:f.X()},function(){return"y"===_.evalVisProp("axis")?f.Y():0}],s),_._pos=t.objectsList.length,t.objectsList.push(_),!1!==(s=utils_type.A.copyAttributes(i,t.options,"integral")).withlabel&&"y"!==s.axis&&(s=utils_type.A.copyAttributes(i,t.options,"integral","label"),s=utils_type.A.copyAttributes(s,t.options,"label"),g=function(){var t,e="&int;",i=numerics.A.NewtonCotes([p.X(),m.X()],n.Y),r=v.evalVisProp("digits");return t=v.useLocale()?v.formatNumberLocale(i,r):utils_type.A.toFixed(i,r),(v.evalVisProp("usemathjax")||v.evalVisProp("usekatex"))&&(e="\\int"),e+" = "+t},(v=t.create("text",[function(){var t=new base_coords.A(constants.A.COORDS_BY_SCREEN,[this.evalVisProp("offset.0")+this.board.origin.scrCoords[1],0],this.board,!1),e=this.board.getBoundingBox(),i=.1*(e[2]-e[0]),r=f.X();return r<e[0]?r=e[0]+i:r>e[2]&&(r=e[2]-i),r+t.usrCoords[1]},function(){var t=new base_coords.A(constants.A.COORDS_BY_SCREEN,[0,this.evalVisProp("offset.1")+this.board.origin.scrCoords[2]],this.board,!1),e=this.board.getBoundingBox(),i=.1*(e[1]-e[3]),r=f.Y();return r>e[1]?r=e[1]-i:r<e[3]&&(r=e[3]+i),r+t.usrCoords[2]},""],s)).setText(g),v.dump=!1,d.addChild(v),f.addChild(v)),d.dump=!1,p.dump=!1,f.dump=!1,m.dump=!1,_.elType="integral",_.setParents([n.id,r]),_.subs={curveLeft:d,baseLeft:p,curveRight:f,baseRight:m},_.inherits.push(d,p,f,m),s.withlabel&&(_.subs.label=v,_.inherits.push(v)),_.Value=function(){return numerics.A.I([p.X(),m.X()],n.Y)},_.updateDataArray=function(){var t,e,i,r,s,o,a,l,c;if("y"===this.evalVisProp("axis")){for(d.Y()<f.Y()?(o=d.X(),l=d.Y(),a=f.X(),c=f.Y()):(o=f.X(),l=f.Y(),a=d.X(),c=d.Y()),r=Math.min(o,a),s=Math.max(o,a),t=[0,o],e=[l,l],i=0;i<n.numberPoints;i++)l<=n.points[i].usrCoords[2]&&r<=n.points[i].usrCoords[1]&&n.points[i].usrCoords[2]<=c&&n.points[i].usrCoords[1]<=s&&(t.push(n.points[i].usrCoords[1]),e.push(n.points[i].usrCoords[2]));t.push(a),e.push(c),t.push(0),e.push(c),t.push(0),e.push(l)}else{for(p.X()<m.X()?(r=p.X(),s=m.X()):(r=m.X(),s=p.X()),t=[r,r],e=[0,n.Y(r)],i=0;i<n.numberPoints;i++)r<=n.points[i].usrCoords[1]&&n.points[i].usrCoords[1]<=s&&(t.push(n.points[i].usrCoords[1]),e.push(n.points[i].usrCoords[2]));t.push(s),e.push(n.Y(s)),t.push(s),e.push(0),t.push(r),e.push(0)}this.dataX=t,this.dataY=e},d.addChild(_),f.addChild(_),p.addChild(_),m.addChild(_),_.baseLeft=p,_.baseRight=m,_.curveLeft=d,_.curveRight=f,_.methodMap=jxg.A.deepCopy(_.methodMap,{curveLeft:"curveLeft",baseLeft:"baseLeft",curveRight:"curveRight",baseRight:"baseRight",Value:"Value"}),_.label=v,_},jxg.A.createInequality=function(t,e,i){var r,n,s;if(s=utils_type.A.copyAttributes(i,t.options,"inequality"),e[0].elementClass===constants.A.OBJECT_CLASS_LINE)(n=t.create("curve",[[],[]],s)).hasPoint=function(){return!1},n.updateDataArray=function(){var i,r,n,s=t.getBoundingBox(),o=this.evalVisProp("inverse"),a=o?-1:1,l=1.5*Math.max(s[2]-s[0],s[1]-s[3]),c={coords:{usrCoords:[1,.5*(s[0]+s[2]),o?s[1]:s[3]]}},h=e[0].stdform.slice(1),u=h;n=1.5*Math.max(geometry.A.perpendicular(e[0],c,t)[0].distance(constants.A.COORDS_BY_USER,c.coords),l),n*=a,c={coords:{usrCoords:[1,.5*(s[0]+s[2]),.5*(s[1]+s[3])]}},i=[1,(c=Math.abs(math.A.innerProduct(c.coords.usrCoords,e[0].stdform,3))>=math.A.eps?geometry.A.perpendicular(e[0],c,t)[0].usrCoords:c.coords.usrCoords)[1]+h[1]*l,c[2]-h[0]*l],r=[1,c[1]-u[1]*l,c[2]+u[0]*l],this.dataX=[i[1],i[1]+h[0]*n,r[1]+u[0]*n,r[1],i[1]],this.dataY=[i[2],i[2]+h[1]*n,r[2]+u[1]*n,r[2],i[2]]};else if(e[0].elementClass===constants.A.OBJECT_CLASS_CURVE&&"functiongraph"===e[0].visProp.curvetype)(n=t.create("curve",[[],[]],s)).updateDataArray=function(){var t,i,r,n,s,o,a,l,c,h=this.board.getBoundingBox(),u=[],d=e[0].minX(),p=e[0].maxX(),f=.3*(h[1]-h[3]);if(t=this.evalVisProp("inverse")?1:3,this.dataX=[],this.dataY=[],0!==(n=e[0].points.length))for(h[1]+=f,h[3]-=f,r=-1;r<n-1;){for(s=r+1,i=n;s<n;s++)if(e[0].points[s].isReal()){i=s;break}if(i>=n)break;for(s=i,r=n-1;s<n-1;s++)if(!e[0].points[s+1].isReal()){r=s;break}for(l=e[0].points[i].usrCoords[1],c=e[0].points[r].usrCoords[1],o=h[0]<d?d:h[0],a=h[2]>p?p:h[2],o=0===i?o:Math.max(o,l),a=r===n-1?a:Math.min(a,c),a=r===n-1?p:c,(u=[]).push([1,o=0===i?d:l,h[t]]),u.push([1,o,e[0].points[i].usrCoords[2]]),s=i;s<=r;s++)u.push(e[0].points[s].usrCoords);for(u.push([1,a,e[0].points[r].usrCoords[2]]),u.push([1,a,h[t]]),u.push(u[0]),s=0;s<u.length;s++)this.dataX.push(u[s][1]),this.dataY.push(u[s][2]);r<n-1&&(this.dataX.push(NaN),this.dataY.push(NaN))}},n.hasPoint=function(){return!1};else if(r=utils_type.A.createFunction(e[0]),n.addParentsFromJCFunctions([r]),!utils_type.A.exists(r))throw new Error("JSXGraph: Can't create area with the given parents.\nPossible parent types: [line], [function]");return n.addParents(e[0]),n},jxg.A.registerElement("arrowparallel",jxg.A.createArrowParallel),jxg.A.registerElement("bisector",jxg.A.createBisector),jxg.A.registerElement("bisectorlines",jxg.A.createAngularBisectorsOfTwoLines),jxg.A.registerElement("msector",jxg.A.createMsector),jxg.A.registerElement("circumcircle",jxg.A.createCircumcircle),jxg.A.registerElement("circumcirclemidpoint",jxg.A.createCircumcenter),jxg.A.registerElement("circumcenter",jxg.A.createCircumcenter),jxg.A.registerElement("incenter",jxg.A.createIncenter),jxg.A.registerElement("incircle",jxg.A.createIncircle),jxg.A.registerElement("integral",jxg.A.createIntegral),jxg.A.registerElement("midpoint",jxg.A.createMidpoint),jxg.A.registerElement("mirrorelement",jxg.A.createMirrorElement),jxg.A.registerElement("mirrorpoint",jxg.A.createMirrorPoint),jxg.A.registerElement("orthogonalprojection",jxg.A.createOrthogonalProjection),jxg.A.registerElement("parallel",jxg.A.createParallel),jxg.A.registerElement("parallelpoint",jxg.A.createParallelPoint),jxg.A.registerElement("perpendicular",jxg.A.createPerpendicular),jxg.A.registerElement("perpendicularpoint",jxg.A.createPerpendicularPoint),jxg.A.registerElement("perpendicularsegment",jxg.A.createPerpendicularSegment),jxg.A.registerElement("reflection",jxg.A.createReflection),jxg.A.registerElement("inequality",jxg.A.createInequality),jxg.A.createGrid=function(t,e,i){var r,n,s,o,a,l,c,h,u=math.A.eps,d=5e3,p=[],f=[];if((s=e).length>2||s.length>=1&&"axis"!==s[0].elType||s.length>=2&&"axis"!==s[1].elType)throw new Error("JSXGraph: Can't create 'grid' with parent type '"+e[0].elType+"'. Possible parent types: [axis,axis]");return!utils_type.A.exists(s[0])&&utils_type.A.exists(t.defaultAxes)&&(s[0]=t.defaultAxes.x),!utils_type.A.exists(s[1])&&utils_type.A.exists(t.defaultAxes)&&(s[1]=t.defaultAxes.y),h=function(t,e,i,r,n,s,o){var a,l,c,h,u,d,p;switch(t.toLowerCase()){case".":case"point":return e.visProp.linecap="round",e.visProp.strokewidth=n*e.board.unitX+s*e.board.unitY,[[i,i,NaN],[r,r,NaN]];case"o":case"circle":return e.visProp.linecap="square",e.bezierDegree=3,[[i+n,i+n,i+(l=4*Math.tan(Math.PI/8)/3)*n,i,i-l*n,i-n,i-n,i-n,i-l*n,i,i+l*n,i+n,i+n,NaN],[r,r+l*s,r+s,r+s,r+s,r+l*s,r,r-l*s,r-s,r-s,r-s,r-l*s,r,NaN]];case"regpol":case"regularpolygon":for(e.visProp.linecap="round",h=e.evalVisProp("polygonvertices"),u=[[],[]],a=0;a<=2*Math.PI;a+=2*Math.PI/h)u[0].push(i-n*Math.sin(a)),u[1].push(r-s*Math.cos(a));return u[0].push(NaN),u[1].push(NaN),u;case"[]":case"square":return e.visProp.linecap="square",[[i-n,i+n,i+n,i-n,i-n,NaN],[r+s,r+s,r-s,r-s,r+s,NaN]];case"<>":case"diamond":return e.visProp.linecap="square",[[i,i+n,i,i-n,i,NaN],[r+s,r,r-s,r,r+s,NaN]];case"<<>>":case"diamond2":return e.visProp.linecap="square",[[i,i+(d=n*Math.sqrt(2)),i,i-d,i,NaN],[r+(p=s*Math.sqrt(2)),r,r-p,r,r+p,NaN]];case"x":case"cross":return[[i-n,i+n,NaN,i-n,i+n,NaN],[r+s,r-s,NaN,r-s,r+s,NaN]];case"+":case"plus":return[[i-n,i+n,NaN,i,i,NaN],[r,r,NaN,r-s,r+s,NaN]];case"-":case"minus":return[[i-n,i+n,NaN],[r,r,NaN]];case"|":case"divide":return[[i,i,NaN],[r-s,r+s,NaN]];case"^":case"a":case"A":case"triangleup":return[[i-n,i,i+n,NaN],[r-s,r,r-s,NaN]];case"v":case"triangledown":return[[i-n,i,i+n,NaN],[r+s,r,r+s,NaN]];case"<":case"triangleleft":return[[i+n,i,i+n,NaN],[r+s,r,r-s,NaN]];case">":case"triangleright":return[[i-n,i,i-n,NaN],[r+s,r,r-s,NaN]];case"line":return c=e.evalVisProp("margin"),[[i,i,NaN,o[0]-c/e.board.unitX,o[2]+c/e.board.unitX,NaN],[o[1]+c/e.board.unitY,o[3]-c/e.board.unitY,NaN,r,r,NaN]];default:return[[],[]]}},o=utils_type.A.copyAttributes(i,t.options,"grid"),utils_type.A.mergeAttr(o,o.themes[o.theme],!1),a={},utils_type.A.mergeAttr(a,o,!0,!0),utils_type.A.mergeAttr(a,o.major,!0,!0),(r=t.create("curve",[[null],[null]],a)).elType="grid",r.type=constants.A.OBJECT_TYPE_GRID,l={},utils_type.A.mergeAttr(l,o,!0,!0),utils_type.A.mergeAttr(l,o.minor,!0,!0),l.id===a.id&&(l.id=r.id+"_minor"),l.name===a.name&&(l.name=r.name+"_minor"),(n=t.create("curve",[[null],[null]],l)).elType="grid",n.type=constants.A.OBJECT_TYPE_GRID,r.minorGrid=n,n.majorGrid=r,r.hasPoint=function(){return!1},n.hasPoint=function(){return!1},r.inherits.push(n),r.updateDataArray=function(){var t,e,i,n,o,a,l,m,g=this.board.getBoundingBox(),_=this.evalVisProp("gridx"),v=this.evalVisProp("gridy"),y=this.evalVisProp("face"),b=this.evalVisProp("drawzero"),A=!0===b||utils_type.A.isObject(b)&&!0===this.eval(b.origin),x=!0===b||utils_type.A.isObject(b)&&!0===this.eval(b.x),C=!0===b||utils_type.A.isObject(b)&&!0===this.eval(b.y),E=this.evalVisProp("includeboundaries"),M=this.evalVisProp("forcesquare");if(this.dataX=[],this.dataY=[],c=this.evalVisProp("majorstep"),utils_type.A.isArray(c)||(c=[c,c]),c.length<2&&(c=[c[0],c[0]]),utils_type.A.exists(_)&&(jxg.A.deprecated("gridX","majorStep"),c[0]=_),utils_type.A.exists(v)&&(jxg.A.deprecated("gridY","majorStep"),c[1]=v),"auto"===c[0]?(m=Math.pow(10,Math.floor(Math.log(50/this.board.unitX)/Math.LN10)),c[0]=m,utils_type.A.exists(s[0])&&(c[0]=s[0].ticks[0].getDistanceMajorTicks())):c[0]=utils_type.A.parseNumber(c[0],Math.abs(g[1]-g[3]),1/this.board.unitX),"auto"===c[1]?(m=Math.pow(10,Math.floor(Math.log(50/this.board.unitY)/Math.LN10)),c[1]=m,utils_type.A.exists(s[1])&&(c[1]=s[1].ticks[0].getDistanceMajorTicks())):c[1]=utils_type.A.parseNumber(c[1],Math.abs(g[0]-g[2]),1/this.board.unitY),"min"===M||!0===M?c[0]*this.board.unitX<=c[1]*this.board.unitY?c[1]=c[0]/this.board.unitY*this.board.unitX:c[0]=c[1]/this.board.unitX*this.board.unitY:"max"===M&&(c[0]*this.board.unitX<=c[1]*this.board.unitY?c[0]=c[1]/this.board.unitX*this.board.unitY:c[1]=c[0]/this.board.unitY*this.board.unitX),p=this.evalVisProp("size"),utils_type.A.isArray(p)||(p=[p,p]),p.length<2&&(p=[p[0],p[0]]),utils_type.A.isNumber(p[0],!0)&&(p[0]=p[0]+"px"),utils_type.A.isNumber(p[1],!0)&&(p[1]=p[1]+"px"),p[0]=utils_type.A.parseNumber(p[0],c[0],1/this.board.unitX),p[1]=utils_type.A.parseNumber(p[1],c[1],1/this.board.unitY),f[0]=p[0]/2,f[1]=p[1]/2,t=math.A.roundToStep(g[0],c[0]),e=math.A.roundToStep(g[1],c[1]),l=isFinite(t)&&isFinite(e)&&isFinite(g[2])&&isFinite(g[3])&&Math.abs(g[2])<Math.abs(c[0]*d)&&Math.abs(g[3])<Math.abs(c[1]*d),"line"===y.toLowerCase()){for(o=r.evalVisProp("margin"),n=e;l&&n>=g[3];n-=c[1])!A&&Math.abs(n)<u||!C&&Math.abs(n)<u||!E&&(n<=g[3]+f[1]||n>=g[1]-f[1])||(a=[[g[0]-o/r.board.unitX,g[2]+o/r.board.unitX,NaN],[n,n,NaN]],utils_type.A.concat(this.dataX,a[0]),utils_type.A.concat(this.dataY,a[1]));for(i=t;l&&i<=g[2];i+=c[0])!A&&Math.abs(i)<u||!x&&Math.abs(i)<u||!E&&(i<=g[0]+f[0]||i>=g[2]-f[0])||(a=[[i,i,NaN],[g[1]+o/r.board.unitY,g[3]-o/r.board.unitY,NaN]],utils_type.A.concat(this.dataX,a[0]),utils_type.A.concat(this.dataY,a[1]))}else for(n=e;l&&n>=g[3];n-=c[1])for(i=t;l&&i<=g[2];i+=c[0])!A&&Math.abs(n)<u&&Math.abs(i)<u||!x&&Math.abs(n)<u&&Math.abs(i)>=u||!C&&Math.abs(i)<u&&Math.abs(n)>=u||!E&&(i<=g[0]+f[0]||i>=g[2]-f[0]||n<=g[3]+f[1]||n>=g[1]-f[1])||(a=h(y,r,i,n,f[0],f[1],g),utils_type.A.concat(this.dataX,a[0]),utils_type.A.concat(this.dataY,a[1]))},n.updateDataArray=function(){var t,e,i,r,o,a,l,p,m,g,_,v,y,b,A,x,C,E,M,S=this.board.getBoundingBox(),w=[],P=[],T=this.evalVisProp("minorelements"),O=this.evalVisProp("size"),R=this.evalVisProp("face"),N=this.evalVisProp("drawzero"),L=!0===N||utils_type.A.isObject(N)&&!0===this.eval(N.x),D=!0===N||utils_type.A.isObject(N)&&!0===this.eval(N.y),k=this.majorGrid.evalVisProp("face"),I=this.majorGrid.evalVisProp("drawzero"),B=!0===I||utils_type.A.isObject(I)&&!0===this.eval(I.origin),U=!0===I||utils_type.A.isObject(I)&&!0===this.eval(I.x),F=!0===I||utils_type.A.isObject(I)&&!0===this.eval(I.y),j=this.evalVisProp("includeboundaries");if(this.dataX=[],this.dataY=[],utils_type.A.isArray(T)||(T=[T,T]),T.length<2&&(T=[T[0],T[0]]),utils_type.A.isNumber(T[0],!0)?T[0]=parseFloat(T[0]):(T[0]=3,utils_type.A.exists(s[0])&&(T[0]=s[0].eval(s[0].getAttribute("ticks").minorticks))),w[0]=c[0]/(T[0]+1),utils_type.A.isNumber(T[1],!0)?T[1]=parseFloat(T[1]):(T[1]=3,utils_type.A.exists(s[1])&&(T[1]=s[1].eval(s[1].getAttribute("ticks").minorticks))),w[1]=c[1]/(T[1]+1),utils_type.A.isArray(O)||(O=[O,O]),O.length<2&&(O=[O[0],O[0]]),utils_type.A.isNumber(O[0],!0)&&(O[0]=O[0]+"px"),utils_type.A.isNumber(O[1],!0)&&(O[1]=O[1]+"px"),O[0]=utils_type.A.parseNumber(O[0],w[0],1/this.board.unitX),O[1]=utils_type.A.parseNumber(O[1],w[1],1/this.board.unitY),P[0]=.5*O[0],P[1]=.5*O[1],t=math.A.roundToStep(S[0],w[0]),e=math.A.roundToStep(S[1],w[1]),l=isFinite(t)&&isFinite(e)&&isFinite(S[2])&&isFinite(S[3])&&Math.abs(S[2])<=Math.abs(w[0]*d)&&Math.abs(S[3])<Math.abs(w[1]*d),"line"!==R.toLowerCase())for(r=e;l&&r>=S[3];r-=w[1])for(i=t;l&&i<=S[2];i+=w[0]){if(p=math.A.roundToStep(Math.abs(i),c[0]),p=Math.abs(p-Math.abs(i)),m=c[0]-p,g=math.A.roundToStep(Math.abs(r),c[1]),g=Math.abs(g-Math.abs(r)),_=c[1]-g,"line"===k){if(p-P[0]-f[0]<u||m-P[0]-f[0]<u||g-P[1]-f[1]<u||_-P[1]-f[1]<u)continue}else if((p-P[0]-f[0]<u||m-P[0]-f[0]<u)&&(g-P[1]-f[1]<u||_-P[1]-f[1]<u)&&(B||f[1]-Math.abs(r)+P[1]<u||f[0]-Math.abs(i)+P[0]<u)&&(U||f[1]-Math.abs(r)+P[1]<u||f[0]+Math.abs(i)-P[0]<u)&&(F||f[0]-Math.abs(i)+P[0]<u||f[1]+Math.abs(r)-P[1]<u))continue;!D&&Math.abs(i)<u||!L&&Math.abs(r)<u||(v=Math.abs(S[0]%c[0]),y=Math.abs(S[1]%c[1]),b=Math.abs(S[2]%c[0]),A=Math.abs(S[3]%c[1]),x=c[0]-v,C=c[1]-y,E=c[0]-b,M=c[1]-A,!j&&(i-P[0]-S[0]-f[0]+x<u&&x-f[0]<u||i-P[0]-S[0]-f[0]-v<u&&v-f[0]<u||-i-P[0]+S[2]-f[0]+E<u&&E-f[0]<u||-i-P[0]+S[2]-f[0]-b<u&&b-f[0]<u||-r-P[1]+S[1]-f[1]+C<u&&C-f[1]<u||-r-P[1]+S[1]-f[1]-y<u&&y-f[1]<u||r-P[1]-S[3]-f[1]+M<u&&M-f[1]<u||r-P[1]-S[3]-f[1]-A<u&&A-f[1]<u||-r-P[1]+S[1]<u||i-P[0]-S[0]<u||r-P[1]-S[3]<u||-i-P[0]+S[2]<u)||(a=h(R,n,i,r,P[0],P[1],S),utils_type.A.concat(this.dataX,a[0]),utils_type.A.concat(this.dataY,a[1])))}else{for(o=n.evalVisProp("margin"),r=e;l&&r>=S[3];r-=w[1]){if(g=math.A.roundToStep(Math.abs(r),c[1]),g=Math.abs(g-Math.abs(r)),_=c[1]-g,"line"===k){if(g-P[1]-f[1]<u||_-P[1]-f[1]<u)continue}else if((g-P[1]-f[1]<u||_-P[1]-f[1]<u)&&(B||f[1]-Math.abs(r)+P[1]<u)&&(U||f[1]-Math.abs(r)+P[1]<u)&&(F||f[1]+Math.abs(r)-P[1]<u))continue;!L&&Math.abs(r)<u||(v=Math.abs(S[0]%c[0]),y=Math.abs(S[1]%c[1]),b=Math.abs(S[2]%c[0]),A=Math.abs(S[3]%c[1]),x=c[0]-v,C=c[1]-y,E=c[0]-b,M=c[1]-A,!j&&(-r-P[1]+S[1]-f[1]+C<u&&C-f[1]<u||-r-P[1]+S[1]-f[1]-y<u&&y-f[1]<u||r-P[1]-S[3]-f[1]+M<u&&M-f[1]<u||r-P[1]-S[3]-f[1]-A<u&&A-f[1]<u||-r-P[1]+S[1]<u||r-P[1]-S[3]<u)||(a=[[S[0]-o/n.board.unitX,S[2]+o/n.board.unitX,NaN],[r,r,NaN]],utils_type.A.concat(this.dataX,a[0]),utils_type.A.concat(this.dataY,a[1])))}for(i=t;l&&i<=S[2];i+=w[0]){if(p=math.A.roundToStep(Math.abs(i),c[0]),p=Math.abs(p-Math.abs(i)),m=c[0]-p,"line"===k){if(p-P[0]-f[0]<u||m-P[0]-f[0]<u)continue}else if((p-P[0]-f[0]<u||m-P[0]-f[0]<u)&&(B||f[0]-Math.abs(i)+P[0]<u)&&(U||f[0]+Math.abs(i)-P[0]<u)&&(F||f[0]-Math.abs(i)+P[0]<u))continue;!D&&Math.abs(i)<u||(v=Math.abs(S[0]%c[0]),y=Math.abs(S[1]%c[1]),b=Math.abs(S[2]%c[0]),A=Math.abs(S[3]%c[1]),x=c[0]-v,C=c[1]-y,E=c[0]-b,M=c[1]-A,!j&&(i-P[0]-S[0]-f[0]+x<u&&x-f[0]<u||i-P[0]-S[0]-f[0]-v<u&&v-f[0]<u||-i-P[0]+S[2]-f[0]+E<u&&E-f[0]<u||-i-P[0]+S[2]-f[0]-b<u&&b-f[0]<u||i-P[0]-S[0]<u||-i-P[0]+S[2]<u)||(a=[[i,i,NaN],[S[1]+o/n.board.unitY,S[3]-o/n.board.unitY,NaN]],utils_type.A.concat(this.dataX,a[0]),utils_type.A.concat(this.dataY,a[1])))}}},t.grids.push(r),t.grids.push(n),n.dump=!1,r.getParents=n.getParents=function(){return s.slice()},r},jxg.A.registerElement("grid",jxg.A.createGrid);var base_text=__webpack_require__(30);jxg.A.Image=function(t,e,i,r,n){this.constructor(t,i,constants.A.OBJECT_TYPE_IMAGE,constants.A.OBJECT_CLASS_OTHER),this.element=this.board.select(i.anchor),this.coordsConstructor(e),this.W=utils_type.A.createFunction(n[0],this.board,""),this.H=utils_type.A.createFunction(n[1],this.board,""),this.addParentsFromJCFunctions([this.W,this.H]),this.usrSize=[this.W(),this.H()],this.size=[Math.abs(this.usrSize[0]*t.unitX),Math.abs(this.usrSize[1]*t.unitY)],this.url=r,this.elType="image",this.span=[this.coords.usrCoords.slice(0),[this.coords.usrCoords[0],this.W(),0],[this.coords.usrCoords[0],0,this.H()]],this.id=this.board.setId(this,"Im"),this.board.renderer.drawImage(this),this.board.finalizeAdding(this),this.methodMap=jxg.A.deepCopy(this.methodMap,{addTransformation:"addTransform",trans:"addTransform",W:"W",Width:"W",H:"H",Height:"H",setSize:"setSize"})},jxg.A.Image.prototype=new base_element.A,utils_type.A.copyPrototypeMethods(jxg.A.Image,coordselement.A,"coordsConstructor"),jxg.A.extend(jxg.A.Image.prototype,{hasPoint:function(t,e){var i,r,n,s,o,a,l,c,h,u=this.transformations.length;return utils_type.A.isObject(this.evalVisProp("precision"))?(s=this.board._inputDevice,o=this.evalVisProp("precision."+s)):o=this.board.options.precision.hasPoint,0===u?(i=t-this.coords.scrCoords[1],r=this.coords.scrCoords[2]-e,i>=-(n=o)&&i-this.size[0]<=n&&r>=-n&&r-this.size[1]<=n):(l=[(a=(a=new base_coords.A(constants.A.COORDS_BY_SCREEN,[t,e],this.board)).usrCoords)[0]-this.span[0][0],a[1]-this.span[0][1],a[2]-this.span[0][2]],0<=(c=(h=math.A.innerProduct)(l,this.span[1]))&&c<=h(this.span[1],this.span[1])&&0<=(c=h(l,this.span[2]))&&c<=h(this.span[2],this.span[2]))},update:function(t){return this.needsUpdate?(this.updateCoords(t),this.updateSize(),this.updateSpan(),this):this},updateRenderer:function(){return this.updateRendererGeneric("updateImage")},updateSize:function(){return this.usrSize=[this.W(),this.H()],this.size=[Math.abs(this.usrSize[0]*this.board.unitX),Math.abs(this.usrSize[1]*this.board.unitY)],this},updateSpan:function(){var t,e,i=this.transformations.length,r=[];if(0===i)this.span=[[this.Z(),this.X(),this.Y()],[this.Z(),this.W(),0],[this.Z(),0,this.H()]];else{for(r[0]=[this.Z(),this.X(),this.Y()],r[1]=[this.Z(),this.X()+this.W(),this.Y()],r[2]=[this.Z(),this.X(),this.Y()+this.H()],t=0;t<i;t++)for(e=0;e<3;e++)r[e]=math.A.matVecMult(this.transformations[t].matrix,r[e]);for(e=0;e<3;e++)r[e][1]/=r[e][0],r[e][2]/=r[e][0],r[e][0]/=r[e][0];for(e=1;e<3;e++)r[e][0]-=r[0][0],r[e][1]-=r[0][1],r[e][2]-=r[0][2];this.span=r}return this},addTransform:function(t){var e;if(utils_type.A.isArray(t))for(e=0;e<t.length;e++)this.transformations.push(t[e]);else this.transformations.push(t);return this},getParents:function(){var t=[this.url,[this.Z(),this.X(),this.Y()],this.usrSize];return 0!==this.parents.length&&(t=this.parents),t},setSize:function(t,e){return this.W=utils_type.A.createFunction(t,this.board,""),this.H=utils_type.A.createFunction(e,this.board,""),this.addParentsFromJCFunctions([this.W,this.H]),this},W:function(){},H:function(){}}),jxg.A.createImage=function(t,e,i){var r,n,s=e[0],o=e[1],a=e[2];if(r=utils_type.A.copyAttributes(i,t.options,"image"),!(n=coordselement.A.create(jxg.A.Image,t,o,r,s,a)))throw new Error("JSXGraph: Can't create image with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [x,y], [z,x,y], [element,transformation]");return 0!==r.rotate&&n.addRotation(r.rotate),n},jxg.A.registerElement("image",jxg.A.createImage);const base_image=jxg.A.Image;jxg.A.createSlider=function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p,f,m,g,_,v,y,b,A,x,C,E,M;return y=(M=utils_type.A.copyAttributes(i,t.options,"slider")).withticks,v=M.withlabel,x=M.snapwidth,b=M.snapvalues,A=M.snapvaluedistance,c=t.create("point",e[0],M.point1),h=t.create("point",e[1],M.point2),(d=t.create("segment",[c,h],M.baseline)).updateStdform(),r=c.coords.usrCoords.slice(1),n=h.coords.usrCoords.slice(1),s=e[2][0],o=e[2][1],a=e[2][2],l=a-s,E=-1===(C=utils_type.A.evaluate(x))?o:Math.round((o-s)/C)*C+s,g=r[0]+(n[0]-r[0])*(E-s)/(a-s),_=r[1]+(n[1]-r[1])*(E-s)/(a-s),M.withlabel=!1,(u=t.create("glider",[g,_,d],M)).setAttribute({snapwidth:x,snapvalues:b,snapvaluedistance:A}),p=t.create("segment",[c,u],M.highline),u.Value=function(){var t=this._smax-this._smin,e=this.evalVisProp("snapwidth");return-1===e?this.position*t+this._smin:Math.round(this.position*t/e)*e+this._smin},u.methodMap=utils_type.A.deepCopy(u.methodMap,{Value:"Value",setValue:"setValue",smax:"_smax",smin:"_smin",setMax:"setMax",setMin:"setMin",point1:"point1",point2:"point2",baseline:"baseline",highline:"highline",ticks:"ticks",label:"label"}),u._smax=a,u._smin=s,u.setMax=function(t){return this._smax=t,this},u.setValue=function(t){var e=this._smax-this._smin;return Math.abs(e)>math.A.eps?this.position=(t-this._smin)/e:this.position=0,this.position=Math.max(0,Math.min(1,this.position)),this},u.setMin=function(t){return this._smin=t,this},v&&(m=t.create("text",[function(){return.05*(h.X()-c.X())+h.X()},function(){return.05*(h.Y()-c.Y())+h.Y()},function(){var t,e=u.evalVisProp("digits"),i=u.evalVisProp("suffixlabel"),r=u.evalVisProp("unitlabel"),n=u.evalVisProp("postlabel");return 2===e&&2!==u.evalVisProp("precision")&&(e=u.evalVisProp("precision")),t=null!==i?i:u.name&&""!==u.name?u.name+" = ":"",u.useLocale()?t+=u.formatNumberLocale(u.Value(),e):t+=utils_type.A.toFixed(u.Value(),e),null!==r&&(t+=r),null!==n&&(t+=n),t}],M.label),u.label=m,u.visProp.withlabel=!0,u.hasLabel=!0),u.point1=c,u.point2=h,u.baseline=d,u.highline=p,y&&(utils_type.A.exists(M.generatelabeltext)||(M.ticks.generateLabelText=function(t,e,i){var r=u.point1.Dist(u.point2),n=u._smin,s=u._smax,o=this.getDistanceFromZero(e,t)*(s-n)/r+n;return r<math.A.eps||Math.abs(o)<math.A.eps?"0":this.formatLabelText(o)}),f=t.create("ticks",[u.baseline,u.point1.Dist(c)/2,function(t){var e=u.point1.Dist(u.point2),i=u.point1.coords.distance(constants.A.COORDS_BY_USER,t);return e<math.A.eps?0:i/e*l+s}],M.ticks),u.ticks=f),u.remove=function(){v&&t.removeObject(m),t.removeObject(p),t.removeObject(d),t.removeObject(h),t.removeObject(c),point.prototype.remove.call(u)},c.dump=!1,h.dump=!1,d.dump=!1,p.dump=!1,v&&(m.dump=!1),u.elType="slider",u.parents=e,u.subs={point1:c,point2:h,baseLine:d,highLine:p},u.inherits.push(c,h,d,p),d.inherits=[],p.inherits=[],y&&(f.dump=!1,u.subs.ticks=f,u.inherits.push(f)),u.getParents=function(){return[this.point1.coords.usrCoords.slice(1),this.point2.coords.usrCoords.slice(1),[this._smin,this.position*(this._smax-this._smin)+this._smin,this._smax]]},u.baseline.on("up",(function(t){var e,i;u.evalVisProp("moveonup")&&!u.evalVisProp("fixed")&&(e=d.board.getMousePosition(t,0),i=new base_coords.A(constants.A.COORDS_BY_SCREEN,e,this.board),u.moveTo([i.usrCoords[1],i.usrCoords[2]]),u.triggerEventHandlers(["drag"],[t]))})),u.prepareUpdate().update(),t.isSuspendedUpdate||(u.updateVisibility().updateRenderer(),u.baseline.updateVisibility().updateRenderer(),u.highline.updateVisibility().updateRenderer(),y&&u.ticks.updateVisibility().updateRenderer()),u},jxg.A.registerElement("slider",jxg.A.createSlider),jxg.A.PrefixParser={parse:function(t,e){var i,r,n,s,o,a;if(utils_type.A.isNumber(t)||utils_type.A.isString(t))return t;if(!utils_type.A.isArray(t)||t.length<2)throw new Error("prefixParser.parse: term is not an array, number or string");if(i=t[0],n=t.length,"execute"===e)if(utils_type.A.isInArray(["+","-","*","/"],i))for(s=this.parse(t[1],e),r=2;r<n;r++)switch(a=this.parse(t[r],e),i){case"+":s+=a;break;case"-":s-=a;break;case"*":s*=a;break;case"/":s/=a}else if("exec"===i){for(o=t[1],a=[],r=2;r<n;r++)a.push(this.parse(t[r],e));if(utils_type.A.exists(Math[o]))s=Math[o].apply(this,a);else{if(!utils_type.A.exists(math.A[o]))throw new Error("PrefixParser.parse: "+o+" is not allowed");s=math.A[o].apply(this,a)}}else{if("V"===(o=t[0])&&(o="Value"),"Coords"===o&&(t[2]="true"),!utils_type.A.exists(t[1][o]))throw new Error("PrefixParser.parse: "+o+" is not a method of "+t[1]);for(a=[],r=2;r<n;r++)a.push(this.parse(t[r],e));s=t[1][o].apply(t[1],a)}return s},dimension:function(t){var e,i,r,n,s,o,a,l;if(utils_type.A.isNumber(t))return 0;if(!utils_type.A.isArray(t)||t.length<2)throw new Error("PrefixParser.dimension: term is not an array");if(e=t[0],r=t.length,utils_type.A.isInArray(["+","-","*","/"],e))for(n=this.dimension(t[1]),i=2;i<r;i++)switch(a=this.dimension(t[i]),e){case"+":case"-":a!==n&&(n=NaN);break;case"*":n+=a;break;case"/":n-=a}else if("exec"===e)t[2].type===utils_type.A.OBJECT_TYPE_MEASUREMENT?(n=t[2].Dimension(),utils_type.A.exists(t[2].visProp.dim)&&null!==(o=t[2].evalVisProp("dim"))&&(n=o)):n=0;else switch(s=t[0]){case"L":case"Length":case"Perimeter":case"Radius":case"R":n=1;break;case"Area":case"A":n=2;break;default:t[1].type===utils_type.A.OBJECT_TYPE_MEASUREMENT?(n=t[1].Dimension(),utils_type.A.exists(t[1].visProp.dim)&&null!==(o=t[1].evalVisProp("dim"))&&(n=o)):(n=0,"Value"!==s&&"V"!==s||[constants.A.OBJECT_TYPE_ARC,constants.A.OBJECT_TYPE_SECTOR,constants.A.OBJECT_TYPE_ANGLE].indexOf(t[1].type)>=0&&(l="",3===t.length&&utils_type.A.isString(t[2])&&(l=t[2].toLowerCase()),n=""===l?t[1].type===constants.A.OBJECT_TYPE_ANGLE?0:1:0===l.indexOf("len")?1:0))}return n},toPrefix:function(t){var e,i,r,n;if(utils_type.A.isNumber(t))return t;if(!utils_type.A.isArray(t)||t.length<2)throw new Error("PrefixParser.toPrefix: term is not an array");for(e=t[0],r=t.length,n=[e],i=1;i<r;i++)utils_type.A.isInArray(["+","-","*","/"],e)?n.push(this.toPrefix(t[i])):"V"===e&&t[i].type===utils_type.A.OBJECT_TYPE_MEASUREMENT?n=t[i].toPrefix():"exec"===e?1===i?n.push(t[i]):n.push(this.toPrefix(t[i])):n=[e,t[i].id];return n},getParents:function(t){var e,i,r,n;if(utils_type.A.isNumber(t))return[];if(!utils_type.A.isArray(t)||t.length<2)throw new Error("PrefixParser.getParents: term is not an array");for(e=t[0],r=t.length,n=[],i=1;i<r;i++)utils_type.A.isInArray(["+","-","*","/"],e)?utils_type.A.concat(n,this.getParents(t[i])):"V"===e&&t[i].type===utils_type.A.OBJECT_TYPE_MEASUREMENT?utils_type.A.concat(n,t[i].getParents()):"exec"===e?i>1&&utils_type.A.concat(n,this.getParents(t[i])):n.push(t[i]);return n}};const prefix=jxg.A.PrefixParser;jxg.A.createTapemeasure=function(t,e,i){var r,n,s,o,a,l,c,h,u,d;return r=e[0],n=e[1],s=utils_type.A.copyAttributes(i,t.options,"tapemeasure","point1"),c=t.create("point",r,s),s=utils_type.A.copyAttributes(i,t.options,"tapemeasure","point2"),h=t.create("point",n,s),c.setAttribute({ignoredSnapToPoints:[h.id]}),h.setAttribute({ignoredSnapToPoints:[c.id]}),s=utils_type.A.copyAttributes(i,t.options,"tapemeasure"),o=s.withticks,a=s.withlabel,2===s.digits&&2!==s.precision&&s.precision,a&&(s.withlabel=!0),l=t.create("segment",[c,h],s),a&&(u=i.name&&""!==i.name?i.name+" = ":"",l.label.setText((function(){var t=l.label.evalVisProp("digits");return l.label.useLocale()?u+l.label.formatNumberLocale(c.Dist(h),t):u+utils_type.A.toFixed(c.Dist(h),t)}))),o&&(s=utils_type.A.copyAttributes(i,t.options,"tapemeasure","ticks"),d=t.create("ticks",[l,.1],s),l.inherits.push(d)),l.remove=function(){o&&l.removeTicks(d),t.removeObject(h),t.removeObject(c),base_element.A.prototype.remove.call(this)},l.Value=function(){return c.Dist(h)},c.dump=!1,h.dump=!1,l.elType="tapemeasure",l.getParents=function(){return[[c.X(),c.Y()],[h.X(),h.Y()]]},l.subs={point1:c,point2:h},o&&(d.dump=!1),l.methodMap=jxg.A.deepCopy(l.methodMap,{Value:"Value"}),l.prepareUpdate().update(),t.isSuspendedUpdate||(l.updateVisibility().updateRenderer(),l.point1.updateVisibility().updateRenderer(),l.point2.updateVisibility().updateRenderer()),l},jxg.A.registerElement("tapemeasure",jxg.A.createTapemeasure),jxg.A.createMeasurement=function(t,e,i){var r,n,s,o,a,l;for(n=utils_type.A.copyAttributes(i,t.options,"measurement"),s=e[0],o=e[1],a=e[2],(r=t.create("text",[s,o,""],n)).type=utils_type.A.OBJECT_TYPE_MEASUREMENT,r.elType="measurement",r.Value=function(){return prefix.parse(a,"execute")},r.Dimension=function(){var t=r.evalVisProp("dim");return null!==t?t:prefix.dimension(a)},r.Unit=function(t){var e,i="",n=r.evalVisProp("units"),s=t,o={};if(utils_type.A.exists(s)||(s=r.Dimension()),utils_type.A.isArray(t)){for(e=0;e<t.length;e++)o["dim"+t[e]]=r.Unit(t[e]);return o}return utils_type.A.isObject(n)&&utils_type.A.exists(n[s])&&!1!==n[s]?i=r.eval(n[s]):utils_type.A.isObject(n)&&utils_type.A.exists(n["dim"+s])&&!1!==n["dim"+s]?i=r.eval(n["dim"+s]):(i=r.evalVisProp("baseunit"),0===s?i="":s>1&&""!==i&&(i=i+"^{"+s+"}")),i},r.getTerm=function(){return a},r.getMethod=function(){var t=a[0];return"V"===t&&(t="Value"),t},r.toPrefix=function(){return prefix.toPrefix(a)},r.getParents=function(){return prefix.getParents(a)},r.addParents(r.getParents()),l=0;l<r.parents.length;l++)t.select(r.parents[l]).addChild(r);return r.setText((function(){var t,e="",i="",n=r.Dimension(),s=r.evalVisProp("digits"),o=r.Unit(),a=r.Value();if(r.evalVisProp("showprefix")&&(e=r.evalVisProp("prefix")),r.evalVisProp("showsuffix")&&(i=r.evalVisProp("suffix")),utils_type.A.isNumber(a))"none"===s||(a="auto"===s?r.useLocale()?r.formatNumberLocale(a):utils_type.A.autoDigits(a):r.useLocale()?r.formatNumberLocale(a,s):utils_type.A.toFixed(a,s));else if(utils_type.A.isArray(a))for(t=0;t<a.length;t++)utils_type.A.isNumber(a[t])&&("none"===s||("auto"===s?r.useLocale()?a[t]=r.formatNumberLocale(a[t]):a[t]=utils_type.A.autoDigits(a[t]):r.useLocale()?a[t]=r.formatNumberLocale(a[t],s):a[t]=utils_type.A.toFixed(a[t],s)));return"coords"===n&&utils_type.A.isArray(a)&&(2===a.length&&a.unshift(void 0),a=r.visProp.formatcoords(r,a[1],a[2],a[0])),"direction"===n&&utils_type.A.isArray(a)&&(a=r.visProp.formatdirection(r,a[0],a[1])),utils_type.A.isString(n)?e+a+i:isNaN(n)?e+"NaN"+i:e+a+o+i})),r.methodMap=utils_type.A.deepCopy(r.methodMap,{Value:"Value",Dimension:"Dimension",Unit:"Unit",getTerm:"getTerm",Term:"getTerm",getMethod:"getMethod",Method:"getMethod",getParents:"getParents",Parents:"getParents"}),r},jxg.A.registerElement("measurement",jxg.A.createMeasurement),jxg.A.DataSource=function(){return this.data=[],this.columnHeaders=[],this.rowHeaders=[],this},jxg.A.extend(jxg.A.DataSource.prototype,{loadFromArray:function(t,e,i){var r,n,s;if(utils_type.A.isArray(e)&&(this.columnHeaders=e,e=!1),utils_type.A.isArray(i)&&(this.rowHeaders=i,i=!1),this.data=[],e&&(this.columnHeaders=[]),i&&(this.rowHeaders=[]),utils_type.A.exists(t)){for(this.data=[],r=0;r<t.length;r++)for(this.data[r]=[],n=0;n<t[r].length;n++)s=t[r][n],parseFloat(s).toString()===s?this.data[r][n]=parseFloat(s):this.data[r][n]="-"!==s?s:NaN;if(e&&(this.columnHeaders=this.data[0].slice(1),this.data=this.data.slice(1)),i)for(this.rowHeaders=[],r=0;r<this.data.length;r++)this.rowHeaders.push(this.data[r][0]),this.data[r]=this.data[r].slice(1)}return this},loadFromTable:function(t,e,i){var r,n,s,o,a;if(utils_type.A.isArray(e)&&(this.columnHeaders=e,e=!1),utils_type.A.isArray(i)&&(this.rowHeaders=i,i=!1),this.data=[],e&&(this.columnHeaders=[]),i&&(this.rowHeaders=[]),t=document.getElementById(t),utils_type.A.exists(t)){for(r=t.getElementsByTagName("tr"),this.data=[],n=0;n<r.length;n++)for(o=r[n].getElementsByTagName("td"),this.data[n]=[],s=0;s<o.length;s++)a=o[s].innerHTML,parseFloat(a).toString()===a?this.data[n][s]=parseFloat(a):this.data[n][s]="-"!==a?a:NaN;if(e&&(this.columnHeaders=this.data[0].slice(1),this.data=this.data.slice(1)),i)for(this.rowHeaders=[],n=0;n<this.data.length;n++)this.rowHeaders.push(this.data[n][0]),this.data[n]=this.data[n].slice(1)}return this},addColumn:function(t,e,i){throw new Error("not implemented")},addRow:function(t,e,i){throw new Error("not implemented")},getColumn:function(t){var e,i=[];if(utils_type.A.isString(t))for(e=0;e<this.columnHeaders.length;e++)if(t===this.columnHeaders[e]){t=e;break}for(e=0;e<this.data.length;e++)this.data[e].length>t&&(i[e]=parseFloat(this.data[e][t]));return i},getRow:function(t){var e,i;if(utils_type.A.isString(t))for(i=0;i<this.rowHeaders.length;i++)if(t===this.rowHeaders[i]){t=i;break}for(e=[],i=0;i<this.data[t].length;i++)e[i]=this.data[t][i];return e}});const datasource=jxg.A.DataSource;jxg.A.Chart=function(t,e,i){var r,n,s,o,a,l;if(this.constructor(t,i),!utils_type.A.isArray(e)||0===e.length)throw new Error("JSXGraph: Can't create a chart without data");if(this.elements=[],utils_type.A.isNumber(e[0]))for(n=e,r=[],s=0;s<n.length;s++)r[s]=s+1;else if(1===e.length&&utils_type.A.isArray(e[0]))for(n=e[0],r=[],l=utils_type.A.evaluate(n).length,s=0;s<l;s++)r[s]=s+1;else 2===e.length&&(l=Math.min(e[0].length,e[1].length),r=e[0].slice(0,l),n=e[1].slice(0,l));if(utils_type.A.isArray(n)&&0===n.length)throw new Error("JSXGraph: Can't create charts without data.");for(a=i.chartstyle.replace(/ /g,"").split(","),s=0;s<a.length;s++){switch(a[s]){case"bar":o=this.drawBar(t,r,n,i);break;case"line":o=this.drawLine(t,r,n,i);break;case"fit":o=this.drawFit(t,r,n,i);break;case"spline":o=this.drawSpline(t,r,n,i);break;case"pie":o=this.drawPie(t,n,i);break;case"point":o=this.drawPoints(t,r,n,i);break;case"radar":o=this.drawRadar(t,e,i)}this.elements.push(o)}return this.id=this.board.setId(this,"Chart"),this.elements},jxg.A.Chart.prototype=new base_element.A,jxg.A.extend(jxg.A.Chart.prototype,{drawLine:function(t,e,i,r){return r.fillcolor="none",r.highlightfillcolor="none",t.create("curve",[e,i],r)},drawSpline:function(t,e,i,r){return r.fillColor="none",r.highlightfillcolor="none",t.create("spline",[e,i],r)},drawFit:function(t,e,i,r){var n=r.degree;return n=Math.max(parseInt(n,10),1)||1,r.fillcolor="none",r.highlightfillcolor="none",t.create("functiongraph",[numerics.A.regressionPolynomial(n,e,i)],r)},drawBar:function(t,e,i,r){var n,s,o,a,l,c,h,u,d,p,f=[],m=[],g=function(t,i){return function(){return e[t]()-i*o}},_={fixed:!0,withLabel:!1,visible:!1,name:""};if((d=utils_type.A.copyAttributes(r,t.options,"chart"))&&d.width)o=d.width;else{if(e.length<=1)o=1;else for(o=e[1]-e[0],n=1;n<e.length-1;n++)o=e[n+1]-e[n]<o?e[n+1]-e[n]:o;o*=.8}for(p=utils_type.A.copyAttributes(r,t.options,"chart","label"),n=0;n<e.length;n++)utils_type.A.isFunction(e[n])?(a=g(n,-.5),l=g(n,0),c=g(n,.5)):(a=e[n]-.5*o,l=e[n],c=e[n]+.5*o),utils_type.A.isFunction(i[n])?i[n]():i[n],h=i[n],"horizontal"===d.dir?(m[0]=t.create("point",[0,a],_),m[1]=t.create("point",[h,a],_),m[2]=t.create("point",[h,c],_),m[3]=t.create("point",[0,c],_),utils_type.A.exists(d.labels)&&utils_type.A.exists(d.labels[n])&&(p.anchorX=function(t){return t.X()>=0?"left":"right"},p.anchorY="middle",s=t.create("text",[h,l,d.labels[n]],p))):(m[0]=t.create("point",[a,0],_),m[1]=t.create("point",[a,h],_),m[2]=t.create("point",[c,h],_),m[3]=t.create("point",[c,0],_),utils_type.A.exists(d.labels)&&utils_type.A.exists(d.labels[n])&&(p.anchorX="middle",p.anchorY=function(t){return t.Y()>=0?"bottom":"top"},s=t.create("text",[l,h,d.labels[n]],p))),utils_type.A.isArray(d.colors)&&(u=d.colors,d.fillcolor=u[n%u.length]),f[n]=t.create("polygon",m,d),utils_type.A.exists(d.labels)&&utils_type.A.exists(d.labels[n])&&(f[n].text=s,f[n].addChild(s));return f},drawPoints:function(t,e,i,r){var n,s=[],o=r.infoboxarray;for(r.fixed=!0,r.name="",n=0;n<e.length;n++)r.infoboxtext=!!o&&o[n%o.length],s[n]=t.create("point",[e[n],i[n]],r);return s},drawPie:function(t,e,i){var r,n,s=[],o=[],a=i.colors,l=i.highlightcolors,c=i.labels,h=i.radius||4,u=h,d=i.center||[0,0],p=d[0],f=d[1],m=function(t,i,r){return function(){var n,s,o,a=0;for(s=0;s<=t;s++)a+=parseFloat(utils_type.A.evaluate(e[s]));for(n=a,s=t+1;s<e.length;s++)n+=parseFloat(utils_type.A.evaluate(e[s]));return o=0!==n?2*Math.PI*a/n:0,u()*Math[i](o)+r}},g=function(t,e){var i=-this.point1.coords.usrCoords[1]+this.point2.coords.usrCoords[1],r=-this.point1.coords.usrCoords[2]+this.point2.coords.usrCoords[2];utils_type.A.exists(this.label)&&(this.label.rendNode.style.fontSize=e*this.label.evalVisProp("fontsize")+"px",this.label.fullUpdate()),this.point2.coords=new base_coords.A(constants.A.COORDS_BY_USER,[this.point1.coords.usrCoords[1]+i*t,this.point1.coords.usrCoords[2]+r*t],this.board),this.fullUpdate()},_=function(){this.highlighted||(this.highlighted=!0,this.board.highlightedObjects[this.id]=this,this.board.renderer.highlight(this),g.call(this,1.1,2))},v=function(){this.highlighted&&(this.highlighted=!1,this.board.renderer.noHighlight(this),g.call(this,.9090909,1))},y={fixed:!0,withLabel:!1,visible:!1,name:""};if(!utils_type.A.isArray(c))for(c=[],r=0;r<e.length;r++)c[r]="";for(utils_type.A.isFunction(h)||(u=function(){return h}),i.highlightonsector=i.highlightonsector||!1,i.straightfirst=!1,i.straightlast=!1,n=t.create("point",[p,f],y),s[0]=t.create("point",[function(){return u()+p},function(){return f}],y),r=0;r<e.length;r++)s[r+1]=t.create("point",[m(r,"cos",p),m(r,"sin",f)],y),i.name=c[r],i.withlabel=""!==i.name,i.fillcolor=a&&a[r%a.length],i.labelcolor=a&&a[r%a.length],i.highlightfillcolor=l&&l[r%l.length],o[r]=t.create("sector",[n,s[r],s[r+1]],i),i.highlightonsector&&(o[r].hasPoint=o[r].hasPointSector),i.highlightbysize&&(o[r].highlight=_,o[r].noHighlight=v);return{sectors:o,points:s,midpoint:n}},drawRadar:function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p,f,m,g,_,v,y,b,A,x,C,E,M,S,w,P,T,O,R,N,L,D,k,I,B,U,F,j,V,z,G,H,Y=e.length,X=function(){var t,e,i,r,n=this.evalVisProp("label.offset).slice(0");return t=this.point1.X(),e=this.point2.X(),i=this.point1.Y(),r=this.point2.Y(),e<t&&(n[0]=-n[0]),r<i&&(n[1]=-n[1]),this.setLabelRelativeCoords(n),new base_coords.A(constants.A.COORDS_BY_USER,[this.point2.X(),this.point2.Y()],this.board)},W=function(e,i){var r,n,s;return r=t.create("transform",[-(_[i]-m[i]),0],{type:"translate"}),n=t.create("transform",[A/(v[i]+g[i]-(_[i]-m[i])),1],{type:"scale"}),r.melt(n),s=t.create("transform",[e],{type:"rotate"}),r.melt(s),r};if(Y<=0)throw new Error("JSXGraph radar chart: no data");if(s=i.paramarray,!utils_type.A.exists(s))throw new Error("JSXGraph radar chart: need paramArray attribute");if((o=s.length)<=1)throw new Error("JSXGraph radar chart: need more than one param in paramArray");for(r=0;r<Y;r++)if(o!==e[r].length)throw new Error("JSXGraph radar chart: use data length equal to number of params ("+e[r].length+" != "+o+")");for(a=[],l=[],n=0;n<o;n++)a[n]=e[0][n],l[n]=a[n];for(r=1;r<Y;r++)for(n=0;n<o;n++)e[r][n]>a[n]&&(a[n]=e[r][n]),e[r][n]<l[n]&&(l[n]=e[r][n]);for(c=[],h=[],r=0;r<Y;r++)c[r]="",h[r]=[];for(u=[],d=[],p=i.startshiftratio||0,f=i.endshiftratio||0,r=0;r<o;r++)u[r]=(a[r]-l[r])*p,d[r]=(a[r]-l[r])*f;if(m=i.startshiftarray||u,g=i.endshiftarray||d,_=i.startarray||l,utils_type.A.exists(i.start))for(r=0;r<o;r++)_[r]=i.start;if(v=i.endarray||a,utils_type.A.exists(i.end))for(r=0;r<o;r++)v[r]=i.end;if(m.length!==o)throw new Error("JSXGraph radar chart: start shifts length is not equal to number of parameters");if(g.length!==o)throw new Error("JSXGraph radar chart: end shifts length is not equal to number of parameters");if(_.length!==o)throw new Error("JSXGraph radar chart: starts length is not equal to number of parameters");if(v.length!==o)throw new Error("JSXGraph radar chart: snds length is not equal to number of parameters");for(y=i.labelarray||c,b=i.colors,A=i.radius||10,G=i.strokewidth||1,utils_type.A.exists(i.highlightonsector)||(i.highlightonsector=!1),x={name:i.name,id:i.id,strokewidth:G,polystrokewidth:i.polystrokewidth||G,strokecolor:i.strokecolor||"black",straightfirst:!1,straightlast:!1,fillcolor:i.fillColor||"#FFFF88",fillopacity:i.fillOpacity||.4,highlightfillcolor:i.highlightFillColor||"#FF7400",highlightstrokecolor:i.highlightStrokeColor||"black",gradient:i.gradient||"none"},E=(C=i.center||[0,0])[0],M=C[1],S=t.create("point",[E,M],{name:"",fixed:!0,withlabel:!1,visible:!1}),Math.PI,Math.PI,P=w=i.startangle||0,T=[],O=[],r=0;r<o;r++)for(P+=2*Math.PI/o,N=A*Math.cos(P)+E,L=A*Math.sin(P)+M,T[r]=t.create("point",[N,L],{name:"",fixed:!0,withlabel:!1,visible:!1}),O[r]=t.create("line",[S,T[r]],{name:s[r],strokeColor:x.strokecolor,strokeWidth:x.strokewidth,strokeOpacity:1,straightFirst:!1,straightLast:!1,withLabel:!0,highlightStrokeColor:x.highlightstrokecolor}),O[r].getLabelAnchor=X,R=W(P,r),n=0;n<e.length;n++)H=e[n][r],h[n][r]=t.create("point",[H,0],{name:"",fixed:!0,withlabel:!1,visible:!1}),h[n][r].addTransform(h[n][r],R);for(D=[],r=0;r<Y;r++)for(x.labelcolor=b&&b[r%b.length],x.strokecolor=b&&b[r%b.length],x.fillcolor=b&&b[r%b.length],D[r]=t.create("polygon",h[r],{withLines:!0,withLabel:!1,fillColor:x.fillcolor,fillOpacity:x.fillopacity,highlightFillColor:x.highlightfillcolor}),n=0;n<o;n++)D[r].borders[n].setAttribute("strokecolor:"+b[r%b.length]),D[r].borders[n].setAttribute("strokewidth:"+x.polystrokewidth);switch(i.legendposition||"none"){case"right":I=i.legendleftoffset||2,B=i.legendtopoffset||1,this.legend=t.create("legend",[E+A+I,M+A-B],{labels:y,colors:b});break;case"none":break;default:jxg.A.debug("Unknown legend position")}if(k=[],i.showcircles){for(U=[],r=0;r<6;r++)U[r]=20*r;if(U[0]="0",(j=(F=i.circlelabelarray||U).length)<2)throw new Error("JSXGraph radar chart: too less circles in circleLabelArray");for(V=[],R=W(w+Math.PI/o,0),x.fillcolor="none",x.highlightfillcolor="none",x.strokecolor=i.strokecolor||"black",x.strokewidth=i.circlestrokewidth||.5,x.layer=0,z=(v[0]-_[0])/(j-1),r=0;r<j;r++)V[r]=t.create("point",[_[0]+r*z,0],{name:F[r],size:0,fixed:!0,withLabel:!0,visible:!0}),V[r].addTransform(V[r],R),k[r]=t.create("circle",[S,V[r]],x)}return this.rendNode=D[0].rendNode,{circles:k,lines:O,points:h,midpoint:S,polygons:D}},updateRenderer:function(){return this},update:function(){return this.needsUpdate&&this.updateDataArray(),this},updateDataArray:function(){return this}}),jxg.A.createChart=function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p,f,m,g,_,v,y=[],b=env.A.isBrowser?t.document.getElementById(e[0]):null;if(1===e.length&&utils_type.A.isString(e[0])){if(utils_type.A.exists(b)){if(u=utils_type.A.copyAttributes(i,t.options,"chart"),r=(b=(new datasource).loadFromTable(e[0],u.withheaders,u.withheaders)).data,a=b.columnHeaders,n=b.rowHeaders,d=u.width,p=u.name,f=u.strokecolor,m=u.fillcolor,g=u.highlightstrokecolor,_=u.highlightfillcolor,t.suspendUpdate(),v=r.length,h=[],u.rows&&utils_type.A.isArray(u.rows)){for(s=0;s<v;s++)for(o=0;o<u.rows.length;o++)if(u.rows[o]===s||u.withheaders&&u.rows[o]===n[s]){h.push(r[s]);break}}else h=r;for(v=h.length,s=0;s<v;s++){if(c=[],u.chartstyle&&-1!==u.chartstyle.indexOf("bar")){for(l=d||.8,c.push(1-l/2+(s+.5)*l/v),o=1;o<h[s].length;o++)c.push(c[o-1]+1);u.width=l/v}p&&p.length===v?u.name=p[s]:u.withheaders&&(u.name=a[s]),f&&f.length===v?u.strokecolor=f[s]:u.strokecolor=utils_color.A.hsv2rgb((s+1)/v*360,.9,.6),m&&m.length===v?u.fillcolor=m[s]:u.fillcolor=utils_color.A.hsv2rgb((s+1)/v*360,.9,1),g&&g.length===v?u.highlightstrokecolor=g[s]:u.highlightstrokecolor=utils_color.A.hsv2rgb((s+1)/v*360,.9,1),_&&_.length===v?u.highlightfillcolor=_[s]:u.highlightfillcolor=utils_color.A.hsv2rgb((s+1)/v*360,.9,.6),u.chartstyle&&-1!==u.chartstyle.indexOf("bar")?y.push(new jxg.A.Chart(t,[c,h[s]],u)):y.push(new jxg.A.Chart(t,[h[s]],u))}t.unsuspendUpdate()}return y}return u=utils_type.A.copyAttributes(i,t.options,"chart"),new jxg.A.Chart(t,e,u)},jxg.A.registerElement("chart",jxg.A.createChart),jxg.A.Legend=function(t,e,i){var r;if(this.constructor(),r=utils_type.A.copyAttributes(i,t.options,"legend"),this.board=t,this.coords=new base_coords.A(constants.A.COORDS_BY_USER,e,this.board),this.myAtts={},this.label_array=r.labelarray||r.labels,this.color_array=r.colorarray||r.colors,this.opacy_array=r.strokeopacity||[1],this.lines=[],this.myAtts.strokewidth=r.strokewidth||5,this.myAtts.straightfirst=!1,this.myAtts.straightlast=!1,this.myAtts.withlabel=!0,this.myAtts.fixed=!0,this.myAtts.frozen=r.frozen||!1,this.style=r.legendstyle||r.style,"vertical"!==this.style)throw new Error("JSXGraph: Unknown legend style: "+this.style);this.drawVerticalLegend(t,r),this.id=this.board.setId(this,"Leg")},jxg.A.Legend.prototype=new base_element.A,jxg.A.Legend.prototype.drawVerticalLegend=function(t,e){var i,r=e.linelength||1,n=(e.rowheight||20)/this.board.unitY,s=function(){return this.setLabelRelativeCoords(this.visProp.label.offset),new base_coords.A(constants.A.COORDS_BY_USER,[this.point2.X(),this.point2.Y()],this.board)};for(i=0;i<this.label_array.length;i++)this.myAtts.name=this.label_array[i],this.myAtts.strokecolor=this.color_array[i%this.color_array.length],this.myAtts.highlightstrokecolor=this.color_array[i%this.color_array.length],this.myAtts.strokeopacity=this.opacy_array[i%this.opacy_array.length],this.myAtts.highlightstrokeopacity=this.opacy_array[i%this.opacy_array.length],this.myAtts.label={offset:[10,0],strokeColor:this.color_array[i%this.color_array.length],strokeWidth:this.myAtts.strokewidth},this.lines[i]=t.create("line",[[this.coords.usrCoords[1],this.coords.usrCoords[2]-i*n],[this.coords.usrCoords[1]+r,this.coords.usrCoords[2]-i*n]],this.myAtts),this.myAtts.frozen&&this.lines[i].setAttribute({point1:{frozen:!0},point2:{frozen:!0}}),this.lines[i].getLabelAnchor=s,this.lines[i].prepareUpdate().update().updateVisibility(this.lines[i].evalVisProp("visible")).updateRenderer(),this.addChild(this.lines[i])},jxg.A.createLegend=function(t,e,i){var r;if(!utils_type.A.exists(e)||2!==e.length)throw new Error("JSXGraph: Legend element needs two numbers as parameters");return r=e,new jxg.A.Legend(t,r,i)},jxg.A.registerElement("legend",jxg.A.createLegend);const chart={Chart:jxg.A.Chart,Legend:jxg.A.Legend};jxg.A.Transformation=function(t,e,i,r){this.elementClass=constants.A.OBJECT_CLASS_OTHER,this.type=constants.A.OBJECT_TYPE_TRANSFORMATION,r?(this.is3D=!0,this.matrix=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]):(this.is3D=!1,this.matrix=[[1,0,0],[0,1,0],[0,0,1]]),this.board=t,this.isNumericMatrix=!1,this.is3D?this.setMatrix3D(i[0],e,i.slice(1)):this.setMatrix(t,e,i),this.methodMap={apply:"apply",applyOnce:"applyOnce",bindTo:"bindTo",bind:"bindTo",melt:"melt",meltTo:"meltTo"}},jxg.A.Transformation.prototype={},jxg.A.extend(jxg.A.Transformation.prototype,{update:function(){return this},setMatrix:function(t,e,i){var r;for(this.isNumericMatrix=!0,r=0;r<i.length;r++)if("number"!=typeof i[r]){this.isNumericMatrix=!1;break}if("translate"===e){if(2!==i.length)throw new Error("JSXGraph: translate transformation needs 2 parameters.");this.evalParam=utils_type.A.createEvalFunction(t,i,2),this.update=function(){this.matrix[1][0]=this.evalParam(0),this.matrix[2][0]=this.evalParam(1)}}else if("scale"===e){if(2!==i.length)throw new Error("JSXGraph: scale transformation needs 2 parameters.");this.evalParam=utils_type.A.createEvalFunction(t,i,2),this.update=function(){this.matrix[1][1]=this.evalParam(0),this.matrix[2][2]=this.evalParam(1)}}else if("reflect"===e)i.length<4&&(i[0]=t.select(i[0])),2===i.length&&(i[1]=t.select(i[1])),4===i.length&&(this.evalParam=utils_type.A.createEvalFunction(t,i,4)),this.update=function(){var t,e,r,n,s,o,a,l;1===i.length?a=i[0].stdform:2===i.length?a=math.A.crossProduct(i[1].coords.usrCoords,i[0].coords.usrCoords):4===i.length&&(a=math.A.crossProduct([1,this.evalParam(2),this.evalParam(3)],[1,this.evalParam(0),this.evalParam(1)])),t=a[1],e=a[2],o=(l=[-(r=a[0])*t,-r*e,t*t+e*e])[2],n=l[0]/l[2],s=l[1]/l[2],t=-a[2],e=a[1],this.matrix[1][1]=(t*t-e*e)/o,this.matrix[1][2]=2*t*e/o,this.matrix[2][1]=this.matrix[1][2],this.matrix[2][2]=-this.matrix[1][1],this.matrix[1][0]=n*(1-this.matrix[1][1])-s*this.matrix[1][2],this.matrix[2][0]=s*(1-this.matrix[2][2])-n*this.matrix[2][1]};else if("rotate"===e)3===i.length?this.evalParam=utils_type.A.createEvalFunction(t,i,3):i.length>0&&i.length<=2&&(this.evalParam=utils_type.A.createEvalFunction(t,i,1),2!==i.length||utils_type.A.isArray(i[1])||(i[1]=t.select(i[1]))),this.update=function(){var t,e,r=this.evalParam(0),n=Math.cos(r),s=Math.sin(r);this.matrix[1][1]=n,this.matrix[1][2]=-s,this.matrix[2][1]=s,this.matrix[2][2]=n,i.length>1&&(3===i.length?(t=this.evalParam(1),e=this.evalParam(2)):utils_type.A.isArray(i[1])?(t=i[1][0],e=i[1][1]):(t=i[1].X(),e=i[1].Y()),this.matrix[1][0]=t*(1-n)+e*s,this.matrix[2][0]=e*(1-n)-t*s)};else if("shear"===e){if(2!==i.length)throw new Error("JSXGraph: shear transformation needs 2 parameters.");this.evalParam=utils_type.A.createEvalFunction(t,i,2),this.update=function(){this.matrix[1][2]=this.evalParam(0),this.matrix[2][1]=this.evalParam(1)}}else if("generic"===e){if(9!==i.length)throw new Error("JSXGraph: generic transformation needs 9 parameters.");this.evalParam=utils_type.A.createEvalFunction(t,i,9),this.update=function(){this.matrix[0][0]=this.evalParam(0),this.matrix[0][1]=this.evalParam(1),this.matrix[0][2]=this.evalParam(2),this.matrix[1][0]=this.evalParam(3),this.matrix[1][1]=this.evalParam(4),this.matrix[1][2]=this.evalParam(5),this.matrix[2][0]=this.evalParam(6),this.matrix[2][1]=this.evalParam(7),this.matrix[2][2]=this.evalParam(8)}}else if("matrix"===e){if(1!==i.length)throw new Error("JSXGraph: transformation of type 'matrix' needs 1 parameter.");this.evalParam=i[0].slice(),this.update=function(){var t,e;for(t=0;t<3;t++)for(e=0;e<3;e++)this.matrix[t][e]=utils_type.A.evaluate(this.evalParam[t][e])}}},setMatrix3D:function(t,e,i){var r,n=t.board;for(this.isNumericMatrix=!0,r=0;r<i.length;r++)if("number"!=typeof i[r]){this.isNumericMatrix=!1;break}if("translate"===e){if(3!==i.length)throw new Error("JSXGraph: 3D translate transformation needs 3 parameters.");this.evalParam=utils_type.A.createEvalFunction(n,i,3),this.update=function(){this.matrix[1][0]=this.evalParam(0),this.matrix[2][0]=this.evalParam(1),this.matrix[3][0]=this.evalParam(2)}}else if("scale"===e){if(3!==i.length&&4!==i.length)throw new Error("JSXGraph: 3D scale transformation needs either 3 or 4 parameters.");this.evalParam=utils_type.A.createEvalFunction(n,i,3),this.update=function(){var t=this.evalParam(0),e=this.evalParam(1),i=this.evalParam(2);this.matrix[1][1]=t,this.matrix[2][2]=e,this.matrix[3][3]=i}}else"rotateX"===e?(i.length>0&&i.length<=2&&(this.evalParam=utils_type.A.createEvalFunction(n,i,1)),this.update=function(){var t=this.evalParam(0),e=Math.cos(t),i=Math.sin(t);this.matrix[2][2]=e,this.matrix[2][3]=-i,this.matrix[3][2]=i,this.matrix[3][3]=e}):"rotateY"===e?(i.length>0&&i.length<=2&&(this.evalParam=utils_type.A.createEvalFunction(n,i,1)),this.update=function(){var t=this.evalParam(0),e=Math.cos(t),i=Math.sin(t);this.matrix[1][1]=e,this.matrix[1][3]=i,this.matrix[3][1]=-i,this.matrix[3][3]=e}):"rotateZ"===e?(i.length>0&&i.length<=2&&(this.evalParam=utils_type.A.createEvalFunction(n,i,1)),this.update=function(){var t=this.evalParam(0),e=Math.cos(t),i=Math.sin(t);this.matrix[1][1]=e,this.matrix[1][2]=-i,this.matrix[2][1]=i,this.matrix[2][2]=e}):"rotate"===e&&(2===i.length&&(this.evalParam=utils_type.A.createEvalFunction(n,i,2)),this.update=function(){var t,e,i,r=this.evalParam(0),n=this.evalParam(1),s=Math.cos(r),o=Math.sin(r),a=math.A.norm(n);3===n.length?(t=n[0]/a,e=n[1]/a,i=n[2]/a):(t=n[1]/a,e=n[2]/a,i=n[3]/a),this.matrix=[[1,0,0,0],[0,t*t*(1-s)+s,t*e*(1-s)-i*o,t*i*(1-s)+e*o],[0,e*t*(1-s)+i*o,e*e*(1-s)+s,e*i*(1-s)-t*o],[0,i*t*(1-s)-e*o,i*e*(1-s)+t*o,i*i*(1-s)+s]]})},apply:function(t,e){var i;return this.update(),i=this.is3D?t.coords:utils_type.A.exists(e)?t.initialCoords.usrCoords:t.coords.usrCoords,math.A.matVecMult(this.matrix,i)},applyOnce:function(t){var e,i,r;for(utils_type.A.isArray(t)||(t=[t]),i=t.length,r=0;r<i;r++)this.update(),this.is3D?t[r].coords=math.A.matVecMult(this.matrix,t[r].coords):(e=math.A.matVecMult(this.matrix,t[r].coords.usrCoords),t[r].coords.setCoordinates(constants.A.COORDS_BY_USER,e))},bindTo:function(t){var e,i;if(utils_type.A.isArray(t))for(i=t.length,e=0;e<i;e++)t[e].transformations.push(this);else t.transformations.push(this)},meltTo:function(t){var e,i,r;if(utils_type.A.isArray(t))for(e=0;e<t.length;e++)this.meltTo(t[e]);else(i=t.transformations).length>0&&i[i.length-1].isNumericMatrix&&this.isNumericMatrix?i[i.length-1].melt(this):(r=this.clone(),i.push(r))},clone:function(){var t=null;return this.isNumericMatrix&&((t=new jxg.A.Transformation(this.board,"none",[])).matrix=this.matrix.slice()),t},setProperty:function(t){jxg.A.deprecated("Transformation.setProperty()","Transformation.setAttribute()")},setAttribute:function(t){},melt:function(t){var e;return this.update(),t.update(),e=math.A.matMatMult(t.matrix,this.matrix),this.update=function(){this.matrix=e},this},getParents:function(){var t=[[].concat.apply([],this.matrix)];return 0!==this.parents.length&&(t=this.parents),t}}),jxg.A.createTransform=function(t,e,i){return new jxg.A.Transformation(t,i.type,e)},jxg.A.registerElement("transform",jxg.A.createTransform),jxg.A.createTransform3D=function(t,e,i){return new jxg.A.Transformation(t,i.type,e,!0)},jxg.A.registerElement("transform3d",jxg.A.createTransform3D);const transformation=jxg.A.Transformation;jxg.A.Turtle=function(t,e,i){var r,n,s;return this.constructor(t,i,constants.A.OBJECT_TYPE_TURTLE,constants.A.OBJECT_CLASS_OTHER),this.turtleIsHidden=!1,this.board=t,this.visProp.curveType="plot",this._attributes=utils_type.A.copyAttributes(this.visProp,t.options,"turtle"),delete this._attributes.id,r=0,n=0,s=90,0!==e.length&&(3===e.length?(r=e[0],n=e[1],s=e[2]):2===e.length?utils_type.A.isArray(e[0])?(r=e[0][0],n=e[0][1],s=e[1]):(r=e[0],n=e[1]):(r=e[0][0],n=e[0][1])),this.init(r,n,s),this.methodMap=utils_type.A.deepCopy(this.methodMap,{forward:"forward",fd:"forward",back:"back",bk:"back",right:"right",rt:"right",left:"left",lt:"left",penUp:"penUp",pu:"penUp",up:"penUp",penDown:"penDown",pd:"penDown",down:"penDown",clearScreen:"clearScreen",cs:"clearScreen",clean:"clean",setPos:"setPos",home:"home",hideTurtle:"hideTurtle",ht:"hideTurtle",hide:"hideTurtle",showTurtle:"showTurtle",st:"showTurtle",show:"showTurtle",penSize:"setPenSize",setPenSize:"setPenSize",penColor:"setPenColor",setPenColor:"setPenColor",highlightPenColor:"setHighlightPenColor",setHighlightPenColor:"setHighlightPenColor",getPenColor:"getPenColor",Color:"getPenColor",getHighlightPenColor:"getHighlightPenColor",HighlightColor:"getHighlightPenColor",getPenSize:"getPenSize",Size:"getPenSize",pushTurtle:"pushTurtle",push:"pushTurtle",popTurtle:"popTurtle",pop:"popTurtle",lookTo:"lookTo",pos:"pos",Pos:"pos",moveTo:"moveTo",X:"X",Y:"Y"}),this},jxg.A.Turtle.prototype=new base_element.A,jxg.A.extend(jxg.A.Turtle.prototype,{init:function(t,e,i){var r={fixed:!0,name:"",visible:!1,withLabel:!1};this.arrowLen=20/math.A.hypot(this.board.unitX,this.board.unitY),this.pos=[t,e],this.isPenDown=!0,this.dir=90,this.stack=[],this.objects=[],this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve),this.turtle=this.board.create("point",this.pos,r),this.objects.push(this.turtle),this.turtle2=this.board.create("point",[this.pos[0],this.pos[1]+this.arrowLen],r),this.objects.push(this.turtle2),this.visProp.arrow.lastArrow=!0,this.visProp.arrow.straightFirst=!1,this.visProp.arrow.straightLast=!1,this.arrow=this.board.create("line",[this.turtle,this.turtle2],this.visProp.arrow),this.objects.push(this.arrow),this.subs={arrow:this.arrow},this.inherits.push(this.arrow),this.right(90-i),this.board.update()},forward:function(t){if(0===t)return this;var e,i=t*Math.cos(this.dir*Math.PI/180),r=t*Math.sin(this.dir*Math.PI/180);return this.turtleIsHidden||((e=this.board.create("transform",[i,r],{type:"translate"})).applyOnce(this.turtle),e.applyOnce(this.turtle2)),this.isPenDown&&this.curve.dataX.length>=8192&&(this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve)),this.pos[0]+=i,this.pos[1]+=r,this.isPenDown&&(this.curve.dataX.push(this.pos[0]),this.curve.dataY.push(this.pos[1])),this.board.update(),this},back:function(t){return this.forward(-t)},right:function(t){return this.dir-=t,this.dir%=360,this.turtleIsHidden||this.board.create("transform",[-t*Math.PI/180,this.turtle],{type:"rotate"}).applyOnce(this.turtle2),this.board.update(),this},left:function(t){return this.right(-t)},penUp:function(){return this.isPenDown=!1,this},penDown:function(){return this.isPenDown=!0,this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve),this},clean:function(){var t,e;for(t=0;t<this.objects.length;t++)(e=this.objects[t]).type===constants.A.OBJECT_TYPE_CURVE&&(this.board.removeObject(e),this.objects.splice(t,1));return this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve),this.board.update(),this},clearScreen:function(){var t,e,i=this.objects.length;for(t=0;t<i;t++)e=this.objects[t],this.board.removeObject(e);return this.init(0,0,90),this},setPos:function(t,e){return utils_type.A.isArray(t)?this.pos=t:this.pos=[t,e],this.turtleIsHidden||(this.turtle.setPositionDirectly(constants.A.COORDS_BY_USER,[t,e]),this.turtle2.setPositionDirectly(constants.A.COORDS_BY_USER,[t,e+this.arrowLen]),this.board.create("transform",[-(this.dir-90)*Math.PI/180,this.turtle],{type:"rotate"}).applyOnce(this.turtle2)),this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve),this.board.update(),this},setPenSize:function(t){return this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this.copyAttr("strokeWidth",t)),this.objects.push(this.curve),this},setPenColor:function(t){return this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this.copyAttr("strokeColor",t)),this.objects.push(this.curve),this},getPenAttribute:function(t){var e,i=this.objects.length;return e=4===i?0:i-1,this.objects[e].evalVisProp(t)},getPenSize:function(){return this.getPenAttribute("strokewidth")},getPenColor:function(){return this.getPenAttribute("strokecolor")},getHighlightPenColor:function(){return this.getPenAttribute("highlightstrokecolor")},setHighlightPenColor:function(t){return this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this.copyAttr("highlightStrokeColor",t)),this.objects.push(this.curve),this},setAttribute:function(t){var e,i,r,n=this.objects.length;for(e=0;e<n;e++)(i=this.objects[e]).type===constants.A.OBJECT_TYPE_CURVE&&i.setAttribute(t);return r=this.visProp.id,this.visProp=utils_type.A.deepCopy(this.curve.visProp),this.visProp.id=r,this._attributes=utils_type.A.deepCopy(this.visProp),delete this._attributes.id,this},copyAttr:function(t,e){return this._attributes[t.toLowerCase()]=e,this._attributes},showTurtle:function(){return this.turtleIsHidden=!1,this.arrow.setAttribute({visible:!0}),this.visProp.arrow.visible=!1,this.setPos(this.pos[0],this.pos[1]),this.board.update(),this},hideTurtle:function(){return this.turtleIsHidden=!0,this.arrow.setAttribute({visible:!1}),this.visProp.arrow.visible=!1,this.board.update(),this},home:function(){return this.pos=[0,0],this.setPos(this.pos[0],this.pos[1]),this},pushTurtle:function(){return this.stack.push([this.pos[0],this.pos[1],this.dir]),this},popTurtle:function(){var t=this.stack.pop();return this.pos[0]=t[0],this.pos[1]=t[1],this.dir=t[2],this.setPos(this.pos[0],this.pos[1]),this},lookTo:function(t){var e,i,r,n,s;return utils_type.A.isArray(t)?(e=this.pos[0],i=this.pos[1],r=t[0],n=t[1],s=Math.atan2(n-i,r-e),this.right(this.dir-180*s/Math.PI)):utils_type.A.isNumber(t)&&this.right(this.dir-t),this},moveTo:function(t){var e,i,r;return utils_type.A.isArray(t)&&(e=t[0]-this.pos[0],i=t[1]-this.pos[1],this.turtleIsHidden||((r=this.board.create("transform",[e,i],{type:"translate"})).applyOnce(this.turtle),r.applyOnce(this.turtle2)),this.isPenDown&&this.curve.dataX.length>=8192&&(this.curve=this.board.create("curve",[[this.pos[0]],[this.pos[1]]],this._attributes),this.objects.push(this.curve)),this.pos[0]=t[0],this.pos[1]=t[1],this.isPenDown&&(this.curve.dataX.push(this.pos[0]),this.curve.dataY.push(this.pos[1])),this.board.update()),this},fd:function(t){return this.forward(t)},bk:function(t){return this.back(t)},lt:function(t){return this.left(t)},rt:function(t){return this.right(t)},pu:function(){return this.penUp()},pd:function(){return this.penDown()},ht:function(){return this.hideTurtle()},st:function(){return this.showTurtle()},cs:function(){return this.clearScreen()},push:function(){return this.pushTurtle()},pop:function(){return this.popTurtle()},evalAt:function(t,e){var i,r,n,s,o=this.objects.length;for(i=0,r=0;i<o;i++)if((n=this.objects[i]).elementClass===constants.A.OBJECT_CLASS_CURVE){if(r<=t&&t<r+n.numberPoints)return s=t-r,n[e](s);r+=n.numberPoints}return this[e]()},X:function(t){return utils_type.A.exists(t)?this.evalAt(t,"X"):this.pos[0]},Y:function(t){return utils_type.A.exists(t)?this.evalAt(t,"Y"):this.pos[1]},Z:function(t){return 1},minX:function(){return 0},maxX:function(){var t,e=this.objects.length,i=0;for(t=0;t<e;t++)this.objects[t].elementClass===constants.A.OBJECT_CLASS_CURVE&&(i+=this.objects[t].numberPoints);return i},hasPoint:function(t,e){var i,r;for(i=0;i<this.objects.length;i++)if((r=this.objects[i]).type===constants.A.OBJECT_TYPE_CURVE&&r.hasPoint(t,e))return!0;return!1}}),jxg.A.createTurtle=function(t,e,i){var r;return e=e||[],r=utils_type.A.copyAttributes(i,t.options,"turtle"),new jxg.A.Turtle(t,e,r)},jxg.A.registerElement("turtle",jxg.A.createTurtle);const turtle=jxg.A.Turtle;jxg.A.Ticks=function(t,e,i){if(this.constructor(t.board,i,constants.A.OBJECT_TYPE_TICKS,constants.A.OBJECT_CLASS_OTHER),this.line=t,this.board=this.line.board,this.fixedTicks=null,this.equidistant=!1,this.labelsData=[],utils_type.A.isFunction(e))throw this.ticksFunction=e,new Error("Function arguments are no longer supported.");utils_type.A.isArray(e)?this.fixedTicks=e:this.equidistant=!0,this.ticks=[],this.labels=[],this.labelCounter=0,this.id=this.line.addTicks(this),this.elType="ticks",this.inherits.push(this.labels),this.board.setId(this,"Ti")},jxg.A.Ticks.prototype=new base_element.A,jxg.A.extend(jxg.A.Ticks.prototype,{hasPoint:function(t,e){var i,r,n,s,o=this.ticks&&this.ticks.length||0;if(!this.line.evalVisProp("scalable")||this.line.elementClass===constants.A.OBJECT_CLASS_CURVE)return!1;if(utils_type.A.isObject(this.evalVisProp("precision"))?(s=this.board._inputDevice,n=this.evalVisProp("precision."+s)):n=this.board.options.precision.hasPoint,n+=.5*this.evalVisProp("strokewidth"),0!==this.line.stdform[1]&&0!==this.line.stdform[2]&&this.line.type!==constants.A.OBJECT_TYPE_AXIS)return!1;for(i=0;i<o;i++)if((r=this.ticks[i])[2]&&!(0===this.line.stdform[1]&&Math.abs(r[0][0]-this.line.point1.coords.scrCoords[1])<math.A.eps||0===this.line.stdform[2]&&Math.abs(r[1][0]-this.line.point1.coords.scrCoords[2])<math.A.eps)&&(Math.abs(r[0][0]-r[0][1])>=1||Math.abs(r[1][0]-r[1][1])>=1))if(0===this.line.stdform[1]){if(Math.abs(e-this.line.point1.coords.scrCoords[2])<2*n&&r[0][0]-n<t&&t<r[0][1]+n)return!0}else if(0===this.line.stdform[2]&&Math.abs(t-this.line.point1.coords.scrCoords[1])<2*n&&r[1][0]-n<e&&e<r[1][1]+n)return!0;return!1},setPositionDirectly:function(t,e,i){var r,n,s=new base_coords.A(t,e,this.board),o=new base_coords.A(t,i,this.board),a=this.board.getBoundingBox();return this.line.type===constants.A.OBJECT_TYPE_AXIS&&this.line.evalVisProp("scalable")?(Math.abs(this.line.stdform[1])<math.A.eps&&Math.abs(s.usrCoords[1]*o.usrCoords[1])>math.A.eps?(r=o.usrCoords[1]/s.usrCoords[1],a[0]*=r,a[2]*=r,this.board.setBoundingBox(a,this.board.keepaspectratio,"update")):Math.abs(this.line.stdform[2])<math.A.eps&&Math.abs(s.usrCoords[2]*o.usrCoords[2])>math.A.eps&&(n=o.usrCoords[2]/s.usrCoords[2],a[3]*=n,a[1]*=n,this.board.setBoundingBox(a,this.board.keepaspectratio,"update")),this):this},calculateTicksCoordinates:function(){var t,e,i,r;if(!(this.line.elementClass===constants.A.OBJECT_CLASS_LINE&&(this.setTicksSizeVariables(),Math.abs(this.dx)<math.A.eps&&Math.abs(this.dy)<math.A.eps)))return t=this.getZeroCoordinates(),e=this.line.elementClass===constants.A.OBJECT_CLASS_LINE?this.getLowerAndUpperBounds(t,"ticksdistance"):{lower:this.line.minX(),upper:this.line.maxX(),a1:0,a2:0,m1:0,m2:0},"polar"===this.evalVisProp("type")&&(r=this.board.getBoundingBox(),i=Math.max(math.A.hypot(r[0],r[1]),math.A.hypot(r[2],r[3])),e.upper=i),this.ticks=[],this.labelsData=[],this.equidistant?this.generateEquidistantTicks(t,e):this.generateFixedTicks(t,e),this},setTicksSizeVariables:function(t){var e,i,r,n,s=.5*this.evalVisProp("majorheight"),o=.5*this.evalVisProp("minorheight");utils_type.A.exists(t)?(i=this.line.minX(),r=this.line.maxX(),(n=this.line.points.length)<2?(this.dxMaj=0,this.dyMaj=0):math.A.relDif(t,i)<math.A.eps?(this.dxMaj=this.line.points[0].usrCoords[2]-this.line.points[1].usrCoords[2],this.dyMaj=this.line.points[1].usrCoords[1]-this.line.points[0].usrCoords[1]):math.A.relDif(t,r)<math.A.eps?(this.dxMaj=this.line.points[n-2].usrCoords[2]-this.line.points[n-1].usrCoords[2],this.dyMaj=this.line.points[n-1].usrCoords[1]-this.line.points[n-2].usrCoords[1]):(this.dxMaj=-numerics.A.D(this.line.Y)(t),this.dyMaj=numerics.A.D(this.line.X)(t))):(this.dxMaj=this.line.stdform[1],this.dyMaj=this.line.stdform[2]),this.dxMin=this.dxMaj,this.dyMin=this.dyMaj,this.dx=this.dxMaj,this.dy=this.dyMaj,e=math.A.hypot(this.dxMaj*this.board.unitX,this.dyMaj*this.board.unitY),this.dxMaj*=s/e*this.board.unitX,this.dyMaj*=s/e*this.board.unitY,this.dxMin*=o/e*this.board.unitX,this.dyMin*=o/e*this.board.unitY,this.minStyle=this.evalVisProp("minorheight")<0?"infinite":"finite",this.majStyle=this.evalVisProp("majorheight")<0?"infinite":"finite"},getZeroCoordinates:function(){var t,e,i,r,n,s,o,a,l=this.evalVisProp("anchor");return this.line.elementClass===constants.A.OBJECT_CLASS_LINE?this.line.type===constants.A.OBJECT_TYPE_AXIS?geometry.A.projectPointToLine({coords:{usrCoords:[1,0,0]}},this.line,this.board):(i=this.line.point1.coords.usrCoords[0],t=this.line.point1.coords.usrCoords[1],e=this.line.point1.coords.usrCoords[2],s=this.line.point2.coords.usrCoords[0],r=this.line.point2.coords.usrCoords[1],n=this.line.point2.coords.usrCoords[2],"right"===l?this.line.point2.coords:"middle"===l?new base_coords.A(constants.A.COORDS_BY_USER,[.5*(i+s),.5*(t+r),.5*(e+n)],this.board):utils_type.A.isNumber(l)?new base_coords.A(constants.A.COORDS_BY_USER,[i+(s-i)*l,t+(r-t)*l,e+(n-e)*l],this.board):this.line.point1.coords):(o=this.line.minX(),a=this.line.maxX(),"right"===l?a:"middle"===l?.5*(o+a):utils_type.A.isNumber(l)?o*(1-l)+a*l:o)},getLowerAndUpperBounds:function(t,e){var i,r,n,s,o,a,l,c,h,u,d,p,f,m,g,_=10*math.A.eps,v=this.line.evalVisProp("straightfirst"),y=this.line.evalVisProp("straightlast"),b=this.evalVisProp("includeboundaries");return this.line.elementClass===constants.A.OBJECT_CLASS_CURVE?{lower:this.line.minX(),upper:this.line.maxX()}:(o=new base_coords.A(constants.A.COORDS_BY_USER,this.line.point1.coords.usrCoords,this.board),a=new base_coords.A(constants.A.COORDS_BY_USER,this.line.point2.coords.usrCoords,this.board),l=Math.abs(o.usrCoords[0])>=math.A.eps&&o.scrCoords[1]>=0&&o.scrCoords[1]<=this.board.canvasWidth&&o.scrCoords[2]>=0&&o.scrCoords[2]<=this.board.canvasHeight,c=Math.abs(a.usrCoords[0])>=math.A.eps&&a.scrCoords[1]>=0&&a.scrCoords[1]<=this.board.canvasWidth&&a.scrCoords[2]>=0&&a.scrCoords[2]<=this.board.canvasHeight,utils_type.A.exists(e)&&"ticksdistance"===e?(geometry.A.calcStraight(this.line,o,a,0),m=this.getDistanceFromZero(t,o),g=this.getDistanceFromZero(t,a),geometry.A.calcStraight(this.line,o,a,this.line.evalVisProp("margin")),m=this.getDistanceFromZero(t,o)-m,g=this.getDistanceFromZero(t,a).m2):geometry.A.calcLineDelimitingPoints(this.line,o,a),n=this.line.evalVisProp("firstarrow"),s=this.line.evalVisProp("lastarrow"),p=this.getDistanceFromZero(t,o),f=this.getDistanceFromZero(t,a),(n||s)&&(d=this.board.renderer.getArrowHeadData(this.line,this.line.evalVisProp("strokewidth"),""),this.board.renderer.getPositionArrowHead(this.line,o,a,d)),(h=this.getDistanceFromZero(t,o))<(u=this.getDistanceFromZero(t,a))?(i=h,r=u,v||!l||b||(i+=_),y||!c||b||(r-=_)):u<h?(i=u,r=h,y||!c||b||(i+=_),v||!l||b||(r-=_)):(i=0,r=0),{lower:i,upper:r,a1:p=h-p,a2:f=h-f,m1:m,m2:g})},getDistanceFromZero:function(t,e){var i,r,n,s,o;return i=this.line.point1.coords,r=this.line.point2.coords,o=t.distance(constants.A.COORDS_BY_USER,e),n=[r.usrCoords[0]-i.usrCoords[0],r.usrCoords[1]-i.usrCoords[1],r.usrCoords[2]-i.usrCoords[2]],s=[e.usrCoords[0]-t.usrCoords[0],e.usrCoords[1]-t.usrCoords[1],e.usrCoords[2]-t.usrCoords[2]],math.A.innerProduct(n,s,3)<0&&(o*=-1),o},generateEquidistantTicks:function(t,e){var i,r,n,s=math.A.eps,o=this.evalVisProp("minorticks");if(n=this.getDistanceMajorTicks(),this.line.elementClass===constants.A.OBJECT_CLASS_LINE&&(r=this.getXandYdeltas()),n*=this.evalVisProp("scale"),n/=o+1,this.ticksDelta=n,!(n<math.A.eps))if(Math.abs(e.upper-e.lower)>2048*n)jxg.A.warn("JSXGraph ticks: too many ticks (>2048). Please increase ticksDistance.");else{for(i=0,this.evalVisProp("drawzero")||(i=n),i<e.lower&&(i=Math.floor((e.lower-s)/n)*n);i<=e.upper+s&&(i>=e.lower-s&&this.processTickPosition(t,i,n,r),i+=n,!(e.upper-i>1e4*n)););for((i=-n)>e.upper&&(i=Math.ceil((e.upper+s)/-n)*-n);i>=e.lower-s&&(i<=e.upper+s&&this.processTickPosition(t,i,n,r),!((i-=n)-e.lower>1e4*n)););}},getDistanceMajorTicks:function(){var t,e,i,r,n,s,o,a;return this.evalVisProp("insertticks")?(s=((i=this.getLowerAndUpperBounds(this.getZeroCoordinates(),"")).upper-i.lower)/6/(n=this.evalVisProp("scale")),o=this.evalVisProp("minticksdistance")/n,a=this.evalVisProp("minorticks"),(r=this.getXandYdeltas()).x*=this.board.unitX,r.y*=this.board.unitY,o/=math.A.hypot(r.x,r.y),o*=a+1,2*(t=Math.pow(10,Math.floor(Math.log(o)/Math.LN10)))>=o?t*=2:5*t>=o&&(t*=5),5*(e=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)))<s?e*=5:2*e<s&&(e*=2),t=Math.max(t,e)):this.evalVisProp("ticksdistance")},processTickPosition:function(t,e,i,r){var n,s,o,a,l,c=this.evalVisProp("ticksperlabel"),h=null;this.line.elementClass===constants.A.OBJECT_CLASS_LINE?(n=t.usrCoords[1]+e*r.x,s=t.usrCoords[2]+e*r.y):(n=this.line.X(t+e),s=this.line.Y(t+e)),o=new base_coords.A(constants.A.COORDS_BY_USER,[n,s],this.board),this.line.elementClass===constants.A.OBJECT_CLASS_CURVE&&(h=t+e,this.setTicksSizeVariables(h)),o.major=Math.round(e/i)%(this.evalVisProp("minorticks")+1)===0,c||(c=this.evalVisProp("minorticks")+1),l=Math.round(e/i)%c===0,3===(a=this.createTickPath(o,o.major)).length&&(this.ticks.push(a),l&&this.evalVisProp("drawlabels")?this.labelsData.push(this.generateLabelData(this.generateLabelText(o,t,h),o,this.ticks.length)):this.labelsData.push(null))},generateFixedTicks:function(t,e){var i,r,n,s,o,a,l,c,h=math.A.eps,u=utils_type.A.isArray(this.visProp.labels),d=this.evalVisProp("drawlabels");for(this.line.elementClass===constants.A.OBJECT_CLASS_LINE&&(c=this.getXandYdeltas()),n=0;n<this.fixedTicks.length;n++)this.line.elementClass===constants.A.OBJECT_CLASS_LINE?(l=this.fixedTicks[n],o=t.usrCoords[1]+l*c.x,a=t.usrCoords[2]+l*c.y):(l=t+this.fixedTicks[n],o=this.line.X(l),a=this.line.Y(l)),i=new base_coords.A(constants.A.COORDS_BY_USER,[o,a],this.board),this.line.elementClass===constants.A.OBJECT_CLASS_CURVE&&this.setTicksSizeVariables(l),3===(s=this.createTickPath(i,!0)).length&&l>=e.lower-h&&l<=e.upper+h&&(this.ticks.push(s),d&&(u||utils_type.A.exists(this.visProp.labels[n]))?(r=u?this.evalVisProp("labels."+n):l,this.labelsData.push(this.generateLabelData(this.generateLabelText(i,t,r),i,n))):this.labelsData.push(null))},getXandYdeltas:function(){var t,e,i=this.line.point1.Dist(this.line.point2);return t=this.line.point1.coords.usrCoords,{x:((e=this.line.point2.coords.usrCoords)[1]-t[1])/i,y:(e[2]-t[2])/i}},_isInsideCanvas:function(t,e,i){var r=this.board.canvasWidth,n=this.board.canvasHeight;return void 0===i&&(i=0),t[0]>=i&&t[0]<=r-i&&e[0]>=i&&e[0]<=n-i||t[1]>=i&&t[1]<=r-i&&e[1]>=i&&e[1]<=n-i},createTickPath:function(t,e){var i,r,n,s,o,a,l,c,h,u,d,p,f,m,g,_,v,y=[-2e6,-2e6],b=[-2e6,-2e6];if(i=t.scrCoords,e?(s=this.dxMaj,o=this.dyMaj,h=this.majStyle,g=this.evalVisProp("majortickendings.0")>0,_=this.evalVisProp("majortickendings.1")>0):(s=this.dxMin,o=this.dyMin,h=this.minStyle,g=this.evalVisProp("tickendings.0")>0,_=this.evalVisProp("tickendings.1")>0),r=[-o*i[1]-s*i[2],o,s],e&&"polar"===this.evalVisProp("type")){if(p=this.board.getBoundingBox(),m=(f=2*Math.PI)/180,i=t.usrCoords,(d=math.A.hypot(i[1],i[2]))<Math.max(math.A.hypot(p[0],p[1]),math.A.hypot(p[2],p[3]))){for(y=[],b=[],u=0;u<=f;u+=m)y.push(this.board.origin.scrCoords[1]+d*Math.cos(u)*this.board.unitX),b.push(this.board.origin.scrCoords[2]+d*Math.sin(u)*this.board.unitY);return[y,b,e]}}else{if("infinite"===h){if(this.evalVisProp("ignoreinfinitetickendings")&&(g=_=!0),n=geometry.A.meetLineBoard(r,this.board),g&&_)y[0]=n[0].scrCoords[1],y[1]=n[1].scrCoords[1],b[0]=n[0].scrCoords[2],b[1]=n[1].scrCoords[2];else if((v=[math.A.innerProduct(n[0].usrCoords.slice(1,3),this.line.stdform.slice(1,3))+this.line.stdform[0],math.A.innerProduct(n[1].usrCoords.slice(1,3),this.line.stdform.slice(1,3))+this.line.stdform[0]])[0]<v[1]&&(n.reverse(),v.reverse()),g){if(v[0]<0)return[];v[1]<0?(y[0]=n[0].scrCoords[1],b[0]=n[0].scrCoords[2],y[1]=i[1],b[1]=i[2]):(y[0]=n[0].scrCoords[1],b[0]=n[0].scrCoords[2],y[1]=n[1].scrCoords[1],b[1]=n[1].scrCoords[2])}else if(_){if(v[1]>0)return[];v[0]>0?(y[0]=i[1],b[0]=i[2],y[1]=n[1].scrCoords[1],b[1]=n[1].scrCoords[2]):(y[0]=n[0].scrCoords[1],b[0]=n[0].scrCoords[2],y[1]=n[1].scrCoords[1],b[1]=n[1].scrCoords[2])}}else c=">"===this.evalVisProp("face")?Math.PI/4:"<"===this.evalVisProp("face")?-Math.PI/4:0,a=Math.cos(c)*s-Math.sin(c)*o,l=Math.sin(c)*s+Math.cos(c)*o,y[0]=i[1]+a*g,b[0]=i[2]-l*g,y[1]=i[1],b[1]=i[2],c=-c,a=Math.cos(c)*s-Math.sin(c)*o,l=Math.sin(c)*s+Math.cos(c)*o,y[2]=i[1]-a*_,b[2]=i[2]+l*_;if(this._isInsideCanvas(y,b))return[y,b,e]}return[]},formatLabelText:function(t){var e,i,r=this.evalVisProp("label.usemathjax"),n=this.evalVisProp("label.usekatex"),s=this.evalVisProp("scalesymbol");return utils_type.A.isNumber(t)?(this.evalVisProp("label.tofraction")?e=r?"\\("+utils_type.A.toFraction(t,!0)+"\\)":utils_type.A.toFraction(t,n):(i=this.evalVisProp("digits"),this.useLocale()?e=this.formatNumberLocale(t,i):((e=(Math.round(1e11*t)/1e11).toString()).length>this.evalVisProp("maxlabellength")||-1!==e.indexOf("e"))&&(3!==this.evalVisProp("precision")&&3===i&&(i=this.evalVisProp("precision")),e=t.toExponential(i).toString())),this.evalVisProp("beautifulscientificticklabels")&&(e=this.beautifyScientificNotationLabel(e)),e.indexOf(".")>-1&&-1===e.indexOf("e")&&(e=(e=e.replace(/0+$/,"")).replace(/\.$/,""))):e=t.toString(),s.length>0&&("1"===e?e=s:"-1"===e?e="-"+s:"0"!==e&&(e+=s)),this.evalVisProp("useunicodeminus")&&(e=e.replace(/-/g,"")),e},beautifyScientificNotationLabel:function(t){return-1===t.indexOf("e")?t:(parseFloat(t.substring(0,t.indexOf("e")))+t.substring(t.indexOf("e"))).replace(/e(.*)$/g,(function(t,e){return"10"+e.replace(/-/g,"").replace(/\+/g,"").replace(/0/g,"").replace(/1/g,"").replace(/2/g,"").replace(/3/g,"").replace(/4/g,"").replace(/5/g,"").replace(/6/g,"").replace(/7/g,"").replace(/8/g,"").replace(/9/g,"")}))},generateLabelText:function(t,e,i){var r;if(!utils_type.A.exists(i)){if(r=this.getDistanceFromZero(e,t),Math.abs(r)<math.A.eps)return"0";i=r/this.evalVisProp("scale")}return this.formatLabelText(i)},generateLabelData:function(t,e,i){var r,n,s,o;return o=this.evalVisProp("label.fontsize"),r=[e.scrCoords[1],e.scrCoords[1]],n=[e.scrCoords[2],e.scrCoords[2]],s=void 0===o?12:o,s*=.5,this._isInsideCanvas(r,n,s)?(r=this.evalVisProp("label.offset")[0],n=this.evalVisProp("label.offset")[1],{x:e.usrCoords[1]+r/this.board.unitX,y:e.usrCoords[2]+n/this.board.unitY,t,i}):null},update:function(){return this.needsUpdate&&0!==this.board.canvasWidth&&0!==this.board.canvasHeight&&this.calculateTicksCoordinates(),this},updateRenderer:function(){return this.needsUpdate?(this.visPropCalc.visible&&this.board.renderer.updateTicks(this),this.updateRendererLabels(),this.setDisplayRendNode(),this.needsUpdate=!1,this):this},updateRendererLabels:function(){var t,e,i,r,n,s,o,a;for(i=this.labelsData.length,r=this.labels.length,t=0,e=0;t<i;t++)null!==this.labelsData[t]&&(o=this.labelsData[t],e<r?((s=this.labels[e]).setText(o.t),s.setCoords(o.x,o.y),e++):(this.labelCounter+=1,(n=utils_type.A.deepCopy(this.visProp.label)).isLabel=!0,n.priv=this.visProp.priv,n.id=this.id+o.i+"Label"+this.labelCounter,s=jxg.A.createText(this.board,[o.x,o.y,o.t],n),this.addChild(s),s.setParents(this),s.isDraggable=!1,s.dump=!1,this.labels.push(s)),"inherit"===(a=this.evalVisProp("label.visible"))&&(a=this.visPropCalc.visible),s.prepareUpdate().updateVisibility(a).updateRenderer(),s.distanceX=this.evalVisProp("label.offset")[0],s.distanceY=this.evalVisProp("label.offset")[1]);for(e=i=e;e<r;e++)this.board.renderer.display(this.labels[e],!1),this.labels[e].visProp.visible=this.labels[e].visPropCalc.visible=!1;return this},hideElement:function(){var t;for(jxg.A.deprecated("Element.hideElement()","Element.setDisplayRendNode()"),this.visPropCalc.visible=!1,this.board.renderer.display(this,!1),t=0;t<this.labels.length;t++)utils_type.A.exists(this.labels[t])&&this.labels[t].hideElement();return this},showElement:function(){var t;for(jxg.A.deprecated("Element.showElement()","Element.setDisplayRendNode()"),this.visPropCalc.visible=!0,this.board.renderer.display(this,!1),t=0;t<this.labels.length;t++)utils_type.A.exists(this.labels[t])&&this.labels[t].showElement();return this}}),jxg.A.createTicks=function(t,e,i){var r,n,s=utils_type.A.copyAttributes(i,t.options,"ticks");if(n=e.length<2?s.ticksdistance:e[1],e[0].elementClass!==constants.A.OBJECT_CLASS_LINE&&e[0].elementClass!==constants.A.OBJECT_CLASS_CURVE)throw new Error("JSXGraph: Can't create Ticks with parent types '"+typeof e[0]+"'.");return r=new jxg.A.Ticks(e[0],n,s),utils_type.A.isFunction(s.generatelabelvalue)&&(r.generateLabelText=s.generatelabelvalue),utils_type.A.isFunction(s.generatelabeltext)&&(r.generateLabelText=s.generatelabeltext),r.setParents(e[0]),r.isDraggable=!0,r.fullUpdate(e[0].visPropCalc.visible),r},jxg.A.createHatchmark=function(t,e,i){var r,n,s,o,a,l=[],c=utils_type.A.copyAttributes(i,t.options,"hatch");if(e[0].elementClass!==constants.A.OBJECT_CLASS_LINE&&e[0].elementClass!==constants.A.OBJECT_CLASS_CURVE||"number"!=typeof e[1])throw new Error("JSXGraph: Can't create Hatch mark with parent types '"+typeof e[0]+"' and '"+typeof e[1]+" and ''"+typeof e[2]+"'.");for(s=-((r=e[1])-1)*(o=c.ticksdistance)*.5,n=0;n<r;n++)l[n]=s+n*o;return(a=t.create("ticks",[e[0],l],c)).elType="hatch",e[0].inherits.push(a),a},jxg.A.registerElement("ticks",jxg.A.createTicks),jxg.A.registerElement("hash",jxg.A.createHatchmark),jxg.A.registerElement("hatch",jxg.A.createHatchmark);const ticks=jxg.A.Ticks;var bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],NAMEMAX=256;jxg.A.Util=jxg.A.Util||{},jxg.A.Util.Unzip=function(t){var e,i,r,n,s=[],o=0,a=[],l=new Array(32768),c=0,h=!1,u=t.length,d=0,p=1,f=new Array(288),m=new Array(32),g=0,_=null,v=0,y=new Array(17),b=[];function A(){return d<u?t[d++]:-1}function x(){p=1}function C(){var t;try{t=1&p,0==(p>>=1)&&(t=1&(p=A()),p=p>>1|128)}catch(t){throw console.log("Probably problems on iOS7 with >>"),t}return t}function E(t){var e=0,i=t;try{for(;i--;)e=e<<1|C();t&&(e=bitReverse[e]>>8-t)}catch(t){throw console.log("Probably problems on iOS7 with >>"),t}return e}function M(){c=0}function S(t){l[c++]=t,s.push(String.fromCharCode(t)),32768===c&&(c=0)}function w(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1}function P(){for(;;){if(y[v]>=n)return-1;if(r[y[v]]===v)return y[v]++;y[v]++}}function T(){var t,e=_[g];if(17===v)return-1;if(g++,v++,(t=P())>=0)e.b0=t;else if(e.b0=32768,T())return-1;if((t=P())>=0)e.b1=t,e.jump=null;else if(e.b1=32768,e.jump=_[g],e.jumppos=g,T())return-1;return v--,0}function O(t,e,i,s){var o;for(_=t,g=0,r=i,n=e,o=0;o<17;o++)y[o]=0;return v=0,T()?-1:0}function R(t){for(var e,i,r=0,n=t[r];;)if(C()){if(!(32768&n.b1))return n.b1;for(n=n.jump,e=t.length,i=0;i<e;i++)if(t[i]===n){r=i;break}}else{if(!(32768&n.b0))return n.b0;n=t[++r]}}function N(){var t,e,i,r,n,s,o,a,h,u,d,p,g,_,v;do{if(t=C(),0===(e=E(2)))for(x(),h=A(),h|=A()<<8,d=A(),65535&(h^~(d|=A()<<8))&&jxg.A.debug("BlockLen checksum mismatch\n");h--;)S(A());else if(1===e)for(;;)if((r=bitReverse[E(7)]>>1)>23?(r=r<<1|C())>199?r=(r-=128)<<1|C():(r-=48)>143&&(r+=136):r+=256,r<256)S(r);else{if(256===r)break;for(a=E(cplext[r-=257])+cplens[r],r=bitReverse[E(5)]>>3,cpdext[r]>8?(u=E(8),u|=E(cpdext[r]-8)<<8):u=E(cpdext[r]),u+=cpdist[r],r=0;r<a;r++)S(l[c-u&32767])}else if(2===e){for(s=new Array(320),g=257+E(5),_=1+E(5),v=4+E(4),r=0;r<19;r++)s[r]=0;for(r=0;r<v;r++)s[border[r]]=E(3);for(a=m.length,i=0;i<a;i++)m[i]=new w;if(O(m,19,s))return M(),1;for(p=g+_,i=0;i<p;)if((r=R(m))<16)s[i++]=r;else if(16===r){if(i+(r=3+E(2))>p)return M(),1;for(n=i?s[i-1]:0;r--;)s[i++]=n}else{if(i+(r=17===r?3+E(3):11+E(7))>p)return M(),1;for(;r--;)s[i++]=0}for(a=f.length,i=0;i<a;i++)f[i]=new w;if(O(f,g,s))return M(),1;for(a=f.length,i=0;i<a;i++)m[i]=new w;for(o=[],i=g;i<s.length;i++)o[i-g]=s[i];if(O(m,_,o))return M(),1;for(;;)if((r=R(f))>=256){if(0==(r-=256))break;for(a=E(cplext[r-=1])+cplens[r],r=R(m),cpdext[r]>8?(u=E(8),u|=E(cpdext[r]-8)<<8):u=E(cpdext[r]),u+=cpdist[r];a--;)S(l[c-u&32767])}else S(r)}}while(!t);return M(),x(),0}function L(){var t,r,n,l,c,u=[];try{if(s=[],h=!1,u[0]=A(),u[1]=A(),120===u[0]&&218===u[1]&&(N(),a[o]=[s.join(""),"geonext.gxt"],o++),31===u[0]&&139===u[1]&&(D(),a[o]=[s.join(""),"file"],o++),80===u[0]&&75===u[1]){if(h=!0,u[2]=A(),u[3]=A(),3===u[2]&&4===u[3]){for(u[0]=A(),u[1]=A(),e=A(),e|=A()<<8,c=A(),c|=A()<<8,A(),A(),A(),A(),A(),A(),A(),A(),A(),A(),A(),A(),A(),A(),A(),A(),l=A(),l|=A()<<8,n=A(),n|=A()<<8,t=0,b=[];l--;)"/"===(r=A())|":"===r?t=0:t<NAMEMAX-1&&(b[t++]=String.fromCharCode(r));for(i||(i=b),t=0;t<n;)r=A(),t++;if(8===c&&(N(),a[o]=new Array(2),a[o][0]=s.join(""),a[o][1]=b.join(""),o++),D())return!1}return!0}}catch(t){throw console.log("Probably problems on iOS7 with >>"),t}return!1}function D(){var t,i,r=[];if(8&e&&(r[0]=A(),r[1]=A(),r[2]=A(),r[3]=A(),80===r[0]&&75===r[1]&&7===r[2]&&8===r[3]?(A(),A(),A(),A()):(r[0],r[1],r[2],r[3]),A(),A(),A(),A(),A(),A(),A(),A()),h&&L())return!1;if(r[0]=A(),8!==r[0])return!0;if(e=A(),A(),A(),A(),A(),A(),A(),4&e)for(r[0]=A(),r[2]=A(),v=r[0]+256*r[1],t=0;t<v;t++)A();if(8&e)for(t=0,b=[],i=A();i;)"7"!==i&&":"!==i||(t=0),t<NAMEMAX-1&&(b[t++]=i),i=A();if(16&e)for(i=A();i;)i=A();return 2&e&&(A(),A()),N(),A(),A(),A(),A(),A(),A(),A(),A(),h&&L(),!1}y[0]=0,jxg.A.Util.Unzip.prototype.unzipFile=function(t){var e;for(this.unzip(),e=0;e<a.length;e++)if(a[e][1]===t)return a[e][0];return""},jxg.A.Util.Unzip.prototype.unzip=function(){return L(),a}};const zip=jxg.A.Util;jxg.A.CA=function(t,e,i){this.node=t,this.createNode=e,this.parser=i},jxg.A.extend(jxg.A.CA.prototype,{findMapNode:function(t,e){var i,r,n;if("op_assign"===e.value&&e.children[0].value===t)return e.children[1];if(e.children)for(r=e.children.length,i=0;i<r;++i)if(null!==(n=this.findMapNode(t,e.children[i])))return n;return null},setMath:function(t){var e,i;if(("node_op"!=t.type||"op_add"!=t.value&&"op_sub"!=t.value&&"op_mul"!=t.value&&"op_div"!=t.value&&"op_neg"!=t.value&&"op_execfun"!=t.value&&"op_exp"!=t.value)&&"node_var"!=t.type&&"node_const"!=t.type||(t.isMath=!0),t.children)for(i=t.children.length,e=0;e<i;++e)this.setMath(t.children[e])},deriveElementary:function(t,e){var i,r=t.children[0].value,n=t.children[1];switch(r){case"abs":i=this.createNode("node_op","op_div",n[0],this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_mul",utils_type.A.deepCopy(n[0]),utils_type.A.deepCopy(n[0]))]));break;case"sqrt":i=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_mul",this.createNode("node_const",2),this.createNode(t.type,t.value,utils_type.A.deepCopy(t.children[0]),utils_type.A.deepCopy(t.children[1]))));break;case"sin":i=this.createNode("node_op","op_execfun",this.createNode("node_var","cos"),utils_type.A.deepCopy(n));break;case"cos":i=this.createNode("node_op","op_neg",this.createNode("node_op","op_execfun",this.createNode("node_var","sin"),utils_type.A.deepCopy(n)));break;case"tan":i=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_exp",this.createNode("node_op","op_execfun",this.createNode("node_var","cos"),utils_type.A.deepCopy(n)),this.createNode("node_const",2)));break;case"cot":i=this.createNode("node_op","op_neg",this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_exp",this.createNode("node_op","op_execfun",this.createNode("node_var","sin"),utils_type.A.deepCopy(n)),this.createNode("node_const",2))));break;case"exp":i=this.createNode(t.type,t.value,utils_type.A.deepCopy(t.children[0]),utils_type.A.deepCopy(t.children[1]));break;case"pow":i=this.createNode("node_op","op_mul",this.createNode("node_op","op_execfun",utils_type.A.deepCopy(t.children[0]),utils_type.A.deepCopy(t.children[1])),this.createNode("node_op","op_add",this.createNode("node_op","op_mul",this.derivative(t.children[1][0],e),this.createNode("node_op","op_div",utils_type.A.deepCopy(t.children[1][1]),utils_type.A.deepCopy(t.children[1][0]))),this.createNode("node_op","op_mul",this.derivative(t.children[1][1],e),this.createNode("node_op","op_execfun",this.createNode("node_var","log"),[utils_type.A.deepCopy(t.children[1][0])]))));break;case"log":case"ln":i=this.createNode("node_op","op_div",this.createNode("node_const",1),utils_type.A.deepCopy(n[0]));break;case"log2":case"lb":case"ld":i=this.createNode("node_op","op_mul",this.createNode("node_op","op_div",this.createNode("node_const",1),utils_type.A.deepCopy(n[0])),this.createNode("node_const",1.4426950408889634));break;case"log10":case"lg":i=this.createNode("node_op","op_mul",this.createNode("node_op","op_div",this.createNode("node_const",1),utils_type.A.deepCopy(n[0])),this.createNode("node_const",.43429448190325176));break;case"asin":i=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_sub",this.createNode("node_const",1),this.createNode("node_op","op_mul",utils_type.A.deepCopy(n[0]),utils_type.A.deepCopy(n[0])))]));break;case"acos":i=this.createNode("node_op","op_neg",this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_sub",this.createNode("node_const",1),this.createNode("node_op","op_mul",utils_type.A.deepCopy(n[0]),utils_type.A.deepCopy(n[0])))])));break;case"atan":i=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_add",this.createNode("node_const",1),this.createNode("node_op","op_mul",utils_type.A.deepCopy(n[0]),utils_type.A.deepCopy(n[0]))));break;case"acot":i=this.createNode("node_op","op_neg",this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_add",this.createNode("node_const",1),this.createNode("node_op","op_mul",utils_type.A.deepCopy(n[0]),utils_type.A.deepCopy(n[0])))));break;case"sinh":i=this.createNode("node_op","op_execfun",this.createNode("node_var","cosh"),[utils_type.A.deepCopy(n[0])]);break;case"cosh":i=this.createNode("node_op","op_execfun",this.createNode("node_var","sinh"),[utils_type.A.deepCopy(n[0])]);break;case"tanh":i=this.createNode("node_op","op_sub",this.createNode("node_const",1),this.createNode("node_op","op_exp",this.createNode("node_op","op_execfun",this.createNode("node_var","tanh"),[utils_type.A.deepCopy(n[0])]),this.createNode("node_const",2)));break;case"asinh":i=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_add",this.createNode("node_op","op_mul",utils_type.A.deepCopy(n[0]),utils_type.A.deepCopy(n[0])),this.createNode("node_const",1))]));break;case"acosh":i=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_execfun",this.createNode("node_var","sqrt"),[this.createNode("node_op","op_sub",this.createNode("node_op","op_mul",utils_type.A.deepCopy(n[0]),utils_type.A.deepCopy(n[0])),this.createNode("node_const",1))]));break;case"atanh":i=this.createNode("node_op","op_div",this.createNode("node_const",1),this.createNode("node_op","op_sub",this.createNode("node_const",1),this.createNode("node_op","op_mul",utils_type.A.deepCopy(n[0]),utils_type.A.deepCopy(n[0]))));break;default:throw i=this.createNode("node_const",0),console.log('Derivative of "'+r+'" not yet implemented'),new Error("Error("+this.line+"): ")}return i},derivative:function(t,e){var i;switch(t.type){case"node_op":switch(t.value){case"op_execfun":i="pow"==t.children[0].value?this.deriveElementary(t,e):0===t.children[1].length?this.createNode("node_const",0):this.createNode("node_op","op_mul",this.deriveElementary(t,e),this.derivative(t.children[1][0],e));break;case"op_div":i=this.createNode("node_op","op_div",this.createNode("node_op","op_sub",this.createNode("node_op","op_mul",this.derivative(t.children[0],e),utils_type.A.deepCopy(t.children[1])),this.createNode("node_op","op_mul",utils_type.A.deepCopy(t.children[0]),this.derivative(t.children[1],e))),this.createNode("node_op","op_mul",utils_type.A.deepCopy(t.children[1]),utils_type.A.deepCopy(t.children[1])));break;case"op_mul":i=this.createNode("node_op","op_add",this.createNode("node_op","op_mul",utils_type.A.deepCopy(t.children[0]),this.derivative(t.children[1],e)),this.createNode("node_op","op_mul",this.derivative(t.children[0],e),utils_type.A.deepCopy(t.children[1])));break;case"op_neg":i=this.createNode("node_op","op_neg",this.derivative(t.children[0],e));break;case"op_add":case"op_sub":i=this.createNode("node_op",t.value,this.derivative(t.children[0],e),this.derivative(t.children[1],e));break;case"op_exp":i=this.createNode("node_op","op_mul",utils_type.A.deepCopy(t),this.createNode("node_op","op_add",this.createNode("node_op","op_mul",this.derivative(t.children[0],e),this.createNode("node_op","op_div",utils_type.A.deepCopy(t.children[1]),utils_type.A.deepCopy(t.children[0]))),this.createNode("node_op","op_mul",this.derivative(t.children[1],e),this.createNode("node_op","op_execfun",this.createNode("node_var","log"),[utils_type.A.deepCopy(t.children[0])]))))}break;case"node_var":i=t.value===e?this.createNode("node_const",1):this.createNode("node_const",0);break;case"node_const":i=this.createNode("node_const",0)}return i},expandDerivatives:function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p,f;if(!t)return 0;for(this.line=t.line,this.col=t.col,r=t.children.length,n=0;n<r;++n)if(t.children[n]&&t.children[n].type)t.children[n]=this.expandDerivatives(t.children[n],t,i);else if(utils_type.A.isArray(t.children[n]))for(s=0;s<t.children[n].length;++s)t.children[n][s]&&t.children[n][s].type&&(t.children[n][s]=this.expandDerivatives(t.children[n][s],t,i));if("node_op"===t.type&&"op_execfun"===t.value&&t.children[0]&&"D"===t.children[0].value){if(f=!1,"node_var"==t.children[1][0].type&&(h=t.children[1][0].value,null!==(o=this.findMapNode(h,i))&&(f=!0)),f?(d=o.children[0],u=t.children[1].length>=2?t.children[1][1].value:o.children[0][0],a=o.children[1]):(a=t.children[1][0],d=["x"],u=t.children[1].length>=2?t.children[1][1].value:"x"),c=a,(p=t.children[1].length>=3?t.children[1][2].value:1)>=1)for(;p>=1;)c=this.derivative(c,u),c=this.removeTrivialNodes(c),p--;l="node_op"==e.type&&"op_assign"==e.value?this.createNode("node_op","op_map",d,c):c,this.setMath(l),t.type=l.type,t.value=l.value,l.children.length>0&&(t.children[0]=l.children[0]),l.children.length>1&&(t.children[1]=l.children[1])}return t},removeTrivialNodes:function(t){var e,i,r,n,s;if(utils_type.A.isArray(t))for(i=t.length,e=0;e<i;++e)t[e]=this.removeTrivialNodes(t[e]);if("node_op"!=t.type||!t.children)return t;for(i=t.children.length,e=0;e<i;++e){this.mayNotBeSimplified=!1;do{t.children[e]=this.removeTrivialNodes(t.children[e])}while(this.mayNotBeSimplified)}switch(t.value){case"op_map":if(r=t.children[0],"node_var"==(n=t.children[1]).type)for(e=0;e<r.length;++e)if(r[e]==n.value){n.isMath=!0;break}break;case"op_add":if(r=t.children[0],n=t.children[1],"node_const"==r.type&&0===r.value)return n;if("node_const"==n.type&&0===n.value)return r;if("node_const"==r.type&&"node_const"==n.type)return r.value+=n.value,r;break;case"op_mul":if(r=t.children[0],n=t.children[1],"node_const"==r.type&&1==r.value)return n;if("node_const"==n.type&&1==n.value)return r;if("node_const"==r.type&&0===r.value)return r;if("node_const"==n.type&&0===n.value)return n;if("node_const"==n.type&&0===n.value)return n;if("node_op"==r.type&&"op_neg"==r.value&&"node_op"==n.type&&"op_neg"==n.value)return t.children=[r.children[0],n.children[0]],this.mayNotBeSimplified=!0,t;if("op_neg"==r.value&&"op_neg"!=n.value)return t.type="node_op",t.value="op_neg",t.children=[this.createNode("node_op","op_mul",r.children[0],n)],this.mayNotBeSimplified=!0,t;if("op_neg"!=r.value&&"op_neg"==n.value)return t.type="node_op",t.value="op_neg",t.children=[this.createNode("node_op","op_mul",r,n.children[0])],this.mayNotBeSimplified=!0,t;if("op_div"==r.value&&"node_const"==r.children[0].type&&1==r.children[0].value)return t.type="node_op",t.value="op_div",t.children=[n,r.children[1]],this.mayNotBeSimplified=!0,t;if("op_div"==n.value&&"node_const"==n.children[0].type&&1==n.children[0].value)return t.type="node_op",t.value="op_div",t.children=[r,n.children[1]],this.mayNotBeSimplified=!0,t;if("node_const"!=r.type&&"node_const"==n.type)return t.children=[n,r],this.mayNotBeSimplified=!0,t;if("node_const"!=r.type&&"node_op"==n.type&&"op_neg"==n.value&&"node_const"==n.children[0].type)return t.children=[n,r],this.mayNotBeSimplified=!0,t;if("node_op"==r.type&&"op_execfun"!=r.value&&("node_var"==n.type||"node_op"==n.type&&"op_execfun"==n.value))return t.children=[n,r],this.mayNotBeSimplified=!0,t;if("node_op"!=r.type&&"node_op"==n.type&&"op_neg"==n.value&&"node_var"==n.children[0].type)return t.children=[n,r],this.mayNotBeSimplified=!0,t;if("node_const"!=r.type&&"node_op"==n.type&&("op_mul"==n.value||"op_div"==n.value)&&"node_const"==n.children[0].type)return s=n.children[0],n.children[0]=r,t.children=[s,n],this.mayNotBeSimplified=!0,t;if("node_const"!=n.type&&"node_op"==r.type&&"op_mul"==r.value&&"node_const"==r.children[0].type)return t.children=[r.children[0],this.createNode("node_op","op_mul",r.children[1],n)],this.mayNotBeSimplified=!0,t;if("node_const"==r.type&&"node_const"==n.type)return r.value*=n.value,r;if("node_const"==r.type&&"node_op"==n.type&&("op_mul"==n.value||"op_div"==n.value)&&"node_const"==n.children[0].type)return n.children[0].value*=r.value,n;if(r.hash=this.parser.compile(r),n.hash=this.parser.compile(n),r.hash===n.hash)return t.value="op_exp",t.children[1]=this.createNode("node_const",2),t;if("node_const"==r.type&&"node_op"==n.type&&("op_mul"==n.value||"op_div"==n.value)&&"node_const"==n.children[0].type)return n.children[0].value*=r.value,n;if("node_op"==n.type&&"op_exp"==n.value&&(r.hash||(r.hash=this.parser.compile(r)),n.children[0].hash||(n.children[0].hash=this.parser.compile(n.children[0])),r.hash===n.children[0].hash))return n.children[1]=this.createNode("node_op","op_add",n.children[1],this.createNode("node_const",1)),this.mayNotBeSimplified=!0,n;if("node_op"==r.type&&"op_exp"==r.value&&"node_op"==n.type&&"op_exp"==n.value&&(r.children[0].hash=this.parser.compile(r.children[0]),n.children[0].hash=this.parser.compile(n.children[0]),r.children[0].hash===n.children[0].hash))return r.children[1]=this.createNode("node_op","op_add",r.children[1],n.children[1]),this.mayNotBeSimplified=!0,r;break;case"op_sub":if(r=t.children[0],n=t.children[1],"node_const"==r.type&&0===r.value)return t.value="op_neg",t.children[0]=n,t;if("node_const"==n.type&&0===n.value)return r;if("node_const"==r.type&&"node_const"==n.type&&r.value==n.value)return this.createNode("node_const",0);if("node_var"==r.type&&"node_var"==n.type&&r.value==n.value)return this.createNode("node_const",0);if("node_const"==r.type&&"node_const"==n.type)return r.value-=n.value,r;if("node_op"==r.type&&"op_mul"==r.value&&"node_op"==n.type&&"op_mul"==n.value&&(r.children[1].hash=this.parser.compile(r.children[1]),n.children[1].hash=this.parser.compile(n.children[1]),r.children[1].hash===n.children[1].hash))return t.value="op_mul",t.children=[this.createNode("node_op","op_sub",r.children[0],n.children[0]),r.children[1]],this.mayNotBeSimplified=!0,t;if("node_op"==r.type&&"op_mul"==r.value&&(r.children[1].hash=this.parser.compile(r.children[1]),n.hash=this.parser.compile(n),r.children[1].hash===n.hash))return t.value="op_mul",t.children=[this.createNode("node_op","op_sub",r.children[0],this.createNode("node_const",1)),n],this.mayNotBeSimplified=!0,t;if("node_op"==n.type&&"op_mul"==n.value&&(n.children[1].hash=this.parser.compile(n.children[1]),r.hash=this.parser.compile(r),n.children[1].hash===r.hash))return t.value="op_mul",t.children=[this.createNode("node_op","op_sub",this.createNode("node_const",1),n.children[0]),r],this.mayNotBeSimplified=!0,t;break;case"op_neg":if("node_const"==(r=t.children[0]).type&&0===r.value)return r;if("node_op"==r.type&&"op_neg"==r.value)return r.children[0];break;case"op_div":if(r=t.children[0],n=t.children[1],"node_const"==r.type&&"node_const"==n.type&&r.value==n.value&&0!==r.value)return r.value=1,r;if("node_const"==r.type&&0===r.value&&"node_const"==n.type&&0!==n.value)return r.value=0,r;if("node_const"==r.type&&0===r.value&&("node_op"==n.type||"node_var"==n.type))return t.type="node_const",t.value=0,t;if("node_var"==r.type&&"node_var"==n.type&&r.value==n.value)return this.createNode("node_const",1);if("node_const"==r.type&&0!==r.value&&"node_const"==n.type&&0===n.value)return r.value>0?r.value=1/0:r.value=-1/0,r;if("node_op"==r.type&&"op_neg"==r.value&&"node_op"==n.type&&"op_neg"==n.value)return t.children=[r.children[0],n.children[0]],this.mayNotBeSimplified=!0,t;if("op_neg"==r.value&&"op_neg"!=n.value)return t.type="node_op",t.value="op_neg",t.children=[this.createNode("node_op","op_div",r.children[0],n)],this.mayNotBeSimplified=!0,t;if("op_neg"!=r.value&&"op_neg"==n.value)return t.type="node_op",t.value="op_neg",t.children=[this.createNode("node_op","op_div",r,n.children[0])],this.mayNotBeSimplified=!0,t;if("node_op"==r.type&&"op_exp"==r.value&&(n.hash||(n.hash=this.parser.compile(n)),r.children[0].hash||(r.children[0].hash=this.parser.compile(r.children[0])),n.hash===r.children[0].hash))return r.children[1]=this.createNode("node_op","op_sub",r.children[1],this.createNode("node_const",1)),this.mayNotBeSimplified=!0,r;if("node_const"!=n.type&&"node_op"==r.type&&"op_mul"==r.value&&"node_const"==r.children[0].type)return t.value="op_mul",t.children=[r.children[0],this.createNode("node_op","op_div",r.children[1],n)],this.mayNotBeSimplified=!0,t;if("node_op"==r.type&&"op_exp"==r.value&&"node_op"==n.type&&"op_exp"==n.value&&(r.children[0].hash=this.parser.compile(r.children[0]),n.children[0].hash=this.parser.compile(n.children[0]),r.children[0].hash===n.children[0].hash))return r.children[1]=this.createNode("node_op","op_sub",r.children[1],n.children[1]),this.mayNotBeSimplified=!0,r;break;case"op_exp":if(r=t.children[0],"node_const"==(n=t.children[1]).type&&0===n.value)return n.value=1,n;if("node_const"==n.type&&1==n.value)return r;if("node_const"==r.type&&1==r.value)return r;if("node_const"==r.type&&0===r.value&&"node_const"==n.type&&0!==n.value)return r;if("node_op"==r.type&&"op_exp"==r.value)return t.children=[r.children[0],this.createNode("node_op","op_mul",r.children[1],n)],t}switch(t.value){case"op_add":if(r=t.children[0],n=t.children[1],"node_const"==r.type&&"node_const"==n.type&&r.value==n.value)return r.value+=n.value,r;if("node_var"==r.type&&"node_var"==n.type&&r.value==n.value)return t.children[0]=this.createNode("node_const",2),t.value="op_mul",t;if("node_op"==r.type&&"op_neg"==r.value)return t.value="op_sub",t.children[0]=n,t.children[1]=r.children[0],this.mayNotBeSimplified=!0,t;if("node_op"==n.type&&"op_neg"==n.value)return t.value="op_sub",t.children[1]=n.children[0],this.mayNotBeSimplified=!0,t;if("node_op"==r.type&&"op_mul"==r.value&&"node_op"==n.type&&"op_mul"==n.value&&(r.children[1].hash=this.parser.compile(r.children[1]),n.children[1].hash=this.parser.compile(n.children[1]),r.children[1].hash===n.children[1].hash))return t.value="op_mul",t.children=[this.createNode("node_op","op_add",r.children[0],n.children[0]),r.children[1]],this.mayNotBeSimplified=!0,t;if("node_op"==r.type&&"op_mul"==r.value&&(r.children[1].hash=this.parser.compile(r.children[1]),n.hash=this.parser.compile(n),r.children[1].hash===n.hash))return t.value="op_mul",t.children=[this.createNode("node_op","op_add",r.children[0],this.createNode("node_const",1)),n],this.mayNotBeSimplified=!0,t;if("node_op"==n.type&&"op_mul"==n.value&&(n.children[1].hash=this.parser.compile(n.children[1]),r.hash=this.parser.compile(r),n.children[1].hash===r.hash))return t.value="op_mul",t.children=[this.createNode("node_op","op_add",this.createNode("node_const",1),n.children[0]),r],this.mayNotBeSimplified=!0,t;break;case"op_sub":if(r=t.children[0],"node_op"==(n=t.children[1]).type&&"op_neg"==n.value)return t.value="op_add",t.children[1]=n.children[0],this.mayNotBeSimplified=!0,t;break;case"op_execfun":return this.simplifyElementary(t)}return t},simplifyElementary:function(t){var e=t.children[0].value,i=t.children[1];if(0==i.length)return t;switch(e){case"sin":case"tan":if("node_const"==i[0].type&&0===i[0].value)return t.type="node_const",t.value=0,t;if("node_var"==i[0].type&&"PI"==i[0].value)return t.type="node_const",t.value=0,t;if("node_op"==i[0].type&&"op_mul"==i[0].value&&"node_const"==i[0].children[0].type&&i[0].children[0].value%1==0&&"node_var"==i[0].children[1].type&&"PI"==i[0].children[1].value)return t.type="node_const",t.value=0,t;break;case"cos":if("node_const"==i[0].type&&0===i[0].value)return t.type="node_const",t.value=1,t;if("node_var"==i[0].type&&"PI"==i[0].value)return t.type="node_op",t.value="op_neg",t.children=[this.createNode("node_const",1)],t;break;case"exp":if("node_const"==i[0].type&&0===i[0].value)return t.type="node_const",t.value=1,t;break;case"pow":if("node_const"==i[1].type&&0===i[1].value)return t.type="node_const",t.value=1,t}return t}});const ca=jxg.A.CA;jxg.A.Dump={addMarkers:function(t,e,i){var r,n,s;for(r in utils_type.A.isArray(e)||(e=[e]),utils_type.A.isArray(i)||(i=[i]),n=Math.min(e.length,i.length),e.length=n,i.length=n,t.objects)if(t.objects.hasOwnProperty(r))for(s=0;s<n;s++)t.objects[r][e[s]]=i[s]},deleteMarkers:function(t,e){var i,r,n;for(i in utils_type.A.isArray(e)||(e=[e]),r=e.length,e.length=r,t.objects)if(t.objects.hasOwnProperty(i))for(n=0;n<r;n++)delete t.objects[i][e[n]]},str:function(t){return"string"==typeof t&&"function"!==t.slice(0,7)&&(t='"'+t+'"'),t},minimizeObject:function(t,e){var i,r,n,s={},o=utils_type.A.deepCopy(t),a=[];for(n=1;n<arguments.length;n++)a.push(arguments[n]);for(s=utils_type.A.deepCopy(s,jxg.A.Options.elements,!0),n=a.length;n>0;n--)s=utils_type.A.deepCopy(s,a[n-1],!0);for(i in s)s.hasOwnProperty(i)&&(r=i.toLowerCase(),"object"!=typeof s[i]&&s[i]===o[r]&&delete o[r]);return o},prepareAttributes:function(t,e){var i,r;for(r in i=this.minimizeObject(e.getAttributes(),jxg.A.Options[e.elType]),e.subs)e.subs.hasOwnProperty(r)&&(i[r]=this.minimizeObject(e.subs[r].getAttributes(),jxg.A.Options[e.elType][r],jxg.A.Options[e.subs[r].elType]),i[r].id=e.subs[r].id,i[r].name=e.subs[r].name);return i.id=e.id,i.name=e.name,i},setBoundingBox:function(t,e,i){return t.push({obj:i,method:"setBoundingBox",params:[e.getBoundingBox(),e.keepaspectratio]}),t},dump:function(t){var e,i,r,n,s=[],o=[],a=t.objectsList.length;for(this.addMarkers(t,"dumped",!1),e=0;e<a;e++)if(r={},!(i=t.objectsList[e]).dumped&&i.dump){for(r.type=i.getType(),r.parents=i.getParents().slice(),"point"===r.type&&1===r.parents[0]&&(r.parents=r.parents.slice(1)),n=0;n<r.parents.length;n++)utils_type.A.isString(r.parents[n])&&"'"!==r.parents[n][0]&&'"'!==r.parents[n][0]?r.parents[n]='"'+r.parents[n]+'"':utils_type.A.isArray(r.parents[n])&&(r.parents[n]="["+r.parents[n].toString()+"]");r.attributes=this.prepareAttributes(t,i),"glider"===r.type&&i.onPolygon&&s.push({obj:i.id,prop:"onPolygon",val:!0}),o.push(r)}return this.deleteMarkers(t,"dumped"),{elements:o,props:s,methods:[]}},arrayToParamStr:function(t,e){var i,r=[];for(i=0;i<t.length;i++)r.push(e.call(this,t[i]));return r.join(", ")},toJCAN:function(t){var e,i,r;switch(typeof t){case"object":if(t){if(i=[],utils_type.A.isArray(t)){for(e=0;e<t.length;e++)i.push(this.toJCAN(t[e]));return"["+i.join(",")+"]"}for(r in t)t.hasOwnProperty(r)&&i.push(r+": "+this.toJCAN(t[r]));return"<<"+i.join(", ")+">> "}return"null";case"string":return"'"+t.replace(/\\/g,"\\\\").replace(/(["'])/g,"\\$1")+"'";case"number":case"boolean":return t.toString();case"null":return"null"}},toJessie:function(t){var e,i,r,n=this.dump(t),s=[];for(n.methods=this.setBoundingBox(n.methods,t,"$board"),i=n.elements,e=0;e<i.length;e++)i[e].attributes.name.length>0&&s.push("// "+i[e].attributes.name),s.push("s"+e+" = "+i[e].type+"("+i[e].parents.join(", ")+") "+this.toJCAN(i[e].attributes).replace(/\n/,"\\n")+";"),"axis"===i[e].type&&(r=i[e].attributes.id,null===t.objects[r].defaultTicks&&s.push("s"+e+".removeAllTicks();")),s.push("");for(e=0;e<n.methods.length;e++)s.push(n.methods[e].obj+"."+n.methods[e].method+"("+this.arrayToParamStr(n.methods[e].params,this.toJCAN)+");"),s.push("");for(e=0;e<n.props.length;e++)s.push(n.props[e].obj+"."+n.props[e].prop+" = "+this.toJCAN(n.props[e].val)+";"),s.push("");return s.join("\n")},toJavaScript:function(t){var e,i,r,n=this.dump(t),s=[];for(n.methods=this.setBoundingBox(n.methods,t,"board"),i=n.elements,e=0;e<i.length;e++)s.push('board.create("'+i[e].type+'", ['+i[e].parents.join(", ")+"], "+utils_type.A.toJSON(i[e].attributes)+");"),"axis"===i[e].type&&(r=i[e].attributes.id,null===t.objects[r].defaultTicks&&s.push('board.objects["'+r+'"].removeTicks(board.objects["'+r+'"].defaultTicks);'));for(e=0;e<n.methods.length;e++)s.push(n.methods[e].obj+"."+n.methods[e].method+"("+this.arrayToParamStr(n.methods[e].params,utils_type.A.toJSON)+");"),s.push("");for(e=0;e<n.props.length;e++)s.push(n.props[e].obj+"."+n.props[e].prop+" = "+utils_type.A.toJSON(n.props[e].val)+";"),s.push("");return s.join("\n")}};const dump=jxg.A.Dump;jxg.A.createComb=function(t,e,i){var r,n,s,o,a;if(2!==e.length)throw a=e.map((function(t){return"'"+typeof t+"'"})),new Error("JSXGraph: Can't create comb with parent types "+a.join(", ")+".\nPossible parent types: [point,point], [[x1,y1],[x2,y2]]");if(utils_type.A.isArray(e[0])&&e[0].length>1)o=utils_type.A.copyAttributes(i,t.options,"comb","point1"),r=t.create("point",e[0],o);else if(utils_type.A.isString(e[0])||utils_type.A.isPoint(e[0]))r=t.select(e[0]);else if(utils_type.A.isFunction(e[0])&&utils_type.A.isPoint(e[0]()))r=e[0]();else{if(!(utils_type.A.isFunction(e[0])&&e[0]().length&&e[0]().length>=2))throw new Error("JSXGraph: Can't create comb with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [point,point], [[x1,y1],[x2,y2]]");o=utils_type.A.copyAttributes(i,t.options,"comb","point1"),r=jxg.A.createPoint(t,e[0](),o)}if(utils_type.A.isArray(e[1])&&e[1].length>1)o=utils_type.A.copyAttributes(i,t.options,"comb","point2"),n=t.create("point",e[1],o);else if(utils_type.A.isString(e[1])||utils_type.A.isPoint(e[1]))n=t.select(e[1]);else if(utils_type.A.isFunction(e[1])&&utils_type.A.isPoint(e[1]()))n=e[1]();else{if(!(utils_type.A.isFunction(e[1])&&e[1]().length&&e[1]().length>=2))throw new Error("JSXGraph: Can't create comb with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [point,point], [[x1,y1],[x2,y2]]");o=utils_type.A.copyAttributes(i,t.options,"comb","point2"),n=jxg.A.createPoint(t,e[1](),o)}return o=utils_type.A.copyAttributes(i,t.options,"comb"),(s=t.create("curve",[[0],[0]],o)).updateDataArray=function(){var t,e,i,o,a,l,c,h,u,d,p=0,f=r.Dist(n),m=r,g=n;for(h=s.evalVisProp("frequency"),u=-s.evalVisProp("angle"),d=s.evalVisProp("width"),s.evalVisProp("reverse")&&(m=n,g=r,u=-u),t=Math.cos(u),e=Math.sin(u),i=(g.X()-m.X())/f,o=(g.Y()-m.Y())/f,t*=d/Math.abs(e),e*=d/Math.abs(e),this.dataX=[],this.dataY=[];p<f;)a=m.X()+i*p,l=m.Y()+o*p,e*=c=Math.min(t,f-p)/Math.abs(t),t*=c,this.dataX.push(a),this.dataY.push(l),this.dataX.push(a+i*t+o*e),this.dataY.push(l-i*e+o*t),this.dataX.push(NaN),this.dataY.push(NaN),p+=h},s},jxg.A.registerElement("comb",jxg.A.createComb);var priv={removeSlopeTriangle:function(){polygon.prototype.remove.call(this),this.board.removeObject(this.toppoint),this.board.removeObject(this.glider),this.board.removeObject(this.baseline),this.board.removeObject(this.basepoint),this.board.removeObject(this.label),this._isPrivateTangent&&this.board.removeObject(this.tangent)},Value:function(){return this.tangent.getSlope()},Direction:function(){return this.tangent.Direction()}};jxg.A.createSlopeTriangle=function(t,e,i){var r,n,s,o,a,l,c,h,u,d=!1;if(1===e.length&&e[0].type===constants.A.OBJECT_TYPE_TANGENT)n=e[0],s=n.glider;else if(1===e.length&&e[0].type===constants.A.OBJECT_TYPE_GLIDER)s=e[0],u=utils_type.A.copyAttributes(i,t.options,"slopetriangle","tangent"),n=t.create("tangent",[s],u),d=!0;else{if(2!==e.length||e[0].elementClass!==constants.A.OBJECT_CLASS_LINE||!utils_type.A.isPoint(e[1]))throw new Error("JSXGraph: Can't create slope triangle with parent types '"+typeof e[0]+"'.");n=e[0],s=e[1]}return u=utils_type.A.copyAttributes(i,t.options,"slopetriangle","basepoint"),c=t.create("point",[function(){return[s.X()+1,s.Y()]}],u),u=utils_type.A.copyAttributes(i,t.options,"slopetriangle","baseline"),l=t.create("line",[s,c],u),u=utils_type.A.copyAttributes(i,t.options,"slopetriangle","glider"),o=t.create("glider",[s.X()+1,s.Y(),l],u),u=utils_type.A.copyAttributes(i,t.options,"slopetriangle","toppoint"),a=t.create("point",[function(){return[o.X(),o.Y()+(o.X()-s.X())*n.getSlope()]}],u),u=utils_type.A.copyAttributes(i,t.options,"slopetriangle"),(r=t.create("polygon",[s,o,a],u)).Value=priv.Value,r.Direction=priv.Direction,r.tangent=n,r._isPrivateTangent=d,r.borders[2].setArrow(!1,!1),u=utils_type.A.copyAttributes(i,t.options,"slopetriangle","label"),(u=utils_type.A.copyAttributes(u,t.options,"label")).isLabel=!0,u.anchor=r.borders[1],u.priv=r.borders[1].visProp.priv,u.id=r.borders[1].id+"Label",(h=t.create("text",[0,0,function(){return""}],u)).needsUpdate=!0,h.dump=!1,r.borders[1].label=h,r.borders[1].hasLabel=!0,r.borders[1].visProp.withlabel=!0,h._setText((function(){var t=h.evalVisProp("digits");return h.useLocale()?h.formatNumberLocale(r.Value(),t):utils_type.A.toFixed(r.Value(),t)})),h.fullUpdate(),r.glider=o,r.basepoint=c,r.baseline=l,r.toppoint=a,r.label=h,r.subs={glider:o,basePoint:c,baseLine:l,topPoint:a,label:h},r.inherits.push(o,c,l,a,h),r.methodMap=jxg.A.deepCopy(r.methodMap,{tangent:"tangent",glider:"glider",basepoint:"basepoint",baseline:"baseline",toppoint:"toppoint",label:"label",Value:"Value",V:"Value",Direction:"Direction"}),r.remove=priv.removeSlopeTriangle,r},jxg.A.registerElement("slopetriangle",jxg.A.createSlopeTriangle);var checkbox_priv={CheckboxChangeEventHandler:function(){this._value=this.rendNodeCheckbox.checked,this.board.update()}};jxg.A.createCheckbox=function(t,e,i){var r,n,s=utils_type.A.copyAttributes(i,t.options,"checkbox");return n=[e[0],e[1],'<span style="display:inline"><input type="checkbox" /><label for=""></label></span>'],(r=t.create("text",n,s)).type=utils_type.A.OBJECT_TYPE_CHECKBOX,r.rendNodeCheckbox=r.rendNode.childNodes[0].childNodes[0],r.rendNodeLabel=r.rendNode.childNodes[0].childNodes[1],r.rendNodeTag=r.rendNodeCheckbox,r.rendNodeTag.disabled=!!s.disabled,r.rendNodeCheckbox.id=r.rendNode.id+"_checkbox",r.rendNodeLabel.id=r.rendNode.id+"_label",r.rendNodeLabel.setAttribute("for",r.rendNodeCheckbox.id),r.setText(e[2]),r.visPropOld.fontsize="0px",t.renderer.updateTextStyle(r,!1),r.rendNodeCheckbox.checked=s.checked,r._value=s.checked,r.Value=function(){return this._value},r.update=function(){return this.needsUpdate&&(jxg.A.Text.prototype.update.call(this),this._value=this.rendNodeCheckbox.checked),this},env.A.addEvent(r.rendNodeCheckbox,"change",checkbox_priv.CheckboxChangeEventHandler,r),r},jxg.A.registerElement("checkbox",jxg.A.createCheckbox);var input_priv={InputInputEventHandler:function(t){this._value=this.rendNodeInput.value,this.board.update()}};jxg.A.createInput=function(t,e,i){var r,n,s=utils_type.A.copyAttributes(i,t.options,"input");return n=[e[0],e[1],'<span style="display:inline; white-space:nowrap; padding:0px;"><label></label><input type="text" maxlength="'+s.maxlength+'" style="width:100%"/></span>'],(r=t.create("text",n,s)).type=utils_type.A.OBJECT_TYPE_INPUT,r.rendNodeLabel=r.rendNode.childNodes[0].childNodes[0],r.rendNodeInput=r.rendNode.childNodes[0].childNodes[1],r.rendNodeInput.value=e[2],r.rendNodeTag=r.rendNodeInput,r.rendNodeTag.disabled=!!s.disabled,r.rendNodeLabel.id=r.rendNode.id+"_label",r.rendNodeInput.id=r.rendNode.id+"_input",r.rendNodeInput.setAttribute("aria-labelledby",r.rendNodeLabel.id),r.setText(e[3]),r._value=e[2],r.update=function(){return this.needsUpdate&&(jxg.A.Text.prototype.update.call(this),this._value=this.rendNodeInput.value),this},r.Value=function(){return this._value},r.set=function(t){return this._value=t,this.rendNodeInput.value=t,this},env.A.addEvent(r.rendNodeInput,"input",input_priv.InputInputEventHandler,r),env.A.addEvent(r.rendNodeInput,"mousedown",(function(t){utils_type.A.exists(t.stopPropagation)&&t.stopPropagation()}),r),env.A.addEvent(r.rendNodeInput,"touchstart",(function(t){utils_type.A.exists(t.stopPropagation)&&t.stopPropagation()}),r),env.A.addEvent(r.rendNodeInput,"pointerdown",(function(t){utils_type.A.exists(t.stopPropagation)&&t.stopPropagation()}),r),r.visPropOld.fontsize="0px",t.renderer.updateTextStyle(r,!1),r},jxg.A.registerElement("input",jxg.A.createInput);var button_priv={ButtonClickEventHandler:function(){this._handler&&this._handler(),this.board.update()}};jxg.A.createButton=function(t,e,i){var r,n,s=utils_type.A.copyAttributes(i,t.options,"button");return n=[e[0],e[1],'<button type="button" style="width:100%;" tabindex="0"></button>'],(r=t.create("text",n,s)).type=utils_type.A.OBJECT_TYPE_BUTTON,r.rendNodeButton=r.rendNode.childNodes[0],r.rendNodeButton.id=r.rendNode.id+"_button",r.rendNodeTag=r.rendNodeButton,r.rendNodeTag.disabled=!!s.disabled,r.setText(e[2]),r.visPropOld.fontsize="0px",t.renderer.updateTextStyle(r,!1),e[3]&&(utils_type.A.isString(e[3])?(r._jc=new jxg.A.JessieCode,r._jc.use(t),r._handler=function(){r._jc.parse(e[3])}):r._handler=e[3]),env.A.addEvent(r.rendNodeButton,"click",button_priv.ButtonClickEventHandler,r),env.A.addEvent(r.rendNodeButton,"mousedown",(function(t){utils_type.A.exists(t.stopPropagation)&&t.stopPropagation()}),r),env.A.addEvent(r.rendNodeButton,"touchstart",(function(t){utils_type.A.exists(t.stopPropagation)&&t.stopPropagation()}),r),env.A.addEvent(r.rendNodeButton,"pointerdown",(function(t){utils_type.A.exists(t.stopPropagation)&&t.stopPropagation()}),r),r},jxg.A.registerElement("button",jxg.A.createButton),jxg.A.createVectorField=function(t,e,i){var r,n;if(!(e.length>=3&&(utils_type.A.isArray(e[0])||utils_type.A.isFunction(e[0])||utils_type.A.isString(e[0]))&&utils_type.A.isArray(e[1])&&3===e[1].length&&utils_type.A.isArray(e[2])&&3===e[2].length))throw new Error("JSXGraph: Can't create vector field with parent types '"+typeof e[0]+"', '"+typeof e[1]+"', '"+typeof e[2]+"'.");return n=utils_type.A.copyAttributes(i,t.options,"vectorfield"),(r=t.create("curve",[[],[]],n)).elType="vectorfield",r.setF=function(t,e){var i,n;return utils_type.A.isArray(t)?(i=utils_type.A.createFunction(t[0],this.board,e),n=utils_type.A.createFunction(t[1],this.board,e),this.F=function(t,e){return[i(t,e),n(t,e)]}):this.F=utils_type.A.createFunction(t,r.board,e),this},r.setF(e[0],"x, y"),r.xData=e[1],r.yData=e[2],r.updateDataArray=function(){var e,i,r,n,s,o,a,l,c,h,u,d,p=this.evalVisProp("scale"),f=utils_type.A.evaluate(this.xData[0]),m=utils_type.A.evaluate(this.xData[1]),g=(utils_type.A.evaluate(this.xData[2])-f)/m,_=utils_type.A.evaluate(this.yData[0]),v=utils_type.A.evaluate(this.yData[1]),y=(utils_type.A.evaluate(this.yData[2])-_)/v,b=this.evalVisProp("arrowhead.enabled");for(b&&(h=(c=this.evalVisProp("arrowhead.size"))/t.unitX,u=c/t.unitY,d=this.evalVisProp("arrowhead.angle")),this.dataX=[],this.dataY=[],r=0,e=f;r<=m;e+=g,r++)for(n=0,i=_;n<=v;i+=y,n++)(s=this.F(e,i))[0]*=p,s[1]*=p,utils_type.A.concat(this.dataX,[e,e+s[0],NaN]),utils_type.A.concat(this.dataY,[i,i+s[1],NaN]),b&&Math.abs(s[0])+Math.abs(s[1])>0&&(a=(o=Math.atan2(s[1],s[0]))+d,l=o-d,utils_type.A.concat(this.dataX,[e+s[0]-Math.cos(a)*h,e+s[0],e+s[0]-Math.cos(l)*h,NaN]),utils_type.A.concat(this.dataY,[i+s[1]-Math.sin(a)*u,i+s[1],i+s[1]-Math.sin(l)*u,NaN]))},r.methodMap=utils_type.A.deepCopy(r.methodMap,{setF:"setF"}),r},jxg.A.registerElement("vectorfield",jxg.A.createVectorField),jxg.A.createSlopeField=function(t,e,i){var r,n,s;if(!(e.length>=3&&(utils_type.A.isFunction(e[0])||utils_type.A.isString(e[0]))&&utils_type.A.isArray(e[1])&&3===e[1].length&&utils_type.A.isArray(e[2])&&3===e[2].length))throw new Error("JSXGraph: Can't create slope field with parent types '"+typeof e[0]+"', '"+typeof e[1]+"', '"+typeof e[2]+"'.");return n=utils_type.A.createFunction(e[0],t,"x, y"),e[0]=function(t,e){var i=n(t,e),r=Math.sqrt(1+i*i);return[1/r,i/r]},s=utils_type.A.copyAttributes(i,t.options,"slopefield"),(r=t.create("vectorfield",e,s)).elType="slopefield",r.setF=function(t,e){var i=utils_type.A.createFunction(t,r.board,e);this.F=function(t,e){var r=i(t,e),n=Math.sqrt(1+r*r);return[1/n,r/n]}},r.methodMap=utils_type.A.deepCopy(r.methodMap,{setF:"setF"}),r},jxg.A.registerElement("slopefield",jxg.A.createSlopeField),jxg.A.createSmartLabel=function(t,e,i){var r,n,s,o,a,l;if(0===e.length||[constants.A.OBJECT_CLASS_POINT,constants.A.OBJECT_CLASS_LINE,constants.A.OBJECT_CLASS_CIRCLE].indexOf(e[0].elementClass)<0&&[constants.A.OBJECT_TYPE_POLYGON,constants.A.OBJECT_TYPE_ANGLE].indexOf(e[0].type)<0)throw new Error("JSXGraph: Can't create smartlabel with parent types '"+typeof e[0]+"', '"+typeof e[1]+"'.");return s=e[0],o=e[1]||"",s.elementClass===constants.A.OBJECT_CLASS_POINT?n=utils_type.A.copyAttributes(i,t.options,"smartlabelpoint"):s.elementClass===constants.A.OBJECT_CLASS_LINE?((n=utils_type.A.copyAttributes(i,t.options,"smartlabelline")).rotate=function(){return 180*Math.atan(s.getSlope())/Math.PI},n.visible=function(){return!(s.L()<1.5)}):s.elementClass===constants.A.OBJECT_CLASS_CIRCLE?(n=utils_type.A.copyAttributes(i,t.options,"smartlabelcircle")).visible=function(){return!(s.Radius()<1.5)}:s.type===constants.A.OBJECT_TYPE_POLYGON?n=utils_type.A.copyAttributes(i,t.options,"smartlabelpolygon"):s.type===constants.A.OBJECT_TYPE_ANGLE&&((n=utils_type.A.copyAttributes(i,t.options,"smartlabelangle")).rotate=function(){var t=s.center.coords.usrCoords,e=s.getLabelAnchor().usrCoords,i=180*Math.atan2(e[2]-t[2],e[1]-t[1])/Math.PI;return i>90&&i<270?i+180:i},n.anchorX=function(){var t=s.center.coords.usrCoords,e=s.getLabelAnchor().usrCoords,i=180*Math.atan2(e[2]-t[2],e[1]-t[1])/Math.PI;return i>90&&i<270?"right":"left"}),a=function(t,e,i,r){var n;switch(r){case"length":n=function(){return e.L()};break;case"slope":n=function(){return e.Slope()};break;case"area":n=function(){return e.Area()};break;case"radius":n=function(){return e.Radius()};break;case"perimeter":n=function(){return e.Perimeter()};break;case"rad":n=function(){return e.Value()};break;case"deg":n=function(){return 180*e.Value()/Math.PI};break;default:n=function(){return 0}}return function(){var e,i="",r=utils_type.A.evaluate(o),s=t.evalVisProp("digits"),a=t.evalVisProp("unit"),l=t.evalVisProp("prefix"),c=t.evalVisProp("suffix"),h=t.evalVisProp("usemathjax")||t.evalVisProp("usekatex");return""===r?(e=t.useLocale()?t.formatNumberLocale(n(),s):utils_type.A.toFixed(n(),s),i=h?["\\(",l,e,"\\,",a,c,"\\)"].join(""):[l,e,a,c].join("")):i=r,i}},s.elementClass===constants.A.OBJECT_CLASS_POINT?(r=t.create("text",[function(){return s.X()},function(){return s.Y()},""],n),l=function(){var t,e,i="",n=utils_type.A.evaluate(o),a=r.evalVisProp("digits"),l=r.evalVisProp("unit"),c=r.evalVisProp("prefix"),h=r.evalVisProp("suffix"),u=r.evalVisProp("dir"),d=r.evalVisProp("usemathjax")||r.evalVisProp("usekatex");return r.useLocale()?(t=r.formatNumberLocale(s.X(),a),e=r.formatNumberLocale(s.Y(),a)):(t=utils_type.A.toFixed(s.X(),a),e=utils_type.A.toFixed(s.Y(),a)),""===n?"row"===u?i=d?["\\(",c,t,"\\,",l," / ",e,"\\,",l,h,"\\)"].join(""):[c,t," ",l," / ",e," ",l,h].join(""):0===u.indexOf("col")&&(i=d?["\\(",c,"\\left(\\array{",t,"\\,",l,"\\\\ ",e,"\\,",l,"}\\right)",h,"\\)"].join(""):[c,t," ",l,"<br/>",e," ",l,h].join("")):i=n,i}):s.elementClass===constants.A.OBJECT_CLASS_LINE?"length"===n.measure?l=a(r=t.create("text",[function(){return.5*(s.point1.X()+s.point2.X())},function(){return.5*(s.point1.Y()+s.point2.Y())},""],n),s,0,"length"):"slope"===n.measure&&(l=a(r=t.create("text",[function(){return.25*s.point1.X()+.75*s.point2.X()},function(){return.25*s.point1.Y()+.75*s.point2.Y()},""],n),s,0,"slope")):s.elementClass===constants.A.OBJECT_CLASS_CIRCLE?"radius"===n.measure?l=a(r=t.create("text",[function(){return s.center.X()+.5*s.Radius()},function(){return s.center.Y()},""],n),s,0,"radius"):"area"===n.measure?l=a(r=t.create("text",[function(){return s.center.X()},function(){return s.center.Y()+.5*s.Radius()},""],n),s,0,"area"):"circumference"!==n.measure&&"perimeter"!==n.measure||(l=a(r=t.create("text",[function(){return s.getLabelAnchor()},""],n),s,0,"perimeter")):s.type===constants.A.OBJECT_TYPE_POLYGON?"area"===n.measure?l=a(r=t.create("text",[function(){return s.getTextAnchor()},""],n),s,0,"area"):"perimeter"===n.measure&&(l=a(r=t.create("text",[function(){var t=s.borders.length-1;return t>=0?[.5*(s.borders[t].point1.X()+s.borders[t].point2.X()),.5*(s.borders[t].point1.Y()+s.borders[t].point2.Y())]:s.getTextAnchor()},""],n),s,0,"perimeter")):s.type===constants.A.OBJECT_TYPE_ANGLE&&(l=a(r=t.create("text",[function(){return s.getLabelAnchor()},""],n),s,0,n.measure)),utils_type.A.exists(r)&&(r.setText(l),s.addChild(r),r.setParents([s])),r},jxg.A.registerElement("smartlabel",jxg.A.createSmartLabel),jxg.A.ForeignObject=function(t,e,i,r,n){this.constructor(t,i,constants.A.OBJECT_TYPE_FOREIGNOBJECT,constants.A.OBJECT_CLASS_OTHER),this.element=this.board.select(i.anchor),this.coordsConstructor(e),this._useUserSize=!1,this.size=[1,1],utils_type.A.exists(n)&&n.length>0&&(this._useUserSize=!0,this.W=utils_type.A.createFunction(n[0],this.board,""),this.H=utils_type.A.createFunction(n[1],this.board,""),this.addParentsFromJCFunctions([this.W,this.H]),this.usrSize=[this.W(),this.H()]),this.content=r,this.elType="foreignobject",this.id=this.board.setId(this,"Im"),this.board.renderer.drawForeignObject(this),this.board.finalizeAdding(this),this.methodMap=jxg.A.deepCopy(this.methodMap,{addTransformation:"addTransform",trans:"addTransform",W:"W",Width:"W",H:"H",Height:"H"})},jxg.A.ForeignObject.prototype=new base_element.A,utils_type.A.copyPrototypeMethods(jxg.A.ForeignObject,coordselement.A,"coordsConstructor"),jxg.A.extend(jxg.A.ForeignObject.prototype,{hasPoint:function(t,e){var i,r,n,s,o,a,l,c,h,u=this.transformations.length;return utils_type.A.isObject(this.evalVisProp("precision"))?(s=this.board._inputDevice,o=this.evalVisProp("precision."+s)):o=this.board.options.precision.hasPoint,0===u?(i=t-this.coords.scrCoords[1],r=this.coords.scrCoords[2]-e,i>=-(n=o)&&i-this.size[0]<=n&&r>=-n&&r-this.size[1]<=n):(l=[(a=(a=new base_coords.A(constants.A.COORDS_BY_SCREEN,[t,e],this.board)).usrCoords)[0]-this.span[0][0],a[1]-this.span[0][1],a[2]-this.span[0][2]],0<=(c=(h=math.A.innerProduct)(l,this.span[1]))&&c<=h(this.span[1],this.span[1])&&0<=(c=h(l,this.span[2]))&&c<=h(this.span[2],this.span[2]))},update:function(t){return this.needsUpdate?(this.updateCoords(t),this.updateSize(),this):this},updateRenderer:function(){return this.updateRendererGeneric("updateForeignObject")},updateSize:function(){var t=[0,0];return this._useUserSize?(this.usrSize=[this.W(),this.H()],this.size=[Math.abs(this.usrSize[0]*this.board.unitX),Math.abs(this.usrSize[1]*this.board.unitY)]):this.rendNode.hasChildNodes()&&(t=this.rendNode.childNodes[0].getBoundingClientRect(),this.size=[t.width,t.height]),this},updateSpan:function(){var t,e,i=this.transformations.length,r=[];if(0===i)this.span=[[this.Z(),this.X(),this.Y()],[this.Z(),this.W(),0],[this.Z(),0,this.H()]];else{for(r[0]=[this.Z(),this.X(),this.Y()],r[1]=[this.Z(),this.X()+this.W(),this.Y()],r[2]=[this.Z(),this.X(),this.Y()+this.H()],t=0;t<i;t++)for(e=0;e<3;e++)r[e]=math.A.matVecMult(this.transformations[t].matrix,r[e]);for(e=0;e<3;e++)r[e][1]/=r[e][0],r[e][2]/=r[e][0],r[e][0]/=r[e][0];for(e=1;e<3;e++)r[e][0]-=r[0][0],r[e][1]-=r[0][1],r[e][2]-=r[0][2];this.span=r}return this},addTransform:function(t){var e;if(utils_type.A.isArray(t))for(e=0;e<t.length;e++)this.transformations.push(t[e]);else this.transformations.push(t);return this},getParents:function(){var t=[this.url,[this.Z(),this.X(),this.Y()],this.usrSize];return 0!==this.parents.length&&(t=this.parents),t},setSize:function(t,e){return this.W=utils_type.A.createFunction(t,this.board,""),this.H=utils_type.A.createFunction(e,this.board,""),this._useUserSize=!0,this.addParentsFromJCFunctions([this.W,this.H]),this},W:function(){},H:function(){}}),jxg.A.createForeignObject=function(t,e,i){var r,n,s=e[0],o=e[1],a=[];if(e.length>=2&&(a=e[2]),r=utils_type.A.copyAttributes(i,t.options,"foreignobject"),!(n=coordselement.A.create(jxg.A.ForeignObject,t,o,r,s,a)))throw new Error("JSXGraph: Can't create foreignObject with parent types '"+typeof e[0]+"' and '"+typeof e[1]+"'.\nPossible parent types: [string, [x, y], [w, h]], [string, [x, y]], [element,transformation]");return n},jxg.A.registerElement("foreignobject",jxg.A.createForeignObject),jxg.A.registerElement("fo",jxg.A.createForeignObject);const foreignobject=jxg.A.ForeignObject;jxg.A.extend(src_options.A,{axes3d:{axesPosition:"center",xAxis:{visible:!0,point2:{name:"x"},strokeColor:jxg.A.palette.red},yAxis:{visible:!0,point2:{name:"y"},strokeColor:jxg.A.palette.green},zAxis:{visible:!0,point2:{name:"z"},strokeColor:jxg.A.palette.blue},xAxisBorder:{name:"x",visible:"nherit",withLabel:!1,label:{position:"50% left",offset:[30,0],fontsize:15},strokeWidth:1,lastArrow:!1,ticks3d:{visible:"nherit",label:{anchorX:"middle",anchorY:"middle"}}},yAxisBorder:{name:"y",visible:"nherit",withLabel:!1,label:{position:"50% right",offset:[0,-30],fontsize:15},strokeWidth:1,lastArrow:!1,ticks3d:{visible:"nherit",label:{anchorX:"middle"}}},zAxisBorder:{name:"z",visible:"nherit",withLabel:!1,label:{position:"50% right",offset:[30,0],fontsize:15},strokeWidth:1,lastArrow:!1,ticks3d:{visible:"nherit",label:{anchorX:"middle",anchorY:"middle"}}},xPlaneRear:{visible:!0,layer:0,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",mesh3d:{layer:1}},yPlaneRear:{visible:!0,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},zPlaneRear:{visible:!0,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},xPlaneFront:{visible:!1,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},yPlaneFront:{visible:!1,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},zPlaneFront:{visible:!1,strokeWidth:1,strokeColor:"#dddddd",fillColor:"#dddddd",layer:0,mesh3d:{layer:1}},xPlaneRearYAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},xPlaneRearZAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},xPlaneFrontYAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},xPlaneFrontZAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},yPlaneRearXAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},yPlaneRearZAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},yPlaneFrontXAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},yPlaneFrontZAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},zPlaneRearXAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},zPlaneRearYAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},zPlaneFrontXAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1},zPlaneFrontYAxis:{visible:"inherit",strokeColor:"#888888",strokeWidth:1}},axis3d:{highlight:!1,fixed:!0,strokeColor:"black",strokeWidth:1,tabindex:null,point1:{visible:!1,name:"",withLabel:!1},point2:{visible:!1,name:"",withLabel:!1,label:{visible:!0}}},circle3d:{layer:12,point:{visible:!1,name:""},needsRegularUpdate:!0},curve3d:{layer:12,highlight:!1,tabindex:-1,strokeWidth:1,numberPointsHigh:200,needsRegularUpdate:!0},face3d:{transitionProperties:[],layer:12,highlight:!1,tabindex:null,strokeWidth:1,fillColor:jxg.A.palette.yellow,fillOpacity:.4,needsRegularUpdate:!0,shader:{enabled:!1,type:"angle",hue:60,saturation:90,minLightness:30,maxLightness:90}},intersectionline3d:{point1:{visible:!1,name:""},point2:{visible:!1,name:""}},line3d:{layer:12,strokeWidth:1,strokeColor:"black",fixed:!0,tabindex:null,gradient:"linear",gradientSecondColor:"#ffffff",needsRegularUpdate:!0,point:{visible:!1,name:""},point1:{visible:!1,name:""},point2:{visible:!1,name:""},straightFirst:!1,straightLast:!1},mesh3d:{layer:12,strokeWidth:1,strokeColor:"#9a9a9a",strokeOpacity:.6,highlight:!1,tabindex:null,needsRegularUpdate:!0,stepWidthU:1,stepWidthV:1},plane3d:{layer:12,strokeWidth:0,strokeColor:"black",strokeOpacity:1,highlight:!1,tabindex:null,needsRegularUpdate:!0,visible:!0,gradient:"linear",gradientSecondColor:"#ffffff",gradientAngle:Math.PI,fillColor:"#a7a7a7",fillOpacity:.6,mesh3d:{visible:"inherit"},threePoints:!1,point:{visible:!1,name:"",fixed:!0},point1:{visible:!1,name:""},point2:{visible:!1,name:""},point3:{visible:!1,name:""}},point3d:{layer:13,infoboxDigits:"auto",strokeWidth:0,gradient:"radial",gradientSecondColor:"#555555",fillColor:"yellow",highlightStrokeColor:"#555555",gradientFX:.7,gradientFY:.3,needsRegularUpdate:!0},polygon3d:{layer:12,highlight:!1,tabindex:-1,strokeWidth:1,fillColor:"none",needsRegularUpdate:!0},polyhedron3d:{fillColorArray:["white","black"],needsRegularUpdate:!0},sphere3d:{layer:12,highlight:!1,strokeWidth:1,strokeColor:"#00ff80",fillColor:"white",gradient:"radial",gradientSecondColor:"#00ff80",gradientFX:.7,gradientFY:.3,fillOpacity:.4,needsRegularUpdate:!0},surface3d:{layer:12,highlight:!1,tabindex:-1,strokeWidth:1,stepsU:30,stepsV:30,needsRegularUpdate:!0},text3d:{withLabel:!1,needsRegularUpdate:!0},ticks3d:{visible:!0,ticksDistance:1,majorHeight:10,minorTicks:0,tickEndings:[0,1],drawLabels:!0,needsRegularUpdate:!0,label:{visible:!0,withLabel:!1}},vectorfield3d:{scale:1,arrowhead:{enabled:!0,size:5,angle:.125*Math.PI},needsRegularUpdate:!0},view3d:{needsRegularUpdate:!0,depthOrder:{enabled:!1,layers:[12,13]},projection:"parallel",verticalDrag:{enabled:!0,key:"shift"},az:{pointer:{enabled:!0,speed:1,outside:!0,button:-1,key:"none"},keyboard:{enabled:!0,step:10,key:"ctrl"},continuous:!0,slider:{visible:"inherit",style:6,point1:{pos:"auto",frozen:!1},point2:{pos:"auto",frozen:!1},min:0,max:2*Math.PI,start:1}},el:{pointer:{enabled:!0,speed:1,outside:!0,button:-1,key:"none"},keyboard:{enabled:!0,step:10,key:"ctrl"},continuous:!0,slider:{visible:"inherit",style:6,point1:{frozen:!1,pos:"auto"},point2:{frozen:!1,pos:"auto"},min:0,max:2*Math.PI,start:.3}},bank:{pointer:{enabled:!0,speed:.08,outside:!0,button:-1,key:"none"},keyboard:{enabled:!0,step:10,key:"ctrl"},continuous:!0,slider:{visible:"inherit",style:6,point1:{frozen:!1,pos:"auto"},point2:{frozen:!1,pos:"auto"},min:-Math.PI,max:Math.PI,start:0}},trackball:{enabled:!1,outside:!0,button:-1,key:"none"},r:"auto",fov:.4*Math.PI,values:[[0,1.57],[.78,.62],[0,0],[5.49,.62],[4.71,0],[3.93,.62],[3.14,0],[2.36,.62],[1.57,1.57]],infobox:{strokeColor:"#000000",fontSize:16,useKatex:!1,useMathjax:!1,intl:{enabled:!0,options:{minimumFractionDigits:2,maximumFractionDigits:3}}},_currentView:-1}});const options3d=jxg.A.Options;jxg.A.View3D=function(t,e,i){this.constructor(t,i,constants.A.OBJECT_TYPE_VIEW3D,constants.A.OBJECT_CLASS_3D),this.objects={},this.depthOrdered={},this.elementsByName={},this.defaultAxes=null,this.angles={az:null,el:null,bank:null},this.matrix3DRot=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.matrix3DRotShift=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.matrix3D=[[1,0,0,0],[0,1,0,0],[0,0,1,0]],this.boxToCam=[],this.llftCorner=e[0],this.size=e[1],this.bbox3D=e[2],this.r=-1,this.focalDist=-1,this.projectionType="parallel",this.trackballEnabled=!1,this.timeoutAzimuth=null,this.zIndexMin=1/0,this.zIndexMax=-1/0,this.id=this.board.setId(this,"V"),this.board.finalizeAdding(this),this.elType="view3d",this.methodMap=utils_type.A.deepCopy(this.methodMap,{})},jxg.A.View3D.prototype=new base_element.A,jxg.A.extend(jxg.A.View3D.prototype,{create:function(t,e,i){var r=[];return t.indexOf("3d")>0&&r.push(this),this.board.create(t,r.concat(e),i)},select:function(t,e){var i,r,n,s,o=t;if(null===o)return o;if(utils_type.A.isString(o)&&""!==o)utils_type.A.exists(this.objects[o])?o=this.objects[o]:utils_type.A.exists(this.elementsByName[o])&&(o=this.elementsByName[o]);else if(!e&&(utils_type.A.isFunction(o)||utils_type.A.isObject(o)&&!utils_type.A.isFunction(o.setAttribute))){for(r={},s=(i=utils_type.A.filterElements(this.objectsList,o)).length,n=0;n<s;n++)r[i[n].id]=i[n];o=new composition(r)}else utils_type.A.isObject(o)&&utils_type.A.exists(o.id)&&!utils_type.A.exists(this.objects[o.id])&&(o=null);return o},setAnglesFromRotation:function(){var t,e,i,r,n,s,o,a=this.matrix3DRot;(t=Math.sqrt(a[1][3]*a[1][3]+a[2][3]*a[2][3]))>math.A.eps?(e=a[2][3]/t,i=a[1][3]/t):(e=Math.cos(this.angles.bank),i=Math.sin(this.angles.bank)),a=math.A.matMatMult([[1,0,0,0],[0,e,-i,0],[0,i,e,0],[0,0,0,1]],a),this.angles.bank=Math.atan2(i,e),r=a[2][3],n=a[3][3],a=math.A.matMatMult([[1,0,0,0],[0,1,0,0],[0,0,r,n],[0,0,-n,r]],a),this.angles.el=Math.atan2(n,r),s=-a[1][1],o=a[3][1],this.angles.az=Math.atan2(o,s),this.angles.az<0&&(this.angles.az+=2*Math.PI),this.setSlidersFromAngles()},anglesHaveMoved:function(){return this._hasMoveAz||this._hasMoveEl||Math.abs(this.angles.az-this.az_slide.Value())>math.A.eps||Math.abs(this.angles.el-this.el_slide.Value())>math.A.eps||Math.abs(this.angles.bank-this.bank_slide.Value())>math.A.eps},getAnglesFromSliders:function(){this.angles.az=this.az_slide.Value(),this.angles.el=this.el_slide.Value(),this.angles.bank=this.bank_slide.Value()},setSlidersFromAngles:function(){this.az_slide.setValue(this.angles.az),this.el_slide.setValue(this.angles.el),this.bank_slide.setValue(this.angles.bank)},getRotationFromAngles:function(){var t,e,i,r,n,s,o=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];return t=this.angles.az,e=this.angles.el,i=this.angles.bank,r=-Math.sin(e),o[1][1]=-Math.cos(t),o[1][2]=Math.sin(t),o[1][3]=0,o[2][1]=r*Math.sin(t),o[2][2]=r*Math.cos(t),o[2][3]=Math.cos(e),o[3][1]=Math.cos(e)*Math.sin(t),o[3][2]=Math.cos(e)*Math.cos(t),o[3][3]=Math.sin(e),n=Math.cos(i),s=Math.sin(i),math.A.matMatMult([[1,0,0,0],[0,n,s,0],[0,-s,n,0],[0,0,0,1]],o)},_projectToSphere:function(t,e,i){var r,n=math.A.hypot(e,i);return n<.7071067811865475*t?Math.sqrt(t*t-n*n):(r=t/1.414213562373095)*r/n},updateProjectionTrackball:function(t){var e,i,r,n,s,o,a,l,c,h,u,d,p=100,f=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];return utils_type.A.exists(this._trackball)?((e=this._trackball.dx)*e+(i=this._trackball.dy)*i>math.A.eps&&(p=.25*(this.size[0]*this.board.unitX+this.size[1]*this.board.unitY),n=[s=this._trackball.x,o=this._trackball.y,this._projectToSphere(p,s,o)],r=[s-=e,o-=i,this._projectToSphere(p,s,o)],d=math.A.crossProduct(r,n),c=math.A.hypot(d[0],d[1],d[2]),d[0]/=c,d[1]/=c,d[2]/=c,l=(l=(l=geometry.A.distance(n,r,3)/(2*p))>1?1:l)<-1?-1:l,a=2*Math.asin(l),l=1-(h=Math.cos(a)),u=Math.sin(a),f[1][1]=h+d[0]*d[0]*l,f[2][1]=d[1]*d[0]*l+d[2]*u,f[3][1]=d[2]*d[0]*l-d[1]*u,f[1][2]=d[0]*d[1]*l-d[2]*u,f[2][2]=h+d[1]*d[1]*l,f[3][2]=d[2]*d[1]*l+d[0]*u,f[1][3]=d[0]*d[2]*l+d[1]*u,f[2][3]=d[1]*d[2]*l-d[0]*u,f[3][3]=h+d[2]*d[2]*l),f=math.A.matMatMult(f,this.matrix3DRot)):this.matrix3DRot},updateAngleSliderBounds:function(){var t,e,i,r,n,s,o,a,l,c,h;this.trackballEnabled=this.evalVisProp("trackball.enabled"),this.trackballEnabled?(this.az_slide.setMin(0),this.az_slide.setMax(2*Math.PI),this.el_slide.setMin(-.5*Math.PI),this.el_slide.setMax(.5*Math.PI),this.bank_slide.setMin(-Math.PI),this.bank_slide.setMax(Math.PI)):(this.az_slide.setMin(this.visProp.az.slider.min),this.az_slide.setMax(this.visProp.az.slider.max),this.el_slide.setMin(this.visProp.el.slider.min),this.el_slide.setMax(this.visProp.el.slider.max),this.bank_slide.setMin(this.visProp.bank.slider.min),this.bank_slide.setMax(this.visProp.bank.slider.max)),t=this.az_slide._smax,e=this.az_slide._smin,i=this.el_slide._smax,r=this.el_slide._smin,c=this.bank_slide._smax,h=this.bank_slide._smin,this.trackballEnabled?(n=math.A.mod(this.angles.el,2*Math.PI),.5*Math.PI<n&&n<1.5*Math.PI&&(this.angles.el=Math.PI-n,this.angles.az=math.A.wrap(this.angles.az+Math.PI,e,t),this.angles.bank=math.A.wrap(this.angles.bank+Math.PI,h,c)),this.angles.az=math.A.wrap(this.angles.az,e,t),this.angles.el=math.A.wrap(this.angles.el,r,i),this.angles.bank=math.A.wrap(this.angles.bank,h,c)):(l=function(t){return t<r?r-t:i<t?t-i:0},s=.5*(r+i),o=math.A.wrap(this.angles.el,s-Math.PI,s+Math.PI),a=math.A.wrap(Math.PI-this.angles.el,s-Math.PI,s+Math.PI),l(o)<=l(a)?this.angles.el=math.A.clamp(o,r,i):(this.angles.el=math.A.clamp(a,r,i),this.angles.az=math.A.wrap(this.angles.az+Math.PI,e,t),this.angles.bank=math.A.wrap(this.angles.bank+Math.PI,h,c)),this.angles.az=math.A.wrapAndClamp(this.angles.az,e,t,2*Math.PI),this.angles.bank=math.A.wrapAndClamp(this.angles.bank,h,c,2*Math.PI),this.matrix3DRot=this.getRotationFromAngles()),this.setSlidersFromAngles()},_updateCentralProjection:function(){var t,e;return"auto"===(t=this.evalVisProp("r"))&&(t=1.01*math.A.hypot(this.bbox3D[0][0]-this.bbox3D[0][1],this.bbox3D[1][0]-this.bbox3D[1][1],this.bbox3D[2][0]-this.bbox3D[2][1])),this.boxToCam=this.matrix3DRot.map((function(t){return t.slice()})),this.boxToCam[3][0]=-t,this.focalDist=1/Math.tan(.5*this.evalVisProp("fov")),e=[[0,0,0,-1],[0,this.focalDist,0,0],[0,0,this.focalDist,0],[320/-12,0,0,28/-12]],math.A.matMatMult(e,this.boxToCam)},update:function(){var t,e,i,r,n,s=this.r,o=[[1,0,0,0],[0,-s,0,0],[0,0,-s,0],[0,0,0,1]];return utils_type.A.exists(this.el_slide)&&utils_type.A.exists(this.az_slide)&&utils_type.A.exists(this.bank_slide)&&this.needsUpdate?(t=[[1,0,0],[0,1,0],[0,0,1]],this.projectionType=this.evalVisProp("projection").toLowerCase(),this.trackballEnabled!==this.evalVisProp("trackball.enabled")&&this.updateAngleSliderBounds(),this._hasMoveTrackball?(this.matrix3DRot=this.updateProjectionTrackball(),this.setAnglesFromRotation()):this.anglesHaveMoved()&&(this.getAnglesFromSliders(),this.matrix3DRot=this.getRotationFromAngles()),this.shift=[[1,0,0,0],[-.5*(this.bbox3D[0][0]+this.bbox3D[0][1]),1,0,0],[-.5*(this.bbox3D[1][0]+this.bbox3D[1][1]),0,1,0],[-.5*(this.bbox3D[2][0]+this.bbox3D[2][1]),0,0,1]],"central"===this.projectionType?(i=.8,t[1][1]=this.size[0]/i,t[2][2]=this.size[1]/i,t[1][0]=this.llftCorner[0]+.5*t[1][1]*i,t[2][0]=this.llftCorner[1]+.5*t[2][2]*i,this.viewPortTransform=t,e=this._updateCentralProjection(),this.matrix3D=math.A.matMatMult(e,this.shift)):(r=this.bbox3D[0][1]-this.bbox3D[0][0],n=this.bbox3D[1][1]-this.bbox3D[1][0],t[1][1]=this.size[0]/r,t[2][2]=this.size[1]/n,t[1][0]=this.llftCorner[0]+.5*t[1][1]*r,t[2][0]=this.llftCorner[1]+.5*t[2][2]*n,this.matrix3D=math.A.matMatMult(t,math.A.matMatMult(math.A.matMatMult(this.matrix3DRot,o),this.shift).slice(0,3))),this.matrix3DRotShift=math.A.matMatMult(this.matrix3DRot,this.shift),this):(this.needsUpdate=!1,this)},compareDepth:function(t,e){return t.zIndex-e.zIndex},updateZIndices:function(){var t,e;for(t in this.objects)this.objects.hasOwnProperty(t)&&((e=this.objects[t]).type===constants.A.OBJECT_TYPE_LINE3D||e.type===constants.A.OBJECT_TYPE_POLYGON3D)&&utils_type.A.exists(e.element2D)&&e.element2D.evalVisProp("visible")&&e.updateZIndex()},updateShaders:function(){var t,e,i;for(t in this.objects)this.objects.hasOwnProperty(t)&&(e=this.objects[t],utils_type.A.exists(e.shader)&&((i=e.shader())<this.zIndexMin?this.zIndexMin=i:i>this.zIndexMax&&(this.zIndexMax=i)))},updateDepthOrdering:function(){var t,e,i,r,n;for(r=this.evalVisProp("depthorder.layers"),i=0;i<r.length;i++)this.depthOrdered[r[i]]=[];for(t in this.objects)this.objects.hasOwnProperty(t)&&((e=this.objects[t]).type===constants.A.OBJECT_TYPE_FACE3D||e.type===constants.A.OBJECT_TYPE_LINE3D||e.type===constants.A.OBJECT_TYPE_POINT3D||e.type===constants.A.OBJECT_TYPE_POLYGON3D)&&utils_type.A.exists(e.element2D)&&e.element2D.evalVisProp("visible")&&(n=e.element2D.evalVisProp("layer"),r.indexOf(n)>=0&&this.depthOrdered[n].push(e));if(this.board.renderer&&"svg"===this.board.renderer.type)for(i=0;i<r.length;i++)n=r[i],this.depthOrdered[n].sort(this.compareDepth.bind(this)),this.depthOrdered[n].forEach((t=>this.board.renderer.setLayer(t.element2D,n)));return this},updateRenderer:function(){return this.needsUpdate?(this.depthOrdered={},void 0!==this.shift&&this.evalVisProp("depthorder.enabled")&&(this.updateZIndices(),this.updateShaders(),this.board.renderer&&"svg"===this.board.renderer.type&&this.updateDepthOrdering()),this.needsUpdate=!1,this):this},removeObject:function(t,e){var i,r;if(utils_type.A.isArray(t)){for(i=0;i<t.length;i++)this.removeObject(t[i]);return this}if(t=this.select(t),!utils_type.A.exists(t)||utils_type.A.isString(t))return this;try{for(r in t.childElements)t.childElements.hasOwnProperty(r)&&this.removeObject(t.childElements[r]);delete this.objects[t.id]}catch(e){jxg.A.debug("View3D "+t.id+": Could not be removed: "+e)}return this.board.removeObject(t,e),this},worldToFocal:function(t,e=!0){var i,r=math.A.matVecMult(this.boxToCam,math.A.matVecMult(this.shift,t));if(r[3]-=r[0]*this.focalDist,e)return r;for(i=1;i<4;i++)r[i]/=r[0];return r.slice(1,4)},project3DTo2D:function(t,e,i){var r,n;return 3===arguments.length?r=[1,t,e,i]:3===t.length?(r=t.slice()).unshift(1):r=t,n=math.A.matVecMult(this.matrix3D,r),"central"===this.projectionType?(n[1]/=n[0],n[2]/=n[0],n[3]/=n[0],n[0]/=n[0],math.A.matVecMult(this.viewPortTransform,n.slice(0,3))):n},_getW0:function(t,e,i){var r,n=math.A.inverse(t),s=n[0][0]+e[1]*n[0][1]+e[2]*n[0][2],o=n[3][0]+e[1]*n[3][1]+e[2]*n[3][2];return r=i*n[0][3]-n[3][3],[1/((o*n[0][3]-s*n[3][3])/r),(o-s*i)/r]},project2DTo3DPlane:function(t,e,i){var r,n,s,o,a,l,c,h,u=i.slice(1)||[0,0,0],d=e.slice(1);if(o=math.A.norm(d,3),s=math.A.innerProduct(u,d,3)/o,"parallel"===this.projectionType){(r=this.matrix3D.slice(0,3)).push([0,d[0],d[1],d[2]]),(n=t.coords.usrCoords.slice()).push(s);try{1===r[2][3]&&(r[2][1]=r[2][2]=.001*math.A.eps),a=math.A.Numerics.Gauss(r,n)}catch(t){a=[0,NaN,NaN,NaN]}}else{r=this.matrix3D,n=t.coords.usrCoords.slice(),l=math.A.Numerics.Gauss(this.viewPortTransform,n),c=(h=this._getW0(r,l,s))[0],n=[l[0]*c,l[1]*c,l[2]*c,h[1]*c];try{1===r[2][3]&&(r[2][1]=r[2][2]=.001*math.A.eps),(a=math.A.Numerics.Gauss(r,n))[1]/=a[0],a[2]/=a[0],a[3]/=a[0],a[0]/=a[0]}catch(t){a=[0,NaN,NaN,NaN]}}return a},projectScreenToSegment:function(t,e,i){var r,n,s,o,a,l,c,h=this.project3DTo2D(e).slice(1,3),u=this.project3DTo2D(i).slice(1,3),d=[u[0]-h[0],u[1]-h[1]],p=math.A.innerProduct(d,d),f=[t[0]-h[0],t[1]-h[1]],m=math.A.innerProduct(f,d)/p;return"central"===this.projectionType?(r=[.5*(e[0]+i[0]),.5*(e[1]+i[1]),.5*(e[2]+i[2])],s=[(n=this.project3DTo2D(r).slice(1,3))[0]-h[0],n[1]-h[1]],a=(1-(o=math.A.innerProduct(s,d)/p))*m/((1-2*o)*m+o)):a=m,[1,(c=1-(l=Math.min(Math.max(a,0),1)))*e[0]+l*i[0],c*e[1]+l*i[1],c*e[2]+l*i[2]]},project2DTo3DVertical:function(t,e){var i=t.coords.usrCoords.slice(1,3),r=[e[1],e[2],this.bbox3D[2][0]],n=[e[1],e[2],this.bbox3D[2][1]];return this.projectScreenToSegment(i,r,n)},project3DToCube:function(t){var e=this.bbox3D,i=!1;return t[1]<e[0][0]&&(t[1]=e[0][0],i=!0),t[1]>e[0][1]&&(t[1]=e[0][1],i=!0),t[2]<e[1][0]&&(t[2]=e[1][0],i=!0),t[2]>e[1][1]&&(t[2]=e[1][1],i=!0),t[3]<=e[2][0]&&(t[3]=e[2][0],i=!0),t[3]>=e[2][1]&&(t[3]=e[2][1],i=!0),[t,i]},intersectionLineCube:function(t,e,i){var r,n,s,o,a;for(a=3===e.length?e:e.slice(1),r=i,n=0;n<3;n++)0!==a[n]&&(s=(this.bbox3D[n][0]-t[n+1])/a[n],o=(this.bbox3D[n][1]-t[n+1])/a[n],r=i<0?Math.max(r,Math.min(s,o)):Math.min(r,Math.max(s,o)));return r},isInCube:function(t,e){var i;if(4===t.length){if(0===t[0])return!1;i=t.slice(1)}return i[0]>this.bbox3D[0][0]-math.A.eps&&i[0]<this.bbox3D[0][1]+math.A.eps&&i[1]>this.bbox3D[1][0]-math.A.eps&&i[1]<this.bbox3D[1][1]+math.A.eps&&i[2]>this.bbox3D[2][0]-math.A.eps&&i[2]<this.bbox3D[2][1]+math.A.eps},intersectionPlanePlane:function(t,e,i){var r,n,s,o,a,l=[!1,!1];return i=i||e.d,(o=math.A.crossProduct(t.normal.slice(1),e.normal.slice(1))).unshift(0),r=math.A.Geometry.meet3Planes(t.normal,t.d,e.normal,i,o,0),a=math.A.Geometry.meetPlanePlane(t.vec1,t.vec2,e.vec1,e.vec2),s=this.intersectionLineCube(r,a,1/0),n=math.A.axpy(s,a,r),this.isInCube(n)&&(l[0]=n),s=this.intersectionLineCube(r,a,-1/0),n=math.A.axpy(s,a,r),this.isInCube(n)&&(l[1]=n),l},intersectionPlaneFace:function(t,e){var i,r,n,s,o,a,l,c,h,u,d,p,f,m,g,_,v=[],y=[],b=[];for((_=math.A.crossProduct(t.normal.slice(1),e.normal.slice(1))).unshift(0),n=geometry.A.meet3Planes(t.normal,t.d,e.normal,e.d,_,0),m=geometry.A.meetPlanePlane(t.vec1,t.vec2,e.vec1,e.vec2),c=e.polyhedron.faces[e.faceNumber],s=e.polyhedron.coords,h=c.length,i=1;i<=h;i++)o=s[c[i-1]],g=[0,(a=s[c[i%h]])[1]-o[1],a[2]-o[2],a[3]-o[3]],u=Math.random(),d=Math.random(),p=Math.random(),f=Math.random(),y=[[u*m[1]+d*m[3],u*-g[1]+d*-g[3]],[p*m[2]+f*m[3],p*-g[2]+f*-g[3]]],b=[u*(o[1]-n[1])+d*(o[3]-n[3]),p*(o[2]-n[2])+f*(o[3]-n[3])],(r=numerics.A.Gauss(y,b)[1])>-math.A.eps&&r<1+math.A.eps&&(l=[1,o[1]+r*g[1],o[2]+r*g[2],o[3]+r*g[3]],v.push(l));return v},intersectionPlanePolyhedron:function(t,e){var i,r,n,s,o,a,l=1e-12,c=[],h=[],u=[],d=[];for(i=0;i<e.numberFaces;i++)if(!(e.def.faces[i].length<3||(n=this.intersectionPlaneFace(t,e.faces[i])).length<2||4!==n[0].length||4!==n[1].length)){for(r=0;r<c.length&&!(geometry.A.distance(n[0],c[r][0],4)<l&&geometry.A.distance(n[1],c[r][1],4)<l||geometry.A.distance(n[0],c[r][1],4)<l&&geometry.A.distance(n[1],c[r][0],4)<l);r++);r===c.length&&c.push(n.slice())}if(0===c.length)return{X:h,Y:u,Z:d};o=0,i=0;do{for(4===(s=c[o][i]).length&&(h.push(s[1]),u.push(s[2]),d.push(s[3])),i=(i+1)%2,s=c[o][i],a=o,r=0;r<c.length;r++){if(r!==o&&geometry.A.distance(s,c[r][0])<l){o=r,i=0;break}if(r!==o&&geometry.A.distance(s,c[r][1])<l){o=r,i=1;break}}if(o===a){console.log("Error face3d intersection update: did not find next",o,i);break}}while(0!==o);return h.push(h[0]),u.push(u[0]),d.push(d[0]),{X:h,Y:u,Z:d}},getMesh:function(t,e,i){var r,n,s,o,a,l,c,h=[0,0,0],u=utils_type.A.evaluate(e[2]),d=utils_type.A.evaluate(i[2]),p=[],f=[];for(l=(utils_type.A.evaluate(e[1])-utils_type.A.evaluate(e[0]))/u,c=(utils_type.A.evaluate(i[1])-utils_type.A.evaluate(i[0]))/d,r=0;r<=u;r++){for(s=e[0]+l*r,n=0;n<=d;n++)o=i[0]+c*n,h=utils_type.A.isFunction(t)?t(s,o):[t[0](s,o),t[1](s,o),t[2](s,o)],a=this.project3DTo2D(h),p.push(a[1]),f.push(a[2]);p.push(NaN),f.push(NaN)}for(n=0;n<=d;n++){for(o=i[0]+c*n,r=0;r<=u;r++)s=e[0]+l*r,h=utils_type.A.isFunction(t)?t(s,o):[t[0](s,o),t[1](s,o),t[2](s,o)],a=this.project3DTo2D(h),p.push(a[1]),f.push(a[2]);p.push(NaN),f.push(NaN)}return[p,f]},animateAzimuth:function(){var t=this.az_slide._smin,e=this.az_slide._smax-t,i=this.az_slide.Value()+.1;this.az_slide.position=(i-t)/e,this.az_slide.position>1&&(this.az_slide.position=0),this.board._change3DView=!0,this.board.update(),this.board._change3DView=!1,this.timeoutAzimuth=setTimeout(function(){this.animateAzimuth()}.bind(this),200)},stopAzimuth:function(){clearTimeout(this.timeoutAzimuth),this.timeoutAzimuth=null},isVerticalDrag:function(){var t=this.board;return!!this.evalVisProp("verticaldrag.enabled")&&t["_"+this.evalVisProp("verticaldrag.key")+"Key"]},setView:function(t,e,i){return i=i||this.r,this.az_slide.setValue(t),this.el_slide.setValue(e),this.r=i,this.board.update(),this},nextView:function(){var t=this.evalVisProp("values"),e=this.visProp._currentview;return e=(e+1)%t.length,this.setCurrentView(e),this},previousView:function(){var t=this.evalVisProp("values"),e=this.visProp._currentview;return e=(e+t.length-1)%t.length,this.setCurrentView(e),this},setCurrentView:function(t){var e=this.evalVisProp("values");return(t<0||t>=e.length)&&(t=(t%e.length+e.length)%e.length),this.setView(e[t][0],e[t][1],e[t][2]),this.visProp._currentview=t,this},_azEventHandler:function(t){var e=this.az_slide._smax,i=this.az_slide._smin,r=(e-i)/this.board.canvasWidth*this.evalVisProp("az.pointer.speed"),n=t.movementX,s=this.az_slide.Value(),o=this.el_slide.Value();return this.board.mode===this.board.BOARD_MODE_DRAG||(this.evalVisProp("az.keyboard.enabled")&&("ArrowRight"===t.key?s+=this.evalVisProp("az.keyboard.step")*Math.PI/180:"ArrowLeft"===t.key&&(s-=this.evalVisProp("az.keyboard.step")*Math.PI/180)),this.evalVisProp("az.pointer.enabled")&&0!==n&&null==t.key&&(s+=n*r),this.evalVisProp("az.continuous")?s=math.A.wrap(s,i,e):s>0?s=Math.min(e,s):s<0&&(s=Math.max(i,s)),this.setView(s,o)),this},_elEventHandler:function(t){var e=this.el_slide._smax,i=this.el_slide._smin,r=(e-i)/this.board.canvasHeight*this.evalVisProp("el.pointer.speed"),n=t.movementY,s=this.az_slide.Value(),o=this.el_slide.Value();return this.board.mode===this.board.BOARD_MODE_DRAG||(this.evalVisProp("el.keyboard.enabled")&&("ArrowUp"===t.key?o-=this.evalVisProp("el.keyboard.step")*Math.PI/180:"ArrowDown"===t.key&&(o+=this.evalVisProp("el.keyboard.step")*Math.PI/180)),this.evalVisProp("el.pointer.enabled")&&0!==n&&null==t.key&&(o+=n*r),this.evalVisProp("el.continuous")&&!this.trackballEnabled?o=math.A.wrap(o,i,e):o>0?o=Math.min(e,o):o<0&&(o=Math.max(i,o)),this.setView(s,o)),this},_bankEventHandler:function(t){var e,i=this.bank_slide._smax,r=this.bank_slide._smin,n=t.deltaY,s=this.bank_slide.Value();return this.board.mode===this.board.BOARD_MODE_DRAG||(this.evalVisProp("bank.keyboard.enabled")&&(e=this.evalVisProp("bank.keyboard.step")*Math.PI/180,"."===t.key||"<"===t.key?s-=e:","!==t.key&&">"!==t.key||(s+=e)),this.evalVisProp("bank.pointer.enabled")&&0!==n&&null==t.key&&(s+=n*((i-r)/this.board.canvasHeight*this.evalVisProp("bank.pointer.speed")),t.preventDefault()),s=this.evalVisProp("bank.continuous")?math.A.wrap(s,r,i):math.A.clamp(s,r,i),this.bank_slide.setValue(s),this.board.update()),this},_trackballHandler:function(t){var e,i,r,n=this.board.getMousePosition(t);return r=new base_coords.A(constants.A.COORDS_BY_USER,[this.llftCorner[0]+.5*this.size[0],this.llftCorner[1]+.5*this.size[1]],this.board),e=n[0]-r.scrCoords[1],i=n[1]-r.scrCoords[2],this._trackball={dx:t.movementX,dy:-t.movementY,x:e,y:-i},this.board.update(),this},pointerDownHandler:function(t){var e,i,r;this._hasMoveAz=!1,this._hasMoveEl=!1,this._hasMoveBank=!1,this._hasMoveTrackball=!1,this.board.mode===this.board.BOARD_MODE_NONE&&(this.board._change3DView=!0,this.evalVisProp("trackball.enabled")?(e=this.evalVisProp("trackball.button"),i=this.evalVisProp("trackball.key"),-1!==e&&e!==t.button||!("none"===i||i.indexOf("shift")>-1&&t.shiftKey||i.indexOf("ctrl")>-1&&t.ctrlKey)||(r=this.evalVisProp("trackball.outside")?document:this.board.containerObj,env.A.addEvent(r,"pointermove",this._trackballHandler,this),this._hasMoveTrackball=!0)):(this.evalVisProp("az.pointer.enabled")&&(e=this.evalVisProp("az.pointer.button"),i=this.evalVisProp("az.pointer.key"),-1!==e&&e!==t.button||!("none"===i||i.indexOf("shift")>-1&&t.shiftKey||i.indexOf("ctrl")>-1&&t.ctrlKey)||(r=this.evalVisProp("az.pointer.outside")?document:this.board.containerObj,env.A.addEvent(r,"pointermove",this._azEventHandler,this),this._hasMoveAz=!0)),this.evalVisProp("el.pointer.enabled")&&(e=this.evalVisProp("el.pointer.button"),i=this.evalVisProp("el.pointer.key"),-1!==e&&e!==t.button||!("none"===i||i.indexOf("shift")>-1&&t.shiftKey||i.indexOf("ctrl")>-1&&t.ctrlKey)||(r=this.evalVisProp("el.pointer.outside")?document:this.board.containerObj,env.A.addEvent(r,"pointermove",this._elEventHandler,this),this._hasMoveEl=!0)),this.evalVisProp("bank.pointer.enabled")&&(e=this.evalVisProp("bank.pointer.button"),i=this.evalVisProp("bank.pointer.key"),-1!==e&&e!==t.button||!("none"===i||i.indexOf("shift")>-1&&t.shiftKey||i.indexOf("ctrl")>-1&&t.ctrlKey)||(r=this.evalVisProp("bank.pointer.outside")?document:this.board.containerObj,env.A.addEvent(r,"wheel",this._bankEventHandler,this,{passive:!1}),this._hasMoveBank=!0))),env.A.addEvent(document,"pointerup",this.pointerUpHandler,this))},pointerUpHandler:function(t){var e;this._hasMoveAz&&(e=this.evalVisProp("az.pointer.outside")?document:this.board.containerObj,env.A.removeEvent(e,"pointermove",this._azEventHandler,this),this._hasMoveAz=!1),this._hasMoveEl&&(e=this.evalVisProp("el.pointer.outside")?document:this.board.containerObj,env.A.removeEvent(e,"pointermove",this._elEventHandler,this),this._hasMoveEl=!1),this._hasMoveBank&&(e=this.evalVisProp("bank.pointer.outside")?document:this.board.containerObj,env.A.removeEvent(e,"wheel",this._bankEventHandler,this),this._hasMoveBank=!1),this._hasMoveTrackball&&(e=this.evalVisProp("trackball.outside")?document:this.board.containerObj,env.A.removeEvent(e,"pointermove",this._trackballHandler,this),this._hasMoveTrackball=!1),env.A.removeEvent(document,"pointerup",this.pointerUpHandler,this),this.board._change3DView=!1}}),jxg.A.createView3D=function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p,f,m=e[0],g=e[1];return n=utils_type.A.copyAttributes(i,t.options,"view3d"),(r=new jxg.A.View3D(t,e,n)).defaultAxes=r.create("axes3d",[],n),l=m[0],c=m[1],h=g[0],u=g[1],(s=utils_type.A.copyAttributes(n,t.options,"view3d","az","slider")).name="az",(o=utils_type.A.copyAttributes(n,t.options,"view3d","el","slider")).name="el",(a=utils_type.A.copyAttributes(n,t.options,"view3d","bank","slider")).name="bank",f=utils_type.A.evaluate(s.point1.pos),d=utils_type.A.isArray(f)?f:[l-1,c-2],f=utils_type.A.evaluate(s.point2.pos),p=utils_type.A.isArray(f)?f:[l+h+1,c-2],r.az_slide=t.create("slider",[d,p,[utils_type.A.evaluate(s.min),utils_type.A.evaluate(s.start),utils_type.A.evaluate(s.max)]],s),r.inherits.push(r.az_slide),r.az_slide.elType="view3d_slider",f=utils_type.A.evaluate(o.point1.pos),d=utils_type.A.isArray(f)?f:[l-1,c],f=utils_type.A.evaluate(o.point2.pos),p=utils_type.A.isArray(f)?f:[l-1,c+u],r.el_slide=t.create("slider",[d,p,[utils_type.A.evaluate(o.min),utils_type.A.evaluate(o.start),utils_type.A.evaluate(o.max)]],o),r.inherits.push(r.el_slide),r.el_slide.elType="view3d_slider",f=utils_type.A.evaluate(a.point1.pos),d=utils_type.A.isArray(f)?f:[l-1,c+u+2],f=utils_type.A.evaluate(a.point2.pos),p=utils_type.A.isArray(f)?f:[l+h+1,c+u+2],r.bank_slide=t.create("slider",[d,p,[utils_type.A.evaluate(a.min),utils_type.A.evaluate(a.start),utils_type.A.evaluate(a.max)]],a),r.inherits.push(r.bank_slide),r.bank_slide.elType="view3d_slider",r.board.infobox.visProp=utils_type.A.merge(r.board.infobox.visProp,n.infobox),r.board.highlightInfobox=function(t,e,i){var n,s,o,a,l,c,h="",u=i.board,d=null;for(this.mode===this.BOARD_MODE_DRAG&&(h=r.isVerticalDrag()?'<span style="color:black; font-size:200%"> &nbsp;</span>':'<span style="color:black; font-size:200%"> &nbsp;</span>'),s=0;s<i.parents.length&&!(d=u.objects[i.parents[s]]).is3D;s++);if(d&&utils_type.A.exists(d.element2D)){if(a=[1,0,0,d.coords[3]],r._w0=math.A.innerProduct(r.matrix3D[0],a,4),o=r.project2DTo3DPlane(d.element2D,[1,0,0,1],a),!r.isInCube(o))return void r.board.highlightCustomInfobox("",d);n=d.evalVisProp("infoboxdigits"),c=r.board.infobox,l="auto"===n?c.useLocale()?[h,"(",c.formatNumberLocale(d.X())," | ",c.formatNumberLocale(d.Y())," | ",c.formatNumberLocale(d.Z()),")"]:[h,"(",utils_type.A.autoDigits(d.X())," | ",utils_type.A.autoDigits(d.Y())," | ",utils_type.A.autoDigits(d.Z()),")"]:c.useLocale()?[h,"(",c.formatNumberLocale(d.X(),n)," | ",c.formatNumberLocale(d.Y(),n)," | ",c.formatNumberLocale(d.Z(),n),")"]:[h,"(",utils_type.A.toFixed(d.X(),n)," | ",utils_type.A.toFixed(d.Y(),n)," | ",utils_type.A.toFixed(d.Z(),n),")"],r.board.highlightCustomInfobox(l.join(""),d)}else r.board.highlightCustomInfobox("("+t+", "+e+")",i)},r.BOARD_MODE_NONE=0,env.A.addEvent(t.containerObj,"keydown",(function(t){var e,i=!1;!r.evalVisProp("el.keyboard.enabled")||"ArrowUp"!==t.key&&"ArrowDown"!==t.key||("none"===(e=r.evalVisProp("el.keyboard.key"))||e.indexOf("shift")>-1&&t.shiftKey||e.indexOf("ctrl")>-1&&t.ctrlKey)&&(r._elEventHandler(t),i=!0),!r.evalVisProp("az.keyboard.enabled")||"ArrowLeft"!==t.key&&"ArrowRight"!==t.key||("none"===(e=r.evalVisProp("az.keyboard.key"))||e.indexOf("shift")>-1&&t.shiftKey||e.indexOf("ctrl")>-1&&t.ctrlKey)&&(r._azEventHandler(t),i=!0),!r.evalVisProp("bank.keyboard.enabled")||","!==t.key&&"<"!==t.key&&"."!==t.key&&">"!==t.key||("none"===(e=r.evalVisProp("bank.keyboard.key"))||e.indexOf("shift")>-1&&t.shiftKey||e.indexOf("ctrl")>-1&&t.ctrlKey)&&(r._bankEventHandler(t),i=!0),"PageUp"===t.key?(r.nextView(),i=!0):"PageDown"===t.key&&(r.previousView(),i=!0),i&&t.preventDefault(),this.board._change3DView=!1}),r),env.A.addEvent(t.containerObj,"pointerdown",r.pointerDownHandler,r),r.getAnglesFromSliders(),r.matrix3DRot=r.getRotationFromAngles(),r.updateAngleSliderBounds(),r.board.update(),r},jxg.A.registerElement("view3d",jxg.A.createView3D);const view3d=jxg.A.View3D;jxg.A.GeometryElement3D=function(t,e){this.elType=e,this.view=t,this.id=this.view.board.setId(this,e),this.element2D=null,this.is3D=!0,this.zIndex=0,this.view.objects[this.id]=this,""!==this.name&&(this.view.elementsByName[this.name]=this)},jxg.A.extend(jxg.A.GeometryElement3D.prototype,{setAttr2D:function(t){var e=t;return e.name=this.name,e.element3d=this,e.id=null,e},setAttribute:function(t){var e,i,r,n,s,o={};for(e=0;e<arguments.length;e++)n=arguments[e],utils_type.A.isString(n)?(s=n.split(":"),o[utils_type.A.trim(s[0])]=utils_type.A.trim(s[1])):utils_type.A.isArray(n)?o[n[0]]=n[1]:jxg.A.extend(o,n);for(e in o)if(o.hasOwnProperty(e))switch(i=e.replace(/\s+/g,"").toLowerCase(),r=o[e],i){case"numberpointshigh":case"stepsu":case"stepsv":utils_type.A.exists(this.visProp[i])&&(!jxg.A.Validator[i]||jxg.A.Validator[i]&&jxg.A.Validator[i](r)||jxg.A.Validator[i]&&utils_type.A.isFunction(r)&&jxg.A.Validator[i](r()))&&(r=(!r.toLowerCase||"false"!==r.toLowerCase())&&r,this._set(i,r));break;default:utils_type.A.exists(this.element2D)&&this.element2D.setAttribute(o)}},getAttribute:function(t){var e;switch(t=t.toLowerCase()){case"numberpointshigh":case"stepsu":case"stepsv":e=this.visProp[t];break;default:utils_type.A.exists(this.element2D)&&(e=this.element2D.getAttribute(t))}return e},getAttributes:function(){var t,e,i={},r=["numberpointshigh","stepsu","stepsv"],n=r.length;for(utils_type.A.exists(this.element2D)&&(i=utils_type.A.merge(this.element2D.getAttributes())),t=0;t<n;t++)e=r[t],utils_type.A.exists(this.visProp[e])&&(i[e]=this.visProp[e]);return i},addTransformGeneric:function(t,e){var i,r=utils_type.A.isArray(e)?e:[e],n=r.length;for(0===this.transformations.length&&(this.baseElement=t),i=0;i<n;i++)this.transformations.push(r[i]);return this},setPosition2D:function(t){},projectCoords:function(t,e){},remove:function(){}});const element3d=jxg.A.GeometryElement3D;jxg.A.createAxes3D=function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p,f,m,g,_,v,y,b,A=e[0],x=["x","y","z"],C="Axis",E=["Rear","Front"],M=[0,0,0],S=[0,0,0],w={};if(utils_type.A.exists(A.bbox3D))for(r=0;r<x.length;r++)M[r]=A.bbox3D[r][0],S[r]=A.bbox3D[r][1];else for(r=0;r<x.length;r++)M[r]=e[1][r],S[r]=e[2][1];for(c=(l=utils_type.A.copyAttributes(i,t.options,"axes3d")).axesposition,r=0;r<x.length;r++)v=(h=x[r])+C,"center"===c?(d=[0,0,0],(p=[0,0,0])[r]=S[r],w[v]=A.create("axis3d",[d,p],l[v.toLowerCase()]),w[v].view=A):"border"===c&&(v+="Border",d=M.slice(),p=S.slice(),"z"===h?(d[1]=S[1],p[0]=M[0]):"x"===h?(d=[M[0],S[1],M[2]],p=[S[0],S[1],M[2]]):(d=[S[0],M[1],M[2]],p=[S[0],S[1],M[2]]),p[r]=S[r],w[v]=A.create("axis3d",[d,p],l[v.toLowerCase()]),w[v].view=A,(b=l[v.toLowerCase()].ticks3d).element3d=!0,u=S[r]-M[r],w[v+"Ticks"]="x"===h?A.create("ticks3d",[d,[1,0,0],u,[0,1,0]],b):"y"===h?A.create("ticks3d",[d,[0,1,0],u,[1,0,0]],b):A.create("ticks3d",[d,[0,0,1],u,[0,1,0]],b),w[v+"Ticks"].view=A);for("center"===c?(w.O=A.create("intersection",[w[x[0]+C],w[x[1]+C]],{name:"",visible:!1,withLabel:!1}),w.O.view=A):w.O=null,r=0;r<x.length;r++)for(o=(r+1)%3,a=(r+2)%3,h=x[r],n=0;n<E.length;n++)v=h+"Plane"+E[n],(d=[0,0,0])[r]=0===n?M[r]:S[r],m=[0,0,0],(f=[0,0,0])[o]=1,m[a]=1,g=[M[o],S[o]],_=[M[a],S[a]],l=utils_type.A.copyAttributes(i,t.options,"axes3d",v),w[v]=A.create("plane3d",[d,f,m,g,_],l),w[v].elType="axisplane3d";for(r=0;r<x.length;r++)for(h=x[r],n=0;n<E.length;n++)for(s=1;s<=2;s++)v=h+"Plane"+E[n]+x[o=(r+s)%3].toUpperCase()+"Axis",y=h+"Plane"+E[n],(d=[0,0,0])[r]=(p=[0,0,0])[r]=0===n?M[r]:S[r],d[o]=M[o],p[o]=S[o],l=utils_type.A.copyAttributes(i,t.options,"axes3d",v),w[v]=A.create("axis3d",[d,p],l),w[v].view=A,w[y].addChild(w[v]),w[y].element2D.inherits.push(w[v]);return w},jxg.A.registerElement("axes3d",jxg.A.createAxes3D),jxg.A.createAxis3D=function(t,e,i){var r,n,s,o,a,l,c=e[0],h=e[1],u=e[2];return(r=utils_type.A.copyAttributes(i.point1,t.options,"axis3d","point1")).element3d=!0,n=c.create("point",[(o=h[0],a=h[1],l=h[2],function(){return c.project3DTo2D(o,a,l)[1]}),function(t,e,i){return function(){return c.project3DTo2D(t,e,i)[2]}}(h[0],h[1],h[2])],r),(r=utils_type.A.copyAttributes(i.point2,t.options,"axis3d","point2")).element3d=!0,s=c.create("point",[function(t,e,i){return function(){return c.project3DTo2D(t,e,i)[1]}}(u[0],u[1],u[2]),function(t,e,i){return function(){return c.project3DTo2D(t,e,i)[2]}}(u[0],u[1],u[2])],r),(r=utils_type.A.copyAttributes(i,t.options,"axis3d")).element3d=!0,c.create("arrow",[n,s],r)},jxg.A.registerElement("axis3d",jxg.A.createAxis3D),jxg.A.createMesh3D=function(t,e,i){var r,n,s=e[0];return(r=utils_type.A.copyAttributes(i,t.options,"mesh3d")).element3d=!0,(n=s.create("curve",[[],[]],r)).point=e[1],n.direction1=e[2],n.direction2=e[3],n.range1=e[4],n.range2=e[5],n.updateDataArray=function(){var t,e,i,r,n=utils_type.A.evaluate(this.range1),o=utils_type.A.evaluate(this.range2),a=n[0],l=n[1],c=o[0],h=o[1],u=[0,0,0],d=[0,0,0],p=this.evalVisProp("stepwidthu"),f=this.evalVisProp("stepwidthv"),m=[0,0,0];if(this.dataX=[],this.dataY=[],utils_type.A.isFunction(this.point))m=this.point();else if(utils_type.A.isPoint3D(this.point))m=this.point.coords;else for(r=0;r<this.point.length;r++)m[r]=utils_type.A.evaluate(this.point[r]);if(utils_type.A.isFunction(this.direction1))u=utils_type.A.evaluate(this.direction1);else for(r=0;r<this.direction1.length;r++)u[r]=utils_type.A.evaluate(this.direction1[r]);if(utils_type.A.isFunction(this.direction2))d=utils_type.A.evaluate(this.direction2);else for(r=0;r<this.direction2.length;r++)d[r]=utils_type.A.evaluate(this.direction2[r]);for(4===m.length&&(m=m.slice(1)),4===u.length&&(u=u.slice(1)),4===d.length&&(d=d.slice(1)),t=jxg.A.Math.norm(u,3),e=jxg.A.Math.norm(d,3),r=0;r<3;r++)u[r]/=t,d[r]/=e;i=s.getMesh([function(t,e){return m[0]+t*u[0]+e*d[0]},function(t,e){return m[1]+t*u[1]+e*d[1]},function(t,e){return m[2]+t*u[2]+e*d[2]}],[Math.ceil(a),Math.floor(l),(Math.ceil(l)-Math.floor(a))/p],[Math.ceil(c),Math.floor(h),(Math.ceil(h)-Math.floor(c))/f]),this.dataX=i[0],this.dataY=i[1]},n},jxg.A.registerElement("mesh3d",jxg.A.createMesh3D),jxg.A.Circle3D=function(t,e,i,r,n){var s,o;this.constructor(t.board,n,constants.A.OBJECT_TYPE_CIRCLE3D,constants.A.OBJECT_CLASS_3D),this.constructor3D(t,"circle3d"),this.center=this.board.select(e),this.normalFunc=i,this.normal=[0,0,0,0],this.curve,this.frame1,this.frame2,utils_type.A.exists(this.center._is_new)?(this.addChild(this.center),delete this.center._is_new):this.center.addChild(this),this.updateRadius=utils_type.A.createFunction(r,this.board),this.addParentsFromJCFunctions([this.updateRadius]),this.updateNormal(),this.frame1=math.A.crossProduct(this.normal.slice(1),[1,0,0]),this.frame1.unshift(0),(s=math.A.crossProduct(this.normal.slice(1),[-.5,.8660254037844386,0])).unshift(0),math.A.norm(s)>math.A.norm(this.frame1)&&(this.frame1=s),this.frame2=math.A.crossProduct(this.normal.slice(1),this.frame1.slice(1)),this.frame2.unshift(0),this.normalizeFrame(),o=this,this.curve=t.create("curve3d",[function(t){var e=o.Radius(),i=Math.sin(t),r=Math.cos(t);return[o.center.coords[1]+e*(r*o.frame1[1]+i*o.frame2[1]),o.center.coords[2]+e*(r*o.frame1[2]+i*o.frame2[2]),o.center.coords[3]+e*(r*o.frame1[3]+i*o.frame2[3])]},[0,2*Math.PI]],n)},jxg.A.Circle3D.prototype=new jxg.A.GeometryElement,utils_type.A.copyPrototypeMethods(jxg.A.Circle3D,jxg.A.GeometryElement3D,"constructor3D"),jxg.A.extend(jxg.A.Circle3D.prototype,{update:function(){return this.needsUpdate&&(this.updateNormal().updateFrame(),this.curve.visProp.visible=!isNaN(this.Radius())),this},updateRenderer:function(){return this.needsUpdate=!1,this},setRadius:function(t){return this.updateRadius=utils_type.A.createFunction(t,this.board),this.addParentsFromJCFunctions([this.updateRadius]),this.board.update(),this},Radius:function(t){return utils_type.A.exists(t)?(this.setRadius(t),this.Radius()):Math.abs(this.updateRadius())},normalizeFrame:function(){var t,e=math.A.norm(this.frame1),i=math.A.norm(this.frame2);for(t=0;t<4;t++)this.frame1[t]/=e,this.frame2[t]/=i;return this},updateNormal:function(){var t,e;if(this.normal=utils_type.A.evaluate(this.normalFunc),e=math.A.norm(this.normal),Math.abs(e)>1e-12)for(t=0;t<4;t++)this.normal[t]/=e;return this},updateFrame:function(){return this.frame1=math.A.crossProduct(this.frame2.slice(1),this.normal.slice(1)),this.frame1.unshift(0),this.frame2=math.A.crossProduct(this.normal.slice(1),this.frame1.slice(1)),this.frame2.unshift(0),this.normalizeFrame(),this},projectCoords:function(t,e){return this.curve.projectCoords(t,e)}}),jxg.A.createCircle3D=function(t,e,i){var r,n=e[0],s=utils_type.A.copyAttributes(i,t.options,"circle3d"),o=utils_type.A.providePoints3D(n,[e[1]],i,"circle3d",["point"])[0],a=e[2],l=e[3];return(r=new jxg.A.Circle3D(n,o,a,l,s)).curve.addParents([r]),r.addChild(r.curve),r.update(),r},jxg.A.registerElement("circle3d",jxg.A.createCircle3D),jxg.A.createIntersectionCircle3D=function(t,e,i){var r,n,s,o=e[0],a=e[1],l=e[2],c=utils_type.A.copyAttributes(i,t.options,"intersectioncircle3d");s=geometry.A.intersectionFunction3D(o,a,l),n=o.create("point3d",s[0],{visible:!1}),r=o.create("circle3d",[n,s[1],s[2]],c);try{a.addChild(r),l.addChild(r)}catch(t){throw new Error("JSXGraph: Can't create 'intersection' with parent types '"+typeof e[1]+"' and '"+typeof e[2]+"'.")}return r.type=constants.A.OBJECT_TYPE_INTERSECTION_CIRCLE3D,r.elType="intersectioncircle3d",r.setParents([a.id,l.id]),r},jxg.A.registerElement("intersectioncircle3d",jxg.A.createIntersectionCircle3D),jxg.A.Point3D=function(t,e,i,r){this.constructor(t.board,r,constants.A.OBJECT_TYPE_POINT3D,constants.A.OBJECT_CLASS_3D),this.constructor3D(t,"point3d"),this.board.finalizeAdding(this),this.coords=[0,0,0,0],this.initialCoords=[0,0,0,0],this.F=e,this.slide=i,this.position=[],this._c2d=null,this.methodMap=utils_type.A.deepCopy(this.methodMap,{})},jxg.A.Point3D.prototype=new jxg.A.GeometryElement,utils_type.A.copyPrototypeMethods(jxg.A.Point3D,jxg.A.GeometryElement3D,"constructor3D"),jxg.A.extend(jxg.A.Point3D.prototype,{X:function(){return this.coords[1]},Y:function(){return this.coords[2]},Z:function(){return this.coords[3]},W:function(){return this.coords[0]},updateCoords:function(){var t,e=0;if(utils_type.A.isFunction(this.F))this.coords=utils_type.A.evaluate(this.F),3===this.coords.length&&this.coords.unshift(1);else for(3===this.F.length&&(this.coords[0]=1,e=1),t=0;t<this.F.length;t++)utils_type.A.isFunction(this.F[t])&&(this.coords[e+t]=utils_type.A.evaluate(this.F[t]));return this},initCoords:function(){var t,e=0;if(utils_type.A.isFunction(this.F))this.coords=utils_type.A.evaluate(this.F),3===this.coords.length&&this.coords.unshift(1);else for(3===this.F.length&&(this.coords[0]=1,e=1),t=0;t<this.F.length;t++)this.coords[e+t]=utils_type.A.evaluate(this.F[t]);return this.initialCoords=this.coords.slice(),this},normalizeCoords:function(){return Math.abs(this.coords[0])>1e-14&&(this.coords[1]/=this.coords[0],this.coords[2]/=this.coords[0],this.coords[3]/=this.coords[0],this.coords[0]=1),this},setPosition:function(t,e){var i=this.coords;return 3===t.length?(i[0]=1,i[1]=t[0],i[2]=t[1],i[3]=t[2]):(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[2],this.normalizeCoords()),this},addTransform:function(t,e){return this.addTransformGeneric(t,e),this},updateTransform:function(){var t,e;if(0===this.transformations.length||null===this.baseElement)return this;for(t=this===this.baseElement?this.initialCoords:this.baseElement.coords,e=0;e<this.transformations.length;e++)this.transformations[e].update(),t=math.A.matVecMult(this.transformations[e].matrix,t);return this.coords=t,this},update:function(t){var e,i,r;return this.element2D.draggable()&&0!==geometry.A.distance(this._c2d,this.element2D.coords.usrCoords)?(this.view.isVerticalDrag()?e=this.view.project2DTo3DVertical(this.element2D,this.coords):(i=[1,0,0,this.coords[3]],e=this.view.project2DTo3DPlane(this.element2D,[1,0,0,1],i)),0!==e[0]&&(r=this.view.project3DToCube(e),this.coords=r[0],r[1]&&this.element2D.coords.setCoordinates(constants.A.COORDS_BY_USER,this.view.project3DTo2D(this.coords)),this.slide&&(this.coords=this.slide.projectCoords([1,this.X(),this.Y(),this.Z()],this.position),this.element2D.coords.setCoordinates(constants.A.COORDS_BY_USER,this.view.project3DTo2D(this.coords))))):(this.updateCoords().updateTransform(),this.slide&&(this.coords=this.slide.projectCoords([1,this.X(),this.Y(),this.Z()],this.position)),e=this.coords,this.element2D.coords.setCoordinates(constants.A.COORDS_BY_USER,this.view.project3DTo2D(e)),this.zIndex=math.A.matVecMult(this.view.matrix3DRotShift,e)[3]),this._c2d=this.element2D.coords.usrCoords.slice(),this},updateRenderer:function(){return this.needsUpdate=!1,this},testIfFinite:function(){return Math.abs(this.coords[0])>1e-12},distance:function(t){var e=this.coords,i=t.coords;return e[0]*e[0]>1e-12&&i[0]*i[0]>1e-12?math.A.hypot(i[1]-e[1],i[2]-e[2],i[3]-e[3]):Number.POSITIVE_INFINITY},__evt__update3D:function(t){}}),jxg.A.createPoint3D=function(t,e,i){var r,n,s,o,a,l=e[0],c=null,h=null;if(s=e.length>2&&utils_type.A.exists(e[e.length-1].is3D)&&!utils_type.A.isTransformationOrArray(e[e.length-1])?e.pop():null,2===e.length)n=e[1];else if(3===e.length&&utils_type.A.isPoint3D(e[1])&&utils_type.A.isTransformationOrArray(e[2]))n=[0,0,0],c=e[1],h=e[2];else if(4===e.length)n=e.slice(1);else{if(5!==e.length)throw new Error("JSXGraph: Can't create point3d with parent types '"+typeof e[1]+"' and '"+typeof e[2]+"'.\nPossible parent types: [[x,y,z]], [x,y,z], or [[x,y,z], slide], () => [x, y, z], or [point, transformation(s)]");n=e.slice(1)}return r=utils_type.A.copyAttributes(i,t.options,"point3d"),(a=new jxg.A.Point3D(l,n,s,r)).initCoords(),null!==c&&null!==h&&a.addTransform(c,h),o=l.project3DTo2D(a.coords),r=a.setAttr2D(r),a.element2D=l.create("point",o,r),a.element2D.view=l,a.addChild(a.element2D),a.inherits.push(a.element2D),a.element2D.setParents(a),a.slide&&(a.slide.addChild(a),a.setParents(a.slide)),c&&a.setParents(c),a._c2d=a.element2D.coords.usrCoords.slice(),a},jxg.A.registerElement("point3d",jxg.A.createPoint3D),jxg.A.Curve3D=function(t,e,i,r,n,s,o){this.constructor(t.board,o,constants.A.OBJECT_TYPE_CURVE3D,constants.A.OBJECT_CLASS_3D),this.constructor3D(t,"curve3d"),this.board.finalizeAdding(this),this._F=e,this._X=i,this._Y=r,this._Z=n,this.points=[],this.numberPoints=0,this.dataX=null,this.dataY=null,this.dataZ=null,null!==this._F?(this._X=function(t){return this._F(t)[0]},this._Y=function(t){return this._F(t)[1]},this._Z=function(t){return this._F(t)[2]}):utils_type.A.isFunction(this._X)?this._F=function(t){return[this._X(t),this._Y(t),this._Z(t)]}:this._F=null,this.range=s,this.methodMap=utils_type.A.deepCopy(this.methodMap,{})},jxg.A.Curve3D.prototype=new jxg.A.GeometryElement,utils_type.A.copyPrototypeMethods(jxg.A.Curve3D,jxg.A.GeometryElement3D,"constructor3D"),jxg.A.extend(jxg.A.Curve3D.prototype,{updateCoords:function(){var t,e,i,r,n,s,o=this.evalVisProp("numberpointshigh"),a=[1,0,0,0];if(this.points=[],utils_type.A.exists(this.dataX))for(o=this.dataX.length,n=0;n<o;n++)this.points.push([1,this.dataX[n],this.dataY[n],this.dataZ[n]]);else if(utils_type.A.isArray(this._X))for(o=this._X.length,n=0;n<o;n++)this.points.push([1,this._X[n],this._Y[n],this._Z[n]]);else for(t=utils_type.A.evaluate(this.range),e=utils_type.A.evaluate(t[0]),r=((i=utils_type.A.evaluate(t[1]))-e)/(o-1),s=0,n=e;s<o&&n<=i;s++,n+=r)(a=this.F(n)).unshift(1),this.points.push(a);return this.numberPoints=this.points.length,this},evalF:function(t){var e,i,r=[0,0,0,0];if(0===this.transformations.length||!utils_type.A.exists(this.baseElement))return utils_type.A.exists(this._F)?this._F(t):[this._X[t],this._Y[t],this._Z[t]];for(e=this.transformations,i=0;i<e.length;i++)e[i].update();for(3===r.length&&r.unshift(1),(r=this===this.baseElement?utils_type.A.exists(this._F)?this._F(t):[this._X[t],this._Y[t],this._Z[t]]:this.baseElement.evalF(t)).unshift(1),r=math.A.matVecMult(e[0].matrix,r),i=1;i<e.length;i++)r=math.A.matVecMult(e[i].matrix,r);return r.slice(1)},F:function(t){return this.evalF(t)},X:function(t){return this.evalF(t)[0]},Y:function(t){return this.evalF(t)[1]},Z:function(t){return this.evalF(t)[2]},updateDataArray2D:function(){var t,e,i=[],r=[],n=this.points.length;for(t=0;t<n;t++)e=this.view.project3DTo2D(this.points[t]),i.push(e[1]),r.push(e[2]);return{X:i,Y:r}},addTransform:function(t,e){return this.addTransformGeneric(t,e),this},updateTransform:function(){var t,e,i,r,n;if(0===this.transformations.length||null===this.baseElement||utils_type.A.exists(this._F))return this;for(t=this.transformations,i=0;i<t.length;i++)t[i].update();for(n=this.baseElement.numberPoints,i=0;i<n;i++){for(e=this===this.baseElement?this.points[i]:this.baseElement.points[i],r=0;r<t.length;r++)e=math.A.matVecMult(t[r].matrix,e);this.points[i]=e}return this.numberPoints=n,this},updateDataArray:function(){},update:function(){return this.needsUpdate&&(this.updateDataArray(),this.updateCoords().updateTransform()),this},updateRenderer:function(){return this.needsUpdate=!1,this},projectCoords:function(t,e){return geometry.A.projectCoordsToParametric(t,this,1,e)}}),jxg.A.createCurve3D=function(t,e,i){var r,n,s,o,a,l,c,h,u=e[0],d=null,p=null;return 3===e.length?utils_type.A.isTransformationOrArray(e[2])&&e[1].type===constants.A.OBJECT_TYPE_CURVE3D?(d=e[1],p=e[2],r=null,n=[],s=[],o=[]):(r=e[1],a=e[2],n=null,s=null,o=null):2===e.length&&utils_type.A.isArray(e[1])?(n=(h=math.A.transpose(e[1]))[0],s=h[1],o=h[2],r=null):(n=e[1],s=e[2],o=e[3],a=e[4],r=null),l=utils_type.A.copyAttributes(i,t.options,"curve3d"),l=(c=new jxg.A.Curve3D(u,r,n,s,o,a,l)).setAttr2D(l),c.element2D=u.create("curve",[[],[]],l),c.element2D.view=u,null!==d&&(c.addTransform(d,p),c.addParents(d)),c.element2D.updateDataArray=function(){var t=c.updateDataArray2D();this.dataX=t.X,this.dataY=t.Y},c.addChild(c.element2D),c.inherits.push(c.element2D),c.element2D.setParents(c),c.element2D.prepareUpdate().update(),t.isSuspendedUpdate||c.element2D.updateVisibility().updateRenderer(),c},jxg.A.registerElement("curve3d",jxg.A.createCurve3D),jxg.A.createVectorfield3D=function(t,e,i){var r,n,s=e[0];if(!(e.length>=5&&(utils_type.A.isArray(e[1])||utils_type.A.isFunction(e[1])||utils_type.A.isString(e[1]))&&utils_type.A.isArray(e[2])&&3===e[1].length&&utils_type.A.isArray(e[3])&&3===e[2].length&&utils_type.A.isArray(e[4])&&3===e[3].length))throw new Error("JSXGraph: Can't create vector field 3D with parent types '"+typeof e[1]+"', '"+typeof e[2]+"', '"+typeof e[3]+"'.'"+typeof e[4]+"', ");return n=utils_type.A.copyAttributes(i,t.options,"vectorfield3d"),(r=s.create("curve3d",[[],[],[]],n)).setF=function(t,e){var i,n,s;return utils_type.A.isArray(t)?(i=utils_type.A.createFunction(t[0],this.board,e),n=utils_type.A.createFunction(t[1],this.board,e),s=utils_type.A.createFunction(t[2],this.board,e),this.F=function(t,e,r){return[i(t,e,r),n(t,e,r),s(t,e,r)]}):this.F=utils_type.A.createFunction(t,r.board,e),this},r.setF(e[1],"x, y, z"),r.xData=e[2],r.yData=e[3],r.zData=e[4],r.updateDataArray=function(){var e,i,r,n,s,o,a,l,c,h,u,d,p,f,m,g,_,v=this.evalVisProp("scale"),y=[utils_type.A.evaluate(this.xData[0]),utils_type.A.evaluate(this.yData[0]),utils_type.A.evaluate(this.zData[0])],b=[utils_type.A.evaluate(this.xData[1]),utils_type.A.evaluate(this.yData[1]),utils_type.A.evaluate(this.zData[1])],A=[utils_type.A.evaluate(this.xData[2]),utils_type.A.evaluate(this.yData[2]),utils_type.A.evaluate(this.zData[2])],x=[(A[0]-y[0])/b[0],(A[1]-y[1])/b[1],(A[2]-y[2])/b[2]],C=this.evalVisProp("arrowhead.enabled");for(C&&(p=this.evalVisProp("arrowhead.size"),_=this.evalVisProp("arrowhead.angle"),f=p/t.unitX,m=p/t.unitY,g=p/Math.sqrt(t.unitX*t.unitY)),this.dataX=[],this.dataY=[],this.dataZ=[],i=0,o=y[0];i<=b[0];o+=x[0],i++)for(r=0,a=y[1];r<=b[1];a+=x[1],r++)for(e=0,l=y[2];e<=b[2];l+=x[2],e++)n=this.F(o,a,l),(s=math.A.norm(n))<Number.EPSILON||(n[0]*=v,n[1]*=v,n[2]*=v,utils_type.A.concat(this.dataX,[o,o+n[0],NaN]),utils_type.A.concat(this.dataY,[a,a+n[1],NaN]),utils_type.A.concat(this.dataZ,[l,l+n[2],NaN]),C&&(s*=v,c=Math.atan2(n[1],n[0]),h=(d=Math.asin(n[2]/s))-_,u=d+_,utils_type.A.concat(this.dataX,[o+n[0]-f*Math.cos(c)*Math.cos(h),o+n[0],o+n[0]-f*Math.cos(c)*Math.cos(u),NaN]),utils_type.A.concat(this.dataY,[a+n[1]-m*Math.sin(c)*Math.cos(h),a+n[1],a+n[1]-m*Math.sin(c)*Math.cos(u),NaN]),utils_type.A.concat(this.dataZ,[l+n[2]-g*Math.sin(u),l+n[2],l+n[2]-g*Math.sin(h),NaN])))},r.methodMap=utils_type.A.deepCopy(r.methodMap,{setF:"setF"}),r},jxg.A.registerElement("vectorfield3D",jxg.A.createVectorfield3D),jxg.A.Line3D=function(t,e,i,r,n){this.constructor(t.board,n,constants.A.OBJECT_TYPE_LINE3D,constants.A.OBJECT_CLASS_3D),this.constructor3D(t,"line3d"),this.point=e,this.direction=i,this.vec=[0,0,0,0],this.range=r||[-1/0,1/0],this.point1=null,this.point2=null,this.board.finalizeAdding(this),this.methodMap=utils_type.A.deepCopy(this.methodMap,{})},jxg.A.Line3D.prototype=new jxg.A.GeometryElement,utils_type.A.copyPrototypeMethods(jxg.A.Line3D,jxg.A.GeometryElement3D,"constructor3D"),jxg.A.extend(jxg.A.Line3D.prototype,{updateCoords:function(){var t,e=0;if(utils_type.A.exists(this.direction.view)&&this.direction.type===constants.A.OBJECT_TYPE_LINE3D)this.vec=this.direction.vec.slice();else if(utils_type.A.isFunction(this.direction))this.vec=utils_type.A.evaluate(this.direction),3===this.vec.length&&this.vec.unshift(0);else for(3===this.direction.length&&(this.vec[0]=0,e=1),t=0;t<this.direction.length;t++)this.vec[e+t]=utils_type.A.evaluate(this.direction[t]);return this},getPointCoords:function(t){var e,i,r;return e=this.point.coords,i=this.vec,r=utils_type.A.evaluate(t),t=this.view.intersectionLineCube(e,i,r),[e[0]+i[0]*t,e[1]+i[1]*t,e[2]+i[2]*t,e[3]+i[3]*t]},addTransform:function(t,e){return this.point.addTransform(t.point,e),this.addTransformGeneric(t,e),this},updateTransform:function(){var t,e;if(0===this.transformations.length||null===this.baseElement)return this;for(t=this===this.baseElement?this.vec:this.baseElement.vec,e=0;e<this.transformations.length;e++)this.transformations[e].update(),t=math.A.matVecMult(this.transformations[e].matrix,t);return this.vec=t,this},update:function(){return this.needsUpdate&&this.updateCoords().updateTransform(),this},setPosition2D:function(t){var e,i;for(e=0;e<this.parents.length;e++)"point3d"===(i=this.view.select(this.parents[e])).elType&&i.element2D.draggable()&&t.applyOnce(i.element2D);this.endpoints[0].update(),this.endpoints[1].update()},updateRenderer:function(){return this.needsUpdate=!1,this},projectCoords:function(t,e){var i,r=this.getPointCoords(0),n=this.getPointCoords(1),s=[n[0]-r[0],n[1]-r[1],n[2]-r[2]],o=[t[0]-r[0],t[1]-r[1],t[2]-r[2]],a=math.A.innerProduct(o,s)/math.A.innerProduct(s,s),l=Math.min(Math.max(a,utils_type.A.evaluate(this.range[0])),utils_type.A.evaluate(this.range[1]));return i=this.getPointCoords(l).slice(),e[0]=l,i},updateZIndex:function(){var t=this.endpoints[0],e=this.endpoints[1],i=[1,t.X()+e.X(),t.Y()+e.Y(),t.Z()+e.Z()];return i[1]*=.5,i[2]*=.5,i[3]*=.5,this.zIndex=math.A.matVecMult(this.view.matrix3DRotShift,i)[3],this}}),jxg.A.createLine3D=function(t,e,i){var r,n,s,o,a,l,c,h,u,d=e[0],p=null,f=null;if(r=utils_type.A.copyAttributes(i,t.options,"line3d"),e[1].type===constants.A.OBJECT_TYPE_LINE3D&&utils_type.A.isTransformationOrArray(e[2])&&(p=e[1],f=e[2],n=utils_type.A.providePoints3D(d,[[0,0,0,0],[0,0,0,0]],i,"line3d",["point1","point2"])),null===p&&(utils_type.A.isPoint3D(e[2])||3===e.length&&(utils_type.A.isArray(e[2])||utils_type.A.isFunction(e[2]))))l=utils_type.A.providePoints3D(d,[e[1]],i,"line3d",["point1"])[0],c=utils_type.A.providePoints3D(d,[e[2]],i,"line3d",["point2"])[0],o=function(){return[0,c.X()-l.X(),c.Y()-l.Y(),c.Z()-l.Z()]},a=[0,1],(u=new jxg.A.Line3D(d,l,o,a,r)).prepareUpdate().update(),(h=utils_type.A.providePoints3D(d,[[1,0,0,0],[1,0,0,0]],{visible:!0},"line3d",["point1","point2"]))[0].F=function(){var t=0;return u.evalVisProp("straightfirst")&&(t=-1/0),u.getPointCoords(t)},h[1].F=function(){var t=1;return u.evalVisProp("straightlast")&&(t=1/0),u.getPointCoords(t)},h[0].prepareUpdate().update(),h[1].prepareUpdate().update(),(r=u.setAttr2D(r)).straightfirst=!1,r.straightlast=!1,u.element2D=d.create("segment",[h[0].element2D,h[1].element2D],r),u.element2D.view=d,u.endpoints=h,u.addChild(h[0]),u.addChild(h[1]),u.addParents([l,c]);else{if(null!==p)s=utils_type.A.providePoints3D(d,[[0,0,0]],i,"line3d",["point"])[0],o=[0,0,0,1e-4],a=e[3]||[-1/0,1/0];else{if(!(utils_type.A.exists(e[2].view)&&e[2].type===constants.A.OBJECT_TYPE_LINE3D||utils_type.A.isFunction(e[2])||3===e[2].length||4===e[2].length))throw new Error("JSXGraph: Can't create line3d with parents of type '"+typeof e[1]+", "+typeof e[2]+", "+typeof e[3]+"'.");s=utils_type.A.providePoints3D(d,[e[1]],i,"line3d",["point"])[0],o=e[2],a=e[3]}n=utils_type.A.providePoints3D(d,[[1,0,0,0],[1,0,0,0]],i,"line3d",["point1","point2"]),(u=new jxg.A.Line3D(d,s,o,a,r)).prepareUpdate().update(),n[0].F=function(){return u.getPointCoords(utils_type.A.evaluate(u.range[0]))},n[0].prepareUpdate().update(),l=n[0],n[1].F=function(){return u.getPointCoords(utils_type.A.evaluate(u.range[1]))},n[1].prepareUpdate().update(),c=n[1],(r=u.setAttr2D(r)).straightfirst=!1,r.straightlast=!1,u.element2D=d.create("segment",[l.element2D,c.element2D],r),u.element2D.view=d,u.endpoints=n,u.addParents(s),null!==p&&null!==f&&(u.addTransform(p,f),u.addParents(p))}return u.addChild(u.element2D),u.inherits.push(u.element2D),u.element2D.addParents(u),u.point1=l,u.point2=c,u.point1._is_new?(u.addChild(u.point1),delete u.point1._is_new):u.point1.addChild(u),u.point2._is_new?(u.addChild(u.point2),delete u.point2._is_new):u.point2.addChild(u),utils_type.A.exists(s)&&(s._is_new?(u.addChild(s),delete s._is_new):s.addChild(u)),u.update(),u.element2D.prepareUpdate().update().updateRenderer(),u},jxg.A.registerElement("line3d",jxg.A.createLine3D),jxg.A.Plane3D=function(t,e,i,r,n,s,o){this.constructor(t.board,o,constants.A.OBJECT_TYPE_PLANE3D,constants.A.OBJECT_CLASS_3D),this.constructor3D(t,"plane3d"),this.board.finalizeAdding(this),this.point=e,this.direction1=i,this.direction2=n,this.range_u=r||[-1/0,1/0],this.range_v=s||[-1/0,1/0],this.vec1=[0,0,0,0],this.vec2=[0,0,0,0],this.mesh3d=null,this.normal=[0,0,0,0],this.d=0,this.updateCoords(),this.updateNormal(),this.methodMap=utils_type.A.deepCopy(this.methodMap,{})},jxg.A.Plane3D.prototype=new jxg.A.GeometryElement,utils_type.A.copyPrototypeMethods(jxg.A.Plane3D,jxg.A.GeometryElement3D,"constructor3D"),jxg.A.extend(jxg.A.Plane3D.prototype,{F:function(t,e){var i,r,n,s,o;for(r=this.vec1.slice(),n=this.vec2.slice(),s=math.A.norm(r,3),o=math.A.norm(n,3),i=0;i<3;i++)r[i]/=s,n[i]/=o;return[this.point.X()+t*r[0]+e*n[0],this.point.Y()+t*r[1]+e*n[1],this.point.Z()+t*r[2]+e*n[2]]},X:function(t,e){return this.F(t,e)[0]},Y:function(t,e){return this.F(t,e)[1]},Z:function(t,e){return this.F(t,e)[2]},updateCoords:function(){var t,e;if(utils_type.A.exists(this.direction1.view)&&this.direction1.type===constants.A.OBJECT_TYPE_LINE3D)this.vec1=this.direction1.vec.slice();else if(utils_type.A.isFunction(this.direction1))this.vec1=utils_type.A.evaluate(this.direction1),3===this.vec1.length&&this.vec1.unshift(0);else for(e=0,3===this.direction1.length&&(this.vec1[0]=0,e=1),t=0;t<this.direction1.length;t++)this.vec1[e+t]=utils_type.A.evaluate(this.direction1[t]);if(utils_type.A.exists(this.direction2.view)&&this.direction2.type===constants.A.OBJECT_TYPE_LINE3D)this.vec2=this.direction2.vec.slice();else if(utils_type.A.isFunction(this.direction2))this.vec2=utils_type.A.evaluate(this.direction2),3===this.vec2.length&&this.vec2.unshift(0);else for(e=0,3===this.direction2.length&&(this.vec2[0]=0,e=1),t=0;t<this.direction2.length;t++)this.vec2[e+t]=utils_type.A.evaluate(this.direction2[t]);return this},updateNormal:function(){var t,e;if(this.needsUpdate,this.normal=math.A.crossProduct(this.vec1.slice(1),this.vec2.slice(1)),e=math.A.norm(this.normal),Math.abs(e)>math.A.eps*math.A.eps)for(t=0;t<3;t++)this.normal[t]/=e;return this.normal.unshift(0),this.d=math.A.innerProduct(this.point.coords,this.normal,4),this},updateDataArray:function(){var t,e,i,r,n,s,o,a,l,c,h,u,d,p,f=["xPlaneRear","yPlaneRear","zPlaneRear"],m=[],g=[0,0,0],_=[0,0,0],v=[0,0,0],y=[0,0,0],b=1e-12,A=this.view;if(this.dataX=[],this.dataY=[],this.updateNormal(),"axisplane3d"!==this.elType&&A.defaultAxes&&utils_type.A.evaluate(this.range_u[0])===-1/0&&utils_type.A.evaluate(this.range_u[1])===1/0&&utils_type.A.evaluate(this.range_v[0])===-1/0&&utils_type.A.evaluate(this.range_v[1])===1/0){for(c=0;c<f.length;c++){if(!1!==(y=A.intersectionPlanePlane(this,A.defaultAxes[f[c]]))[0]&&!1!==y[1]){for(l=0;l<m.length&&!(geometry.A.distance(y[0],m[l][0],4)<b&&geometry.A.distance(y[1],m[l][1],4)<b||geometry.A.distance(y[0],m[l][1],4)<b&&geometry.A.distance(y[1],m[l][0],4)<b);l++);l===m.length&&m.push(y.slice())}if((y=[1,0,0,0])[c+1]=A.bbox3D[c][1],a=math.A.innerProduct(y,A.defaultAxes[f[c]].normal,4),!1!==(y=A.intersectionPlanePlane(this,A.defaultAxes[f[c]],a))[0]&&!1!==y[1]){for(l=0;l<m.length&&!(geometry.A.distance(y[0],m[l][0],4)<b&&geometry.A.distance(y[1],m[l][1],4)<b||geometry.A.distance(y[0],m[l][1],4)<b&&geometry.A.distance(y[1],m[l][0],4)<b);l++);l===m.length&&m.push(y.slice())}}if(0===m.length)return{X:this.dataX,Y:this.dataY};d=0,l=0;do{for(4===(y=m[d][l]).length&&(n=A.project3DTo2D(y),this.dataX.push(n[1]),this.dataY.push(n[2])),l=(l+1)%2,y=m[d][l],p=d,c=0;c<m.length;c++){if(c!==d&&geometry.A.distance(y,m[c][0])<b){d=c,l=0;break}if(c!==d&&geometry.A.distance(y,m[c][1])<b){d=c,l=1;break}}if(d===p){console.log("Error plane3d update: did not find next",d);break}}while(0!==d);n=A.project3DTo2D(m[0][0]),this.dataX.push(n[1]),this.dataY.push(n[2])}else{for(t=utils_type.A.evaluate(this.range_u[0]),e=utils_type.A.evaluate(this.range_u[1]),i=utils_type.A.evaluate(this.range_v[0]),r=utils_type.A.evaluate(this.range_v[1]),v=this.point.coords,g=this.vec1.slice(),_=this.vec2.slice(),s=math.A.norm(g,4),o=math.A.norm(_,4),l=1;l<4;l++)g[l]/=s,_[l]/=o;for(c=0;c<4;c++){switch(c){case 0:h=t,u=i;break;case 1:h=e,u=i;break;case 2:h=e,u=r;break;case 3:h=t,u=r}for(l=0;l<4;l++)y[l]=v[l]+h*g[l]+u*_[l];n=A.project3DTo2D(y),this.dataX.push(n[1]),this.dataY.push(n[2])}this.dataX.push(this.dataX[0]),this.dataY.push(this.dataY[0])}return{X:this.dataX,Y:this.dataY}},addTransform:function(t,e){return this.addTransformGeneric(t,e),this.point.addTransform(t.point,e),this},updateTransform:function(){var t,e,i;if(0===this.transformations.length||null===this.baseElement)return this;for(this===this.baseElement?(t=this.vec1,e=this.vec2):(t=this.baseElement.vec1,e=this.baseElement.vec2),i=0;i<this.transformations.length;i++)this.transformations[i].update(),t=math.A.matVecMult(this.transformations[i].matrix,t),e=math.A.matVecMult(this.transformations[i].matrix,e);return this.vec1=t,this.vec2=e,this},update:function(){return this.needsUpdate&&this.updateCoords().updateTransform(),this},updateRenderer:function(){return this.needsUpdate=!1,this},projectCoords:function(t,e){return geometry.A.projectCoordsToParametric(t,this,2,e)}}),jxg.A.createPlane3D=function(t,e,i){var r,n,s,o,a,l,c,h,u,d,p=e[0],f=null,m=null;if((r=utils_type.A.copyAttributes(i,t.options,"plane3d")).threepoints||utils_type.A.isPoint3D(e[2])||utils_type.A.isPoint3D(e[3]))n=utils_type.A.providePoints3D(p,[e[1]],i,"plane3d",["point1"])[0],s=utils_type.A.providePoints3D(p,[e[2]],i,"plane3d",["point2"])[0],o=utils_type.A.providePoints3D(p,[e[3]],i,"plane3d",["point3"])[0],a=function(){return[s.X()-n.X(),s.Y()-n.Y(),s.Z()-n.Z()]},l=function(){return[o.X()-n.X(),o.Y()-n.Y(),o.Z()-n.Z()]},c=e[4]||[-1/0,1/0],h=e[5]||[-1/0,1/0];else{if(e[1].type===constants.A.OBJECT_TYPE_PLANE3D&&utils_type.A.isTransformationOrArray(e[2])?(f=e[1],m=e[2],n=utils_type.A.providePoints3D(p,[[0,0,0,0]],i,"plane3d",["point"])[0],a=[0,1e-4,0,0],l=[0,0,1e-4,0],c=e[3]||[-1/0,1/0],h=e[4]||[-1/0,1/0]):(n=utils_type.A.providePoints3D(p,[e[1]],i,"plane3d",["point"])[0],a=e[2],l=e[3],c=e[4]||[-1/0,1/0],h=e[5]||[-1/0,1/0]),!1===n)throw new Error("JSXGraph: Can't create plane3d with first parent of type '"+typeof e[1]+"'.\nPossible first parent types are: point3d, array of length 3, function returning an array of length 3.");if(null!==f&&e<3||null===f&&e.length<4)throw new Error("JSXGraph: Can't create plane3d with parents of type '"+typeof e[1]+", "+typeof e[2]+", "+typeof e[3]+", "+typeof e[4]+", "+typeof e[5]+"'.")}return u=new jxg.A.Plane3D(p,n,a,c,l,h,r),n.addChild(u),r=u.setAttr2D(r),u.element2D=p.create("curve",[[],[]],r),u.element2D.view=p,null!==f&&null!==m&&(u.addTransform(f,m),u.addParents(f)),u.element2D.updateDataArray=function(){var t=u.updateDataArray();this.dataX=t.X,this.dataY=t.Y},u.addChild(u.element2D),u.inherits.push(u.element2D),u.element2D.setParents(u),Math.abs(u.range_u[0])!==1/0&&Math.abs(u.range_u[1])!==1/0&&Math.abs(u.range_v[0])!==1/0&&Math.abs(u.range_v[1])!==1/0&&(r=utils_type.A.copyAttributes(r.mesh3d,t.options,"mesh3d"),d=p.create("mesh3d",[function(){return n.coords},function(){return u.vec1},function(){return u.vec2},u.range_u,u.range_v],r),u.mesh3d=d,u.addChild(d),u.inherits.push(d),u.element2D.inherits.push(d),d.setParents(u),u.mesh3d.view=p),u.element2D.prepareUpdate().update(),t.isSuspendedUpdate||u.element2D.updateVisibility().updateRenderer(),u},jxg.A.registerElement("plane3d",jxg.A.createPlane3D),jxg.A.createIntersectionLine3D=function(t,e,i){var r,n,s,o=e[0],a=e[1],l=e[2],c=utils_type.A.copyAttributes(i,t.options,"intersectionline3d"),h=[];for(s=geometry.A.intersectionFunction3D(o,a,l),n=0;n<2;n++)h[n]=o.create("point3d",s[n],c["point"+(n+1)]);r=o.create("line3d",h,c);try{a.addChild(r),l.addChild(r)}catch(t){throw new Error("JSXGraph: Can't create 'intersection' with parent types '"+typeof e[1]+"' and '"+typeof e[2]+"'.")}return r.type=constants.A.OBJECT_TYPE_INTERSECTION_LINE3D,r.elType="intersectionline3d",r.setParents([a.id,l.id]),r},jxg.A.registerElement("intersectionline3d",jxg.A.createIntersectionLine3D),jxg.A.Text3D=function(t,e,i,r,n){this.constructor(t.board,n,constants.A.OBJECT_TYPE_TEXT3D,constants.A.OBJECT_CLASS_3D),this.constructor3D(t,"text3d"),this.board.finalizeAdding(this),this.coords=[0,0,0,0],this.F=e,this.slide=r,this.X=function(){return this.coords[1]},this.Y=function(){return this.coords[2]},this.Z=function(){return this.coords[3]},this.position=[],this._c2d=null,this.methodMap=utils_type.A.deepCopy(this.methodMap,{})},jxg.A.Text3D.prototype=new jxg.A.GeometryElement,utils_type.A.copyPrototypeMethods(jxg.A.Text3D,jxg.A.GeometryElement3D,"constructor3D"),jxg.A.extend(jxg.A.Text3D.prototype,{updateCoords:function(){var t;if(utils_type.A.isFunction(this.F))this.coords=utils_type.A.evaluate(this.F),this.coords.unshift(1);else for(this.coords[0]=1,t=0;t<3;t++)utils_type.A.isFunction(this.F[t])&&(this.coords[t+1]=utils_type.A.evaluate(this.F[t]));return this},initCoords:function(){var t;if(utils_type.A.isFunction(this.F))this.coords=utils_type.A.evaluate(this.F),this.coords.unshift(1);else for(this.coords[0]=1,t=0;t<3;t++)this.coords[t+1]=utils_type.A.evaluate(this.F[t]);return this},normalizeCoords:function(){return Math.abs(this.coords[0])>math.A.eps&&(this.coords[1]/=this.coords[0],this.coords[2]/=this.coords[0],this.coords[3]/=this.coords[0],this.coords[0]=1),this},setPosition:function(t,e){var i=this.coords;return 3===t.length?(i[0]=1,i[1]=t[0],i[2]=t[1],i[3]=t[2]):(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[2],this.normalizeCoords()),this},update:function(t){var e,i,r;return this.element2D.draggable()&&0!==geometry.A.distance(this._c2d,this.element2D.coords.usrCoords)?(this.view.isVerticalDrag()?e=this.view.project2DTo3DVertical(this.element2D,this.coords):(i=[1,0,0,this.coords[3]],e=this.view.project2DTo3DPlane(this.element2D,[1,0,0,1],i)),0!==e[0]&&(r=this.view.project3DToCube(e),this.coords=r[0],r[1]&&this.element2D.coords.setCoordinates(constants.A.COORDS_BY_USER,this.view.project3DTo2D(this.coords)),this.slide&&(this.coords=this.slide.projectCoords([this.X(),this.Y(),this.Z()],this.position),this.element2D.coords.setCoordinates(constants.A.COORDS_BY_USER,this.view.project3DTo2D(this.coords))))):(this.updateCoords(),this.slide&&(this.coords=this.slide.projectCoords([this.X(),this.Y(),this.Z()],this.position)),e=this.coords,this.element2D.coords.setCoordinates(constants.A.COORDS_BY_USER,this.view.project3DTo2D(e)),this.zIndex=math.A.matVecMult(this.view.matrix3DRotShift,e)[3],this.element2D.prepareUpdate().update()),this._c2d=this.element2D.coords.usrCoords.slice(),this},updateRenderer:function(){return this.needsUpdate=!1,this},testIfFinite:function(){return Math.abs(this.coords[0])>math.A.eps},__evt__update3D:function(t){}}),jxg.A.createText3D=function(t,e,i){var r,n,s,o,a,l,c=e[0];if(s=e.length>2&&utils_type.A.exists(e[e.length-1].is3D)?e.pop():null,3===e.length)n=e[1],o=e[2];else{if(5!==e.length)throw new Error("JSXGraph: Can't create text3d with parent types '"+typeof e[1]+"' and '"+typeof e[2]+"'.\nPossible parent types: [[x,y,z], text], [x,y,z, text]");n=e.slice(1,4),o=e[4]}return r=utils_type.A.copyAttributes(i,t.options,"text3d"),(l=new jxg.A.Text3D(c,n,o,s,r)).initCoords(),a=c.project3DTo2D(l.coords),r=l.setAttr2D(r),l.element2D=c.create("text",[a[1],a[2],o],r),l.element2D.view=c,l.addChild(l.element2D),l.inherits.push(l.element2D),l.element2D.setParents(l),l.slide&&(l.slide.addChild(l),l.setParents(l.slide)),l._c2d=l.element2D.coords.usrCoords.slice(),l},jxg.A.registerElement("text3d",jxg.A.createText3D),jxg.A.createTicks3D=function(t,e,i){var r,n,s=e[0],o=e[1],a=e[2],l=e[3],c=e[4];return n=utils_type.A.copyAttributes(i,t.options,"ticks3d"),(r=s.create("curve",[[],[]],n)).point=o,r.direction1=a,r.len=l,r.direction2=c,r.drawLabels=function(e){var i,r,n,o,a,l,c,h=this.len,u=this.evalVisProp("ticksdistance"),d=this.evalVisProp("tickendings"),p=this.evalVisProp("majorheight"),f=[0,0,0],m=[0,0,0],g=[0,0,0],_=[];if(i=(p/=Math.sqrt(t.unitX*t.unitY))*d[1]*2,this.dataX=[],this.dataY=[],utils_type.A.isFunction(this.point))g=this.point().slice(1);else for(o=0;o<3;o++)g[o]=utils_type.A.evaluate(this.point[o]);for(o=0;o<3;o++)f[o]=utils_type.A.evaluate(this.direction1[o]),m[o]=utils_type.A.evaluate(this.direction2[o]);for(r=jxg.A.Math.norm(f,3),n=jxg.A.Math.norm(m,3),o=0;o<3;o++)f[o]/=r,m[o]/=n;if(!(Math.abs(u)<math.A.eps)){for(a=0;a<=h;a+=u){for(c=[g[0]+a*f[0]+i*m[0],g[1]+a*f[1]+i*m[1],g[2]+a*f[2]+i*m[2]],o=0;o<3;o++)0!==f[o]&&(l=g[o]+a*f[o]);_.push(s.create("text3d",[c,l],e))}return _}},r.evalVisProp("drawlabels")&&(r.labels=r.drawLabels(n.label)),r.updateDataArray=function(){var e,i,r,n,o,a,l,c,h=this.len,u=this.evalVisProp("ticksdistance"),d=this.evalVisProp("tickendings"),p=this.evalVisProp("majorheight"),f=[0,0,0],m=[0,0,0],g=[0,0,0];if(e=(p/=Math.sqrt(t.unitX*t.unitY))*-d[0],i=p*d[1],this.dataX=[],this.dataY=[],utils_type.A.isFunction(this.point))g=this.point().slice(1);else for(o=0;o<3;o++)g[o]=utils_type.A.evaluate(this.point[o]);for(o=0;o<3;o++)f[o]=utils_type.A.evaluate(this.direction1[o]),m[o]=utils_type.A.evaluate(this.direction2[o]);for(r=jxg.A.Math.norm(f,3),n=jxg.A.Math.norm(m,3),o=0;o<3;o++)f[o]/=r,m[o]/=n;if(!(Math.abs(u)<math.A.eps))for(a=0;a<=h;a+=u)c=[g[0]+a*f[0]+e*m[0],g[1]+a*f[1]+e*m[1],g[2]+a*f[2]+e*m[2]],l=s.project3DTo2D(c),this.dataX.push(l[1]),this.dataY.push(l[2]),c=[g[0]+a*f[0]+i*m[0],g[1]+a*f[1]+i*m[1],g[2]+a*f[2]+i*m[2]],l=s.project3DTo2D(c),this.dataX.push(l[1]),this.dataY.push(l[2]),this.dataX.push(NaN),this.dataY.push(NaN)},r},jxg.A.registerElement("ticks3d",jxg.A.createTicks3D),jxg.A.Polygon3D=function(t,e,i){var r;for(this.constructor(t.board,i,constants.A.OBJECT_TYPE_POLYGON3D,constants.A.OBJECT_CLASS_3D),this.constructor3D(t,"polygon3d"),this.board.finalizeAdding(this),this.vertices=[],r=0;r<e.length;r++)this.vertices[r]=this.board.select(e[r]),this.vertices[r]._is_new&&(delete this.vertices[r]._is_new,this.vertices[r]._is_new_pol=!0)},jxg.A.Polygon3D.prototype=new jxg.A.GeometryElement,utils_type.A.copyPrototypeMethods(jxg.A.Polygon3D,jxg.A.GeometryElement3D,"constructor3D"),jxg.A.extend(jxg.A.Polygon3D.prototype,{update:function(){return this},updateRenderer:function(){return this.needsUpdate=!1,this},updateZIndex:function(){var t,e=this.vertices.length,i=[1,0,0,0];if(e<=0)return[NaN,NaN,NaN,NaN];for(t=0;t<e;t++)i[1]+=this.vertices[t].coords[1],i[2]+=this.vertices[t].coords[2],i[3]+=this.vertices[t].coords[3];return i[1]/=e,i[2]/=e,i[3]/=e,this.zIndex=math.A.matVecMult(this.view.matrix3DRotShift,i)[3],this}}),jxg.A.createPolygon3D=function(t,e,i){var r,n,s,o,a,l,c=e[0],h=[],u=[],d=!1;if(a=utils_type.A.copyAttributes(i,t.options,"polygon3d"),null===(o=t.select(e[1]))&&(o=e[1]),utils_type.A.isObject(o)&&o.type===constants.A.OBJECT_TYPE_POLYGON3D&&utils_type.A.isTransformationOrArray(e[2]))for(d=!0,s=o.vertices.length-1,l=utils_type.A.copyAttributes(i,t.options,"polygon3d","vertices"),n=0;n<s;n++)l.withlabel&&(l.name=""===o.vertices[n].name?"":o.vertices[n].name+"'"),h.push(t.create("point3d",[o.vertices[n],e[2]],l));else if(utils_type.A.isArray(e[1])&&e[1].every((t=>utils_type.A.isPoint3D(t))))h=e[1];else if(!1===(h=utils_type.A.providePoints3D(c,e.slice(1),i,"polygon3d",["vertices"])))throw new Error("JSXGraph: Can't create polygon3d with parent types other than 'point' and 'coordinate arrays' or a function returning an array of coordinates. Alternatively, a polygon3d and a transformation can be supplied");for((r=new jxg.A.Polygon3D(c,h,a)).isDraggable=!0,a=r.setAttr2D(a),n=0;n<h.length;n++)u.push(h[n].element2D);if(r.element2D=t.create("polygon",u,a),r.element2D.view=c,r.addChild(r.element2D),r.inherits.push(r.element2D),r.element2D.setParents(r),d)for(r.prepareUpdate().update().updateVisibility().updateRenderer(),s=o.vertices.length-1,n=0;n<s;n++)h[n].prepareUpdate().update().updateVisibility().updateRenderer();return r},jxg.A.registerElement("polygon3d",jxg.A.createPolygon3D),jxg.A.Face3D=function(t,e,i,r){this.constructor(t.board,r,constants.A.OBJECT_TYPE_FACE3D,constants.A.OBJECT_CLASS_3D),this.constructor3D(t,"face3d"),this.board.finalizeAdding(this),this.polyhedron=e,this.faceNumber=i,this.normal=[0,0,0,0],this.d=0,this.vec1=[0,0,0,0],this.vec2=[0,0,0,0],0===this.faceNumber&&this.updateCoords(),this.methodMap=utils_type.A.deepCopy(this.methodMap,{})},jxg.A.Face3D.prototype=new jxg.A.GeometryElement,utils_type.A.copyPrototypeMethods(jxg.A.Face3D,jxg.A.GeometryElement3D,"constructor3D"),jxg.A.extend(jxg.A.Face3D.prototype,{updateCoords:function(){var t,e,i,r,n=this.polyhedron;for(t in n.vertices){if(r=n.vertices[t],utils_type.A.isFunction(r))n.coords[t]=utils_type.A.evaluate(r);else if(utils_type.A.isArray(r))for(n.coords[t]=[],i=r.length,e=0;e<i;e++)n.coords[t][e]=utils_type.A.evaluate(r[e]);else{if(r=n.view.select(r),!utils_type.A.isPoint3D(r))throw new Error("Polyhedron3D.updateCoords: unknown vertices type!");n.coords[t]=r.coords}3===n.coords[t].length&&n.coords[t].unshift(1)}return this},updateDataArray2D:function(){var t,e,i,r,n=[],s=[],o=this.polyhedron,a=o.faces[this.faceNumber];if(0===this.faceNumber)for(t in o.vertices)o.coords2D[t]=[];for(e=a.length,this.zIndex=0,t=0;t<e;t++)0===(r=o.coords2D[a[t]]).length&&(i=o.coords[a[t]],r=this.view.project3DTo2D(i),o.coords2D[a[t]]=r,o.zIndex[a[t]]=math.A.matVecMult(this.view.matrix3DRotShift,i)[3]),n.push(r[1]),s.push(r[2]),this.zIndex+=o.zIndex[a[t]];return e>0&&(this.zIndex/=e),2!==e&&(n.push(n[0]),s.push(s[0])),{X:n,Y:s}},addTransform:function(t,e){return 0===this.faceNumber&&this.addTransformGeneric(t,e),this},updateTransform:function(){var t,e,i,r,n;if(0!==this.faceNumber)return this;if(0===this.transformations.length||null===this.baseElement)return this;for(t=this.transformations,i=0;i<t.length;i++)t[i].update();for(i in(n=this===this.baseElement?this.polyhedron:this.baseElement.polyhedron).coords)if(n.coords.hasOwnProperty(i)){for(e=n.coords[i],r=0;r<t.length;r++)e=math.A.matVecMult(t[r].matrix,e);this.polyhedron.coords[i]=e}return this},update:function(){var t,e,i,r,n,s;if(this.needsUpdate&&!this.view.board._change3DView){if(e=this.polyhedron,0===this.faceNumber&&this.updateCoords().updateTransform(),(s=e.faces[this.faceNumber]).length<3)return this;if(r=e.coords[s[0]],n=e.coords[s[1]],this.vec1=[n[0]-r[0],n[1]-r[1],n[2]-r[2],n[3]-r[3]],n=e.coords[s[2]],this.vec2=[n[0]-r[0],n[1]-r[1],n[2]-r[2],n[3]-r[3]],this.normal=math.A.crossProduct(this.vec1.slice(1),this.vec2.slice(1)),i=math.A.norm(this.normal),this.normal.unshift(0),Math.abs(i)>1e-12)for(t=1;t<4;t++)this.normal[t]/=i;this.d=math.A.innerProduct(r,this.normal,4)}return this},updateRenderer:function(){return this.needsUpdate&&(this.needsUpdate=!1,this.shader()),this},shader:function(){var t,e,i,r,n,s,o,a,l;if(this.evalVisProp("shader.enabled"))return t=this.evalVisProp("shader.hue"),e=this.evalVisProp("shader.saturation"),a=this.evalVisProp("shader.minlightness"),l=this.evalVisProp("shader.maxlightness"),"angle"===this.evalVisProp("shader.type").toLowerCase()?(r=math.A.innerProduct(this.view.matrix3DRotShift[3],this.normal),i=a+(l-a)*(r=Math.abs(r))):(o=this.view.zIndexMax,s=this.view.zIndexMin,i=a+(l-a)*((this.zIndex-s)/(o-s))),n="hsl("+t+","+e+"%,"+i+"%)",this.element2D.visProp.fillcolor=n,this.zIndex}}),jxg.A.createFace3D=function(t,e,i){var r,n,s=e[0],o=e[1],a=e[2];return r=utils_type.A.copyAttributes(i,t.options,"face3d"),r=(n=new jxg.A.Face3D(s,o,a,r)).setAttr2D(r),n.element2D=s.create("curve",[[],[]],r),n.element2D.view=s,n.element2D.updateDataArray=function(){var t=n.updateDataArray2D();this.dataX=t.X,this.dataY=t.Y},n.addChild(n.element2D),n.inherits.push(n.element2D),n.element2D.setParents(n),n.element2D.prepareUpdate().update(),t.isSuspendedUpdate||n.element2D.updateVisibility().updateRenderer(),n},jxg.A.registerElement("face3d",jxg.A.createFace3D),jxg.A.Polyhedron3D=function(t,e,i,r){var n,s,o,a=this;for(this.constructor(t.board,r,constants.A.OBJECT_TYPE_POLYHEDRON3D,constants.A.OBJECT_CLASS_3D),this.constructor3D(t,"polyhedron3d"),this.board.finalizeAdding(this),this.elType="polyhedron3d",this.faces=i,this.numberFaces=i.length,this.def=e,s=["setAttribute","setParents","prepareUpdate","updateRenderer","update","fullUpdate","highlight","noHighlight"],o=function(t){return function(){var e;for(e in a.faces)a.faces.hasOwnProperty(e)&&utils_type.A.exists(a.faces[e][t])&&a.faces[e][t].apply(a.faces[e],arguments);return a}},n=0;n<s.length;n++)this[s[n]]=o(s[n]);this.methodMap=utils_type.A.deepCopy(this.methodMap,{setAttribute:"setAttribute",setParents:"setParents"})},jxg.A.Polyhedron3D.prototype=new jxg.A.GeometryElement,utils_type.A.copyPrototypeMethods(jxg.A.Polyhedron3D,jxg.A.GeometryElement3D,"constructor3D"),jxg.A.extend(jxg.A.Polyhedron3D.prototype,{addTransform:function(t,e){if(!(this.faces.length>0&&t.faces.length>0))throw new Error("Adding transformation failed. At least one of the two polyhedra has no faces.");return this.faces[0].addTransform(t.faces[0],e),this}}),jxg.A.createPolyhedron3D=function(t,e,i){var r,n,s,o,a,l,c,h=e[0],u=[],d=null,p=null,f={view:h,vertices:{},coords:{},coords2D:{},zIndex:{},faces:[]};if(utils_type.A.exists(e[1].type)&&e[1].type===constants.A.OBJECT_TYPE_POLYHEDRON3D)d=e[1],p=e[2],f.vertices=d.def.vertices,f.faces=d.def.faces;else{if(utils_type.A.isArray(e[1]))for(n=e[1].length,r=0;r<n;r++)f.vertices[r]=e[1][r];else if(utils_type.A.isObject(e[1]))for(r in e[1])e[1].hasOwnProperty(r)&&(f.vertices[r]=e[1][r]);f.faces=e[2]}for(c=utils_type.A.copyAttributes(i,t.options,"polyhedron3d"),console.time("polyhedron"),h.board.suspendUpdate(),n=f.faces.length,r=0;r<n;r++)l=utils_type.A.copyAttributes(i,t.options,"face3d"),c.fillcolorarray.length>0&&(l.fillcolor=c.fillcolorarray[r%c.fillcolorarray.length]),o=f.faces[r],utils_type.A.isArray(o)&&2===o.length&&utils_type.A.isObject(o[1])&&utils_type.A.isArray(o[0])&&(utils_type.A.mergeAttr(l,o[1]),f.faces[r]=o[0]),s=h.create("face3d",[f,r],l),u.push(s);for((a=new jxg.A.Polyhedron3D(h,f,u,c)).setParents(a),r=0;r<n;r++)a.inherits.push(a.faces[r]),a.addChild(a.faces[r]);return null!==d&&(a.addTransform(d,p),a.addParents(d)),h.board.unsuspendUpdate(),console.timeEnd("polyhedron"),a},jxg.A.registerElement("polyhedron3d",jxg.A.createPolyhedron3D),jxg.A.Sphere3D=function(t,e,i,r,n){this.constructor(t.board,n,constants.A.OBJECT_TYPE_SPHERE3D,constants.A.OBJECT_CLASS_3D),this.constructor3D(t,"sphere3d"),this.board.finalizeAdding(this),this.method=e,this.center=this.board.select(i),this.point2=null,this.points=[],this.element2D=null,this.aux2D=[],this.projectionType=t.projectionType,"twoPoints"===e?(this.point2=this.board.select(r),this.radius=this.Radius()):"pointRadius"===e&&(this.updateRadius=utils_type.A.createFunction(r,this.board),this.updateRadius(),this.addParentsFromJCFunctions([this.updateRadius])),utils_type.A.exists(this.center._is_new)?(this.addChild(this.center),delete this.center._is_new):this.center.addChild(this),"twoPoints"===e&&(utils_type.A.exists(this.point2._is_new)?(this.addChild(this.point2),delete this.point2._is_new):this.point2.addChild(this)),this.methodMap=utils_type.A.deepCopy(this.methodMap,{center:"center",point2:"point2",Radius:"Radius"})},jxg.A.Sphere3D.prototype=new jxg.A.GeometryElement,utils_type.A.copyPrototypeMethods(jxg.A.Sphere3D,jxg.A.GeometryElement3D,"constructor3D"),jxg.A.extend(jxg.A.Sphere3D.prototype,{X:function(t,e){return this.Radius()*Math.sin(t)*Math.cos(e)},Y:function(t,e){return this.Radius()*Math.sin(t)*Math.sin(e)},Z:function(t,e){return this.Radius()*Math.cos(t)},range_u:[0,2*Math.PI],range_v:[0,Math.PI],update:function(){return this.projectionType!==this.view.projectionType&&this.rebuildProjection(),this},updateRenderer:function(){return this.needsUpdate=!1,this},setRadius:function(t){return this.updateRadius=utils_type.A.createFunction(t,this.board),this.addParentsFromJCFunctions([this.updateRadius]),this.board.update(),this},Radius:function(t){return utils_type.A.exists(t)?(this.setRadius(t),this.Radius()):"twoPoints"===this.method?this.center.testIfFinite()&&this.point2.testIfFinite()?this.center.distance(this.point2):NaN:"pointRadius"===this.method?Math.abs(this.updateRadius()):NaN},focusFn:function(t){var e=this;return function(){var i=e.view.boxToCam[3],r=e.Radius();return e.view.project3DTo2D([e.center.X()+t*r*i[1],e.center.Y()+t*r*i[2],e.center.Z()+t*r*i[3]]).slice(1,3)}},innerVertexFn:function(){var t=this;return function(){var e,i=t.view,r=i.worldToFocal(t.center.coords,!1),n=math.A.hypot(r[0],r[1]),s=i.boxToCam,o=t.Radius(),a=Math.atan(-n/r[2])+Math.acos(o/math.A.norm(r)),l=Math.cos(a),c=Math.sin(a);return e=n>1e-8?[-(r[0]*s[1][1]+r[1]*s[2][1])/n,-(r[0]*s[1][2]+r[1]*s[2][2])/n,-(r[0]*s[1][3]+r[1]*s[2][3])/n]:[s[1][1],s[1][2],s[1][3]],i.project3DTo2D([t.center.X()+o*(c*e[0]+l*s[3][1]),t.center.Y()+o*(c*e[1]+l*s[3][2]),t.center.Z()+o*(c*e[2]+l*s[3][3])])}},buildCentralProjection:function(t){var e=this.view,i={visible:!1,withLabel:!1},r=e.create("point",this.focusFn(-1),i),n=e.create("point",this.focusFn(1),i),s=e.create("point",this.innerVertexFn(e),i);this.aux2D=[r,n,s],this.element2D=e.create("ellipse",this.aux2D,void 0===t?this.visProp:t)},buildParallelProjection:function(t){var e=this;this.aux2D=[],this.element2D=this.view.create("circle",[e.center.element2D,function(){var t=e.view.bbox3D[0][1]-e.view.bbox3D[0][0];return e.Radius()*e.view.size[0]/t}],void 0===t?this.visProp:t)},rebuildProjection:function(t){var e;if(this.element2D)for(e in this.view.board.removeObject(this.element2D),this.aux2D)this.aux2D.hasOwnProperty(e)&&this.view.board.removeObject(this.aux2D[e]);this.projectionType=this.view.projectionType,"central"===this.projectionType?this.buildCentralProjection(t):this.buildParallelProjection(t),this.addChild(this.element2D),this.inherits.push(this.element2D),this.element2D.view=this.view},projectCoords:function(t,e){var i=this.Radius(),r=[1].concat(t),n=this.center.coords,s=geometry.A.distance(n,r,4),o=statistics.A.subtract(r,n);return 0===s?(e[0]=0,e[1]=0,[1,i,0,0]):0===i?(e[0]=0,e[1]=0,this.center.coords):(s=i/s,o[0]=1,o[1]*=s,o[2]*=s,o[3]*=s,e[1]=Math.atan2(o[2],o[1]),e[1]+=e[1]<0?Math.PI:0,0!==e[1]?e[0]=Math.atan2(o[2],o[3]*Math.sin(e[1])):e[0]=Math.atan2(o[1],o[3]*Math.cos(e[1])),e[0]+=e[0]<0?2*Math.PI:0,o)}}),jxg.A.createSphere3D=function(t,e,i){var r,n,s,o,a,l,c=e[0];for(r=utils_type.A.copyAttributes(i,t.options,"sphere3d"),n=[],l=1;l<e.length;l++)if(utils_type.A.isPointType3D(t,e[l])){if(s=0===n.length?"center":"point",!1===(o=utils_type.A.providePoints3D(c,[e[l]],i,"sphere3d",[s])[0]))throw new Error("JSXGraph: Can't create sphere3d from this type. Please provide a point type.");n.push(o)}else n.push(e[l]);if(utils_type.A.isPoint3D(n[0])&&utils_type.A.isPoint3D(n[1]))a=new jxg.A.Sphere3D(c,"twoPoints",n[0],n[1],r);else{if(!utils_type.A.isPoint3D(n[0])||!(utils_type.A.isNumber(n[1])||utils_type.A.isFunction(n[1])||utils_type.A.isString(n[1])))throw new Error("JSXGraph: Can't create sphere3d with parent types '"+typeof e[1]+"' and '"+typeof e[2]+"'.\nPossible parent types: [point,point], [point,number], [point,function]");a=new jxg.A.Sphere3D(c,"pointRadius",n[0],n[1],r)}return r=a.setAttr2D(r),a.rebuildProjection(r),a.element2D.prepareUpdate().update(),t.isSuspendedUpdate||a.element2D.updateVisibility().updateRenderer(),a},jxg.A.registerElement("sphere3d",jxg.A.createSphere3D),jxg.A.Surface3D=function(t,e,i,r,n,s,o,a){this.constructor(t.board,a,constants.A.OBJECT_TYPE_SURFACE3D,constants.A.OBJECT_CLASS_3D),this.constructor3D(t,"surface3d"),this.board.finalizeAdding(this),this._F=e,this._X=i,this._Y=r,this._Z=n,null!==this._F?(this._X=function(t,e){return this._F(t,e)[0]},this._Y=function(t,e){return this._F(t,e)[1]},this._Z=function(t,e){return this._F(t,e)[2]}):null!==this._X&&(this._F=function(t,e){return[this._X(t,e),this._Y(t,e),this._Z(t,e)]}),this.range_u=s,this.range_v=o,this.dataX=null,this.dataY=null,this.dataZ=null,this.points=[],this.methodMap=utils_type.A.deepCopy(this.methodMap,{})},jxg.A.Surface3D.prototype=new jxg.A.GeometryElement,utils_type.A.copyPrototypeMethods(jxg.A.Surface3D,jxg.A.GeometryElement3D,"constructor3D"),jxg.A.extend(jxg.A.Surface3D.prototype,{updateWireframe:function(){var t,e,i,r,n,s,o,a,l,c,h,u,d=[1,0,0,0];for(this.points=[],t=this.evalVisProp("stepsu"),e=this.evalVisProp("stepsv"),n=utils_type.A.evaluate(this.range_u),s=utils_type.A.evaluate(this.range_v),o=utils_type.A.evaluate(n[0]),a=utils_type.A.evaluate(s[0]),l=(utils_type.A.evaluate(n[1])-o)/t,c=(utils_type.A.evaluate(s[1])-a)/e,i=0,h=o;i<=t;i++,h+=l)for(this.points.push([]),r=0,u=a;r<=e;r++,u+=c)(d=this.F(h,u)).unshift(1),this.points[i].push(d);return this},updateCoords:function(){return null!==this._F?this.updateWireframe():this.updateTransform(),this},evalF:function(t,e){var i,r,n=[0,0,0,0];if(0===this.transformations.length||!utils_type.A.exists(this.baseElement))return this._F(t,e);for(i=this.transformations,r=0;r<i.length;r++)i[r].update();for((n=this===this.baseElement?this._F(t,e):this.baseElement.evalF(t,e)).unshift(1),n=math.A.matVecMult(i[0].matrix,n),r=1;r<i.length;r++)n=math.A.matVecMult(i[r].matrix,n);return n.slice(1)},F:function(t,e){return this.evalF(t,e)},X:function(t,e){return this.evalF(t,e)[0]},Y:function(t,e){return this.evalF(t,e)[1]},Z:function(t,e){return this.evalF(t,e)[2]},updateDataArray2D:function(){var t,e,i,r,n,s=[],o=[];if(0!==(i=this.points.length)){for(r=this.points[0].length,t=0;t<i;t++){for(e=0;e<r;e++)n=this.view.project3DTo2D(this.points[t][e]),s.push(n[1]),o.push(n[2]);s.push(NaN),o.push(NaN)}for(e=0;e<r;e++){for(t=0;t<i;t++)n=this.view.project3DTo2D(this.points[t][e]),s.push(n[1]),o.push(n[2]);s.push(NaN),o.push(NaN)}}return{X:s,Y:o}},addTransform:function(t,e){return this.addTransformGeneric(t,e),this},updateTransform:function(){var t,e,i,r,n,s,o;if(0===this.transformations.length||null===this.baseElement||utils_type.A.exists(this._F))return this;for(t=this.transformations,i=0;i<t.length;i++)t[i].update();if(this!==this.baseElement&&(this.points=[]),(s=this.baseElement.points.length)>0)for(o=this.baseElement.points[0].length,i=0;i<s;i++)for(this!==this.baseElement&&this.points.push([]),r=0;r<o;r++){for(e=this===this.baseElement?this.points[i][r]:this.baseElement.points[i][r],n=0;n<t.length;n++)e=math.A.matVecMult(t[n].matrix,e);this===this.baseElement?this.points[i][r]=e:this.points[i].push(e)}return this},updateDataArray:function(){},update:function(){return this.needsUpdate&&(this.updateDataArray(),this.updateCoords()),this},updateRenderer:function(){return this.needsUpdate=!1,this},projectCoords:function(t,e){return geometry.A.projectCoordsToParametric(t,this,2,e)}}),jxg.A.createParametricSurface3D=function(t,e,i){var r,n,s,o,a,l,c,h,u=e[0],d=null,p=null;return 3===e.length?(d=e[1],p=e[2],r=null,n=null,s=null,o=null):4===e.length?(r=e[1],a=e[2],l=e[3],n=null,s=null,o=null):(n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],r=null),c=utils_type.A.copyAttributes(i,t.options,"surface3d"),c=(h=new jxg.A.Surface3D(u,r,n,s,o,a,l,c)).setAttr2D(c),h.element2D=u.create("curve",[[],[]],c),h.element2D.view=u,null!==d&&(h.addTransform(d,p),h.addParents(d)),h.element2D.updateDataArray=function(){var t=h.updateDataArray2D();this.dataX=t.X,this.dataY=t.Y},h.addChild(h.element2D),h.inherits.push(h.element2D),h.element2D.setParents(h),h.element2D.prepareUpdate().update(),t.isSuspendedUpdate||h.element2D.updateVisibility().updateRenderer(),h},jxg.A.registerElement("parametricsurface3d",jxg.A.createParametricSurface3D),jxg.A.createFunctiongraph3D=function(t,e,i){var r,n=e[0],s=utils_type.A.createFunction(e[1],t,"x, y"),o=e[2],a=e[3];return(r=n.create("parametricsurface3d",[function(t,e){return t},function(t,e){return e},s,o,a],i)).elType="functiongraph3d",r},jxg.A.registerElement("functiongraph3d",jxg.A.createFunctiongraph3D);let size=.75,color="#000";jxg.A.themes.mono_thin={board:{showInfobox:!1,showCopyright:!0,defaultAxes:{x:{ticks:{minorTicks:0,majorHeight:10,majorTickEndings:[1,0]}},y:{ticks:{minorTicks:0,majorHeight:10,majorTickEndings:[0,1]}}}},navbar:{strokeColor:"#bbb",fillColor:"none"},elements:{strokeColor:color,highlightStrokeColor:color,fillColor:"none",highlightFillColor:"none",strokeOpacity:.6,highlightStrokeOpacity:1},angle:{strokeColor:color,fillColor:"#aaaaaa55",fillOpacity:.3,highlightFillColor:"#aaaaaa33",highlightFillOpacity:.3,label:{strokeColor:color}},arc:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size},axis:{},boxplot:{strokeWidth:size,strokeColor:color,fillColor:color,fillOpacity:.2,highlightStrokeWidth:size,highlightStrokeColor:color,highlightFillColor:color,highlightFillOpacity:.1},circle:{strokeWidth:size,highlightStrokeWidth:1.5*size,strokeColor:color,highlightFillColor:"none",highlightStrokeColor:color,center:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},point2:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},circumcircle:{strokeWidth:size,highlightStrokeWidth:1.5*size,strokeColor:color,highlightFillColor:"none",highlightStrokeColor:color,center:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},circumcirclearc:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size},circumcirclesector:{strokeColor:color,fillColor:"#aaaaaa55",fillOpacity:.3,highlightFillColor:"#aaaaaa33",highlightFillOpacity:.3},comb:{strokeColor:color,strokeWidth:size},conic:{strokeWidth:size,highlightStrokeWidth:1.5*size,strokeColor:color,highlightStrokeColor:color,fillColor:"none",highlightFillColor:"none"},curve:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size},grid:{strokeWidth:size},hatch:{strokeColor:color,strokeWidth:size},incircle:{strokeWidth:size,highlightStrokeWidth:1.5*size,strokeColor:color,highlightFillColor:"none",highlightStrokeColor:color,center:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},inequality:{fillColor:"#aaaaaa55",fillOpacity:.2},integral:{fillColor:"#aaaaaa55",highlightFillColor:"#aaaaa33",fillOpacity:.3,highlightFillOpacity:.3,curveLeft:{color},baseLeft:{color},curveRight:{color},baseRight:{color}},label:{strokeColor:color},line:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size,point1:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},point2:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},normal:{strokeColor:color},parallel:{strokeColor:color},perpendicular:{strokeColor:color},perpendicularsegment:{strokeColor:color},point:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},polygon:{fillColor:"#aaaaaa55",highlightFillColor:"#aaaaaa33",fillOpacity:.3,highlightFillOpacity:.3,vertices:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},borders:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size}},sector:{strokeColor:color,fillColor:"#aaaaaa55",fillOpacity:.3,highlightFillColor:"#aaaaaa33",highlightFillOpacity:.3},semicircle:{center:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color}},slider:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color,baseline:{strokeWidth:size,strokeColor:color,highlightStrokeColor:color},label:{strokeColor:color},highline:{strokeWidth:3*size,name:"",strokeColor:color,highlightStrokeColor:color},ticks:{strokeColor:color}},slopefield:{strokeWidth:.75*size,highlightStrokeWidth:size,highlightStrokeColor:color,highlightStrokeOpacity:.8},tapemeasure:{strokeColor:color,strokeWidth:size,highlightStrokeColor:color,highlightStrokeWidth:size,point1:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},point2:{size,fillColor:color,strokeColor:color,highlightStrokeWidth:4*size,highlightFillColor:color,highlightStrokeColor:color},ticks:{strokeWidth:size}},text:{strokeColor:color},tracecurve:{strokeColor:color},turtle:{strokeWidth:size,strokeColor:color,arrow:{strokeWidth:2*size,strokeColor:"#aaaaaa55"}},vectorfield:{strokeWidth:.75*size,highlightStrokeWidth:size,highlightStrokeColor:color,highlightStrokeOpacity:.8}};const mono_thin=null,COORDS_BY_SCREEN=jxg.A.COORDS_BY_SCREEN,COORDS_BY_USER=jxg.A.COORDS_BY_USER,Dump=jxg.A.Dump,Expect=jxg.A.Expect,JSXGraph=jxg.A.JSXGraph,Mat=jxg.A.Math,Options=jxg.A.Options,boards=jxg.A.boards,src_elements=jxg.A.elements,palette=jxg.A.palette,paletteWong=jxg.A.paletteWong,Board=jxg.A.Board,Chart=jxg.A.Chart,Circle=jxg.A.Circle,Complex=jxg.A.Complex,Composition=jxg.A.Composition,Coords=jxg.A.Coords,CoordsElement=jxg.A.CoordsElement,src_Curve=jxg.A.Curve,GeometryElement=jxg.A.GeometryElement,src_Group=jxg.A.Group,src_Image=jxg.A.Image,JessieCode=jxg.A.JessieCode,Prefix=jxg.A.PrefixParser,src_Line=jxg.A.Line,Point=jxg.A.Point,Polygon=jxg.A.Polygon,Text=jxg.A.Text,Ticks=jxg.A.Ticks,Transformation=jxg.A.Transformation,Turtle=jxg.A.Turtle,View3D=jxg.A.View3D,LMS2rgb=jxg.A.LMS2rgb,addEvent=jxg.A.addEvent,autoDigits=jxg.A.autoDigits,autoHighlight=jxg.A.autoHighlight,bind=jxg.A.bind,capitalize=jxg.A.capitalize,clearVisPropOld=jxg.A.clearVisPropOld,clone=jxg.A.clone,cloneAndCopy=jxg.A.cloneAndCopy,cmpArrays=jxg.A.cmpArrays,coordsArrayToMatrix=jxg.A.coordsArrayToMatrix,copyAttributes=jxg.A.copyAttributes,createEvalFunction=jxg.A.createEvalFunction,createFunction=jxg.A.createFunction,createHTMLSlider=jxg.A.createHTMLSlider,darkenColor=jxg.A.darkenColor,debug=jxg.A.debug,debugInt=jxg.A.debugInt,debugLine=jxg.A.debugLine,debugWST=jxg.A.debugWST,deepCopy=jxg.A.deepCopy,def=jxg.A.def,deprecated=jxg.A.deprecated,eliminateDuplicates=jxg.A.eliminateDuplicates,escapeHTML=jxg.A.escapeHTML,evalSlider=jxg.A.evalSlider,evaluate=jxg.A.evaluate,filterElements=jxg.A.filterElements,getBoardByContainerId=jxg.A.getBoardByContainerId,getCSSTransformMatrix=jxg.A.getCSSTransformMatrix,getCSSTransform=jxg.A.getCSSTransform,getDimensions=jxg.A.getDimensions,getOffset=jxg.A.getOffset,getPosition=jxg.A.getPosition,getProp=jxg.A.getProp,hex2rgb=jxg.A.hex2rgb,hsv2rgb=jxg.A.hsv2rgb,isAndroid=jxg.A.isAndroid,isApple=jxg.A.isApple,isArray=jxg.A.isArray,isDesktop=jxg.A.isDesktop,isInArray=jxg.A.isInArray,isInObject=jxg.A.isInObject,isMetroApp=jxg.A.isMetroApp,isMobile=jxg.A.isMobile,isMozilla=jxg.A.isMozilla,isBoard=jxg.A.isBoard,isName=jxg.A.isName,isNode=jxg.A.isNode,isNumber=jxg.A.isNumber,isObject=jxg.A.isObject,isPoint=jxg.A.isPoint,isPoint3D=jxg.A.isPoint3D,isPointType=jxg.A.isPointType,isPointType3D=jxg.A.isPointType3D,isString=jxg.A.isString,isTouchDevice=jxg.A.isTouchDevice,isTransformationOrArray=jxg.A.isTransformationOrArray,isWebWorker=jxg.A.isWebWorker,isWebkitAndroid=jxg.A.isWebkitAndroid,isWebkitApple=jxg.A.isWebkitApple,keys=jxg.A.keys,lightenColor=jxg.A.lightenColor,merge=jxg.A.merge,normalizePointFace=jxg.A.normalizePointFace,providePoints=jxg.A.providePoints,registerElement=jxg.A.registerElement,registerReader=jxg.A.registerReader,removeAllEvents=jxg.A.removeAllEvents,removeElementFromArray=jxg.A.removeElementFromArray,removeEvent=jxg.A.removeEvent,rgb2LMS=jxg.A.rgb2LMS,rgb2bw=jxg.A.rgb2bw,rgb2cb=jxg.A.rgb2cb,rgb2css=jxg.A.rgb2css,rgb2hex=jxg.A.rgb2hex,rgb2hsv=jxg.A.rgb2hsv,rgbParser=jxg.A.rgbParser,rgb2rgbo=jxg.A.rgba2rgbo,rgb2rgba=jxg.A.rgbo2rgba,sanitizeHTML=jxg.A.sanitizeHTML,shortcut=jxg.A.shortcut,strBool=jxg.A.str2Bool,supportsCanvas=jxg.A.supportsCanvas,supportsPointerEvents=jxg.A.supportsPointerEvents,supportsSVG=jxg.A.supportsSVG,supportsVML=jxg.A.supportsVML,swap=jxg.A.swap,timeChunk=jxg.A.timedChunk,toFixed=jxg.A.toFixed,toFullscreen=jxg.A.toFullscreen,src_toJSON=jxg.A.toJSON,trim=jxg.A.trim,trimNumber=jxg.A.trimNumber,truncate=jxg.A.truncate,unescapeHTML=jxg.A.unescapeHTML,uniqueArray=jxg.A.uniqueArray,useBlackWhiteOptions=jxg.A.useBlackWhiteOptions,useStandardOptions=jxg.A.useStandardOptions,warn=jxg.A.warn;env.A.isBrowser?window.JXG=jxg.A:env.A.isWebWorker()&&(self.JXG=jxg.A);const src=jxg.A;var jsxgraphRenderer=function(t,e){var i=e.type,r=e.expression,n=e.domain,s=void 0===n?[-10,10]:n,o=e.range,a=void 0===o?[-10,10]:o,l=e.containerId;l?t.id=l:t.id||(t.id="jsxgraph-".concat(Math.random().toString(36).substring(2,8)));var c=[s[0],a[1],s[1],a[0]],h=src.JSXGraph.initBoard(t.id,{boundingBox:c,axis:!0,grid:!0,showCopyright:!1,showNavigation:!0});switch(i){case"function2D":renderFunction(h,r,s);break;case"functions2D":e.functions&&Array.isArray(e.functions)&&e.functions.forEach((function(t,e){renderFunction(h,t.expression,s,t.color||getColor(e))}));break;case"geometry":renderGeometry(h,e.elements||[]);break;case"parametric2D":renderParametric(h,e);break;case"calculus":"derivative"===e.subtype?renderDerivative(h,e):"integral"===e.subtype&&renderIntegral(h,e);break;default:renderFunction(h,r||"x",s)}return h};function renderFunction(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#3090FF";try{var n=jsxgraphRenderer_createFunctionFromExpression(e);t.create("functiongraph",[n,i[0],i[1]],{strokeColor:r,strokeWidth:2})}catch(e){console.error("Error plotting function:",e),t.create("text",[0,0,"Error: ".concat(e.message)],{fontSize:14,color:"red",fixed:!0})}}function renderGeometry(t,e){if(e&&Array.isArray(e)&&0!==e.length){var i={};e.forEach((function(e,r){if("point"===e.type){var n=t.create("point",e.coordinates,{name:e.label||e.id||"P".concat(r),size:e.size||4,color:e.color||"blue",fixed:e.fixed||!1});e.id&&(i[e.id]=n)}})),e.forEach((function(e,r){var n,s;if("line"===e.type)e.point1Id&&i[e.point1Id]?n=i[e.point1Id]:e.point1&&(n=t.create("point",e.point1,{visible:!1})),e.point2Id&&i[e.point2Id]?s=i[e.point2Id]:e.point2&&(s=t.create("point",e.point2,{visible:!1})),n&&s&&t.create("line",[n,s],{straightFirst:!1!==e.straightFirst,straightLast:!1!==e.straightLast,strokeColor:e.color||"black",strokeWidth:e.width||2});else if("circle"===e.type){var o;e.centerId&&i[e.centerId]?o=i[e.centerId]:e.center&&(o=t.create("point",e.center,{visible:e.showPoints||!1,name:e.centerName||""})),o&&t.create("circle",[o,e.radius],{strokeColor:e.color||"black",strokeWidth:e.width||2,fillColor:e.fillColor||"none",fillOpacity:e.fillOpacity||0})}}))}else t.create("point",[0,0],{name:"O",size:4,color:"blue"})}function renderParametric(t,e){var i=e.parameterName,r=void 0===i?"t":i,n=e.parameterRange,s=void 0===n?[0,2*Math.PI]:n,o=e.expressions;if(o&&o.x&&o.y)try{var a=jsxgraphRenderer_createFunctionFromExpression(o.x,r),l=jsxgraphRenderer_createFunctionFromExpression(o.y,r);t.create("curve",[function(t){return a(t)},function(t){return l(t)},s[0],s[1]],{strokeColor:e.color||"#FF9030",strokeWidth:2}),e.specialPoints&&Array.isArray(e.specialPoints)&&e.specialPoints.forEach((function(e){if(void 0!==e.t){var i=a(e.t),r=l(e.t);t.create("point",[i,r],{name:e.label||"t=".concat(e.t),size:4,color:e.color||"#3090FF"})}}))}catch(t){console.error("Error plotting parametric curve:",t)}else console.error("Missing x or y expressions for parametric curve")}function renderDerivative(t,e){if(e.function&&e.function.expression)try{if(renderFunction(t,e.function.expression,e.domain,e.function.color||"#3090FF"),e.derivative&&e.derivative.expression&&renderFunction(t,e.derivative.expression,e.domain,e.derivative.color||"#FF5733"),e.derivative&&e.derivative.showTangent&&e.derivative.tangentPoint){var i=jsxgraphRenderer_createFunctionFromExpression(e.function.expression),r=jsxgraphRenderer_createFunctionFromExpression(e.derivative.expression),n=e.derivative.tangentPoint,s=i(n),o=r(n);t.create("line",[[n,s],[n+1,s+o]],{strokeColor:e.derivative.tangentColor||"#FF5733",strokeWidth:2,dash:2}),t.create("point",[n,s],{name:"Tangent point",size:4,color:e.derivative.tangentColor||"#FF5733"})}}catch(t){console.error("Error plotting derivative:",t)}else console.error("Missing function expression for derivative visualization")}function renderIntegral(t,e){if(e.function&&e.function.expression)try{var i=jsxgraphRenderer_createFunctionFromExpression(e.function.expression),r=e.integral.lowerBound,n=e.integral.upperBound;renderFunction(t,e.function.expression,e.domain,e.function.color||"#3090FF");var s=t.create("curve",[function(t){return t},function(t){return i(t)},r,n],{visible:!1});if(t.create("integral",[s,r,n],{fillColor:e.integral.color||"#FF9030",fillOpacity:e.integral.fillOpacity||.3,strokeColor:e.integral.color||"#FF9030",strokeWidth:1}),e.integral.approximation&&e.integral.approximation.show)for(var o=e.integral.approximation.count||10,a=(n-r)/o,l=0;l<o;l++){var c=r+l*a,h=i(c);t.create("polygon",[[c,0],[c+a,0],[c+a,h],[c,h]],{fillColor:e.integral.approximation.color||"#FF9030",fillOpacity:.2,strokeColor:e.integral.approximation.color||"#FF9030",strokeWidth:1})}}catch(t){console.error("Error plotting integral:",t)}else console.error("Missing function expression for integral visualization")}function jsxgraphRenderer_createFunctionFromExpression(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"x";try{var i=t.replace(/Math\./g,"").replace(/sin/g,"Math.sin").replace(/cos/g,"Math.cos").replace(/tan/g,"Math.tan").replace(/exp/g,"Math.exp").replace(/log/g,"Math.log").replace(/sqrt/g,"Math.sqrt").replace(/pow/g,"Math.pow").replace(/PI/g,"Math.PI");return new Function(e,"return ".concat(i,";"))}catch(t){return console.error("Error creating function from expression:",t),function(t){return 0}}}function getColor(t){var e=["#3090FF","#FF9030","#30FF90","#FF3090","#9030FF","#30FFF9","#FFD700"];return e[t%e.length]}const renderers_jsxgraphRenderer=null;function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}var JSXGraphVisualizer_excluded=["type","expression","domain","range","elements","width","height","containerId"];function ownKeys(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(i),!0).forEach((function(e){_defineProperty(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function JSXGraphVisualizer_objectWithoutProperties(t,e){if(null==t)return{};var i,r,n=JSXGraphVisualizer_objectWithoutPropertiesLoose(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)i=s[r],-1===e.indexOf(i)&&{}.propertyIsEnumerable.call(t,i)&&(n[i]=t[i])}return n}function JSXGraphVisualizer_objectWithoutPropertiesLoose(t,e){if(null==t)return{};var i={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(-1!==e.indexOf(r))continue;i[r]=t[r]}return i}var JSXGraphVisualizer=function(t){var e=t.type,i=t.expression,r=t.domain,n=void 0===r?[-10,10]:r,s=t.range,o=void 0===s?[-10,10]:s,a=t.elements,l=void 0===a?[]:a,c=t.width,h=void 0===c?"100%":c,u=t.height,d=void 0===u?400:u,p=t.containerId,f=JSXGraphVisualizer_objectWithoutProperties(t,JSXGraphVisualizer_excluded),m=(0,react.useRef)(null),g=(0,react.useRef)(null);return(0,react.useEffect)((function(){return m.current&&(g.current&&(m.current.innerHTML=""),g.current=jsxgraphRenderer(m.current,_objectSpread({type:e,expression:i,domain:n,range:o,elements:l,containerId:p},f))),function(){if(g.current&&"function"==typeof g.current.suspendUpdate)try{g.current.removeObject(g.current.objects),g.current=null}catch(t){console.error("Error cleaning up JSXGraph board:",t)}}}),[e,i,n,o,l,p,f]),react.createElement("div",{ref:m,style:{width:h,height:d,margin:"0 auto"},"data-testid":"jsxgraph-container"})};const visualizers_JSXGraphVisualizer=null;function max(t,e){let i;if(void 0===e)for(const e of t)null!=e&&(i<e||void 0===i&&e>=e)&&(i=e);else{let r=-1;for(let n of t)null!=(n=e(n,++r,t))&&(i<n||void 0===i&&n>=n)&&(i=n)}return i}function min(t,e){let i;if(void 0===e)for(const e of t)null!=e&&(i>e||void 0===i&&e>=e)&&(i=e);else{let r=-1;for(let n of t)null!=(n=e(n,++r,t))&&(i>n||void 0===i&&n>=n)&&(i=n)}return i}function src_identity(t){return t}var axis_top=1,right=2,bottom=3,left=4,epsilon=1e-6;function translateX(t){return"translate("+t+",0)"}function translateY(t){return"translate(0,"+t+")"}function number(t){return e=>+t(e)}function center(t,e){return e=Math.max(0,t.bandwidth()-2*e)/2,t.round()&&(e=Math.round(e)),i=>+t(i)+e}function entering(){return!this.__axis}function axis(t,e){var i=[],r=null,n=null,s=6,o=6,a=3,l="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5,c=t===axis_top||t===left?-1:1,h=t===left||t===right?"x":"y",u=t===axis_top||t===bottom?translateX:translateY;function d(d){var p=null==r?e.ticks?e.ticks.apply(e,i):e.domain():r,f=null==n?e.tickFormat?e.tickFormat.apply(e,i):src_identity:n,m=Math.max(s,0)+a,g=e.range(),_=+g[0]+l,v=+g[g.length-1]+l,y=(e.bandwidth?center:number)(e.copy(),l),b=d.selection?d.selection():d,A=b.selectAll(".domain").data([null]),x=b.selectAll(".tick").data(p,e).order(),C=x.exit(),E=x.enter().append("g").attr("class","tick"),M=x.select("line"),S=x.select("text");A=A.merge(A.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),x=x.merge(E),M=M.merge(E.append("line").attr("stroke","currentColor").attr(h+"2",c*s)),S=S.merge(E.append("text").attr("fill","currentColor").attr(h,c*m).attr("dy",t===axis_top?"0em":t===bottom?"0.71em":"0.32em")),d!==b&&(A=A.transition(d),x=x.transition(d),M=M.transition(d),S=S.transition(d),C=C.transition(d).attr("opacity",epsilon).attr("transform",(function(t){return isFinite(t=y(t))?u(t+l):this.getAttribute("transform")})),E.attr("opacity",epsilon).attr("transform",(function(t){var e=this.parentNode.__axis;return u((e&&isFinite(e=e(t))?e:y(t))+l)}))),C.remove(),A.attr("d",t===left||t===right?o?"M"+c*o+","+_+"H"+l+"V"+v+"H"+c*o:"M"+l+","+_+"V"+v:o?"M"+_+","+c*o+"V"+l+"H"+v+"V"+c*o:"M"+_+","+l+"H"+v),x.attr("opacity",1).attr("transform",(function(t){return u(y(t)+l)})),M.attr(h+"2",c*s),S.attr(h,c*m).text(f),b.filter(entering).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===right?"start":t===left?"end":"middle"),b.each((function(){this.__axis=y}))}return d.scale=function(t){return arguments.length?(e=t,d):e},d.ticks=function(){return i=Array.from(arguments),d},d.tickArguments=function(t){return arguments.length?(i=null==t?[]:Array.from(t),d):i.slice()},d.tickValues=function(t){return arguments.length?(r=null==t?null:Array.from(t),d):r&&r.slice()},d.tickFormat=function(t){return arguments.length?(n=t,d):n},d.tickSize=function(t){return arguments.length?(s=o=+t,d):s},d.tickSizeInner=function(t){return arguments.length?(s=+t,d):s},d.tickSizeOuter=function(t){return arguments.length?(o=+t,d):o},d.tickPadding=function(t){return arguments.length?(a=+t,d):a},d.offset=function(t){return arguments.length?(l=+t,d):l},d}function axisTop(t){return axis(axis_top,t)}function axisRight(t){return axis(right,t)}function axisBottom(t){return axis(bottom,t)}function axisLeft(t){return axis(left,t)}function none(){}function selector(t){return null==t?none:function(){return this.querySelector(t)}}function selection_select(t){"function"!=typeof t&&(t=selector(t));for(var e=this._groups,i=e.length,r=new Array(i),n=0;n<i;++n)for(var s,o,a=e[n],l=a.length,c=r[n]=new Array(l),h=0;h<l;++h)(s=a[h])&&(o=t.call(s,s.__data__,h,a))&&("__data__"in s&&(o.__data__=s.__data__),c[h]=o);return new Selection(r,this._parents)}function array(t){return null==t?[]:Array.isArray(t)?t:Array.from(t)}function empty(){return[]}function selectorAll(t){return null==t?empty:function(){return this.querySelectorAll(t)}}function arrayAll(t){return function(){return array(t.apply(this,arguments))}}function selectAll(t){t="function"==typeof t?arrayAll(t):selectorAll(t);for(var e=this._groups,i=e.length,r=[],n=[],s=0;s<i;++s)for(var o,a=e[s],l=a.length,c=0;c<l;++c)(o=a[c])&&(r.push(t.call(o,o.__data__,c,a)),n.push(o));return new Selection(r,n)}function matcher(t){return function(){return this.matches(t)}}function childMatcher(t){return function(e){return e.matches(t)}}var find=Array.prototype.find;function childFind(t){return function(){return find.call(this.children,t)}}function childFirst(){return this.firstElementChild}function selectChild(t){return this.select(null==t?childFirst:childFind("function"==typeof t?t:childMatcher(t)))}var filter=Array.prototype.filter;function children(){return Array.from(this.children)}function childrenFilter(t){return function(){return filter.call(this.children,t)}}function selectChildren(t){return this.selectAll(null==t?children:childrenFilter("function"==typeof t?t:childMatcher(t)))}function selection_filter(t){"function"!=typeof t&&(t=matcher(t));for(var e=this._groups,i=e.length,r=new Array(i),n=0;n<i;++n)for(var s,o=e[n],a=o.length,l=r[n]=[],c=0;c<a;++c)(s=o[c])&&t.call(s,s.__data__,c,o)&&l.push(s);return new Selection(r,this._parents)}function sparse(t){return new Array(t.length)}function enter(){return new Selection(this._enter||this._groups.map(sparse),this._parents)}function EnterNode(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function src_constant(t){return function(){return t}}function bindIndex(t,e,i,r,n,s){for(var o,a=0,l=e.length,c=s.length;a<c;++a)(o=e[a])?(o.__data__=s[a],r[a]=o):i[a]=new EnterNode(t,s[a]);for(;a<l;++a)(o=e[a])&&(n[a]=o)}function bindKey(t,e,i,r,n,s,o){var a,l,c,h=new Map,u=e.length,d=s.length,p=new Array(u);for(a=0;a<u;++a)(l=e[a])&&(p[a]=c=o.call(l,l.__data__,a,e)+"",h.has(c)?n[a]=l:h.set(c,l));for(a=0;a<d;++a)c=o.call(t,s[a],a,s)+"",(l=h.get(c))?(r[a]=l,l.__data__=s[a],h.delete(c)):i[a]=new EnterNode(t,s[a]);for(a=0;a<u;++a)(l=e[a])&&h.get(p[a])===l&&(n[a]=l)}function datum(t){return t.__data__}function data(t,e){if(!arguments.length)return Array.from(this,datum);var i=e?bindKey:bindIndex,r=this._parents,n=this._groups;"function"!=typeof t&&(t=src_constant(t));for(var s=n.length,o=new Array(s),a=new Array(s),l=new Array(s),c=0;c<s;++c){var h=r[c],u=n[c],d=u.length,p=arraylike(t.call(h,h&&h.__data__,c,r)),f=p.length,m=a[c]=new Array(f),g=o[c]=new Array(f);i(h,u,m,g,l[c]=new Array(d),p,e);for(var _,v,y=0,b=0;y<f;++y)if(_=m[y]){for(y>=b&&(b=y+1);!(v=g[b])&&++b<f;);_._next=v||null}}return(o=new Selection(o,r))._enter=a,o._exit=l,o}function arraylike(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function exit(){return new Selection(this._exit||this._groups.map(sparse),this._parents)}function join(t,e,i){var r=this.enter(),n=this,s=this.exit();return"function"==typeof t?(r=t(r))&&(r=r.selection()):r=r.append(t+""),null!=e&&(n=e(n))&&(n=n.selection()),null==i?s.remove():i(s),r&&n?r.merge(n).order():n}function selection_merge(t){for(var e=t.selection?t.selection():t,i=this._groups,r=e._groups,n=i.length,s=r.length,o=Math.min(n,s),a=new Array(n),l=0;l<o;++l)for(var c,h=i[l],u=r[l],d=h.length,p=a[l]=new Array(d),f=0;f<d;++f)(c=h[f]||u[f])&&(p[f]=c);for(;l<n;++l)a[l]=i[l];return new Selection(a,this._parents)}function order(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var r,n=t[e],s=n.length-1,o=n[s];--s>=0;)(r=n[s])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this}function sort(t){function e(e,i){return e&&i?t(e.__data__,i.__data__):!e-!i}t||(t=ascending);for(var i=this._groups,r=i.length,n=new Array(r),s=0;s<r;++s){for(var o,a=i[s],l=a.length,c=n[s]=new Array(l),h=0;h<l;++h)(o=a[h])&&(c[h]=o);c.sort(e)}return new Selection(n,this._parents).order()}function ascending(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function call(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function nodes(){return Array.from(this)}function node(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r=t[e],n=0,s=r.length;n<s;++n){var o=r[n];if(o)return o}return null}function selection_size(){let t=0;for(const e of this)++t;return t}function selection_empty(){return!this.node()}function each(t){for(var e=this._groups,i=0,r=e.length;i<r;++i)for(var n,s=e[i],o=0,a=s.length;o<a;++o)(n=s[o])&&t.call(n,n.__data__,o,s);return this}EnterNode.prototype={constructor:EnterNode,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var xhtml="http://www.w3.org/1999/xhtml";const namespaces={svg:"http://www.w3.org/2000/svg",xhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function namespace(t){var e=t+="",i=e.indexOf(":");return i>=0&&"xmlns"!==(e=t.slice(0,i))&&(t=t.slice(i+1)),namespaces.hasOwnProperty(e)?{space:namespaces[e],local:t}:t}function attrRemove(t){return function(){this.removeAttribute(t)}}function attrRemoveNS(t){return function(){this.removeAttributeNS(t.space,t.local)}}function attrConstant(t,e){return function(){this.setAttribute(t,e)}}function attrConstantNS(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function attrFunction(t,e){return function(){var i=e.apply(this,arguments);null==i?this.removeAttribute(t):this.setAttribute(t,i)}}function attrFunctionNS(t,e){return function(){var i=e.apply(this,arguments);null==i?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function attr(t,e){var i=namespace(t);if(arguments.length<2){var r=this.node();return i.local?r.getAttributeNS(i.space,i.local):r.getAttribute(i)}return this.each((null==e?i.local?attrRemoveNS:attrRemove:"function"==typeof e?i.local?attrFunctionNS:attrFunction:i.local?attrConstantNS:attrConstant)(i,e))}function src_window(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function styleRemove(t){return function(){this.style.removeProperty(t)}}function styleConstant(t,e,i){return function(){this.style.setProperty(t,e,i)}}function styleFunction(t,e,i){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,i)}}function style(t,e,i){return arguments.length>1?this.each((null==e?styleRemove:"function"==typeof e?styleFunction:styleConstant)(t,e,null==i?"":i)):styleValue(this.node(),t)}function styleValue(t,e){return t.style.getPropertyValue(e)||src_window(t).getComputedStyle(t,null).getPropertyValue(e)}function propertyRemove(t){return function(){delete this[t]}}function propertyConstant(t,e){return function(){this[t]=e}}function propertyFunction(t,e){return function(){var i=e.apply(this,arguments);null==i?delete this[t]:this[t]=i}}function property(t,e){return arguments.length>1?this.each((null==e?propertyRemove:"function"==typeof e?propertyFunction:propertyConstant)(t,e)):this.node()[t]}function classArray(t){return t.trim().split(/^|\s+/)}function classList(t){return t.classList||new ClassList(t)}function ClassList(t){this._node=t,this._names=classArray(t.getAttribute("class")||"")}function classedAdd(t,e){for(var i=classList(t),r=-1,n=e.length;++r<n;)i.add(e[r])}function classedRemove(t,e){for(var i=classList(t),r=-1,n=e.length;++r<n;)i.remove(e[r])}function classedTrue(t){return function(){classedAdd(this,t)}}function classedFalse(t){return function(){classedRemove(this,t)}}function classedFunction(t,e){return function(){(e.apply(this,arguments)?classedAdd:classedRemove)(this,t)}}function classed(t,e){var i=classArray(t+"");if(arguments.length<2){for(var r=classList(this.node()),n=-1,s=i.length;++n<s;)if(!r.contains(i[n]))return!1;return!0}return this.each(("function"==typeof e?classedFunction:e?classedTrue:classedFalse)(i,e))}function textRemove(){this.textContent=""}function textConstant(t){return function(){this.textContent=t}}function textFunction(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function selection_text(t){return arguments.length?this.each(null==t?textRemove:("function"==typeof t?textFunction:textConstant)(t)):this.node().textContent}function htmlRemove(){this.innerHTML=""}function htmlConstant(t){return function(){this.innerHTML=t}}function htmlFunction(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function html(t){return arguments.length?this.each(null==t?htmlRemove:("function"==typeof t?htmlFunction:htmlConstant)(t)):this.node().innerHTML}function raise(){this.nextSibling&&this.parentNode.appendChild(this)}function selection_raise(){return this.each(raise)}function lower(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function selection_lower(){return this.each(lower)}function creatorInherit(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===xhtml&&e.documentElement.namespaceURI===xhtml?e.createElement(t):e.createElementNS(i,t)}}function creatorFixed(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function creator(t){var e=namespace(t);return(e.local?creatorFixed:creatorInherit)(e)}function append(t){var e="function"==typeof t?t:creator(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))}function constantNull(){return null}function insert(t,e){var i="function"==typeof t?t:creator(t),r=null==e?constantNull:"function"==typeof e?e:selector(e);return this.select((function(){return this.insertBefore(i.apply(this,arguments),r.apply(this,arguments)||null)}))}function remove(){var t=this.parentNode;t&&t.removeChild(this)}function selection_remove(){return this.each(remove)}function selection_cloneShallow(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function selection_cloneDeep(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function selection_clone(t){return this.select(t?selection_cloneDeep:selection_cloneShallow)}function selection_datum(t){return arguments.length?this.property("__data__",t):this.node().__data__}function contextListener(t){return function(e){t.call(this,e,this.__data__)}}function parseTypenames(t){return t.trim().split(/^|\s+/).map((function(t){var e="",i=t.indexOf(".");return i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),{type:t,name:e}}))}function onRemove(t){return function(){var e=this.__on;if(e){for(var i,r=0,n=-1,s=e.length;r<s;++r)i=e[r],t.type&&i.type!==t.type||i.name!==t.name?e[++n]=i:this.removeEventListener(i.type,i.listener,i.options);++n?e.length=n:delete this.__on}}}function onAdd(t,e,i){return function(){var r,n=this.__on,s=contextListener(e);if(n)for(var o=0,a=n.length;o<a;++o)if((r=n[o]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=i),void(r.value=e);this.addEventListener(t.type,s,i),r={type:t.type,name:t.name,value:e,listener:s,options:i},n?n.push(r):this.__on=[r]}}function on(t,e,i){var r,n,s=parseTypenames(t+""),o=s.length;if(!(arguments.length<2)){for(a=e?onAdd:onRemove,r=0;r<o;++r)this.each(a(s[r],e,i));return this}var a=this.node().__on;if(a)for(var l,c=0,h=a.length;c<h;++c)for(r=0,l=a[c];r<o;++r)if((n=s[r]).type===l.type&&n.name===l.name)return l.value}function dispatchEvent(t,e,i){var r=src_window(t),n=r.CustomEvent;"function"==typeof n?n=new n(e,i):(n=r.document.createEvent("Event"),i?(n.initEvent(e,i.bubbles,i.cancelable),n.detail=i.detail):n.initEvent(e,!1,!1)),t.dispatchEvent(n)}function dispatchConstant(t,e){return function(){return dispatchEvent(this,t,e)}}function dispatchFunction(t,e){return function(){return dispatchEvent(this,t,e.apply(this,arguments))}}function selection_dispatch(t,e){return this.each(("function"==typeof e?dispatchFunction:dispatchConstant)(t,e))}function*iterator(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r,n=t[e],s=0,o=n.length;s<o;++s)(r=n[s])&&(yield r)}ClassList.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var root=[null];function Selection(t,e){this._groups=t,this._parents=e}function selection(){return new Selection([[document.documentElement]],root)}function selection_selection(){return this}Selection.prototype=selection.prototype={constructor:Selection,select:selection_select,selectAll,selectChild,selectChildren,filter:selection_filter,data,enter,exit,join,merge:selection_merge,selection:selection_selection,order,sort,call,nodes,node,size:selection_size,empty:selection_empty,each,attr,style,property,classed,text:selection_text,html,raise:selection_raise,lower:selection_lower,append,insert,remove:selection_remove,clone:selection_clone,datum:selection_datum,on,dispatch:selection_dispatch,[Symbol.iterator]:iterator};const src_selection=selection;var noop={value:()=>{}};function dispatch_dispatch(){for(var t,e=0,i=arguments.length,r={};e<i;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new Dispatch(r)}function Dispatch(t){this._=t}function dispatch_parseTypenames(t,e){return t.trim().split(/^|\s+/).map((function(t){var i="",r=t.indexOf(".");if(r>=0&&(i=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:i}}))}function get(t,e){for(var i,r=0,n=t.length;r<n;++r)if((i=t[r]).name===e)return i.value}function set(t,e,i){for(var r=0,n=t.length;r<n;++r)if(t[r].name===e){t[r]=noop,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=i&&t.push({name:e,value:i}),t}Dispatch.prototype=dispatch_dispatch.prototype={constructor:Dispatch,on:function(t,e){var i,r=this._,n=dispatch_parseTypenames(t+"",r),s=-1,o=n.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(t=n[s]).type)r[i]=set(r[i],t.name,e);else if(null==e)for(i in r)r[i]=set(r[i],t.name,null);return this}for(;++s<o;)if((i=(t=n[s]).type)&&(i=get(r[i],t.name)))return i},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new Dispatch(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var i,r,n=new Array(i),s=0;s<i;++s)n[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=0,i=(r=this._[t]).length;s<i;++s)r[s].value.apply(e,n)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],n=0,s=r.length;n<s;++n)r[n].value.apply(e,i)}};const src_dispatch=dispatch_dispatch;var timer_frame=0,timeout=0,interval=0,pokeDelay=1e3,taskHead,taskTail,clockLast=0,clockNow=0,clockSkew=0,clock="object"==typeof performance&&performance.now?performance:Date,setFrame="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function timer_now(){return clockNow||(setFrame(clearNow),clockNow=clock.now()+clockSkew)}function clearNow(){clockNow=0}function Timer(){this._call=this._time=this._next=null}function timer(t,e,i){var r=new Timer;return r.restart(t,e,i),r}function timerFlush(){timer_now(),++timer_frame;for(var t,e=taskHead;e;)(t=clockNow-e._time)>=0&&e._call.call(void 0,t),e=e._next;--timer_frame}function wake(){clockNow=(clockLast=clock.now())+clockSkew,timer_frame=timeout=0;try{timerFlush()}finally{timer_frame=0,nap(),clockNow=0}}function poke(){var t=clock.now(),e=t-clockLast;e>pokeDelay&&(clockSkew-=e,clockLast=t)}function nap(){for(var t,e,i=taskHead,r=1/0;i;)i._call?(r>i._time&&(r=i._time),t=i,i=i._next):(e=i._next,i._next=null,i=t?t._next=e:taskHead=e);taskTail=t,sleep(r)}function sleep(t){timer_frame||(timeout&&(timeout=clearTimeout(timeout)),t-clockNow>24?(t<1/0&&(timeout=setTimeout(wake,t-clock.now()-clockSkew)),interval&&(interval=clearInterval(interval))):(interval||(clockLast=clock.now(),interval=setInterval(poke,pokeDelay)),timer_frame=1,setFrame(wake)))}function src_timeout(t,e,i){var r=new Timer;return e=null==e?0:+e,r.restart((i=>{r.stop(),t(i+e)}),e,i),r}Timer.prototype=timer.prototype={constructor:Timer,restart:function(t,e,i){if("function"!=typeof t)throw new TypeError("callback is not a function");i=(null==i?timer_now():+i)+(null==e?0:+e),this._next||taskTail===this||(taskTail?taskTail._next=this:taskHead=this,taskTail=this),this._call=t,this._time=i,sleep()},stop:function(){this._call&&(this._call=null,this._time=1/0,sleep())}};var emptyOn=src_dispatch("start","end","cancel","interrupt"),emptyTween=[],CREATED=0,SCHEDULED=1,STARTING=2,STARTED=3,RUNNING=4,ENDING=5,ENDED=6;function schedule(t,e,i,r,n,s){var o=t.__transition;if(o){if(i in o)return}else t.__transition={};create(t,i,{name:e,index:r,group:n,on:emptyOn,tween:emptyTween,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:CREATED})}function schedule_init(t,e){var i=schedule_get(t,e);if(i.state>CREATED)throw new Error("too late; already scheduled");return i}function schedule_set(t,e){var i=schedule_get(t,e);if(i.state>STARTED)throw new Error("too late; already running");return i}function schedule_get(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function create(t,e,i){var r,n=t.__transition;function s(l){var c,h,u,d;if(i.state!==SCHEDULED)return a();for(c in n)if((d=n[c]).name===i.name){if(d.state===STARTED)return src_timeout(s);d.state===RUNNING?(d.state=ENDED,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete n[c]):+c<e&&(d.state=ENDED,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete n[c])}if(src_timeout((function(){i.state===STARTED&&(i.state=RUNNING,i.timer.restart(o,i.delay,i.time),o(l))})),i.state=STARTING,i.on.call("start",t,t.__data__,i.index,i.group),i.state===STARTING){for(i.state=STARTED,r=new Array(u=i.tween.length),c=0,h=-1;c<u;++c)(d=i.tween[c].value.call(t,t.__data__,i.index,i.group))&&(r[++h]=d);r.length=h+1}}function o(e){for(var n=e<i.duration?i.ease.call(null,e/i.duration):(i.timer.restart(a),i.state=ENDING,1),s=-1,o=r.length;++s<o;)r[s].call(t,n);i.state===ENDING&&(i.on.call("end",t,t.__data__,i.index,i.group),a())}function a(){for(var r in i.state=ENDED,i.timer.stop(),delete n[e],n)return;delete t.__transition}n[e]=i,i.timer=timer((function(t){i.state=SCHEDULED,i.timer.restart(s,i.delay,i.time),i.delay<=t&&s(t-i.delay)}),0,i.time)}function src_interrupt(t,e){var i,r,n,s=t.__transition,o=!0;if(s){for(n in e=null==e?null:e+"",s)(i=s[n]).name===e?(r=i.state>STARTING&&i.state<ENDING,i.state=ENDED,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete s[n]):o=!1;o&&delete t.__transition}}function selection_interrupt(t){return this.each((function(){src_interrupt(this,t)}))}function src_number(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}var degrees=180/Math.PI,decompose_identity={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},svgNode;function decompose(t,e,i,r,n,s){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*i+e*r)&&(i-=t*l,r-=e*l),(a=Math.sqrt(i*i+r*r))&&(i/=a,r/=a,l/=a),t*r<e*i&&(t=-t,e=-e,l=-l,o=-o),{translateX:n,translateY:s,rotate:Math.atan2(e,t)*degrees,skewX:Math.atan(l)*degrees,scaleX:o,scaleY:a}}function parseCss(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?decompose_identity:decompose(e.a,e.b,e.c,e.d,e.e,e.f)}function parseSvg(t){return null==t?decompose_identity:(svgNode||(svgNode=document.createElementNS("http://www.w3.org/2000/svg","g")),svgNode.setAttribute("transform",t),(t=svgNode.transform.baseVal.consolidate())?decompose((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):decompose_identity)}function interpolateTransform(t,e,i,r){function n(t){return t.length?t.pop()+" ":""}return function(s,o){var a=[],l=[];return s=t(s),o=t(o),function(t,r,n,s,o,a){if(t!==n||r!==s){var l=o.push("translate(",null,e,null,i);a.push({i:l-4,x:src_number(t,n)},{i:l-2,x:src_number(r,s)})}else(n||s)&&o.push("translate("+n+e+s+i)}(s.translateX,s.translateY,o.translateX,o.translateY,a,l),function(t,e,i,s){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),s.push({i:i.push(n(i)+"rotate(",null,r)-2,x:src_number(t,e)})):e&&i.push(n(i)+"rotate("+e+r)}(s.rotate,o.rotate,a,l),function(t,e,i,s){t!==e?s.push({i:i.push(n(i)+"skewX(",null,r)-2,x:src_number(t,e)}):e&&i.push(n(i)+"skewX("+e+r)}(s.skewX,o.skewX,a,l),function(t,e,i,r,s,o){if(t!==i||e!==r){var a=s.push(n(s)+"scale(",null,",",null,")");o.push({i:a-4,x:src_number(t,i)},{i:a-2,x:src_number(e,r)})}else 1===i&&1===r||s.push(n(s)+"scale("+i+","+r+")")}(s.scaleX,s.scaleY,o.scaleX,o.scaleY,a,l),s=o=null,function(t){for(var e,i=-1,r=l.length;++i<r;)a[(e=l[i]).i]=e.x(t);return a.join("")}}}var interpolateTransformCss=interpolateTransform(parseCss,"px, ","px)","deg)"),interpolateTransformSvg=interpolateTransform(parseSvg,", ",")",")");function tweenRemove(t,e){var i,r;return function(){var n=schedule_set(this,t),s=n.tween;if(s!==i)for(var o=0,a=(r=i=s).length;o<a;++o)if(r[o].name===e){(r=r.slice()).splice(o,1);break}n.tween=r}}function tweenFunction(t,e,i){var r,n;if("function"!=typeof i)throw new Error;return function(){var s=schedule_set(this,t),o=s.tween;if(o!==r){n=(r=o).slice();for(var a={name:e,value:i},l=0,c=n.length;l<c;++l)if(n[l].name===e){n[l]=a;break}l===c&&n.push(a)}s.tween=n}}function tween(t,e){var i=this._id;if(t+="",arguments.length<2){for(var r,n=schedule_get(this.node(),i).tween,s=0,o=n.length;s<o;++s)if((r=n[s]).name===t)return r.value;return null}return this.each((null==e?tweenRemove:tweenFunction)(i,t,e))}function tweenValue(t,e,i){var r=t._id;return t.each((function(){var t=schedule_set(this,r);(t.value||(t.value={}))[e]=i.apply(this,arguments)})),function(t){return schedule_get(t,r).value[e]}}function src_define(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function extend(t,e){var i=Object.create(t.prototype);for(var r in e)i[r]=e[r];return i}function color_Color(){}var darker=.7,brighter=1/darker,reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex=/^#([0-9a-f]{3,8})$/,reRgbInteger=new RegExp(`^rgb\\(${reI},${reI},${reI}\\)$`),reRgbPercent=new RegExp(`^rgb\\(${reP},${reP},${reP}\\)$`),reRgbaInteger=new RegExp(`^rgba\\(${reI},${reI},${reI},${reN}\\)$`),reRgbaPercent=new RegExp(`^rgba\\(${reP},${reP},${reP},${reN}\\)$`),reHslPercent=new RegExp(`^hsl\\(${reN},${reP},${reP}\\)$`),reHslaPercent=new RegExp(`^hsla\\(${reN},${reP},${reP},${reN}\\)$`),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function color_formatHex(){return this.rgb().formatHex()}function color_formatHex8(){return this.rgb().formatHex8()}function color_formatHsl(){return hslConvert(this).formatHsl()}function color_formatRgb(){return this.rgb().formatRgb()}function color_color(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=reHex.exec(t))?(i=e[1].length,e=parseInt(e[1],16),6===i?rgbn(e):3===i?new Rgb(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===i?rgba(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===i?rgba(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=reRgbInteger.exec(t))?new Rgb(e[1],e[2],e[3],1):(e=reRgbPercent.exec(t))?new Rgb(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=reRgbaInteger.exec(t))?rgba(e[1],e[2],e[3],e[4]):(e=reRgbaPercent.exec(t))?rgba(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=reHslPercent.exec(t))?hsla(e[1],e[2]/100,e[3]/100,1):(e=reHslaPercent.exec(t))?hsla(e[1],e[2]/100,e[3]/100,e[4]):named.hasOwnProperty(t)?rgbn(named[t]):"transparent"===t?new Rgb(NaN,NaN,NaN,0):null}function rgbn(t){return new Rgb(t>>16&255,t>>8&255,255&t,1)}function rgba(t,e,i,r){return r<=0&&(t=e=i=NaN),new Rgb(t,e,i,r)}function rgbConvert(t){return t instanceof color_Color||(t=color_color(t)),t?new Rgb((t=t.rgb()).r,t.g,t.b,t.opacity):new Rgb}function color_rgb(t,e,i,r){return 1===arguments.length?rgbConvert(t):new Rgb(t,e,i,null==r?1:r)}function Rgb(t,e,i,r){this.r=+t,this.g=+e,this.b=+i,this.opacity=+r}function rgb_formatHex(){return`#${hex(this.r)}${hex(this.g)}${hex(this.b)}`}function rgb_formatHex8(){return`#${hex(this.r)}${hex(this.g)}${hex(this.b)}${hex(255*(isNaN(this.opacity)?1:this.opacity))}`}function rgb_formatRgb(){const t=clampa(this.opacity);return`${1===t?"rgb(":"rgba("}${clampi(this.r)}, ${clampi(this.g)}, ${clampi(this.b)}${1===t?")":`, ${t})`}`}function clampa(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function clampi(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function hex(t){return((t=clampi(t))<16?"0":"")+t.toString(16)}function hsla(t,e,i,r){return r<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new Hsl(t,e,i,r)}function hslConvert(t){if(t instanceof Hsl)return new Hsl(t.h,t.s,t.l,t.opacity);if(t instanceof color_Color||(t=color_color(t)),!t)return new Hsl;if(t instanceof Hsl)return t;var e=(t=t.rgb()).r/255,i=t.g/255,r=t.b/255,n=Math.min(e,i,r),s=Math.max(e,i,r),o=NaN,a=s-n,l=(s+n)/2;return a?(o=e===s?(i-r)/a+6*(i<r):i===s?(r-e)/a+2:(e-i)/a+4,a/=l<.5?s+n:2-s-n,o*=60):a=l>0&&l<1?0:o,new Hsl(o,a,l,t.opacity)}function hsl(t,e,i,r){return 1===arguments.length?hslConvert(t):new Hsl(t,e,i,null==r?1:r)}function Hsl(t,e,i,r){this.h=+t,this.s=+e,this.l=+i,this.opacity=+r}function clamph(t){return(t=(t||0)%360)<0?t+360:t}function clampt(t){return Math.max(0,Math.min(1,t||0))}function hsl2rgb(t,e,i){return 255*(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)}function basis(t,e,i,r,n){var s=t*t,o=s*t;return((1-3*t+3*s-o)*e+(4-6*s+3*o)*i+(1+3*t+3*s-3*o)*r+o*n)/6}function src_basis(t){var e=t.length-1;return function(i){var r=i<=0?i=0:i>=1?(i=1,e-1):Math.floor(i*e),n=t[r],s=t[r+1],o=r>0?t[r-1]:2*n-s,a=r<e-1?t[r+2]:2*s-n;return basis((i-r/e)*e,o,n,s,a)}}function basisClosed(t){var e=t.length;return function(i){var r=Math.floor(((i%=1)<0?++i:i)*e),n=t[(r+e-1)%e],s=t[r%e],o=t[(r+1)%e],a=t[(r+2)%e];return basis((i-r/e)*e,n,s,o,a)}}src_define(color_Color,color_color,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:color_formatHex,formatHex:color_formatHex,formatHex8:color_formatHex8,formatHsl:color_formatHsl,formatRgb:color_formatRgb,toString:color_formatRgb}),src_define(Rgb,color_rgb,extend(color_Color,{brighter(t){return t=null==t?brighter:Math.pow(brighter,t),new Rgb(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?darker:Math.pow(darker,t),new Rgb(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Rgb(clampi(this.r),clampi(this.g),clampi(this.b),clampa(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rgb_formatHex,formatHex:rgb_formatHex,formatHex8:rgb_formatHex8,formatRgb:rgb_formatRgb,toString:rgb_formatRgb})),src_define(Hsl,hsl,extend(color_Color,{brighter(t){return t=null==t?brighter:Math.pow(brighter,t),new Hsl(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?darker:Math.pow(darker,t),new Hsl(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,r=i+(i<.5?i:1-i)*e,n=2*i-r;return new Rgb(hsl2rgb(t>=240?t-240:t+120,n,r),hsl2rgb(t,n,r),hsl2rgb(t<120?t+240:t-120,n,r),this.opacity)},clamp(){return new Hsl(clamph(this.h),clampt(this.s),clampt(this.l),clampa(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=clampa(this.opacity);return`${1===t?"hsl(":"hsla("}${clamph(this.h)}, ${100*clampt(this.s)}%, ${100*clampt(this.l)}%${1===t?")":`, ${t})`}`}}));const d3_interpolate_src_constant=t=>()=>t;function linear(t,e){return function(i){return t+i*e}}function exponential(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(r){return Math.pow(t+r*e,i)}}function hue(t,e){var i=e-t;return i?linear(t,i>180||i<-180?i-360*Math.round(i/360):i):constant(isNaN(t)?e:t)}function gamma(t){return 1===(t=+t)?nogamma:function(e,i){return i-e?exponential(e,i,t):d3_interpolate_src_constant(isNaN(e)?i:e)}}function nogamma(t,e){var i=e-t;return i?linear(t,i):d3_interpolate_src_constant(isNaN(t)?e:t)}const rgb=function t(e){var i=gamma(e);function r(t,e){var r=i((t=color_rgb(t)).r,(e=color_rgb(e)).r),n=i(t.g,e.g),s=i(t.b,e.b),o=nogamma(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=n(e),t.b=s(e),t.opacity=o(e),t+""}}return r.gamma=t,r}(1);function rgbSpline(t){return function(e){var i,r,n=e.length,s=new Array(n),o=new Array(n),a=new Array(n);for(i=0;i<n;++i)r=color_rgb(e[i]),s[i]=r.r||0,o[i]=r.g||0,a[i]=r.b||0;return s=t(s),o=t(o),a=t(a),r.opacity=1,function(t){return r.r=s(t),r.g=o(t),r.b=a(t),r+""}}}var rgbBasis=rgbSpline(src_basis),rgbBasisClosed=rgbSpline(basisClosed),reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");function zero(t){return function(){return t}}function one(t){return function(e){return t(e)+""}}function string(t,e){var i,r,n,s=reA.lastIndex=reB.lastIndex=0,o=-1,a=[],l=[];for(t+="",e+="";(i=reA.exec(t))&&(r=reB.exec(e));)(n=r.index)>s&&(n=e.slice(s,n),a[o]?a[o]+=n:a[++o]=n),(i=i[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:src_number(i,r)})),s=reB.lastIndex;return s<e.length&&(n=e.slice(s),a[o]?a[o]+=n:a[++o]=n),a.length<2?l[0]?one(l[0].x):zero(e):(e=l.length,function(t){for(var i,r=0;r<e;++r)a[(i=l[r]).i]=i.x(t);return a.join("")})}function transition_interpolate(t,e){var i;return("number"==typeof e?src_number:e instanceof color_color?rgb:(i=color_color(e))?(e=i,rgb):string)(t,e)}function attr_attrRemove(t){return function(){this.removeAttribute(t)}}function attr_attrRemoveNS(t){return function(){this.removeAttributeNS(t.space,t.local)}}function attr_attrConstant(t,e,i){var r,n,s=i+"";return function(){var o=this.getAttribute(t);return o===s?null:o===r?n:n=e(r=o,i)}}function attr_attrConstantNS(t,e,i){var r,n,s=i+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===s?null:o===r?n:n=e(r=o,i)}}function attr_attrFunction(t,e,i){var r,n,s;return function(){var o,a,l=i(this);if(null!=l)return(o=this.getAttribute(t))===(a=l+"")?null:o===r&&a===n?s:(n=a,s=e(r=o,l));this.removeAttribute(t)}}function attr_attrFunctionNS(t,e,i){var r,n,s;return function(){var o,a,l=i(this);if(null!=l)return(o=this.getAttributeNS(t.space,t.local))===(a=l+"")?null:o===r&&a===n?s:(n=a,s=e(r=o,l));this.removeAttributeNS(t.space,t.local)}}function transition_attr(t,e){var i=namespace(t),r="transform"===i?interpolateTransformSvg:transition_interpolate;return this.attrTween(t,"function"==typeof e?(i.local?attr_attrFunctionNS:attr_attrFunction)(i,r,tweenValue(this,"attr."+t,e)):null==e?(i.local?attr_attrRemoveNS:attr_attrRemove)(i):(i.local?attr_attrConstantNS:attr_attrConstant)(i,r,e))}function attrInterpolate(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}function attrInterpolateNS(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}function attrTweenNS(t,e){var i,r;function n(){var n=e.apply(this,arguments);return n!==r&&(i=(r=n)&&attrInterpolateNS(t,n)),i}return n._value=e,n}function attrTween(t,e){var i,r;function n(){var n=e.apply(this,arguments);return n!==r&&(i=(r=n)&&attrInterpolate(t,n)),i}return n._value=e,n}function transition_attrTween(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;var r=namespace(t);return this.tween(i,(r.local?attrTweenNS:attrTween)(r,e))}function delayFunction(t,e){return function(){schedule_init(this,t).delay=+e.apply(this,arguments)}}function delayConstant(t,e){return e=+e,function(){schedule_init(this,t).delay=e}}function delay(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?delayFunction:delayConstant)(e,t)):schedule_get(this.node(),e).delay}function durationFunction(t,e){return function(){schedule_set(this,t).duration=+e.apply(this,arguments)}}function durationConstant(t,e){return e=+e,function(){schedule_set(this,t).duration=e}}function duration(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?durationFunction:durationConstant)(e,t)):schedule_get(this.node(),e).duration}function easeConstant(t,e){if("function"!=typeof e)throw new Error;return function(){schedule_set(this,t).ease=e}}function ease(t){var e=this._id;return arguments.length?this.each(easeConstant(e,t)):schedule_get(this.node(),e).ease}function easeVarying(t,e){return function(){var i=e.apply(this,arguments);if("function"!=typeof i)throw new Error;schedule_set(this,t).ease=i}}function transition_easeVarying(t){if("function"!=typeof t)throw new Error;return this.each(easeVarying(this._id,t))}function transition_filter(t){"function"!=typeof t&&(t=matcher(t));for(var e=this._groups,i=e.length,r=new Array(i),n=0;n<i;++n)for(var s,o=e[n],a=o.length,l=r[n]=[],c=0;c<a;++c)(s=o[c])&&t.call(s,s.__data__,c,o)&&l.push(s);return new Transition(r,this._parents,this._name,this._id)}function transition_merge(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,r=e.length,n=i.length,s=Math.min(r,n),o=new Array(r),a=0;a<s;++a)for(var l,c=e[a],h=i[a],u=c.length,d=o[a]=new Array(u),p=0;p<u;++p)(l=c[p]||h[p])&&(d[p]=l);for(;a<r;++a)o[a]=e[a];return new Transition(o,this._parents,this._name,this._id)}function start(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}function onFunction(t,e,i){var r,n,s=start(e)?schedule_init:schedule_set;return function(){var o=s(this,t),a=o.on;a!==r&&(n=(r=a).copy()).on(e,i),o.on=n}}function transition_on(t,e){var i=this._id;return arguments.length<2?schedule_get(this.node(),i).on.on(t):this.each(onFunction(i,t,e))}function removeFunction(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}function transition_remove(){return this.on("end.remove",removeFunction(this._id))}function transition_select(t){var e=this._name,i=this._id;"function"!=typeof t&&(t=selector(t));for(var r=this._groups,n=r.length,s=new Array(n),o=0;o<n;++o)for(var a,l,c=r[o],h=c.length,u=s[o]=new Array(h),d=0;d<h;++d)(a=c[d])&&(l=t.call(a,a.__data__,d,c))&&("__data__"in a&&(l.__data__=a.__data__),u[d]=l,schedule(u[d],e,i,d,u,schedule_get(a,i)));return new Transition(s,this._parents,e,i)}function transition_selectAll(t){var e=this._name,i=this._id;"function"!=typeof t&&(t=selectorAll(t));for(var r=this._groups,n=r.length,s=[],o=[],a=0;a<n;++a)for(var l,c=r[a],h=c.length,u=0;u<h;++u)if(l=c[u]){for(var d,p=t.call(l,l.__data__,u,c),f=schedule_get(l,i),m=0,g=p.length;m<g;++m)(d=p[m])&&schedule(d,e,i,m,p,f);s.push(p),o.push(l)}return new Transition(s,o,e,i)}var selection_Selection=src_selection.prototype.constructor;function transition_selection(){return new selection_Selection(this._groups,this._parents)}function styleNull(t,e){var i,r,n;return function(){var s=styleValue(this,t),o=(this.style.removeProperty(t),styleValue(this,t));return s===o?null:s===i&&o===r?n:n=e(i=s,r=o)}}function style_styleRemove(t){return function(){this.style.removeProperty(t)}}function style_styleConstant(t,e,i){var r,n,s=i+"";return function(){var o=styleValue(this,t);return o===s?null:o===r?n:n=e(r=o,i)}}function style_styleFunction(t,e,i){var r,n,s;return function(){var o=styleValue(this,t),a=i(this),l=a+"";return null==a&&(this.style.removeProperty(t),l=a=styleValue(this,t)),o===l?null:o===r&&l===n?s:(n=l,s=e(r=o,a))}}function styleMaybeRemove(t,e){var i,r,n,s,o="style."+e,a="end."+o;return function(){var l=schedule_set(this,t),c=l.on,h=null==l.value[o]?s||(s=style_styleRemove(e)):void 0;c===i&&n===h||(r=(i=c).copy()).on(a,n=h),l.on=r}}function transition_style(t,e,i){var r="transform"==(t+="")?interpolateTransformCss:transition_interpolate;return null==e?this.styleTween(t,styleNull(t,r)).on("end.style."+t,style_styleRemove(t)):"function"==typeof e?this.styleTween(t,style_styleFunction(t,r,tweenValue(this,"style."+t,e))).each(styleMaybeRemove(this._id,t)):this.styleTween(t,style_styleConstant(t,r,e),i).on("end.style."+t,null)}function styleInterpolate(t,e,i){return function(r){this.style.setProperty(t,e.call(this,r),i)}}function styleTween(t,e,i){var r,n;function s(){var s=e.apply(this,arguments);return s!==n&&(r=(n=s)&&styleInterpolate(t,s,i)),r}return s._value=e,s}function transition_styleTween(t,e,i){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,styleTween(t,e,null==i?"":i))}function text_textConstant(t){return function(){this.textContent=t}}function text_textFunction(t){return function(){var e=t(this);this.textContent=null==e?"":e}}function transition_text(t){return this.tween("text","function"==typeof t?text_textFunction(tweenValue(this,"text",t)):text_textConstant(null==t?"":t+""))}function textInterpolate(t){return function(e){this.textContent=t.call(this,e)}}function textTween(t){var e,i;function r(){var r=t.apply(this,arguments);return r!==i&&(e=(i=r)&&textInterpolate(r)),e}return r._value=t,r}function transition_textTween(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,textTween(t))}function transition(){for(var t=this._name,e=this._id,i=newId(),r=this._groups,n=r.length,s=0;s<n;++s)for(var o,a=r[s],l=a.length,c=0;c<l;++c)if(o=a[c]){var h=schedule_get(o,e);schedule(o,t,i,c,a,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new Transition(r,this._parents,t,i)}function end(){var t,e,i=this,r=i._id,n=i.size();return new Promise((function(s,o){var a={value:o},l={value:function(){0===--n&&s()}};i.each((function(){var i=schedule_set(this,r),n=i.on;n!==t&&((e=(t=n).copy())._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),i.on=e})),0===n&&s()}))}var id=0;function Transition(t,e,i,r){this._groups=t,this._parents=e,this._name=i,this._id=r}function transition_transition(t){return src_selection().transition(t)}function newId(){return++id}var selection_prototype=src_selection.prototype;function cubicIn(t){return t*t*t}function cubicOut(t){return--t*t*t+1}function cubicInOut(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}Transition.prototype=transition_transition.prototype={constructor:Transition,select:transition_select,selectAll:transition_selectAll,selectChild:selection_prototype.selectChild,selectChildren:selection_prototype.selectChildren,filter:transition_filter,merge:transition_merge,selection:transition_selection,transition,call:selection_prototype.call,nodes:selection_prototype.nodes,node:selection_prototype.node,size:selection_prototype.size,empty:selection_prototype.empty,each:selection_prototype.each,on:transition_on,attr:transition_attr,attrTween:transition_attrTween,style:transition_style,styleTween:transition_styleTween,text:transition_text,textTween:transition_textTween,remove:transition_remove,tween,delay,duration,ease,easeVarying:transition_easeVarying,end,[Symbol.iterator]:selection_prototype[Symbol.iterator]};var defaultTiming={time:null,delay:0,duration:250,ease:cubicInOut};function inherit(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return i}function selection_transition(t){var e,i;t instanceof Transition?(e=t._id,t=t._name):(e=newId(),(i=defaultTiming).time=timer_now(),t=null==t?null:t+"");for(var r=this._groups,n=r.length,s=0;s<n;++s)for(var o,a=r[s],l=a.length,c=0;c<l;++c)(o=a[c])&&schedule(o,t,e,c,a,i||inherit(o,e));return new Transition(r,this._parents,t,e)}src_selection.prototype.interrupt=selection_interrupt,src_selection.prototype.transition=selection_transition;var MODE_DRAG={name:"drag"},MODE_SPACE={name:"space"},MODE_HANDLE={name:"handle"},MODE_CENTER={name:"center"};const{abs,max:brush_max,min:brush_min}=Math;function number1(t){return[+t[0],+t[1]]}function number2(t){return[number1(t[0]),number1(t[1])]}var X={name:"x",handles:["w","e"].map(type),input:function(t,e){return null==t?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},Y={name:"y",handles:["n","s"].map(type),input:function(t,e){return null==t?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},XY={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(type),input:function(t){return null==t?null:number2(t)},output:function(t){return t}},cursors={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},flipX={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},flipY={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},signsX={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},signsY={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function type(t){return{type:t}}function defaultFilter(t){return!t.ctrlKey&&!t.button}function defaultExtent(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function defaultTouchable(){return navigator.maxTouchPoints||"ontouchstart"in this}function local(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function brush_empty(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function brushSelection(t){var e=t.__brush;return e?e.dim.output(e.selection):null}function brushX(){return brush_brush(X)}function brushY(){return brush_brush(Y)}function brush(){return brush_brush(XY)}function brush_brush(t){var e,i=defaultExtent,r=defaultFilter,n=defaultTouchable,s=!0,o=dispatch("start","brush","end"),a=6;function l(e){var i=e.property("__brush",m).selectAll(".overlay").data([type("overlay")]);i.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",cursors.overlay).merge(i).each((function(){var t=local(this).extent;select(this).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1])})),e.selectAll(".selection").data([type("selection")]).enter().append("rect").attr("class","selection").attr("cursor",cursors.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var r=e.selectAll(".handle").data(t.handles,(function(t){return t.type}));r.exit().remove(),r.enter().append("rect").attr("class",(function(t){return"handle handle--"+t.type})).attr("cursor",(function(t){return cursors[t.type]})),e.each(c).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",d).filter(n).on("touchstart.brush",d).on("touchmove.brush",p).on("touchend.brush touchcancel.brush",f).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function c(){var t=select(this),e=local(this).selection;e?(t.selectAll(".selection").style("display",null).attr("x",e[0][0]).attr("y",e[0][1]).attr("width",e[1][0]-e[0][0]).attr("height",e[1][1]-e[0][1]),t.selectAll(".handle").style("display",null).attr("x",(function(t){return"e"===t.type[t.type.length-1]?e[1][0]-a/2:e[0][0]-a/2})).attr("y",(function(t){return"s"===t.type[0]?e[1][1]-a/2:e[0][1]-a/2})).attr("width",(function(t){return"n"===t.type||"s"===t.type?e[1][0]-e[0][0]+a:a})).attr("height",(function(t){return"e"===t.type||"w"===t.type?e[1][1]-e[0][1]+a:a}))):t.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function h(t,e,i){var r=t.__brush.emitter;return!r||i&&r.clean?new u(t,e,i):r}function u(t,e,i){this.that=t,this.args=e,this.state=t.__brush,this.active=0,this.clean=i}function d(i){if((!e||i.touches)&&r.apply(this,arguments)){var n,o,a,l,u,d,p,f,m,g,_,v=this,y=i.target.__data__.type,b="selection"===(s&&i.metaKey?y="overlay":y)?MODE_DRAG:s&&i.altKey?MODE_CENTER:MODE_HANDLE,A=t===Y?null:signsX[y],x=t===X?null:signsY[y],C=local(v),E=C.extent,M=C.selection,S=E[0][0],w=E[0][1],P=E[1][0],T=E[1][1],O=0,R=0,N=A&&x&&s&&i.shiftKey,L=Array.from(i.touches||[i],(t=>{const e=t.identifier;return(t=pointer(t,v)).point0=t.slice(),t.identifier=e,t}));interrupt(v);var D=h(v,arguments,!0).beforestart();if("overlay"===y){M&&(m=!0);const e=[L[0],L[1]||L[0]];C.selection=M=[[n=t===Y?S:brush_min(e[0][0],e[1][0]),a=t===X?w:brush_min(e[0][1],e[1][1])],[u=t===Y?P:brush_max(e[0][0],e[1][0]),p=t===X?T:brush_max(e[0][1],e[1][1])]],L.length>1&&F(i)}else n=M[0][0],a=M[0][1],u=M[1][0],p=M[1][1];o=n,l=a,d=u,f=p;var k=select(v).attr("pointer-events","none"),I=k.selectAll(".overlay").attr("cursor",cursors[y]);if(i.touches)D.moved=U,D.ended=j;else{var B=select(i.view).on("mousemove.brush",U,!0).on("mouseup.brush",j,!0);s&&B.on("keydown.brush",(function(t){switch(t.keyCode){case 16:N=A&&x;break;case 18:b===MODE_HANDLE&&(A&&(u=d-O*A,n=o+O*A),x&&(p=f-R*x,a=l+R*x),b=MODE_CENTER,F(t));break;case 32:b!==MODE_HANDLE&&b!==MODE_CENTER||(A<0?u=d-O:A>0&&(n=o-O),x<0?p=f-R:x>0&&(a=l-R),b=MODE_SPACE,I.attr("cursor",cursors.selection),F(t));break;default:return}noevent(t)}),!0).on("keyup.brush",(function(t){switch(t.keyCode){case 16:N&&(g=_=N=!1,F(t));break;case 18:b===MODE_CENTER&&(A<0?u=d:A>0&&(n=o),x<0?p=f:x>0&&(a=l),b=MODE_HANDLE,F(t));break;case 32:b===MODE_SPACE&&(t.altKey?(A&&(u=d-O*A,n=o+O*A),x&&(p=f-R*x,a=l+R*x),b=MODE_CENTER):(A<0?u=d:A>0&&(n=o),x<0?p=f:x>0&&(a=l),b=MODE_HANDLE),I.attr("cursor",cursors[y]),F(t));break;default:return}noevent(t)}),!0),dragDisable(i.view)}c.call(v),D.start(i,b.name)}function U(t){for(const e of t.changedTouches||[t])for(const t of L)t.identifier===e.identifier&&(t.cur=pointer(e,v));if(N&&!g&&!_&&1===L.length){const t=L[0];abs(t.cur[0]-t[0])>abs(t.cur[1]-t[1])?_=!0:g=!0}for(const t of L)t.cur&&(t[0]=t.cur[0],t[1]=t.cur[1]);m=!0,noevent(t),F(t)}function F(t){const e=L[0],i=e.point0;var r;switch(O=e[0]-i[0],R=e[1]-i[1],b){case MODE_SPACE:case MODE_DRAG:A&&(O=brush_max(S-n,brush_min(P-u,O)),o=n+O,d=u+O),x&&(R=brush_max(w-a,brush_min(T-p,R)),l=a+R,f=p+R);break;case MODE_HANDLE:L[1]?(A&&(o=brush_max(S,brush_min(P,L[0][0])),d=brush_max(S,brush_min(P,L[1][0])),A=1),x&&(l=brush_max(w,brush_min(T,L[0][1])),f=brush_max(w,brush_min(T,L[1][1])),x=1)):(A<0?(O=brush_max(S-n,brush_min(P-n,O)),o=n+O,d=u):A>0&&(O=brush_max(S-u,brush_min(P-u,O)),o=n,d=u+O),x<0?(R=brush_max(w-a,brush_min(T-a,R)),l=a+R,f=p):x>0&&(R=brush_max(w-p,brush_min(T-p,R)),l=a,f=p+R));break;case MODE_CENTER:A&&(o=brush_max(S,brush_min(P,n-O*A)),d=brush_max(S,brush_min(P,u+O*A))),x&&(l=brush_max(w,brush_min(T,a-R*x)),f=brush_max(w,brush_min(T,p+R*x)))}d<o&&(A*=-1,r=n,n=u,u=r,r=o,o=d,d=r,y in flipX&&I.attr("cursor",cursors[y=flipX[y]])),f<l&&(x*=-1,r=a,a=p,p=r,r=l,l=f,f=r,y in flipY&&I.attr("cursor",cursors[y=flipY[y]])),C.selection&&(M=C.selection),g&&(o=M[0][0],d=M[1][0]),_&&(l=M[0][1],f=M[1][1]),M[0][0]===o&&M[0][1]===l&&M[1][0]===d&&M[1][1]===f||(C.selection=[[o,l],[d,f]],c.call(v),D.brush(t,b.name))}function j(t){if(nopropagation(t),t.touches){if(t.touches.length)return;e&&clearTimeout(e),e=setTimeout((function(){e=null}),500)}else dragEnable(t.view,m),B.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);k.attr("pointer-events","all"),I.attr("cursor",cursors.overlay),C.selection&&(M=C.selection),brush_empty(M)&&(C.selection=null,c.call(v)),D.end(t,b.name)}}function p(t){h(this,arguments).moved(t)}function f(t){h(this,arguments).ended(t)}function m(){var e=this.__brush||{selection:null};return e.extent=number2(i.apply(this,arguments)),e.dim=t,e}return l.move=function(e,i,r){e.tween?e.on("start.brush",(function(t){h(this,arguments).beforestart().start(t)})).on("interrupt.brush end.brush",(function(t){h(this,arguments).end(t)})).tween("brush",(function(){var e=this,r=e.__brush,n=h(e,arguments),s=r.selection,o=t.input("function"==typeof i?i.apply(this,arguments):i,r.extent),a=interpolate(s,o);function l(t){r.selection=1===t&&null===o?null:a(t),c.call(e),n.brush()}return null!==s&&null!==o?l:l(1)})):e.each((function(){var e=this,n=arguments,s=e.__brush,o=t.input("function"==typeof i?i.apply(e,n):i,s.extent),a=h(e,n).beforestart();interrupt(e),s.selection=null===o?null:o,c.call(e),a.start(r).brush(r).end(r)}))},l.clear=function(t,e){l.move(t,null,e)},u.prototype={beforestart:function(){return 1===++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(t,e){return this.starting?(this.starting=!1,this.emit("start",t,e)):this.emit("brush",t),this},brush:function(t,e){return this.emit("brush",t,e),this},end:function(t,e){return 0===--this.active&&(delete this.state.emitter,this.emit("end",t,e)),this},emit:function(e,i,r){var n=select(this.that).datum();o.call(e,this.that,new BrushEvent(e,{sourceEvent:i,target:l,selection:t.output(this.state.selection),mode:r,dispatch:o}),n)}},l.extent=function(t){return arguments.length?(i="function"==typeof t?t:constant(number2(t)),l):i},l.filter=function(t){return arguments.length?(r="function"==typeof t?t:constant(!!t),l):r},l.touchable=function(t){return arguments.length?(n="function"==typeof t?t:constant(!!t),l):n},l.handleSize=function(t){return arguments.length?(a=+t,l):a},l.keyModifiers=function(t){return arguments.length?(s=!!t,l):s},l.on=function(){var t=o.on.apply(o,arguments);return t===o?l:t},l}function range(t,e,i){t=+t,e=+e,i=(n=arguments.length)<2?(e=t,t=0,1):n<3?1:+i;for(var r=-1,n=0|Math.max(0,Math.ceil((e-t)/i)),s=new Array(n);++r<n;)s[r]=t+r*i;return s}function initRange(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function initInterpolator(t,e){switch(arguments.length){case 0:break;case 1:"function"==typeof t?this.interpolator(t):this.range(t);break;default:this.domain(t),"function"==typeof e?this.interpolator(e):this.range(e)}return this}class InternMap extends Map{constructor(t,e=keyof){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const[e,i]of t)this.set(e,i)}get(t){return super.get(intern_get(this,t))}has(t){return super.has(intern_get(this,t))}set(t,e){return super.set(intern_set(this,t),e)}delete(t){return super.delete(intern_delete(this,t))}}class InternSet extends Set{constructor(t,e=keyof){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const e of t)this.add(e)}has(t){return super.has(intern_get(this,t))}add(t){return super.add(intern_set(this,t))}delete(t){return super.delete(intern_delete(this,t))}}function intern_get({_intern:t,_key:e},i){const r=e(i);return t.has(r)?t.get(r):i}function intern_set({_intern:t,_key:e},i){const r=e(i);return t.has(r)?t.get(r):(t.set(r,i),i)}function intern_delete({_intern:t,_key:e},i){const r=e(i);return t.has(r)&&(i=t.get(r),t.delete(r)),i}function keyof(t){return null!==t&&"object"==typeof t?t.valueOf():t}const implicit=Symbol("implicit");function ordinal(){var t=new InternMap,e=[],i=[],r=implicit;function n(n){let s=t.get(n);if(void 0===s){if(r!==implicit)return r;t.set(n,s=e.push(n)-1)}return i[s%i.length]}return n.domain=function(i){if(!arguments.length)return e.slice();e=[],t=new InternMap;for(const r of i)t.has(r)||t.set(r,e.push(r)-1);return n},n.range=function(t){return arguments.length?(i=Array.from(t),n):i.slice()},n.unknown=function(t){return arguments.length?(r=t,n):r},n.copy=function(){return ordinal(e,i).unknown(r)},initRange.apply(n,arguments),n}function band(){var t,e,i=ordinal().unknown(void 0),r=i.domain,n=i.range,s=0,o=1,a=!1,l=0,c=0,h=.5;function u(){var i=r().length,u=o<s,d=u?o:s,p=u?s:o;t=(p-d)/Math.max(1,i-l+2*c),a&&(t=Math.floor(t)),d+=(p-d-t*(i-l))*h,e=t*(1-l),a&&(d=Math.round(d),e=Math.round(e));var f=range(i).map((function(e){return d+t*e}));return n(u?f.reverse():f)}return delete i.unknown,i.domain=function(t){return arguments.length?(r(t),u()):r()},i.range=function(t){return arguments.length?([s,o]=t,s=+s,o=+o,u()):[s,o]},i.rangeRound=function(t){return[s,o]=t,s=+s,o=+o,a=!0,u()},i.bandwidth=function(){return e},i.step=function(){return t},i.round=function(t){return arguments.length?(a=!!t,u()):a},i.padding=function(t){return arguments.length?(l=Math.min(1,c=+t),u()):l},i.paddingInner=function(t){return arguments.length?(l=Math.min(1,t),u()):l},i.paddingOuter=function(t){return arguments.length?(c=+t,u()):c},i.align=function(t){return arguments.length?(h=Math.max(0,Math.min(1,t)),u()):h},i.copy=function(){return band(r(),[s,o]).round(a).paddingInner(l).paddingOuter(c).align(h)},initRange.apply(u(),arguments)}function pointish(t){var e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return pointish(e())},t}function band_point(){return pointish(band.apply(null,arguments).paddingInner(1))}const e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function tickSpec(t,e,i){const r=(e-t)/Math.max(0,i),n=Math.floor(Math.log10(r)),s=r/Math.pow(10,n),o=s>=e10?10:s>=e5?5:s>=e2?2:1;let a,l,c;return n<0?(c=Math.pow(10,-n)/o,a=Math.round(t*c),l=Math.round(e*c),a/c<t&&++a,l/c>e&&--l,c=-c):(c=Math.pow(10,n)*o,a=Math.round(t/c),l=Math.round(e/c),a*c<t&&++a,l*c>e&&--l),l<a&&.5<=i&&i<2?tickSpec(t,e,2*i):[a,l,c]}function ticks_ticks(t,e,i){if(!((i=+i)>0))return[];if((t=+t)===(e=+e))return[t];const r=e<t,[n,s,o]=r?tickSpec(e,t,i):tickSpec(t,e,i);if(!(s>=n))return[];const a=s-n+1,l=new Array(a);if(r)if(o<0)for(let t=0;t<a;++t)l[t]=(s-t)/-o;else for(let t=0;t<a;++t)l[t]=(s-t)*o;else if(o<0)for(let t=0;t<a;++t)l[t]=(n+t)/-o;else for(let t=0;t<a;++t)l[t]=(n+t)*o;return l}function tickIncrement(t,e,i){return tickSpec(t=+t,e=+e,i=+i)[2]}function tickStep(t,e,i){i=+i;const r=(e=+e)<(t=+t),n=r?tickIncrement(e,t,i):tickIncrement(t,e,i);return(r?-1:1)*(n<0?1/-n:n)}function ascending_ascending(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function descending(t,e){return null==t||null==e?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function bisector(t){let e,i,r;function n(t,r,n=0,s=t.length){if(n<s){if(0!==e(r,r))return s;do{const e=n+s>>>1;i(t[e],r)<0?n=e+1:s=e}while(n<s)}return n}return 2!==t.length?(e=ascending_ascending,i=(e,i)=>ascending_ascending(t(e),i),r=(e,i)=>t(e)-i):(e=t===ascending_ascending||t===descending?t:bisector_zero,i=t,r=t),{left:n,center:function(t,e,i=0,s=t.length){const o=n(t,e,i,s-1);return o>i&&r(t[o-1],e)>-r(t[o],e)?o-1:o},right:function(t,r,n=0,s=t.length){if(n<s){if(0!==e(r,r))return s;do{const e=n+s>>>1;i(t[e],r)<=0?n=e+1:s=e}while(n<s)}return n}}}function bisector_zero(){return 0}function number_number(t){return null===t?NaN:+t}function*numbers(t,e){if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(yield e);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(r=+r)>=r&&(yield r)}}const ascendingBisect=bisector(ascending_ascending),bisectRight=ascendingBisect.right,bisectLeft=ascendingBisect.left,bisectCenter=bisector(number_number).center,bisect=bisectRight;function src_array(t,e){return(isNumberArray(e)?numberArray:genericArray)(t,e)}function genericArray(t,e){var i,r=e?e.length:0,n=t?Math.min(r,t.length):0,s=new Array(n),o=new Array(r);for(i=0;i<n;++i)s[i]=value(t[i],e[i]);for(;i<r;++i)o[i]=e[i];return function(t){for(i=0;i<n;++i)o[i]=s[i](t);return o}}function date(t,e){var i=new Date;return t=+t,e=+e,function(r){return i.setTime(t*(1-r)+e*r),i}}function object(t,e){var i,r={},n={};for(i in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)i in t?r[i]=value(t[i],e[i]):n[i]=e[i];return function(t){for(i in r)n[i]=r[i](t);return n}}function src_numberArray(t,e){e||(e=[]);var i,r=t?Math.min(e.length,t.length):0,n=e.slice();return function(s){for(i=0;i<r;++i)n[i]=t[i]*(1-s)+e[i]*s;return n}}function numberArray_isNumberArray(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function value(t,e){var i,r=typeof e;return null==e||"boolean"===r?d3_interpolate_src_constant(e):("number"===r?src_number:"string"===r?(i=color_color(e))?(e=i,rgb):string:e instanceof color_color?rgb:e instanceof Date?date:numberArray_isNumberArray(e)?src_numberArray:Array.isArray(e)?genericArray:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?object:src_number)(t,e)}function round(t,e){return t=+t,e=+e,function(i){return Math.round(t*(1-i)+e*i)}}function constant_constants(t){return function(){return t}}function src_number_number(t){return+t}var unit=[0,1];function continuous_identity(t){return t}function continuous_normalize(t,e){return(e-=t=+t)?function(i){return(i-t)/e}:constant_constants(isNaN(e)?NaN:.5)}function clamper(t,e){var i;return t>e&&(i=t,t=e,e=i),function(i){return Math.max(t,Math.min(e,i))}}function bimap(t,e,i){var r=t[0],n=t[1],s=e[0],o=e[1];return n<r?(r=continuous_normalize(n,r),s=i(o,s)):(r=continuous_normalize(r,n),s=i(s,o)),function(t){return s(r(t))}}function polymap(t,e,i){var r=Math.min(t.length,e.length)-1,n=new Array(r),s=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)n[o]=continuous_normalize(t[o],t[o+1]),s[o]=i(e[o],e[o+1]);return function(e){var i=bisect(t,e,1,r)-1;return s[i](n[i](e))}}function copy(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function transformer(){var t,e,i,r,n,s,o=unit,a=unit,l=value,c=continuous_identity;function h(){var t=Math.min(o.length,a.length);return c!==continuous_identity&&(c=clamper(o[0],o[t-1])),r=t>2?polymap:bimap,n=s=null,u}function u(e){return null==e||isNaN(e=+e)?i:(n||(n=r(o.map(t),a,l)))(t(c(e)))}return u.invert=function(i){return c(e((s||(s=r(a,o.map(t),src_number)))(i)))},u.domain=function(t){return arguments.length?(o=Array.from(t,src_number_number),h()):o.slice()},u.range=function(t){return arguments.length?(a=Array.from(t),h()):a.slice()},u.rangeRound=function(t){return a=Array.from(t),l=round,h()},u.clamp=function(t){return arguments.length?(c=!!t||continuous_identity,h()):c!==continuous_identity},u.interpolate=function(t){return arguments.length?(l=t,h()):l},u.unknown=function(t){return arguments.length?(i=t,u):i},function(i,r){return t=i,e=r,h()}}function continuous(){return transformer()(continuous_identity,continuous_identity)}var re=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i,prefixExponent;function formatSpecifier(t){if(!(e=re.exec(t)))throw new Error("invalid format: "+t);var e;return new FormatSpecifier({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function FormatSpecifier(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function formatDecimal(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function formatDecimalParts(t,e){if((i=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var i,r=t.slice(0,i);return[r.length>1?r[0]+r.slice(2):r,+t.slice(i+1)]}function exponent(t){return(t=formatDecimalParts(Math.abs(t)))?t[1]:NaN}function precisionPrefix(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(exponent(e)/3)))-exponent(Math.abs(t)))}function formatGroup(t,e){return function(i,r){for(var n=i.length,s=[],o=0,a=t[0],l=0;n>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),s.push(i.substring(n-=a,n+a)),!((l+=a+1)>r));)a=t[o=(o+1)%t.length];return s.reverse().join(e)}}function formatNumerals(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}function formatTrim(t){t:for(var e,i=t.length,r=1,n=-1;r<i;++r)switch(t[r]){case".":n=e=r;break;case"0":0===n&&(n=r),e=r;break;default:if(!+t[r])break t;n>0&&(n=0)}return n>0?t.slice(0,n)+t.slice(e+1):t}function formatPrefixAuto(t,e){var i=formatDecimalParts(t,e);if(!i)return t+"";var r=i[0],n=i[1],s=n-(prefixExponent=3*Math.max(-8,Math.min(8,Math.floor(n/3))))+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+formatDecimalParts(t,Math.max(0,e+s-1))[0]}function formatRounded(t,e){var i=formatDecimalParts(t,e);if(!i)return t+"";var r=i[0],n=i[1];return n<0?"0."+new Array(-n).join("0")+r:r.length>n+1?r.slice(0,n+1)+"."+r.slice(n+1):r+new Array(n-r.length+2).join("0")}formatSpecifier.prototype=FormatSpecifier.prototype,FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const formatTypes={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:formatDecimal,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>formatRounded(100*t,e),r:formatRounded,s:formatPrefixAuto,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function d3_format_src_identity(t){return t}var map=Array.prototype.map,prefixes=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"],defaultLocale_locale,format,formatPrefix;function locale(t){var e=void 0===t.grouping||void 0===t.thousands?d3_format_src_identity:formatGroup(map.call(t.grouping,Number),t.thousands+""),i=void 0===t.currency?"":t.currency[0]+"",r=void 0===t.currency?"":t.currency[1]+"",n=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?d3_format_src_identity:formatNumerals(map.call(t.numerals,String)),o=void 0===t.percent?"%":t.percent+"",a=void 0===t.minus?"":t.minus+"",l=void 0===t.nan?"NaN":t.nan+"";function c(t){var c=(t=formatSpecifier(t)).fill,h=t.align,u=t.sign,d=t.symbol,p=t.zero,f=t.width,m=t.comma,g=t.precision,_=t.trim,v=t.type;"n"===v?(m=!0,v="g"):formatTypes[v]||(void 0===g&&(g=12),_=!0,v="g"),(p||"0"===c&&"="===h)&&(p=!0,c="0",h="=");var y="$"===d?i:"#"===d&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",b="$"===d?r:/[%p]/.test(v)?o:"",A=formatTypes[v],x=/[defgprs%]/.test(v);function C(t){var i,r,o,d=y,C=b;if("c"===v)C=A(t)+C,t="";else{var E=(t=+t)<0||1/t<0;if(t=isNaN(t)?l:A(Math.abs(t),g),_&&(t=formatTrim(t)),E&&0===+t&&"+"!==u&&(E=!1),d=(E?"("===u?u:a:"-"===u||"("===u?"":u)+d,C=("s"===v?prefixes[8+prefixExponent/3]:"")+C+(E&&"("===u?")":""),x)for(i=-1,r=t.length;++i<r;)if(48>(o=t.charCodeAt(i))||o>57){C=(46===o?n+t.slice(i+1):t.slice(i))+C,t=t.slice(0,i);break}}m&&!p&&(t=e(t,1/0));var M=d.length+t.length+C.length,S=M<f?new Array(f-M+1).join(c):"";switch(m&&p&&(t=e(S+t,S.length?f-C.length:1/0),S=""),h){case"<":t=d+t+C+S;break;case"=":t=d+S+t+C;break;case"^":t=S.slice(0,M=S.length>>1)+d+t+C+S.slice(M);break;default:t=S+d+t+C}return s(t)}return g=void 0===g?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),C.toString=function(){return t+""},C}return{format:c,formatPrefix:function(t,e){var i=c(((t=formatSpecifier(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(exponent(e)/3))),n=Math.pow(10,-r),s=prefixes[8+r/3];return function(t){return i(n*t)+s}}}}function defaultLocale(t){return defaultLocale_locale=locale(t),format=defaultLocale_locale.format,formatPrefix=defaultLocale_locale.formatPrefix,defaultLocale_locale}function precisionRound(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,exponent(e)-exponent(t))+1}function precisionFixed(t){return Math.max(0,-exponent(Math.abs(t)))}function tickFormat(t,e,i,r){var n,s=tickStep(t,e,i);switch((r=formatSpecifier(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(n=precisionPrefix(s,o))||(r.precision=n),formatPrefix(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(n=precisionRound(s,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=n-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(n=precisionFixed(s))||(r.precision=n-2*("%"===r.type))}return format(r)}function linearish(t){var e=t.domain;return t.ticks=function(t){var i=e();return ticks_ticks(i[0],i[i.length-1],null==t?10:t)},t.tickFormat=function(t,i){var r=e();return tickFormat(r[0],r[r.length-1],null==t?10:t,i)},t.nice=function(i){null==i&&(i=10);var r,n,s=e(),o=0,a=s.length-1,l=s[o],c=s[a],h=10;for(c<l&&(n=l,l=c,c=n,n=o,o=a,a=n);h-- >0;){if((n=tickIncrement(l,c,i))===r)return s[o]=l,s[a]=c,e(s);if(n>0)l=Math.floor(l/n)*n,c=Math.ceil(c/n)*n;else{if(!(n<0))break;l=Math.ceil(l*n)/n,c=Math.floor(c*n)/n}r=n}return t},t}function linear_linear(){var t=continuous();return t.copy=function(){return copy(t,linear_linear())},initRange.apply(t,arguments),linearish(t)}function src_select(t){return"string"==typeof t?new Selection([[document.querySelector(t)]],[document.documentElement]):new Selection([[t]],root)}defaultLocale({thousands:",",grouping:[3],currency:["$",""]});var slice=Array.prototype.slice;function d3_shape_src_array(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function d3_shape_src_constant(t){return function(){return t}}function Linear(t){this._context=t}function curve_linear(t){return new Linear(t)}Linear.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};const pi=Math.PI,tau=2*pi,path_epsilon=1e-6,tauEpsilon=tau-path_epsilon;function path_append(t){this._+=t[0];for(let e=1,i=t.length;e<i;++e)this._+=arguments[e]+t[e]}function appendRound(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return path_append;const i=10**e;return function(t){this._+=t[0];for(let e=1,r=t.length;e<r;++e)this._+=Math.round(arguments[e]*i)/i+t[e]}}class path_Path{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?path_append:appendRound(t)}moveTo(t,e){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,e){this._append`L${this._x1=+t},${this._y1=+e}`}quadraticCurveTo(t,e,i,r){this._append`Q${+t},${+e},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(t,e,i,r,n,s){this._append`C${+t},${+e},${+i},${+r},${this._x1=+n},${this._y1=+s}`}arcTo(t,e,i,r,n){if(t=+t,e=+e,i=+i,r=+r,(n=+n)<0)throw new Error(`negative radius: ${n}`);let s=this._x1,o=this._y1,a=i-t,l=r-e,c=s-t,h=o-e,u=c*c+h*h;if(null===this._x1)this._append`M${this._x1=t},${this._y1=e}`;else if(u>path_epsilon)if(Math.abs(h*a-l*c)>path_epsilon&&n){let d=i-s,p=r-o,f=a*a+l*l,m=d*d+p*p,g=Math.sqrt(f),_=Math.sqrt(u),v=n*Math.tan((pi-Math.acos((f+u-m)/(2*g*_)))/2),y=v/_,b=v/g;Math.abs(y-1)>path_epsilon&&this._append`L${t+y*c},${e+y*h}`,this._append`A${n},${n},0,0,${+(h*d>c*p)},${this._x1=t+b*a},${this._y1=e+b*l}`}else this._append`L${this._x1=t},${this._y1=e}`}arc(t,e,i,r,n,s){if(t=+t,e=+e,s=!!s,(i=+i)<0)throw new Error(`negative radius: ${i}`);let o=i*Math.cos(r),a=i*Math.sin(r),l=t+o,c=e+a,h=1^s,u=s?r-n:n-r;null===this._x1?this._append`M${l},${c}`:(Math.abs(this._x1-l)>path_epsilon||Math.abs(this._y1-c)>path_epsilon)&&this._append`L${l},${c}`,i&&(u<0&&(u=u%tau+tau),u>tauEpsilon?this._append`A${i},${i},0,1,${h},${t-o},${e-a}A${i},${i},0,1,${h},${this._x1=l},${this._y1=c}`:u>path_epsilon&&this._append`A${i},${i},0,${+(u>=pi)},${h},${this._x1=t+i*Math.cos(n)},${this._y1=e+i*Math.sin(n)}`)}rect(t,e,i,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}}function path(){return new path_Path}function pathRound(t=3){return new path_Path(+t)}function withPath(t){let e=3;return t.digits=function(i){if(!arguments.length)return e;if(null==i)e=null;else{const t=Math.floor(i);if(!(t>=0))throw new RangeError(`invalid digits: ${i}`);e=t}return t},()=>new path_Path(e)}function point_x(t){return t[0]}function point_y(t){return t[1]}function src_line(t,e){var i=d3_shape_src_constant(!0),r=null,n=curve_linear,s=null,o=withPath(a);function a(a){var l,c,h,u=(a=d3_shape_src_array(a)).length,d=!1;for(null==r&&(s=n(h=o())),l=0;l<=u;++l)!(l<u&&i(c=a[l],l,a))===d&&((d=!d)?s.lineStart():s.lineEnd()),d&&s.point(+t(c,l,a),+e(c,l,a));if(h)return s=null,h+""||null}return t="function"==typeof t?t:void 0===t?point_x:d3_shape_src_constant(t),e="function"==typeof e?e:void 0===e?point_y:d3_shape_src_constant(e),a.x=function(e){return arguments.length?(t="function"==typeof e?e:d3_shape_src_constant(+e),a):t},a.y=function(t){return arguments.length?(e="function"==typeof t?t:d3_shape_src_constant(+t),a):e},a.defined=function(t){return arguments.length?(i="function"==typeof t?t:d3_shape_src_constant(!!t),a):i},a.curve=function(t){return arguments.length?(n=t,null!=r&&(s=n(r)),a):n},a.context=function(t){return arguments.length?(null==t?r=s=null:s=n(r=t),a):r},a}function src_area(t,e,i){var r=null,n=d3_shape_src_constant(!0),s=null,o=curve_linear,a=null,l=withPath(c);function c(c){var h,u,d,p,f,m=(c=d3_shape_src_array(c)).length,g=!1,_=new Array(m),v=new Array(m);for(null==s&&(a=o(f=l())),h=0;h<=m;++h){if(!(h<m&&n(p=c[h],h,c))===g)if(g=!g)u=h,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),d=h-1;d>=u;--d)a.point(_[d],v[d]);a.lineEnd(),a.areaEnd()}g&&(_[h]=+t(p,h,c),v[h]=+e(p,h,c),a.point(r?+r(p,h,c):_[h],i?+i(p,h,c):v[h]))}if(f)return a=null,f+""||null}function h(){return src_line().defined(n).curve(o).context(s)}return t="function"==typeof t?t:void 0===t?point_x:d3_shape_src_constant(+t),e="function"==typeof e?e:d3_shape_src_constant(void 0===e?0:+e),i="function"==typeof i?i:void 0===i?point_y:d3_shape_src_constant(+i),c.x=function(e){return arguments.length?(t="function"==typeof e?e:d3_shape_src_constant(+e),r=null,c):t},c.x0=function(e){return arguments.length?(t="function"==typeof e?e:d3_shape_src_constant(+e),c):t},c.x1=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:d3_shape_src_constant(+t),c):r},c.y=function(t){return arguments.length?(e="function"==typeof t?t:d3_shape_src_constant(+t),i=null,c):e},c.y0=function(t){return arguments.length?(e="function"==typeof t?t:d3_shape_src_constant(+t),c):e},c.y1=function(t){return arguments.length?(i=null==t?null:"function"==typeof t?t:d3_shape_src_constant(+t),c):i},c.lineX0=c.lineY0=function(){return h().x(t).y(e)},c.lineY1=function(){return h().x(t).y(i)},c.lineX1=function(){return h().x(r).y(e)},c.defined=function(t){return arguments.length?(n="function"==typeof t?t:d3_shape_src_constant(!!t),c):n},c.curve=function(t){return arguments.length?(o=t,null!=s&&(a=o(s)),c):o},c.context=function(t){return arguments.length?(null==t?s=a=null:a=o(s=t),c):s},c}function basis_point(t,e,i){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+i)/6)}function Basis(t){this._context=t}function curve_basis(t){return new Basis(t)}function monotone_sign(t){return t<0?-1:1}function slope3(t,e,i){var r=t._x1-t._x0,n=e-t._x1,s=(t._y1-t._y0)/(r||n<0&&-0),o=(i-t._y1)/(n||r<0&&-0),a=(s*n+o*r)/(r+n);return(monotone_sign(s)+monotone_sign(o))*Math.min(Math.abs(s),Math.abs(o),.5*Math.abs(a))||0}function slope2(t,e){var i=t._x1-t._x0;return i?(3*(t._y1-t._y0)/i-e)/2:e}function monotone_point(t,e,i){var r=t._x0,n=t._y0,s=t._x1,o=t._y1,a=(s-r)/3;t._context.bezierCurveTo(r+a,n+a*e,s-a,o-a*i,s,o)}function MonotoneX(t){this._context=t}function MonotoneY(t){this._context=new ReflectContext(t)}function ReflectContext(t){this._context=t}function monotoneX(t){return new MonotoneX(t)}function monotoneY(t){return new MonotoneY(t)}function transform_Transform(t,e,i){this.k=t,this.x=e,this.y=i}path.prototype=path_Path.prototype,Basis.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:basis_point(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:basis_point(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},MonotoneX.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:monotone_point(this,this._t0,slope2(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var i=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,monotone_point(this,slope2(this,i=slope3(this,t,e)),i);break;default:monotone_point(this,this._t0,i=slope3(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=i}}},(MonotoneY.prototype=Object.create(MonotoneX.prototype)).point=function(t,e){MonotoneX.prototype.point.call(this,e,t)},ReflectContext.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,i,r,n,s){this._context.bezierCurveTo(e,t,r,i,s,n)}},transform_Transform.prototype={constructor:transform_Transform,scale:function(t){return 1===t?this:new transform_Transform(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new transform_Transform(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var transform_identity=new transform_Transform(1,0,0);function transform(t){for(;!t.__zoom;)if(!(t=t.parentNode))return transform_identity;return t.__zoom}function zoom_defaultFilter(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function zoom_defaultExtent(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function defaultTransform(){return this.__zoom||identity}function defaultWheelDelta(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function zoom_defaultTouchable(){return navigator.maxTouchPoints||"ontouchstart"in this}function defaultConstrain(t,e,i){var r=t.invertX(e[0][0])-i[0][0],n=t.invertX(e[1][0])-i[1][0],s=t.invertY(e[0][1])-i[0][1],o=t.invertY(e[1][1])-i[1][1];return t.translate(n>r?(r+n)/2:Math.min(0,r)||Math.max(0,n),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function zoom(){var t,e,i,r=zoom_defaultFilter,n=zoom_defaultExtent,s=defaultConstrain,o=defaultWheelDelta,a=zoom_defaultTouchable,l=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],h=250,u=interpolateZoom,d=dispatch("start","zoom","end"),p=0,f=10;function m(t){t.property("__zoom",defaultTransform).on("wheel.zoom",x,{passive:!1}).on("mousedown.zoom",C).on("dblclick.zoom",E).filter(a).on("touchstart.zoom",M).on("touchmove.zoom",S).on("touchend.zoom touchcancel.zoom",w).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(t,e){return(e=Math.max(l[0],Math.min(l[1],e)))===t.k?t:new Transform(e,t.x,t.y)}function _(t,e,i){var r=e[0]-i[0]*t.k,n=e[1]-i[1]*t.k;return r===t.x&&n===t.y?t:new Transform(t.k,r,n)}function v(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function y(t,e,i,r){t.on("start.zoom",(function(){b(this,arguments).event(r).start()})).on("interrupt.zoom end.zoom",(function(){b(this,arguments).event(r).end()})).tween("zoom",(function(){var t=this,s=arguments,o=b(t,s).event(r),a=n.apply(t,s),l=null==i?v(a):"function"==typeof i?i.apply(t,s):i,c=Math.max(a[1][0]-a[0][0],a[1][1]-a[0][1]),h=t.__zoom,d="function"==typeof e?e.apply(t,s):e,p=u(h.invert(l).concat(c/h.k),d.invert(l).concat(c/d.k));return function(t){if(1===t)t=d;else{var e=p(t),i=c/e[2];t=new Transform(i,l[0]-e[0]*i,l[1]-e[1]*i)}o.zoom(null,t)}}))}function b(t,e,i){return!i&&t.__zooming||new A(t,e)}function A(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=n.apply(t,e),this.taps=0}function x(t,...e){if(r.apply(this,arguments)){var i=b(this,e).event(t),n=this.__zoom,a=Math.max(l[0],Math.min(l[1],n.k*Math.pow(2,o.apply(this,arguments)))),h=pointer(t);if(i.wheel)i.mouse[0][0]===h[0]&&i.mouse[0][1]===h[1]||(i.mouse[1]=n.invert(i.mouse[0]=h)),clearTimeout(i.wheel);else{if(n.k===a)return;i.mouse=[h,n.invert(h)],interrupt(this),i.start()}noevent(t),i.wheel=setTimeout((function(){i.wheel=null,i.end()}),150),i.zoom("mouse",s(_(g(n,a),i.mouse[0],i.mouse[1]),i.extent,c))}}function C(t,...e){if(!i&&r.apply(this,arguments)){var n=t.currentTarget,o=b(this,e,!0).event(t),a=select(t.view).on("mousemove.zoom",(function(t){if(noevent(t),!o.moved){var e=t.clientX-h,i=t.clientY-u;o.moved=e*e+i*i>p}o.event(t).zoom("mouse",s(_(o.that.__zoom,o.mouse[0]=pointer(t,n),o.mouse[1]),o.extent,c))}),!0).on("mouseup.zoom",(function(t){a.on("mousemove.zoom mouseup.zoom",null),dragEnable(t.view,o.moved),noevent(t),o.event(t).end()}),!0),l=pointer(t,n),h=t.clientX,u=t.clientY;dragDisable(t.view),nopropagation(t),o.mouse=[l,this.__zoom.invert(l)],interrupt(this),o.start()}}function E(t,...e){if(r.apply(this,arguments)){var i=this.__zoom,o=pointer(t.changedTouches?t.changedTouches[0]:t,this),a=i.invert(o),l=i.k*(t.shiftKey?.5:2),u=s(_(g(i,l),o,a),n.apply(this,e),c);noevent(t),h>0?select(this).transition().duration(h).call(y,u,o,t):select(this).call(m.transform,u,o,t)}}function M(i,...n){if(r.apply(this,arguments)){var s,o,a,l,c=i.touches,h=c.length,u=b(this,n,i.changedTouches.length===h).event(i);for(nopropagation(i),o=0;o<h;++o)a=c[o],l=[l=pointer(a,this),this.__zoom.invert(l),a.identifier],u.touch0?u.touch1||u.touch0[2]===l[2]||(u.touch1=l,u.taps=0):(u.touch0=l,s=!0,u.taps=1+!!t);t&&(t=clearTimeout(t)),s&&(u.taps<2&&(e=l[0],t=setTimeout((function(){t=null}),500)),interrupt(this),u.start())}}function S(t,...e){if(this.__zooming){var i,r,n,o,a=b(this,e).event(t),l=t.changedTouches,h=l.length;for(noevent(t),i=0;i<h;++i)r=l[i],n=pointer(r,this),a.touch0&&a.touch0[2]===r.identifier?a.touch0[0]=n:a.touch1&&a.touch1[2]===r.identifier&&(a.touch1[0]=n);if(r=a.that.__zoom,a.touch1){var u=a.touch0[0],d=a.touch0[1],p=a.touch1[0],f=a.touch1[1],m=(m=p[0]-u[0])*m+(m=p[1]-u[1])*m,v=(v=f[0]-d[0])*v+(v=f[1]-d[1])*v;r=g(r,Math.sqrt(m/v)),n=[(u[0]+p[0])/2,(u[1]+p[1])/2],o=[(d[0]+f[0])/2,(d[1]+f[1])/2]}else{if(!a.touch0)return;n=a.touch0[0],o=a.touch0[1]}a.zoom("touch",s(_(r,n,o),a.extent,c))}}function w(t,...r){if(this.__zooming){var n,s,o=b(this,r).event(t),a=t.changedTouches,l=a.length;for(nopropagation(t),i&&clearTimeout(i),i=setTimeout((function(){i=null}),500),n=0;n<l;++n)s=a[n],o.touch0&&o.touch0[2]===s.identifier?delete o.touch0:o.touch1&&o.touch1[2]===s.identifier&&delete o.touch1;if(o.touch1&&!o.touch0&&(o.touch0=o.touch1,delete o.touch1),o.touch0)o.touch0[1]=this.__zoom.invert(o.touch0[0]);else if(o.end(),2===o.taps&&(s=pointer(s,this),Math.hypot(e[0]-s[0],e[1]-s[1])<f)){var c=select(this).on("dblclick.zoom");c&&c.apply(this,arguments)}}}return m.transform=function(t,e,i,r){var n=t.selection?t.selection():t;n.property("__zoom",defaultTransform),t!==n?y(t,e,i,r):n.interrupt().each((function(){b(this,arguments).event(r).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},m.scaleBy=function(t,e,i,r){m.scaleTo(t,(function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)}),i,r)},m.scaleTo=function(t,e,i,r){m.transform(t,(function(){var t=n.apply(this,arguments),r=this.__zoom,o=null==i?v(t):"function"==typeof i?i.apply(this,arguments):i,a=r.invert(o),l="function"==typeof e?e.apply(this,arguments):e;return s(_(g(r,l),o,a),t,c)}),i,r)},m.translateBy=function(t,e,i,r){m.transform(t,(function(){return s(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof i?i.apply(this,arguments):i),n.apply(this,arguments),c)}),null,r)},m.translateTo=function(t,e,i,r,o){m.transform(t,(function(){var t=n.apply(this,arguments),o=this.__zoom,a=null==r?v(t):"function"==typeof r?r.apply(this,arguments):r;return s(identity.translate(a[0],a[1]).scale(o.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof i?-i.apply(this,arguments):-i),t,c)}),r,o)},A.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=select(this.that).datum();d.call(t,this.that,new ZoomEvent(t,{sourceEvent:this.sourceEvent,target:m,type:t,transform:this.that.__zoom,dispatch:d}),e)}},m.wheelDelta=function(t){return arguments.length?(o="function"==typeof t?t:constant(+t),m):o},m.filter=function(t){return arguments.length?(r="function"==typeof t?t:constant(!!t),m):r},m.touchable=function(t){return arguments.length?(a="function"==typeof t?t:constant(!!t),m):a},m.extent=function(t){return arguments.length?(n="function"==typeof t?t:constant([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),m):n},m.scaleExtent=function(t){return arguments.length?(l[0]=+t[0],l[1]=+t[1],m):[l[0],l[1]]},m.translateExtent=function(t){return arguments.length?(c[0][0]=+t[0][0],c[1][0]=+t[1][0],c[0][1]=+t[0][1],c[1][1]=+t[1][1],m):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},m.constrain=function(t){return arguments.length?(s=t,m):s},m.duration=function(t){return arguments.length?(h=+t,m):h},m.interpolate=function(t){return arguments.length?(u=t,m):u},m.on=function(){var t=d.on.apply(d,arguments);return t===d?m:t},m.clickDistance=function(t){return arguments.length?(p=(t=+t)*t,m):Math.sqrt(p)},m.tapDistance=function(t){return arguments.length?(f=+t,m):f},m}transform.prototype=transform_Transform.prototype;var D3Visualizer_excluded=["type","data","domain","range","width","height"];function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||D3Visualizer_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function D3Visualizer_unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return D3Visualizer_arrayLikeToArray(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?D3Visualizer_arrayLikeToArray(t,e):void 0}}function D3Visualizer_arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function _iterableToArrayLimit(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var r,n,s,o,a=[],l=!0,c=!1;try{if(s=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;l=!1}else for(;!(l=(r=s.call(i)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){c=!0,n=t}finally{try{if(!l&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(c)throw n}}return a}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function D3Visualizer_objectWithoutProperties(t,e){if(null==t)return{};var i,r,n=D3Visualizer_objectWithoutPropertiesLoose(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)i=s[r],-1===e.indexOf(i)&&{}.propertyIsEnumerable.call(t,i)&&(n[i]=t[i])}return n}function D3Visualizer_objectWithoutPropertiesLoose(t,e){if(null==t)return{};var i={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(-1!==e.indexOf(r))continue;i[r]=t[r]}return i}var D3Visualizer=function(t){var e=t.type,i=t.data,r=void 0===i?[]:i,n=t.domain,s=void 0===n?[-10,10]:n,o=t.range,a=void 0===o?[-10,10]:o,l=t.width,c=void 0===l?"100%":l,h=t.height,u=void 0===h?400:h,d=D3Visualizer_objectWithoutProperties(t,D3Visualizer_excluded),p=(0,react.useRef)(null),f=_slicedToArray((0,react.useState)(0),2),m=f[0],g=f[1];return(0,react.useEffect)((function(){if(p.current){var t=function(){"string"==typeof c&&c.includes("%")?g(p.current.clientWidth):g(parseInt(c,10))};return t(),window.addEventListener("resize",t),function(){window.removeEventListener("resize",t)}}}),[c]),(0,react.useEffect)((function(){if(p.current&&m>0){src_select(p.current).selectAll("*").remove();var t=src_select(p.current).append("svg").attr("width",m).attr("height","string"==typeof u?parseInt(u,10):u).attr("viewBox","0 0 ".concat(m," ").concat(u)).attr("preserveAspectRatio","xMidYMid meet");switch(e){case"scatter":createScatterPlot(t,r,s,a,m,u);break;case"bar":createBarChart(t,r,s,a,m,u);break;case"line":case"multiLine":createLineChart(t,r,s,a,m,u);break;case"probabilityDistribution":createDistributionChart(t,r,s,a,m,u);break;default:t.append("rect").attr("x",0).attr("y",0).attr("width",m).attr("height",u).attr("fill","#f8f9fa"),t.append("text").attr("x",m/2).attr("y",u/2).attr("text-anchor","middle").text("Unsupported D3 visualization type: ".concat(e))}}}),[e,r,s,a,m,u,d]),react.createElement("div",{ref:p,style:{width:c,height:u,overflow:"hidden"},"data-testid":"d3-container"})};function createScatterPlot(t,e,i,r,n,s){var o=n-50-30,a=s-20-40,l=linear_linear().domain(i).range([0,o]),c=linear_linear().domain(r).range([a,0]),h=axisBottom(l),u=axisLeft(c),d=t.append("g").attr("transform","translate(".concat(50,",").concat(20,")"));d.append("g").attr("class","grid-lines").selectAll("line").data(l.ticks()).enter().append("line").attr("x1",(function(t){return l(t)})).attr("x2",(function(t){return l(t)})).attr("y1",0).attr("y2",a).attr("stroke","#e0e0e0").attr("stroke-width",.5),d.append("g").attr("class","grid-lines").selectAll("line").data(c.ticks()).enter().append("line").attr("x1",0).attr("x2",o).attr("y1",(function(t){return c(t)})).attr("y2",(function(t){return c(t)})).attr("stroke","#e0e0e0").attr("stroke-width",.5),d.append("g").attr("class","x-axis").attr("transform","translate(0,".concat(a,")")).call(h),d.append("g").attr("class","y-axis").call(u),d.selectAll("circle").data(e).enter().append("circle").attr("cx",(function(t){return l(t.x)})).attr("cy",(function(t){return c(t.y)})).attr("r",(function(t){return t.size||5})).attr("fill",(function(t){return t.color||"#3090FF"})).attr("opacity",.7),d.append("text").attr("class","x-axis-label").attr("x",o/2).attr("y",a+35).attr("text-anchor","middle").text("X-Axis"),d.append("text").attr("class","y-axis-label").attr("transform","rotate(-90)").attr("x",-a/2).attr("y",-40).attr("text-anchor","middle").text("Y-Axis")}function createBarChart(t,e,i,r,n,s){var o=n-50-30,a=s-20-60,l=band().domain(e.map((function(t){return t.label}))).range([0,o]).padding(.2),c=linear_linear().domain([0,1.1*max(e,(function(t){return t.value}))]).range([a,0]),h=axisBottom(l),u=axisLeft(c),d=t.append("g").attr("transform","translate(".concat(50,",").concat(20,")"));d.append("g").attr("class","grid-lines").selectAll("line").data(c.ticks()).enter().append("line").attr("x1",0).attr("x2",o).attr("y1",(function(t){return c(t)})).attr("y2",(function(t){return c(t)})).attr("stroke","#e0e0e0").attr("stroke-width",.5),d.append("g").attr("class","x-axis").attr("transform","translate(0,".concat(a,")")).call(h).selectAll("text").attr("y",10).attr("x",-5).attr("dy",".35em").attr("transform","rotate(-45)").attr("text-anchor","end"),d.append("g").attr("class","y-axis").call(u),d.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("x",(function(t){return l(t.label)})).attr("y",(function(t){return c(t.value)})).attr("width",l.bandwidth()).attr("height",(function(t){return a-c(t.value)})).attr("fill",(function(t){return t.color||"#3090FF"})),d.selectAll(".bar-value").data(e).enter().append("text").attr("class","bar-value").attr("x",(function(t){return l(t.label)+l.bandwidth()/2})).attr("y",(function(t){return c(t.value)-5})).attr("text-anchor","middle").text((function(t){return t.value})),d.append("text").attr("class","x-axis-label").attr("x",o/2).attr("y",a+50).attr("text-anchor","middle").text("Categories"),d.append("text").attr("class","y-axis-label").attr("transform","rotate(-90)").attr("x",-a/2).attr("y",-40).attr("text-anchor","middle").text("Values")}function createLineChart(t,e,i,r,n,s){var o=n-50-30,a=s-20-40,l=Array.isArray(e[0])||e[0]&&e[0].series?e[0].series?e:e.map((function(t,e){return{name:t.name||"Series ".concat(e+1),color:t.color||D3Visualizer_getColor(e),data:t}})):[{name:"Series 1",color:"#3090FF",data:e}],c=i||[min(l,(function(t){return min(t.data,(function(t){return t.x}))})),max(l,(function(t){return max(t.data,(function(t){return t.x}))}))],h=r||[min(l,(function(t){return min(t.data,(function(t){return t.y}))})),max(l,(function(t){return max(t.data,(function(t){return t.y}))}))],u=linear_linear().domain([c[0]-.05*(c[1]-c[0]),c[1]+.05*(c[1]-c[0])]).range([0,o]),d=linear_linear().domain([h[0]-.05*(h[1]-h[0]),h[1]+.05*(h[1]-h[0])]).range([a,0]),p=axisBottom(u),f=axisLeft(d),m=src_line().x((function(t){return u(t.x)})).y((function(t){return d(t.y)})).curve(monotoneX),g=t.append("g").attr("transform","translate(".concat(50,",").concat(20,")"));if(g.append("g").attr("class","grid-lines").selectAll("line").data(u.ticks()).enter().append("line").attr("x1",(function(t){return u(t)})).attr("x2",(function(t){return u(t)})).attr("y1",0).attr("y2",a).attr("stroke","#e0e0e0").attr("stroke-width",.5),g.append("g").attr("class","grid-lines").selectAll("line").data(d.ticks()).enter().append("line").attr("x1",0).attr("x2",o).attr("y1",(function(t){return d(t)})).attr("y2",(function(t){return d(t)})).attr("stroke","#e0e0e0").attr("stroke-width",.5),g.append("g").attr("class","x-axis").attr("transform","translate(0,".concat(a,")")).call(p),g.append("g").attr("class","y-axis").call(f),l.forEach((function(t){g.append("path").datum(t.data).attr("class","line").attr("fill","none").attr("stroke",t.color).attr("stroke-width",2).attr("d",m),g.selectAll(".dot-".concat(t.name.replace(/\s+/g,"-"))).data(t.data).enter().append("circle").attr("class","dot-".concat(t.name.replace(/\s+/g,"-"))).attr("cx",(function(t){return u(t.x)})).attr("cy",(function(t){return d(t.y)})).attr("r",4).attr("fill",t.color).attr("stroke","#fff").attr("stroke-width",1)})),l.length>1){var _=g.append("g").attr("class","legend").attr("transform","translate(".concat(o-100,", 0)"));l.forEach((function(t,e){var i=_.append("g").attr("transform","translate(0, ".concat(20*e,")"));i.append("rect").attr("width",12).attr("height",12).attr("fill",t.color),i.append("text").attr("x",20).attr("y",10).attr("text-anchor","start").text(t.name)}))}g.append("text").attr("class","x-axis-label").attr("x",o/2).attr("y",a+35).attr("text-anchor","middle").text("X-Axis"),g.append("text").attr("class","y-axis-label").attr("transform","rotate(-90)").attr("x",-a/2).attr("y",-40).attr("text-anchor","middle").text("Y-Axis")}function createDistributionChart(t,e,i,r,n,s){var o=n-50-30,a=s-20-40,l=i||[min(e,(function(t){return t.x}))-1,max(e,(function(t){return t.x}))+1],c=r||[0,1.1*max(e,(function(t){return t.y}))],h=linear_linear().domain(l).range([0,o]),u=linear_linear().domain(c).range([a,0]),d=axisBottom(h),p=axisLeft(u),f=src_line().x((function(t){return h(t.x)})).y((function(t){return u(t.y)})).curve(curve_basis),m=src_area().x((function(t){return h(t.x)})).y0(a).y1((function(t){return u(t.y)})).curve(curve_basis),g=t.append("g").attr("transform","translate(".concat(50,",").concat(20,")"));if(g.append("g").attr("class","grid-lines").selectAll("line").data(u.ticks()).enter().append("line").attr("x1",0).attr("x2",o).attr("y1",(function(t){return u(t)})).attr("y2",(function(t){return u(t)})).attr("stroke","#e0e0e0").attr("stroke-width",.5),g.append("path").datum(e).attr("class","area").attr("fill","#3090FF").attr("fill-opacity",.3).attr("d",m),g.append("path").datum(e).attr("class","line").attr("fill","none").attr("stroke","#3090FF").attr("stroke-width",2).attr("d",f),g.append("g").attr("class","x-axis").attr("transform","translate(0,".concat(a,")")).call(d),g.append("g").attr("class","y-axis").call(p),e.some((function(t){return t.isMean}))){var _=e.find((function(t){return t.isMean}));g.append("line").attr("class","mean-line").attr("x1",h(_.x)).attr("x2",h(_.x)).attr("y1",a).attr("y2",0).attr("stroke","red").attr("stroke-width",1.5).attr("stroke-dasharray","5,5"),g.append("text").attr("class","mean-label").attr("x",h(_.x)).attr("y",15).attr("text-anchor","middle").text("Mean")}g.append("text").attr("class","x-axis-label").attr("x",o/2).attr("y",a+35).attr("text-anchor","middle").text("Value"),g.append("text").attr("class","y-axis-label").attr("transform","rotate(-90)").attr("x",-a/2).attr("y",-40).attr("text-anchor","middle").text("Probability")}function D3Visualizer_getColor(t){var e=["#3090FF","#FF9030","#30FF90","#FF3090","#9030FF","#30FFF9","#FFD700"];return e[t%e.length]}const visualizers_D3Visualizer=null;function _extends(){return _extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)({}).hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},_extends.apply(null,arguments)}var VisualizationWrapper=function(t){var e=t.library,i=t.type,r=t.expression,n=t.data,s=t.domain,o=t.range,a=t.zRange,l=t.points,c=t.lines,h=t.vectors,u=t.circles,d=t.elements,p=t.width,f=t.height,m=t.options,g=void 0===m?{}:m,_=e||(i.includes("3D")||"function3D"===i||"parametric3D"===i||"vectorField3D"===i||a?"mathbox":"function2D"!==i||g.requiresCustomization?"geometry"===i?"jsxgraph":"scatter"===i||"bar"===i||"line"===i||"multiLine"===i||n?"d3":"calculus"!==i||"integral"!==g.subtype&&"derivative"!==g.subtype?"linearAlgebra"===i?"2D"===g.space?"mafs":"mathbox":"probabilityDistribution"===i?"d3":"jsxgraph":"mafs":"mafs");switch(_){case"mafs":return react.createElement(MafsVisualizer,_extends({type:i,expression:r,domain:s,range:o,points:l,vectors:h,lines:c,circles:u,width:p,height:f},g));case"mathbox":return react.createElement(MathBoxVisualizer,_extends({type:i,expression:r,domain:s,range:o,zRange:a,width:p,height:f},g));case"three":return react.createElement(ThreeJSVisualizer,_extends({type:i,expression:r,domain:s,range:o,zRange:a,width:p,height:f},g));case"jsxgraph":return react.createElement(JSXGraphVisualizer,_extends({type:i,expression:r,domain:s,range:o,elements:d||[],width:p,height:f},g));case"d3":return react.createElement(D3Visualizer,_extends({type:i,expression:r,data:n,domain:s,range:o,width:p,height:f},g));default:return react.createElement("div",{style:{width:p||"100%",height:f||400,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #ccc",borderRadius:"4px",backgroundColor:"#f9f9f9"}},react.createElement("p",null,"Unsupported visualization library: ",_))}};const components_VisualizationWrapper=VisualizationWrapper;function responseFormatter_toConsumableArray(t){return responseFormatter_arrayWithoutHoles(t)||responseFormatter_iterableToArray(t)||responseFormatter_unsupportedIterableToArray(t)||responseFormatter_nonIterableSpread()}function responseFormatter_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function responseFormatter_unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return responseFormatter_arrayLikeToArray(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?responseFormatter_arrayLikeToArray(t,e):void 0}}function responseFormatter_iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function responseFormatter_arrayWithoutHoles(t){if(Array.isArray(t))return responseFormatter_arrayLikeToArray(t)}function responseFormatter_arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}var createStandardResponse=function(t){var e=t.explanation,i=void 0===e?"":e,r=t.visualizationParams,n=void 0===r?{}:r,s=t.educationalContent,o=void 0===s?{}:s,a=t.followUpQuestions,l=void 0===a?[]:a;i||console.warn("Explanation is required for standard response"),n.type||console.warn("Visualization type is required");var c={explanation:i,visualizationParams:n,educationalContent:{title:o.title||"",summary:o.summary||"",steps:o.steps||[],keyInsights:o.keyInsights||[],exercises:o.exercises||[]},followUpQuestions:l};return ensureVisualizationDefaults(c.visualizationParams),c},ensureVisualizationDefaults=function(t){switch(t.title||(t.title="".concat(t.type," Visualization")),t.type){case"function2D":t.domain||(t.domain=[-10,10]),t.range||(t.range=[-10,10]),void 0===t.gridLines&&(t.gridLines=!0);break;case"functions2D":t.domain||(t.domain=[-10,10]),t.range||(t.range=[-10,10]),void 0===t.gridLines&&(t.gridLines=!0),t.functions&&Array.isArray(t.functions)||(t.functions=[]);break;case"function3D":t.domainX||(t.domainX=[-5,5]),t.domainY||(t.domainY=[-5,5]),t.range||(t.range=[0,10]),t.resolution||(t.resolution=64),t.colormap||(t.colormap="viridis");break;case"parametric2D":t.parameterName||(t.parameterName="t"),t.parameterRange||(t.parameterRange=[0,2*Math.PI]),t.domain||(t.domain=[-5,5]),t.range||(t.range=[-5,5]),t.expressions||(t.expressions={x:"Math.cos(t)",y:"Math.sin(t)"});break;case"parametric3D":t.parameterType||(t.parameterType="curve"),t.parameterNames||(t.parameterNames="curve"===t.parameterType?["t"]:["u","v"]),t.parameterRanges||(t.parameterRanges="curve"===t.parameterType?[[0,2*Math.PI]]:[[0,2*Math.PI],[0,2*Math.PI]]),t.domainX||(t.domainX=[-5,5]),t.domainY||(t.domainY=[-5,5]),t.domainZ||(t.domainZ=[-5,5]),t.resolution||"surface"!==t.parameterType||(t.resolution=48);break;case"vectorField":t.dimensionality||(t.dimensionality="2D"),t.domain||(t.domain=[-3,3]),t.range||(t.range=[-3,3]),t.density||(t.density=15),void 0===t.normalize&&(t.normalize=!0),t.expressions||(t.expressions={x:"y",y:"-x"},"3D"===t.dimensionality&&(t.expressions.z="0"));break;case"geometry":t.domain||(t.domain=[-5,5]),t.range||(t.range=[-5,5]),t.elements&&Array.isArray(t.elements)||(t.elements=[]);break;case"calculus":if(t.subtype||(t.subtype="integral"),t.domain||(t.domain=[-.5,2.5]),t.range||(t.range=[-.5,4.5]),t.function||(t.function={expression:"x**2",color:"#3090FF"}),"integral"===t.subtype&&(t.integral||(t.integral={lowerBound:0,upperBound:2,color:"#FF9030",fillOpacity:.3}),t.integral.approximation)){var e=t.integral.approximation;e.method||(e.method="rectangles"),e.count||(e.count=10),void 0===e.show&&(e.show=!0)}break;case"probabilityDistribution":t.domain||(t.domain=[-4,4]),t.range||(t.range=[0,.5]),t.distribution||(t.distribution={name:"normal",parameters:{mean:0,standardDeviation:1}});break;case"linearAlgebra":t.subtype||(t.subtype="transformation"),t.space||(t.space="2D"),t.domain||(t.domain=[-5,5]),t.range||(t.range=[-5,5]),"transformation"!==t.subtype||t.matrix||("2D"===t.space?t.matrix=[[1,0],[0,1]]:"3D"===t.space&&(t.matrix=[[1,0,0],[0,1,0],[0,0,1]])),t.displayElements||(t.displayElements={grid:!0,unitVectors:!0,additionalVectors:[]}),t.animation||(t.animation={duration:1.5,enabled:!0})}},validateResponse=function(t){var e=[];if(t.explanation||e.push("Missing required field: explanation"),t.visualizationParams?t.visualizationParams.type||e.push("Missing required field: visualizationParams.type"):e.push("Missing required field: visualizationParams"),t.educationalContent){var i=t.educationalContent;i.steps&&!Array.isArray(i.steps)&&e.push("educationalContent.steps must be an array"),i.keyInsights&&!Array.isArray(i.keyInsights)&&e.push("educationalContent.keyInsights must be an array"),i.exercises&&!Array.isArray(i.exercises)&&e.push("educationalContent.exercises must be an array")}if(t.followUpQuestions&&!Array.isArray(t.followUpQuestions)&&e.push("followUpQuestions must be an array"),t.visualizationParams&&t.visualizationParams.type){var r=validateVisParamsByType(t.visualizationParams);e.push.apply(e,responseFormatter_toConsumableArray(r))}return{valid:0===e.length,errors:e}},validateVisParamsByType=function(t){var e=[];switch(t.type){case"function2D":t.expression||e.push("Missing required field for ".concat(t.type,": expression")),t.domain&&Array.isArray(t.domain)&&2===t.domain.length||e.push("Invalid or missing domain for ".concat(t.type)),t.range&&Array.isArray(t.range)&&2===t.range.length||e.push("Invalid or missing range for ".concat(t.type));break;case"functions2D":t.functions&&Array.isArray(t.functions)&&0!==t.functions.length?t.functions.forEach((function(t,i){t.expression||e.push("Missing expression for function at index ".concat(i))})):e.push("Missing required field for ".concat(t.type,": functions array"));break;case"function3D":t.expression||e.push("Missing required field for ".concat(t.type,": expression"));break;case"parametric2D":t.expressions&&t.expressions.x&&t.expressions.y||e.push("Missing required x/y expressions for ".concat(t.type));break;case"parametric3D":t.expressions&&t.expressions.x&&t.expressions.y&&t.expressions.z||e.push("Missing required x/y/z expressions for ".concat(t.type));break;case"vectorField":t.expressions?"2D"!==t.dimensionality||t.expressions.x&&t.expressions.y?"3D"!==t.dimensionality||t.expressions.x&&t.expressions.y&&t.expressions.z||e.push("Missing required x/y/z expressions for 3D ".concat(t.type)):e.push("Missing required x/y expressions for 2D ".concat(t.type)):e.push("Missing required field for ".concat(t.type,": expressions"));break;case"geometry":t.elements&&Array.isArray(t.elements)||e.push("Missing required field for ".concat(t.type,": elements array"));break;case"calculus":t.function&&t.function.expression||e.push("Missing required function expression for ".concat(t.type)),"integral"!==t.subtype||t.integral&&void 0!==t.integral.lowerBound&&void 0!==t.integral.upperBound||e.push("Missing required integral bounds for ".concat(t.type));break;case"probabilityDistribution":t.distribution&&t.distribution.name||e.push("Missing required distribution name for ".concat(t.type));break;case"linearAlgebra":"transformation"!==t.subtype||t.matrix&&Array.isArray(t.matrix)||e.push("Missing required transformation matrix for ".concat(t.type))}return e},parseResponseFromJson=function(t){try{var e=JSON.parse(t),i=validateResponse(e);return i.valid?e:(console.error("Validation errors:",i.errors),createStandardResponse({explanation:e.explanation||"",visualizationParams:e.visualizationParams||{},educationalContent:e.educationalContent||{},followUpQuestions:e.followUpQuestions||[]}))}catch(t){return console.error("Error parsing JSON response:",t),null}};const responseFormatter={createStandardResponse,validateResponse,parseResponseFromJson};var extractStructuredResponse=function(t){try{var e=t.match(/```(?:json)?\s*([\s\S]*?)```/);if(e&&e[1])try{var i=JSON.parse(e[1].trim()),r=validateResponse(i);return r.valid?i:(console.warn("Extracted JSON has validation errors:",r.errors),createStandardResponse({explanation:i.explanation||"",visualizationParams:i.visualizationParams||{},educationalContent:i.educationalContent||{},followUpQuestions:i.followUpQuestions||[]}))}catch(t){console.warn("Failed to parse extracted JSON:",t)}try{var n=JSON.parse(t.trim()),s=validateResponse(n);return s.valid?n:(console.warn("Full response JSON has validation errors:",s.errors),createStandardResponse({explanation:n.explanation||"",visualizationParams:n.visualizationParams||{},educationalContent:n.educationalContent||{},followUpQuestions:n.followUpQuestions||[]}))}catch(t){console.warn("Failed to parse full response as JSON:",t)}return extractFromFreeText(t)}catch(t){return console.error("Error processing LLM response:",t),null}},extractFromFreeText=function(t){var e=extractExplanation(t),i=extractVisualizationParams(t),r=extractEducationalContent(t),n=extractFollowUpQuestions(t);return createStandardResponse({explanation:e,visualizationParams:i,educationalContent:r,followUpQuestions:n})},extractExplanation=function(t){for(var e=0,i=[/(?:\n|^)(?:Explanation|Overview|Description|Introduction):\s*([\s\S]*?)(?:\n\n|\n#|\n(?:Steps|Key Insights|Exercises|Follow-up):|$)/i,/^((?:.*\n){1,3})/];e<i.length;e++){var r=i[e],n=t.match(r);if(n&&n[1]&&n[1].trim().length>10)return n[1].trim()}return t.substring(0,250).trim()},extractVisualizationParams=function(t){for(var e={type:"function2D",title:"Mathematical Visualization",domain:[-10,10],range:[-10,10]},i=0,r=[{regex:/\b3D\s+(?:surface|function|plot|graph)\b/i,type:"function3D"},{regex:/\bparametric\s+curve\b/i,type:"parametric2D"},{regex:/\bparametric\s+surface\b/i,type:"parametric3D"},{regex:/\bvector\s+field\b/i,type:"vectorField"},{regex:/\b(?:geometry|geometric|triangle|circle|polygon)\b/i,type:"geometry"},{regex:/\b(?:integral|derivative|calculus)\b/i,type:"calculus"},{regex:/\b(?:probability|distribution|normal|binomial|poisson)\b/i,type:"probabilityDistribution"},{regex:/\b(?:linear\s+algebra|matrix|transformation|eigenvector)\b/i,type:"linearAlgebra"},{regex:/\bmultiple\s+functions\b/i,type:"functions2D"}];i<r.length;i++){var n=r[i];if(n.regex.test(t)){e.type=n.type;break}}for(var s=0,o=[/(?:function|equation|expression)(?:[:\s]+)(?:is|given\s+by)?\s*(?:f\(x\)\s*=\s*)?([^.\n,]+)/i,/y\s*=\s*([^.\n,]+)/i,/f\s*\(\s*x\s*\)\s*=\s*([^.\n,]+)/i];s<o.length;s++){var a=o[s],l=t.match(a);if(l&&l[1]){var c=l[1].trim();if(c.length>1&&!c.includes("...")){if("functions2D"===e.type){e.functions=[{expression:c,label:"f(x)",color:"#3090FF"}];var h=t.match(/g\s*\(\s*x\s*\)\s*=\s*([^.\n,]+)/i);h&&h[1]&&e.functions.push({expression:h[1].trim(),label:"g(x)",color:"#FF9030"})}else e.expression=c;break}}}var u=t.match(/(?:domain|x-values|x\s+(?:is|in|ranges|varies|from))(?:\s+is|\s+are)?(?:\s+from)?\s+(-?\d+\.?\d*)\s+to\s+(-?\d+\.?\d*)/i);u&&u[1]&&u[2]&&(e.domain=[parseFloat(u[1]),parseFloat(u[2])]);var d=t.match(/(?:range|y-values|y\s+(?:is|in|ranges|varies|from))(?:\s+is|\s+are)?(?:\s+from)?\s+(-?\d+\.?\d*)\s+to\s+(-?\d+\.?\d*)/i);d&&d[1]&&d[2]&&(e.range=[parseFloat(d[1]),parseFloat(d[2])]);var p=t.match(/\btitle[:\s]+["']?([^"'\n.,]+(?:\s+[^"'\n.,]+){0,6})["']?/i);return p&&p[1]?e.title=p[1].trim():"function2D"===e.type&&e.expression&&(e.title="Graph of f(x) = ".concat(e.expression)),e},extractEducationalContent=function(t){var e={title:"",summary:"",steps:[],keyInsights:[],exercises:[]},i=t.match(/(?:\n|^)#\s+([^\n]+)/);i&&i[1]&&(e.title=i[1].trim());for(var r=0,n=[/(?:\n|^)(?:Summary|Overview):\s*([\s\S]*?)(?:\n\n|\n#|\n(?:Steps|Key Insights|Exercises|Follow-up):|$)/i,/(?:\n|^)In\s+summary,\s+([\s\S]*?)(?:\n\n|\n#|\n(?:Steps|Key Insights|Exercises|Follow-up):|$)/i];r<n.length;r++){var s=n[r],o=t.match(s);if(o&&o[1]&&o[1].trim().length>10){e.summary=o[1].trim();break}}var a=t.match(/(?:\n|^)(?:Steps|Procedure|Method|How to)(?::|\.)\s*([\s\S]*?)(?:\n\n\S|\n#|\n(?:Key Insights|Exercises|Follow-up):|$)/i);a&&a[1]&&a[1].trim().split(/\n(?:\d+\.|\*|\-)\s+/).filter((function(t){return t.trim().length>0})).forEach((function(t,i){var r=t.split(":");r.length>1?e.steps.push({title:r[0].trim(),content:r.slice(1).join(":").trim()}):e.steps.push({title:"Step ".concat(i+1),content:t.trim()})}));var l=t.match(/(?:\n|^)(?:Key\s+Insights|Important\s+Points|Key\s+Takeaways)(?::|\.)\s*([\s\S]*?)(?:\n\n\S|\n#|\n(?:Exercises|Follow-up):|$)/i);if(l&&l[1]){var c=l[1].trim().split(/\n(?:\d+\.|\*|\-)\s+/).filter((function(t){return t.trim().length>0}));e.keyInsights=c.map((function(t){return t.trim()}))}var h=t.match(/(?:\n|^)(?:Exercises|Practice\s+Problems|Problems)(?::|\.)\s*([\s\S]*?)(?:\n\n\S|\n#|\n(?:Follow-up):|$)/i);if(h&&h[1]){for(var u=h[1].trim(),d=[],p=0,f=[/\b(?:Question|Problem|Exercise)\s+\d+:\s*([\s\S]*?)(?:\n\s*(?:Solution|Answer):|$)/i,/\b\d+\.\s*([\s\S]*?)(?:\n\s*(?:Solution|Answer):|$)/i,/\b(?:Q\d+):\s*([\s\S]*?)(?:\n\s*(?:Solution|Answer):|$)/i];p<f.length;p++)for(var m=f[p],g=void 0,_=0;null!==(g=m.exec(u.slice(_)));){var v=g[1].trim();_+=g.index+g[0].length;var y=u.slice(_).match(/^(?:Solution|Answer):\s*([\s\S]*?)(?:\n\n\S|\n(?:Question|Problem|Exercise|Q\d+|\d+\.):|$)/i),b="";y&&y[1]&&(b=y[1].trim(),_+=y.index+y[0].length),d.push({question:v,solution:b})}d.length>0&&(e.exercises=d)}return e},extractFollowUpQuestions=function(t){var e=t.match(/(?:\n|^)(?:Follow-up\s+Questions|Further\s+Exploration|Next\s+Steps|Related\s+Topics)(?::|\.)\s*([\s\S]*?)(?:\n\n\S|\n#|$)/i);return e&&e[1]?e[1].trim().split(/\n(?:\d+\.|\*|\-)\s+/).filter((function(t){return t.trim().length>0})).map((function(t){return t.trim()})).filter((function(t){return t.includes("?")||/^(?:how|what|why|when|where|is|are|can|could|should|would|will|do|does)/i.test(t)})).map((function(t){return t.endsWith("?")?t:"".concat(t,"?")})):[]},generateFormattedPrompt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.level,r=void 0===i?"intermediate":i,n=e.preferredLibraries,s=void 0===n?[]:n,o="";return s.length>0&&(o="Preferred visualization libraries: ".concat(s.join(", "),".")),'\nYou are an educational mathematics visualization expert. Please explain the following mathematical concept:\n\n"'.concat(t,'"\n\nFormat your response following this exact JSON structure:\n\n{\n  "explanation": "Clear explanation of the mathematical concept",\n  "visualizationParams": {\n    "type": "visualization_type",\n    "title": "Visualization title",\n    // Type-specific parameters...\n  },\n  "educationalContent": {\n    "title": "Educational module title",\n    "summary": "Brief summary of the concept",\n    "steps": [\n      {\n        "title": "Step 1 title",\n        "content": "Step 1 explanation"\n      }\n      // Additional steps...\n    ],\n    "keyInsights": [\n      "Key insight 1",\n      "Key insight 2"\n    ],\n    "exercises": [\n      {\n        "question": "Exercise question",\n        "solution": "Exercise solution"\n      }\n      // Additional exercises...\n    ]\n  },\n  "followUpQuestions": [\n    "Suggested follow-up question 1?",\n    "Suggested follow-up question 2?"\n  ]\n}\n\nConsider the user\'s knowledge level (').concat(r,"). ").concat(o,"\n\nEnsure the visualization parameters are appropriate for the mathematical concept. Use one of these visualization types:\n- function2D (for 2D functions)\n- functions2D (for multiple 2D functions)\n- function3D (for 3D surfaces)\n- parametric2D (for parametric curves)\n- parametric3D (for parametric curves/surfaces in 3D)\n- vectorField (for vector fields in 2D or 3D)\n- geometry (for geometric constructions)\n- calculus (for calculus concepts like integrals or derivatives)\n- probabilityDistribution (for statistical distributions)\n- linearAlgebra (for linear algebra visualizations)\n\nEnsure the explanation is clear and accurate, the visualization parameters are complete, the educational content is helpful, and the follow-up questions encourage further exploration.\n\nReturn your response as a valid JSON object without additional text or explanation.\n")};const llmResponseProcessor={extractStructuredResponse,generateFormattedPrompt};var injectStylesIntoStyleTag=__webpack_require__(72),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),styleDomAPI=__webpack_require__(825),styleDomAPI_default=__webpack_require__.n(styleDomAPI),insertBySelector=__webpack_require__(659),insertBySelector_default=__webpack_require__.n(insertBySelector),setAttributesWithoutAttributes=__webpack_require__(56),setAttributesWithoutAttributes_default=__webpack_require__.n(setAttributesWithoutAttributes),insertStyleElement=__webpack_require__(778),insertStyleElement_default=__webpack_require__.n(insertStyleElement),styleTagTransform=__webpack_require__(113),styleTagTransform_default=__webpack_require__.n(styleTagTransform),ChatInterface=__webpack_require__(433),options={};options.styleTagTransform=styleTagTransform_default(),options.setAttributes=setAttributesWithoutAttributes_default(),options.insert=insertBySelector_default().bind(null,"head"),options.domAPI=styleDomAPI_default(),options.insertStyleElement=insertStyleElement_default();var update=injectStylesIntoStyleTag_default()(ChatInterface.A,options);const components_ChatInterface=ChatInterface.A&&ChatInterface.A.locals?ChatInterface.A.locals:void 0;function ChatInterface_typeof(t){return ChatInterface_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ChatInterface_typeof(t)}function ChatInterface_extends(){return ChatInterface_extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)({}).hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},ChatInterface_extends.apply(null,arguments)}function _regeneratorRuntime(){_regeneratorRuntime=function(){return e};var t,e={},i=Object.prototype,r=i.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function l(t,e,i,r){return Object.defineProperty(t,e,{value:i,enumerable:!r,configurable:!r,writable:!r})}try{l({},"")}catch(t){l=function(t,e,i){return t[e]=i}}function c(e,i,r,n){var s=i&&i.prototype instanceof d?i:d,o=Object.create(s.prototype);return l(o,"_invoke",function(e,i,r){var n=1;return function(s,o){if(3===n)throw Error("Generator is already running");if(4===n){if("throw"===s)throw o;return{value:t,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var l=A(a,r);if(l){if(l===u)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(1===n)throw n=4,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=3;var c=h(e,i,r);if("normal"===c.type){if(n=r.done?4:2,c.arg===u)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=4,r.method="throw",r.arg=c.arg)}}}(e,r,new E(n||[])),!0),o}function h(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var u={};function d(){}function p(){}function f(){}var m={};l(m,s,(function(){return this}));var g=Object.getPrototypeOf,_=g&&g(g(M([])));_&&_!==i&&r.call(_,s)&&(m=_);var v=f.prototype=d.prototype=Object.create(m);function y(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function i(n,s,o,a){var l=h(t[n],t,s);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==ChatInterface_typeof(u)&&r.call(u,"__await")?e.resolve(u.__await).then((function(t){i("next",t,o,a)}),(function(t){i("throw",t,o,a)})):e.resolve(u).then((function(t){c.value=t,o(c)}),(function(t){return i("throw",t,o,a)}))}a(l.arg)}var n;l(this,"_invoke",(function(t,r){function s(){return new e((function(e,n){i(t,r,e,n)}))}return n=n?n.then(s,s):s()}),!0)}function A(e,i){var r=i.method,n=e.i[r];if(n===t)return i.delegate=null,"throw"===r&&e.i.return&&(i.method="return",i.arg=t,A(e,i),"throw"===i.method)||"return"!==r&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+r+"' method")),u;var s=h(n,e.i,i.arg);if("throw"===s.type)return i.method="throw",i.arg=s.arg,i.delegate=null,u;var o=s.arg;return o?o.done?(i[e.r]=o.value,i.next=e.n,"return"!==i.method&&(i.method="next",i.arg=t),i.delegate=null,u):o:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,u)}function x(t){this.tryEntries.push(t)}function C(e){var i=e[4]||{};i.type="normal",i.arg=t,e[4]=i}function E(t){this.tryEntries=[[-1]],t.forEach(x,this),this.reset(!0)}function M(e){if(null!=e){var i=e[s];if(i)return i.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function i(){for(;++n<e.length;)if(r.call(e,n))return i.value=e[n],i.done=!1,i;return i.value=t,i.done=!0,i};return o.next=o}}throw new TypeError(ChatInterface_typeof(e)+" is not iterable")}return p.prototype=f,l(v,"constructor",f),l(f,"constructor",p),p.displayName=l(f,a,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,l(t,a,"GeneratorFunction")),t.prototype=Object.create(v),t},e.awrap=function(t){return{__await:t}},y(b.prototype),l(b.prototype,o,(function(){return this})),e.AsyncIterator=b,e.async=function(t,i,r,n,s){void 0===s&&(s=Promise);var o=new b(c(t,i,r,n),s);return e.isGeneratorFunction(i)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},y(v),l(v,a,"Generator"),l(v,s,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),i=[];for(var r in e)i.unshift(r);return function t(){for(;i.length;)if((r=i.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}},e.values=M,E.prototype={constructor:E,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var i in this)"t"===i.charAt(0)&&r.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function r(t){o.type="throw",o.arg=e,i.next=t}for(var n=i.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n],o=s[4],a=this.prev,l=s[1],c=s[2];if(-1===s[0])return r("end"),!1;if(!l&&!c)throw Error("try statement without catch or finally");if(null!=s[0]&&s[0]<=a){if(a<l)return this.method="next",this.arg=t,r(l),!0;if(a<c)return r(c),!1}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r[0]>-1&&r[0]<=this.prev&&this.prev<r[2]){var n=r;break}}n&&("break"===t||"continue"===t)&&n[0]<=e&&e<=n[2]&&(n=null);var s=n?n[4]:{};return s.type=t,s.arg=e,n?(this.method="next",this.next=n[2],u):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i[2]===t)return this.complete(i[4],i[3]),C(i),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i[0]===t){var r=i[4];if("throw"===r.type){var n=r.arg;C(i)}return n}}throw Error("illegal catch attempt")},delegateYield:function(e,i,r){return this.delegate={i:M(e),r:i,n:r},"next"===this.method&&(this.arg=t),u}},e}function ChatInterface_toConsumableArray(t){return ChatInterface_arrayWithoutHoles(t)||ChatInterface_iterableToArray(t)||ChatInterface_unsupportedIterableToArray(t)||ChatInterface_nonIterableSpread()}function ChatInterface_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ChatInterface_iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function ChatInterface_arrayWithoutHoles(t){if(Array.isArray(t))return ChatInterface_arrayLikeToArray(t)}function asyncGeneratorStep(t,e,i,r,n,s,o){try{var a=t[s](o),l=a.value}catch(t){return void i(t)}a.done?e(l):Promise.resolve(l).then(r,n)}function _asyncToGenerator(t){return function(){var e=this,i=arguments;return new Promise((function(r,n){var s=t.apply(e,i);function o(t){asyncGeneratorStep(s,r,n,o,a,"next",t)}function a(t){asyncGeneratorStep(s,r,n,o,a,"throw",t)}o(void 0)}))}}function ChatInterface_slicedToArray(t,e){return ChatInterface_arrayWithHoles(t)||ChatInterface_iterableToArrayLimit(t,e)||ChatInterface_unsupportedIterableToArray(t,e)||ChatInterface_nonIterableRest()}function ChatInterface_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ChatInterface_unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return ChatInterface_arrayLikeToArray(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?ChatInterface_arrayLikeToArray(t,e):void 0}}function ChatInterface_arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function ChatInterface_iterableToArrayLimit(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var r,n,s,o,a=[],l=!0,c=!1;try{if(s=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;l=!1}else for(;!(l=(r=s.call(i)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){c=!0,n=t}finally{try{if(!l&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(c)throw n}}return a}}function ChatInterface_arrayWithHoles(t){if(Array.isArray(t))return t}var initMathJax=function(){window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},svg:{fontCache:"global"},options:{skipHtmlTags:["script","noscript","style","textarea","pre","code"]}};var t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js",t.async=!0,document.head.appendChild(t)},formatMathInText=function(t){return setTimeout((function(){window.MathJax&&window.MathJax.typeset&&window.MathJax.typeset()}),0),t},ChatInterface_ChatInterface=function(){var t=ChatInterface_slicedToArray((0,react.useState)([]),2),e=t[0],i=t[1],r=ChatInterface_slicedToArray((0,react.useState)(""),2),n=r[0],s=r[1],o=ChatInterface_slicedToArray((0,react.useState)(!1),2),a=o[0],l=o[1],c=ChatInterface_slicedToArray((0,react.useState)(null),2),h=c[0],u=c[1],d=ChatInterface_slicedToArray((0,react.useState)(""),2),p=d[0],f=d[1],m=ChatInterface_slicedToArray((0,react.useState)("openai"),2),g=m[0],_=m[1],v=(0,react.useRef)(null),y=(0,react.useRef)(null);(0,react.useEffect)((function(){initMathJax(),console.log("Environment variables check:"),console.log("GITHUB_ACTIONS:",!0),console.log("REACT_APP_OPENAI_API_KEY exists:",!!"MISSING_ENV_VAR".REACT_APP_OPENAI_API_KEY),console.log("OPENAI_API_KEY exists:",!1),console.log("REACT_APP_ANTHROPIC_API_KEY exists:",!!"MISSING_ENV_VAR".REACT_APP_ANTHROPIC_API_KEY),console.log("ANTHROPIC_API_KEY exists:",!1);var t="MISSING_ENV_VAR".REACT_APP_OPENAI_API_KEY||"MISSING_ENV_VAR".OPENAI_KEY,e="MISSING_ENV_VAR".REACT_APP_ANTHROPIC_API_KEY||"MISSING_ENV_VAR".ANTHROPIC_KEY;t?(console.log("Found OpenAI key"),f(t),_("openai")):e?(console.log("Found Anthropic key"),f(e),_("anthropic")):console.log("No API keys found in environment variables");try{var r=localStorage.getItem("mathLLM_chatMessages");r&&i(JSON.parse(r));var n=localStorage.getItem("mathLLM_apiProvider");n&&_(n)}catch(t){console.error("Error loading from localStorage:",t)}}),[]),(0,react.useEffect)((function(){var t;if(null===(t=v.current)||void 0===t||t.scrollIntoView({behavior:"smooth"}),e.length>0)try{localStorage.setItem("mathLLM_chatMessages",JSON.stringify(e))}catch(t){console.error("Error saving to localStorage:",t)}}),[e]),(0,react.useEffect)((function(){try{localStorage.setItem("mathLLM_apiProvider",g)}catch(t){console.error("Error saving to localStorage:",t)}}),[g]);var b=function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function t(e){var r,o,a,c;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),n.trim()){t.next=3;break}return t.abrupt("return");case 3:if(p){t.next=7;break}return u("Please enter an API key to continue."),null===(r=y.current)||void 0===r||r.focus(),t.abrupt("return");case 7:return o={role:"user",content:n},i((function(t){return[].concat(ChatInterface_toConsumableArray(t),[o])})),s(""),l(!0),u(null),t.prev=12,t.next=15,A(o.content);case 15:a=t.sent,c=E(a),i((function(t){return[].concat(ChatInterface_toConsumableArray(t),[{role:"assistant",content:c.text,visualizationParams:c.visualizationParams}])})),t.next=24;break;case 20:t.prev=20,t.t0=t.catch(12),console.error("Error calling LLM API:",t.t0),u("An error occurred while processing your request. Please try again.");case 24:return t.prev=24,l(!1),t.finish(24);case 27:case"end":return t.stop()}}),t,null,[[12,20,24,27]])})));return function(e){return t.apply(this,arguments)}}(),A=function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function t(e){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("openai"!==g){t.next=4;break}return t.abrupt("return",x(e));case 4:if("anthropic"!==g){t.next=6;break}return t.abrupt("return",C(e));case 6:throw new Error("Invalid API provider");case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),x=function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function t(e){var i,r,n,s,o,a;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r='You are a math expert who provides clear, educational explanations about mathematical concepts. For any math expressions, use LaTeX notation with $ symbols (like $x^2$ for inline and $$\\int f(x) dx$$ for display).\n\nWhen appropriate, include a visualization by providing parameters in a JSON format inside a <visualization> tag.\n\nFor example:\n<visualization>\n{\n  "type": "function2D",\n  "expression": "Math.sin(x)",\n  "domain": [-Math.PI, Math.PI],\n  "range": [-1.5, 1.5]\n}\n</visualization>\n\nUnderstand the user\'s question and provide a helpful, educational response with clear explanations. If the concept can be visualized, include appropriate visualization parameters.\n\nUser question: '.concat(e),t.next=3,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(p)},body:JSON.stringify({model:"gpt-4-turbo",messages:[{role:"user",content:r}],temperature:.7})});case 3:if((n=t.sent).ok){t.next=9;break}return t.next=7,n.json();case 7:throw o=t.sent,new Error((null===(s=o.error)||void 0===s?void 0:s.message)||"Error calling OpenAI API");case 9:return t.next=11,n.json();case 11:return a=t.sent,t.abrupt("return",(null===(i=a.choices[0])||void 0===i||null===(i=i.message)||void 0===i?void 0:i.content)||"");case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),C=function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function t(e){var i,r,n,s,o,a;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r='You are a math expert who provides clear, educational explanations about mathematical concepts. For any math expressions, use LaTeX notation with $ symbols (like $x^2$ for inline and $$\\int f(x) dx$$ for display).\n\nWhen appropriate, include a visualization by providing parameters in a JSON format inside a <visualization> tag.\n\nFor example:\n<visualization>\n{\n  "type": "function2D",\n  "expression": "Math.sin(x)",\n  "domain": [-Math.PI, Math.PI],\n  "range": [-1.5, 1.5]\n}\n</visualization>\n\nUnderstand the user\'s question and provide a helpful, educational response with clear explanations. If the concept can be visualized, include appropriate visualization parameters.\n\nUser question: '.concat(e),t.next=3,fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":p,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:"claude-3-opus-20240229",max_tokens:4e3,messages:[{role:"user",content:r}]})});case 3:if((n=t.sent).ok){t.next=9;break}return t.next=7,n.json();case 7:throw o=t.sent,new Error((null===(s=o.error)||void 0===s?void 0:s.message)||"Error calling Anthropic API");case 9:return t.next=11,n.json();case 11:return a=t.sent,t.abrupt("return",(null===(i=a.content)||void 0===i||null===(i=i[0])||void 0===i?void 0:i.text)||"");case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),E=function(t){var e=t.match(/<visualization>([\s\S]*?)<\/visualization>/),i=null;if(e&&e[1])try{i=JSON.parse(e[1].trim())}catch(t){console.error("Error parsing visualization params:",t)}var r=t.replace(/<visualization>[\s\S]*?<\/visualization>/g,"").trim();if(!i){var n=extractStructuredResponse(t);n&&n.visualizationParams&&(i=n.visualizationParams)}return{text:r,visualizationParams:i}};return react.createElement("div",{className:"chat-interface"},react.createElement("div",{className:"chat-header"},react.createElement("h1",null,"Math Visualization Assistant"),react.createElement("div",{className:"api-settings"},react.createElement("select",{value:g,onChange:function(){_((function(t){return"openai"===t?"anthropic":"openai"})),f("")},className:"api-provider-selector"},react.createElement("option",{value:"openai"},"OpenAI"),react.createElement("option",{value:"anthropic"},"Anthropic")),react.createElement("input",{ref:y,type:"password",placeholder:"Enter ".concat("openai"===g?"OpenAI":"Anthropic"," API Key"),value:p,onChange:function(t){return f(t.target.value)},className:"api-key-input"}),e.length>0&&react.createElement("button",{onClick:function(){i([]),localStorage.removeItem("mathLLM_chatMessages")},className:"clear-chat-button",title:"Clear chat history"},""))),react.createElement("div",{className:"chat-messages"},0===e.length?react.createElement("div",{className:"empty-chat"},react.createElement("h2",null,"Welcome to Math Visualization Assistant!"),react.createElement("p",null,"Ask any math question or concept you'd like to understand better."),!p&&react.createElement("div",{className:"api-key-notice"},react.createElement("p",null," No API key detected. Please enter your OpenAI or Anthropic API key in the input field above."),react.createElement("p",null,react.createElement("small",null,"Note: If you added an API key via environment variables, you may need to restart the server for changes to take effect."))),react.createElement("div",{className:"example-queries"},react.createElement("h3",null,"Example questions you can ask:"),react.createElement("ul",null,react.createElement("li",{onClick:function(){return s("Explain the quadratic formula and show an example")}},"Explain the quadratic formula and show an example"),react.createElement("li",{onClick:function(){return s("What is a sine function and how does it behave?")}},"What is a sine function and how does it behave?"),react.createElement("li",{onClick:function(){return s("Show me the concept of derivatives graphically")}},"Show me the concept of derivatives graphically"),react.createElement("li",{onClick:function(){return s("How do parametric equations work?")}},"How do parametric equations work?"),react.createElement("li",{onClick:function(){return s("Explain vector fields with a visualization")}},"Explain vector fields with a visualization")))):e.map((function(t,e){var i=t.role,r=t.content,n=t.visualizationParams;return react.createElement("div",{key:e,className:"chat-message ".concat("user"===i?"user-message":"assistant-message")},react.createElement("div",{className:"message-avatar"},"user"===i?"":""),react.createElement("div",{className:"message-content"},react.createElement("div",{className:"message-text"},formatMathInText(r)),n&&react.createElement("div",{className:"visualization-container"},react.createElement(components_VisualizationWrapper,ChatInterface_extends({},n,{width:"100%",height:300})))))})),a&&react.createElement("div",{className:"loading-indicator"},react.createElement("div",{className:"dot-pulse"}),react.createElement("span",null,"Thinking...")),h&&react.createElement("div",{className:"error-message"},react.createElement("span",null," ",h)),react.createElement("div",{ref:v})),react.createElement("form",{className:"chat-input-container",onSubmit:b},react.createElement("input",{type:"text",value:n,onChange:function(t){return s(t.target.value)},placeholder:"Ask a math question...",className:"chat-input",disabled:a}),react.createElement("button",{type:"submit",className:"send-button",disabled:a||!n.trim()},a?"":"")))};const src_components_ChatInterface=ChatInterface_ChatInterface;react_dom.render(react.createElement(react.StrictMode,null,react.createElement(src_components_ChatInterface,null)),document.getElementById("root"))})();